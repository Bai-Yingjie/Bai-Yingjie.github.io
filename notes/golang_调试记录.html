
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Golang 调试记录 · My Notes</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Bai Yingjie">
        
        
    
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-wide-page/wide.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hide-navigation-buttons/index.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-mermaid-gb3/mermaid/mermaid.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    


    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="golang_topid性能优化.html" />
    
    
    <link rel="prev" href="as_title_golang6.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="as_title_kaiyuan.html">
            
                <a href="as_title_kaiyuan.html">
            
                    
                    开源
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="my_opensource.html">
            
                <a href="my_opensource.html">
            
                    
                    我的开源项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="my_upstream.html">
            
                <a href="my_upstream.html">
            
                    
                    我的upstream commit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="as_title_system.html">
            
                <a href="as_title_system.html">
            
                    
                    系统分析和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="as_title_perf_misc.html">
            
                <a href="as_title_perf_misc.html">
            
                    
                    调试和分析记录系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="profiling_调试和分析记录5.html">
            
                <a href="profiling_调试和分析记录5.html">
            
                    
                    调试和分析记录5
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="profiling_调试和分析记录4.html">
            
                <a href="profiling_调试和分析记录4.html">
            
                    
                    调试和分析记录4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="profiling_调试和分析记录3.html">
            
                <a href="profiling_调试和分析记录3.html">
            
                    
                    调试和分析记录3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="profiling_调试和分析记录2.html">
            
                <a href="profiling_调试和分析记录2.html">
            
                    
                    调试和分析记录2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="profiling_调试和分析记录1.html">
            
                <a href="profiling_调试和分析记录1.html">
            
                    
                    调试和分析记录1
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="调试和分析工具概览.html">
            
                <a href="调试和分析工具概览.html">
            
                    
                    profiling和debugging工具相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="debugging_gdb备忘录.html">
            
                <a href="debugging_gdb备忘录.html">
            
                    
                    gdb备忘录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="profiling_perf命令备忘录.html">
            
                <a href="profiling_perf命令备忘录.html">
            
                    
                    perf命令备忘录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="profiling_perf命令备忘录2.html">
            
                <a href="profiling_perf命令备忘录2.html">
            
                    
                    perf命令备忘录2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="profiling_perf学习笔记之实战篇.html">
            
                <a href="profiling_perf学习笔记之实战篇.html">
            
                    
                    perf学习笔记之实战篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5" data-path="profiling_perf学习笔记之入门篇.html">
            
                <a href="profiling_perf学习笔记之入门篇.html">
            
                    
                    perf学习笔记之入门篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.6" data-path="profiling_ftrace和trace-cmd记录.html">
            
                <a href="profiling_ftrace和trace-cmd记录.html">
            
                    
                    ftrace和trace-cmd记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.7" data-path="profiling_ftrace使用实例.html">
            
                <a href="profiling_ftrace使用实例.html">
            
                    
                    ftrace使用实例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.8" data-path="profiling_systemtap实例.html">
            
                <a href="profiling_systemtap实例.html">
            
                    
                    systemtap实例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.9" data-path="profiling_Comparing_SystemTap_and_bpftrace.html">
            
                <a href="profiling_Comparing_SystemTap_and_bpftrace.html">
            
                    
                    Comparing SystemTap and bpftrace(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.10" data-path="system_analysis_bcc和ebpf.html">
            
                <a href="system_analysis_bcc和ebpf.html">
            
                    
                    bcc和ebpf(starting)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="as_title_os_perf.html">
            
                <a href="as_title_os_perf.html">
            
                    
                    profiling和debugging实例
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="performance_ovs进程调查.html">
            
                <a href="performance_ovs进程调查.html">
            
                    
                    OVS进程调查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="performance_ping流程和函数调用解析.html">
            
                <a href="performance_ping流程和函数调用解析.html">
            
                    
                    ping流程和函数调用解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="profiling_VM互相ping场景下的延迟分析.html">
            
                <a href="profiling_VM互相ping场景下的延迟分析.html">
            
                    
                    VM互相ping场景下的延迟分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.4" data-path="debugging_ftrace_谁创建了bond0设备.html">
            
                <a href="debugging_ftrace_谁创建了bond0设备.html">
            
                    
                    谁创建了bond0设备: ftrace kprobe uprobe perf综合使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="as_title_arch_perf.html">
            
                <a href="as_title_arch_perf.html">
            
                    
                    CPU ARCH相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="performance_CPU_microarchiteture_pmu.html">
            
                <a href="performance_CPU_microarchiteture_pmu.html">
            
                    
                    Top-down Microarchitecture Analysis Method(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="as_title_cloud.html">
            
                <a href="as_title_cloud.html">
            
                    
                    Cloud和容器相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="cloud_杂记.html">
            
                <a href="cloud_杂记.html">
            
                    
                    云杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="container_当代容器读书笔记.html">
            
                <a href="container_当代容器读书笔记.html">
            
                    
                    当代容器读书笔记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="as_title_vdevice.html">
            
                <a href="as_title_vdevice.html">
            
                    
                    CPU和device虚拟化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="as_title_gvisor.html">
            
                <a href="as_title_gvisor.html">
            
                    
                    gvisor
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="golang_gvisor代码_KVM.html">
            
                <a href="golang_gvisor代码_KVM.html">
            
                    
                    gvisor KVM模式代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="golang_gvisor调试.html">
            
                <a href="golang_gvisor调试.html">
            
                    
                    gvisor调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="golang_gvisor_ptrace.html">
            
                <a href="golang_gvisor_ptrace.html">
            
                    
                    gvisor ptrace模式介绍(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="rust_vmm_brief.html">
            
                <a href="rust_vmm_brief.html">
            
                    
                    rust VMM(virtual machine monitor)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="rust_vmm_简介.html">
            
                <a href="rust_vmm_简介.html">
            
                    
                    rust-vmm简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="rust_firecracker_代码.html">
            
                <a href="rust_firecracker_代码.html">
            
                    
                    firecracker代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="rust_firecracker_使用.html">
            
                <a href="rust_firecracker_使用.html">
            
                    
                    firecracker使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="rust_cloud-hypervisor_代码.html">
            
                <a href="rust_cloud-hypervisor_代码.html">
            
                    
                    cloud hypervisor代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.5" data-path="rust_cloud-hypervisor_使用.html">
            
                <a href="rust_cloud-hypervisor_使用.html">
            
                    
                    cloud hypervisor使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.6" data-path="rust_cloud-hypervisor_问题与解决.html">
            
                <a href="rust_cloud-hypervisor_问题与解决.html">
            
                    
                    cloud hypervisor问题与解决
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="virtualization_virtio规范阅读笔记.html">
            
                <a href="virtualization_virtio规范阅读笔记.html">
            
                    
                    virtio规范阅读笔记.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="qemu_ovs_虚拟化环境.html">
            
                <a href="qemu_ovs_虚拟化环境.html">
            
                    
                    qemu OVS 虚拟化环境准备
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="qemu使用.html">
            
                <a href="qemu使用.html">
            
                    
                    Qemu使用(old)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="as_title_networking.html">
            
                <a href="as_title_networking.html">
            
                    
                    计算机网络相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="networking_杂记1.html">
            
                <a href="networking_杂记1.html">
            
                    
                    networking杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="as_title_qemu_ovs.html">
            
                <a href="as_title_qemu_ovs.html">
            
                    
                    Qemu OVS和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="OVS_DPDK_编译运行.html">
            
                <a href="OVS_DPDK_编译运行.html">
            
                    
                    OVS-DPDK编译运行
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.2" data-path="OVS_架构和代码.html">
            
                <a href="OVS_架构和代码.html">
            
                    
                    OVS架构和代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.3" data-path="OVS_DPDK_performance_HXT_ARM_server.html">
            
                <a href="OVS_DPDK_performance_HXT_ARM_server.html">
            
                    
                    OVS-DPDK for ARM server 性能测试环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.4" data-path="DPDK_Mellanox.html">
            
                <a href="DPDK_Mellanox.html">
            
                    
                    DPDK Mellanox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.5" data-path="OVS_phy-vm-phy.html">
            
                <a href="OVS_phy-vm-phy.html">
            
                    
                    OVS PHY-VM-PHY
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.6" data-path="networking_网络虚拟化用例记录.html">
            
                <a href="networking_网络虚拟化用例记录.html">
            
                    
                    网络虚拟化用例记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.7" data-path="networking_网络虚拟化操作记录.html">
            
                <a href="networking_网络虚拟化操作记录.html">
            
                    
                    网络虚拟化操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="as_title_virtnet.html">
            
                <a href="as_title_virtnet.html">
            
                    
                    虚拟化网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.3.1" data-path="networking_tc_filter_连接veth和tap.html">
            
                <a href="networking_tc_filter_连接veth和tap.html">
            
                    
                    Connecting a veth device to tap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.2" data-path="networking_multicast_vxlan_flannel.html">
            
                <a href="networking_multicast_vxlan_flannel.html">
            
                    
                    multicast vxlan和flannel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.3" data-path="networking_virtio网络介绍.html">
            
                <a href="networking_virtio网络介绍.html">
            
                    
                    virtio网络介绍(网摘): vhost-net virtio-net vhost-user SRIOV
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.4" data-path="networking_virtualization_杂记.html">
            
                <a href="networking_virtualization_杂记.html">
            
                    
                    虚拟化网络杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.5" data-path="networking_linux虚拟网络接口.html">
            
                <a href="networking_linux虚拟网络接口.html">
            
                    
                    linux虚拟网络接口(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="as_title_arm_server.html">
            
                <a href="as_title_arm_server.html">
            
                    
                    ARM server
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="arm_server_杂记.html">
            
                <a href="arm_server_杂记.html">
            
                    
                    Arm server 杂记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="as_title_embedded.html">
            
                <a href="as_title_embedded.html">
            
                    
                    嵌入式系统开发调试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="embedded_debugging.html">
            
                <a href="embedded_debugging.html">
            
                    
                    嵌入式调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="uboot_杂记.html">
            
                <a href="uboot_杂记.html">
            
                    
                    uboot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="buildroot_杂记.html">
            
                <a href="buildroot_杂记.html">
            
                    
                    buildroot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="toolchain_升级gcc问题解决.html">
            
                <a href="toolchain_升级gcc问题解决.html">
            
                    
                    升级GCC7.3问题解决
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="kernel_异常打印分析实例.html">
            
                <a href="kernel_异常打印分析实例.html">
            
                    
                    kernel bug异常打印分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="as_title_linuxdaily.html">
            
                <a href="as_title_linuxdaily.html">
            
                    
                    Linux工程实践
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="linux_日常使用.html">
            
                <a href="linux_日常使用.html">
            
                    
                    日常linux使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="git_日常使用.html">
            
                <a href="git_日常使用.html">
            
                    
                    日常git使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="向kernel提交补丁.html">
            
                <a href="向kernel提交补丁.html">
            
                    
                    向kernel提交补丁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="linux_ssh_relay.html">
            
                <a href="linux_ssh_relay.html">
            
                    
                    ssh relay
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="gitlab_ci.html">
            
                <a href="gitlab_ci.html">
            
                    
                    gitlab CI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="docker_操作记录.html">
            
                <a href="docker_操作记录.html">
            
                    
                    docker操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="centos_操作记录.html">
            
                <a href="centos_操作记录.html">
            
                    
                    centos操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="as_title_golang.html">
            
                <a href="as_title_golang.html">
            
                    
                    Golang
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="as_title_golang1.html">
            
                <a href="as_title_golang1.html">
            
                    
                    入门
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1.1" data-path="golang_语法基础.html">
            
                <a href="golang_语法基础.html">
            
                    
                    Golang 语法基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.2" data-path="golang_json性能.html">
            
                <a href="golang_json性能.html">
            
                    
                    Golang json性能比较
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="golang_原理.html">
            
                <a href="golang_原理.html">
            
                    
                    Golang 原理相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.1" data-path="golang_interface原理.html">
            
                <a href="golang_interface原理.html">
            
                    
                    Golang interface原理(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.2" data-path="golang_内存分配.html">
            
                <a href="golang_内存分配.html">
            
                    
                    Golang 内存分配(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="golang_标准库.html">
            
                <a href="golang_标准库.html">
            
                    
                    Golang 标准库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="golang_我的反射代码.html">
            
                <a href="golang_我的反射代码.html">
            
                    
                    Golang 我的反射代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="golang_问答.html">
            
                <a href="golang_问答.html">
            
                    
                    Golang 问答
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="golang_高效go.html">
            
                <a href="golang_高效go.html">
            
                    
                    Golang 高效go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="golang_进阶.html">
            
                <a href="golang_进阶.html">
            
                    
                    Golang 进阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="as_title_golang2.html">
            
                <a href="as_title_golang2.html">
            
                    
                    Golang 杂记
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.8.1" data-path="golang_杂记1.html">
            
                <a href="golang_杂记1.html">
            
                    
                    Golang 杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.2" data-path="golang_杂记2.html">
            
                <a href="golang_杂记2.html">
            
                    
                    Golang 杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.3" data-path="golang_杂记3.html">
            
                <a href="golang_杂记3.html">
            
                    
                    Golang 杂记3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.4" data-path="golang_lib选型.html">
            
                <a href="golang_lib选型.html">
            
                    
                    Golang lib选型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.5" data-path="golang_mod_proxy.html">
            
                <a href="golang_mod_proxy.html">
            
                    
                    go mod和go proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.6" data-path="golang_汇编_arm64.html">
            
                <a href="golang_汇编_arm64.html">
            
                    
                    Golang 汇编语法和arm64小知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.7" data-path="golang_cgo_swig.html">
            
                <a href="golang_cgo_swig.html">
            
                    
                    go调用c可以用swig
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="as_title_golang3.html">
            
                <a href="as_title_golang3.html">
            
                    
                    Golang 环境和工具链生成
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.9.1" data-path="golang_toolchain_ppc.html">
            
                <a href="golang_toolchain_ppc.html">
            
                    
                    go tools增加ppc32支持.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.2" data-path="golang_toolchain_compile_gccgo.html">
            
                <a href="golang_toolchain_compile_gccgo.html">
            
                    
                    编译gccgo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3" data-path="golang_go_on_mips.html">
            
                <a href="golang_go_on_mips.html">
            
                    
                    go on mips boards(not so updated)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.9.3.1" data-path="golang_go_on_mips_part1.html">
            
                <a href="golang_go_on_mips_part1.html">
            
                    
                    part 1: cross compile go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.2" data-path="golang_go_on_mips_part2.html">
            
                <a href="golang_go_on_mips_part2.html">
            
                    
                    part 2: build native go compiler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.3" data-path="golang_go_on_mips_part3.html">
            
                <a href="golang_go_on_mips_part3.html">
            
                    
                    part 3: gccgo experiments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.4" data-path="golang_go_on_mips_part4.html">
            
                <a href="golang_go_on_mips_part4.html">
            
                    
                    part 4: Golang json performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.5" data-path="golang_gentoo_on_mips_board_and_build_go.html">
            
                <a href="golang_gentoo_on_mips_board_and_build_go.html">
            
                    
                    Gentoo on mips board and build go
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.10" data-path="as_title_golang4.html">
            
                <a href="as_title_golang4.html">
            
                    
                    微服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.10.1" data-path="golang_micro.html">
            
                <a href="golang_micro.html">
            
                    
                    go-micro和micro
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.2" data-path="golang_微服务概念.html">
            
                <a href="golang_微服务概念.html">
            
                    
                    微服务概念
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.11" data-path="as_title_golang5.html">
            
                <a href="as_title_golang5.html">
            
                    
                    解释器和编解码
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.11.1" data-path="golang_yeagi.html">
            
                <a href="golang_yeagi.html">
            
                    
                    解释器yeagi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.2" data-path="golang_tengo.html">
            
                <a href="golang_tengo.html">
            
                    
                    解释器tengo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.3" data-path="golang_govaluate.html">
            
                <a href="golang_govaluate.html">
            
                    
                    解释器govaluate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.4" data-path="golang_encoding_gotiny.html">
            
                <a href="golang_encoding_gotiny.html">
            
                    
                    gotiny编解码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.5" data-path="golang_abs.html">
            
                <a href="golang_abs.html">
            
                    
                    解释器abs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.12" data-path="as_title_golang6.html">
            
                <a href="as_title_golang6.html">
            
                    
                    调试和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.10.12.1" data-path="golang_调试记录.html">
            
                <a href="golang_调试记录.html">
            
                    
                    Golang 调试记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12.2" data-path="golang_topid性能优化.html">
            
                <a href="golang_topid性能优化.html">
            
                    
                    Golang topid性能优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12.3" data-path="golang_gshell性能调试.html">
            
                <a href="golang_gshell性能调试.html">
            
                    
                    Golang gshell性能调试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.13" data-path="as_title_golang7.html">
            
                <a href="as_title_golang7.html">
            
                    
                    网络和消息中间件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.13.1" data-path="golang_zmq.html">
            
                <a href="golang_zmq.html">
            
                    
                    消息中间件基本概念和zero mq
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.2" data-path="golang_mango.html">
            
                <a href="golang_mango.html">
            
                    
                    消息中间件mango
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.3" data-path="golang_libp2p.html">
            
                <a href="golang_libp2p.html">
            
                    
                    Golang p2p网络
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="as_title_rust.html">
            
                <a href="as_title_rust.html">
            
                    
                    Rust
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="rust_入门_brief.html">
            
                <a href="rust_入门_brief.html">
            
                    
                    Rust 入门系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1.1" data-path="rust_books.html">
            
                <a href="rust_books.html">
            
                    
                    Rust reference books
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.2" data-path="rust_入门1.html">
            
                <a href="rust_入门1.html">
            
                    
                    Rust 安装和基础语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.3" data-path="rust_入门2.html">
            
                <a href="rust_入门2.html">
            
                    
                    Rust 泛型和内存所有权
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.4" data-path="rust_入门3.html">
            
                <a href="rust_入门3.html">
            
                    
                    Rust 闭包 容器 迭代器 生成器 线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.5" data-path="rust_工程构建.html">
            
                <a href="rust_工程构建.html">
            
                    
                    Rust 工程构建
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="rust_coding_brief.html">
            
                <a href="rust_coding_brief.html">
            
                    
                    Rust 代码积累
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.2.1" data-path="rust_序列化.html">
            
                <a href="rust_序列化.html">
            
                    
                    Rust 序列化原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.2" data-path="rust_知识点积累.html">
            
                <a href="rust_知识点积累.html">
            
                    
                    Rust 知识点更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.3" data-path="rust_adaptiveservice.html">
            
                <a href="rust_adaptiveservice.html">
            
                    
                    rust版本的adaptiveservice探索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.4" data-path="rust_常用设施.html">
            
                <a href="rust_常用设施.html">
            
                    
                    Rust 常用设施
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.5" data-path="rust_代码小段.html">
            
                <a href="rust_代码小段.html">
            
                    
                    Rust 代码小段
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="others.html">
            
                <a href="others.html">
            
                    
                    其他
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.3.1" data-path="rust_mdbook_使用.html">
            
                <a href="rust_mdbook_使用.html">
            
                    
                    Rust 使用mdbook
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="as_title_scripts.html">
            
                <a href="as_title_scripts.html">
            
                    
                    脚本
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="shell_变量.html">
            
                <a href="shell_变量.html">
            
                    
                    shell变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="shell_基础篇.html">
            
                <a href="shell_基础篇.html">
            
                    
                    shell命令和脚本记录-基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="shell_高级篇.html">
            
                <a href="shell_高级篇.html">
            
                    
                    shell命令和脚本记录-高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="shell_脚本片段.html">
            
                <a href="shell_脚本片段.html">
            
                    
                    shell脚本片段
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="python_记录.html">
            
                <a href="python_记录.html">
            
                    
                    python记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="lua_记录.html">
            
                <a href="lua_记录.html">
            
                    
                    lua记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="shell_rds脚本阅读.html">
            
                <a href="shell_rds脚本阅读.html">
            
                    
                    RDS脚本阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="Project_Euler.html">
            
                <a href="Project_Euler.html">
            
                    
                    Project Euler
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="as_title_app.html">
            
                <a href="as_title_app.html">
            
                    
                    应用相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="app_sysbench代码分析.html">
            
                <a href="app_sysbench代码分析.html">
            
                    
                    sysbench代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="as_title_cos.html">
            
                <a href="as_title_cos.html">
            
                    
                    C和Operating System
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="system_libc_part1.html">
            
                <a href="system_libc_part1.html">
            
                    
                    libc概览1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="system_libc_part2.html">
            
                <a href="system_libc_part2.html">
            
                    
                    libc概览2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3" data-path="system_libc_part3.html">
            
                <a href="system_libc_part3.html">
            
                    
                    libc概览3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.4" data-path="system_原理杂记.html">
            
                <a href="system_原理杂记.html">
            
                    
                    系统原理杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5" data-path="system_alpine.html">
            
                <a href="system_alpine.html">
            
                    
                    Alpine Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.6" data-path="system_进程间通信.html">
            
                <a href="system_进程间通信.html">
            
                    
                    进程间通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.7" data-path="system_特殊功能fd.html">
            
                <a href="system_特殊功能fd.html">
            
                    
                    eventfd timerfd signalfd和fd共享
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.8" data-path="c_automake_autoconf.html">
            
                <a href="c_automake_autoconf.html">
            
                    
                    automake autoconf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.9" data-path="makefile_原理和实践.html">
            
                <a href="makefile_原理和实践.html">
            
                    
                    makefile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.10" data-path="c_编程杂记高级篇.html">
            
                <a href="c_编程杂记高级篇.html">
            
                    
                    C编程杂记高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.11" data-path="c_编程杂记基础篇.html">
            
                <a href="c_编程杂记基础篇.html">
            
                    
                    C编程杂记基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.12" data-path="c_networking_socket高阶用法.html">
            
                <a href="c_networking_socket高阶用法.html">
            
                    
                    网络编程: Advanced Socket Topics(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.13" data-path="c_protobuf介绍.html">
            
                <a href="c_protobuf介绍.html">
            
                    
                    序列化: protobuf介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.14" data-path="c_进程间通信_共享文件和共享内存.html">
            
                <a href="c_进程间通信_共享文件和共享内存.html">
            
                    
                    进程间通信: 共享文件和共享内存(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.15" data-path="c_pthread_condition和mutex.html">
            
                <a href="c_pthread_condition和mutex.html">
            
                    
                    并发 任务 事件 和锁.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.16" data-path="kernel_user_space_howto.html">
            
                <a href="kernel_user_space_howto.html">
            
                    
                    kernel space和user space交互(网摘, linux2.6)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.17" data-path="CentOS_系统性能优化配置.html">
            
                <a href="CentOS_系统性能优化配置.html">
            
                    
                    CentOS 性能优化系统配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="as_title_driver.html">
            
                <a href="as_title_driver.html">
            
                    
                    内核 设备和驱动相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="platform_device_driver.html">
            
                <a href="platform_device_driver.html">
            
                    
                    平台驱动杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="device_driver_杂记.html">
            
                <a href="device_driver_杂记.html">
            
                    
                    驱动调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="device_localbus_16bit读写.html">
            
                <a href="device_localbus_16bit读写.html">
            
                    
                    CPLD做8bit到16bit转换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4" data-path="as_title_driver1.html">
            
                <a href="as_title_driver1.html">
            
                    
                    nand
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.4.1" data-path="device_driver_octeon_nand.html">
            
                <a href="device_driver_octeon_nand.html">
            
                    
                    octeon nand flash驱动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4.2" data-path="device_driver_nand概率写失败问题分析.html">
            
                <a href="device_driver_nand概率写失败问题分析.html">
            
                    
                    Nand flash概率写失败问题分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.5" data-path="octeon_remote_pci.html">
            
                <a href="octeon_remote_pci.html">
            
                    
                    octeon remote-pci.c阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.6" data-path="Device_VFIO_notes.html">
            
                <a href="Device_VFIO_notes.html">
            
                    
                    VFIO简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7" data-path="as_title_driver2.html">
            
                <a href="as_title_driver2.html">
            
                    
                    智能网卡和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.7.1" data-path="smartNIC_智能网卡对比.html">
            
                <a href="smartNIC_智能网卡对比.html">
            
                    
                    智能网卡对比
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.2" data-path="octeon_pci_NIC.html">
            
                <a href="octeon_pci_NIC.html">
            
                    
                    octeon PCI NIC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.3" data-path="as_title_driver3.html">
            
                <a href="as_title_driver3.html">
            
                    
                    octeon liquidIO
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.7.3.1" data-path="smartNIC_liquidIO_代码阅读app篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读app篇.html">
            
                    
                    PCI-NIC 代码阅读 --app篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.3.2" data-path="smartNIC_liquidIO_代码阅读api篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读api篇.html">
            
                    
                    PCI-NIC 代码阅读 --api篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.3.3" data-path="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇之结构体
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.3.4" data-path="smartNIC_liquidIO_代码阅读driver篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.3.5" data-path="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                    
                    PCI-NIC 代码阅读 --真NIC篇
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.7.4" data-path="networking_dpdk使用_2014.html">
            
                <a href="networking_dpdk使用_2014.html">
            
                    
                    DPDK使用(2014)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.8" data-path="device_nvme要点介绍.html">
            
                <a href="device_nvme要点介绍.html">
            
                    
                    nvme要点介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="as_title_cpu.html">
            
                <a href="as_title_cpu.html">
            
                    
                    CPU Arch相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="cache_CPU和cache一致性原理.html">
            
                <a href="cache_CPU和cache一致性原理.html">
            
                    
                    CPU和cache一致性原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="as_title_cpu1.html">
            
                <a href="as_title_cpu1.html">
            
                    
                    ARM64
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.2.1" data-path="CPU_ARM64_thunder_overview.html">
            
                <a href="CPU_ARM64_thunder_overview.html">
            
                    
                    thunder 概览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.2" data-path="CPU_ARM64_thunder_开发板操作记录.html">
            
                <a href="CPU_ARM64_thunder_开发板操作记录.html">
            
                    
                    thunder 开发板操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.3" data-path="CPU_ARM64_thunder_bdk.html">
            
                <a href="CPU_ARM64_thunder_bdk.html">
            
                    
                    thunder BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.4" data-path="CPU_ARM64_thunder_efi_rtc.html">
            
                <a href="CPU_ARM64_thunder_efi_rtc.html">
            
                    
                    thunder RTC时间和efi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.5" data-path="CPU_ARM64_thunder_uefi_fdt.html">
            
                <a href="CPU_ARM64_thunder_uefi_fdt.html">
            
                    
                    thunder uefi和fdt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.6" data-path="CPU_ARM64_thunder_atf.html">
            
                <a href="CPU_ARM64_thunder_atf.html">
            
                    
                    thunder atf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.7" data-path="CPU_ARM64_thunder_kernel_boot.html">
            
                <a href="CPU_ARM64_thunder_kernel_boot.html">
            
                    
                    thunder kernel启动打印流程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="as_title_cpu2.html">
            
                <a href="as_title_cpu2.html">
            
                    
                    PPC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.3.1" data-path="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                <a href="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                    
                    PPC启动多核linux: 流程和内存映射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3.2" data-path="CPU_PPC_kernel升级记录.html">
            
                <a href="CPU_PPC_kernel升级记录.html">
            
                    
                    PPC kernel升级记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.4" data-path="as_title_cpu3.html">
            
                <a href="as_title_cpu3.html">
            
                    
                    MIPS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.4.1" data-path="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                <a href="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                    
                    octeon 地址空间和寄存器访问
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.2" data-path="CPU_MIPS_octeon操作记录.html">
            
                <a href="CPU_MIPS_octeon操作记录.html">
            
                    
                    octeon 操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.3" data-path="CPU_MIPS_octeon_包处理性能.html">
            
                <a href="CPU_MIPS_octeon_包处理性能.html">
            
                    
                    octeon 系列处理器包处理性能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.4" data-path="CPU_MIPS_octeon_ddr调试记录.html">
            
                <a href="CPU_MIPS_octeon_ddr调试记录.html">
            
                    
                    octeon DDR调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.5" data-path="CPU_MIPS_octeon_BDK.html">
            
                <a href="CPU_MIPS_octeon_BDK.html">
            
                    
                    octeon CN78xx BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.6" data-path="kernel_增加ECC中断.html">
            
                <a href="kernel_增加ECC中断.html">
            
                    
                    octeon 增加ECC中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.7" data-path="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                <a href="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                    
                    octeon hw-ddr2代码走读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.8" data-path="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                <a href="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                    
                    octeon reboot调试和DDR中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.9" data-path="CPU_MIPS_octeon中断.html">
            
                <a href="CPU_MIPS_octeon中断.html">
            
                    
                    octeon 中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.10" data-path="CPU_MIPS_octeon原子操作.html">
            
                <a href="CPU_MIPS_octeon原子操作.html">
            
                    
                    octeon 原子操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.11" data-path="CPU_MIPS_octeon网口代码分析.html">
            
                <a href="CPU_MIPS_octeon网口代码分析.html">
            
                    
                    octeon 网口代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Golang 调试记录</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#&#x547D;&#x4EE4;&#x8BB0;&#x5F55;"><b>1. </b>&#x547D;&#x4EE4;&#x8BB0;&#x5F55;</a></li><li><span class="title-icon "></span><a href="#dlv&#x4F7F;&#x7528;"><b>2. </b>dlv&#x4F7F;&#x7528;</a></li><ul><li><span class="title-icon "></span><a href="#dlv-headless&#x6A21;&#x5F0F;"><b>2.1. </b>dlv headless&#x6A21;&#x5F0F;</a></li><li><span class="title-icon "></span><a href="#&#x4FEE;&#x6539;&#x5185;&#x5B58;"><b>2.2. </b>&#x4FEE;&#x6539;&#x5185;&#x5B58;</a></li><li><span class="title-icon "></span><a href="#&#x6253;&#x5370;unsafepointer"><b>2.3. </b>&#x6253;&#x5370;unsafe.Pointer</a></li></ul><li><span class="title-icon "></span><a href="#&#x8BB0;&#x5F55;debug-gvisor"><b>3. </b>&#x8BB0;&#x5F55;debug gvisor</a></li><ul><li><span class="title-icon "></span><a href="#&#x8BBE;&#x7F6E;package&#x7EA7;&#x522B;&#x7684;&#x65AD;&#x70B9;"><b>3.1. </b>&#x8BBE;&#x7F6E;package&#x7EA7;&#x522B;&#x7684;&#x65AD;&#x70B9;</a></li><li><span class="title-icon "></span><a href="#gvisor-syscall&#x8C03;&#x8BD5;"><b>3.2. </b>gvisor syscall&#x8C03;&#x8BD5;</a></li><li><span class="title-icon "></span><a href="#&#x4E3A;&#x4EC0;&#x4E48;date--s&#x547D;&#x4EE4;&#x8FD4;&#x56DE;operation-not-permitted"><b>3.3. </b>&#x4E3A;&#x4EC0;&#x4E48;date -s&#x547D;&#x4EE4;&#x8FD4;&#x56DE;Operation not permitted</a></li></ul><li><span class="title-icon "></span><a href="#&#x8BB0;&#x5F55;debug-adaptiveservice"><b>4. </b>&#x8BB0;&#x5F55;debug adaptiveservice</a></li><li><span class="title-icon "></span><a href="#&#x8BB0;&#x5F55;tengo-debug"><b>5. </b>&#x8BB0;&#x5F55;tengo debug</a></li><li><span class="title-icon "></span><a href="#go-prompt-&#x6027;&#x80FD;&#x95EE;&#x9898;&#x8C03;&#x67E5;"><b>6. </b>go-prompt &#x6027;&#x80FD;&#x95EE;&#x9898;&#x8C03;&#x67E5;</a></li><li><span class="title-icon "></span><a href="#&#x5185;&#x5B58;&#x8FD8;&#x7ED9;os"><b>7. </b>&#x5185;&#x5B58;&#x8FD8;&#x7ED9;OS</a></li><ul><li><span class="title-icon "></span><a href="#madvfree&#x548C;madvdontneed"><b>7.1. </b>MADV_FREE&#x548C;MADV_DONTNEED</a></li><li><span class="title-icon "></span><a href="#gogc&#x6BD4;&#x4F8B;"><b>7.2. </b>GOGC&#x6BD4;&#x4F8B;</a></li></ul><li><span class="title-icon "></span><a href="#topid&#x7533;&#x8BF7;&#x5185;&#x5B58;&#x9519;&#x8BEF;"><b>8. </b>topid&#x7533;&#x8BF7;&#x5185;&#x5B58;&#x9519;&#x8BEF;</a></li><ul><li><span class="title-icon "></span><a href="#&#x80CC;&#x666F;"><b>8.1. </b>&#x80CC;&#x666F;</a></li><ul><li><span class="title-icon "></span><a href="#&#x9519;&#x8BEF;1"><b>8.1.1. </b>&#x9519;&#x8BEF;1</a></li><li><span class="title-icon "></span><a href="#&#x9519;&#x8BEF;2"><b>8.1.2. </b>&#x9519;&#x8BEF;2</a></li><li><span class="title-icon "></span><a href="#&#x9519;&#x8BEF;3"><b>8.1.3. </b>&#x9519;&#x8BEF;3</a></li></ul><li><span class="title-icon "></span><a href="#&#x8C03;&#x67E5;"><b>8.2. </b>&#x8C03;&#x67E5;</a></li><ul><li><span class="title-icon "></span><a href="#&#x91CA;&#x653E;&#x5185;&#x5B58;&#x540E;&#x8FD0;&#x884C;-&#x91CD;&#x542F;&#x540E;&#x8FD0;&#x884C;----nok"><b>8.2.1. </b>&#x91CA;&#x653E;&#x5185;&#x5B58;&#x540E;&#x8FD0;&#x884C; &#x91CD;&#x542F;&#x540E;&#x8FD0;&#x884C; -- nok</a></li><li><span class="title-icon "></span><a href="#golang&#x7248;&#x672C;113&#x6362;&#x5230;116&#x95EE;&#x9898;&#x4F9D;&#x65E7;"><b>8.2.2. </b>golang&#x7248;&#x672C;1.13&#x6362;&#x5230;1.16&#x95EE;&#x9898;&#x4F9D;&#x65E7;</a></li><li><span class="title-icon "></span><a href="#&#x548C;&#x7248;&#x672C;&#x76F8;&#x5173;"><b>8.2.3. </b>&#x548C;&#x7248;&#x672C;&#x76F8;&#x5173;?</a></li></ul></ul><li><span class="title-icon "></span><a href="#gshell-server&#x5185;&#x5B58;&#x8C03;&#x8BD5;"><b>9. </b>gshell server&#x5185;&#x5B58;&#x8C03;&#x8BD5;</a></li><ul><li><span class="title-icon "></span><a href="#&#x95EE;&#x9898;&#x573A;&#x666F;"><b>9.1. </b>&#x95EE;&#x9898;&#x573A;&#x666F;</a></li><ul><li><span class="title-icon "></span><a href="#&#x64CD;&#x505A;1-&#x9996;&#x6B21;&#x8FD0;&#x884C;50&#x4E2A;govmtest"><b>9.1.1. </b>&#x64CD;&#x505A;1: &#x9996;&#x6B21;&#x8FD0;&#x884C;50&#x4E2A;govm_test</a></li><li><span class="title-icon "></span><a href="#&#x64CD;&#x505A;2-50&#x4E2A;govmtest&#x540C;&#x65F6;restart"><b>9.1.2. </b>&#x64CD;&#x505A;2: 50&#x4E2A;govm_test&#x540C;&#x65F6;restart</a></li></ul><li><span class="title-icon "></span><a href="#&#x7B2C;&#x4E00;&#x6B21;&#x5185;&#x5B58;&#x4F18;&#x5316;"><b>9.2. </b>&#x7B2C;&#x4E00;&#x6B21;&#x5185;&#x5B58;&#x4F18;&#x5316;</a></li><ul><li><span class="title-icon "></span><a href="#&#x64CD;&#x505A;1-&#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;"><b>9.2.1. </b>&#x64CD;&#x505A;1 &#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;</a></li><li><span class="title-icon "></span><a href="#&#x64CD;&#x505A;2-&#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;"><b>9.2.2. </b>&#x64CD;&#x505A;2 &#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;</a></li><li><span class="title-icon "></span><a href="#&#x8FDB;&#x4E00;&#x6B65;&#x4F18;&#x5316;&#x601D;&#x8DEF;"><b>9.2.3. </b>&#x8FDB;&#x4E00;&#x6B65;&#x4F18;&#x5316;&#x601D;&#x8DEF;</a></li></ul></ul><li><span class="title-icon "></span><a href="#goroutine&#x6CC4;&#x6F0F;&#x8C03;&#x8BD5;"><b>10. </b>goroutine&#x6CC4;&#x6F0F;&#x8C03;&#x8BD5;</a></li><li><span class="title-icon "></span><a href="#vscode-debug&#x6A21;&#x5F0F;"><b>11. </b>vscode debug&#x6A21;&#x5F0F;</a></li><ul><li><span class="title-icon "></span><a href="#&#x4E3A;&#x4F55;dlv&#x603B;&#x662F;&#x63D0;&#x793A;could-not-load-source"><b>11.1. </b>&#x4E3A;&#x4F55;dlv&#x603B;&#x662F;&#x63D0;&#x793A;Could not load source</a></li><li><span class="title-icon "></span><a href="#&#x6B63;&#x5E38;&#x7684;dlv&#x4F7F;&#x7528;"><b>11.2. </b>&#x6B63;&#x5E38;&#x7684;dlv&#x4F7F;&#x7528;</a></li></ul><li><span class="title-icon "></span><a href="#&#x4E00;&#x6B21;&#x7A7A;&#x6307;&#x9488;&#x8BBF;&#x95EE;&#x7684;panic"><b>12. </b>&#x4E00;&#x6B21;&#x7A7A;&#x6307;&#x9488;&#x8BBF;&#x95EE;&#x7684;panic</a></li><ul><li><span class="title-icon "></span><a href="#&#x8C03;&#x7528;&#x6808;&#x89E3;&#x6790;&#x548C;&#x53C2;&#x6570;&#x89E3;&#x8BFB;"><b>12.1. </b>&#x8C03;&#x7528;&#x6808;&#x89E3;&#x6790;&#x548C;&#x53C2;&#x6570;&#x89E3;&#x8BFB;</a></li><ul><li><span class="title-icon "></span><a href="#&#x5207;&#x7247;-&#x5B57;&#x7B26;&#x4E32;-&#x548C;int"><b>12.1.1. </b>&#x5207;&#x7247;, &#x5B57;&#x7B26;&#x4E32;, &#x548C;int</a></li><li><span class="title-icon "></span><a href="#&#x53D8;&#x957F;&#x53C2;&#x6570;"><b>12.1.2. </b>&#x53D8;&#x957F;&#x53C2;&#x6570;</a></li><li><span class="title-icon "></span><a href="#interface"><b>12.1.3. </b>interface</a></li><li><span class="title-icon "></span><a href="#&#x65B9;&#x6CD5;"><b>12.1.4. </b>&#x65B9;&#x6CD5;</a></li><li><span class="title-icon "></span><a href="#&#x53C2;&#x6570;packing"><b>12.1.5. </b>&#x53C2;&#x6570;packing</a></li><li><span class="title-icon "></span><a href="#&#x8FD4;&#x56DE;&#x503C;"><b>12.1.6. </b>&#x8FD4;&#x56DE;&#x503C;</a></li><li><span class="title-icon "></span><a href="#&#x7ED3;&#x6784;&#x4F53;"><b>12.1.7. </b>&#x7ED3;&#x6784;&#x4F53;</a></li><li><span class="title-icon "></span><a href="#&#x6307;&#x9488;"><b>12.1.8. </b>&#x6307;&#x9488;</a></li></ul></ul><li><span class="title-icon "></span><a href="#slice&#x7684;make&#x548C;append&#x6027;&#x80FD;"><b>13. </b>slice&#x7684;make&#x548C;append&#x6027;&#x80FD;</a></li><ul><li><span class="title-icon "></span><a href="#&#x53EA;&#x58F0;&#x660E;&#x5207;&#x7247;----400-nsop"><b>13.1. </b>&#x53EA;&#x58F0;&#x660E;&#x5207;&#x7247; -- 400 ns/op</a></li><li><span class="title-icon "></span><a href="#make-1----444-nsop"><b>13.2. </b>make 1 -- 444 ns/op</a></li><li><span class="title-icon "></span><a href="#make-10----604-nsop"><b>13.3. </b>make 10 -- 604 ns/op</a></li><li><span class="title-icon "></span><a href="#make-100----2527-nsop"><b>13.4. </b>make 100 -- 2527 ns/op</a></li><li><span class="title-icon "></span><a href="#&#x66F4;&#x6B63;"><b>13.5. </b>&#x66F4;&#x6B63;</a></li><li><span class="title-icon "></span><a href="#&#x66F4;&#x6B63;&#x540E;&#x6700;&#x7EC8;&#x7248;"><b>13.6. </b>&#x66F4;&#x6B63;&#x540E;&#x6700;&#x7EC8;&#x7248;</a></li><li><span class="title-icon "></span><a href="#&#x6700;&#x7EC8;&#x7248;&#x7ED3;&#x679C;"><b>13.7. </b>&#x6700;&#x7EC8;&#x7248;&#x7ED3;&#x679C;</a></li><li><span class="title-icon "></span><a href="#&#x7ED3;&#x8BBA;"><b>13.8. </b>&#x7ED3;&#x8BBA;</a></li></ul><li><span class="title-icon "></span><a href="#pidinfo&#x8C03;&#x8BD5;"><b>14. </b>pidinfo&#x8C03;&#x8BD5;</a></li><ul><li><span class="title-icon "></span><a href="#&#x6267;&#x884C;&#x6D4B;&#x8BD5;"><b>14.1. </b>&#x6267;&#x884C;&#x6D4B;&#x8BD5;</a></li><ul><li><span class="title-icon "></span><a href="#in-docker"><b>14.1.1. </b>in docker</a></li><li><span class="title-icon "></span><a href="#out-docker"><b>14.1.2. </b>out docker</a></li></ul><li><span class="title-icon "></span><a href="#&#x6253;&#x5F00;cpu&#x5206;&#x6790;"><b>14.2. </b>&#x6253;&#x5F00;cpu&#x5206;&#x6790;</a></li><ul><li><span class="title-icon "></span><a href="#host&#x4E0A;profile-cpu"><b>14.2.1. </b>host&#x4E0A;profile CPU</a></li><li><span class="title-icon "></span><a href="#pprof&#x7684;refine&#x529F;&#x80FD;"><b>14.2.2. </b>pprof&#x7684;refine&#x529F;&#x80FD;</a></li></ul></ul><li><span class="title-icon "></span><a href="#toomanytimer&#x8C03;&#x8BD5;"><b>15. </b>tooManyTimer&#x8C03;&#x8BD5;</a></li><ul><li><span class="title-icon "></span><a href="#&#x547D;&#x4EE4;&#x8BB0;&#x5F55;_1"><b>15.1. </b>&#x547D;&#x4EE4;&#x8BB0;&#x5F55;</a></li><li><span class="title-icon "></span><a href="#go-tool-pprof&#x7684;http&#x65B9;&#x5F0F;"><b>15.2. </b>go tool pprof&#x7684;http&#x65B9;&#x5F0F;</a></li><ul><li><span class="title-icon "></span><a href="#&#x5185;&#x5B58;"><b>15.2.1. </b>&#x5185;&#x5B58;</a></li><li><span class="title-icon "></span><a href="#goroutine&#x7684;&#x60C5;&#x51B5;"><b>15.2.2. </b>goroutine&#x7684;&#x60C5;&#x51B5;</a></li><li><span class="title-icon "></span><a href="#&#x540C;&#x6B65;-&#x9501;-&#x963B;&#x585E;&#x5E94;&#x8BE5;&#x4E5F;&#x652F;&#x6301;-&#x5F85;&#x8C03;&#x67E5;"><b>15.2.3. </b>&#x540C;&#x6B65; &#x9501; &#x963B;&#x585E;&#x5E94;&#x8BE5;&#x4E5F;&#x652F;&#x6301;, &#x5F85;&#x8C03;&#x67E5;</a></li><li><span class="title-icon "></span><a href="#trace"><b>15.2.4. </b>trace</a></li><li><span class="title-icon "></span><a href="#&#x4EE3;&#x7801;&#x6253;&#x5F00;trace"><b>15.2.5. </b>&#x4EE3;&#x7801;&#x6253;&#x5F00;trace</a></li><li><span class="title-icon "></span><a href="#&#x4E0D;&#x540C;&#x7684;profile&#x6587;&#x4EF6;&#x5BF9;&#x6BD4;"><b>15.2.6. </b>&#x4E0D;&#x540C;&#x7684;profile&#x6587;&#x4EF6;&#x5BF9;&#x6BD4;</a></li></ul><li><span class="title-icon "></span><a href="#&#x4F20;&#x7EDF;&#x706B;&#x7130;&#x56FE;&#x65B9;&#x5F0F;"><b>15.3. </b>&#x4F20;&#x7EDF;&#x706B;&#x7130;&#x56FE;&#x65B9;&#x5F0F;</a></li><li><span class="title-icon "></span><a href="#&#x4EE3;&#x7801;&#x91CC;&#x52A0;&#x8C03;&#x8BD5;&#x652F;&#x6301;"><b>15.4. </b>&#x4EE3;&#x7801;&#x91CC;&#x52A0;&#x8C03;&#x8BD5;&#x652F;&#x6301;</a></li><ul><li><span class="title-icon "></span><a href="#&#x547D;&#x4EE4;&#x884C;&#x8C03;&#x8BD5;-runtimepprof"><b>15.4.1. </b>&#x547D;&#x4EE4;&#x884C;&#x8C03;&#x8BD5;: &quot;runtime/pprof&quot;</a></li><li><span class="title-icon "></span><a href="#&#x7F51;&#x9875;&#x8C03;&#x8BD5;-nethttppprof"><b>15.4.2. </b>&#x7F51;&#x9875;&#x8C03;&#x8BD5;: &quot;net/http/pprof&quot;</a></li></ul><li><span class="title-icon "></span><a href="#&#x4F7F;&#x7528;debug&#x7F51;&#x9875;"><b>15.5. </b>&#x4F7F;&#x7528;debug&#x7F51;&#x9875;</a></li><li><span class="title-icon "></span><a href="#&#x4F7F;&#x7528;go-tool-pprof"><b>15.6. </b>&#x4F7F;&#x7528;go tool pprof</a></li><ul><li><span class="title-icon "></span><a href="#top&#x547D;&#x4EE4;"><b>15.6.1. </b>top&#x547D;&#x4EE4;</a></li><li><span class="title-icon "></span><a href="#list&#x547D;&#x4EE4;"><b>15.6.2. </b>list&#x547D;&#x4EE4;</a></li><li><span class="title-icon "></span><a href="#svg&#x547D;&#x4EE4;&#x548C;perf&#x706B;&#x7130;&#x56FE;&#x5BF9;&#x6BD4;"><b>15.6.3. </b>svg&#x547D;&#x4EE4;&#x548C;perf&#x706B;&#x7130;&#x56FE;&#x5BF9;&#x6BD4;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;-handleonu-&#x4E3B;&#x8981;&#x662F;select"><b>15.7. </b>&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;: handleOnu, &#x4E3B;&#x8981;&#x662F;select</a></li><ul><li><span class="title-icon "></span><a href="#pprof-svg"><b>15.7.1. </b>pprof svg</a></li><li><span class="title-icon "></span><a href="#perf-&#x706B;&#x7130;&#x56FE;"><b>15.7.2. </b>perf &#x706B;&#x7130;&#x56FE;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;-timerproc"><b>15.8. </b>&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;: timerproc</a></li><ul><li><span class="title-icon "></span><a href="#notetsleepg"><b>15.8.1. </b>notetsleepg</a></li><li><span class="title-icon "></span><a href="#&#x95EE;&#x9898;-futex&#x5524;&#x9192;&#x8DEF;&#x5F84;&#x662F;&#x5E72;&#x5565;&#x7528;&#x7684;"><b>15.8.2. </b>&#x95EE;&#x9898;: futex&#x5524;&#x9192;&#x8DEF;&#x5F84;&#x662F;&#x5E72;&#x5565;&#x7528;&#x7684;?</a></li></ul><li><span class="title-icon "></span><a href="#&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;sysmon"><b>15.9. </b>&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;:sysmon</a></li><li><span class="title-icon "></span><a href="#&#x7ED3;&#x8BBA;_1"><b>15.10. </b>&#x7ED3;&#x8BBA;</a></li></ul><li><span class="title-icon "></span><a href="#&#x6253;&#x5370;&#x8C03;&#x7528;&#x6808;"><b>16. </b>&#x6253;&#x5370;&#x8C03;&#x7528;&#x6808;</a></li><ul><li><span class="title-icon "></span><a href="#&#x4EE5;jsonload&#x4E3A;&#x4F8B;"><b>16.1. </b>&#x4EE5;json_load&#x4E3A;&#x4F8B;</a></li><li><span class="title-icon "></span><a href="#pstack&#x6253;&#x5370;&#x4E0D;&#x4E86;go&#x7684;&#x8C03;&#x7528;&#x6808;"><b>16.2. </b>pstack&#x6253;&#x5370;&#x4E0D;&#x4E86;go&#x7684;&#x8C03;&#x7528;&#x6808;</a></li><li><span class="title-icon "></span><a href="#&#x7528;-sigquit"><b>16.3. </b>&#x7528;-SIGQUIT</a></li><li><span class="title-icon "></span><a href="#&#x6CE8;&#x518C;&#x4FE1;&#x53F7;handler"><b>16.4. </b>&#x6CE8;&#x518C;&#x4FE1;&#x53F7;handler</a></li><li><span class="title-icon "></span><a href="#&#x7ED3;&#x679C;"><b>16.5. </b>&#x7ED3;&#x679C;</a></li><ul><li><span class="title-icon "></span><a href="#goroutine-0"><b>16.5.1. </b>goroutine 0</a></li><li><span class="title-icon "></span><a href="#goroutine-1"><b>16.5.2. </b>goroutine 1</a></li><li><span class="title-icon "></span><a href="#&#x7528;taskset--c-1&#x5F3A;&#x5236;&#x4E00;&#x4E2A;&#x6838;&#x8DD1;"><b>16.5.3. </b>&#x7528;taskset -c 1&#x5F3A;&#x5236;&#x4E00;&#x4E2A;&#x6838;&#x8DD1;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5982;&#x679C;&#x53EA;&#x6709;&#x4E24;&#x4E2A;goroutine-&#x4F46;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8D77;6&#x4E2A;&#x7EBF;&#x7A0B;&#x5462;"><b>16.6. </b>&#x5982;&#x679C;&#x53EA;&#x6709;&#x4E24;&#x4E2A;goroutine, &#x4F46;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8D77;6&#x4E2A;&#x7EBF;&#x7A0B;&#x5462;?</a></li></ul></ul></div><a href="#&#x547D;&#x4EE4;&#x8BB0;&#x5F55;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><ul>
<li><a href="#&#x547D;&#x4EE4;&#x8BB0;&#x5F55;">&#x547D;&#x4EE4;&#x8BB0;&#x5F55;</a></li>
<li><a href="#dlv&#x4F7F;&#x7528;">dlv&#x4F7F;&#x7528;</a><ul>
<li><a href="#dlv-headless&#x6A21;&#x5F0F;">dlv headless&#x6A21;&#x5F0F;</a></li>
<li><a href="#&#x4FEE;&#x6539;&#x5185;&#x5B58;">&#x4FEE;&#x6539;&#x5185;&#x5B58;</a></li>
<li><a href="#&#x6253;&#x5370;unsafepointer">&#x6253;&#x5370;unsafe.Pointer</a></li>
</ul>
</li>
<li><a href="#&#x8BB0;&#x5F55;debug-gvisor">&#x8BB0;&#x5F55;debug gvisor</a><ul>
<li><a href="#&#x8BBE;&#x7F6E;package&#x7EA7;&#x522B;&#x7684;&#x65AD;&#x70B9;">&#x8BBE;&#x7F6E;package&#x7EA7;&#x522B;&#x7684;&#x65AD;&#x70B9;</a></li>
<li><a href="#gvisor-syscall&#x8C03;&#x8BD5;">gvisor syscall&#x8C03;&#x8BD5;</a></li>
<li><a href="#&#x4E3A;&#x4EC0;&#x4E48;date--s&#x547D;&#x4EE4;&#x8FD4;&#x56DE;operation-not-permitted">&#x4E3A;&#x4EC0;&#x4E48;<code>date -s</code>&#x547D;&#x4EE4;&#x8FD4;&#x56DE;Operation not permitted</a></li>
</ul>
</li>
<li><a href="#&#x8BB0;&#x5F55;debug-adaptiveservice">&#x8BB0;&#x5F55;debug adaptiveservice</a></li>
<li><a href="#&#x8BB0;&#x5F55;tengo-debug">&#x8BB0;&#x5F55;tengo debug</a></li>
<li><a href="#go-prompt-&#x6027;&#x80FD;&#x95EE;&#x9898;&#x8C03;&#x67E5;">go-prompt &#x6027;&#x80FD;&#x95EE;&#x9898;&#x8C03;&#x67E5;</a></li>
<li><a href="#&#x5185;&#x5B58;&#x8FD8;&#x7ED9;os">&#x5185;&#x5B58;&#x8FD8;&#x7ED9;OS</a><ul>
<li><a href="#madv_free&#x548C;madv_dontneed">MADV_FREE&#x548C;MADV_DONTNEED</a></li>
<li><a href="#gogc&#x6BD4;&#x4F8B;">GOGC&#x6BD4;&#x4F8B;</a></li>
</ul>
</li>
<li><a href="#topid&#x7533;&#x8BF7;&#x5185;&#x5B58;&#x9519;&#x8BEF;">topid&#x7533;&#x8BF7;&#x5185;&#x5B58;&#x9519;&#x8BEF;</a><ul>
<li><a href="#&#x80CC;&#x666F;">&#x80CC;&#x666F;</a><ul>
<li><a href="#&#x9519;&#x8BEF;1">&#x9519;&#x8BEF;1</a></li>
<li><a href="#&#x9519;&#x8BEF;2">&#x9519;&#x8BEF;2</a></li>
<li><a href="#&#x9519;&#x8BEF;3">&#x9519;&#x8BEF;3</a></li>
</ul>
</li>
<li><a href="#&#x8C03;&#x67E5;">&#x8C03;&#x67E5;</a><ul>
<li><a href="#&#x91CA;&#x653E;&#x5185;&#x5B58;&#x540E;&#x8FD0;&#x884C;-&#x91CD;&#x542F;&#x540E;&#x8FD0;&#x884C;----nok">&#x91CA;&#x653E;&#x5185;&#x5B58;&#x540E;&#x8FD0;&#x884C; &#x91CD;&#x542F;&#x540E;&#x8FD0;&#x884C; -- nok</a></li>
<li><a href="#golang&#x7248;&#x672C;113&#x6362;&#x5230;116&#x95EE;&#x9898;&#x4F9D;&#x65E7;">golang&#x7248;&#x672C;1.13&#x6362;&#x5230;1.16&#x95EE;&#x9898;&#x4F9D;&#x65E7;</a></li>
<li><a href="#&#x548C;&#x7248;&#x672C;&#x76F8;&#x5173;">&#x548C;&#x7248;&#x672C;&#x76F8;&#x5173;?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#gshell-server&#x5185;&#x5B58;&#x8C03;&#x8BD5;">gshell server&#x5185;&#x5B58;&#x8C03;&#x8BD5;</a><ul>
<li><a href="#&#x95EE;&#x9898;&#x573A;&#x666F;">&#x95EE;&#x9898;&#x573A;&#x666F;</a><ul>
<li><a href="#&#x64CD;&#x505A;1-&#x9996;&#x6B21;&#x8FD0;&#x884C;50&#x4E2A;govm_test">&#x64CD;&#x505A;1: &#x9996;&#x6B21;&#x8FD0;&#x884C;50&#x4E2A;govm_test</a></li>
<li><a href="#&#x64CD;&#x505A;2-50&#x4E2A;govm_test&#x540C;&#x65F6;restart">&#x64CD;&#x505A;2: 50&#x4E2A;govm_test&#x540C;&#x65F6;restart</a></li>
</ul>
</li>
<li><a href="#&#x7B2C;&#x4E00;&#x6B21;&#x5185;&#x5B58;&#x4F18;&#x5316;">&#x7B2C;&#x4E00;&#x6B21;&#x5185;&#x5B58;&#x4F18;&#x5316;</a><ul>
<li><a href="#&#x64CD;&#x505A;1-&#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;">&#x64CD;&#x505A;1 &#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;</a></li>
<li><a href="#&#x64CD;&#x505A;2-&#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;">&#x64CD;&#x505A;2 &#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;</a></li>
<li><a href="#&#x8FDB;&#x4E00;&#x6B65;&#x4F18;&#x5316;&#x601D;&#x8DEF;">&#x8FDB;&#x4E00;&#x6B65;&#x4F18;&#x5316;&#x601D;&#x8DEF;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#goroutine&#x6CC4;&#x6F0F;&#x8C03;&#x8BD5;">goroutine&#x6CC4;&#x6F0F;&#x8C03;&#x8BD5;</a></li>
<li><a href="#vscode-debug&#x6A21;&#x5F0F;">vscode debug&#x6A21;&#x5F0F;</a><ul>
<li><a href="#&#x4E3A;&#x4F55;dlv&#x603B;&#x662F;&#x63D0;&#x793A;could-not-load-source">&#x4E3A;&#x4F55;dlv&#x603B;&#x662F;&#x63D0;&#x793A;Could not load source</a></li>
<li><a href="#&#x6B63;&#x5E38;&#x7684;dlv&#x4F7F;&#x7528;">&#x6B63;&#x5E38;&#x7684;dlv&#x4F7F;&#x7528;</a></li>
</ul>
</li>
<li><a href="#&#x4E00;&#x6B21;&#x7A7A;&#x6307;&#x9488;&#x8BBF;&#x95EE;&#x7684;panic">&#x4E00;&#x6B21;&#x7A7A;&#x6307;&#x9488;&#x8BBF;&#x95EE;&#x7684;panic</a><ul>
<li><a href="#&#x8C03;&#x7528;&#x6808;&#x89E3;&#x6790;&#x548C;&#x53C2;&#x6570;&#x89E3;&#x8BFB;">&#x8C03;&#x7528;&#x6808;&#x89E3;&#x6790;&#x548C;&#x53C2;&#x6570;&#x89E3;&#x8BFB;</a><ul>
<li><a href="#&#x5207;&#x7247;-&#x5B57;&#x7B26;&#x4E32;-&#x548C;int">&#x5207;&#x7247;, &#x5B57;&#x7B26;&#x4E32;, &#x548C;int</a></li>
<li><a href="#&#x53D8;&#x957F;&#x53C2;&#x6570;">&#x53D8;&#x957F;&#x53C2;&#x6570;</a></li>
<li><a href="#interface">interface</a></li>
<li><a href="#&#x65B9;&#x6CD5;">&#x65B9;&#x6CD5;</a></li>
<li><a href="#&#x53C2;&#x6570;packing">&#x53C2;&#x6570;packing</a></li>
<li><a href="#&#x8FD4;&#x56DE;&#x503C;">&#x8FD4;&#x56DE;&#x503C;</a></li>
<li><a href="#&#x7ED3;&#x6784;&#x4F53;">&#x7ED3;&#x6784;&#x4F53;</a></li>
<li><a href="#&#x6307;&#x9488;">&#x6307;&#x9488;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#slice&#x7684;make&#x548C;append&#x6027;&#x80FD;">slice&#x7684;make&#x548C;append&#x6027;&#x80FD;</a><ul>
<li><a href="#&#x53EA;&#x58F0;&#x660E;&#x5207;&#x7247;----400-nsop">&#x53EA;&#x58F0;&#x660E;&#x5207;&#x7247; -- 400 ns/op</a></li>
<li><a href="#make-1----444-nsop">make 1 -- 444 ns/op</a></li>
<li><a href="#make-10----604-nsop">make 10 -- 604 ns/op</a></li>
<li><a href="#make-100----2527-nsop">make 100 -- 2527 ns/op</a></li>
<li><a href="#&#x66F4;&#x6B63;">&#x66F4;&#x6B63;</a></li>
<li><a href="#&#x66F4;&#x6B63;&#x540E;&#x6700;&#x7EC8;&#x7248;">&#x66F4;&#x6B63;&#x540E;&#x6700;&#x7EC8;&#x7248;</a></li>
<li><a href="#&#x6700;&#x7EC8;&#x7248;&#x7ED3;&#x679C;">&#x6700;&#x7EC8;&#x7248;&#x7ED3;&#x679C;</a></li>
<li><a href="#&#x7ED3;&#x8BBA;">&#x7ED3;&#x8BBA;</a></li>
</ul>
</li>
<li><a href="#pidinfo&#x8C03;&#x8BD5;">pidinfo&#x8C03;&#x8BD5;</a><ul>
<li><a href="#&#x6267;&#x884C;&#x6D4B;&#x8BD5;">&#x6267;&#x884C;&#x6D4B;&#x8BD5;</a><ul>
<li><a href="#in-docker">in docker</a></li>
<li><a href="#out-docker">out docker</a></li>
</ul>
</li>
<li><a href="#&#x6253;&#x5F00;cpu&#x5206;&#x6790;">&#x6253;&#x5F00;cpu&#x5206;&#x6790;</a><ul>
<li><a href="#host&#x4E0A;profile-cpu">host&#x4E0A;profile CPU</a></li>
<li><a href="#pprof&#x7684;refine&#x529F;&#x80FD;">pprof&#x7684;refine&#x529F;&#x80FD;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#toomanytimer&#x8C03;&#x8BD5;">tooManyTimer&#x8C03;&#x8BD5;</a><ul>
<li><a href="#&#x547D;&#x4EE4;&#x8BB0;&#x5F55;-1">&#x547D;&#x4EE4;&#x8BB0;&#x5F55;</a></li>
<li><a href="#go-tool-pprof&#x7684;http&#x65B9;&#x5F0F;">go tool pprof&#x7684;http&#x65B9;&#x5F0F;</a><ul>
<li><a href="#&#x5185;&#x5B58;">&#x5185;&#x5B58;</a></li>
<li><a href="#goroutine&#x7684;&#x60C5;&#x51B5;">goroutine&#x7684;&#x60C5;&#x51B5;</a></li>
<li><a href="#&#x540C;&#x6B65;-&#x9501;-&#x963B;&#x585E;&#x5E94;&#x8BE5;&#x4E5F;&#x652F;&#x6301;-&#x5F85;&#x8C03;&#x67E5;">&#x540C;&#x6B65; &#x9501; &#x963B;&#x585E;&#x5E94;&#x8BE5;&#x4E5F;&#x652F;&#x6301;, &#x5F85;&#x8C03;&#x67E5;</a></li>
<li><a href="#trace">trace</a></li>
<li><a href="#&#x4EE3;&#x7801;&#x6253;&#x5F00;trace">&#x4EE3;&#x7801;&#x6253;&#x5F00;trace</a></li>
<li><a href="#&#x4E0D;&#x540C;&#x7684;profile&#x6587;&#x4EF6;&#x5BF9;&#x6BD4;">&#x4E0D;&#x540C;&#x7684;profile&#x6587;&#x4EF6;&#x5BF9;&#x6BD4;</a></li>
</ul>
</li>
<li><a href="#&#x4F20;&#x7EDF;&#x706B;&#x7130;&#x56FE;&#x65B9;&#x5F0F;">&#x4F20;&#x7EDF;&#x706B;&#x7130;&#x56FE;&#x65B9;&#x5F0F;</a></li>
<li><a href="#&#x4EE3;&#x7801;&#x91CC;&#x52A0;&#x8C03;&#x8BD5;&#x652F;&#x6301;">&#x4EE3;&#x7801;&#x91CC;&#x52A0;&#x8C03;&#x8BD5;&#x652F;&#x6301;</a><ul>
<li><a href="#&#x547D;&#x4EE4;&#x884C;&#x8C03;&#x8BD5;-runtimepprof">&#x547D;&#x4EE4;&#x884C;&#x8C03;&#x8BD5;: &quot;runtime/pprof&quot;</a></li>
<li><a href="#&#x7F51;&#x9875;&#x8C03;&#x8BD5;-nethttppprof">&#x7F51;&#x9875;&#x8C03;&#x8BD5;: &quot;net/http/pprof&quot;</a></li>
</ul>
</li>
<li><a href="#&#x4F7F;&#x7528;debug&#x7F51;&#x9875;">&#x4F7F;&#x7528;debug&#x7F51;&#x9875;</a></li>
<li><a href="#&#x4F7F;&#x7528;go-tool-pprof">&#x4F7F;&#x7528;go tool pprof</a><ul>
<li><a href="#top&#x547D;&#x4EE4;">top&#x547D;&#x4EE4;</a></li>
<li><a href="#list&#x547D;&#x4EE4;">list&#x547D;&#x4EE4;</a></li>
<li><a href="#svg&#x547D;&#x4EE4;&#x548C;perf&#x706B;&#x7130;&#x56FE;&#x5BF9;&#x6BD4;">svg&#x547D;&#x4EE4;&#x548C;perf&#x706B;&#x7130;&#x56FE;&#x5BF9;&#x6BD4;</a></li>
</ul>
</li>
<li><a href="#&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;-handleonu-&#x4E3B;&#x8981;&#x662F;select">&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;: handleOnu, &#x4E3B;&#x8981;&#x662F;select</a><ul>
<li><a href="#pprof-svg">pprof svg</a></li>
<li><a href="#perf-&#x706B;&#x7130;&#x56FE;">perf &#x706B;&#x7130;&#x56FE;</a></li>
</ul>
</li>
<li><a href="#&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;-timerproc">&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;: timerproc</a><ul>
<li><a href="#notetsleepg">notetsleepg</a></li>
<li><a href="#&#x95EE;&#x9898;-futex&#x5524;&#x9192;&#x8DEF;&#x5F84;&#x662F;&#x5E72;&#x5565;&#x7528;&#x7684;">&#x95EE;&#x9898;: futex&#x5524;&#x9192;&#x8DEF;&#x5F84;&#x662F;&#x5E72;&#x5565;&#x7528;&#x7684;?</a></li>
</ul>
</li>
<li><a href="#&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;sysmon">&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;:sysmon</a></li>
<li><a href="#&#x7ED3;&#x8BBA;-1">&#x7ED3;&#x8BBA;</a></li>
</ul>
</li>
<li><a href="#&#x6253;&#x5370;&#x8C03;&#x7528;&#x6808;">&#x6253;&#x5370;&#x8C03;&#x7528;&#x6808;</a><ul>
<li><a href="#&#x4EE5;json_load&#x4E3A;&#x4F8B;">&#x4EE5;json_load&#x4E3A;&#x4F8B;</a></li>
<li><a href="#pstack&#x6253;&#x5370;&#x4E0D;&#x4E86;go&#x7684;&#x8C03;&#x7528;&#x6808;">pstack&#x6253;&#x5370;&#x4E0D;&#x4E86;go&#x7684;&#x8C03;&#x7528;&#x6808;</a></li>
<li><a href="#&#x7528;-sigquit">&#x7528;-SIGQUIT</a></li>
<li><a href="#&#x6CE8;&#x518C;&#x4FE1;&#x53F7;handler">&#x6CE8;&#x518C;&#x4FE1;&#x53F7;handler</a></li>
<li><a href="#&#x7ED3;&#x679C;">&#x7ED3;&#x679C;</a><ul>
<li><a href="#goroutine-0">goroutine 0</a></li>
<li><a href="#goroutine-1">goroutine 1</a></li>
<li><a href="#&#x7528;taskset--c-1&#x5F3A;&#x5236;&#x4E00;&#x4E2A;&#x6838;&#x8DD1;">&#x7528;taskset -c 1&#x5F3A;&#x5236;&#x4E00;&#x4E2A;&#x6838;&#x8DD1;</a></li>
</ul>
</li>
<li><a href="#&#x5982;&#x679C;&#x53EA;&#x6709;&#x4E24;&#x4E2A;goroutine-&#x4F46;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8D77;6&#x4E2A;&#x7EBF;&#x7A0B;&#x5462;">&#x5982;&#x679C;&#x53EA;&#x6709;&#x4E24;&#x4E2A;goroutine, &#x4F46;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8D77;6&#x4E2A;&#x7EBF;&#x7A0B;&#x5462;?</a></li>
</ul>
</li>
</ul>
<h1 id="&#x547D;&#x4EE4;&#x8BB0;&#x5F55;"><a name="&#x547D;&#x4EE4;&#x8BB0;&#x5F55;" class="anchor-navigation-ex-anchor" href="#&#x547D;&#x4EE4;&#x8BB0;&#x5F55;"><i class="fa fa-link" aria-hidden="true"></i></a>1. &#x547D;&#x4EE4;&#x8BB0;&#x5F55;</h1>
<pre class="language-"><code class="lang-sh"><span class="token comment"># &#x624B;&#x52A8;&#x8BBF;&#x95EE;&#x968F;&#x673A;debug&#x7AEF;&#x53E3;</span>
http://10.182.105.138:41259/debug/pprof
<span class="token comment"># pprof&#x751F;&#x6210;&#x5185;&#x5B58;&#x89C6;&#x56FE;&#x670D;&#x52A1;</span>
go tool pprof <span class="token parameter variable">-http</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0:8000 http://10.182.105.138:41259/debug/pprof/heap
<span class="token comment"># &#x8BBF;&#x95EE;&#x5185;&#x5B58;&#x89C6;&#x56FE;</span>
http://10.182.105.138:64321/ui/?si<span class="token operator">=</span>inuse_space

<span class="token comment"># debug gshell&#x5185;&#x5B58;&#x7533;&#x8BF7;&#x5BFC;&#x81F4;CPU 100%&#x7684;&#x95EE;&#x9898;.</span>
perf record <span class="token parameter variable">-g</span> <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">`</span>pidof gshell<span class="token variable">`</span></span> -- <span class="token function">sleep</span> <span class="token number">60</span>
perf script <span class="token operator">|</span> /repo/yingjieb/FlameGraph/stackcollapse-perf.pl <span class="token operator">|</span> /repo/yingjieb/FlameGraph/flamegraph.pl <span class="token operator">&gt;</span> gshell.svg

go tool pprof <span class="token parameter variable">-http</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0:8000 http://10.182.105.138:9998/debug/pprof/profile?seconds<span class="token operator">=</span><span class="token number">30</span>
&#x6700;&#x540E;&#x8BBF;&#x95EE; http://10.182.105.138:60080/ui/

go <span class="token builtin class-name">test</span> <span class="token parameter variable">-c</span> <span class="token parameter variable">-o</span> pidinfotest
./pidinfotest <span class="token parameter variable">-test.run</span> xxxxxx <span class="token parameter variable">-test.bench</span> BenchmarkP1InfoUpdate
./pidinfotest <span class="token parameter variable">-test.run</span> xxxxxx <span class="token parameter variable">-test.bench</span> <span class="token builtin class-name">.</span>  <span class="token parameter variable">-test.benchtime</span> 10s

go <span class="token builtin class-name">test</span> <span class="token parameter variable">-run</span> xxxxxx <span class="token parameter variable">-bench</span> BenchmarkP1InfoUpdate <span class="token parameter variable">-cpuprofile</span> cpuiter.out
go <span class="token builtin class-name">test</span> <span class="token parameter variable">-run</span> xxxxxx <span class="token parameter variable">-bench</span> BenchmarkMapInter <span class="token parameter variable">-cpuprofile</span> cpuiter.out
go <span class="token builtin class-name">test</span> <span class="token parameter variable">-run</span> xxxxxx <span class="token parameter variable">-bench</span> BenchmarkMapInter <span class="token parameter variable">-benchtime</span> 30s <span class="token parameter variable">-cpuprofile</span> cpuiter.out
go tool pprof <span class="token parameter variable">-http</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0:8000 cpuiter.out

go tool pprof <span class="token parameter variable">-http</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0:8000 <span class="token parameter variable">--base</span> cpuiter1.out cpuiter10.out
</code></pre>
<h1 id="dlv&#x4F7F;&#x7528;"><a name="dlv&#x4F7F;&#x7528;" class="anchor-navigation-ex-anchor" href="#dlv&#x4F7F;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>2. dlv&#x4F7F;&#x7528;</h1>
<h2 id="dlv-headless&#x6A21;&#x5F0F;"><a name="dlv-headless&#x6A21;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#dlv-headless&#x6A21;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. dlv headless&#x6A21;&#x5F0F;</h2>
<p>&#x542F;&#x52A8;dlv&#x8C03;&#x8BD5;server</p>
<pre class="language-"><code class="lang-sh">dlv <span class="token parameter variable">--headless</span> <span class="token builtin class-name">exec</span> bin/runsc -- <span class="token parameter variable">-h</span>
<span class="token comment">#&#x6210;&#x529F;&#x540E;&#x4F1A;&#x6253;&#x5370;</span>
API server listening at: <span class="token number">127.0</span>.0.1:37619
</code></pre>
<p>&#x4E5F;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;port:</p>
<pre class="language-"><code>dlv --headless -l 127.0.0.1:37619 exec bin/runsc -- -h
</code></pre><p>&#x5728;client&#x4FA7;:</p>
<pre class="language-"><code class="lang-sh">dlv connect <span class="token number">127.0</span>.0.1:37619
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> 
<span class="token comment"># &#x50CF;&#x6B63;&#x5E38;&#x4F7F;&#x7528;dlv&#x4E00;&#x6837;</span>
</code></pre>
<h2 id="&#x4FEE;&#x6539;&#x5185;&#x5B58;"><a name="&#x4FEE;&#x6539;&#x5185;&#x5B58;" class="anchor-navigation-ex-anchor" href="#&#x4FEE;&#x6539;&#x5185;&#x5B58;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. &#x4FEE;&#x6539;&#x5185;&#x5B58;</h2>
<p>&#x6BD4;&#x5982;&#x6211;&#x8981;&#x4FEE;&#x6539;&#x4E00;&#x4E2A;&#x5730;&#x5740;&#x7684;&#x5185;&#x5B58;</p>
<pre class="language-"><code class="lang-c"><span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> x <span class="token operator">-</span>fmt hex <span class="token operator">-</span>size <span class="token number">4</span> <span class="token number">0x7bf6c</span>
<span class="token number">0x7bf6c</span><span class="token operator">:</span>   <span class="token number">0x97ff9ee9</span>
<span class="token comment">//&#x4E5F;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x663E;&#x793A;</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> p <span class="token operator">%</span>x <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>uint32<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0x7bf6c</span><span class="token punctuation">)</span>

<span class="token comment">//&#x6539;&#x4E3A;0x17ff9ee8</span>
set <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>uint32<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0x7bf6c</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0x17ff9ee9</span>
</code></pre>
<p>&#x4FEE;&#x6539;&#x524D;:<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913090810.png" alt=""><br>&#x4FEE;&#x6539;&#x540E;:<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913090822.png" alt="">  </p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;, call&#x6307;&#x4EE4;&#x6362;&#x6210;&#x4E86;jmp&#x6307;&#x4EE4;</p>
<p>&#x53C2;&#x8003;: <a href="https://armconverter.com/" target="_blank">arm64&#x6307;&#x4EE4;&#x67E5;&#x770B;&#x5728;&#x7EBF;&#x5DE5;&#x5177;</a></p>
<h2 id="&#x6253;&#x5370;unsafepointer"><a name="&#x6253;&#x5370;unsafepointer" class="anchor-navigation-ex-anchor" href="#&#x6253;&#x5370;unsafepointer"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. &#x6253;&#x5370;unsafe.Pointer</h2>
<p>&#x6211;&#x5728;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x91CC;:
<code>func bluepillHandler(context unsafe.Pointer)</code>
&#x6211;&#x60F3;&#x6253;&#x5370;context</p>
<pre class="language-"><code class="lang-go"><span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> p context
unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token number">0x4000460e20</span><span class="token punctuation">)</span>
</code></pre>
<p>context&#x7C7B;&#x578B;&#x5B9E;&#x9645;&#x4E0A;&#x662F;<code>*arch.UContext64</code>, &#x4F46;&#x76F4;&#x63A5;p&#x4F1A;&#x62A5;&#x9519;:</p>
<pre class="language-"><code class="lang-go"><span class="token punctuation">(</span>dlv<span class="token punctuation">)</span>  p <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>arch<span class="token punctuation">.</span>UContext64<span class="token punctuation">)</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
Command failed<span class="token punctuation">:</span> can not convert <span class="token string">&quot;context&quot;</span> to <span class="token operator">*</span><span class="token keyword">struct</span> gvisor<span class="token punctuation">.</span>dev<span class="token operator">/</span>gvisor<span class="token operator">/</span>pkg<span class="token operator">/</span>sentry<span class="token operator">/</span>arch<span class="token punctuation">.</span>UContext64
</code></pre>
<p>&#x4F46;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;:</p>
<pre class="language-"><code class="lang-go"><span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> p <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>arch<span class="token punctuation">.</span>UContext64<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0x4000460e20</span><span class="token punctuation">)</span>
gvisor<span class="token punctuation">.</span>dev<span class="token operator">/</span>gvisor<span class="token operator">/</span>pkg<span class="token operator">/</span>sentry<span class="token operator">/</span>arch<span class="token punctuation">.</span>UContext64 <span class="token punctuation">{</span>
    Flags<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    Link<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    Stack<span class="token punctuation">:</span> gvisor<span class="token punctuation">.</span>dev<span class="token operator">/</span>gvisor<span class="token operator">/</span>pkg<span class="token operator">/</span>abi<span class="token operator">/</span>linux<span class="token punctuation">.</span>SignalStack <span class="token punctuation">{</span>Addr<span class="token punctuation">:</span> <span class="token number">274882469888</span><span class="token punctuation">,</span> Flags<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">:</span><span class="token number">64</span><span class="token punctuation">,</span> Size<span class="token punctuation">:</span> <span class="token number">32768</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    Sigset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    _pad<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">]</span><span class="token builtin">uint8</span> <span class="token punctuation">[</span><span class="token number">88</span><span class="token punctuation">,</span><span class="token number">245</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">...</span><span class="token operator">+</span><span class="token number">56</span> more<span class="token punctuation">]</span><span class="token punctuation">,</span>
    _pad2<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token builtin">uint8</span> <span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    MContext<span class="token punctuation">:</span> gvisor<span class="token punctuation">.</span>dev<span class="token operator">/</span>gvisor<span class="token operator">/</span>pkg<span class="token operator">/</span>sentry<span class="token operator">/</span>arch<span class="token punctuation">.</span>SignalContext64 <span class="token punctuation">{</span>
        FaultAddr<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        Regs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token builtin">uint64</span> <span class="token punctuation">[</span><span class="token number">274879089664</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">274878169088</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">274882992368</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">274879089664</span><span class="token punctuation">,</span><span class="token number">18446462873611930624</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1648372627</span><span class="token punctuation">,</span><span class="token number">815018159</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">274879438312</span><span class="token punctuation">,</span><span class="token number">274879438160</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">274879438648</span><span class="token punctuation">,</span><span class="token number">274879437192</span><span class="token punctuation">,</span><span class="token number">274882469888</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">274879436488</span><span class="token punctuation">,</span><span class="token number">25907712</span><span class="token punctuation">,</span><span class="token number">274882992224</span><span class="token punctuation">,</span><span class="token number">274879437992</span><span class="token punctuation">,</span><span class="token number">9805828</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        Sp<span class="token punctuation">:</span> <span class="token number">274879438000</span><span class="token punctuation">,</span>
        Pc<span class="token punctuation">:</span> <span class="token number">9815768</span><span class="token punctuation">,</span>
        Pstate<span class="token punctuation">:</span> <span class="token number">536875008</span><span class="token punctuation">,</span>
        _pad<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token builtin">uint8</span> <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        Fpsimd64<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token string">&quot;gvisor.dev/gvisor/pkg/sentry/arch.FpsimdContext&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0x4000460ff0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x8FD8;&#x53EF;&#x4EE5;16&#x8FDB;&#x5236;&#x663E;&#x793A;:</p>
<pre class="language-"><code class="lang-go">p <span class="token operator">%</span>x <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>arch<span class="token punctuation">.</span>UContext64<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0x4000460e20</span><span class="token punctuation">)</span>
</code></pre>
<h1 id="&#x8BB0;&#x5F55;debug-gvisor"><a name="&#x8BB0;&#x5F55;debug-gvisor" class="anchor-navigation-ex-anchor" href="#&#x8BB0;&#x5F55;debug-gvisor"><i class="fa fa-link" aria-hidden="true"></i></a>3. &#x8BB0;&#x5F55;debug gvisor</h1>
<h2 id="&#x8BBE;&#x7F6E;package&#x7EA7;&#x522B;&#x7684;&#x65AD;&#x70B9;"><a name="&#x8BBE;&#x7F6E;package&#x7EA7;&#x522B;&#x7684;&#x65AD;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x8BBE;&#x7F6E;package&#x7EA7;&#x522B;&#x7684;&#x65AD;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. &#x8BBE;&#x7F6E;package&#x7EA7;&#x522B;&#x7684;&#x65AD;&#x70B9;</h2>
<p>&#x6BD4;&#x5982;&#x8C03;&#x8BD5;gvisor, &#x8981;&#x7ED9;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x6253;&#x65AD;&#x70B9;:</p>
<pre class="language-"><code>package kernel
//@pkg/sentry/kernel/task_syscall.go
func (t *Task) executeSyscall(sysno uintptr, args arch.SyscallArguments) (rval uintptr, ctrl *SyscallControl, err error) {
    ...
}
</code></pre><p>&#x5728;dlv&#x91CC;: &#x65AD;&#x70B9;&#x7684;&#x683C;&#x5F0F;&#x662F;<code>b package.(type).func</code></p>
<pre class="language-"><code class="lang-go">b pkg<span class="token operator">/</span>sentry<span class="token operator">/</span>kernel<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>Task<span class="token punctuation">)</span><span class="token punctuation">.</span>executeSyscall
</code></pre>
<h2 id="gvisor-syscall&#x8C03;&#x8BD5;"><a name="gvisor-syscall&#x8C03;&#x8BD5;" class="anchor-navigation-ex-anchor" href="#gvisor-syscall&#x8C03;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. gvisor syscall&#x8C03;&#x8BD5;</h2>
<p>&#x5148;&#x7528;runsc&#x542F;&#x52A8;&#x4E00;&#x4E2A;docker container</p>
<pre class="language-"><code class="lang-sh"><span class="token function">docker</span> run <span class="token parameter variable">--cpus</span><span class="token operator">=</span><span class="token number">2</span> <span class="token parameter variable">-m</span> 2g <span class="token parameter variable">--rm</span> <span class="token parameter variable">--runtime</span><span class="token operator">=</span>runsc <span class="token parameter variable">-it</span> <span class="token parameter variable">--name</span><span class="token operator">=</span>test centos:7 <span class="token function">bash</span>
</code></pre>
<pre class="language-"><code class="lang-go"><span class="token comment">// &#x5148;&#x627E;&#x5230;runsc-sandbox&#x8FDB;&#x7A0B;pid</span>
<span class="token punctuation">.</span><span class="token operator">/</span>dlv attach <span class="token number">7014</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> b kernel<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>Task<span class="token punctuation">)</span><span class="token punctuation">.</span>executeSyscall
<span class="token comment">//&#x5728;container&#x91CC;&#x9762;&#x6572;&#x4E2A;&#x56DE;&#x8F66;&#x90FD;&#x4F1A;&#x89E6;&#x53D1;&#x65AD;&#x70B9;</span>
<span class="token comment">//next&#x6267;&#x884C;&#x51E0;&#x6B21;</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> p s<span class="token punctuation">.</span>Table
<span class="token comment">//&#x8BBE;&#x7F6E;print&#x547D;&#x4EE4;&#x663E;&#x793A;array&#x7684;&#x4E2A;&#x6570;, &#x7528;config -list&#x770B;&#x5177;&#x4F53;&#x5404;&#x9879;&#x7684;&#x503C;</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> config max<span class="token operator">-</span>array<span class="token operator">-</span>values <span class="token number">1000</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> next next next <span class="token operator">...</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> p sysno                                         
<span class="token number">1</span>                                                     
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> p s<span class="token punctuation">.</span>lookup<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>                                   
gvisor<span class="token punctuation">.</span>dev<span class="token operator">/</span>gvisor<span class="token operator">/</span>pkg<span class="token operator">/</span>sentry<span class="token operator">/</span>syscalls<span class="token operator">/</span>linux<span class="token operator">/</span>vfs2<span class="token punctuation">.</span>Write
</code></pre>
<p>&#x5BF9;&#x5E94;&#x4EE3;&#x7801;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>Task<span class="token punctuation">)</span> <span class="token function">executeSyscall</span><span class="token punctuation">(</span>sysno <span class="token builtin">uintptr</span><span class="token punctuation">,</span> args arch<span class="token punctuation">.</span>SyscallArguments<span class="token punctuation">)</span> <span class="token punctuation">(</span>rval <span class="token builtin">uintptr</span><span class="token punctuation">,</span> ctrl <span class="token operator">*</span>SyscallControl<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    s <span class="token operator">:=</span> t<span class="token punctuation">.</span><span class="token function">SyscallTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x89E3;&#x91CA;<code>p s.Table</code>&#x7684;&#x90E8;&#x5206;&#x7ED3;&#x679C;:</p>
<pre class="language-"><code class="lang-go"><span class="token number">20</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                                                               
        Name<span class="token punctuation">:</span> <span class="token string">&quot;writev&quot;</span><span class="token punctuation">,</span>                                             
        Fn<span class="token punctuation">:</span> gvisor<span class="token punctuation">.</span>dev<span class="token operator">/</span>gvisor<span class="token operator">/</span>pkg<span class="token operator">/</span>sentry<span class="token operator">/</span>syscalls<span class="token operator">/</span>linux<span class="token operator">/</span>vfs2<span class="token punctuation">.</span>Writev<span class="token punctuation">,</span>
        SupportLevel<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>                                            
        Note<span class="token punctuation">:</span> <span class="token string">&quot;Fully Supported.&quot;</span><span class="token punctuation">,</span>                                   
        URLs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token builtin">len</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">cap</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>            
<span class="token number">59</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                                                               
        Name<span class="token punctuation">:</span> <span class="token string">&quot;execve&quot;</span><span class="token punctuation">,</span>                                             
        Fn<span class="token punctuation">:</span> gvisor<span class="token punctuation">.</span>dev<span class="token operator">/</span>gvisor<span class="token operator">/</span>pkg<span class="token operator">/</span>sentry<span class="token operator">/</span>syscalls<span class="token operator">/</span>linux<span class="token operator">/</span>vfs2<span class="token punctuation">.</span>Execve<span class="token punctuation">,</span>
        SupportLevel<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>                                            
        Note<span class="token punctuation">:</span> <span class="token string">&quot;Fully Supported.&quot;</span><span class="token punctuation">,</span>                                   
        URLs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token builtin">len</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">cap</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                       
<span class="token number">41</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                                                               
        Name<span class="token punctuation">:</span> <span class="token string">&quot;socket&quot;</span><span class="token punctuation">,</span>                                             
        Fn<span class="token punctuation">:</span> gvisor<span class="token punctuation">.</span>dev<span class="token operator">/</span>gvisor<span class="token operator">/</span>pkg<span class="token operator">/</span>sentry<span class="token operator">/</span>syscalls<span class="token operator">/</span>linux<span class="token operator">/</span>vfs2<span class="token punctuation">.</span>Socket<span class="token punctuation">,</span>
        SupportLevel<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>                                            
        Note<span class="token punctuation">:</span> <span class="token string">&quot;Fully Supported.&quot;</span><span class="token punctuation">,</span>                                   
        URLs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token builtin">len</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">cap</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                       
<span class="token number">321</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                                                           
        Name<span class="token punctuation">:</span> <span class="token string">&quot;bpf&quot;</span><span class="token punctuation">,</span>                                             
        Fn<span class="token punctuation">:</span> gvisor<span class="token punctuation">.</span>dev<span class="token operator">/</span>gvisor<span class="token operator">/</span>pkg<span class="token operator">/</span>sentry<span class="token operator">/</span>syscalls<span class="token punctuation">.</span>CapError<span class="token punctuation">.</span>func1<span class="token punctuation">,</span>
        SupportLevel<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>                                         
        Note<span class="token punctuation">:</span> &quot;Returns \&quot;operation not permitted\&quot; <span class="token keyword">if</span> the process
        URLs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token builtin">len</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">cap</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                    
<span class="token number">9</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                                                              
        Name<span class="token punctuation">:</span> <span class="token string">&quot;mmap&quot;</span><span class="token punctuation">,</span>                                             
        Fn<span class="token punctuation">:</span> gvisor<span class="token punctuation">.</span>dev<span class="token operator">/</span>gvisor<span class="token operator">/</span>pkg<span class="token operator">/</span>sentry<span class="token operator">/</span>syscalls<span class="token operator">/</span>linux<span class="token operator">/</span>vfs2<span class="token punctuation">.</span>Mmap<span class="token punctuation">,</span>
        SupportLevel<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>                                          
        Note<span class="token punctuation">:</span> <span class="token string">&quot;Fully Supported.&quot;</span><span class="token punctuation">,</span>                                 
        URLs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token builtin">len</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">cap</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                     
<span class="token number">96</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                                                                
        Name<span class="token punctuation">:</span> <span class="token string">&quot;gettimeofday&quot;</span><span class="token punctuation">,</span>                                        
        Fn<span class="token punctuation">:</span> gvisor<span class="token punctuation">.</span>dev<span class="token operator">/</span>gvisor<span class="token operator">/</span>pkg<span class="token operator">/</span>sentry<span class="token operator">/</span>syscalls<span class="token operator">/</span>linux<span class="token punctuation">.</span>Gettimeofday<span class="token punctuation">,</span>
        SupportLevel<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>                                             
        Note<span class="token punctuation">:</span> <span class="token string">&quot;Fully Supported.&quot;</span><span class="token punctuation">,</span>                                    
        URLs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token builtin">len</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">cap</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                        
<span class="token number">227</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                                                               
        Name<span class="token punctuation">:</span> <span class="token string">&quot;clock_settime&quot;</span><span class="token punctuation">,</span>                                       
        Fn<span class="token punctuation">:</span> gvisor<span class="token punctuation">.</span>dev<span class="token operator">/</span>gvisor<span class="token operator">/</span>pkg<span class="token operator">/</span>sentry<span class="token operator">/</span>syscalls<span class="token operator">/</span>linux<span class="token punctuation">.</span>ClockSettime<span class="token punctuation">,</span>
        SupportLevel<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>                                             
        Note<span class="token punctuation">:</span> <span class="token string">&quot;Fully Supported.&quot;</span><span class="token punctuation">,</span>                                    
        URLs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token builtin">len</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">cap</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                        
<span class="token number">14</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                                                                 
        Name<span class="token punctuation">:</span> <span class="token string">&quot;rt_sigprocmask&quot;</span><span class="token punctuation">,</span>                                       
        Fn<span class="token punctuation">:</span> gvisor<span class="token punctuation">.</span>dev<span class="token operator">/</span>gvisor<span class="token operator">/</span>pkg<span class="token operator">/</span>sentry<span class="token operator">/</span>syscalls<span class="token operator">/</span>linux<span class="token punctuation">.</span>RtSigprocmask<span class="token punctuation">,</span>
        SupportLevel<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>                                              
        Note<span class="token punctuation">:</span> <span class="token string">&quot;Fully Supported.&quot;</span><span class="token punctuation">,</span>                                     
        URLs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token builtin">len</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">cap</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
<h2 id="&#x4E3A;&#x4EC0;&#x4E48;date--s&#x547D;&#x4EE4;&#x8FD4;&#x56DE;operation-not-permitted"><a name="&#x4E3A;&#x4EC0;&#x4E48;date--s&#x547D;&#x4EE4;&#x8FD4;&#x56DE;operation-not-permitted" class="anchor-navigation-ex-anchor" href="#&#x4E3A;&#x4EC0;&#x4E48;date--s&#x547D;&#x4EE4;&#x8FD4;&#x56DE;operation-not-permitted"><i class="fa fa-link" aria-hidden="true"></i></a>3.3. &#x4E3A;&#x4EC0;&#x4E48;date -s&#x547D;&#x4EE4;&#x8FD4;&#x56DE;Operation not permitted</h2>
<p>&#x9996;&#x5148;, <code>date -s</code>&#x8C03;&#x7528;&#x7684;&#x662F;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;<code>clock_settime()</code>, &#x7531;&#x4E0A;&#x9762;&#x7684;&#x8868;&#x5F97;&#x77E5;, gvisor&#x5BF9;&#x5E94;&#x7684;&#x51FD;&#x6570;&#x662F;<code>gvisor.dev/gvisor/pkg/sentry/syscalls/linux.ClockSettime</code>
&#x6253;&#x65AD;&#x70B9;&#x5230;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;, &#x7136;&#x540E;&#x5728;container&#x91CC;&#x6267;&#x884C;<code>date -s 12:00:00</code>, &#x5C31;&#x4F1A;&#x89E6;&#x53D1;&#x65AD;&#x70B9;:</p>
<pre class="language-"><code>&gt; gvisor.dev/gvisor/pkg/sentry/syscalls/linux.ClockSettime() pkg/sentry/syscalls/linux/sys_time.go:160 (hits goroutine(600):1 total:1) (PC: 0xa140c0)                                     
Warning: debugging optimized function                                                        
(dlv) bt                                                                                     
0  0x0000000000a140c0 in gvisor.dev/gvisor/pkg/sentry/syscalls/linux.ClockSettime            
   at pkg/sentry/syscalls/linux/sys_time.go:160                                              
1  0x000000000096b776 in gvisor.dev/gvisor/pkg/sentry/kernel.(*Task).executeSyscall          
   at pkg/sentry/kernel/task_syscall.go:103                                                  
2  0x000000000096c2ed in gvisor.dev/gvisor/pkg/sentry/kernel.(*Task).doSyscallInvoke         
   at pkg/sentry/kernel/task_syscall.go:238                                                  
3  0x000000000096bfa5 in gvisor.dev/gvisor/pkg/sentry/kernel.(*Task).doSyscallEnter          
   at pkg/sentry/kernel/task_syscall.go:198                                                  
4  0x000000000096bcda in gvisor.dev/gvisor/pkg/sentry/kernel.(*Task).doSyscall               
   at pkg/sentry/kernel/task_syscall.go:173                                                  
5  0x0000000000960c45 in gvisor.dev/gvisor/pkg/sentry/kernel.(*runApp).execute               
   at pkg/sentry/kernel/task_run.go:254                                                      
6  0x000000000095f78c in gvisor.dev/gvisor/pkg/sentry/kernel.(*Task).run                     
   at pkg/sentry/kernel/task_run.go:95                                                       
7  0x000000000096a2ca in gvisor.dev/gvisor/pkg/sentry/kernel.(*Task).Start&#xB7;dwrap&#xB7;230         
   at pkg/sentry/kernel/task_start.go:339                                                    
8  0x0000000000469321 in runtime.goexit
</code></pre><p>&#x800C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;<code>linuxerr.EPERM</code></p>
<pre class="language-"><code class="lang-go"><span class="token comment">// ClockSettime implements linux syscall clock_settime(2).</span>
<span class="token keyword">func</span> <span class="token function">ClockSettime</span><span class="token punctuation">(</span><span class="token operator">*</span>kernel<span class="token punctuation">.</span>Task<span class="token punctuation">,</span> arch<span class="token punctuation">.</span>SyscallArguments<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">uintptr</span><span class="token punctuation">,</span> <span class="token operator">*</span>kernel<span class="token punctuation">.</span>SyscallControl<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> linuxerr<span class="token punctuation">.</span>EPERM
<span class="token punctuation">}</span>
</code></pre>
<h1 id="&#x8BB0;&#x5F55;debug-adaptiveservice"><a name="&#x8BB0;&#x5F55;debug-adaptiveservice" class="anchor-navigation-ex-anchor" href="#&#x8BB0;&#x5F55;debug-adaptiveservice"><i class="fa fa-link" aria-hidden="true"></i></a>4. &#x8BB0;&#x5F55;debug adaptiveservice</h1>
<pre class="language-"><code class="lang-sh"><span class="token comment"># &#x6CE8;&#x610F;&#x8981;&#x7528;./binary&#x7684;&#x5F62;&#x5F0F;</span>
<span class="token comment"># &#x7ED9;binary&#x4F20;&#x53C2;&#x6570;&#x7528;--</span>
dlv <span class="token builtin class-name">exec</span> ./echo -- <span class="token parameter variable">-c</span> <span class="token parameter variable">-cmd</span> <span class="token function">timeout</span> <span class="token parameter variable">-d</span>

<span class="token comment"># &#x65AD;&#x70B9;</span>
b main.main
b <span class="token punctuation">(</span>*timeouter<span class="token punctuation">)</span>.SetTimeout
</code></pre>
<h1 id="&#x8BB0;&#x5F55;tengo-debug"><a name="&#x8BB0;&#x5F55;tengo-debug" class="anchor-navigation-ex-anchor" href="#&#x8BB0;&#x5F55;tengo-debug"><i class="fa fa-link" aria-hidden="true"></i></a>5. &#x8BB0;&#x5F55;tengo debug</h1>
<pre class="language-"><code class="lang-sh"><span class="token comment"># dlv exec&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;, &#x53EF;&#x4EE5;&#x5E26;&#x53C2;&#x6570;</span>
dlv <span class="token builtin class-name">exec</span> bin/gshell example/govm_test.gsh
<span class="token comment"># &#x7A0B;&#x5E8F;&#x505C;&#x5728;&#x6700;&#x5F00;&#x59CB;&#x9636;&#x6BB5;</span>

<span class="token comment"># &#x8BBE;&#x65AD;&#x70B9;</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> b SourcePos
Breakpoint <span class="token number">1</span> <span class="token builtin class-name">set</span> at 0x52670f <span class="token keyword">for</span> github.com/d5/tengo/v2.<span class="token punctuation">(</span>*CompiledFunction<span class="token punctuation">)</span>.SourcePos<span class="token punctuation">(</span><span class="token punctuation">)</span> /repo/yingjieb/github/godevsig/tengo/objects.go:609

<span class="token comment"># continue, &#x7A0B;&#x5E8F;&#x505C;&#x5728;&#x65AD;&#x70B9;</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> c

<span class="token comment"># &#x5F00;&#x59CB;debug, bt, p&#x7B49;&#x5E38;&#x7528;gdb&#x547D;&#x4EE4;&#x662F;&#x4E00;&#x6837;&#x7684;</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> l
<span class="token operator">&gt;</span> github.com/d5/tengo/v2.<span class="token punctuation">(</span>*CompiledFunction<span class="token punctuation">)</span>.SourcePos<span class="token punctuation">(</span><span class="token punctuation">)</span> /repo/yingjieb/github/godevsig/tengo/objects.go:610 <span class="token punctuation">(</span>PC: 0x52671d<span class="token punctuation">)</span>
Warning: debugging optimized <span class="token keyword">function</span>
   <span class="token number">605</span>:         <span class="token builtin class-name">return</span> <span class="token boolean">false</span>
   <span class="token number">606</span>: <span class="token punctuation">}</span>
   <span class="token number">607</span>:
   <span class="token number">608</span>: // SourcePos returns the <span class="token builtin class-name">source</span> position of the instruction at ip.
   <span class="token number">609</span>: func <span class="token punctuation">(</span>o *CompiledFunction<span class="token punctuation">)</span> SourcePos<span class="token punctuation">(</span>ip int<span class="token punctuation">)</span> parser.Pos <span class="token punctuation">{</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">610</span>:         <span class="token keyword">for</span> <span class="token function">ip</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
   <span class="token number">611</span>:                 <span class="token keyword">if</span> p, ok :<span class="token operator">=</span> o.SourceMap<span class="token punctuation">[</span>ip<span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
   <span class="token number">612</span>:                         <span class="token builtin class-name">return</span> p
   <span class="token number">613</span>:                 <span class="token punctuation">}</span>
   <span class="token number">614</span>:                 ip--
   <span class="token number">615</span>:         <span class="token punctuation">}</span>

<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> p o
*github.com/d5/tengo/v2.CompiledFunction <span class="token punctuation">{</span>
        ObjectImpl: github.com/d5/tengo/v2.ObjectImpl <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        Instructions: <span class="token punctuation">[</span><span class="token punctuation">]</span>uint8 len: <span class="token number">43</span>, cap: <span class="token number">64</span>, <span class="token punctuation">[</span><span class="token number">22,0</span>,3,0,0,2,18,0,0,8,20,1,0,2,34,33,0,0,6,0,0,6,0,0,6,0,0,6,0,0,6,20,5,0,2,30,0,20,0,0,2,21,0<span class="token punctuation">]</span>,
        NumLocals: <span class="token number">0</span>,
        NumParameters: <span class="token number">0</span>,
        VarArgs: false,
        SourceMap: map<span class="token punctuation">[</span>int<span class="token punctuation">]</span>github.com/d5/tengo/v2/parser.Pos nil,
        Free: <span class="token punctuation">[</span><span class="token punctuation">]</span>*github.com/d5/tengo/v2.ObjectPtr len: <span class="token number">1</span>, cap: <span class="token number">1</span>, <span class="token punctuation">[</span>
                *<span class="token punctuation">(</span>*<span class="token string">&quot;github.com/d5/tengo/v2.ObjectPtr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>0xc00000e938<span class="token punctuation">)</span>,
        <span class="token punctuation">]</span>,<span class="token punctuation">}</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> p <span class="token function">ip</span>
<span class="token number">32</span>

<span class="token comment"># &#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x4EFB;&#x610F;&#x51FD;&#x6570;</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> call FormatInstructions<span class="token punctuation">(</span>o.Instructions, <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> github.com/d5/tengo/v2.<span class="token punctuation">(</span>*CompiledFunction<span class="token punctuation">)</span>.SourcePos<span class="token punctuation">(</span><span class="token punctuation">)</span> /repo/yingjieb/github/godevsig/tengo/objects.go:610 <span class="token punctuation">(</span>PC: 0x52671d<span class="token punctuation">)</span>
Warning: debugging optimized <span class="token keyword">function</span>
Values returned:
        ~r2: <span class="token punctuation">[</span><span class="token punctuation">]</span>string len: <span class="token number">18</span>, cap: <span class="token number">32</span>, <span class="token punctuation">[</span>
                <span class="token string">&quot;0000 GETG    3    &quot;</span>,
                <span class="token string">&quot;0003 CONST   2    &quot;</span>,
                <span class="token string">&quot;0006 INDEX  &quot;</span>,
                <span class="token string">&quot;0007 CONST   8    &quot;</span>,
                <span class="token string">&quot;0010 CALL    1     0    &quot;</span>,
                <span class="token string">&quot;0013 POP    &quot;</span>,
                <span class="token string">&quot;0014 BUILTIN 33   &quot;</span>,
                <span class="token string">&quot;0016 CONST   6    &quot;</span>,
                <span class="token string">&quot;0019 CONST   6    &quot;</span>,
                <span class="token string">&quot;0022 CONST   6    &quot;</span>,
                <span class="token string">&quot;0025 CONST   6    &quot;</span>,
                <span class="token string">&quot;0028 CONST   6    &quot;</span>,
                <span class="token string">&quot;0031 CALL    5     0    &quot;</span>,
                <span class="token string">&quot;0034 POP    &quot;</span>,
                <span class="token string">&quot;0035 GETF    0    &quot;</span>,
                <span class="token string">&quot;0037 CALL    0     0    &quot;</span>,
                <span class="token string">&quot;0040 POP    &quot;</span>,
                <span class="token string">&quot;0041 RET     0    &quot;</span>,
        <span class="token punctuation">]</span>

<span class="token comment"># &#x65B0;&#x589E;&#x65AD;&#x70B9;, &#x91CD;&#x65B0;run&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> b postRun
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> restart //&#x4F1A;&#x505C;&#x5728;&#x521A;&#x5F00;&#x59CB;
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> c
<span class="token comment"># &#x505C;&#x5728;func (v *VM) postRun() (err error)</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> p v.framesIndex
<span class="token number">3</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> p v.curFrame
*github.com/d5/tengo/v2.frame <span class="token punctuation">{</span>
        fn: *github.com/d5/tengo/v2.CompiledFunction <span class="token punctuation">{</span>
                ObjectImpl: github.com/d5/tengo/v2.ObjectImpl <span class="token punctuation">{</span><span class="token punctuation">}</span>,
                Instructions: <span class="token punctuation">[</span><span class="token punctuation">]</span>uint8 len: <span class="token number">43</span>, cap: <span class="token number">64</span>, <span class="token punctuation">[</span><span class="token number">22,0</span>,3,0,0,2,18,0,0,8,20,1,0,2,34,33,0,0,6,0,0,6,0,0,6,0,0,6,0,0,6,20,5,0,2,30,0,20,0,0,2,21,0<span class="token punctuation">]</span>,
                NumLocals: <span class="token number">0</span>,
                NumParameters: <span class="token number">0</span>,
                VarArgs: false,
                SourceMap: map<span class="token punctuation">[</span>int<span class="token punctuation">]</span>github.com/d5/tengo/v2/parser.Pos nil,
                Free: <span class="token punctuation">[</span><span class="token punctuation">]</span>*github.com/d5/tengo/v2.ObjectPtr len: <span class="token number">1</span>, cap: <span class="token number">1</span>, <span class="token punctuation">[</span>
                        *<span class="token punctuation">(</span>*<span class="token string">&quot;github.com/d5/tengo/v2.ObjectPtr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>0xc00000e9b0<span class="token punctuation">)</span>,
                <span class="token punctuation">]</span>,<span class="token punctuation">}</span>,
        freeVars: <span class="token punctuation">[</span><span class="token punctuation">]</span>*github.com/d5/tengo/v2.ObjectPtr len: <span class="token number">1</span>, cap: <span class="token number">1</span>, <span class="token punctuation">[</span>
                *<span class="token punctuation">(</span>*<span class="token string">&quot;github.com/d5/tengo/v2.ObjectPtr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>0xc00000e9b0<span class="token punctuation">)</span>,
        <span class="token punctuation">]</span>,
        ip: <span class="token number">0</span>,
        basePointer: <span class="token number">5</span>,<span class="token punctuation">}</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> p v.ip
<span class="token number">33</span>
</code></pre>
<h1 id="go-prompt-&#x6027;&#x80FD;&#x95EE;&#x9898;&#x8C03;&#x67E5;"><a name="go-prompt-&#x6027;&#x80FD;&#x95EE;&#x9898;&#x8C03;&#x67E5;" class="anchor-navigation-ex-anchor" href="#go-prompt-&#x6027;&#x80FD;&#x95EE;&#x9898;&#x8C03;&#x67E5;"><i class="fa fa-link" aria-hidden="true"></i></a>6. go-prompt &#x6027;&#x80FD;&#x95EE;&#x9898;&#x8C03;&#x67E5;</h1>
<p>go-prompt&#x65F6;&#x4E00;&#x4E2A;&#x4EA4;&#x4E92;&#x5F0F;cli&#x6846;&#x67B6;, &#x4F46;&#x4F3C;&#x4E4E;&#x6027;&#x80FD;&#x6709;&#x70B9;&#x95EE;&#x9898;. &#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;cli&#x4F8B;&#x5B50;&#x7A0B;&#x5E8F;CPU&#x5C31;&#x5360;&#x4E86;10%.<br>&#x57FA;&#x4E8E;go-prompt&#x7684;abs&#x4E5F;&#x4E00;&#x6837;&#x7A7A;&#x8DD1;&#x90FD;&#x5360;&#x6BD4;10%&#x4EE5;&#x4E0A;.
&#x770B;&#x706B;&#x7130;&#x56FE;&#x4F3C;&#x4E4E;&#x662F;timer&#x7684;&#x4F7F;&#x7528;&#x95EE;&#x9898;.<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913000203.png" alt=""><br>&#x539F;&#x56E0;&#x5728;&#x4E8E;  </p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Prompt<span class="token punctuation">)</span> <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        <span class="token keyword">select</span> <span class="token punctuation">{</span>
            <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token comment">//&#x6709;default&#x5C31;&#x662F;&#x975E;&#x963B;&#x585E;, &#x8FD9;&#x91CC;sleep 10ms</span>
                time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Millisecond<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="&#x5185;&#x5B58;&#x8FD8;&#x7ED9;os"><a name="&#x5185;&#x5B58;&#x8FD8;&#x7ED9;os" class="anchor-navigation-ex-anchor" href="#&#x5185;&#x5B58;&#x8FD8;&#x7ED9;os"><i class="fa fa-link" aria-hidden="true"></i></a>7. &#x5185;&#x5B58;&#x8FD8;&#x7ED9;OS</h1>
<h2 id="madvfree&#x548C;madvdontneed"><a name="madvfree&#x548C;madvdontneed" class="anchor-navigation-ex-anchor" href="#madvfree&#x548C;madvdontneed"><i class="fa fa-link" aria-hidden="true"></i></a>7.1. MADV_FREE&#x548C;MADV_DONTNEED</h2>
<p>go1.12&#x7248;&#x672C;&#x4E2D;, gc&#x628A;&#x4E0D;&#x7528;&#x7684;&#x5185;&#x5B58;&#x8FD8;&#x7ED9;OS&#x65F6;, &#x8C03;&#x7528;&#x4E86;<code>int madvise(void *addr, size_t length, int advice)</code>, &#x4F7F;&#x7528;&#x4E86;<code>MADV_FREE</code>&#x6807;&#x8BB0;. <code>man madvise</code>&#x8BF4;&#x7684;&#x5F88;&#x6E05;&#x695A;, &#x867D;&#x7136;&#x5185;&#x5B58;&#x8FD8;&#x7ED9;&#x4E86;OS, &#x4F46;OS&#x53EA;&#x6709;&#x5728;&#x7CFB;&#x7EDF;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#x65F6;&#x624D;&#x56DE;&#x6536;. &#x5BFC;&#x81F4;go&#x7A0B;&#x5E8F;&#x867D;&#x7136;&#x8BA4;&#x4E3A;&#x81EA;&#x5DF1;&#x5DF2;&#x7ECF;&#x8FD8;&#x4E86;&#x5185;&#x5B58;&#x7ED9;OS, &#x4F46;&#x5176;RSS&#x4E00;&#x76F4;&#x5C45;&#x9AD8;&#x4E0D;&#x4E0B;.</p>
<blockquote>
<p>On Linux, the runtime now uses MADV_FREE to release unused memory. This is more efficient but may result in higher reported RSS. The kernel will reclaim the unused data when it is needed. To revert to the Go 1.11 behavior (MADV_DONTNEED), set the environment variable GODEBUG=madvdontneed=1.</p>
</blockquote>
<p>go1.11&#x53CA;&#x4E4B;&#x524D;, gc&#x7528;<code>MADV_DONTNEED</code>&#x6765;&#x8FD8;&#x5185;&#x5B58;&#x7ED9;OS, RSS&#x4F1A;&#x9A6C;&#x4E0A;&#x4E0B;&#x964D;.
&#x7406;&#x8BBA;&#x8BF4;&#x6CD5;&#x662F;, <code>MADV_FREE</code>&#x6027;&#x80FD;&#x66F4;&#x597D;, &#x4F46;&#x4F1A;&#x5BFC;&#x81F4;RSS&#x7684;&#x503C;&#x4E0D;&#x51C6;&#x786E;. &#x5B9E;&#x9645;&#x4E0A;, &#x968F;&#x7740;gc&#x7B97;&#x6CD5;&#x7684;&#x63D0;&#x9AD8;, OS&#x7684;<code>MADV_FREE</code> lazy&#x56DE;&#x6536;&#x6A21;&#x5F0F;, &#x5C31;&#x6CA1;&#x6709;&#x592A;&#x5927;&#x610F;&#x4E49;&#x4E86;.
go1.16&#x7248;&#x672C;&#x53C8;&#x628A;<code>MADV_DONTNEED</code>&#x7684;&#x884C;&#x4E3A;&#x505A;&#x4E3A;&#x9ED8;&#x8BA4;&#x4E86;.</p>
<p>&#x6CE8;&#x610F;: &#x5982;&#x679C;&#x7528;<code>GODEBUG=madvdontneed=1</code>&#x8FD8;&#x662F;&#x4E0D;&#x80FD;&#x8BA9;RSS&#x4E0B;&#x964D;, &#x9700;&#x8981;&#x642D;&#x914D;&#x5F3A;&#x5236;gc&#x7684;&#x65B9;&#x6CD5;, &#x5426;&#x5219;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;, gc&#x8981;&#x5F88;&#x957F;&#x65F6;&#x95F4;, &#x6BD4;&#x5982;&#x51E0;&#x5206;&#x949F;, &#x624D;&#x5DE5;&#x4F5C;.</p>
<p>go1.13&#x91CC;&#x9762;&#x6709;&#x4E2A;&#x4F18;&#x5316;&#x63D0;&#x5230;: &#x4E4B;&#x524D;, gc&#x4F1A;&#x6301;&#x6709;&#x5185;&#x5B58;5&#x5206;&#x949F;&#x6216;&#x66F4;&#x957F;&#x65F6;&#x95F4;&#x624D;&#x5F00;&#x59CB;&#x8FD8;&#x7ED9;OS, &#x4F46;1.13&#x4F1A;&#x66F4;&#x79EF;&#x6781;&#x7684;&#x8FD8;&#x5185;&#x5B58;.</p>
<blockquote>
<p>The runtime is now more aggressive at returning memory to the operating system to make it available to co-tenant applications. Previously, the runtime could retain memory for five or more minutes following a spike in the heap size. It will now begin returning it promptly after the heap shrinks. However, on many OSes, including Linux, the OS itself reclaims memory lazily, so process RSS will not decrease until the system is under memory pressure.</p>
</blockquote>
<p>&#x53C2;&#x8003;:
<a href="https://golang.org/pkg/runtime/" target="_blank">https://golang.org/pkg/runtime/</a> &#x641C;&#x7D22;<code>madvdontneed</code>
&#x4E0B;&#x9762;&#x5C31;&#x662F;&#x6700;&#x65B0;&#x7684;1.16&#x7248;&#x672C;&#x7684;&#x8BF4;&#x6CD5;:</p>
<blockquote>
<p>madvdontneed: setting madvdontneed=0 will use MADV_FREE
instead of MADV_DONTNEED on Linux when returning memory to the
kernel. This is more efficient, but means RSS numbers will
drop only when the OS is under memory pressure.</p>
</blockquote>
<p><a href="https://golang.org/doc/go1.12#runtime" title="https://golang.org/doc/go1.12#runtime" target="_blank">https://golang.org/doc/go1.12#runtime</a>
<a href="https://vec.io/posts/golang-and-memory" target="_blank">https://vec.io/posts/golang-and-memory</a></p>
<h2 id="gogc&#x6BD4;&#x4F8B;"><a name="gogc&#x6BD4;&#x4F8B;" class="anchor-navigation-ex-anchor" href="#gogc&#x6BD4;&#x4F8B;"><i class="fa fa-link" aria-hidden="true"></i></a>7.2. GOGC&#x6BD4;&#x4F8B;</h2>
<p>GOGC&#x9ED8;&#x8BA4;&#x662F;100, &#x5373;&#x65B0;&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;&#x548C;&#x4E0A;&#x6B21;gc&#x5B8C;&#x6210;&#x65F6;&#x5269;&#x4E0B;&#x7684;&#x5185;&#x5B58;&#x7684;&#x6BD4;&#x4F8B;&#x662F;1:1&#x65F6;, gc&#x624D;&#x542F;&#x52A8;. &#x4E5F;&#x5C31;&#x662F;&#x8BF4;, &#x53EA;&#x6709;&#x5185;&#x5B58;&#x7FFB;&#x4E86;&#x4E00;&#x500D;&#x65F6;, gc&#x624D;&#x5F00;&#x59CB;&#x6536;&#x96C6;&#x5783;&#x573E;.
&#x60F3;&#x63A7;&#x5236;RSS&#x5360;&#x7528;&#x7684;&#x8BDD;, GOGC&#x8BBE;&#x7F6E;&#x5C0F;&#x4E00;&#x70B9;.</p>
<h1 id="topid&#x7533;&#x8BF7;&#x5185;&#x5B58;&#x9519;&#x8BEF;"><a name="topid&#x7533;&#x8BF7;&#x5185;&#x5B58;&#x9519;&#x8BEF;" class="anchor-navigation-ex-anchor" href="#topid&#x7533;&#x8BF7;&#x5185;&#x5B58;&#x9519;&#x8BEF;"><i class="fa fa-link" aria-hidden="true"></i></a>8. topid&#x7533;&#x8BF7;&#x5185;&#x5B58;&#x9519;&#x8BEF;</h1>
<h2 id="&#x80CC;&#x666F;"><a name="&#x80CC;&#x666F;" class="anchor-navigation-ex-anchor" href="#&#x80CC;&#x666F;"><i class="fa fa-link" aria-hidden="true"></i></a>8.1. &#x80CC;&#x666F;</h2>
<p>&#x67D0;&#x6B21;&#x7248;&#x672C;&#x540E;, topid&#x542F;&#x52A8;&#x9A6C;&#x4E0A;&#x51FA;&#x9519;:
&#x6BCF;&#x6B21;&#x6808;&#x8FD8;&#x4E0D;&#x4E00;&#x6837;, &#x4F46;&#x6700;&#x540E;&#x90FD;&#x662F;<code>runtime.mallocgc</code>&#x7684;&#x6808;</p>
<h3 id="&#x9519;&#x8BEF;1"><a name="&#x9519;&#x8BEF;1" class="anchor-navigation-ex-anchor" href="#&#x9519;&#x8BEF;1"><i class="fa fa-link" aria-hidden="true"></i></a>8.1.1. &#x9519;&#x8BEF;1</h3>
<pre class="language-"><code class="lang-sh">~ <span class="token comment"># ./topid -tag ZAPPING_MCASTV4_v2 -p 1 -tree</span>
Hello &#x4F60;&#x597D; Hola Hallo Bonjour Ciao &#x3A7;&#x3B1;&#x3AF;&#x3C1;&#x3B5;&#x3C4;&#x3B5; &#x3053;&#x3093;&#x306B;&#x3061;&#x306F; &#xC5EC;&#xBCF4;&#xC138;&#xC694;
Version: <span class="token number">0.1</span>.4
runtime: <span class="token assign-left variable">s.allocCount</span><span class="token operator">=</span> <span class="token number">3</span> <span class="token assign-left variable">s.nelems</span><span class="token operator">=</span> <span class="token number">5</span>
fatal error: s.allocCount <span class="token operator">!=</span> s.nelems <span class="token operator">&amp;&amp;</span> freeIndex <span class="token operator">==</span> s.nelems

goroutine <span class="token number">1</span> <span class="token punctuation">[</span>running<span class="token punctuation">]</span>:
runtime.throw<span class="token punctuation">(</span>0x1a8caa, 0x31<span class="token punctuation">)</span>
        runtime/panic.go:774 +0x54 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0ca0 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0c70 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x3bc84
runtime.<span class="token punctuation">(</span>*mcache<span class="token punctuation">)</span>.nextFree<span class="token punctuation">(</span>0x7f82a2a6d0, 0xa2f47, 0x4000000180, 0x200000003, 0x4000000180<span class="token punctuation">)</span>
        runtime/malloc.go:852 +0x204 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0cf0 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0ca0 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x1aa44
runtime.mallocgc<span class="token punctuation">(</span>0x600, 0x15d600, 0x1, 0x0<span class="token punctuation">)</span>
        runtime/malloc.go:1022 +0x688 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0db0 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0cf0 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x1b0e8
runtime.makeslice<span class="token punctuation">(</span>0x15d600, 0x600, 0x600, 0x0<span class="token punctuation">)</span>
        runtime/slice.go:49 +0x74 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0de0 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0db0 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x51364
bytes.makeSlice<span class="token punctuation">(</span>0x600, 0x0, 0x0, 0x0<span class="token punctuation">)</span>
        bytes/buffer.go:229 +0x64 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0e50 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0de0 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x7af84
bytes.<span class="token punctuation">(</span>*Buffer<span class="token punctuation">)</span>.grow<span class="token punctuation">(</span>0x40000a0f80, 0x200, 0x200<span class="token punctuation">)</span>
        bytes/buffer.go:142 +0x12c <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0ea0 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0e50 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x7aabc
bytes.<span class="token punctuation">(</span>*Buffer<span class="token punctuation">)</span>.ReadFrom<span class="token punctuation">(</span>0x40000a0f80, 0x1d39e0, 0x4000081268, 0x3, 0x0, 0x0<span class="token punctuation">)</span>
        bytes/buffer.go:202 +0x48 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0f10 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0ea0 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x7ada8
io/ioutil.readAll<span class="token punctuation">(</span>0x1d39e0, 0x4000081268, 0x200, 0x0, 0x0, 0x0, 0x0, 0x0<span class="token punctuation">)</span>
        io/ioutil/ioutil.go:36 +0xb0 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0fb0 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0f10 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x12bb80
io/ioutil.ReadAll<span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>
        io/ioutil/ioutil.go:45
pidinfo.<span class="token punctuation">(</span>*TidInfo<span class="token punctuation">)</span>.updateStat<span class="token punctuation">(</span>0x40001830e0, 0x0, 0x0<span class="token punctuation">)</span>
        pidinfo/pidinfo.go:486 +0x190 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a10f0 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0fb0 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x12d510
pidinfo.<span class="token punctuation">(</span>*PidInfo<span class="token punctuation">)</span>.update<span class="token punctuation">(</span>0x40001830e0, 0x40001472a0, 0x0<span class="token punctuation">)</span>
        pidinfo/pidinfo.go:799 +0x2c <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a1190 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a10f0 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x13017c
pidinfo.newPidInfo<span class="token punctuation">(</span>0x28e, 0x40000bee10, 0x28e, 0x2f4f20, 0x0<span class="token punctuation">)</span>
        pidinfo/pidinfo.go:631 +0x2f8 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a1280 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a1190 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x12e478
</code></pre>
<h3 id="&#x9519;&#x8BEF;2"><a name="&#x9519;&#x8BEF;2" class="anchor-navigation-ex-anchor" href="#&#x9519;&#x8BEF;2"><i class="fa fa-link" aria-hidden="true"></i></a>8.1.2. &#x9519;&#x8BEF;2</h3>
<pre class="language-"><code class="lang-sh">~ <span class="token comment"># Hello &#x4F60;&#x597D; Hola Hallo Bonjour Ciao &#x3A7;&#x3B1;&#x3AF;&#x3C1;&#x3B5;&#x3C4;&#x3B5; &#x3053;&#x3093;&#x306B;&#x3061;&#x306F; &#xC5EC;&#xBCF4;&#xC138;&#xC694;</span>
Version: <span class="token number">0.1</span>.4
Visit below URL to get the chart:
http://10.182.105.138:9888/ZAPPING_MCASTV4_v2/1992780262
runtime: <span class="token assign-left variable">s.allocCount</span><span class="token operator">=</span> <span class="token number">3</span> <span class="token assign-left variable">s.nelems</span><span class="token operator">=</span> <span class="token number">5</span>
fatal error: s.allocCount <span class="token operator">!=</span> s.nelems <span class="token operator">&amp;&amp;</span> freeIndex <span class="token operator">==</span> s.nelems

goroutine <span class="token number">1</span> <span class="token punctuation">[</span>running<span class="token punctuation">]</span>:
runtime.throw<span class="token punctuation">(</span>0x1a8caa, 0x31<span class="token punctuation">)</span>
        runtime/panic.go:774 +0x54 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0b00 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0ad0 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x3bc84
runtime.<span class="token punctuation">(</span>*mcache<span class="token punctuation">)</span>.nextFree<span class="token punctuation">(</span>0x7f887a26d0, 0xa2f47, 0x4000000180, 0x200000003, 0x4000000180<span class="token punctuation">)</span>
        runtime/malloc.go:852 +0x204 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0b50 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0b00 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x1aa44
runtime.mallocgc<span class="token punctuation">(</span>0x600, 0x15d600, 0x1, 0x0<span class="token punctuation">)</span>
        runtime/malloc.go:1022 +0x688 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0c10 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0b50 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x1b0e8
runtime.makeslice<span class="token punctuation">(</span>0x15d600, 0x600, 0x600, 0x0<span class="token punctuation">)</span>
        runtime/slice.go:49 +0x74 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0c40 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0c10 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x51364
bytes.makeSlice<span class="token punctuation">(</span>0x600, 0x0, 0x0, 0x0<span class="token punctuation">)</span>
        bytes/buffer.go:229 +0x64 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0cb0 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0c40 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x7af84
bytes.<span class="token punctuation">(</span>*Buffer<span class="token punctuation">)</span>.grow<span class="token punctuation">(</span>0x40000a0de0, 0x200, 0x200<span class="token punctuation">)</span>
        bytes/buffer.go:142 +0x12c <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0d00 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0cb0 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x7aabc
bytes.<span class="token punctuation">(</span>*Buffer<span class="token punctuation">)</span>.ReadFrom<span class="token punctuation">(</span>0x40000a0de0, 0x1d39e0, 0x40000851b8, 0xb7bc4, 0x40001354e0, 0x12<span class="token punctuation">)</span>
        bytes/buffer.go:202 +0x48 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0d70 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0d00 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x7ada8
io/ioutil.readAll<span class="token punctuation">(</span>0x1d39e0, 0x40000851b8, 0x200, 0x0, 0x0, 0x0, 0x0, 0x0<span class="token punctuation">)</span>
        io/ioutil/ioutil.go:36 +0xb0 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0e10 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0d70 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x12bb80
io/ioutil.ReadFile<span class="token punctuation">(</span>0x40001354e0, 0x12, 0x0, 0x0, 0x0, 0x0, 0x0<span class="token punctuation">)</span>
        io/ioutil/ioutil.go:73 +0xc4 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x40000a0eb0 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x40000a0e10 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x12bcf4
pidinfo.<span class="token punctuation">(</span>*PidInfo<span class="token punctuation">)</span>.init<span class="token punctuation">(</span>0x40001a84b0, 0xa, 0x1d6860<span class="token punctuation">)</span>
</code></pre>
<h3 id="&#x9519;&#x8BEF;3"><a name="&#x9519;&#x8BEF;3" class="anchor-navigation-ex-anchor" href="#&#x9519;&#x8BEF;3"><i class="fa fa-link" aria-hidden="true"></i></a>8.1.3. &#x9519;&#x8BEF;3</h3>
<pre class="language-"><code class="lang-sh">./topid <span class="token parameter variable">-tag</span> ZAPPING_MCASTV4_v2 <span class="token parameter variable">-p</span> <span class="token number">1</span> <span class="token parameter variable">-chartserver</span> <span class="token number">10.182</span>.105.138:9887 <span class="token parameter variable">-i</span> <span class="token number">3</span> <span class="token parameter variable">-c</span> <span class="token number">3600</span> <span class="token parameter variable">-record</span> <span class="token parameter variable">-sys</span> <span class="token parameter variable">-child</span> <span class="token operator">&amp;</span>
~ <span class="token comment"># Hello \xe4\xbd\xa0\xe5\xa5\xbd Hola Hallo Bonjour Ciao \xce\xa7\xce\xb1\xce\xaf\xcf\x81\xce\xb5\xcf\x84\xce\xb5 \xe3\x81\x93\xe3\x82\x93\xe3\x81\xab\xe3\x81\xa1\xe3\x81\xaf \xec\x97\xac\xeb\xb3\xb4\xec\x84\xb8\xec\x9a\x94</span>
Version: <span class="token number">0.1</span>.4
Visit below URL to get the chart:
http://10.182.105.138:9888/ZAPPING_MCASTV4_v2/2938934727
runtime: <span class="token assign-left variable">s.allocCount</span><span class="token operator">=</span> <span class="token number">492</span> <span class="token assign-left variable">s.nelems</span><span class="token operator">=</span> <span class="token number">512</span>
fatal error: s.allocCount <span class="token operator">!=</span> s.nelems <span class="token operator">&amp;&amp;</span> freeIndex <span class="token operator">==</span> s.nelems

goroutine <span class="token number">1</span> <span class="token punctuation">[</span>running<span class="token punctuation">]</span>:
runtime.throw<span class="token punctuation">(</span>0x1a8caa, 0x31<span class="token punctuation">)</span>
    runtime/panic.go:774 +0x54 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x4000040b50 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x4000040b20 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x3bc84
runtime.<span class="token punctuation">(</span>*mcache<span class="token punctuation">)</span>.nextFree<span class="token punctuation">(</span>0x7f9c7ab6d0, 0x51305, 0x4000040c08, 0x38e8c, 0x4000040c18<span class="token punctuation">)</span>
    runtime/malloc.go:852 +0x204 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x4000040ba0 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x4000040b50 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x1aa44
runtime.mallocgc<span class="token punctuation">(</span>0x8, 0x15d400, 0x0, 0x0<span class="token punctuation">)</span>
    runtime/malloc.go:998 +0x4f4 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x4000040c60 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x4000040ba0 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x1af54
runtime.convT64<span class="token punctuation">(</span>0x1, 0x7f9a53ef28<span class="token punctuation">)</span>
    runtime/iface.go:352 +0x5c <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x4000040c90 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x4000040c60 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x18d0c
internal/poll.errnoErr<span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>
    internal/poll/errno_unix.go:32
internal/poll.<span class="token punctuation">(</span>*pollDesc<span class="token punctuation">)</span>.init<span class="token punctuation">(</span>0x4000219338, 0x4000219320, 0x1, 0x4000219320<span class="token punctuation">)</span>
    internal/poll/fd_poll_runtime.go:45 +0x8c <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x4000040cd0 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x4000040c90 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0xb312c
internal/poll.<span class="token punctuation">(</span>*FD<span class="token punctuation">)</span>.Init<span class="token punctuation">(</span>0x4000219320, 0x19fa28, 0x4, 0x1, 0x40001fe800, 0x0<span class="token punctuation">)</span>
    internal/poll/fd_unix.go:63 +0x68 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x4000040d00 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x4000040cd0 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0xb3888
os.newFile<span class="token punctuation">(</span>0x5, 0x40001fe7e0, 0x12, 0x1, 0x4000000000<span class="token punctuation">)</span>
    os/file_unix.go:151 +0xe8 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x4000040d60 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x4000040d00 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0xb6ed8
os.openFileNolog<span class="token punctuation">(</span>0x40001fe7e0, 0x12, 0x0, 0x0, 0x8, 0x12, 0x40001fe7e0<span class="token punctuation">)</span>
    os/file_unix.go:222 +0x19c <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x4000040dc0 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x4000040d60 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0xb715c
os.OpenFile<span class="token punctuation">(</span>0x40001fe7e0, 0x12, 0x0, 0x0, 0x2, 0x40001fe7e0, 0x40001fe7ea<span class="token punctuation">)</span>
    os/file.go:300 +0x54 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x4000040e10 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x4000040dc0 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0xb6964
os.Open<span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>
    os/file.go:280
io/ioutil.ReadFile<span class="token punctuation">(</span>0x40001fe7e0, 0x12, 0x0, 0x0, 0x0, 0x0, 0x0<span class="token punctuation">)</span>
    io/ioutil/ioutil.go:53 +0x48 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x4000040eb0 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x4000040e10 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x12bc78
pidinfo.<span class="token punctuation">(</span>*PidInfo<span class="token punctuation">)</span>.init<span class="token punctuation">(</span>0x400020d1d0, 0xa, 0x1d6860<span class="token punctuation">)</span>
    pidinfo/pidinfo.go:587 +0x130 <span class="token assign-left variable">fp</span><span class="token operator">=</span>0x4000040f50 <span class="token assign-left variable">sp</span><span class="token operator">=</span>0x4000040eb0 <span class="token assign-left variable">pc</span><span class="token operator">=</span>0x12dfe0
</code></pre>
<h2 id="&#x8C03;&#x67E5;"><a name="&#x8C03;&#x67E5;" class="anchor-navigation-ex-anchor" href="#&#x8C03;&#x67E5;"><i class="fa fa-link" aria-hidden="true"></i></a>8.2. &#x8C03;&#x67E5;</h2>
<h3 id="&#x91CA;&#x653E;&#x5185;&#x5B58;&#x540E;&#x8FD0;&#x884C;-&#x91CD;&#x542F;&#x540E;&#x8FD0;&#x884C;----nok"><a name="&#x91CA;&#x653E;&#x5185;&#x5B58;&#x540E;&#x8FD0;&#x884C;-&#x91CD;&#x542F;&#x540E;&#x8FD0;&#x884C;----nok" class="anchor-navigation-ex-anchor" href="#&#x91CA;&#x653E;&#x5185;&#x5B58;&#x540E;&#x8FD0;&#x884C;-&#x91CD;&#x542F;&#x540E;&#x8FD0;&#x884C;----nok"><i class="fa fa-link" aria-hidden="true"></i></a>8.2.1. &#x91CA;&#x653E;&#x5185;&#x5B58;&#x540E;&#x8FD0;&#x884C; &#x91CD;&#x542F;&#x540E;&#x8FD0;&#x884C; -- nok</h3>
<p>&#x770B;&#x8D77;&#x6765;&#x662F;&#x5185;&#x5B58;&#x7533;&#x8BF7;&#x5931;&#x8D25;, &#x90A3;&#x4E48;&#x5148;&#x7CFB;&#x7EDF;&#x5185;&#x5B58;&#x7684;&#x60C5;&#x51B5;:</p>
<pre class="language-"><code class="lang-sh">~ <span class="token comment"># free -m</span>
              total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:            <span class="token number">853</span>         <span class="token number">533</span>           <span class="token number">8</span>         <span class="token number">115</span>         <span class="token number">312</span>         <span class="token number">179</span>
Swap:             <span class="token number">0</span>           <span class="token number">0</span>           <span class="token number">0</span>
</code></pre>
<p>&#x5F3A;&#x5236;&#x91CA;&#x653E;&#x5185;&#x5B58;&#x8BD5;&#x4E00;&#x4E0B;:</p>
<pre class="language-"><code class="lang-sh"><span class="token builtin class-name">echo</span> <span class="token number">3</span> <span class="token operator">&gt;</span> /proc/sys/vm/drop_caches
</code></pre>
<p>&#x518D;&#x770B;&#x4E00;&#x4E0B;&#x5185;&#x5B58;:</p>
<pre class="language-"><code class="lang-sh">~ <span class="token comment"># free -m</span>
              total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:            <span class="token number">853</span>         <span class="token number">537</span>         <span class="token number">103</span>         <span class="token number">115</span>         <span class="token number">212</span>         <span class="token number">175</span>
Swap:             <span class="token number">0</span>           <span class="token number">0</span>           <span class="token number">0</span>
</code></pre>
<p>&#x6709;103M&#x4E86;, topid&#x901A;&#x5E38;&#x662F;&#x5360;&#x7528;RSS 6M, &#x90A3;&#x4E48;100M&#x5E94;&#x8BE5;&#x662F;&#x591F;&#x4E86;.
&#x4F46;&#x8FD0;&#x884C;&#x8FD8;&#x662F;&#x4E00;&#x6837;&#x7684;<code>runtime.mallocgc</code>&#x4E4B;&#x540E;<code>runtime.(*mcache).nextFree</code>&#x9519;&#x8BEF;.</p>
<p>&#x91CD;&#x542F;&#x677F;&#x5B50;&#x518D;&#x8FD0;&#x884C;, &#x4E5F;&#x662F;&#x51FA;&#x9519;.</p>
<h3 id="golang&#x7248;&#x672C;113&#x6362;&#x5230;116&#x95EE;&#x9898;&#x4F9D;&#x65E7;"><a name="golang&#x7248;&#x672C;113&#x6362;&#x5230;116&#x95EE;&#x9898;&#x4F9D;&#x65E7;" class="anchor-navigation-ex-anchor" href="#golang&#x7248;&#x672C;113&#x6362;&#x5230;116&#x95EE;&#x9898;&#x4F9D;&#x65E7;"><i class="fa fa-link" aria-hidden="true"></i></a>8.2.2. golang&#x7248;&#x672C;1.13&#x6362;&#x5230;1.16&#x95EE;&#x9898;&#x4F9D;&#x65E7;</h3>
<p>&#x6CE8;&#x610F;1.16&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;go mod, &#x9700;&#x8981;&#x624B;&#x52A8;off&#x6389;</p>
<pre class="language-"><code class="lang-sh"><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOPATH</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>
<span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>arm64 <span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>off go build topid.go
</code></pre>
<h3 id="&#x548C;&#x7248;&#x672C;&#x76F8;&#x5173;"><a name="&#x548C;&#x7248;&#x672C;&#x76F8;&#x5173;" class="anchor-navigation-ex-anchor" href="#&#x548C;&#x7248;&#x672C;&#x76F8;&#x5173;"><i class="fa fa-link" aria-hidden="true"></i></a>8.2.3. &#x548C;&#x7248;&#x672C;&#x76F8;&#x5173;?</h3>
<p>288&#x7248;&#x672C;&#x662F;&#x597D;&#x7684;, 289&#x7248;&#x672C;&#x5C31;&#x4E0D;&#x884C;&#x4E86;..
kernel&#x6539;&#x4E86;&#x4EC0;&#x4E48;?</p>
<h1 id="gshell-server&#x5185;&#x5B58;&#x8C03;&#x8BD5;"><a name="gshell-server&#x5185;&#x5B58;&#x8C03;&#x8BD5;" class="anchor-navigation-ex-anchor" href="#gshell-server&#x5185;&#x5B58;&#x8C03;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a>9. gshell server&#x5185;&#x5B58;&#x8C03;&#x8BD5;</h1>
<h2 id="&#x95EE;&#x9898;&#x573A;&#x666F;"><a name="&#x95EE;&#x9898;&#x573A;&#x666F;" class="anchor-navigation-ex-anchor" href="#&#x95EE;&#x9898;&#x573A;&#x666F;"><i class="fa fa-link" aria-hidden="true"></i></a>9.1. &#x95EE;&#x9898;&#x573A;&#x666F;</h2>
<p>&#x6B63;&#x5E38;&#x4E00;&#x4E2A;govm_test&#x5E94;&#x8BE5;&#x662F;11&#x79D2;&#x7ED3;&#x675F;. &#x8FD9;&#x91CC;&#x7684;&#x95EE;&#x9898;&#x4E3B;&#x8981;&#x662F;&#x5185;&#x5B58;&#x95EE;&#x9898;.<br>&#x6709;&#x4EBA;&#x53EF;&#x80FD;&#x95EE;&#x4E86;, go&#x4E0D;&#x662F;&#x81EA;&#x52A8;gc&#x7684;&#x5417;? &#x4E3A;&#x4EC0;&#x4E48;&#x5185;&#x5B58;&#x8FD8;&#x6709;&#x95EE;&#x9898;?<br>&#x8FD9;&#x4E2A;&#x8981;&#x4ED4;&#x7EC6;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x4E86;.</p>
<h3 id="&#x64CD;&#x505A;1-&#x9996;&#x6B21;&#x8FD0;&#x884C;50&#x4E2A;govmtest"><a name="&#x64CD;&#x505A;1-&#x9996;&#x6B21;&#x8FD0;&#x884C;50&#x4E2A;govmtest" class="anchor-navigation-ex-anchor" href="#&#x64CD;&#x505A;1-&#x9996;&#x6B21;&#x8FD0;&#x884C;50&#x4E2A;govmtest"><i class="fa fa-link" aria-hidden="true"></i></a>9.1.1. &#x64CD;&#x505A;1: &#x9996;&#x6B21;&#x8FD0;&#x884C;50&#x4E2A;govm_test</h3>
<p>&#x8D77;50&#x4E2A;govm_test<br>htop&#x663E;&#x793A;&#x5185;&#x5B58;46M<br>&#x663E;&#x793A; Inuse 62M  </p>
<pre class="language-"><code># HeapAlloc = 59398296
# HeapSys = 133005312
# HeapIdle = 70754304
# HeapInuse = 62251008
# HeapReleased = 64618496
# HeapObjects = 31588
</code></pre><p><code>go tool pprof -http=0.0.0.0:8000 http://10.182.105.138:42459/debug/pprof/heap</code>&#x5F97;&#x5230;:<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913223735.png" alt=""><br>&#x5927;&#x90E8;&#x5206;&#x662F;shallowClone&#x4EA7;&#x751F;&#x7684;<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913223815.png" alt="">  </p>
<h3 id="&#x64CD;&#x505A;2-50&#x4E2A;govmtest&#x540C;&#x65F6;restart"><a name="&#x64CD;&#x505A;2-50&#x4E2A;govmtest&#x540C;&#x65F6;restart" class="anchor-navigation-ex-anchor" href="#&#x64CD;&#x505A;2-50&#x4E2A;govmtest&#x540C;&#x65F6;restart"><i class="fa fa-link" aria-hidden="true"></i></a>9.1.2. &#x64CD;&#x505A;2: 50&#x4E2A;govm_test&#x540C;&#x65F6;restart</h3>
<p>&#x73B0;&#x8C61;&#x662F;&#x540C;&#x65F6;restart&#x540E;, &#x7CFB;&#x7EDF;24&#x6838;CPU&#x5360;&#x7528;100%&#x6301;&#x7EED;&#x5927;&#x6982;1&#x5206;&#x949F;, &#x6BCF;&#x4E2A;govm_test&#x7684;&#x7ED3;&#x675F;&#x65F6;&#x95F4;&#x957F;&#x81F3;50&#x79D2;&#x5DE6;&#x53F3;.<br>htop&#x663E;&#x793A;&#x7269;&#x7406;&#x5185;&#x5B58;&#x4E0A;&#x5347;&#x5230;129M, &#x591A;&#x505A;&#x51E0;&#x6B21;restart&#x4F1A;&#x5347;&#x5230;200&#x591A;M. 200&#x591A;M&#x7684;&#x65F6;&#x5019;, &#x6709;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x4E0D;&#x4F1A;100%CPU&#x4E86;.</p>
<pre class="language-"><code class="lang-sh">perf record <span class="token parameter variable">-g</span> <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">`</span>pidof gshell<span class="token variable">`</span></span> -- <span class="token function">sleep</span> <span class="token number">60</span>
perf script <span class="token operator">|</span> /repo/yingjieb/FlameGraph/stackcollapse-perf.pl <span class="token operator">|</span> /repo/yingjieb/FlameGraph/flamegraph.pl <span class="token operator">&gt;</span> gshell.svg
</code></pre>
<p>&#x706B;&#x7130;&#x56FE;&#x663E;&#x793A;<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913224042.png" alt=""><br>&#x7EDD;&#x5927;&#x90E8;&#x5206;&#x65F6;&#x95F4;&#x5728;<code>runtime.newobject</code>&#x51FD;&#x6570;&#x91CC;.<br>&#x7528;go tool&#x7684;objdump&#x53EF;&#x4EE5;&#x770B;&#x5230;, <code>runtime.newobject</code>&#x662F;&#x4ECE;&#x5806;&#x5206;&#x914D;&#x7684;&#x5173;&#x952E;&#x51FD;&#x6570;, &#x7531;&#x7F16;&#x8BD1;&#x5668;&#x63D2;&#x5165;.</p>
<h2 id="&#x7B2C;&#x4E00;&#x6B21;&#x5185;&#x5B58;&#x4F18;&#x5316;"><a name="&#x7B2C;&#x4E00;&#x6B21;&#x5185;&#x5B58;&#x4F18;&#x5316;" class="anchor-navigation-ex-anchor" href="#&#x7B2C;&#x4E00;&#x6B21;&#x5185;&#x5B58;&#x4F18;&#x5316;"><i class="fa fa-link" aria-hidden="true"></i></a>9.2. &#x7B2C;&#x4E00;&#x6B21;&#x5185;&#x5B58;&#x4F18;&#x5316;</h2>
<p>&#x6E90;&#x7801;&#x7684;&#x903B;&#x8F91;&#x662F;&#x65B0;&#x5EFA;&#x4E2A;clone&#x7684;VM&#x6765;&#x8FD0;&#x884C;, &#x8FD0;&#x884C;&#x7ED3;&#x675F;&#x540E;&#x5176;&#x5B9E;&#x5C31;&#x4E0D;&#x7528;&#x4E86;.<br>&#x6CE8;&#x610F;:&#x7B2C;90&#x884C;&#x662F;&#x65B0;&#x52A0;&#x7684;, &#x4E0A;&#x9762;&#x7684;&#x5B9E;&#x9A8C;&#x6570;&#x636E;&#x662F;&#x6CA1;&#x6709;&#x7B2C;90&#x884C;&#x7684;&#x6570;&#x636E;.<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913224156.png" alt=""><br>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5728;&#x6700;&#x540E;&#x628A;gvm&#x8FD4;&#x56DE;&#x4E86;, &#x88AB;&#x5F53;&#x4F5C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4FDD;&#x5B58;&#x5728;&#x4E0A;&#x7EA7;VM&#x7684;stack&#x4E0A;.<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913224221.png" alt="">  </p>
<h3 id="&#x64CD;&#x505A;1-&#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;"><a name="&#x64CD;&#x505A;1-&#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;" class="anchor-navigation-ex-anchor" href="#&#x64CD;&#x505A;1-&#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;"><i class="fa fa-link" aria-hidden="true"></i></a>9.2.1. &#x64CD;&#x505A;1 &#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;</h3>
<p>&#x65E2;&#x7136;gvm&#x4F1A;&#x88AB;&#x5F15;&#x7528;&#x5230;, &#x90A3;gvm.VM&#x4E5F;&#x4E0D;&#x4F1A;&#x88AB;gc. &#x4F46;&#x5B9E;&#x9645;&#x4E0A;, &#x8FD9;&#x4E2A;&#x5B50;VM&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x5B8C;&#x6BD5;, &#x53EF;&#x4EE5;&#x5B89;&#x5168;&#x7684;&#x91CA;&#x653E;&#x4E86;.<br>&#x52A0;&#x4E86;&#x7B2C;90&#x884C;&#x6765;&#x8BA9;gc&#x53EF;&#x4EE5;&#x56DE;&#x6536;&#x8FD9;&#x4E2A;VM.</p>
<p>&#x540C;&#x6837;&#x8FD0;&#x884C;50&#x4E2A;govm_test, htop&#x663E;&#x793A;&#x7269;&#x7406;&#x5185;&#x5B58;45M, &#x548C;&#x4E4B;&#x524D;&#x4E00;&#x6837;.<br>&#x4F46;pprof&#x663E;&#x793A;, Inuse&#x5C0F;&#x4E86;&#x4E0D;&#x5C11;, &#x6574;&#x4F53;&#x7684;HeapSys&#x4E5F;&#x6BD4;&#x4E4B;&#x524D;&#x5C0F;&#x4E86;&#x4E00;&#x534A;.</p>
<pre class="language-"><code># HeapAlloc = 34263112
# HeapSys = 65961984
# HeapIdle = 29892608
# HeapInuse = 36069376
# HeapReleased = 18497536
# HeapObjects = 46161
</code></pre><p>&#x6709;&#x7ECF;&#x8FC7;&#x4E00;&#x5C0F;&#x4F1A;, &#x7A33;&#x5B9A;&#x540E;Inuse&#x66F4;&#x5C0F;&#x4E86;, &#x4E3A;11M&#x5DE6;&#x53F3;.</p>
<pre class="language-"><code># HeapAlloc = 9485592
# HeapSys = 65994752
# HeapIdle = 54206464
# HeapInuse = 11788288
# HeapReleased = 52912128
# HeapObjects = 25051
</code></pre><p>pprof&#x7684;top&#x4E5F;&#x663E;&#x793A;, &#x6CA1;&#x6709;&#x4E86;50M&#x7684;shallowClone&#x7684;&#x5360;&#x7528;. &#x6548;&#x679C;&#x975E;&#x5E38;&#x660E;&#x663E;!</p>
<p><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913224629.png" alt="">  </p>
<h3 id="&#x64CD;&#x505A;2-&#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;"><a name="&#x64CD;&#x505A;2-&#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;" class="anchor-navigation-ex-anchor" href="#&#x64CD;&#x505A;2-&#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;"><i class="fa fa-link" aria-hidden="true"></i></a>9.2.2. &#x64CD;&#x505A;2 &#x52A0;&#x4E0A;&#x7B2C;90&#x884C;&#x7684;&#x6548;&#x679C;</h3>
<p>&#x8FD0;&#x884C;2&#x6B21;&#x540E;, &#x8FD8;&#x662F;&#x4F1A;100%, &#x4F46;&#x611F;&#x89C9;&#x65F6;&#x95F4;&#x77ED;&#x4E86;&#x4E9B;. govm<em>test&#x4F1A;&#x5728;15&#x79D2;&#x5DE6;&#x53F3;&#x7ED3;&#x675F;.<br>&#x770B;&#x706B;&#x7130;&#x56FE;&#x8FD8;&#x662F;&#x5728;<code>runtime.newobject</code><br>![](img/golang</em>&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913224711.png)  </p>
<p>pprof&#x663E;&#x793A;HeapInuse&#x4E3A;14M.&#x4E5F;&#x4E0D;&#x662F;&#x591A;&#x5F88;&#x591A;, &#x4F46;HeapIdle&#x4E3A;117M, &#x8BF4;&#x660E;&#x6709;&#x5927;&#x91CF;&#x7684;&#x5185;&#x5B58;&#x7533;&#x8BF7;&#x8FC7;&#x4F46;&#x5DF2;&#x7ECF;&#x4F7F;&#x7528;&#x5B8C;&#x6BD5;.</p>
<pre class="language-"><code># HeapAlloc = 10403200
# HeapSys = 131563520
# HeapIdle = 117334016
# HeapInuse = 14229504
# HeapReleased = 116457472
# HeapObjects = 37464
</code></pre><p>&#x7B2C;&#x4E09;&#x6B21;&#x4EE5;&#x540E;&#x518D;&#x5168;&#x90E8;restart, &#x5360;&#x7528;&#x5C31;&#x5F88;&#x4F4E;&#x4E86;, &#x6700;&#x591A;&#x53EA;&#x5360;&#x5355;&#x6838;&#x7684;10%&#x5DE6;&#x53F3;, &#x4E00;&#x822C;2%. &#x5185;&#x5B58;&#x7A33;&#x5B9A;&#x518D;110M&#x5DE6;&#x53F3;.<br>&#x6211;&#x5F88;&#x597D;&#x5947;&#x73B0;&#x5728;&#x7684;&#x706B;&#x7130;&#x56FE;, &#x4E8E;&#x662F;&#x6293;&#x4E86;&#x4E00;&#x4E2A;:<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913224917.png" alt=""><br><code>runtime.newobject</code>&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x5C0F;&#x4E86;</p>
<p>govm_test&#x7684;&quot;&#x5E94;&#x7528;&#x903B;&#x8F91;&quot;&#x5176;&#x5B9E;&#x5360;&#x6BD4;&#x975E;&#x5E38;&#x5C0F;, &#x5360;&#x7684;&#x591A;&#x7684;&#x4E3B;&#x8981;&#x662F;:</p>
<ul>
<li>park_m stop_m&#x7B49;&#x719F;&#x6089;&#x7684;goroutine&#x548C;M&#x7684;&#x7ED3;&#x5408;&#x52A8;&#x4F5C;.</li>
<li>time.Sleep</li>
<li>futext&#x76F8;&#x5173;.</li>
</ul>
<h3 id="&#x8FDB;&#x4E00;&#x6B65;&#x4F18;&#x5316;&#x601D;&#x8DEF;"><a name="&#x8FDB;&#x4E00;&#x6B65;&#x4F18;&#x5316;&#x601D;&#x8DEF;" class="anchor-navigation-ex-anchor" href="#&#x8FDB;&#x4E00;&#x6B65;&#x4F18;&#x5316;&#x601D;&#x8DEF;"><i class="fa fa-link" aria-hidden="true"></i></a>9.2.3. &#x8FDB;&#x4E00;&#x6B65;&#x4F18;&#x5316;&#x601D;&#x8DEF;</h3>
<p>&#x9700;&#x8981;&#x5728;VM&#x8FD0;&#x884C;&#x7ED3;&#x675F;&#x540E;, &#x91CD;&#x7F6E;stack&#x548C;frame&#x7684;&#x7A7A;&#x95F4;.&#x53BB;&#x6389;object&#x7684;&#x5F15;&#x7528;, &#x89E6;&#x53D1;gc&#x7684;&#x56DE;&#x6536;.
&#x56FA;&#x5B9A;size&#x7684;array</p>
<pre class="language-"><code>stack       [StackSize]Object
frames      [MaxFrames]frame
</code></pre><p>&#x53D8;&#x4E3A;slice, &#x6309;&#x9700;append</p>
<pre class="language-"><code>stack       []Object
frames      []frame
</code></pre><ul>
<li>&#x628A;&#x9759;&#x6001;&#x7684;&#x5185;&#x5B58;&#x5206;&#x914D;&#x6539;&#x6210;&#x52A8;&#x6001;append&#x65B9;&#x5F0F;, &#x7ED9;&#x4E2A;&#x6BD4;&#x8F83;&#x5C0F;&#x7684;&#x521D;&#x59CB;&#x503C;, &#x52A8;&#x6001;&#x6269;&#x5C55;.</li>
<li>&#x5728;VM&#x8FD0;&#x884C;&#x5B8C;&#x6BD5;&#x540E;, &#x901A;&#x8FC7;&#x628A;frame&#x548C;stack&#x7F6E;&#x4E3A;nil&#x7684;&#x65B9;&#x5F0F;, &#x544A;&#x8BC9;gc&#x91CA;&#x653E;&#x5185;&#x5B58;.</li>
</ul>
<p>&#x5177;&#x4F53;&#x4FEE;&#x6539;&#x89C1;<a href="https://github.com/godevsig/tengo/commit/4cfaeebd522880ab8b5f8ed2123b333c8b3a5cb4" target="_blank">&#x8FD9;&#x4E2A;commit</a></p>
<p>&#x7ED3;&#x679C;&#x662F;&#x5168;&#x90E8;restart&#x573A;&#x666F;&#x4E0B;, &#x5B8C;&#x5168;&#x6CA1;&#x6709;24&#x6838;100%&#x5360;&#x7528;&#x7684;&#x60C5;&#x51B5;;htop&#x89C2;&#x5BDF;&#x5230;&#x7269;&#x7406;&#x5185;&#x5B58;&#x7A33;&#x5B9A;&#x5CF0;&#x503C;&#x4ECE;&#x4E4B;&#x524D;&#x7684;200M&#x964D;&#x4F4E;&#x5230;20M.<br>&#x5B9E;&#x9645;&#x4E0A;, idle&#x540E;&#x4F7F;&#x7528;&#x7684;&#x5185;&#x5B58;&#x5927;&#x7EA6;&#x4E3A;10M.<br>&#x4F46;&#x5E76;&#x53D1;&#x7684;&#x5CF0;&#x503C;&#x51CF;&#x5C0F;&#x66F4;&#x80FD;&#x8BF4;&#x660E;, &#x5728;&#x91CD;&#x542F;50&#x4E2A;VM&#x65F6;&#x5019;, &#x7531;&#x4E8E;govm_test&#x5185;&#x90E8;&#x4F1A;&#x8D77;&#x5927;&#x6982;10&#x4E2A;VM, &#x4E00;&#x5171;500&#x4E2A; VM, &#x5E76;&#x6CA1;&#x6709;&#x540C;&#x65F6;&#x7533;&#x8BF7;&#x5927;&#x91CF;&#x5185;&#x5B58;.</p>
<h1 id="goroutine&#x6CC4;&#x6F0F;&#x8C03;&#x8BD5;"><a name="goroutine&#x6CC4;&#x6F0F;&#x8C03;&#x8BD5;" class="anchor-navigation-ex-anchor" href="#goroutine&#x6CC4;&#x6F0F;&#x8C03;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a>10. goroutine&#x6CC4;&#x6F0F;&#x8C03;&#x8BD5;</h1>
<p>topid&#x7A0B;&#x5E8F;&#x6539;&#x6210;goroutine&#x7248;&#x672C;&#x4E4B;&#x540E;, &#x51FA;&#x4E86;&#x5F88;&#x591A;&#x5F88;&#x5178;&#x578B;&#x7684;&#x5E76;&#x53D1;&#x95EE;&#x9898;. &#x5176;&#x4E2D;&#x6709;channel&#x548C;goroutine&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x6CA1;&#x914D;&#x5408;&#x597D;, &#x5BFC;&#x81F4;&#x7684;&#x5361;&#x6B7B;&#x95EE;&#x9898;. &#x5373;channel&#x53D1;&#x9001;&#x6216;&#x8005;&#x8BFB;&#x53D6;&#x7684;&quot;&#x5BF9;&#x7AEF;&quot;goroutine&#x5F02;&#x5E38;&#x6761;&#x4EF6;&#x9000;&#x51FA;&#x4E86;, &#x4F46;&#x6CA1;&#x6709;&#x5904;&#x7406;&#x597D;channel&#x7684;&#x5584;&#x540E;, &#x5BFC;&#x81F4;&#x5BF9;&#x65B9;&#x5361;&#x4F4F;&#x5728;channel&#x64CD;&#x4F5C;. </p>
<p>&#x4F46;goroutine&#x8FD8;&#x662F;&#x5728;&#x6CC4;&#x6F0F;.</p>
<p>&#x95EE;&#x9898;&#x7684;&#x6839;&#x6E90;&#x5728;&#x4E8E;, &#x9760;&#x6811;&#x5F62;&#x7ED3;&#x6784;&#x7684;&#x4E0A;&#x4E00;&#x7EA7;&#x8282;&#x70B9;&#x6765;&#x89E6;&#x53D1;&#x4E0B;&#x4E00;&#x7EA7;&#x52A8;&#x4F5C;&#x7684;&#x65F6;&#x5019;, &#x7A0B;&#x5E8F;&#x7684;&#x601D;&#x8DEF;&#x662F;:<br>&#x5047;&#x8BBE;&#x8FDB;&#x7A0B;A&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x6709;[B1 B2 B3], &#x5728;&#x4E0B;&#x4E00;&#x6B21;&#x89E6;&#x53D1;&#x7684;&#x65F6;&#x5019;, A&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x53D8;&#x6210;&#x4E86;[B2 B3 B4]<br>&#x5176;&#x5185;&#x5728;&#x903B;&#x8F91;&#x662F;, kernel&#x62A5;&#x544A;B1&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x4E86;, &#x4F46;&#x662F;&#x8FD9;&#x91CC;&#x7684;&#x903B;&#x8F91;&#x662F;&#x53EA;&#x65B0;&#x5EFA;B4&#x7684;pidinfo&#x7ED3;&#x6784;.<br>&#x90A3;&#x4E48;B1&#x7684;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x5904;&#x4E8E;&#x4EC0;&#x4E48;&#x72B6;&#x6001;&#x5462;?<br>&#x7B54;&#x6848;&#x662F;B1&#x4F1A;&#x6C38;&#x8FDC;&#x7B49;&#x5F85;&#x89E6;&#x53D1;channel, &#x4F46;&#x6C38;&#x8FDC;&#x6CA1;&#x6709;&#x4EBA;&#x4F1A;&#x5199;&#x8FD9;&#x4E2A;channel. &#x56E0;&#x4E3A;B1&#x5DF2;&#x7ECF;&#x4ECE;A&#x7684;&#x5B50;&#x6811;&#x91CC;&#x62FF;&#x6389;&#x4E86;.<br>&#x8FD9;&#x6837;&#x5C31;&#x9020;&#x6210;&#x4E86;goroutine&#x7684;&#x6CC4;&#x6F0F;.<br>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x662F;&#x5728;B1&#x7684;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x91CC;, &#x540C;&#x65F6;&#x76D1;&#x542C;(select) cleanup channel, A&#x9664;&#x4E86;&#x8981;&#x5904;&#x7406;&#x65B0;&#x5EFA;&#x7684;B4, &#x8FD8;&#x8981;&#x8D1F;&#x8D23;&#x89E6;&#x53D1;B1&#x7684;cleanup</p>
<p>&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x573A;&#x666F;&#x662F; A -&gt; B -&gt; C&#x7684;&#x8FDB;&#x7A0B;&#x94FE;, &#x5982;&#x679C;B&#x548C;C&#x540C;&#x65F6;(&#x4E00;&#x79D2;&#x5185;)&#x90FD;&#x6D88;&#x4EA1;&#x4E86;, &#x90A3;&#x4E48;&#x6309;&#x7167;A&#x89E6;&#x53D1;B, B&#x518D;&#x89E6;&#x53D1;C&#x7684;cleanup&#x903B;&#x8F91;, C&#x6C38;&#x8FDC;&#x4E0D;&#x80FD;&#x88AB;&#x89E6;&#x53D1;, &#x56E0;&#x4E3A;&#x6811;&#x4ECE;&#x9876;&#x5411;&#x4E0B;, &#x5148;&#x89E6;&#x53D1;B&#x7684;cleanup, &#x800C;C&#x5C31;&#x6CA1;&#x6709;&#x673A;&#x4F1A;&#x88AB;B cleanup.<br>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x662F;&#x518D;A&#x89E6;&#x53D1;B&#x7684;cleanup&#x65F6;, &#x9012;&#x5F52;&#x7684;&#x89E6;&#x53D1;B&#x7684;&#x6240;&#x6709;&#x5B50;&#x6811;&#x7684;cleanup.</p>
<h1 id="vscode-debug&#x6A21;&#x5F0F;"><a name="vscode-debug&#x6A21;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#vscode-debug&#x6A21;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>11. vscode debug&#x6A21;&#x5F0F;</h1>
<p>&#x53C2;&#x8003;&#x6587;&#x6863;: <a href="https://github.com/golang/vscode-go/blob/master/docs/debugging.md#remote-debugging" target="_blank">https://github.com/golang/vscode-go/blob/master/docs/debugging.md#remote-debugging</a></p>
<p>&#x4FEE;&#x6539;lauch.json</p>
<pre class="language-"><code class="lang-json"><span class="token punctuation">{</span>
    <span class="token comment">// Use IntelliSense to learn about possible attributes.</span>
    <span class="token comment">// Hover to view descriptions of existing attributes.</span>
    <span class="token comment">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Launch&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;go&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;mode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;auto&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/repo/yingjieb/godev/practice/src/tools/topid.go&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;GOPATH&quot;</span><span class="token operator">:</span><span class="token string">&quot;/go:/repo/yingjieb/godev/practice&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;-p&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-tree&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x6CE8;&#x610F;env&#x548C;args&#x7684;&#x7528;&#x6CD5;</p>
<p>&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x66F4;&#x901A;&#x7528;&#x7684;&#x914D;&#x7F6E;:
&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x9ED8;&#x8BA4;&#x7684;&#x914D;&#x7F6E;&#x76F4;&#x63A5;&#x5C31;&#x80FD;&#x7528;.</p>
<pre class="language-"><code class="lang-json"><span class="token punctuation">{</span>
    <span class="token comment">// Use IntelliSense to learn about possible attributes.</span>
    <span class="token comment">// Hover to view descriptions of existing attributes.</span>
    <span class="token comment">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Launch&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;go&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;mode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;auto&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;${fileDirname}&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x8FD8;&#x662F;&#x8FD9;&#x4E2A;&#x94FE;&#x63A5;&#x6709;&#x8BE6;&#x7EC6;&#x7684;&#x8BF4;&#x660E;: <a href="https://github.com/golang/vscode-go/blob/master/docs/debugging.md#using-vs-code-variables" target="_blank">https://github.com/golang/vscode-go/blob/master/docs/debugging.md#using-vs-code-variables</a></p>
<h2 id="&#x4E3A;&#x4F55;dlv&#x603B;&#x662F;&#x63D0;&#x793A;could-not-load-source"><a name="&#x4E3A;&#x4F55;dlv&#x603B;&#x662F;&#x63D0;&#x793A;could-not-load-source" class="anchor-navigation-ex-anchor" href="#&#x4E3A;&#x4F55;dlv&#x603B;&#x662F;&#x63D0;&#x793A;could-not-load-source"><i class="fa fa-link" aria-hidden="true"></i></a>11.1. &#x4E3A;&#x4F55;dlv&#x603B;&#x662F;&#x63D0;&#x793A;Could not load source</h2>
<p>&#x5373;&#x4F7F;&#x76F4;&#x63A5;&#x542F;&#x52A8;dlv&#x4E5F;&#x6709;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;:</p>
<pre class="language-"><code class="lang-go">dlv exec examples<span class="token operator">/</span>interoperability<span class="token operator">/</span>interoperability
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> b main<span class="token punctuation">.</span>main
Breakpoint <span class="token number">1</span> set at <span class="token number">0x5014eb</span> <span class="token keyword">for</span> main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> github<span class="token punctuation">.</span>com<span class="token operator">/</span>d5<span class="token operator">/</span>tengo<span class="token operator">/</span>v2@<span class="token operator">/</span>examples<span class="token operator">/</span>interoperability<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">185</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> c
<span class="token comment">//&#x80FD;&#x65AD;&#x70B9;, &#x80FD;bt</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> bt
<span class="token number">0</span>  <span class="token number">0x00000000005014eb</span> in main<span class="token punctuation">.</span>main
   at github<span class="token punctuation">.</span>com<span class="token operator">/</span>d5<span class="token operator">/</span>tengo<span class="token operator">/</span>v2@<span class="token operator">/</span>examples<span class="token operator">/</span>interoperability<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">185</span>
<span class="token number">1</span>  <span class="token number">0x000000000042cbf6</span> in runtime<span class="token punctuation">.</span>main
   at runtime<span class="token operator">/</span>proc<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">203</span>
<span class="token number">2</span>  <span class="token number">0x0000000000456c31</span> in runtime<span class="token punctuation">.</span>goexit
   at runtime<span class="token operator">/</span>asm_amd64<span class="token punctuation">.</span>s<span class="token punctuation">:</span><span class="token number">1357</span>
<span class="token comment">//&#x4F46;&#x4E0D;&#x80FD;&#x770B;&#x4EE3;&#x7801;, why????</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> l
<span class="token operator">&gt;</span> main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> github<span class="token punctuation">.</span>com<span class="token operator">/</span>d5<span class="token operator">/</span>tengo<span class="token operator">/</span>v2@<span class="token operator">/</span>examples<span class="token operator">/</span>interoperability<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">185</span> <span class="token punctuation">(</span>hits <span class="token function">goroutine</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">1</span> total<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>PC<span class="token punctuation">:</span> <span class="token number">0x5014eb</span><span class="token punctuation">)</span>
Warning<span class="token punctuation">:</span> debugging optimized function
Command failed<span class="token punctuation">:</span> open github<span class="token punctuation">.</span>com<span class="token operator">/</span>d5<span class="token operator">/</span>tengo<span class="token operator">/</span>v2@<span class="token operator">/</span>examples<span class="token operator">/</span>interoperability<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span> no such file or directory
</code></pre>
<p>&#x56E0;&#x4E3A;&#x6211;hack&#x4E86;go&#x547D;&#x4EE4;, &#x6DFB;&#x52A0;&#x4E86;<code>-trimpath</code>, &#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x628A;&#x6587;&#x4EF6;&#x540D;&#x641E;&#x6210;&#x4E86;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#x4E86;(&#x77ED;&#x8DEF;&#x5F84;). &#x800C;dlv&#x4F9D;&#x8D56;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#x6765;debug...
&#x53BB;&#x6389;<code>-trimpath</code>&#x5C31;&#x597D;&#x4E86;.</p>
<h2 id="&#x6B63;&#x5E38;&#x7684;dlv&#x4F7F;&#x7528;"><a name="&#x6B63;&#x5E38;&#x7684;dlv&#x4F7F;&#x7528;" class="anchor-navigation-ex-anchor" href="#&#x6B63;&#x5E38;&#x7684;dlv&#x4F7F;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>11.2. &#x6B63;&#x5E38;&#x7684;dlv&#x4F7F;&#x7528;</h2>
<pre class="language-"><code class="lang-go">dlv exec <span class="token punctuation">.</span><span class="token operator">/</span>interoperability
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> b main<span class="token punctuation">.</span>main
Breakpoint <span class="token number">1</span> set at <span class="token number">0x5014eb</span> <span class="token keyword">for</span> main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">185</span>
<span class="token punctuation">(</span>dlv<span class="token punctuation">)</span> c
<span class="token operator">&gt;</span> main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">185</span> <span class="token punctuation">(</span>hits <span class="token function">goroutine</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">1</span> total<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>PC<span class="token punctuation">:</span> <span class="token number">0x5014eb</span><span class="token punctuation">)</span>
Warning<span class="token punctuation">:</span> debugging optimized function
<span class="token comment">//&#x80FD;&#x76F4;&#x63A5;&#x663E;&#x793A;&#x4EE3;&#x7801;</span>
</code></pre>
<h1 id="&#x4E00;&#x6B21;&#x7A7A;&#x6307;&#x9488;&#x8BBF;&#x95EE;&#x7684;panic"><a name="&#x4E00;&#x6B21;&#x7A7A;&#x6307;&#x9488;&#x8BBF;&#x95EE;&#x7684;panic" class="anchor-navigation-ex-anchor" href="#&#x4E00;&#x6B21;&#x7A7A;&#x6307;&#x9488;&#x8BBF;&#x95EE;&#x7684;panic"><i class="fa fa-link" aria-hidden="true"></i></a>12. &#x4E00;&#x6B21;&#x7A7A;&#x6307;&#x9488;&#x8BBF;&#x95EE;&#x7684;panic</h1>
<pre class="language-"><code class="lang-go">yingjieb@3a9f377eee5d <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>pidinfo
$ <span class="token keyword">go</span> test <span class="token operator">-</span>run xxxxxx <span class="token operator">-</span>bench BenchmarkP1InfoUpdate <span class="token operator">-</span>cpuprofile cpuiter<span class="token punctuation">.</span>out
goos<span class="token punctuation">:</span> linux
goarch<span class="token punctuation">:</span> amd64
pkg<span class="token punctuation">:</span> pidinfo
BenchmarkP1InfoUpdate<span class="token operator">-</span><span class="token number">23</span>        <span class="token builtin">panic</span><span class="token punctuation">:</span> runtime <span class="token builtin">error</span><span class="token punctuation">:</span> invalid memory address or <span class="token boolean">nil</span> pointer dereference
<span class="token punctuation">[</span>signal SIGSEGV<span class="token punctuation">:</span> segmentation violation code<span class="token operator">=</span><span class="token number">0x1</span> addr<span class="token operator">=</span><span class="token number">0x50</span> pc<span class="token operator">=</span><span class="token number">0x5046c9</span><span class="token punctuation">]</span>

goroutine <span class="token number">54</span> <span class="token punctuation">[</span>running<span class="token punctuation">]</span><span class="token punctuation">:</span>
pidinfo<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>PidInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateTime</span><span class="token punctuation">(</span><span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
        <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>pidinfo<span class="token operator">/</span>pidinfo<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">227</span> <span class="token operator">+</span><span class="token number">0x59</span>
pidinfo<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>PidInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0xc0000905d0</span><span class="token punctuation">,</span> <span class="token number">0x6f7e</span><span class="token punctuation">)</span>
        <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>pidinfo<span class="token operator">/</span>pidinfo<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">302</span> <span class="token operator">+</span><span class="token number">0x32</span>
pidinfo<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>PidInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token number">0xc0001e03c0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
        <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>pidinfo<span class="token operator">/</span>pidinfo<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">206</span> <span class="token operator">+</span><span class="token number">0x35e</span>
pidinfo<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>PidInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token number">0xc0001e03c0</span><span class="token punctuation">,</span> <span class="token number">0xc000090570</span><span class="token punctuation">,</span> <span class="token number">0x4507</span><span class="token punctuation">)</span>
        <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>pidinfo<span class="token operator">/</span>pidinfo<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">307</span> <span class="token operator">+</span><span class="token number">0x70</span>
pidinfo<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>PidInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token number">0xc0001e0320</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
        <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>pidinfo<span class="token operator">/</span>pidinfo<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">206</span> <span class="token operator">+</span><span class="token number">0x35e</span>
pidinfo<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>PidInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token number">0xc0001e0320</span><span class="token punctuation">,</span> <span class="token number">0xc000090450</span><span class="token punctuation">,</span> <span class="token number">0x11</span><span class="token punctuation">)</span>
        <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>pidinfo<span class="token operator">/</span>pidinfo<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">307</span> <span class="token operator">+</span><span class="token number">0x70</span>
pidinfo<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>PidInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token number">0xc0001e00a0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
        <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>pidinfo<span class="token operator">/</span>pidinfo<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">206</span> <span class="token operator">+</span><span class="token number">0x35e</span>
pidinfo<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>PidInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token number">0xc0001e00a0</span><span class="token punctuation">,</span> <span class="token number">0xc000090270</span><span class="token punctuation">,</span> <span class="token number">0xc000451d68</span><span class="token punctuation">)</span>
        <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>pidinfo<span class="token operator">/</span>pidinfo<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">307</span> <span class="token operator">+</span><span class="token number">0x70</span>
pidinfo<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>PidInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token number">0xc0001e0000</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
        <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>pidinfo<span class="token operator">/</span>pidinfo<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">216</span> <span class="token operator">+</span><span class="token number">0x2c1</span>
pidinfo<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>PidInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token number">0xc0001e0000</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
        <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>pidinfo<span class="token operator">/</span>pidinfo<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">307</span> <span class="token operator">+</span><span class="token number">0x70</span>
pidinfo<span class="token punctuation">.</span><span class="token function">BenchmarkP1InfoUpdate</span><span class="token punctuation">(</span><span class="token number">0xc0001f41c0</span><span class="token punctuation">)</span>
        <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>pidinfo<span class="token operator">/</span>pidinfo_test<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">77</span> <span class="token operator">+</span><span class="token number">0x16f</span>
testing<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>B<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runN</span><span class="token punctuation">(</span><span class="token number">0xc0001f41c0</span><span class="token punctuation">,</span> <span class="token number">0x5b8</span><span class="token punctuation">)</span>
        <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>testing<span class="token operator">/</span>benchmark<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">190</span> <span class="token operator">+</span><span class="token number">0xcc</span>
testing<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>B<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token number">0xc0001f41c0</span><span class="token punctuation">)</span>
        <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>testing<span class="token operator">/</span>benchmark<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">320</span> <span class="token operator">+</span><span class="token number">0x10c</span>
created by testing<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>B<span class="token punctuation">)</span><span class="token punctuation">.</span>doBench
        <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>testing<span class="token operator">/</span>benchmark<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">275</span> <span class="token operator">+</span><span class="token number">0x55</span>
exit status <span class="token number">2</span>
FAIL    pidinfo <span class="token number">0</span><span class="token punctuation">.</span>592s
</code></pre>
<ul>
<li>error&#x5E94;&#x8BE5;&#x662F;&#x5360;&#x4E24;&#x4E2A;&quot;&#x4F4D;&#x7F6E;&quot;</li>
<li>&#x80FD;&#x6253;&#x51FA;&#x8C03;&#x7528;&#x6808;&#x6765;&#x7684;, &#x90A3;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x4F4D;&#x7F6E;<strong>&#x6CA1;&#x6709;</strong>&#x610F;&#x4E49;, &#x56E0;&#x4E3A;&#x5E95;&#x5C42;&#x51FD;&#x6570;&#x8FD8;&#x6CA1;&#x6709;&#x8FD4;&#x56DE;.</li>
</ul>
<h2 id="&#x8C03;&#x7528;&#x6808;&#x89E3;&#x6790;&#x548C;&#x53C2;&#x6570;&#x89E3;&#x8BFB;"><a name="&#x8C03;&#x7528;&#x6808;&#x89E3;&#x6790;&#x548C;&#x53C2;&#x6570;&#x89E3;&#x8BFB;" class="anchor-navigation-ex-anchor" href="#&#x8C03;&#x7528;&#x6808;&#x89E3;&#x6790;&#x548C;&#x53C2;&#x6570;&#x89E3;&#x8BFB;"><i class="fa fa-link" aria-hidden="true"></i></a>12.1. &#x8C03;&#x7528;&#x6808;&#x89E3;&#x6790;&#x548C;&#x53C2;&#x6570;&#x89E3;&#x8BFB;</h2>
<p>&#x7ECF;&#x5E38;&#x770B;&#x5230;, &#x8C03;&#x7528;&#x6808;&#x6253;&#x5370;&#x7684;&#x53C2;&#x6570;&#x6BD4;&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x65F6;&#x7684;&#x53C2;&#x6570;&#x4E2A;&#x6570;&#x8981;&#x591A;, &#x4E3A;&#x4EC0;&#x4E48;&#x5462;?<br>&#x539F;&#x6587;: <a href="https://www.ardanlabs.com/blog/2015/01/stack-traces-in-go.html" target="_blank">https://www.ardanlabs.com/blog/2015/01/stack-traces-in-go.html</a></p>
<p>&#x8FD9;&#x8981;&#x7406;&#x89E3;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x53C2;&#x6570;&#x7684;&#x4F20;&#x9012;&#x89C4;&#x5219;:</p>
<h3 id="&#x5207;&#x7247;-&#x5B57;&#x7B26;&#x4E32;-&#x548C;int"><a name="&#x5207;&#x7247;-&#x5B57;&#x7B26;&#x4E32;-&#x548C;int" class="anchor-navigation-ex-anchor" href="#&#x5207;&#x7247;-&#x5B57;&#x7B26;&#x4E32;-&#x548C;int"><i class="fa fa-link" aria-hidden="true"></i></a>12.1.1. &#x5207;&#x7247;, &#x5B57;&#x7B26;&#x4E32;, &#x548C;int</h3>
<pre class="language-"><code class="lang-go"><span class="token comment">// Declaration</span>
main<span class="token punctuation">.</span><span class="token function">Example</span><span class="token punctuation">(</span>slice <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> str <span class="token builtin">string</span><span class="token punctuation">,</span> i <span class="token builtin">int</span><span class="token punctuation">)</span>

<span class="token comment">// Call to Example by main.</span>
slice <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token function">Example</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>

<span class="token comment">// Stack trace</span>
main<span class="token punctuation">.</span><span class="token function">Example</span><span class="token punctuation">(</span><span class="token number">0x2080c3f50</span><span class="token punctuation">,</span> <span class="token number">0x2</span><span class="token punctuation">,</span> <span class="token number">0x4</span><span class="token punctuation">,</span> <span class="token number">0x425c0</span><span class="token punctuation">,</span> <span class="token number">0x5</span><span class="token punctuation">,</span> <span class="token number">0xa</span><span class="token punctuation">)</span>

<span class="token comment">//&#x89E3;&#x91CA;&#x5207;&#x7247;:</span>
<span class="token comment">// Slice header values</span>
Pointer<span class="token punctuation">:</span>  <span class="token number">0x2080c3f50</span>
Length<span class="token punctuation">:</span>   <span class="token number">0x2</span>
Capacity<span class="token punctuation">:</span> <span class="token number">0x4</span>

<span class="token comment">//&#x89E3;&#x91CA;&#x5B57;&#x7B26;&#x4E32;</span>
<span class="token comment">// String parameter value</span>
<span class="token string">&quot;hello&quot;</span>

<span class="token comment">// String header values</span>
Pointer<span class="token punctuation">:</span> <span class="token number">0x425c0</span>
Length<span class="token punctuation">:</span>  <span class="token number">0x5</span>
</code></pre>
<p>&#x6211;&#x5B9E;&#x9A8C;&#x7684;&#x7248;&#x672C;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    slice <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
    m <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token string">&quot;1st&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;2nd&quot;</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">}</span>
    <span class="token function">Example</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Example</span><span class="token punctuation">(</span>slice <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> str <span class="token builtin">string</span><span class="token punctuation">,</span> i <span class="token builtin">int</span><span class="token punctuation">,</span> m <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> str<span class="token punctuation">,</span> i<span class="token punctuation">,</span> m<span class="token punctuation">)</span> <span class="token comment">//&#x6CA1;&#x6709;&#x8FD9;&#x884C;fmt, &#x4F3C;&#x4E4E;&#x7ED3;&#x679C;&#x91CC;&#x7684;&#x53C2;&#x6570;&#x53EA;&#x663E;&#x793A;..., &#x5E94;&#x8BE5;&#x662F;&#x7F16;&#x8BD1;&#x5668;&#x81EA;&#x52A8;&#x4F18;&#x5316;&#x8FC7;&#x4E86;</span>
    <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;Want stack trace&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//&#x7ED3;&#x679C;:</span>
$ <span class="token punctuation">.</span><span class="token operator">/</span>tmp
<span class="token punctuation">[</span> <span class="token punctuation">]</span> hello <span class="token number">136</span> <span class="token keyword">map</span><span class="token punctuation">[</span>1st<span class="token punctuation">:</span><span class="token number">1</span> 2nd<span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span>
<span class="token builtin">panic</span><span class="token punctuation">:</span> Want stack trace

goroutine <span class="token number">1</span> <span class="token punctuation">[</span>running<span class="token punctuation">]</span><span class="token punctuation">:</span>
main<span class="token punctuation">.</span><span class="token function">Example</span><span class="token punctuation">(</span><span class="token number">0xc0000c8040</span><span class="token punctuation">,</span> <span class="token number">0x2</span><span class="token punctuation">,</span> <span class="token number">0x4</span><span class="token punctuation">,</span> <span class="token number">0x4c24f9</span><span class="token punctuation">,</span> <span class="token number">0x5</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0xc0000cc000</span><span class="token punctuation">)</span>
        <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>misc<span class="token operator">/</span>tmp<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">13</span> <span class="token operator">+</span><span class="token number">0x16c</span>
main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>misc<span class="token operator">/</span>tmp<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">8</span> <span class="token operator">+</span><span class="token number">0x114</span>
</code></pre>
<p>&#x6CE8;&#x610F;0x88&#x540E;&#x9762;&#x90A3;&#x4E2A;map, &#x53EA;&#x5360;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;, &#x6240;&#x4EE5;map&#x662F;&#x4E2A;&#x6307;&#x9488;.</p>
<ul>
<li>&#x5207;&#x7247;&#x662F;&#x4E2A;&#x4E09;&#x4E2A;&#x503C;&#x7684;&#x7ED3;&#x6784;, &#x6307;&#x9488;, len&#x548C;cap<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913231335.png" alt="">  </li>
<li>&#x5B57;&#x7B26;&#x4E32;&#x662F;2&#x4E2A;&#x503C;&#x7684;&#x7ED3;&#x6784;, &#x6307;&#x9488;, len<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913231404.png" alt="">  </li>
<li>&#x6574;&#x578B;&#x53C2;&#x6570;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x503C;</li>
<li>map&#x53C2;&#x6570;&#x662F;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;</li>
</ul>
<h3 id="&#x53D8;&#x957F;&#x53C2;&#x6570;"><a name="&#x53D8;&#x957F;&#x53C2;&#x6570;" class="anchor-navigation-ex-anchor" href="#&#x53D8;&#x957F;&#x53C2;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>12.1.2. &#x53D8;&#x957F;&#x53C2;&#x6570;</h3>
<p>&#x6BD4;&#x5982;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">panicFmt</span><span class="token punctuation">(</span>v <span class="token operator">...</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    &#x4E3B;&#x52A8;<span class="token builtin">panic</span>
<span class="token punctuation">}</span>
#&#x5728;main&#x91CC;&#x8C03;&#x7528;
<span class="token function">panicFmt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
&#x6216;
<span class="token function">panicFmt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>

#&#x7ED3;&#x679C;
goroutine <span class="token number">1</span> <span class="token punctuation">[</span>running<span class="token punctuation">]</span><span class="token punctuation">:</span>
main<span class="token punctuation">.</span><span class="token function">panicFmt</span><span class="token punctuation">(</span><span class="token number">0xc0000a2150</span><span class="token punctuation">,</span> <span class="token number">0x3</span><span class="token punctuation">,</span> <span class="token number">0x3</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x7ED3;&#x8BBA;: &#x4E0D;&#x7BA1;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x5165;&#x53C2;, &#x90FD;&#x662F;&#x5148;&#x7EC4;&#x6210;&#x4E00;&#x4E2A;slice, &#x518D;&#x4F20;&#x7ED9;panicFmt&#x51FD;&#x6570;.
slice&#x7684;&#x8868;&#x8FBE;&#x662F;3&#x4E2A;&#x503C;.</p>
<h3 id="interface"><a name="interface" class="anchor-navigation-ex-anchor" href="#interface"><i class="fa fa-link" aria-hidden="true"></i></a>12.1.3. interface</h3>
<p>interface&#x662F;2&#x4E2A;&#x503C;, &#x51C6;&#x786E;&#x7684;&#x8BF4;&#x662F;&#x4E24;&#x4E2A;&#x6307;&#x9488;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> eface <span class="token keyword">struct</span> <span class="token punctuation">{</span> <span class="token comment">// 16 bytes</span>
    _type <span class="token operator">*</span>_type
    data  unsafe<span class="token punctuation">.</span>Pointer
<span class="token punctuation">}</span>

<span class="token keyword">type</span> iface <span class="token keyword">struct</span> <span class="token punctuation">{</span> <span class="token comment">// 16 bytes</span>
    tab  <span class="token operator">*</span>itab
    data unsafe<span class="token punctuation">.</span>Pointer
<span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x65B9;&#x6CD5;"><a name="&#x65B9;&#x6CD5;" class="anchor-navigation-ex-anchor" href="#&#x65B9;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a>12.1.4. &#x65B9;&#x6CD5;</h3>
<p>&#x5BF9;&#x8C61;&#x7684;&#x65B9;&#x6CD5;&#x8C03;&#x7528;, call trace&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x90A3;&#x4E2A;&#x5BF9;&#x8C61;</p>
<h3 id="&#x53C2;&#x6570;packing"><a name="&#x53C2;&#x6570;packing" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;packing"><i class="fa fa-link" aria-hidden="true"></i></a>12.1.5. &#x53C2;&#x6570;packing</h3>
<p>&#x5982;&#x679C;&#x53C2;&#x6570;&#x62FC;&#x5728;&#x4E00;&#x8D77;&#x80FD;&#x591F;&#x653E;&#x5728;&#x4E00;&#x4E2A;word&#x91CC;, &#x90A3;&#x4E48;go&#x4F1A;&#x81EA;&#x52A8;&#x7684;&#x628A;&#x8FD9;&#x51E0;&#x4E2A;&#x53C2;&#x6570;<strong>pack</strong>&#x5728;&#x4E00;&#x4E2A;word&#x91CC;, &#x653E;&#x5728;&#x6808;&#x4E0A;&#x4F20;&#x9012;<br>&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;, 3&#x4E2A;bool&#x53D8;&#x91CF;&#x548C;&#x4E00;&#x4E2A;uint8&#x88AB;&#x62FC;&#x5728;&#x4E00;&#x4E2A;32&#x4F4D;&#x7684;&quot;&#x53C2;&#x6570;&quot;&#x91CC;
bool&#x7C7B;&#x578B;&#x4E5F;&#x662F;8bit</p>
<pre class="language-"><code class="lang-go"><span class="token number">01</span> <span class="token keyword">package</span> main
<span class="token number">02</span>
<span class="token number">03</span> <span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">04</span>     <span class="token function">Example</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>
<span class="token number">05</span> <span class="token punctuation">}</span>
<span class="token number">06</span>
<span class="token number">07</span> <span class="token keyword">func</span> <span class="token function">Example</span><span class="token punctuation">(</span>b1<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> b3 <span class="token builtin">bool</span><span class="token punctuation">,</span> i <span class="token builtin">uint8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">08</span>     <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;Want stack trace&quot;</span><span class="token punctuation">)</span>
<span class="token number">09</span> <span class="token punctuation">}</span>

<span class="token comment">//&#x7ED3;&#x679C;:</span>
<span class="token number">01</span> goroutine <span class="token number">1</span> <span class="token punctuation">[</span>running<span class="token punctuation">]</span><span class="token punctuation">:</span>
<span class="token number">02</span> main<span class="token punctuation">.</span><span class="token function">Example</span><span class="token punctuation">(</span><span class="token number">0x19010001</span><span class="token punctuation">)</span>
           <span class="token operator">/</span>Users<span class="token operator">/</span>bill<span class="token operator">/</span>Spaces<span class="token operator">/</span>Go<span class="token operator">/</span>Projects<span class="token operator">/</span>src<span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>goinaction<span class="token operator">/</span>code<span class="token operator">/</span>
           temp<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">8</span> <span class="token operator">+</span><span class="token number">0x64</span>
<span class="token number">03</span> main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token operator">/</span>Users<span class="token operator">/</span>bill<span class="token operator">/</span>Spaces<span class="token operator">/</span>Go<span class="token operator">/</span>Projects<span class="token operator">/</span>src<span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>goinaction<span class="token operator">/</span>code<span class="token operator">/</span>
           temp<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">4</span> <span class="token operator">+</span><span class="token number">0x32</span>
</code></pre>
<p>&#x89E3;&#x91CA;: &#x611F;&#x89C9;&#x662F;&#x5148;&#x62FC;&#x7B2C;&#x4E00;&#x4E2A;&#x539F;&#x59CB;&#x53C2;&#x6570;, &#x79FB;&#x4F4D;, &#x518D;&#x62FC;&#x7B2C;&#x4E8C;&#x4E2A;&#x539F;&#x59CB;&#x53C2;&#x6570;...</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// Parameter values</span>
<span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">25</span>

<span class="token comment">// Word value</span>
Bits    Binary      Hex   Value
<span class="token number">00</span><span class="token operator">-</span><span class="token number">07</span>   <span class="token number">0000</span> <span class="token number">0001</span>   <span class="token number">01</span>    <span class="token boolean">true</span>
<span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span>   <span class="token number">0000</span> <span class="token number">0000</span>   <span class="token number">00</span>    <span class="token boolean">false</span>
<span class="token number">16</span><span class="token operator">-</span><span class="token number">23</span>   <span class="token number">0000</span> <span class="token number">0001</span>   <span class="token number">01</span>    <span class="token boolean">true</span>
<span class="token number">24</span><span class="token operator">-</span><span class="token number">31</span>   <span class="token number">0001</span> <span class="token number">1001</span>   <span class="token number">19</span>    <span class="token number">25</span>

<span class="token comment">// Declaration</span>
main<span class="token punctuation">.</span><span class="token function">Example</span><span class="token punctuation">(</span>b1<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> b3 <span class="token builtin">bool</span><span class="token punctuation">,</span> i <span class="token builtin">uint8</span><span class="token punctuation">)</span>

<span class="token comment">// Stack trace</span>
main<span class="token punctuation">.</span><span class="token function">Example</span><span class="token punctuation">(</span><span class="token number">0x19010001</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="&#x8FD4;&#x56DE;&#x503C;"><a name="&#x8FD4;&#x56DE;&#x503C;" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;"><i class="fa fa-link" aria-hidden="true"></i></a>12.1.6. &#x8FD4;&#x56DE;&#x503C;</h3>
<p>&#x8FD4;&#x56DE;&#x503C;&#x5728;&#x5BF9;&#x8C61;, &#x5165;&#x53C2;&#x4E4B;&#x540E;. &#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x6765;&#x8BF4;, &#x6700;&#x540E;&#x7684;&#x4E24;&#x4E2A;&#x503C;&#x5C31;&#x662F;&#x8FD4;&#x56DE;&#x503C;. &#x5982;&#x679C;&#x662F;&#x8FD4;&#x56DE;int&#x548C;string, &#x90A3;string&#x662F;&#x4E24;&#x4E2A;&#x503C;(&#x6307;&#x9488;&#x548C;&#x957F;&#x5EA6;)</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>sum <span class="token builtin">int</span><span class="token punctuation">,</span> tag <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> a <span class="token operator">+</span> b
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    <span class="token keyword">if</span> c <span class="token operator">&gt;</span> <span class="token number">64</span> <span class="token punctuation">{</span>
        <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;aaaaa&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%p\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">)</span>
    <span class="token keyword">return</span> c<span class="token punctuation">,</span> c<span class="token operator">+</span><span class="token number">10</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//&#x8F93;&#x51FA;:</span>
<span class="token number">7</span>
<span class="token number">0xc000020028</span>
<span class="token number">72</span>
<span class="token builtin">panic</span><span class="token punctuation">:</span> aaaaa

goroutine <span class="token number">1</span> <span class="token punctuation">[</span>running<span class="token punctuation">]</span><span class="token punctuation">:</span>
<span class="token comment">//&#x8FD4;&#x56DE;&#x503C;&#x597D;&#x50CF;&#x4E5F;&#x662F;&#x5728;&#x6808;&#x91CC;&#x7684;, &#x7B2C;&#x4E09;&#x4E2A;&#x503C;&#x548C;&#x7B2C;&#x56DB;&#x4E2A;&#x503C;&#x5176;&#x5B9E;&#x662F;&#x4E0A;&#x6B21;&#x7684;&#x8FD4;&#x56DE;&#x503C;.</span>
<span class="token comment">//&#x672C;&#x6B21;&#x8FD8;&#x6CA1;&#x6709;&#x8FD4;&#x56DE;&#x503C;&#x5C31;panic&#x4E86;, &#x8FD4;&#x56DE;&#x503C;&#x662F;&#x6808;&#x91CC;&#x7684;&#x503C;. &#x6B63;&#x597D;&#x662F;&#x4E0A;&#x6B21;&#x7559;&#x4E0B;&#x6765;&#x7684;&#x8FD4;&#x56DE;&#x503C;</span>
main<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">,</span> <span class="token number">0x8</span><span class="token punctuation">,</span> <span class="token number">0x7</span><span class="token punctuation">,</span> <span class="token number">0x11</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>benchmarks<span class="token operator">/</span>hashmap<span class="token operator">/</span>pidinfomap<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">9</span> <span class="token operator">+</span><span class="token number">0x167</span>
main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>repo<span class="token operator">/</span>yingjieb<span class="token operator">/</span>godev<span class="token operator">/</span>practice<span class="token operator">/</span>src<span class="token operator">/</span>benchmarks<span class="token operator">/</span>hashmap<span class="token operator">/</span>pidinfomap<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">18</span> <span class="token operator">+</span><span class="token number">0x49</span>
exit status <span class="token number">2</span>
</code></pre>
<h3 id="&#x7ED3;&#x6784;&#x4F53;"><a name="&#x7ED3;&#x6784;&#x4F53;" class="anchor-navigation-ex-anchor" href="#&#x7ED3;&#x6784;&#x4F53;"><i class="fa fa-link" aria-hidden="true"></i></a>12.1.7. &#x7ED3;&#x6784;&#x4F53;</h3>
<p>&#x7ED3;&#x6784;&#x4F53;(&#x975E;&#x7ED3;&#x6784;&#x4F53;&#x6307;&#x9488;)&#x4E0D;&#x7BA1;&#x662F;&#x5165;&#x53C2;&#x8FD8;&#x662F;&#x8FD4;&#x56DE;&#x503C;, &#x90FD;&#x76F4;&#x63A5;&#x5C55;&#x5F00;&#x5728;&#x6808;&#x4E0A;&#x4F20;&#x9012;
&#x6BD4;&#x5982;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> eee <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>e <span class="token builtin">int</span>
    s <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">,</span> e eee<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> a <span class="token operator">+</span> b
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    <span class="token keyword">if</span> c <span class="token operator">&gt;</span> <span class="token number">64</span> <span class="token punctuation">{</span>
        <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;aaaaa&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%p\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">)</span>
    <span class="token comment">//return eee{1, 2, 3, 4, 5, &quot;sssssss&quot;}</span>
<span class="token punctuation">}</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> eee<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;sssssss&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//panic&#x7684;&#x65F6;&#x5019;</span>
goroutine <span class="token number">1</span> <span class="token punctuation">[</span>running<span class="token punctuation">]</span><span class="token punctuation">:</span>
main<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">,</span> <span class="token number">0x8</span><span class="token punctuation">,</span> <span class="token number">0x1</span><span class="token punctuation">,</span> <span class="token number">0x2</span><span class="token punctuation">,</span> <span class="token number">0x3</span><span class="token punctuation">,</span> <span class="token number">0x4</span><span class="token punctuation">,</span> <span class="token number">0x5</span><span class="token punctuation">,</span> <span class="token number">0x4c3839</span><span class="token punctuation">,</span> <span class="token number">0x7</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="&#x6307;&#x9488;"><a name="&#x6307;&#x9488;" class="anchor-navigation-ex-anchor" href="#&#x6307;&#x9488;"><i class="fa fa-link" aria-hidden="true"></i></a>12.1.8. &#x6307;&#x9488;</h3>
<p>callstack&#x91CC;&#x9762;, &#x6307;&#x9488;&#x53EA;&#x5360;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;.</p>
<h1 id="slice&#x7684;make&#x548C;append&#x6027;&#x80FD;"><a name="slice&#x7684;make&#x548C;append&#x6027;&#x80FD;" class="anchor-navigation-ex-anchor" href="#slice&#x7684;make&#x548C;append&#x6027;&#x80FD;"><i class="fa fa-link" aria-hidden="true"></i></a>13. slice&#x7684;make&#x548C;append&#x6027;&#x80FD;</h1>
<p>&#x8FD8;&#x662F;&#x5728;pidinfo&#x4EE3;&#x7801;&#x91CC;&#x9762;
&#x88AB;&#x6D4B;&#x51FD;&#x6570;&#x6839;&#x636E;map, &#x521B;&#x5EFA;&#x4E2A;&#x5207;&#x7247;&#x8FD4;&#x56DE;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// Children returns first level children nodes</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>pi <span class="token operator">*</span>PidInfo<span class="token punctuation">)</span> <span class="token function">Children</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>PidInfo <span class="token punctuation">{</span>
    <span class="token comment">//&#x540E;&#x9762;&#x7684;&#x51E0;&#x4E2A;&#x6D4B;&#x8BD5;&#x90FD;&#x53EA;&#x6539;&#x8FD9;&#x91CC;, &#x4E3B;&#x8981;&#x662F;&#x6539;children&#x5207;&#x7247;&#x7684;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6CD5;</span>
    <span class="token comment">//&#x4E0D;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#x5DEE;&#x522B;&#x975E;&#x5E38;&#x5927;</span>
    <span class="token keyword">var</span> children <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>PidInfo
    <span class="token comment">//children := make([]*PidInfo, 100)</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> child <span class="token operator">:=</span> <span class="token keyword">range</span> pi<span class="token punctuation">.</span>children <span class="token punctuation">{</span>
        children <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>children<span class="token punctuation">,</span> child<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> children
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5176;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x5982;&#x4E0B;:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">BenchmarkMapInter</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pi<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">NewPidInfo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        b<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;main: %v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> err <span class="token operator">:=</span> pi<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        b<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;main: %v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    b<span class="token punctuation">.</span><span class="token function">ResetTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        <span class="token boolean">_</span> <span class="token operator">=</span> pi<span class="token punctuation">.</span><span class="token function">Children</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x672C;&#x610F;&#x662F;&#x60F3;&#x6D4B;&#x8BD5;map&#x8868;&#x7684;&#x904D;&#x5386;&#x6548;&#x7387;, &#x6CA1;&#x60F3;&#x5230;&#x5207;&#x7247;&#x7684;make&#x548C;append&#x6548;&#x7387;&#x624D;&#x662F;&#x74F6;&#x9888;. &#x5E94;&#x8BE5;&#x548C;&#x5207;&#x7247;&#x7684;&#x7C7B;&#x578B;&#x662F;&#x7ED3;&#x6784;&#x4F53;&#x6307;&#x9488;&#x6709;&#x5173;.</p>
<h2 id="&#x53EA;&#x58F0;&#x660E;&#x5207;&#x7247;----400-nsop"><a name="&#x53EA;&#x58F0;&#x660E;&#x5207;&#x7247;----400-nsop" class="anchor-navigation-ex-anchor" href="#&#x53EA;&#x58F0;&#x660E;&#x5207;&#x7247;----400-nsop"><i class="fa fa-link" aria-hidden="true"></i></a>13.1. &#x53EA;&#x58F0;&#x660E;&#x5207;&#x7247; -- 400 ns/op</h2>
<p><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913232805.png" alt=""><br>&#x8FED;&#x4EE3;map&#x5360;&#x6BD4;25%, &#x5207;&#x7247;&#x64CD;&#x4F5C;&#x5360;&#x6BD4;56%. &#x4E3A;&#x4EC0;&#x4E48;&#x5207;&#x7247;&#x6BD4;map&#x8FD8;&#x8D39;&#x4E8B;&#x5462;?<br>&#x770B;&#x8D77;&#x6765;&#x5BF9;&#x5207;&#x7247;&#x7684;&#x64CD;&#x4F5C;append&#x662F;runtime.growslice, &#x800C;&#x5B83;&#x4F1A;&#x8C03;&#x7528;mallocgc&#x7533;&#x8BF7;&#x5185;&#x5B58;.<br>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x521B;&#x5EFA;gc&#x5462;? &#x6240;&#x6709;&#x7C7B;&#x578B;&#x7684;&#x5207;&#x7247;&#x90FD;&#x8981;&#x521B;&#x5EFA;GC&#x5417;? &#x8FD9;&#x4E2A;&#x521B;&#x5EFA;gc&#x7684;&#x52A8;&#x4F5C;&#x548C;&#x5207;&#x7247;&#x7684;size&#x6709;&#x5173;&#x5417;?</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// growslice handles slice growth during append.</span>
<span class="token comment">// It is passed the slice element type, the old slice, and the desired new minimum capacity,</span>
<span class="token comment">// and it returns a new slice with at least that capacity, with the old data</span>
<span class="token comment">// copied into it.</span>
<span class="token comment">// The new slice&apos;s length is set to the old slice&apos;s length,</span>
<span class="token comment">// NOT to the new requested capacity.</span>
<span class="token comment">// This is for codegen convenience. The old slice&apos;s length is used immediately</span>
<span class="token comment">// to calculate where to write new values during an append.</span>
<span class="token comment">// TODO: When the old backend is gone, reconsider this decision.</span>
<span class="token comment">// The SSA backend might prefer the new length or to return only ptr/cap and save stack space.</span>
<span class="token keyword">func</span> <span class="token function">growslice</span><span class="token punctuation">(</span>et <span class="token operator">*</span>_type<span class="token punctuation">,</span> old slice<span class="token punctuation">,</span> <span class="token builtin">cap</span> <span class="token builtin">int</span><span class="token punctuation">)</span> slice <span class="token punctuation">{</span>
    <span class="token comment">//&#x6839;&#x636E;et&#x7684;&#x7C7B;&#x578B;&#x786E;&#x5B9A;&#x6269;&#x5927;&#x6BD4;&#x4F8B;</span>
    <span class="token comment">//et.ptrdata&#x7684;&#x89E3;&#x91CA;&#x662F; size of memory prefix holding all pointers</span>
    <span class="token keyword">if</span> et<span class="token punctuation">.</span>ptrdata <span class="token operator">==</span> <span class="token number">0</span>
        p <span class="token operator">=</span> <span class="token function">mallocgc</span><span class="token punctuation">(</span>capmem<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span>
        p <span class="token operator">=</span> <span class="token function">mallocgc</span><span class="token punctuation">(</span>capmem<span class="token punctuation">,</span> et<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token function">memmove</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> old<span class="token punctuation">.</span>array<span class="token punctuation">,</span> lenmem<span class="token punctuation">)</span>
    <span class="token keyword">return</span> slice<span class="token punctuation">{</span>p<span class="token punctuation">,</span> old<span class="token punctuation">.</span><span class="token builtin">len</span><span class="token punctuation">,</span> newcap<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Allocate an object of size bytes.</span>
<span class="token comment">// Small objects are allocated from the per-P cache&apos;s free lists.</span>
<span class="token comment">// Large objects (&gt; 32 kB) are allocated straight from the heap.</span>
<span class="token keyword">func</span> <span class="token function">mallocgc</span><span class="token punctuation">(</span>size <span class="token builtin">uintptr</span><span class="token punctuation">,</span> typ <span class="token operator">*</span>_type<span class="token punctuation">,</span> needzero <span class="token builtin">bool</span><span class="token punctuation">)</span> unsafe<span class="token punctuation">.</span>Pointer <span class="token punctuation">{</span>
    <span class="token comment">//type&#x662F;nil&#x6216;&#x8005;&#x4E0D;&#x5305;&#x62EC;&#x6307;&#x9488;, &#x5C31;&#x4E0D;&#x7528;scan&#x4E86;</span>
    noscan <span class="token operator">:=</span> typ <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> typ<span class="token punctuation">.</span>ptrdata <span class="token operator">==</span> <span class="token number">0</span>
    <span class="token comment">//&#x8981;&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;</span>
    dataSize <span class="token operator">:=</span> size
    c <span class="token operator">:=</span> <span class="token function">gomcache</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//&#x5C0F;&#x4E8E;32K&#x5728;M&#x7684;cache&#x91CC;&#x9762;&#x5206;</span>
    <span class="token comment">//&#x5927;&#x4E8E;32K&#x4ECE;&#x5806;&#x91CC;&#x5206;</span>

    <span class="token comment">//&#x5982;&#x679C;&#x8981;scan</span>
        <span class="token comment">// It is known that the type has pointers somewhere;</span>
        <span class="token comment">//&#x80FD;&#x8C03;&#x5230;&#x8FD9;&#x91CC;, &#x8BF4;&#x660E;&#x5143;&#x7D20;&#x7C7B;&#x578B;&#x91CC;&#x9762;&#x67D0;&#x4E9B;&#x5730;&#x65B9;&#x6709;&#x6307;&#x9488;</span>
        <span class="token comment">//&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x975E;&#x5E38;&#x975E;&#x5E38;&#x590D;&#x6742;!!!!!</span>
        <span class="token comment">// heapBitsSetType records that the new allocation [x, x+size)</span>
        <span class="token comment">// holds in [x, x+dataSize) one or more values of type typ.</span>
        <span class="token comment">// (The number of values is given by dataSize / typ.size.)</span>
        <span class="token comment">//size&#x662F;&#x5143;&#x7D20;&#x7684;size, datasize&#x662F;&#x521A;&#x7533;&#x8BF7;&#x7684;&#x5B57;&#x8282;&#x6570;</span>
        <span class="token function">heapBitsSetType</span><span class="token punctuation">(</span><span class="token function">uintptr</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> dataSize<span class="token punctuation">,</span> typ<span class="token punctuation">)</span>
    <span class="token operator">...</span>&#x7701;&#x7565;
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>append&#x5B9E;&#x9645;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x662F;growslice, &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x8D1F;&#x8D23;&#x5207;&#x7247;&#x6269;&#x5BB9;</li>
<li>&#x4F20;&#x5165;&#x5207;&#x7247;&#x5143;&#x7D20;&#x7C7B;&#x578B;, &#x539F;&#x5207;&#x7247;, &#x8FD4;&#x56DE;&#x6700;&#x5C0F;cap&#x5927;&#x5C0F;&#x7684;&#x65B0;&#x5207;&#x7247;, &#x5E76;&#x62F7;&#x8D1D;&#x8001;&#x5207;&#x7247;</li>
<li>&#x5207;&#x7247;&#x7684;length&#x51B3;&#x5B9A;&#x4E0B;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x5199;&#x5728;&#x54EA;</li>
<li>mallocgc&#x7684;&#x610F;&#x601D;&#x662F;&#x8981;&#x7533;&#x8BF7;&#x5185;&#x5B58;&#x4E86;, go&#x662F;&#x6709;&#x5783;&#x573E;&#x56DE;&#x6536;&#x7684;, &#x90A3;&#x4EFB;&#x610F;&#x7684;&#x5185;&#x5B58;&#x7533;&#x8BF7;&#x90FD;&#x662F;&#x8981;gc&#x77E5;&#x9053;&#x7684;<ul>
<li>&#x5C0F;&#x7684;&#x5BF9;&#x8C61;&#x88AB;malloc&#x5230;per CPU&#x7684;&#x7A7A;&#x95F2;&#x5185;&#x5B58;&#x4E2D;</li>
<li>&#x5927;&#x7684;&#x5BF9;&#x8C61;(32KB&#x4EE5;&#x4E0A;)&#x5219;&#x4ECE;&#x5806;&#x4E2D;&#x5206;&#x914D;</li>
</ul>
</li>
<li>malloc&#x4E4B;&#x540E;, &#x5982;&#x679C;&#x5143;&#x7D20;&#x7C7B;&#x578B;&#x91CC;&#x9762;&#x6709;&#x6307;&#x9488;, &#x8981;scan, &#x8C03;&#x7528;&#x7684;heapBitsSetType&#x51FD;&#x6570;&#x975E;&#x5E38;&#x590D;&#x6742;</li>
</ul>
<h2 id="make-1----444-nsop"><a name="make-1----444-nsop" class="anchor-navigation-ex-anchor" href="#make-1----444-nsop"><i class="fa fa-link" aria-hidden="true"></i></a>13.2. make 1 -- 444 ns/op</h2>
<p>&#x6BD4;&#x4E0A;&#x4E00;&#x4E2A;&#x591A;&#x4E86;makeslice&#x51FD;&#x6570;&#x8C03;&#x7528;, makeslice&#x4E3B;&#x8981;&#x4E5F;&#x662F;&#x8C03;&#x7528;mallocgc()</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>pi <span class="token operator">*</span>PidInfo<span class="token punctuation">)</span> <span class="token function">Children</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>PidInfo <span class="token punctuation">{</span>
    <span class="token comment">//var children []*PidInfo</span>
    children <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>PidInfo<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> child <span class="token operator">:=</span> <span class="token keyword">range</span> pi<span class="token punctuation">.</span>children <span class="token punctuation">{</span>
        children <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>children<span class="token punctuation">,</span> child<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> children
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5BF9;&#x4E8E;&#x4E0A;&#x9762;&#x7684;&#x88AB;&#x6D4B;&#x51FD;&#x6570;&#x7684;&#x903B;&#x8F91;&#x770B;, make 1&#x6B21;, &#x8981;append&#x597D;&#x51E0;&#x6B21;.<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913233152.png" alt="">  </p>
<h2 id="make-10----604-nsop"><a name="make-10----604-nsop" class="anchor-navigation-ex-anchor" href="#make-10----604-nsop"><i class="fa fa-link" aria-hidden="true"></i></a>13.3. make 10 -- 604 ns/op</h2>
<p>&#x6BD4;make 1&#x7A0D;&#x7A0D;&#x591A;&#x4E86;&#x4E00;&#x70B9;</p>
<h2 id="make-100----2527-nsop"><a name="make-100----2527-nsop" class="anchor-navigation-ex-anchor" href="#make-100----2527-nsop"><i class="fa fa-link" aria-hidden="true"></i></a>13.4. make 100 -- 2527 ns/op</h2>
<p>&#x5E73;&#x5747;&#x4E00;&#x6B21;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x591A;&#x4E86;&#x597D;&#x51E0;&#x500D;! &#x4E3A;&#x4EC0;&#x4E48;&#x5462;? &#x4E0B;&#x9762;&#x662F;make 100 case&#x7684;&#x56FE;: 
&#x6CE8;&#x610F;, &#x8FD9;&#x4E2A;&#x56FE;&#x9ED8;&#x8BA4;&#x4E0D;&#x663E;&#x793A;runtime.makeslice, &#x5F88;&#x5947;&#x602A;, &#x8FD9;&#x90E8;&#x5206;&#x5360;&#x6BD4;&#x633A;&#x5927;&#x7684;.
&#x53EF;&#x4EE5;&#x70B9;&#x4E0B;&#x56FE;&#x9009;&#x4E2D;&#x51FD;&#x6570;&#x7684;REFINE, &#x5C31;&#x80FD;&#x770B;&#x5168;&#x4E86;. &#x8D77;&#x59CB;pprof&#x628A;makeslice&#x7701;&#x7565;&#x4E5F;&#x662F;&#x8BF4;&#x5F97;&#x901A;&#x7684;, &#x56E0;&#x4E3A;&#x5B83;&#x672C;&#x8EAB;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x662F;0, &#x800C;&#x4E14;&#x548C;growslice&#x90FD;&#x8C03;&#x7528;mallocgc, &#x4ECE;&#x91C7;&#x6837;&#x548C;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x5206;&#x6790;&#x7684;&#x89D2;&#x5EA6;, &#x8FD9;&#x4E24;&#x4E2A;&#x901A;&#x8DEF;&#x662F;&#x91CD;&#x53E0;&#x7684;, &#x56FE;&#x4E0A;&#x9ED8;&#x8BA4;&#x663E;&#x793A;&#x4E00;&#x4E2A;&#x901A;&#x8DEF;&#x5C31;&#x597D;&#x4E86;<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913233251.png" alt="">  </p>
<p>&#x4ED4;&#x7EC6;&#x5BF9;&#x6BD4;&#x53D1;&#x73B0;, runtime.growslice&#x548C;runtime.mallocgc&#x6BD4;make 1&#x7684;&#x65F6;&#x5019;, &#x4ECE;&#x65F6;&#x95F4;&#x4E0A;&#x770B;, &#x6709;&#x6240;&#x6D6E;&#x52A8;, &#x4F46;&#x5E94;&#x8BE5;&#x662F;&#x4E0B;&#x964D;&#x4E86;&#x70B9;.</p>
<ul>
<li>runtime.mallocgc&#x5728;make 1&#x7684;&#x65F6;&#x5019;&#x82B1;&#x4E86;0.92s</li>
<li>runtime.mallocgc&#x5728;make 1&#x7684;&#x65F6;&#x5019;&#x82B1;&#x4E86;0.66s ~ 0.82s</li>
</ul>
<p>&#x4F46;gc&#x7684;&#x5360;&#x6BD4;&#x98D9;&#x5347;&#x4E86;.<br>&#x5BF9;&#x6BD4;&#x4E24;&#x4E2A;&#x706B;&#x7130;&#x56FE;, make 100&#x7684;&#x65F6;&#x5019;, &#x53EF;&#x4EE5;&#x770B;&#x5230;, runtime.gcBgMarkWorker&#x5360;&#x6BD4;&#x660E;&#x663E;&#x63D0;&#x9AD8;.</p>
<ul>
<li>make 100&#x65F6;, runtime.gcBgMarkWorker&#x5360;&#x6BD4;20%<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913233420.png" alt="">  </li>
<li>make 1&#x65F6;, runtime.gcBgMarkWorker&#x5360;&#x6BD4;&#x624D;0.53%<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913233440.png" alt="">  </li>
</ul>
<p>&#x6539;&#x4E00;&#x4E0B;&#x4EE3;&#x7801;:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>pi <span class="token operator">*</span>PidInfo<span class="token punctuation">)</span> <span class="token function">Children</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>PidInfo <span class="token punctuation">{</span>
    <span class="token comment">//var children []*PidInfo</span>
    children <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>PidInfo<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>

    i <span class="token operator">:=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> child <span class="token operator">:=</span> <span class="token keyword">range</span> pi<span class="token punctuation">.</span>children <span class="token punctuation">{</span>
        <span class="token comment">//children = append(children, child)</span>
        children<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> child
        i<span class="token operator">++</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> children
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>&#x628A;append&#x6539;&#x6210;&#x76F4;&#x63A5;&#x8D4B;&#x503C;, &#x5FEB;&#x4E86;&#x5F88;&#x591A;!  2062 ns/op -&gt; 461 ns/op</li>
<li>&#x4F46;&#x8981;&#x9884;&#x5148;make&#x597D;&#x4E00;&#x4E2A;&#x8DB3;&#x591F;&#x5927;&#x7684;&#x5207;&#x7247;, &#x5426;&#x5219;&#x4F1A;&#x8FD0;&#x884C;&#x65F6;&#x9519;&#x8BEF;, &#x8BF4;&#x8D85;&#x51FA;&#x5207;&#x7247;&#x7684;index&#x8303;&#x56F4;</li>
</ul>
<p>&#x8FD9;&#x6837;&#x8BF4;, make 100&#x7684;&#x65F6;&#x5019;, &#x9884;&#x7559;&#x4E86;&#x8DB3;&#x591F;&#x7684;&#x5927;&#x5C0F;, &#x4ECE;&#x6267;&#x884C;&#x6548;&#x7387;&#x4E0A;&#x770B;, <code>make([]*PidInfo, 100)</code>&#x548C;<code>make([]*PidInfo, 1)</code> &#x672C;&#x8EAB;&#x5E76;&#x6CA1;&#x6709;&#x5DEE;&#x591A;&#x5C11;, &#x53EF;&#x80FD;make 100&#x786E;&#x5B9E;&#x7A0D;&#x7A0D;&#x5FEB;&#x4E86;&#x4E00;&#x70B9;, &#x7406;&#x8BBA;&#x4E0A;&#x51CF;&#x5C11;&#x4E86;&#x5207;&#x7247;&quot;&#x6269;&#x5BB9;&quot;&#x7684;&#x6B21;&#x6570;; &#x4F46;&#x5176;&#x4EE3;&#x4EF7;&#x662F;&#x589E;&#x5927;GC&#x7684;&#x538B;&#x529B;. &#x4ECE;&#x7ED3;&#x679C;&#x4E0A;&#x770B;&#x5F97;&#x4E0D;&#x507F;&#x5931;.</p>
<h2 id="&#x66F4;&#x6B63;"><a name="&#x66F4;&#x6B63;" class="anchor-navigation-ex-anchor" href="#&#x66F4;&#x6B63;"><i class="fa fa-link" aria-hidden="true"></i></a>13.5. &#x66F4;&#x6B63;</h2>
<p>&#x5B9E;&#x9645;&#x4E0A;, &#x5BF9;<code>make([]*PidInfo, 100)</code>&#x548C;<code>make([]*PidInfo, 1)</code>&#x7684;append&#x64CD;&#x4F5C;&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;: append&#x7684;&#x5143;&#x7D20;&#x662F;&#x5728;len&#x540E;&#x9762;&#x7684;, &#x5BF9;len=100&#x6765;&#x8BF4;, append&#x7684;&#x6269;&#x5BB9;&#x4F1A;&#x6BD4;&#x521D;&#x59CB;len=1&#x7684;&#x60C5;&#x51B5;, &#x62F7;&#x8D1D;&#x5F88;&#x591A;&#x5143;&#x7D20;.<br>&#x6240;&#x4EE5;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x7684;&#x5BF9;&#x6BD4;&#x601D;&#x8DEF;&#x662F;&#x6709;&#x95EE;&#x9898;&#x7684;.<br>&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x8BF4;&#x660E;, append&#x662F;&#x5728;10&#x4E2A;0&#x4E4B;&#x540E;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sl <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>

    sl <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>sl<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    sl <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>sl<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>sl<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

&#x8F93;&#x51FA;
<span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">]</span>
</code></pre>
<h2 id="&#x66F4;&#x6B63;&#x540E;&#x6700;&#x7EC8;&#x7248;"><a name="&#x66F4;&#x6B63;&#x540E;&#x6700;&#x7EC8;&#x7248;" class="anchor-navigation-ex-anchor" href="#&#x66F4;&#x6B63;&#x540E;&#x6700;&#x7EC8;&#x7248;"><i class="fa fa-link" aria-hidden="true"></i></a>13.6. &#x66F4;&#x6B63;&#x540E;&#x6700;&#x7EC8;&#x7248;</h2>
<p>&#x4F7F;&#x7528;<code>make([]T, 0, max)</code>&#x548C;append&#x7684;&#x642D;&#x914D;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// Threads returns threads of the process</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>pi <span class="token operator">*</span>PidInfo<span class="token punctuation">)</span> <span class="token function">Threads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>TidInfo <span class="token punctuation">{</span>
    <span class="token keyword">if</span> pi<span class="token punctuation">.</span>checkLevel<span class="token operator">&amp;</span>CheckThread <span class="token operator">!=</span> CheckThread <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> pi<span class="token punctuation">.</span>pid <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//threads := make([]*TidInfo, pi.threads.Len()) //&#x7533;&#x8BF7;&#x5DF2;&#x77E5;&#x7684;len, &#x7ED3;&#x5408;&#x4E0B;&#x9762;&#x7684;&#x76F4;&#x63A5;&#x8D4B;&#x503C;, &#x7406;&#x8BBA;&#x6027;&#x80FD;&#x6700;&#x4F73;</span>
    threads <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>TidInfo<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pi<span class="token punctuation">.</span>threads<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//&#x7533;&#x8BF7;&#x5DF2;&#x77E5;cap, &#x4ECE;0&#x5F00;&#x59CB;append, &#x548C;&#x4E0A;&#x9762;&#x6027;&#x80FD;&#x5DEE;&#x4E0D;&#x591A;</span>
    <span class="token comment">//var threads []*TidInfo //&#x4ECE;0&#x5F00;&#x59CB;&#x751F;&#x957F;, &#x6BCF;&#x6B21;&#x7FFB;&#x500D;&#x6269;&#x5BB9;&#x90FD;&#x6709;&#x5F00;&#x9500;, &#x6027;&#x80FD;&#x6700;&#x5DEE;.</span>

    <span class="token keyword">for</span> i<span class="token punctuation">,</span> tid <span class="token operator">:=</span> <span class="token keyword">range</span> pi<span class="token punctuation">.</span>threads<span class="token punctuation">.</span><span class="token function">Keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        thrdi<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> pi<span class="token punctuation">.</span>threads<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>tid<span class="token punctuation">)</span>
        <span class="token comment">//threads[i] = thrdi.(*TidInfo)</span>
        threads <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>threads<span class="token punctuation">,</span> thrdi<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>TidInfo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//&#x5982;&#x679C;&#x6CA1;&#x6709;&#x53D1;&#x751F;slice&#x6269;&#x5BB9;, append&#x7684;&#x6027;&#x80FD;&#x5F88;&#x597D;, &#x51E0;&#x4E4E;&#x548C;&#x76F4;&#x63A5;&#x8D4B;&#x503C;&#x5DEE;&#x4E0D;&#x591A;.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> threads
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x6700;&#x7EC8;&#x7248;&#x7ED3;&#x679C;"><a name="&#x6700;&#x7EC8;&#x7248;&#x7ED3;&#x679C;" class="anchor-navigation-ex-anchor" href="#&#x6700;&#x7EC8;&#x7248;&#x7ED3;&#x679C;"><i class="fa fa-link" aria-hidden="true"></i></a>13.7. &#x6700;&#x7EC8;&#x7248;&#x7ED3;&#x679C;</h2>
<table>
<thead>
<tr>
<th>slice&#x521D;&#x59CB;&#x5316;&#x65B9;&#x5F0F;</th>
<th>&#x6027;&#x80FD;</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>threads := make([]*TidInfo, pi.threads.Len())</code> + <code>threads[i] = thrdi.(*TidInfo)</code></td>
<td>726 ns/op</td>
</tr>
<tr>
<td><code>threads := make([]*TidInfo, 0, pi.threads.Len())</code> + append</td>
<td>729 ns/op</td>
</tr>
<tr>
<td><code>var threads []*TidInfo</code> + append</td>
<td>1114 ns/op</td>
</tr>
</tbody>
</table>
<h2 id="&#x7ED3;&#x8BBA;"><a name="&#x7ED3;&#x8BBA;" class="anchor-navigation-ex-anchor" href="#&#x7ED3;&#x8BBA;"><i class="fa fa-link" aria-hidden="true"></i></a>13.8. &#x7ED3;&#x8BBA;</h2>
<ul>
<li><code>make([]T, length, capacity)</code>&#x7684;&#x539F;&#x578B;&#x4E2D;<ul>
<li>make&#x5207;&#x7247;&#x5BF9;&#x5E94;&#x7684;&#x65F6;runtime.makeslice()</li>
<li>append&#x5207;&#x7247;&#x5BF9;&#x5E94;runtime.growslice()</li>
<li>&#x5982;&#x679C;slice&#x7684;&#x5143;&#x7D20;&#x91CC;&#x9762;&#x5305;&#x62EC;&#x6307;&#x9488;, &#x5219;slice&#x91CC;&#x9762;&#x7684;&#x5143;&#x7D20;&#x8D8A;&#x591A;, gc&#x538B;&#x529B;&#x8D8A;&#x5927;</li>
<li>&#x5982;&#x679C;&#x5DF2;&#x77E5;length&#x5927;&#x5C0F;, &#x63A8;&#x8350;make&#x76F4;&#x63A5;&#x586B;&#x5165;length, &#x5728;&#x540E;&#x9762;&#x7528;for&#x5FAA;&#x73AF;&#x7ED9;&#x5207;&#x7247;&#x5143;&#x7D20;&#x8D4B;&#x503C;, &#x4E0D;&#x7528;append. &#x8FD9;&#x6837;&#x7406;&#x8BBA;&#x4E0A;&#x6027;&#x80FD;&#x6700;&#x597D;; &#x4F46;&#x8981;&#x6CE8;&#x610F;, &#x8D85;&#x8FC7;&#x5207;&#x7247;&#x7684;len&#x7684;&#x8D4B;&#x503C;&#x4F1A;panic. &#x800C;append&#x5219;&#x4E0D;&#x4F1A;.</li>
<li>&#x5207;&#x7247;&#x7684;append&#x64CD;&#x4F5C;&#x5982;&#x679C;&#x4E0D;&#x53D1;&#x751F;&#x6269;&#x5BB9;, &#x548C;&#x76F4;&#x63A5;&#x8D4B;&#x503C;&#x6027;&#x80FD;&#x5DEE;&#x4E0D;&#x591A;; &#x4F46;&#x5982;&#x679C;&#x6709;&#x6269;&#x5BB9;, &#x5219;&#x6027;&#x80FD;&#x5C31;&#x5DEE;&#x592A;&#x591A;&#x4E86;.</li>
</ul>
</li>
<li>&#x5E94;&#x8BE5;&#x8BF4;&#x4EFB;&#x4F55;&#x5185;&#x5B58;&#x7533;&#x8BF7;, &#x90FD;&#x4F1A;&#x4F34;&#x968F;gc&#x76F8;&#x5173;&#x7684;&#x5DE5;&#x4F5C;. <strong>&#x9664;&#x975E;</strong>&#x7533;&#x8BF7;&#x7684;&#x5185;&#x5B58;&#x660E;&#x786E;&#x77E5;&#x9053;&#x6CA1;&#x6709;&#x6307;&#x9488;.</li>
<li>&#x5207;&#x7247;&#x5E76;&#x4E0D;&#x5EC9;&#x4EF7;, &#x521D;&#x59CB;&#x5316;&#x5207;&#x7247;&#x5927;&#x5C0F;&#x65F6;, &#x8981;&#x8003;&#x8651;&#x5BF9;GC&#x7684;&#x5F71;&#x54CD;</li>
<li>&#x63A8;&#x8350;length&#x4E3A;0, &#x4F46;&#x8BBE;&#x7F6E;&#x8DB3;&#x591F;&#x7684;capacity&#x65B9;&#x5F0F;&#x521D;&#x59CB;&#x5316;&#x5207;&#x7247;: <code>make([]*PidInfo, 0, 100)</code>; &#x540E;&#x9762;&#x7528;append&quot;&#x8FFD;&#x52A0;&quot;&#x5143;&#x7D20;. &#x8FD9;&#x6837;&#x5373;&#x517C;&#x987E;&#x4E86;&#x6027;&#x80FD;, &#x53C8;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;index&#x8D8A;&#x754C;&#x7684;panic</li>
</ul>
<h1 id="pidinfo&#x8C03;&#x8BD5;"><a name="pidinfo&#x8C03;&#x8BD5;" class="anchor-navigation-ex-anchor" href="#pidinfo&#x8C03;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a>14. pidinfo&#x8C03;&#x8BD5;</h1>
<p>&#x4E3B;&#x8981;&#x7528;testing&#x6846;&#x67B6;&#x6765;&#x8C03;&#x8BD5;. &#x6211;&#x662F;&#x5148;&#x5199;&#x7684;testing, &#x518D;&#x5199;package&#x4EE3;&#x7801;, &#x540C;&#x6B65;&#x4FEE;&#x6539;, &#x76F8;&#x8F85;&#x76F8;&#x6210;.<br>test case&#x91CC;&#x52A0;&#x4E86;benchmarking&#x7684;case, &#x4E3B;&#x8981;&#x60F3;&#x6D4B;Update()&#x7684;&#x6548;&#x7387;. &#x56E0;&#x4E3A;Update()&#x91CC;&#x9762;&#x6709;&#x9012;&#x5F52;&#x7684;&#x521B;&#x5EFA;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;pidinfo&#x548C;&#x66F4;&#x65B0;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x7B49;&#x64CD;&#x4F5C;, &#x6700;&#x590D;&#x6742;.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">BenchmarkP1InfoUpdate</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pi<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">NewPidInfo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        b<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;main: %v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    b<span class="token punctuation">.</span><span class="token function">ResetTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> err <span class="token operator">:=</span> pi<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            b<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;main: %v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x6267;&#x884C;&#x6D4B;&#x8BD5;"><a name="&#x6267;&#x884C;&#x6D4B;&#x8BD5;" class="anchor-navigation-ex-anchor" href="#&#x6267;&#x884C;&#x6D4B;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a>14.1. &#x6267;&#x884C;&#x6D4B;&#x8BD5;</h2>
<h3 id="in-docker"><a name="in-docker" class="anchor-navigation-ex-anchor" href="#in-docker"><i class="fa fa-link" aria-hidden="true"></i></a>14.1.1. in docker</h3>
<p>&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x5F00;&#x53D1;&#x76EE;&#x5F55;&#x4E0B;&#x6267;&#x884C;</p>
<pre class="language-"><code class="lang-sh">yingjieb@3a9f377eee5d /repo/yingjieb/godev/practice/src/pidinfo
$ go <span class="token builtin class-name">test</span> <span class="token parameter variable">-run</span> xxxxxx <span class="token parameter variable">-bench</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-benchtime</span> 10s 
goos: linux
goarch: amd64
pkg: pidinfo
BenchmarkP1InfoUpdate-23           <span class="token number">86350</span>            <span class="token number">168270</span> ns/op
PASS
ok      pidinfo <span class="token number">15</span>.962s
</code></pre>
<ul>
<li>&#x6211;&#x4E0D;&#x60F3;run&#x666E;&#x901A;&#x7684;test&#x9879;, &#x6240;&#x4EE5;&#x7528;&#x968F;&#x610F;&#x7684;xxxx&#x6765;&#x5339;&#x914D;test&#x9879;, &#x5339;&#x914D;&#x4E0D;&#x5230;, &#x6240;&#x4EE5;&#x4E0D;run</li>
<li>&#x7528;-bench .&#x6267;&#x884C;&#x6240;&#x6709;&#x7684;benchmark&#x9879;</li>
<li>&#x7528;-benchtime&#x6307;&#x5B9A;&#x7A33;&#x5B9A;&#x65F6;&#x95F4;, testing&#x6846;&#x67B6;&#x9ED8;&#x8BA4;1s</li>
</ul>
<p>docker&#x91CC;&#x9762;&#x7684;pid1&#x8FDB;&#x7A0B;&#x6811;, &#x5927;&#x6982;0.2ms&#x8FD0;&#x884C;&#x4E00;&#x8F6E;</p>
<h3 id="out-docker"><a name="out-docker" class="anchor-navigation-ex-anchor" href="#out-docker"><i class="fa fa-link" aria-hidden="true"></i></a>14.1.2. out docker</h3>
<p>&#x5148;docker&#x91CC;&#x9762;&#x7F16;&#x8BD1;</p>
<pre class="language-"><code class="lang-sh">yingjieb@3a9f377eee5d /repo/yingjieb/godev/practice/src/pidinfo
$ go <span class="token builtin class-name">test</span> <span class="token parameter variable">-c</span> <span class="token parameter variable">-o</span> pidinfotest
</code></pre>
<p>&#x7136;&#x540E;&#x5728;host&#x4E0A;&#x8FD0;&#x884C;
&#x7528;testing&#x6846;&#x67B6;&#x7F16;&#x8BD1;&#x51FA;&#x6765;&#x7684;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;, &#x90FD;&#x5E26;&#x4E86;testing&#x6846;&#x67B6;&#x7684;&#x9009;&#x9879;, &#x9009;&#x9879;&#x6BD4;&#x666E;&#x901A;&#x7684;go test&#x547D;&#x4EE4;&#x8981;&#x591A;test.&#x524D;&#x7F00;, &#x5176;&#x4ED6;&#x90FD;&#x4E00;&#x6837;</p>
<pre class="language-"><code class="lang-sh">$ ./pidinfotest <span class="token parameter variable">-h</span>
Usage of ./pidinfotest:
  <span class="token parameter variable">-test.bench</span> regexp
        run only benchmarks matching regexp
  <span class="token parameter variable">-test.benchmem</span>
        print memory allocations <span class="token keyword">for</span> benchmarks
  <span class="token parameter variable">-test.benchtime</span> d
        run each benchmark <span class="token keyword">for</span> duration d <span class="token punctuation">(</span>default 1s<span class="token punctuation">)</span>
  <span class="token parameter variable">-test.blockprofile</span> <span class="token function">file</span>
        <span class="token function">write</span> a goroutine blocking profile to <span class="token function">file</span>
  <span class="token parameter variable">-test.blockprofilerate</span> rate
        <span class="token builtin class-name">set</span> blocking profile rate <span class="token punctuation">(</span>see runtime.SetBlockProfileRate<span class="token punctuation">)</span> <span class="token punctuation">(</span>default <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token parameter variable">-test.count</span> n
        run tests and benchmarks n <span class="token builtin class-name">times</span> <span class="token punctuation">(</span>default <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment">#&#x6700;&#x540E;&#x8FD9;&#x6837;&#x8FD0;&#x884C;</span>
./pidinfotest <span class="token parameter variable">-test.run</span> xxxxxx <span class="token parameter variable">-test.bench</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-test.benchtime</span> 10s
</code></pre>
<p>&#x7ED3;&#x679C;: &#x5927;&#x6982;1ms</p>
<pre class="language-"><code class="lang-sh">$ ./pidinfotest <span class="token parameter variable">-test.run</span> xxxxxx <span class="token parameter variable">-test.bench</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-test.benchtime</span> 30s
goos: linux
goarch: amd64
pkg: pidinfo
BenchmarkP1InfoUpdate-24           <span class="token number">37700</span>           <span class="token number">1066736</span> ns/op
PASS
</code></pre>
<p>&#x80FD;&#x770B;&#x5230;htop&#x663E;&#x793A;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#x5360;&#x6BD4;109%&#x5DE6;&#x53F3;. &#x8BF4;&#x660E;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#x7684;&#x4E3B;&#x4F53;&#x7684;&#x6D3B;&#x53EA;&#x80FD;&#x5355;&#x6838;&#x5E72;, &#x52A0;&#x4E0A;&#x8C03;&#x5EA6;&#x5F00;&#x9500;, &#x5C31;&#x662F;110%&#x5DE6;&#x53F3;.</p>
<h2 id="&#x6253;&#x5F00;cpu&#x5206;&#x6790;"><a name="&#x6253;&#x5F00;cpu&#x5206;&#x6790;" class="anchor-navigation-ex-anchor" href="#&#x6253;&#x5F00;cpu&#x5206;&#x6790;"><i class="fa fa-link" aria-hidden="true"></i></a>14.2. &#x6253;&#x5F00;cpu&#x5206;&#x6790;</h2>
<pre class="language-"><code class="lang-sh">go <span class="token builtin class-name">test</span> <span class="token parameter variable">-run</span> xxxxxx <span class="token parameter variable">-bench</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-benchtime</span> 10s <span class="token parameter variable">-cpuprofile</span> cpu.out
go tool pprof <span class="token parameter variable">-http</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0:8000 cpu.out
</code></pre>
<p>&#x5927;&#x90E8;&#x5206;&#x90FD;&#x662F;&#x5728;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x8017;&#x65F6;
&#x6CA1;&#x770B;&#x5230;&#x6709;runtime hash&#x7B49;&#x51FD;&#x6570;&#x7684;&#x8EAB;&#x5F71;? -- &#x591A;&#x8BD5;&#x51E0;&#x6B21;&#x80FD;&#x770B;&#x5230;<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913234057.png" alt="">  </p>
<p>&#x7528;<code>perf top -p $(pidof pidinfotest)</code>&#x80FD;&#x770B;&#x5230;
runtime.mapiternext&#x8FD9;&#x4E2A;map&#x8FED;&#x4EE3;&#x5668;&#x7684;&#x5360;&#x6BD4;:
<code>0.58%  pidinfotest       [.] runtime.mapiternext</code></p>
<h3 id="host&#x4E0A;profile-cpu"><a name="host&#x4E0A;profile-cpu" class="anchor-navigation-ex-anchor" href="#host&#x4E0A;profile-cpu"><i class="fa fa-link" aria-hidden="true"></i></a>14.2.1. host&#x4E0A;profile CPU</h3>
<pre class="language-"><code class="lang-sh">yingjieb@godev-server /repo/yingjieb/godev/practice/src/pidinfo
$ ./pidinfotest <span class="token parameter variable">-test.run</span> xxxxxx <span class="token parameter variable">-test.bench</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-test.benchtime</span> 30s <span class="token parameter variable">-test.cpuprofile</span> cpuhost.o
ut
goos: linux
goarch: amd64
pkg: pidinfo
BenchmarkP1InfoUpdate-24           <span class="token number">33567</span>           <span class="token number">1115273</span> ns/op
PASS
</code></pre>
<p>&#x4ECE;pprof&#x770B;&#x6765;, &#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x5360;&#x6BD4;&#x8F83;&#x5927;.</p>
<h3 id="pprof&#x7684;refine&#x529F;&#x80FD;"><a name="pprof&#x7684;refine&#x529F;&#x80FD;" class="anchor-navigation-ex-anchor" href="#pprof&#x7684;refine&#x529F;&#x80FD;"><i class="fa fa-link" aria-hidden="true"></i></a>14.2.2. pprof&#x7684;refine&#x529F;&#x80FD;</h3>
<p>&#x9ED8;&#x8BA4;&#x7684;&#x8C03;&#x7528;&#x56FE;&#x662F;&#x8C03;&#x6574;&#x8FC7;&#x7684;, &#x6BD4;&#x5982;&#x6709;&#x4E9B;&#x5360;&#x6BD4;&#x5C0F;&#x7684;&#x51FD;&#x6570;&#x7528;&#x865A;&#x7EBF;&#x4EE3;&#x66FF;, &#x6709;&#x7684;&#x5C31;&#x5E72;&#x8106;&#x4E0D;&#x663E;&#x793A;&#x4E86;.<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913234202.png" alt="">  </p>
<p>&#x4F46;&#x6211;&#x60F3;&#x770B;&#x770B;map&#x7684;&#x8FED;&#x4EE3;&#x5668;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x7684;&#x60C5;&#x51B5;, &#x90A3;&#x5C31;&#x8981;&#x7528;refine&#x529F;&#x80FD;:</p>
<ul>
<li>&#x5148;&#x9009;&#x4E2D;&#x8981;&#x770B;&#x7684;&#x51FD;&#x6570;, &#x5982;&#x4E0A;&#x56FE;, &#x6211;&#x9009;&#x4E2D;&#x4E86;runtime.mapiternext</li>
<li>&#x70B9;REFINE-&gt;focus</li>
<li>pprof&#x4F1A;&#x6839;&#x636E;&#x91C7;&#x6837;&#x8BB0;&#x5F55;&#x7684;&#x8C03;&#x7528;&#x6808;&#x5173;&#x7CFB;, &#x4EE5;&#x9009;&#x4E2D;&#x7684;&#x51FD;&#x6570;&#x4E3A;&#x4E3B;&#x4F53;, &#x91CD;&#x65B0;&#x663E;&#x793A;&#x8C03;&#x7528;; &#x4E4B;&#x524D;&#x4E0D;&#x663E;&#x793A;&#x7684;&#x76F8;&#x5173;&#x8C03;&#x7528;&#x4F1A;&#x663E;&#x793A;&#x51FA;&#x6765;<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913234238.png" alt="">  </li>
<li>&#x6CBF;&#x9014;&#x7684;CPU&#x5360;&#x6BD4;&#x90FD;&#x505A;&#x8FC7;&#x4E86;&#x8C03;&#x6574;, &#x90FD;&#x662F;&#x6839;&#x636E;&#x9009;&#x4E2D;&#x7684;&#x51FD;&#x6570;&#x6765;&#x8C03;&#x6574;&#x7684;.</li>
</ul>
<h1 id="toomanytimer&#x8C03;&#x8BD5;"><a name="toomanytimer&#x8C03;&#x8BD5;" class="anchor-navigation-ex-anchor" href="#toomanytimer&#x8C03;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a>15. tooManyTimer&#x8C03;&#x8BD5;</h1>
<h2 id="&#x547D;&#x4EE4;&#x8BB0;&#x5F55;_1"><a name="&#x547D;&#x4EE4;&#x8BB0;&#x5F55;_1" class="anchor-navigation-ex-anchor" href="#&#x547D;&#x4EE4;&#x8BB0;&#x5F55;_1"><i class="fa fa-link" aria-hidden="true"></i></a>15.1. &#x547D;&#x4EE4;&#x8BB0;&#x5F55;</h2>
<pre class="language-"><code>go tool pprof -http=0.0.0.0:8000 http://10.182.105.138:9999/debug/pprof/profile

wget http://10.182.105.138:9999/debug/pprof/trace?seconds=10 -O testtrace
go tool trace -http=0.0.0.0:8000 testtrace

&#x6700;&#x540E;&#x8BBF;&#x95EE;http://10.182.105.138:60080/ui/
</code></pre><h2 id="go-tool-pprof&#x7684;http&#x65B9;&#x5F0F;"><a name="go-tool-pprof&#x7684;http&#x65B9;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#go-tool-pprof&#x7684;http&#x65B9;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>15.2. go tool pprof&#x7684;http&#x65B9;&#x5F0F;</h2>
<p>&#x7528;<code>go tool pprof -http=0.0.0.0:8000 /home/yingjieb/pprof/pprof.tooManyTimer.samples.cpu.003.pb.gz</code><br>&#x53EF;&#x4EE5;&#x5728;docker&#x5B9E;&#x4F8B;&#x5185;&#x542F;&#x52A8;&#x4E00;&#x4E2A;http,port&#x662F;8000; &#x628A;8000&#x6620;&#x5C04;&#x5230;&#x5916;&#x90E8;&#x7684;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x53F7;, &#x6BD4;&#x5982;60080, &#x5C31;&#x53EF;&#x4EE5;&#x4ECE;&#x5916;&#x90E8;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;http&#x670D;&#x52A1;&#x4E86;.<br>&#x6CE8;&#x610F;, &#x5FC5;&#x987B;&#x8981;&#x6307;&#x660E;<code>0.0.0.0:port</code>, &#x5426;&#x5219;&#x53EA;&#x80FD;&#x5728;docker&#x5B9E;&#x4F8B;&#x5185;&#x90E8;&#x8BBF;&#x95EE;.</p>
<p>&#x8BBF;&#x95EE;<a href="http://10.182.105.138:60080/ui/" target="_blank">http://10.182.105.138:60080/ui/</a><br>&#x6709;&#x706B;&#x7130;&#x56FE;, &#x8FD9;&#x4E2A;&#x662F;go1.14&#x7248;&#x672C;<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913235142.png" alt="">  </p>
<h3 id="&#x5185;&#x5B58;"><a name="&#x5185;&#x5B58;" class="anchor-navigation-ex-anchor" href="#&#x5185;&#x5B58;"><i class="fa fa-link" aria-hidden="true"></i></a>15.2.1. &#x5185;&#x5B58;</h3>
<p><code>go tool pprof -http=0.0.0.0:8000 http://10.182.105.138:9999/debug/pprof/heap</code><br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913235214.png" alt=""><br>&#x5185;&#x5B58;&#x6709;&#x51E0;&#x4E2A;&#x89C6;&#x89D2;:</p>
<ul>
<li>&#x5DF2;&#x7ECF;&#x5206;&#x914D;&#x7684;&#x5BF9;&#x8C61;&#x4E2A;&#x6570;&#x548C;&#x5185;&#x5B58;&#x5360;&#x7528;, &#x8FD9;&#x4E2A;&#x597D;&#x50CF;&#x662F;&#x7D2F;&#x52A0;&#x7684;</li>
<li>&#x6B63;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x4E2A;&#x6570;&#x548C;&#x5185;&#x5B58;&#x5360;&#x7528;</li>
</ul>
<h3 id="goroutine&#x7684;&#x60C5;&#x51B5;"><a name="goroutine&#x7684;&#x60C5;&#x51B5;" class="anchor-navigation-ex-anchor" href="#goroutine&#x7684;&#x60C5;&#x51B5;"><i class="fa fa-link" aria-hidden="true"></i></a>15.2.2. goroutine&#x7684;&#x60C5;&#x51B5;</h3>
<p><code>go tool pprof -http=0.0.0.0:8000 http://10.182.105.138:9999/debug/pprof/goroutine</code><br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220913235316.png" alt=""><br>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8C01;&#x5728;&#x54EA;&#x91CC;&#x521B;&#x5EFA;&#x4E86;&#x591A;&#x5C11;&#x4E2A;goroutine, &#x8FD9;&#x662F;&#x6293;&#x7684;&#x5F53;&#x65F6;&#x65F6;&#x523B;&#x7684;&#x60C5;&#x51B5;.</p>
<h3 id="&#x540C;&#x6B65;-&#x9501;-&#x963B;&#x585E;&#x5E94;&#x8BE5;&#x4E5F;&#x652F;&#x6301;-&#x5F85;&#x8C03;&#x67E5;"><a name="&#x540C;&#x6B65;-&#x9501;-&#x963B;&#x585E;&#x5E94;&#x8BE5;&#x4E5F;&#x652F;&#x6301;-&#x5F85;&#x8C03;&#x67E5;" class="anchor-navigation-ex-anchor" href="#&#x540C;&#x6B65;-&#x9501;-&#x963B;&#x585E;&#x5E94;&#x8BE5;&#x4E5F;&#x652F;&#x6301;-&#x5F85;&#x8C03;&#x67E5;"><i class="fa fa-link" aria-hidden="true"></i></a>15.2.3. &#x540C;&#x6B65; &#x9501; &#x963B;&#x585E;&#x5E94;&#x8BE5;&#x4E5F;&#x652F;&#x6301;, &#x5F85;&#x8C03;&#x67E5;</h3>
<p>&#x5F85;&#x8C03;&#x67E5;</p>
<h3 id="trace"><a name="trace" class="anchor-navigation-ex-anchor" href="#trace"><i class="fa fa-link" aria-hidden="true"></i></a>15.2.4. trace</h3>
<p>go test&#x6846;&#x67B6;&#x5DF2;&#x7ECF;&#x628A;trace&#x529F;&#x80FD;&#x96C6;&#x6210;&#x8FDB;&#x53BB;&#x4E86;.<br>&#x5F15;&#x5165;<code>import _ &quot;net/http/pprof&quot;</code>&#x4E5F;&#x662F;&#x5F88;&#x65B9;&#x4FBF;&#x7684;&#x89E6;&#x53D1;trace&#x7684;&#x624B;&#x6BB5;.<br>&#x4E0B;&#x9762;&#x662F;&#x7528;pprof&#x5305;&#x89E6;&#x53D1;&#x5E76;&#x5206;&#x6790;trace&#x7684;&#x8BB0;&#x5F55;:</p>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x5148;&#x89E6;&#x53D1;&#x5E76;&#x4E0B;&#x8F7D;30&#x79D2;&#x7684;trace</span>
<span class="token function">wget</span> http://10.182.105.138:9999/debug/pprof/trace?seconds<span class="token operator">=</span><span class="token number">10</span> <span class="token parameter variable">-O</span> testtrace
<span class="token comment">#&#x7528;trace tool&#x6765;&#x5206;&#x6790;, &#x4E0D;&#x52A0;http&#x5C31;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x968F;&#x673A;&#x7AEF;&#x53E3;&#x8D77;http</span>
go tool trace <span class="token parameter variable">-http</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0:8000 testtrace
</code></pre>
<p>&#x7528;chrome&#x6253;&#x5F00;&#x94FE;&#x63A5;&#x6307;&#x5B9A;&#x94FE;&#x63A5;.
&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;, go tool trace&#x4F7F;&#x7528;&#x4E86;chrome&#x5DF2;&#x7ECF;&#x4E0D;&#x652F;&#x6301;&#x7684;&#x6280;&#x672F;, &#x5BFC;&#x81F4;80&#x7248;&#x672C;&#x540E;&#x7684;chrome&#x4E0D;&#x80FD;&#x663E;&#x793A;trace.
&#x8BE6;&#x89C1;: <a href="https://github.com/golang/go/issues/34374" target="_blank">https://github.com/golang/go/issues/34374</a></p>
<p>&#x7ECF;&#x8FC7;&#x6211;&#x7684;&#x9A8C;&#x8BC1;, &#x4E0B;&#x8F7D;&#x4E2A;79&#x7248;&#x672C;&#x7684;&#x65E7;chrome&#x53EF;&#x4EE5;&#x663E;&#x793A;trace&#x9875;&#x9762;.<br>&#x53EF;&#x4EE5;&#x5728;docker&#x91CC;&#x9762;&#x6253;&#x5F00;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;, &#x5728;docker&#x5916;&#x9762;&#x8BBF;&#x95EE;:<br><code>http://10.182.105.138:60080/</code></p>
<p>&#x4F7F;&#x7528;wsad&#x7B49;&#x5FEB;&#x6377;&#x952E;&#x6765;&#x6D4F;&#x89C8;.</p>
<h3 id="&#x4EE3;&#x7801;&#x6253;&#x5F00;trace"><a name="&#x4EE3;&#x7801;&#x6253;&#x5F00;trace" class="anchor-navigation-ex-anchor" href="#&#x4EE3;&#x7801;&#x6253;&#x5F00;trace"><i class="fa fa-link" aria-hidden="true"></i></a>15.2.5. &#x4EE3;&#x7801;&#x6253;&#x5F00;trace</h3>
<p>&#x4E0A;&#x9762;&#x4ECB;&#x7ECD;&#x7684;&#x662F;pprof&#x63D0;&#x4F9B;&#x7684;&#x7F51;&#x9875;&#x5F0F;&#x6253;&#x5F00;trace&#x7684;&#x65B9;&#x6CD5;, &#x597D;&#x5904;&#x662F;&#x6BD4;&#x8F83;&#x65B9;&#x4FBF;, &#x4F46;&#x8981;&#x5F15;&#x5165;http&#x7B49;&#x4E0A;&#x5C42;&#x534F;&#x8BAE;.
&#x5728;&#x4EE3;&#x7801;&#x91CC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6253;&#x5F00;trace.
&#x5F15;&#x5165;&#x201C;runtime/trace&#x201D;&#x5305;&#xFF0C;&#x8C03;&#x7528;&#x65B9;&#x6CD5;trace.Start()/trace.Stop()</p>
<h3 id="&#x4E0D;&#x540C;&#x7684;profile&#x6587;&#x4EF6;&#x5BF9;&#x6BD4;"><a name="&#x4E0D;&#x540C;&#x7684;profile&#x6587;&#x4EF6;&#x5BF9;&#x6BD4;" class="anchor-navigation-ex-anchor" href="#&#x4E0D;&#x540C;&#x7684;profile&#x6587;&#x4EF6;&#x5BF9;&#x6BD4;"><i class="fa fa-link" aria-hidden="true"></i></a>15.2.6. &#x4E0D;&#x540C;&#x7684;profile&#x6587;&#x4EF6;&#x5BF9;&#x6BD4;</h3>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x5BF9;&#x6BD4;1&#x548C;2&#x7684;&#x5DEE;&#x5F02;</span>
go tool pprof <span class="token parameter variable">-http</span><span class="token operator">=</span>:8080 <span class="token parameter variable">--base</span> dumps/heap-profile-cmp-001.pb.gz dumps/heap-profile-cmp-002.pb.gz
</code></pre>
<h2 id="&#x4F20;&#x7EDF;&#x706B;&#x7130;&#x56FE;&#x65B9;&#x5F0F;"><a name="&#x4F20;&#x7EDF;&#x706B;&#x7130;&#x56FE;&#x65B9;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#&#x4F20;&#x7EDF;&#x706B;&#x7130;&#x56FE;&#x65B9;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>15.3. &#x4F20;&#x7EDF;&#x706B;&#x7130;&#x56FE;&#x65B9;&#x5F0F;</h2>
<pre class="language-"><code class="lang-sh">perf record <span class="token parameter variable">-g</span> <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">`</span>pidof tooManyTimer<span class="token variable">`</span></span> -- <span class="token function">sleep</span> <span class="token number">60</span>
perf script <span class="token operator">|</span> /repo/yingjieb/FlameGraph/stackcollapse-perf.pl <span class="token operator">|</span> /repo/yingjieb/FlameGraph/flamegraph.pl <span class="token operator">&gt;</span> tooManyTimer60s.svg

perf <span class="token function">top</span> <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">`</span>pidof tooManyTimer<span class="token variable">`</span></span>
</code></pre>
<ul>
<li>x86&#x4E0B;&#x9762;<code>-g --call-graph dwarf</code>&#x9009;&#x9879;&#x6548;&#x679C;&#x4E0D;&#x597D;, &#x8C03;&#x7528;&#x6808;&#x4E0D;&#x5168;</li>
</ul>
<h2 id="&#x4EE3;&#x7801;&#x91CC;&#x52A0;&#x8C03;&#x8BD5;&#x652F;&#x6301;"><a name="&#x4EE3;&#x7801;&#x91CC;&#x52A0;&#x8C03;&#x8BD5;&#x652F;&#x6301;" class="anchor-navigation-ex-anchor" href="#&#x4EE3;&#x7801;&#x91CC;&#x52A0;&#x8C03;&#x8BD5;&#x652F;&#x6301;"><i class="fa fa-link" aria-hidden="true"></i></a>15.4. &#x4EE3;&#x7801;&#x91CC;&#x52A0;&#x8C03;&#x8BD5;&#x652F;&#x6301;</h2>
<p><code>go doc pprof</code>&#x53EF;&#x4EE5;&#x67E5;&#x5230;&#x4E24;&#x79CD;debug&#x65B9;&#x5F0F;, &#x539F;&#x7406;&#x90FD;&#x5DEE;&#x4E0D;&#x591A;, &#x533A;&#x522B;&#x662F;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x4E0D;&#x540C;.
&#x8FD9;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x90FD;&#x80FD;&#x751F;&#x6210;profile&#x6587;&#x4EF6;, &#x7528;&#x4E8E;<code>go tool pprof</code>&#x8FDB;&#x4E00;&#x6B65;&#x68C0;&#x67E5;</p>
<h3 id="&#x547D;&#x4EE4;&#x884C;&#x8C03;&#x8BD5;-runtimepprof"><a name="&#x547D;&#x4EE4;&#x884C;&#x8C03;&#x8BD5;-runtimepprof" class="anchor-navigation-ex-anchor" href="#&#x547D;&#x4EE4;&#x884C;&#x8C03;&#x8BD5;-runtimepprof"><i class="fa fa-link" aria-hidden="true"></i></a>15.4.1. &#x547D;&#x4EE4;&#x884C;&#x8C03;&#x8BD5;: &quot;runtime/pprof&quot;</h3>
<p>go test&#x6846;&#x67B6;&#x81EA;&#x5E26;pprof&#x652F;&#x6301;, &#x7528;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x5F97;&#x5230;cpu&#x548C;mem&#x7684;profile.
<code>go test -cpuprofile cpu.prof -memprofile mem.prof -bench .</code>
&#x81EA;&#x5DF1;&#x7684;&#x7A0B;&#x5E8F;&#x8981;&#x5F97;&#x5230;&#x8FD9;&#x4E2A;&#x6548;&#x679C;, &#x9700;&#x8981;<code>runtime/pprof</code>
&#x52A0;&#x7C7B;&#x4F3C;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;:</p>
<pre class="language-"><code class="lang-go">    <span class="token keyword">var</span> cpuprofile <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;cpuprofile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;write cpu profile to `file`&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> memprofile <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;memprofile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;write memory profile to `file`&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        flag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token operator">*</span>cpuprofile <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
            f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">*</span>cpuprofile<span class="token punctuation">)</span>
            <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;could not create CPU profile: &quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> err <span class="token operator">:=</span> pprof<span class="token punctuation">.</span><span class="token function">StartCPUProfile</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;could not start CPU profile: &quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">defer</span> pprof<span class="token punctuation">.</span><span class="token function">StopCPUProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// ... rest of the program ...</span>

        <span class="token keyword">if</span> <span class="token operator">*</span>memprofile <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
            f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">*</span>memprofile<span class="token punctuation">)</span>
            <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;could not create memory profile: &quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            runtime<span class="token punctuation">.</span><span class="token function">GC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// get up-to-date statistics</span>
            <span class="token keyword">if</span> err <span class="token operator">:=</span> pprof<span class="token punctuation">.</span><span class="token function">WriteHeapProfile</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;could not write memory profile: &quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x7F51;&#x9875;&#x8C03;&#x8BD5;-nethttppprof"><a name="&#x7F51;&#x9875;&#x8C03;&#x8BD5;-nethttppprof" class="anchor-navigation-ex-anchor" href="#&#x7F51;&#x9875;&#x8C03;&#x8BD5;-nethttppprof"><i class="fa fa-link" aria-hidden="true"></i></a>15.4.2. &#x7F51;&#x9875;&#x8C03;&#x8BD5;: &quot;net/http/pprof&quot;</h3>
<pre class="language-"><code class="lang-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;net/http&quot;</span>
    <span class="token boolean">_</span> <span class="token string">&quot;net/http/pprof&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;:9999&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x8FD9;&#x91CC;&#x7684;port&#x968F;&#x4FBF;&#x586B;
&quot;net/http/pprof&quot;&#x4F1A;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;default&#x7684;httpHandler, &#x8BBF;&#x95EE;<code>http://ip:port/debug/pprof/</code>&#x4F1A;&#x4F7F;&#x7528;&#x6B64;&#x9ED8;&#x8BA4;&#x7684;handler</p>
<h2 id="&#x4F7F;&#x7528;debug&#x7F51;&#x9875;"><a name="&#x4F7F;&#x7528;debug&#x7F51;&#x9875;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;debug&#x7F51;&#x9875;"><i class="fa fa-link" aria-hidden="true"></i></a>15.5. &#x4F7F;&#x7528;debug&#x7F51;&#x9875;</h2>
<p>Web&#x7F51;&#x9875;<code>http://ip:port/debug/pprof/</code>&#x80FD;&#x63D0;&#x4F9B;&#x5F88;&#x591A;&#x6709;&#x7528;&#x7684;&#x4FE1;&#x606F;:</p>
<ul>
<li>/debug/pprof/profile&#xFF1A;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x94FE;&#x63A5;&#x4F1A;&#x81EA;&#x52A8;&#x8FDB;&#x884C; CPU profiling&#xFF0C;&#x6301;&#x7EED; 30s&#xFF0C;&#x5E76;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x4F9B;&#x4E0B;&#x8F7D;; &#x7528;<code>go tool pprof &#x8FD9;&#x4E2A;&#x6587;&#x4EF6;</code>&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x540E;&#x7EED;&#x5206;&#x6790;</li>
<li>/debug/pprof/block&#xFF1A;Goroutine&#x963B;&#x585E;&#x4E8B;&#x4EF6;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x9ED8;&#x8BA4;&#x6BCF;&#x53D1;&#x751F;&#x4E00;&#x6B21;&#x963B;&#x585E;&#x4E8B;&#x4EF6;&#x65F6;&#x53D6;&#x6837;&#x4E00;&#x6B21;&#x3002;</li>
<li>/debug/pprof/goroutines&#xFF1A;&#x6D3B;&#x8DC3;Goroutine&#x7684;&#x4FE1;&#x606F;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x4EC5;&#x5728;&#x83B7;&#x53D6;&#x65F6;&#x53D6;&#x6837;&#x4E00;&#x6B21;&#x3002;</li>
<li>/debug/pprof/heap&#xFF1A; &#x5806;&#x5185;&#x5B58;&#x5206;&#x914D;&#x60C5;&#x51B5;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x9ED8;&#x8BA4;&#x6BCF;&#x5206;&#x914D;512K&#x5B57;&#x8282;&#x65F6;&#x53D6;&#x6837;&#x4E00;&#x6B21;&#x3002;</li>
<li>/debug/pprof/mutex: &#x67E5;&#x770B;&#x4E89;&#x7528;&#x4E92;&#x65A5;&#x9501;&#x7684;&#x6301;&#x6709;&#x8005;&#x3002;</li>
<li>/debug/pprof/threadcreate: &#x7CFB;&#x7EDF;&#x7EBF;&#x7A0B;&#x521B;&#x5EFA;&#x60C5;&#x51B5;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x4EC5;&#x5728;&#x83B7;&#x53D6;&#x65F6;&#x53D6;&#x6837;&#x4E00;&#x6B21;&#x3002;</li>
<li>/debug/pprof/trace: &#x548C;profile&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x7C7B;&#x4F3C;, &#x4EA7;&#x751F;&#x5F53;&#x524D;&#x7A0B;&#x5E8F;&#x7684;&#x6267;&#x884C;trace&#x6587;&#x4EF6;. &#x7528;<code>go tool trace</code>&#x53EF;&#x4EE5;&#x5206;&#x6790;&#x8FD9;&#x4E2A;trace</li>
</ul>
<p>&#x8FD9;&#x4E2A;&#x7F51;&#x9875;&#x7684;&#x57FA;&#x672C;&#x903B;&#x8F91;&#x662F;&#x70B9;&#x4E00;&#x6B21;, &#x4EA7;&#x751F;&#x4E00;&#x6B21;&#x6570;&#x636E;. &#x7ED3;&#x5408;<code>go tool pprof</code>&#x53EF;&#x4EE5;&#x505A;&#x66F4;&#x591A;&#x7684;&#x4E8B;</p>
<h2 id="&#x4F7F;&#x7528;go-tool-pprof"><a name="&#x4F7F;&#x7528;go-tool-pprof" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;go-tool-pprof"><i class="fa fa-link" aria-hidden="true"></i></a>15.6. &#x4F7F;&#x7528;go tool pprof</h2>
<p><code>go tool pprof</code>&#x7684;&#x57FA;&#x672C;&#x547D;&#x4EE4;&#x683C;&#x5F0F;&#x662F;:<br><code>pprof <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>format</span><span class="token punctuation">&gt;</span></span> [options] [binary] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span> ...</code><br>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6307;&#x5B9A;output format, &#x5219;&#x8FDB;&#x5165;&#x4EA4;&#x4E92;&#x6A21;&#x5F0F;.<br>source&#x662F;&#x7F51;&#x9875;&#x4EA7;&#x751F;&#x7684;profile&#x6587;&#x4EF6;. &#x4E00;&#x822C;&#x5C31;&#x76F4;&#x63A5;&#x5199;URL&#x5730;&#x5740;<br><code>go tool pprof http://10.182.105.138:9999/debug/pprof/profile</code><br>&#x9ED8;&#x8BA4;&#x7684;&#x53D6;&#x6837;&#x65F6;&#x95F4;&#x662F;30s &#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;-seconds &#x547D;&#x4EE4;&#x6765;&#x6307;&#x5B9A;&#x53D6;&#x6837;&#x65F6;&#x95F4; &#xFF0C;&#x53D6;&#x6837;&#x5B8C;&#x6210;&#x540E;&#x4F1A;&#x8FDB;&#x5165;&#x547D;&#x4EE4;&#x884C;&#x72B6;&#x6001;</p>
<pre class="language-"><code class="lang-sh">$ go tool pprof http://10.182.105.138:9999/debug/pprof/profile
Fetching profile over HTTP from http://10.182.105.138:9999/debug/pprof/profile
Saved profile <span class="token keyword">in</span> /home/yingjieb/pprof/pprof.tooManyTimer.samples.cpu.002.pb.gz
File: tooManyTimer
Type: cpu
Time: Apr <span class="token number">8</span>, <span class="token number">2020</span> at <span class="token number">10</span>:56am <span class="token punctuation">(</span>UTC<span class="token punctuation">)</span>
Duration: 30s, Total samples <span class="token operator">=</span> <span class="token number">1</span>.35s <span class="token punctuation">(</span> <span class="token number">4.50</span>%<span class="token punctuation">)</span>
Entering interactive mode <span class="token punctuation">(</span>type <span class="token string">&quot;help&quot;</span> <span class="token keyword">for</span> commands, <span class="token string">&quot;o&quot;</span> <span class="token keyword">for</span> options<span class="token punctuation">)</span>
</code></pre>
<p>&#x4E0A;&#x9762;&#x4F8B;&#x5B50;&#x4E2D;, &#x4F1A;&#x5199;&#x660E;profile&#x6587;&#x4EF6;&#x653E;&#x5728;&#x7528;&#x6237;&#x76EE;&#x5F55;&#x4E0B;&#x7684;<code>~/pprof</code>&#x8DEF;&#x5F84;&#x4E0B;.
&#x9ED8;&#x8BA4;&#x91C7;&#x6837;30s, &#x4E00;&#x5171;&#x91C7;&#x5230;&#x4E86;1.35s, &#x5360;&#x6BD4;4.5%</p>
<h3 id="top&#x547D;&#x4EE4;"><a name="top&#x547D;&#x4EE4;" class="anchor-navigation-ex-anchor" href="#top&#x547D;&#x4EE4;"><i class="fa fa-link" aria-hidden="true"></i></a>15.6.1. top&#x547D;&#x4EE4;</h3>
<pre class="language-"><code>(pprof) top 20
Showing nodes accounting for 1.19s, 88.15% of 1.35s total
Showing top 20 nodes out of 70
      flat  flat%   sum%        cum   cum%
     0.65s 48.15% 48.15%      0.65s 48.15%  runtime.futex
     0.09s  6.67% 54.81%      0.25s 18.52%  runtime.notetsleep_internal
     0.07s  5.19% 60.00%      0.07s  5.19%  runtime.siftdownTimer
     0.07s  5.19% 65.19%      0.07s  5.19%  runtime.usleep
     0.03s  2.22% 67.41%      0.08s  5.93%  runtime.selectgo
     0.03s  2.22% 69.63%      0.19s 14.07%  runtime.startm
     0.02s  1.48% 71.11%      0.02s  1.48%  runtime.(*gList).pop
     0.02s  1.48% 72.59%      0.19s 14.07%  runtime.findrunnable
     0.02s  1.48% 74.07%      0.02s  1.48%  runtime.gopark
     0.02s  1.48% 75.56%      0.23s 17.04%  runtime.mcall
     0.02s  1.48% 77.04%      0.02s  1.48%  runtime.osyield
     0.02s  1.48% 78.52%      0.02s  1.48%  runtime.retake
     0.02s  1.48% 80.00%      0.21s 15.56%  runtime.schedule
     0.02s  1.48% 81.48%      0.02s  1.48%  runtime.sellock
     0.02s  1.48% 82.96%      0.17s 12.59%  runtime.stopm
     0.02s  1.48% 84.44%      0.24s 17.78%  runtime.sysmon
     0.02s  1.48% 85.93%      0.67s 49.63%  runtime.timerproc
     0.01s  0.74% 86.67%      0.11s  8.15%  main.handleOnu
     0.01s  0.74% 87.41%      0.01s  0.74%  runtime.(*gList).empty
     0.01s  0.74% 88.15%      0.01s  0.74%  runtime.(*mcache).prepareForSweep
</code></pre><p>profile&#x6587;&#x4EF6;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;&#x8FD8;&#x662F;&#x91C7;&#x6837;, &#x5728;&#x4E0A;&#x9762;&#x4F8B;&#x5B50;&#x4E2D;:</p>
<ul>
<li>flat&#x662F;&#x672C;&#x51FD;&#x6570;&#x6267;&#x884C;&#x7684;&#x65F6;&#x95F4;, &#x4E0D;&#x5305;&#x62EC;&#x5176;&#x4ED6;<strong>&#x5DF2;&#x7ECF;&#x88AB;&#x91C7;&#x6837;&#x7684;</strong>&#x51FD;&#x6570;</li>
<li>cum&#x5305;&#x62EC;&#x672C;&#x51FD;&#x6570;&#x53CA;&#x4ECE;&#x5176;&#x8C03;&#x7528;&#x51FA;&#x53BB;&#x7684;&#x6240;&#x6709;&#x65F6;&#x95F4;, &#x5305;&#x62EC;&#x6240;&#x6709;&#x5B50;&#x51FD;&#x6570;, &#x5F53;&#x7136;&#x5305;&#x62EC;&#x5176;&#x4ED6;<strong>&#x5DF2;&#x7ECF;&#x88AB;&#x91C7;&#x6837;&#x7684;</strong>&#x51FD;&#x6570;</li>
<li>&#x9ED8;&#x8BA4;&#x6309;&#x7167;%flat&#x6392;&#x5E8F;, &#x8FD9;&#x5F88;&#x597D;&#x7406;&#x89E3;, flat&#x57FA;&#x672C;&#x8868;&#x793A;&#x4E86;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x672C;&#x8EAB;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;. &#x5982;&#x679C;&#x5B83;&#x7684;&#x5B50;&#x51FD;&#x6570;&#x4E5F;&#x88AB;&#x91C7;&#x6837;&#x5230;&#x4E86;, &#x662F;<strong>&#x4E0D;&#x8BA1;&#x5165;</strong>&#x672C;&#x51FD;&#x6570;&#x7684;&#x65F6;&#x95F4;&#x7684;.</li>
<li>flat&#x548C;cum&#x91CD;&#x8981;, &#x5206;&#x522B;&#x53CD;&#x5E94;&#x4E86;&#x672C;&#x51FD;&#x6570;&#x7684;&#x6548;&#x7387;&#x548C;&#x6240;&#x6709;&#x5B50;&#x51FD;&#x6570;&#x7684;&#x6548;&#x7387;</li>
<li>sum%&#x53EA;&#x662F;&#x6392;&#x5E8F;&#x7D2F;&#x52A0;, &#x6CA1;&#x5565;&#x5927;&#x610F;&#x601D;.</li>
</ul>
<h3 id="list&#x547D;&#x4EE4;"><a name="list&#x547D;&#x4EE4;" class="anchor-navigation-ex-anchor" href="#list&#x547D;&#x4EE4;"><i class="fa fa-link" aria-hidden="true"></i></a>15.6.2. list&#x547D;&#x4EE4;</h3>
<p>list&#x547D;&#x4EE4;&#x548C;gdb&#x7684;list&#x770B;&#x6E90;&#x7801;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x5F88;&#x50CF;, &#x4F46;&#x80FD;&#x663E;&#x793A;&#x91C7;&#x6837;&#x4FE1;&#x606F;
(flat, cum)&#x7684;&#x610F;&#x601D;&#x662F;: &#x7B2C;&#x4E00;&#x5217;&#x65F6;&#x95F4;&#x662F;&#x91C7;&#x6837;&#x53D1;&#x751F;&#x5728;&#x672C;&#x51FD;&#x6570;&#x7684;; &#x7B2C;&#x4E8C;&#x5217;&#x662F;&#x91C7;&#x6837;&#x53D1;&#x751F;&#x5728;&#x5B50;&#x51FD;&#x6570;&#x91CC;&#x7684;.</p>
<pre class="language-"><code>(pprof) list runtime.timerproc
Total: 1.35s
ROUTINE ======================== runtime.timerproc in /usr/local/go/src/runtime/time.go
      20ms      670ms (flat, cum) 49.63% of Total
         .          .    260:                   delta = t.when - now
         .          .    261:                   if delta &gt; 0 {
         .          .    262:                           break
         .          .    263:                   }
         .          .    264:                   ok := true
      10ms       10ms    265:                   if t.period &gt; 0 {
         .          .    266:                           // leave in heap but adjust next time to fire
      10ms       10ms    267:                           t.when += t.period * (1 + -delta/t.period)
         .       70ms    268:                           if !siftdownTimer(tb.t, 0) {
         .          .    269:                                   ok = false
         .          .    270:                           }
</code></pre><h3 id="svg&#x547D;&#x4EE4;&#x548C;perf&#x706B;&#x7130;&#x56FE;&#x5BF9;&#x6BD4;"><a name="svg&#x547D;&#x4EE4;&#x548C;perf&#x706B;&#x7130;&#x56FE;&#x5BF9;&#x6BD4;" class="anchor-navigation-ex-anchor" href="#svg&#x547D;&#x4EE4;&#x548C;perf&#x706B;&#x7130;&#x56FE;&#x5BF9;&#x6BD4;"><i class="fa fa-link" aria-hidden="true"></i></a>15.6.3. svg&#x547D;&#x4EE4;&#x548C;perf&#x706B;&#x7130;&#x56FE;&#x5BF9;&#x6BD4;</h3>
<p>svg&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x751F;&#x6210;&#x91C7;&#x6837;&#x5206;&#x5E03;&#x56FE;&#x548C;&#x8C03;&#x7528;&#x5173;&#x7CFB;&#x56FE;<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083106.png" alt="">  </p>
<p>perf&#x7684;&#x706B;&#x7130;&#x56FE;<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083124.png" alt="">  </p>
<p>pprof&#x548C;perf&#x5BF9;&#x6BD4;&#x51E0;&#x70B9;&#x8BF4;&#x660E;:</p>
<ul>
<li>svg&#x663E;&#x793A;&#x7684;&#x91C7;&#x6837;&#x5360;&#x6BD4;&#x548C;top&#x4E00;&#x81F4;. &#x6BD4;&#x5982;&#x4E5F;&#x662F;&#x5206;&#x81EA;&#x8EAB;&#x65F6;&#x95F4;&#x548C;&#x7D2F;&#x79EF;&#x65F6;&#x95F4;</li>
<li>perf&#x7248;&#x672C;&#x7684;&#x706B;&#x7130;&#x56FE;&#x8C03;&#x7528;&#x6808;&#x89E3;&#x6790;&#x7EC6;&#x8282;&#x4E0D;&#x5B8C;&#x6574;, &#x6BD4;&#x5982;&#x6700;&#x5DE6;&#x8FB9;runtime.notetsleep_internal&#x662F;&#x4ECE;timeproc&#x8C03;&#x7528;&#x4E0B;&#x6765;&#x7684;.</li>
<li>perf&#x6709;&#x5185;&#x6838;&#x6001;&#x7684;&#x8DEF;&#x5F84;, pprof&#x6CA1;&#x6709;</li>
<li>perf&#x548C;pprof&#x7684;&#x56FE;&#x8981;&#x7ED3;&#x5408;&#x770B;, &#x4E92;&#x8865;.</li>
</ul>
<h2 id="&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;-handleonu-&#x4E3B;&#x8981;&#x662F;select"><a name="&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;-handleonu-&#x4E3B;&#x8981;&#x662F;select" class="anchor-navigation-ex-anchor" href="#&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;-handleonu-&#x4E3B;&#x8981;&#x662F;select"><i class="fa fa-link" aria-hidden="true"></i></a>15.7. &#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;: handleOnu, &#x4E3B;&#x8981;&#x662F;select</h2>
<h3 id="pprof-svg"><a name="pprof-svg" class="anchor-navigation-ex-anchor" href="#pprof-svg"><i class="fa fa-link" aria-hidden="true"></i></a>15.7.1. pprof svg</h3>
<p><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083204.png" alt="">  </p>
<ol>
<li>select&#x4F1A;&#x88AB;&#x7F16;&#x8BD1;&#x5668;&#x8F6C;&#x5316;&#x4E3A;&#x8FD0;&#x884C;&#x65F6;&#x7684;<code>(*waitq)enqueue</code>&#x548C;<code>gopark</code>&#x628A;&#x5F53;&#x524D;goroutine&#x8C03;&#x5EA6;&#x51FA;&#x53BB;</li>
<li>select&#x6709;&#x4E00;&#x628A;&#x9501;(sellock), &#x9501;&#x4F4F;&#x6240;&#x6709;case?<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083224.png" alt="">  </li>
<li>handleOnu&#x4EE3;&#x7801;&#x5360;&#x6BD4;8.15%, &#x5927;&#x90E8;&#x5206;&#x662F;&#x5728;&#x641E;goroutine&#x7684;&#x5207;&#x6362;&#x51C6;&#x5907;.<h3 id="perf-&#x706B;&#x7130;&#x56FE;"><a name="perf-&#x706B;&#x7130;&#x56FE;" class="anchor-navigation-ex-anchor" href="#perf-&#x706B;&#x7130;&#x56FE;"><i class="fa fa-link" aria-hidden="true"></i></a>15.7.2. perf &#x706B;&#x7130;&#x56FE;</h3>
<img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083241.png" alt=""><br>perf&#x5BF9;go&#x662F;&#x65E0;&#x611F;&#x77E5;&#x7684;, &#x5B83;&#x7684;&#x8C03;&#x7528;&#x6808;&#x89E3;&#x6790;&#x76F8;&#x5BF9;&#x4E0D;&#x662F;&#x90A3;&#x4E48;&#x7CBE;&#x786E;, &#x4F46;&#x611F;&#x89C9;&#x5927;&#x81F4;&#x662F;&#x5BF9;&#x7684;.</li>
<li>runtime.mcall&#x662F;<code>func mcall(fn func(*g))</code>, &#x4F5C;&#x7528;&#x662F;&#x4ECE;&#x5F53;&#x524D;g&#x5207;&#x6362;&#x5230;g0&#x6808;, &#x5E76;&#x6267;&#x884C;fn; mcall&#x662F;CPU ARCH&#x76F8;&#x5173;&#x7684;&#x6C47;&#x7F16;&#x5165;&#x53E3;.
pprof&#x7684;svg&#x56FE;&#x91CC;&#x9762;, mcall&#x4E0D;&#x662F;&#x5728;selectgo()&#x51FD;&#x6570;&#x91CC;&#x8C03;&#x7528;&#x7684;, &#x800C;&#x662F;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;<code>runtime._System</code>&#x5165;&#x53E3;.&#x8FD9;&#x4E2A;&#x5165;&#x53E3;&#x4F3C;&#x4E4E;&#x662F;&#x8C03;&#x5EA6;&#x5668;&#x7684;&#x5165;&#x53E3;, &#x88AB;&#x5355;&#x72EC;&#x63D0;&#x51FA;&#x6765;&#x4E86;. &#x4F46;&#x5B9E;&#x9645;&#x4E0A;, mcall(park<em>m)&#x5C31;&#x662F;&#x5728;selectgo&#x91CC;&#x9762;&#x8C03;&#x7528;&#x7684;. park_m&#x4F1A;&#x8C03;&#x7528;schedule()&#x89E6;&#x53D1;&#x8C03;&#x5EA6;.<br>![](img/golang</em>&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083305.png)<br>&#x7ED3;&#x5408;&#x4E0A;&#x9762;perf&#x706B;&#x7130;&#x56FE;, &#x8C03;&#x5EA6;&#x5668;&#x6700;&#x7EC8;&#x4F1A;&#x8C03;&#x7528;futex&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x6765;&#x89E6;&#x53D1;kernel&#x7EA7;&#x522B;&#x7684;&#x8C03;&#x5EA6;.<br>&#x6211;&#x4F30;&#x8BA1;&#x8FD9;&#x91CC;&#x7684;&#x903B;&#x8F91;&#x662F;: &#x5F53;&#x6CA1;&#x6709;&#x6D3B;&#x771F;&#x6B63;&#x8981;&#x5E72;&#x65F6;, &#x8C03;&#x7528;park_m&#x8FDB;&#x800C;&#x5C42;&#x5C42;&#x8C03;&#x7528;futex&#x6765;&#x8BA9;M&#x8FDB;&#x5165;&#x4F11;&#x7720;&#x72B6;&#x6001;. &#x4ECE;&#x8FD9;&#x70B9;&#x4E0A;&#x770B;, perf&#x706B;&#x7130;&#x56FE;&#x628A;&#x5B83;&#x653E;&#x5728;selectgo&#x91CC;&#x9762;&#x662F;&#x5408;&#x7406;&#x7684;. &#x5B9E;&#x9645;&#x4E0A;, &#x8FD9;&#x91CC;&#x7684;&#x91C7;&#x6837;&#x70B9;&#x8FD9;&#x4E48;&#x591A;, &#x662F;&#x56E0;&#x4E3A;timer&#x591A;, &#x6BCF;&#x4E2A;timer&#x6BCF;&#x79D2;&#x90FD;&#x8981;&#x8C03;&#x8FD9;&#x4E48;&#x4E00;&#x5708;.</li>
</ol>
<h2 id="&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;-timerproc"><a name="&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;-timerproc" class="anchor-navigation-ex-anchor" href="#&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;-timerproc"><i class="fa fa-link" aria-hidden="true"></i></a>15.8. &#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;: timerproc</h2>
<p>timerproc&#x662F;goroutine, &#x6240;&#x4EE5;&#x5728;&#x8FD9;&#x91CC;&#x662F;&#x4E2A;&#x5165;&#x53E3;. pprof&#x62A5;&#x544A;&#x8FD9;&#x90E8;&#x5206;&#x5360;49.63%. perf&#x62A5;&#x544A;&#x8FD9;&#x90E8;&#x5206;&#x5360;27%. &#x4F46;&#x7ED3;&#x5408;&#x6765;&#x770B;, &#x5E94;&#x8BE5;&#x628A;perf&#x7684;runtime.notetsleep_internal&#x90E8;&#x5206;&#x7684;23%&#x4E5F;&#x7B97;&#x5728;&#x4E00;&#x8D77;, &#x5408;&#x8D77;&#x6765;&#x4E5F;&#x662F;&#x5DEE;&#x4E0D;&#x591A;50%</p>
<ul>
<li><p>time.sendTime&#x505A;&#x4E3A;&#x56DE;&#x8C03;&#x51FD;&#x6570;, &#x5728;timerproc&#x91CC;&#x88AB;&#x8C03;&#x7528;. &#x5B83;&#x662F;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x975E;&#x963B;&#x585E;&#x7684;channel&#x5199;</p>
<pre class="language-"><code class="lang-go">  <span class="token keyword">select</span> <span class="token punctuation">{</span>
  <span class="token comment">//&#x6709;default&#x662F;&#x975E;&#x963B;&#x585E;&#x53D1;&#x9001;</span>
  <span class="token keyword">case</span> c<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Time<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> <span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">default</span><span class="token punctuation">:</span>
  <span class="token punctuation">}</span>
</code></pre>
<p>&#x5BF9;&#x5E94;go&#x4EE3;&#x7801;runtime.ChanSend -&gt; &#x4ECE;channel&#x7684;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x53D6;goroutine:<code>runtime.(*waitq).dequeue</code> &#x5524;&#x9192;&#x7B49;&#x5F85;&#x7684;goroutine:<code>goready</code> -&gt; &#x653E;&#x5230;runq:<code>runqput</code><br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083345.png" alt=""><br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083422.png" alt=""><br>&#x8FD9;&#x90E8;&#x5206;<strong>&#x6CA1;&#x6709;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</strong>, &#x5B8C;&#x5168;&#x662F;&#x7528;&#x6237;&#x6001;.&#x5E76;&#x4E14;&#x5360;&#x6BD4;&#x4E0D;&#x9AD8;, &#x53EA;&#x6709;3%.</p>
</li>
<li><p>shiftdownTimer&#x51FD;&#x6570;&#x8D1F;&#x8D23;&#x5BF9;timer&#x5806;&#x6392;&#x5E8F;. &#x5728;2000&#x4E2A;timer&#x7684;&#x60C5;&#x51B5;&#x4E0B;, &#x5360;5%. &#x4E5F;&#x4E0D;&#x662F;&#x5F88;&#x591A;</p>
</li>
<li>&#x5927;&#x5934;&#x5728;notetsleep, &#x8FD9;&#x662F;timerproc&#x5FAA;&#x73AF;&#x4E2D;&#x5904;&#x7406;&#x5B8C;&#x672C;&#x6B21;timer&#x5806;&#x540E;&#x8C03;&#x7528;&#x7684;, &#x963B;&#x585E;&#x7B49;&#x5F85;&#x4E0B;&#x6B21;timer&#x8D85;&#x65F6;.&#x518D;&#x5F80;&#x4E0B;&#x5206;, entersyscallblock&#x5360;14%, exitsyscall&#x5360;14%. &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x90FD;&#x8981;&#x8C03;&#x7528;runtime.systemstack, &#x5728;&#x8FDB;&#x5165;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x963B;&#x585E;&#x524D;, &#x5148;handoffp&#x548C;P&#x89E3;&#x7ED1;&#x5B9A;, &#x7136;&#x540E;M&#x5C31;&#x4F11;&#x7720;&#x4E86;; &#x4F46;&#x89E3;&#x7ED1;&#x540E;&#x7684;P&#x4E0D;&#x80FD;&#x95F2;&#x7740;, &#x4F1A;&#x518D;&#x6B21;&#x7ED1;&#x5B9A;&#x4E00;&#x4E2A;M; &#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;handoffp&#x540E;, &#x9A6C;&#x4E0A;&#x4F1A;&#x8C03;&#x7528;startm&#x542F;&#x52A8;&#x6216;&#x5524;&#x9192;&#x4E00;&#x4E2A;&#x65B0;&#x7684;M;
&#x4E0B;&#x56FE;&#x4E2D;, &#x5524;&#x9192;&#x8DEF;&#x5F84;(&#x5DE6;&#x7BAD;&#x5934;)&#x548C;&#x7761;&#x7720;&#x8DEF;&#x5F84;(&#x53F3;&#x7BAD;&#x5934;)&#x90FD;&#x662F;&#x8C03;&#x7528;futex&#x7CFB;&#x7EDF;&#x8C03;&#x7528;<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083441.png" alt="">  </li>
</ul>
<h3 id="notetsleepg"><a name="notetsleepg" class="anchor-navigation-ex-anchor" href="#notetsleepg"><i class="fa fa-link" aria-hidden="true"></i></a>15.8.1. notetsleepg</h3>
<p>timerproc&#x91CC;&#x9762;, &#x56DE;&#x8C03;&#x51FD;&#x6570;&#x5360;&#x4E00;&#x5C0F;&#x90E8;&#x5206;, timer&#x5806;&#x6392;&#x5E8F;&#x5360;&#x4E00;&#x5C0F;&#x90E8;&#x5206;, &#x5927;&#x5934;&#x90FD;&#x662F;&#x5728;notetsleep&#x524D;&#x540E;&#x7684;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;, &#x5305;&#x62EC;:</p>
<ul>
<li>entersyscallblock: &#x6B64;&#x65F6;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x672C;G&#x6240;&#x5728;&#x7684;M&#x8981;&#x8C03;&#x7528;&#x963B;&#x585E;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x800C;&#x4F11;&#x7720;, &#x8981;&#x505A;&#x4E00;&#x4E9B;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;: &#x5728;&#x8FDB;&#x5165;&#x4F11;&#x7720;&#x4E4B;&#x524D;, &#x5148;&#x4EA4;&#x51FA;P&#x7684;&#x4F7F;&#x7528;&#x6743;, &#x5373;handoffp; <strong>&#x6B64;&#x65F6;&#x7A7A;&#x51FA;&#x6765;&#x7684;P&#x8981;&#x6C42;&#x7ED1;&#x5B9A;&#x4E00;&#x4E2A;&#x65B0;&#x7684;M, &#x5373;&#x4E0A;&#x56FE;&#x4E2D;&#x7684;startm</strong>, &#x540E;&#x8005;&#x8C03;&#x7528;futexwakeup&#x53BB;&#x5524;&#x9192;&#x5176;&#x4ED6;&#x7684;M.&#x54EA;&#x4E9B;M&#x89C1;&#x4E0B;&#x4E2A;&#x5C0F;&#x8282;<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083527.png" alt="">  </li>
<li><p>exitsyscall: &#x6B63;&#x5E38;&#x6765;&#x8BB2;, &#x4E00;&#x4E2A;M&#x88AB;&#x5524;&#x9192;&#x65F6;, &#x8981;acquirep, &#x4E5F;&#x8BB8;&#x5C31;&#x662F;&#x521A;&#x521A;&#x8BA9;&#x51FA;&#x6765;&#x7684;P, &#x6765;&#x7ED1;&#x5B9A;&#x672C;M; &#x4F46;&#x4E0A;&#x9762;&#x7684;&#x7EDF;&#x8BA1;&#x5F97;&#x51FA;, &#x672C;M&#x88AB;&#x5524;&#x9192;&#x540E;, &#x8D70;fast_pidle&#x6D41;&#x7A0B;, &#x5C31;&#x662F;&#x8BF4;&#x5F88;&#x591A;&#x65F6;&#x5019;P&#x662F;idle&#x7684;, &#x8FD9;&#x548C;htop&#x7684;4.5%CPU&#x5360;&#x7528;&#x7387;&#x76F8;&#x7B26;; &#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;, &#x53EF;&#x80FD;&#x5927;&#x90E8;&#x5206;&#x65F6;&#x95F4;&#x6BD4;&#x4F8B;&#x90FD;&#x4E0D;&#x771F;&#x6B63;&#x5360;&#x7528;CPU. P&#x662F;idle&#x7684;&#x60C5;&#x51B5;&#x4E0B;, &#x7EE7;&#x7EED;&#x8D70;notewakeup&#x6D41;&#x7A0B;, <strong>&#x4F46;&#x770B;&#x8D77;&#x6765;&#x4E0D;&#x592A;&#x5BF9;&#x554A;</strong>, &#x6B64;&#x65F6;&#x4E0D;&#x662F;&#x5E94;&#x8BE5;&#x771F;&#x6B63;&#x4F11;&#x7720;&#x5417;? &#x4E5F;&#x8BB8;&#x662F;&#x4E2A;bug? <strong>&#x600E;&#x4E48;&#x6709;&#x53CD;&#x590D;wakup&#x7684;&#x5ACC;&#x7591;?</strong></p>
<pre class="language-"><code class="lang-go"><span class="token comment">// same as runtime&#xB7;notetsleep, but called on user g (not g0)</span>
<span class="token comment">// calls only nosplit functions between entersyscallblock/exitsyscall</span>
<span class="token keyword">func</span> <span class="token function">notetsleepg</span><span class="token punctuation">(</span>n <span class="token operator">*</span>note<span class="token punctuation">,</span> ns <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
  gp <span class="token operator">:=</span> <span class="token function">getg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> gp <span class="token operator">==</span> gp<span class="token punctuation">.</span>m<span class="token punctuation">.</span>g0 <span class="token punctuation">{</span>
      <span class="token function">throw</span><span class="token punctuation">(</span><span class="token string">&quot;notetsleepg on g0&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">entersyscallblock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  ok <span class="token operator">:=</span> <span class="token function">notetsleep_internal</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> ns<span class="token punctuation">)</span>
  <span class="token function">exitsyscall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> ok
<span class="token punctuation">}</span>
</code></pre>
</li>
</ul>
<h3 id="&#x95EE;&#x9898;-futex&#x5524;&#x9192;&#x8DEF;&#x5F84;&#x662F;&#x5E72;&#x5565;&#x7528;&#x7684;"><a name="&#x95EE;&#x9898;-futex&#x5524;&#x9192;&#x8DEF;&#x5F84;&#x662F;&#x5E72;&#x5565;&#x7528;&#x7684;" class="anchor-navigation-ex-anchor" href="#&#x95EE;&#x9898;-futex&#x5524;&#x9192;&#x8DEF;&#x5F84;&#x662F;&#x5E72;&#x5565;&#x7528;&#x7684;"><i class="fa fa-link" aria-hidden="true"></i></a>15.8.2. &#x95EE;&#x9898;: futex&#x5524;&#x9192;&#x8DEF;&#x5F84;&#x662F;&#x5E72;&#x5565;&#x7528;&#x7684;?</h3>
<p>&#x6309;&#x7406;&#x8BF4;, timerproc&#x7684;futex&#x90FD;&#x662F;&#x5E26;&#x8D85;&#x65F6;&#x7684;, &#x90A3;&#x7B49;&#x5F85;&#x8D85;&#x65F6;, kernel&#x81EA;&#x7136;&#x4F1A;wakeup&#x8FD9;&#x4E2A;M.
&#x90A3;&#x4E0A;&#x6587;&#x4E2D;, P&#x548C;M&#x5206;&#x79BB;&#x540E;, &#x8981;&#x9009;&#x4E00;&#x4E2A;&#x65B0;&#x7684;M&#x6765;wakeup&#x6765;&#x5E72;&#x6D3B;, &#x90A3;&#x4E48;&#x662F;&#x54EA;&#x4E9B;M&#x4F1A;&#x88AB;wakeup&#x5462;?<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083605.png" alt=""><br>&#x9996;&#x5148;, &#x4ECE;htop&#x4E2D;&#x770B;&#x5230;, &#x4E00;&#x5171;&#x7531;4&#x4E2A;&#x7EBF;&#x7A0B;, &#x90A3;&#x4E48;&#x5C31;&#x662F;4&#x4E2A;M</p>
<ul>
<li>timerproc&#x90A3;&#x4E2A;routine&#x6240;&#x5728;&#x7684;M&#x5E94;&#x8BE5;&#x6700;&#x5FD9;, &#x4E5F;&#x5C31;&#x5F88;&#x53EF;&#x80FD;&#x662F;pid 21217</li>
<li>&#x7B2C;&#x4E8C;&#x4E2A;&#x5FD9;&#x7684;M&#x5E94;&#x8BE5;&#x662F;sysmon&#x6240;&#x5728;&#x7684;M</li>
<li>&#x5176;&#x4ED6;&#x7684;&#x53EF;&#x80FD;&#x8DD1;GC&#x5565;&#x7684;
&#x90A3;&#x5982;&#x679C;timerproc&#x8BA9;&#x51FA;&#x4E86;P, &#x5F88;&#x53EF;&#x80FD;&#x662F;&#x7ED9;sysmon&#x7528;.</li>
</ul>
<h2 id="&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;sysmon"><a name="&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;sysmon" class="anchor-navigation-ex-anchor" href="#&#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;sysmon"><i class="fa fa-link" aria-hidden="true"></i></a>15.9. &#x5BF9;&#x7167;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5206;&#x6790;:sysmon</h2>
<p><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083627.png" alt=""><br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083639.png" alt=""><br>sysmon&#x5728;<code>&lt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>go&#x539F;&#x7406;</span><span class="token punctuation">&gt;</span></span>&gt;</code>&#x4E2D;&#x6709;&#x6240;&#x8BF4;&#x660E;
&#x4ECE;&#x56FE;&#x4E0A;&#x770B;, &#x51E0;&#x6761;&#x8DEF;&#x5F84;&#x90FD;&#x4F1A;&#x8D70;&#x5230;&#x963B;&#x585E;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x6765;&#x4F11;&#x7720;.</p>
<h2 id="&#x7ED3;&#x8BBA;_1"><a name="&#x7ED3;&#x8BBA;_1" class="anchor-navigation-ex-anchor" href="#&#x7ED3;&#x8BBA;_1"><i class="fa fa-link" aria-hidden="true"></i></a>15.10. &#x7ED3;&#x8BBA;</h2>
<ul>
<li>&#x4ECE;handleOnu&#x7684;select&#x7B49;&#x5F85;&#x8DEF;&#x5F84;&#x548C;timerproc&#x4E2D;time.sendTime&#x5524;&#x9192;&#x8DEF;&#x5F84;&#x770B;<ul>
<li>goroutine&#x7684;&#x8C03;&#x5EA6;&#x5F00;&#x9500;&#x5F88;&#x5C0F;, &#x56E0;&#x4E3A;gopark, goready&#x7B49;&#x51FD;&#x6570;&#x90FD;&#x5728;&#x7528;&#x6237;&#x6001;&#x5C31;&#x5B8C;&#x6210;&#x4E86;goroutine&#x5207;&#x6362;</li>
<li>channel&#x7684;&#x5F00;&#x9500;&#x4E5F;&#x6BD4;&#x8F83;&#x5C0F;, &#x540C;&#x6837;&#x4E5F;&#x662F;&#x7528;&#x6237;&#x6001;. channel&#x7684;send&#x548C;receive&#x4F1A;&#x89E6;&#x53D1;goroutine&#x8C03;&#x5EA6;</li>
<li>M&#x7684;&#x5207;&#x6362;&#x548C;&#x8C03;&#x5EA6;&#x4F9D;&#x8D56;kernel&#x7684;&#x963B;&#x585E;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;, go&#x5728;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x524D;&#x540E;&#x90FD;&#x6709;&quot;&#x57CB;&#x4F0F;&quot;&#x51FD;&#x6570;, &#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x662F;&#x8C03;&#x5EA6;&#x5668;&#x7684;&#x5165;&#x53E3;&#x70B9;.</li>
</ul>
</li>
</ul>
<h1 id="&#x6253;&#x5370;&#x8C03;&#x7528;&#x6808;"><a name="&#x6253;&#x5370;&#x8C03;&#x7528;&#x6808;" class="anchor-navigation-ex-anchor" href="#&#x6253;&#x5370;&#x8C03;&#x7528;&#x6808;"><i class="fa fa-link" aria-hidden="true"></i></a>16. &#x6253;&#x5370;&#x8C03;&#x7528;&#x6808;</h1>
<h2 id="&#x4EE5;jsonload&#x4E3A;&#x4F8B;"><a name="&#x4EE5;jsonload&#x4E3A;&#x4F8B;" class="anchor-navigation-ex-anchor" href="#&#x4EE5;jsonload&#x4E3A;&#x4F8B;"><i class="fa fa-link" aria-hidden="true"></i></a>16.1. &#x4EE5;json_load&#x4E3A;&#x4F8B;</h2>
<p><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083706.png" alt="">  </p>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x8FD0;&#x884C;&#x540E;, &#x6709;6&#x4E2A;&#x7EBF;&#x7A0B;</span>
./json_load <span class="token parameter variable">-fileName</span> test.json <span class="token parameter variable">-loopNum</span> <span class="token number">10000</span> <span class="token operator">&gt;</span> /dev/null
<span class="token function">cat</span> /proc/17212/status
Threads: <span class="token number">6</span>
</code></pre>
<p><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083724.png" alt=""><br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083735.png" alt="">  </p>
<h2 id="pstack&#x6253;&#x5370;&#x4E0D;&#x4E86;go&#x7684;&#x8C03;&#x7528;&#x6808;"><a name="pstack&#x6253;&#x5370;&#x4E0D;&#x4E86;go&#x7684;&#x8C03;&#x7528;&#x6808;" class="anchor-navigation-ex-anchor" href="#pstack&#x6253;&#x5370;&#x4E0D;&#x4E86;go&#x7684;&#x8C03;&#x7528;&#x6808;"><i class="fa fa-link" aria-hidden="true"></i></a>16.2. pstack&#x6253;&#x5370;&#x4E0D;&#x4E86;go&#x7684;&#x8C03;&#x7528;&#x6808;</h2>
<p>&#x63D0;&#x793A;<code>could not find _DYNAMIC symbol</code>, &#x56E0;&#x4E3A;pstack&#x5E95;&#x5C42;&#x4F7F;&#x7528;gdb, &#x800C;gdb&#x5BF9;go&#x7684;&#x7406;&#x89E3;&#x4E0D;&#x597D;.</p>
<h2 id="&#x7528;-sigquit"><a name="&#x7528;-sigquit" class="anchor-navigation-ex-anchor" href="#&#x7528;-sigquit"><i class="fa fa-link" aria-hidden="true"></i></a>16.3. &#x7528;-SIGQUIT</h2>
<p>&#x5728;go&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x65F6;, &#x7528;<code>kill -SIGQUIT 17167</code>&#x7ED9;go&#x8FDB;&#x7A0B;&#x53D1;&#x4FE1;&#x53F7;, &#x4F1A;&#x5BFC;&#x81F4;go&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;, &#x8BE5;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;&#x65F6;&#x4F1A;&#x6253;&#x5370;&#x8C03;&#x7528;&#x6808;<br>&#x6216;&#x8005;&#x5728;&#x8FDB;&#x7A0B;&#x6267;&#x884C;&#x65F6;, &#x6309;<code>ctrl+\</code>&#x53D1;SIGQUIT&#x4FE1;&#x53F7;, &#x6548;&#x679C;&#x4E00;&#x6837;</p>
<h2 id="&#x6CE8;&#x518C;&#x4FE1;&#x53F7;handler"><a name="&#x6CE8;&#x518C;&#x4FE1;&#x53F7;handler" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x518C;&#x4FE1;&#x53F7;handler"><i class="fa fa-link" aria-hidden="true"></i></a>16.4. &#x6CE8;&#x518C;&#x4FE1;&#x53F7;handler</h2>
<p>&#x53C2;&#x8003;
<a href="https://www.jianshu.com/p/abbe6663b672" target="_blank">https://www.jianshu.com/p/abbe6663b672</a></p>
<h2 id="&#x7ED3;&#x679C;"><a name="&#x7ED3;&#x679C;" class="anchor-navigation-ex-anchor" href="#&#x7ED3;&#x679C;"><i class="fa fa-link" aria-hidden="true"></i></a>16.5. &#x7ED3;&#x679C;</h2>
<p>&#x663E;&#x793A;&#x53EA;&#x6709;2&#x4E2A;goroutine</p>
<h3 id="goroutine-0"><a name="goroutine-0" class="anchor-navigation-ex-anchor" href="#goroutine-0"><i class="fa fa-link" aria-hidden="true"></i></a>16.5.1. goroutine 0</h3>
<p><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083909.png" alt="">  </p>
<h3 id="goroutine-1"><a name="goroutine-1" class="anchor-navigation-ex-anchor" href="#goroutine-1"><i class="fa fa-link" aria-hidden="true"></i></a>16.5.2. goroutine 1</h3>
<p><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083923.png" alt=""><br>&#x4E2D;&#x95F4;&#x5F88;&#x957F;, &#x8FD9;&#x4E2A;&#x662F;&#x4E2A;&#x591A;&#x5C42;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x5D4C;&#x5957;&#x7684;&#x8FC7;&#x7A0B;, &#x56E0;&#x4E3A;&#x8F93;&#x5165;test.json&#x91CC;&#x9762;&#x6709;&#x591A;&#x5C42;&#x5D4C;&#x5957;<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914083937.png" alt="">  </p>
<h3 id="&#x7528;taskset--c-1&#x5F3A;&#x5236;&#x4E00;&#x4E2A;&#x6838;&#x8DD1;"><a name="&#x7528;taskset--c-1&#x5F3A;&#x5236;&#x4E00;&#x4E2A;&#x6838;&#x8DD1;" class="anchor-navigation-ex-anchor" href="#&#x7528;taskset--c-1&#x5F3A;&#x5236;&#x4E00;&#x4E2A;&#x6838;&#x8DD1;"><i class="fa fa-link" aria-hidden="true"></i></a>16.5.3. &#x7528;taskset -c 1&#x5F3A;&#x5236;&#x4E00;&#x4E2A;&#x6838;&#x8DD1;</h3>
<p>&#x8FD8;&#x662F;2&#x4E2A;goroutine</p>
<h2 id="&#x5982;&#x679C;&#x53EA;&#x6709;&#x4E24;&#x4E2A;goroutine-&#x4F46;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8D77;6&#x4E2A;&#x7EBF;&#x7A0B;&#x5462;"><a name="&#x5982;&#x679C;&#x53EA;&#x6709;&#x4E24;&#x4E2A;goroutine-&#x4F46;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8D77;6&#x4E2A;&#x7EBF;&#x7A0B;&#x5462;" class="anchor-navigation-ex-anchor" href="#&#x5982;&#x679C;&#x53EA;&#x6709;&#x4E24;&#x4E2A;goroutine-&#x4F46;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8D77;6&#x4E2A;&#x7EBF;&#x7A0B;&#x5462;"><i class="fa fa-link" aria-hidden="true"></i></a>16.6. &#x5982;&#x679C;&#x53EA;&#x6709;&#x4E24;&#x4E2A;goroutine, &#x4F46;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8D77;6&#x4E2A;&#x7EBF;&#x7A0B;&#x5462;?</h2>
<p>&#x5B9E;&#x9645;&#x4E0A;, goroutine&#x4E0D;&#x6B62;2&#x4E2A;. &#x52A0;<code>GOTRACEBACK=system</code>&#x73AF;&#x5883;&#x53D8;&#x91CF;, &#x80FD;&#x770B;&#x5230;&#x7CFB;&#x7EDF;&#x7EA7;&#x7684;goroutine
<code>GOTRACEBACK=system ./json_load -fileName test.json -loopNum 100000 &gt; /dev/null</code>
&#x7136;&#x540E;&#x6309;<code>ctrl+\</code>, &#x5F97;&#x5230;&#x8C03;&#x7528;&#x6808;
&#x5168;&#x90E8;goroutine&#x5982;&#x4E0B;:</p>
<pre class="language-"><code class="lang-go">goroutine <span class="token number">0</span> <span class="token punctuation">[</span>idle<span class="token punctuation">]</span><span class="token punctuation">:</span>
<span class="token comment">//&#x7528;&#x6237;goroutine</span>
goroutine <span class="token number">1</span> <span class="token punctuation">[</span>runnable<span class="token punctuation">]</span><span class="token punctuation">:</span>
<span class="token comment">//&#x4EE5;&#x4E0B;&#x662F;system&#x7EA7;&#x522B;&#x7684;</span>
goroutine <span class="token number">2</span> <span class="token punctuation">[</span>force gc <span class="token punctuation">(</span>idle<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
goroutine <span class="token number">3</span> <span class="token punctuation">[</span>GC sweep wait<span class="token punctuation">]</span><span class="token punctuation">:</span>
goroutine <span class="token number">4</span> <span class="token punctuation">[</span>finalizer wait<span class="token punctuation">]</span><span class="token punctuation">:</span>
goroutine <span class="token number">5</span> <span class="token punctuation">[</span>GC worker <span class="token punctuation">(</span>idle<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
goroutine <span class="token number">17</span> <span class="token punctuation">[</span>GC worker <span class="token punctuation">(</span>idle<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
goroutine <span class="token number">18</span> <span class="token punctuation">[</span>GC worker <span class="token punctuation">(</span>idle<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
goroutine <span class="token number">19</span> <span class="token punctuation">[</span>GC worker <span class="token punctuation">(</span>idle<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
</code></pre>
<p>&#x7528;
<code>GODEBUG=schedtrace=10000,scheddetail=1</code>&#x53EF;&#x4EE5;10s&#x6253;&#x5370;&#x4E00;&#x6B21;&#x8C03;&#x5EA6;&#x4FE1;&#x606F;</p>
<ul>
<li>P: &#x4EE3;&#x8868;CPU</li>
<li>M: &#x4EE3;&#x8868;OS&#x7EBF;&#x7A0B;</li>
<li>G: &#x4EE3;&#x8868;goroutine<br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914084014.png" alt=""><br><img src="img/golang_&#x8C03;&#x8BD5;&#x8BB0;&#x5F55;_20220914084026.png" alt="">  </li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="as_title_golang6.html" class="navigation navigation-prev " aria-label="Previous page: 调试和性能">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="golang_topid性能优化.html" class="navigation navigation-next " aria-label="Next page: Golang topid性能优化">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Golang 调试记录","level":"1.10.12.1","depth":3,"next":{"title":"Golang topid性能优化","level":"1.10.12.2","depth":3,"path":"notes/golang_topid性能优化.md","ref":"notes/golang_topid性能优化.md","articles":[]},"previous":{"title":"调试和性能","level":"1.10.12","depth":2,"path":"notes/as_title_golang6.md","ref":"notes/as_title_golang6.md","articles":[{"title":"Golang 调试记录","level":"1.10.12.1","depth":3,"path":"notes/golang_调试记录.md","ref":"notes/golang_调试记录.md","articles":[]},{"title":"Golang topid性能优化","level":"1.10.12.2","depth":3,"path":"notes/golang_topid性能优化.md","ref":"notes/golang_topid性能优化.md","articles":[]},{"title":"Golang gshell性能调试","level":"1.10.12.3","depth":3,"path":"notes/golang_gshell性能调试.md","ref":"notes/golang_gshell性能调试.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["-livereload","-sharing","-lunr","-search","search-plus","-highlight","theme-comscore","prism","code","chapter-fold","github","splitter","wide-page","hide-navigation-buttons","anchor-navigation-ex","sequence","mermaid-gb3"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"chapter-fold":{},"prism":{"css":["prismjs/themes/prism.css"],"ignore":["mermaid","sequence"]},"sequence":{"theme":"simple"},"github":{"url":"https://github.com/Bai-Yingjie/Bai-Yingjie.github.io"},"splitter":{},"wide-page":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"hide-navigation-buttons":{},"mermaid-gb3":{},"anchor-navigation-ex":{"mode":"float","pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"isRewritePageTitle":true,"showLevel":true,"tocLevel1Icon":"fa fa-hand-o-right","tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right","showGoTop":true,"isShowTocTitleIcon":true,"printLog":false,"multipleH1":true,"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false}},"theme-comscore":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"search-plus":{}},"theme":"default","author":"Bai Yingjie","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"My Notes","language":"zh-hans","gitbook":"*"},"file":{"path":"notes/golang_调试记录.md","mtime":"2022-10-19T03:46:48.835Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-10-19T03:48:03.199Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-mermaid-gb3/book/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    <script src="../gitbook/gitbook-plugin-mermaid-gb3/mermaid/mermaid.min.js"></script>

    </body>
</html>

