
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>OVS架构和代码 · My Notes</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Bai Yingjie">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-wide-page/wide.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hide-navigation-buttons/index.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="OVS_DPDK_performance_HXT_ARM_server.html" />
    
    
    <link rel="prev" href="OVS_DPDK_编译运行.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">开源</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="my_opensource.html">
            
                <a href="my_opensource.html">
            
                    
                    我的开源项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="my_upstream.html">
            
                <a href="my_upstream.html">
            
                    
                    我的upstream commit
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">系统分析和性能</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="system_analysis_bcc和ebpf.html">
            
                <a href="system_analysis_bcc和ebpf.html">
            
                    
                    bcc和ebpf(starting)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="performance_ovs进程调查.html">
            
                <a href="performance_ovs进程调查.html">
            
                    
                    OVS进程调查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="performance_ping流程和函数调用解析.html">
            
                <a href="performance_ping流程和函数调用解析.html">
            
                    
                    ping流程和函数调用解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="CentOS_系统性能优化配置.html">
            
                <a href="CentOS_系统性能优化配置.html">
            
                    
                    CentOS 性能优化系统配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    cloud和容器相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.5.1" data-path="cloud_杂记.html">
            
                <a href="cloud_杂记.html">
            
                    
                    云杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5.2" data-path="container_当代容器读书笔记.html">
            
                <a href="container_当代容器读书笔记.html">
            
                    
                    当代容器读书笔记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    CPU和device虚拟化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.1" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    gvisor
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.1.1" data-path="golang_gvisor代码_KVM.html">
            
                <a href="golang_gvisor代码_KVM.html">
            
                    
                    gvisor KVM模式代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.1.2" data-path="golang_gvisor调试.html">
            
                <a href="golang_gvisor调试.html">
            
                    
                    gvisor调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.1.3" data-path="golang_gvisor_ptrace.html">
            
                <a href="golang_gvisor_ptrace.html">
            
                    
                    gvisor ptrace模式介绍(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.6.2" data-path="rust_vmm_brief.html">
            
                <a href="rust_vmm_brief.html">
            
                    
                    rust VMM(virtual machine monitor)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.2.1" data-path="rust_vmm_简介.html">
            
                <a href="rust_vmm_简介.html">
            
                    
                    rust-vmm简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.2.2" data-path="rust_firecracker_代码.html">
            
                <a href="rust_firecracker_代码.html">
            
                    
                    firecracker代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.2.3" data-path="rust_firecracker_使用.html">
            
                <a href="rust_firecracker_使用.html">
            
                    
                    firecracker使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.2.4" data-path="rust_cloud-hypervisor_代码.html">
            
                <a href="rust_cloud-hypervisor_代码.html">
            
                    
                    cloud hypervisor代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.2.5" data-path="rust_cloud-hypervisor_使用.html">
            
                <a href="rust_cloud-hypervisor_使用.html">
            
                    
                    cloud hypervisor使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.2.6" data-path="rust_cloud-hypervisor_问题与解决.html">
            
                <a href="rust_cloud-hypervisor_问题与解决.html">
            
                    
                    cloud hypervisor问题与解决
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.6.3" data-path="virtualization_virtio规范阅读笔记.html">
            
                <a href="virtualization_virtio规范阅读笔记.html">
            
                    
                    virtio规范阅读笔记.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.4" data-path="qemu_ovs_虚拟化环境.html">
            
                <a href="qemu_ovs_虚拟化环境.html">
            
                    
                    qemu OVS 虚拟化环境准备
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.5" data-path="qemu使用.html">
            
                <a href="qemu使用.html">
            
                    
                    Qemu使用(old)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    计算机网络相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.7.1" data-path="networking_杂记1.html">
            
                <a href="networking_杂记1.html">
            
                    
                    networking杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7.2" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Qemu OVS和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.7.2.1" data-path="OVS_DPDK_编译运行.html">
            
                <a href="OVS_DPDK_编译运行.html">
            
                    
                    OVS-DPDK编译运行
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.7.2.2" data-path="OVS_架构和代码.html">
            
                <a href="OVS_架构和代码.html">
            
                    
                    OVS架构和代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7.2.3" data-path="OVS_DPDK_performance_HXT_ARM_server.html">
            
                <a href="OVS_DPDK_performance_HXT_ARM_server.html">
            
                    
                    OVS-DPDK for ARM server 性能测试环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7.2.4" data-path="DPDK_Mellanox.html">
            
                <a href="DPDK_Mellanox.html">
            
                    
                    DPDK Mellanox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7.2.5" data-path="OVS_phy-vm-phy.html">
            
                <a href="OVS_phy-vm-phy.html">
            
                    
                    OVS PHY-VM-PHY
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7.2.6" data-path="networking_网络虚拟化用例记录.html">
            
                <a href="networking_网络虚拟化用例记录.html">
            
                    
                    网络虚拟化用例记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7.2.7" data-path="networking_网络虚拟化操作记录.html">
            
                <a href="networking_网络虚拟化操作记录.html">
            
                    
                    网络虚拟化操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.7.3" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    虚拟化网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.7.3.1" data-path="networking_tc_filter_连接veth和tap.html">
            
                <a href="networking_tc_filter_连接veth和tap.html">
            
                    
                    Connecting a veth device to tap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7.3.2" data-path="networking_multicast_vxlan_flannel.html">
            
                <a href="networking_multicast_vxlan_flannel.html">
            
                    
                    multicast vxlan和flannel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7.3.3" data-path="networking_virtio网络介绍.html">
            
                <a href="networking_virtio网络介绍.html">
            
                    
                    virtio网络介绍(网摘): vhost-net virtio-net vhost-user SRIOV
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7.3.4" data-path="networking_virtualization_杂记.html">
            
                <a href="networking_virtualization_杂记.html">
            
                    
                    虚拟化网络杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7.3.5" data-path="networking_linux虚拟网络接口.html">
            
                <a href="networking_linux虚拟网络接口.html">
            
                    
                    linux虚拟网络接口(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    ARM server
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.8.1" data-path="arm_server_杂记.html">
            
                <a href="arm_server_杂记.html">
            
                    
                    Arm server 杂记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    嵌入式系统开发调试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.9.1" data-path="embedded_debugging.html">
            
                <a href="embedded_debugging.html">
            
                    
                    嵌入式调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.9.2" data-path="uboot_杂记.html">
            
                <a href="uboot_杂记.html">
            
                    
                    uboot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.9.3" data-path="buildroot_杂记.html">
            
                <a href="buildroot_杂记.html">
            
                    
                    buildroot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.9.4" data-path="toolchain_升级gcc问题解决.html">
            
                <a href="toolchain_升级gcc问题解决.html">
            
                    
                    升级GCC7.3问题解决
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.10" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Linux工程实践
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.10.1" data-path="linux_日常使用.html">
            
                <a href="linux_日常使用.html">
            
                    
                    日常linux使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.2" data-path="git_日常使用.html">
            
                <a href="git_日常使用.html">
            
                    
                    日常git使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.3" data-path="向kernel提交补丁.html">
            
                <a href="向kernel提交补丁.html">
            
                    
                    向kernel提交补丁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.4" data-path="linux_ssh_relay.html">
            
                <a href="linux_ssh_relay.html">
            
                    
                    ssh relay
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.5" data-path="gitlab_ci.html">
            
                <a href="gitlab_ci.html">
            
                    
                    gitlab CI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.6" data-path="docker_操作记录.html">
            
                <a href="docker_操作记录.html">
            
                    
                    docker操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.7" data-path="centos_操作记录.html">
            
                <a href="centos_操作记录.html">
            
                    
                    centos操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.11" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Golang
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.11.1" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    入门
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.11.1.1" data-path="golang_语法基础.html">
            
                <a href="golang_语法基础.html">
            
                    
                    Golang 语法基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.1.2" data-path="golang_json性能.html">
            
                <a href="golang_json性能.html">
            
                    
                    Golang json性能比较
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.11.2" data-path="golang_原理.html">
            
                <a href="golang_原理.html">
            
                    
                    Golang 原理相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.11.2.1" data-path="golang_interface原理.html">
            
                <a href="golang_interface原理.html">
            
                    
                    Golang interface原理(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.2.2" data-path="golang_内存分配.html">
            
                <a href="golang_内存分配.html">
            
                    
                    Golang 内存分配(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.11.3" data-path="golang_标准库.html">
            
                <a href="golang_标准库.html">
            
                    
                    Golang 标准库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.4" data-path="golang_我的反射代码.html">
            
                <a href="golang_我的反射代码.html">
            
                    
                    Golang 我的反射代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.5" data-path="golang_问答.html">
            
                <a href="golang_问答.html">
            
                    
                    Golang 问答
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.6" data-path="golang_高效go.html">
            
                <a href="golang_高效go.html">
            
                    
                    Golang 高效go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.7" data-path="golang_进阶.html">
            
                <a href="golang_进阶.html">
            
                    
                    Golang 进阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.8" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Golang 杂记
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.11.8.1" data-path="golang_杂记1.html">
            
                <a href="golang_杂记1.html">
            
                    
                    Golang 杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.8.2" data-path="golang_杂记2.html">
            
                <a href="golang_杂记2.html">
            
                    
                    Golang 杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.8.3" data-path="golang_杂记3.html">
            
                <a href="golang_杂记3.html">
            
                    
                    Golang 杂记3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.8.4" data-path="golang_lib选型.html">
            
                <a href="golang_lib选型.html">
            
                    
                    Golang lib选型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.8.5" data-path="golang_mod_proxy.html">
            
                <a href="golang_mod_proxy.html">
            
                    
                    go mod和go proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.8.6" data-path="golang_汇编_arm64.html">
            
                <a href="golang_汇编_arm64.html">
            
                    
                    Golang 汇编语法和arm64小知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.8.7" data-path="golang_cgo_swig.html">
            
                <a href="golang_cgo_swig.html">
            
                    
                    go调用c可以用swig
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.11.9" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Golang 环境和工具链生成
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.11.9.1" data-path="golang_toolchain_ppc.html">
            
                <a href="golang_toolchain_ppc.html">
            
                    
                    go tools增加ppc32支持.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.9.2" data-path="golang_toolchain_compile_gccgo.html">
            
                <a href="golang_toolchain_compile_gccgo.html">
            
                    
                    编译gccgo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.9.3" data-path="golang_go_on_mips.html">
            
                <a href="golang_go_on_mips.html">
            
                    
                    go on mips boards(not so updated)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.11.9.3.1" data-path="golang_go_on_mips_part1.html">
            
                <a href="golang_go_on_mips_part1.html">
            
                    
                    part 1: cross compile go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.9.3.2" data-path="golang_go_on_mips_part2.html">
            
                <a href="golang_go_on_mips_part2.html">
            
                    
                    part 2: build native go compiler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.9.3.3" data-path="golang_go_on_mips_part3.html">
            
                <a href="golang_go_on_mips_part3.html">
            
                    
                    part 3: gccgo experiments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.9.3.4" data-path="golang_go_on_mips_part4.html">
            
                <a href="golang_go_on_mips_part4.html">
            
                    
                    part 4: Golang json performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.9.3.5" data-path="golang_gentoo_on_mips_board_and_build_go.html">
            
                <a href="golang_gentoo_on_mips_board_and_build_go.html">
            
                    
                    Gentoo on mips board and build go
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.11.10" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    微服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.11.10.1" data-path="golang_micro.html">
            
                <a href="golang_micro.html">
            
                    
                    go-micro和micro
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.10.2" data-path="golang_微服务概念.html">
            
                <a href="golang_微服务概念.html">
            
                    
                    微服务概念
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.11.11" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    解释器和编解码
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.11.11.1" data-path="golang_yeagi.html">
            
                <a href="golang_yeagi.html">
            
                    
                    解释器yeagi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.11.2" data-path="golang_tengo.html">
            
                <a href="golang_tengo.html">
            
                    
                    解释器tengo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.11.3" data-path="golang_govaluate.html">
            
                <a href="golang_govaluate.html">
            
                    
                    解释器govaluate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.11.4" data-path="golang_encoding_gotiny.html">
            
                <a href="golang_encoding_gotiny.html">
            
                    
                    gotiny编解码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.11.5" data-path="golang_abs.html">
            
                <a href="golang_abs.html">
            
                    
                    解释器abs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.11.12" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    调试和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.11.12.1" data-path="golang_调试记录.html">
            
                <a href="golang_调试记录.html">
            
                    
                    Golang 调试记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.12.2" data-path="golang_topid性能优化.html">
            
                <a href="golang_topid性能优化.html">
            
                    
                    Golang topid性能优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.12.3" data-path="golang_gshell性能调试.html">
            
                <a href="golang_gshell性能调试.html">
            
                    
                    Golang gshell性能调试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.11.13" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    网络和消息中间件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.11.13.1" data-path="golang_zmq.html">
            
                <a href="golang_zmq.html">
            
                    
                    消息中间件基本概念和zero mq
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.13.2" data-path="golang_mango.html">
            
                <a href="golang_mango.html">
            
                    
                    消息中间件mango
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.13.3" data-path="golang_libp2p.html">
            
                <a href="golang_libp2p.html">
            
                    
                    Golang p2p网络
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.12" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Rust
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.12.1" data-path="rust_入门_brief.html">
            
                <a href="rust_入门_brief.html">
            
                    
                    Rust 入门系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.12.1.1" data-path="rust_books.html">
            
                <a href="rust_books.html">
            
                    
                    Rust reference books
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.1.2" data-path="rust_入门1.html">
            
                <a href="rust_入门1.html">
            
                    
                    Rust 安装和基础语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.1.3" data-path="rust_入门2.html">
            
                <a href="rust_入门2.html">
            
                    
                    Rust 泛型和内存所有权
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.1.4" data-path="rust_入门3.html">
            
                <a href="rust_入门3.html">
            
                    
                    Rust 闭包 容器 迭代器 生成器 线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.1.5" data-path="rust_工程构建.html">
            
                <a href="rust_工程构建.html">
            
                    
                    Rust 工程构建
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.12.2" data-path="rust_coding_brief.html">
            
                <a href="rust_coding_brief.html">
            
                    
                    Rust 代码积累
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.12.2.1" data-path="rust_序列化.html">
            
                <a href="rust_序列化.html">
            
                    
                    Rust 序列化原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.2.2" data-path="rust_知识点积累.html">
            
                <a href="rust_知识点积累.html">
            
                    
                    Rust 知识点更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.2.3" data-path="rust_adaptiveservice.html">
            
                <a href="rust_adaptiveservice.html">
            
                    
                    rust版本的adaptiveservice探索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.2.4" data-path="rust_常用设施.html">
            
                <a href="rust_常用设施.html">
            
                    
                    Rust 常用设施
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.2.5" data-path="rust_代码小段.html">
            
                <a href="rust_代码小段.html">
            
                    
                    Rust 代码小段
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.12.3" data-path="others.html">
            
                <a href="others.html">
            
                    
                    其他
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.12.3.1" data-path="rust_mdbook_使用.html">
            
                <a href="rust_mdbook_使用.html">
            
                    
                    Rust 使用mdbook
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.13" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    脚本
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.13.1" data-path="shell_变量.html">
            
                <a href="shell_变量.html">
            
                    
                    shell变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.2" data-path="shell_基础篇.html">
            
                <a href="shell_基础篇.html">
            
                    
                    shell命令和脚本记录-基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.3" data-path="shell_高级篇.html">
            
                <a href="shell_高级篇.html">
            
                    
                    shell命令和脚本记录-高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.4" data-path="shell_脚本片段.html">
            
                <a href="shell_脚本片段.html">
            
                    
                    shell脚本片段
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.5" data-path="python_记录.html">
            
                <a href="python_记录.html">
            
                    
                    python记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.6" data-path="lua_记录.html">
            
                <a href="lua_记录.html">
            
                    
                    lua记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.7" data-path="shell_rds脚本阅读.html">
            
                <a href="shell_rds脚本阅读.html">
            
                    
                    RDS脚本阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.8" data-path="Project_Euler.html">
            
                <a href="Project_Euler.html">
            
                    
                    Project Euler
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.14" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    C和Operating System
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.14.1" data-path="system_libc_part1.html">
            
                <a href="system_libc_part1.html">
            
                    
                    libc概览1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14.2" data-path="system_libc_part2.html">
            
                <a href="system_libc_part2.html">
            
                    
                    libc概览2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14.3" data-path="system_libc_part3.html">
            
                <a href="system_libc_part3.html">
            
                    
                    libc概览3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14.4" data-path="system_原理杂记.html">
            
                <a href="system_原理杂记.html">
            
                    
                    系统原理杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14.5" data-path="system_alpine.html">
            
                <a href="system_alpine.html">
            
                    
                    Alpine Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14.6" data-path="system_进程间通信.html">
            
                <a href="system_进程间通信.html">
            
                    
                    进程间通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14.7" data-path="system_特殊功能fd.html">
            
                <a href="system_特殊功能fd.html">
            
                    
                    eventfd timerfd signalfd和fd共享
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14.8" data-path="c_automake_autoconf.html">
            
                <a href="c_automake_autoconf.html">
            
                    
                    automake autoconf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14.9" data-path="makefile_原理和实践.html">
            
                <a href="makefile_原理和实践.html">
            
                    
                    makefile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14.10" data-path="c_编程杂记高级篇.html">
            
                <a href="c_编程杂记高级篇.html">
            
                    
                    C编程杂记高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14.11" data-path="c_编程杂记基础篇.html">
            
                <a href="c_编程杂记基础篇.html">
            
                    
                    C编程杂记基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14.12" data-path="c_networking_socket高阶用法.html">
            
                <a href="c_networking_socket高阶用法.html">
            
                    
                    网络编程: Advanced Socket Topics(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14.13" data-path="c_protobuf介绍.html">
            
                <a href="c_protobuf介绍.html">
            
                    
                    序列化: protobuf介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14.14" data-path="c_进程间通信_共享文件和共享内存.html">
            
                <a href="c_进程间通信_共享文件和共享内存.html">
            
                    
                    进程间通信: 共享文件和共享内存(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14.15" data-path="c_pthread_condition和mutex.html">
            
                <a href="c_pthread_condition和mutex.html">
            
                    
                    并发 任务 事件 和锁.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14.16" data-path="kernel_user_space_howto.html">
            
                <a href="kernel_user_space_howto.html">
            
                    
                    kernel space和user space交互(网摘, linux2.6)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.15" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    内核 设备和驱动相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.15.1" data-path="platform_device_driver.html">
            
                <a href="platform_device_driver.html">
            
                    
                    平台驱动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.2" data-path="driver_驱动中使用工作队列轮询.html">
            
                <a href="driver_驱动中使用工作队列轮询.html">
            
                    
                    驱动中使用工作队列轮询
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.3" data-path="device_driver_杂记.html">
            
                <a href="device_driver_杂记.html">
            
                    
                    驱动调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.4" data-path="device_driver_原理相关.html">
            
                <a href="device_driver_原理相关.html">
            
                    
                    kernel和驱动原理相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.5" data-path="device_localbus_16bit读写.html">
            
                <a href="device_localbus_16bit读写.html">
            
                    
                    CPLD做8bit到16bit转换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.6" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    nand
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.15.6.1" data-path="device_driver_octeon_nand.html">
            
                <a href="device_driver_octeon_nand.html">
            
                    
                    octeon nand flash驱动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.6.2" data-path="device_driver_nand概率写失败问题分析.html">
            
                <a href="device_driver_nand概率写失败问题分析.html">
            
                    
                    Nand flash概率写失败问题分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.15.7" data-path="octeon_remote_pci.html">
            
                <a href="octeon_remote_pci.html">
            
                    
                    octeon remote-pci.c阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.8" data-path="Device_VFIO_notes.html">
            
                <a href="Device_VFIO_notes.html">
            
                    
                    VFIO简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.9" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    智能网卡和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.15.9.1" data-path="smartNIC_智能网卡对比.html">
            
                <a href="smartNIC_智能网卡对比.html">
            
                    
                    智能网卡对比
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.9.2" data-path="octeon_pci_NIC.html">
            
                <a href="octeon_pci_NIC.html">
            
                    
                    octeon PCI NIC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.9.3" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    octeon liquidIO
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.15.9.3.1" data-path="smartNIC_liquidIO_代码阅读app篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读app篇.html">
            
                    
                    PCI-NIC 代码阅读 --app篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.9.3.2" data-path="smartNIC_liquidIO_代码阅读api篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读api篇.html">
            
                    
                    PCI-NIC 代码阅读 --api篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.9.3.3" data-path="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇之结构体
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.9.3.4" data-path="smartNIC_liquidIO_代码阅读driver篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.9.3.5" data-path="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                    
                    PCI-NIC 代码阅读 --真NIC篇
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.15.9.4" data-path="networking_dpdk使用_2014.html">
            
                <a href="networking_dpdk使用_2014.html">
            
                    
                    DPDK使用(2014)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.15.10" data-path="device_nvme要点介绍.html">
            
                <a href="device_nvme要点介绍.html">
            
                    
                    nvme要点介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.16" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    CPU Arch相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.16.1" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    ARM64
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.16.1.1" data-path="CPU_ARM64_thunder_overview.html">
            
                <a href="CPU_ARM64_thunder_overview.html">
            
                    
                    thunder 概览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.1.2" data-path="CPU_ARM64_thunder_开发板操作记录.html">
            
                <a href="CPU_ARM64_thunder_开发板操作记录.html">
            
                    
                    thunder 开发板操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.1.3" data-path="CPU_ARM64_thunder_bdk.html">
            
                <a href="CPU_ARM64_thunder_bdk.html">
            
                    
                    thunder BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.1.4" data-path="CPU_ARM64_thunder_efi_rtc.html">
            
                <a href="CPU_ARM64_thunder_efi_rtc.html">
            
                    
                    thunder RTC时间和efi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.1.5" data-path="CPU_ARM64_thunder_uefi_fdt.html">
            
                <a href="CPU_ARM64_thunder_uefi_fdt.html">
            
                    
                    thunder uefi和fdt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.1.6" data-path="CPU_ARM64_thunder_atf.html">
            
                <a href="CPU_ARM64_thunder_atf.html">
            
                    
                    thunder atf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.1.7" data-path="CPU_ARM64_thunder_kernel_boot.html">
            
                <a href="CPU_ARM64_thunder_kernel_boot.html">
            
                    
                    thunder kernel启动打印流程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.16.2" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    PPC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.16.2.1" data-path="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                <a href="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                    
                    PPC启动多核linux: 流程和内存映射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.2.2" data-path="CPU_PPC_kernel升级记录.html">
            
                <a href="CPU_PPC_kernel升级记录.html">
            
                    
                    PPC kernel升级记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.16.3" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    MIPS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.16.3.1" data-path="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                <a href="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                    
                    octeon 地址空间和寄存器访问
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.3.2" data-path="CPU_MIPS_octeon操作记录.html">
            
                <a href="CPU_MIPS_octeon操作记录.html">
            
                    
                    octeon 操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.3.3" data-path="CPU_MIPS_octeon_包处理性能.html">
            
                <a href="CPU_MIPS_octeon_包处理性能.html">
            
                    
                    octeon 系列处理器包处理性能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.3.4" data-path="CPU_MIPS_octeon_ddr调试记录.html">
            
                <a href="CPU_MIPS_octeon_ddr调试记录.html">
            
                    
                    octeon DDR调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.3.5" data-path="CPU_MIPS_octeon_BDK.html">
            
                <a href="CPU_MIPS_octeon_BDK.html">
            
                    
                    octeon CN78xx BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.3.6" data-path="kernel_增加ECC中断.html">
            
                <a href="kernel_增加ECC中断.html">
            
                    
                    octeon 增加ECC中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.3.7" data-path="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                <a href="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                    
                    octeon hw-ddr2代码走读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.3.8" data-path="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                <a href="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                    
                    octeon reboot调试和DDR中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.3.9" data-path="CPU_MIPS_octeon中断.html">
            
                <a href="CPU_MIPS_octeon中断.html">
            
                    
                    octeon 中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.3.10" data-path="CPU_MIPS_octeon原子操作.html">
            
                <a href="CPU_MIPS_octeon原子操作.html">
            
                    
                    octeon 原子操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16.3.11" data-path="CPU_MIPS_octeon网口代码分析.html">
            
                <a href="CPU_MIPS_octeon网口代码分析.html">
            
                    
                    octeon 网口代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >OVS架构和代码</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#vhost-user&#x534F;&#x8BAE;"><b>1. </b>vhost-user&#x534F;&#x8BAE;</a></li><li><span class="title-icon "></span><a href="#kvm&#x7684;irqfd&#x548C;ioeventfd"><b>2. </b>KVM&#x7684;irqfd&#x548C;ioeventfd</a></li><ul><li><span class="title-icon "></span><a href="#irqfd"><b>2.1. </b>irqfd</a></li><li><span class="title-icon "></span><a href="#ioeventfd"><b>2.2. </b>ioeventfd</a></li></ul><li><span class="title-icon "></span><a href="#eventfd&#x5728;ovs&#x7684;&#x4F7F;&#x7528;"><b>3. </b>eventfd&#x5728;ovs&#x7684;&#x4F7F;&#x7528;</a></li><ul><li><span class="title-icon "></span><a href="#qemu&#x7684;&#x901A;&#x77E5;&#x673A;&#x5236;"><b>3.1. </b>qemu&#x7684;&#x901A;&#x77E5;&#x673A;&#x5236;</a></li><li><span class="title-icon "></span><a href="#qemu&#x91CC;&#x7684;eventfd"><b>3.2. </b>qemu&#x91CC;&#x7684;eventfd</a></li><li><span class="title-icon "></span><a href="#eventfd&#x7531;qemu&#x901A;&#x8FC7;msg&#x4F20;&#x9012;&#x5230;ovs-dpdk"><b>3.3. </b>eventfd&#x7531;qemu&#x901A;&#x8FC7;msg&#x4F20;&#x9012;&#x5230;ovs-dpdk</a></li><li><span class="title-icon "></span><a href="#&#x5728;dpdk&#x7684;vhost&#x9A71;&#x52A8;&#x4E2D;-&#x5199;eventfd"><b>3.4. </b>&#x5728;dpdk&#x7684;vhost&#x9A71;&#x52A8;&#x4E2D;, &#x5199;eventfd</a></li><li><span class="title-icon "></span><a href="#&#x8865;&#x5145;-&#x901A;&#x8FC7;unix-socket&#x6765;&#x4F20;&#x9012;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;"><b>3.5. </b>&#x8865;&#x5145;: &#x901A;&#x8FC7;unix socket&#x6765;&#x4F20;&#x9012;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5173;&#x4E8E;ovs&#x6D41;&#x5339;&#x914D;"><b>4. </b>&#x5173;&#x4E8E;OVS&#x6D41;&#x5339;&#x914D;</a></li><li><span class="title-icon "></span><a href="#smc-enable-signature-match-cache"><b>5. </b>smc-enable: signature match cache</a></li><li><span class="title-icon "></span><a href="#vhost&#x534F;&#x8BAE;"><b>6. </b>vhost&#x534F;&#x8BAE;</a></li><ul><li><span class="title-icon "></span><a href="#vhost&#x67B6;&#x6784;"><b>6.1. </b>vhost&#x67B6;&#x6784;</a></li><li><span class="title-icon "></span><a href="#&#x8865;&#x5145;"><b>6.2. </b>&#x8865;&#x5145;</a></li></ul><li><span class="title-icon "></span><a href="#ovs-dpdk&#x5173;&#x952E;&#x8DEF;&#x5F84;"><b>7. </b>OVS-DPDK&#x5173;&#x952E;&#x8DEF;&#x5F84;</a></li><ul><li><span class="title-icon "></span><a href="#dpdkp0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;"><b>7.1. </b>dpdkp0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;</a></li><li><span class="title-icon "></span><a href="#vhostuser0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;"><b>7.2. </b>vhostuser0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;</a></li></ul><li><span class="title-icon "></span><a href="#buffer&#x5230;&#x5E95;&#x591A;&#x5927;"><b>8. </b>buffer&#x5230;&#x5E95;&#x591A;&#x5927;</a></li><li><span class="title-icon "></span><a href="#datapath"><b>9. </b>datapath</a></li><ul><li><span class="title-icon "></span><a href="#kernel-datapath"><b>9.1. </b>kernel datapath</a></li><li><span class="title-icon "></span><a href="#userspace-datapath"><b>9.2. </b>userspace datapath</a></li><li><span class="title-icon "></span><a href="#architecure"><b>9.3. </b>Architecure</a></li></ul><li><span class="title-icon "></span><a href="#vport&#x7C7B;&#x578B;"><b>10. </b>vport&#x7C7B;&#x578B;</a></li><ul><li><span class="title-icon "></span><a href="#netdev"><b>10.1. </b>netdev</a></li><li><span class="title-icon "></span><a href="#internal"><b>10.2. </b>internal</a></li><li><span class="title-icon "></span><a href="#patch"><b>10.3. </b>patch</a></li><li><span class="title-icon "></span><a href="#tunnel-vports-vxlan-gre-etc"><b>10.4. </b>tunnel vports: vxlan, gre, etc</a></li></ul><li><span class="title-icon "></span><a href="#&#x7528;&#x6237;&#x6001;&#x901A;&#x8FC7;&#x7269;&#x7406;&#x53E3;&#x53D1;&#x5305;&#x6D41;&#x7A0B;"><b>11. </b>&#x7528;&#x6237;&#x6001;&#x901A;&#x8FC7;&#x7269;&#x7406;&#x53E3;&#x53D1;&#x5305;&#x6D41;&#x7A0B;</a></li><ul><li><span class="title-icon "></span><a href="#&#x4F7F;&#x7528;perf&#x6293;&#x5173;&#x952E;&#x8DEF;&#x5F84;"><b>11.1. </b>&#x4F7F;&#x7528;perf&#x6293;&#x5173;&#x952E;&#x8DEF;&#x5F84;</a></li><li><span class="title-icon "></span><a href="#&#x7ED3;&#x8BBA;"><b>11.2. </b>&#x7ED3;&#x8BBA;</a></li></ul></ul></div><a href="#vhost-user&#x534F;&#x8BAE;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><ul>
<li><a href="#vhost-user&#x534F;&#x8BAE;">vhost-user&#x534F;&#x8BAE;</a></li>
<li><a href="#kvm&#x7684;irqfd&#x548C;ioeventfd">KVM&#x7684;irqfd&#x548C;ioeventfd</a><ul>
<li><a href="#irqfd">irqfd</a></li>
<li><a href="#ioeventfd">ioeventfd</a></li>
</ul>
</li>
<li><a href="#eventfd&#x5728;ovs&#x7684;&#x4F7F;&#x7528;">eventfd&#x5728;ovs&#x7684;&#x4F7F;&#x7528;</a><ul>
<li><a href="#qemu&#x7684;&#x901A;&#x77E5;&#x673A;&#x5236;">qemu&#x7684;&#x901A;&#x77E5;&#x673A;&#x5236;</a></li>
<li><a href="#qemu&#x91CC;&#x7684;eventfd">qemu&#x91CC;&#x7684;eventfd</a></li>
<li><a href="#eventfd&#x7531;qemu&#x901A;&#x8FC7;msg&#x4F20;&#x9012;&#x5230;ovs-dpdk">eventfd&#x7531;qemu&#x901A;&#x8FC7;msg&#x4F20;&#x9012;&#x5230;ovs-dpdk</a></li>
<li><a href="#&#x5728;dpdk&#x7684;vhost&#x9A71;&#x52A8;&#x4E2D;-&#x5199;eventfd">&#x5728;dpdk&#x7684;vhost&#x9A71;&#x52A8;&#x4E2D;, &#x5199;eventfd</a></li>
<li><a href="#&#x8865;&#x5145;-&#x901A;&#x8FC7;unix-socket&#x6765;&#x4F20;&#x9012;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;">&#x8865;&#x5145;: &#x901A;&#x8FC7;unix socket&#x6765;&#x4F20;&#x9012;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;</a></li>
</ul>
</li>
<li><a href="#&#x5173;&#x4E8E;ovs&#x6D41;&#x5339;&#x914D;">&#x5173;&#x4E8E;OVS&#x6D41;&#x5339;&#x914D;</a></li>
<li><a href="#smc-enable-signature-match-cache">smc-enable: signature match cache</a></li>
<li><a href="#vhost&#x534F;&#x8BAE;">vhost&#x534F;&#x8BAE;</a><ul>
<li><a href="#vhost&#x67B6;&#x6784;">vhost&#x67B6;&#x6784;</a></li>
<li><a href="#&#x8865;&#x5145;">&#x8865;&#x5145;</a></li>
</ul>
</li>
<li><a href="#ovs-dpdk&#x5173;&#x952E;&#x8DEF;&#x5F84;">OVS-DPDK&#x5173;&#x952E;&#x8DEF;&#x5F84;</a><ul>
<li><a href="#dpdkp0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;">dpdkp0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;</a></li>
<li><a href="#vhostuser0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;">vhostuser0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;</a></li>
</ul>
</li>
<li><a href="#buffer&#x5230;&#x5E95;&#x591A;&#x5927;">buffer&#x5230;&#x5E95;&#x591A;&#x5927;</a></li>
<li><a href="#datapath">datapath</a><ul>
<li><a href="#kernel-datapath">kernel datapath</a></li>
<li><a href="#userspace-datapath">userspace datapath</a></li>
<li><a href="#architecure">Architecure</a></li>
</ul>
</li>
<li><a href="#vport&#x7C7B;&#x578B;">vport&#x7C7B;&#x578B;</a><ul>
<li><a href="#netdev">netdev</a></li>
<li><a href="#internal">internal</a></li>
<li><a href="#patch">patch</a></li>
<li><a href="#tunnel-vports-vxlan-gre-etc">tunnel vports: vxlan, gre, etc</a></li>
</ul>
</li>
<li><a href="#&#x7528;&#x6237;&#x6001;&#x901A;&#x8FC7;&#x7269;&#x7406;&#x53E3;&#x53D1;&#x5305;&#x6D41;&#x7A0B;">&#x7528;&#x6237;&#x6001;&#x901A;&#x8FC7;&#x7269;&#x7406;&#x53E3;&#x53D1;&#x5305;&#x6D41;&#x7A0B;</a><ul>
<li><a href="#&#x4F7F;&#x7528;perf&#x6293;&#x5173;&#x952E;&#x8DEF;&#x5F84;">&#x4F7F;&#x7528;perf&#x6293;&#x5173;&#x952E;&#x8DEF;&#x5F84;</a></li>
<li><a href="#&#x7ED3;&#x8BBA;">&#x7ED3;&#x8BBA;</a></li>
</ul>
</li>
</ul>
<h1 id="vhost-user&#x534F;&#x8BAE;"><a name="vhost-user&#x534F;&#x8BAE;" class="anchor-navigation-ex-anchor" href="#vhost-user&#x534F;&#x8BAE;"><i class="fa fa-link" aria-hidden="true"></i></a>1. vhost-user&#x534F;&#x8BAE;</h1>
<p>&#x8BE6;&#x89C1;<code>qemu/docs/interop/vhost-user.txt</code></p>
<ul>
<li>Qemu&#x662F;master, ovs&#x662F;slave; master&#x901A;&#x8FC7;unix socket&#x5171;&#x4EAB;&#x5B83;&#x7684;&#x865A;&#x62DF;&#x961F;&#x5217;(virtqueues);</li>
<li>&#x5F53;OVS&#x7684;&#x865A;&#x62DF;port&#x662F;dpdkvhostuserclient&#x6A21;&#x5F0F;&#x65F6;, &#x8FD9;&#x4E2A;socket&#x7531;Qemu&#x6765;listen, &#x7531;OVS&#x6765;connect</li>
<li>&#x5728;socket&#x4E0A;, &#x4F20;&#x9012;&#x6D88;&#x606F;&#x7684;&#x683C;&#x5F0F;&#x5982;&#x4E0B;:</li>
</ul>
<pre class="language-"><code>------------------------------------ 
| request | flags | size | payload | 
------------------------------------ 

 * Request: 32-bit type of the request 
 * Flags: 32-bit bit field: 
   - Lower 2 bits are the version (currently 0x01) 
   - Bit 2 is the reply flag - needs to be sent on each reply from the slave 
   - Bit 3 is the need_reply flag - see VHOST_USER_PROTOCOL_F_REPLY_ACK for 
     details. 
 * Size - 32-bit size of the payload
</code></pre><ul>
<li>payload&#x683C;&#x5F0F;&#x4F1A;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x7C7B;&#x578B;&#x6765;&#x6539;&#x53D8;, &#x6BD4;&#x5982;vring&#x72B6;&#x6001;&#x63CF;&#x8FF0;, vring&#x5730;&#x5740;&#x63CF;&#x8FF0;, &#x5185;&#x5B58;&#x5730;&#x5740;&#x63CF;&#x8FF0;, IOTLB&#x6D88;&#x606F;, virtio&#x914D;&#x7F6E;&#x7A7A;&#x95F4;  <pre class="language-"><code class="lang-c"><span class="token comment">//&#x6D88;&#x606F;&#x5B9A;&#x4E49; </span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">VhostUserMsg</span> <span class="token punctuation">{</span> 
  VhostUserRequest request<span class="token punctuation">;</span> 
  <span class="token class-name">uint32_t</span> flags<span class="token punctuation">;</span> 
  <span class="token class-name">uint32_t</span> size<span class="token punctuation">;</span> 
  <span class="token keyword">union</span> <span class="token punctuation">{</span> 
      <span class="token class-name">uint64_t</span> u64<span class="token punctuation">;</span> 
      <span class="token keyword">struct</span> <span class="token class-name">vhost_vring_state</span> state<span class="token punctuation">;</span> 
      <span class="token keyword">struct</span> <span class="token class-name">vhost_vring_addr</span> addr<span class="token punctuation">;</span> 
      VhostUserMemory memory<span class="token punctuation">;</span> 
      VhostUserLog log<span class="token punctuation">;</span> 
      <span class="token keyword">struct</span> <span class="token class-name">vhost_iotlb_msg</span> iotlb<span class="token punctuation">;</span> 
      VhostUserConfig config<span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> QEMU_PACKED VhostUserMsg<span class="token punctuation">;</span>
</code></pre>
</li>
<li>vhost-user&#x7528;&#x7684;&#x6D88;&#x606F;&#x534F;&#x8BAE;&#x8DD1;&#x5728;socket&#x4E0A;, &#x4F46;&#x5927;&#x90E8;&#x5206;&#x6D88;&#x606F;&#x517C;&#x5BB9;kernel&#x7684;vhost&#x9A71;&#x52A8;&#x7528;&#x7684;ioctl&#x4E2D;&#x7684;&#x6D88;&#x606F;;<br>master&#x53D1;request, slave&#x53D1;reply, &#x4F46;&#x5927;&#x90E8;&#x5206;&#x6D88;&#x606F;&#x4E0D;&#x9700;&#x8981;reply, &#x9664;&#x4E86;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;:  <pre class="language-"><code class="lang-c"><span class="token operator">*</span> VHOST_USER_GET_FEATURES 
<span class="token operator">*</span> VHOST_USER_GET_PROTOCOL_FEATURES 
<span class="token operator">*</span> VHOST_USER_GET_VRING_BASE 
<span class="token operator">*</span> <span class="token function">VHOST_USER_SET_LOG_BASE</span> <span class="token punctuation">(</span><span class="token keyword">if</span> VHOST_USER_PROTOCOL_F_LOG_SHMFD<span class="token punctuation">)</span>
</code></pre>
</li>
<li>&#x6709;&#x4E9B;&#x6D88;&#x606F;&#x4F20;&#x7684;&#x662F;fd  <pre class="language-"><code>* VHOST_USER_SET_MEM_TABLE 
* VHOST_USER_SET_LOG_BASE (if VHOST_USER_PROTOCOL_F_LOG_SHMFD) 
* VHOST_USER_SET_LOG_FD 
* VHOST_USER_SET_VRING_KICK 
* VHOST_USER_SET_VRING_CALL 
* VHOST_USER_SET_VRING_ERR 
* VHOST_USER_SET_SLAVE_REQ_FD
</code></pre></li>
</ul>
<h1 id="kvm&#x7684;irqfd&#x548C;ioeventfd"><a name="kvm&#x7684;irqfd&#x548C;ioeventfd" class="anchor-navigation-ex-anchor" href="#kvm&#x7684;irqfd&#x548C;ioeventfd"><i class="fa fa-link" aria-hidden="true"></i></a>2. KVM&#x7684;irqfd&#x548C;ioeventfd</h1>
<h2 id="irqfd"><a name="irqfd" class="anchor-navigation-ex-anchor" href="#irqfd"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. irqfd</h2>
<p>Allows an fd to be used to inject an interrupt to the guest</p>
<blockquote>
<p>KVM provides a complete virtual system environment for guests, including
support for injecting interrupts modeled after the real exception/interrupt
facilities present on the native platform (such as the IDT on x86).
Virtual interrupts can come from a variety of sources (emulated devices,
pass-through devices, etc) but all must be injected to the guest via
the KVM infrastructure. This patch adds a new mechanism to inject a specific
interrupt to a guest using a decoupled eventfd mechnanism: Any legal signal
on the irqfd (using eventfd semantics from either userspace or kernel) will
translate into an injected interrupt in the guest at the next available
interrupt window.</p>
</blockquote>
<p>&#x5728;<code>kvm_vm_ioctl()</code>&#x4E2D;, &#x589E;&#x52A0;<code>KVM_ASSIGN_IRQFD</code>, &#x8C03;&#x7528;<code>kvm_assign_irqfd()</code>, &#x628A;<code>irqfd_wakeup()</code>&#x52A0;&#x5230;&#x5E95;&#x4E0B;<code>eventfd</code>&#x7684;&#x56DE;&#x8C03;&#x91CC;&#x9762;, &#x901A;&#x8FC7;<code>workqueue</code>&#x8C03;&#x7528;<code>irqfd_inject()</code>&#x5B8C;&#x6210;&#x4E2D;&#x65AD;&#x6CE8;&#x5165;<br><a href="https://patchwork.kernel.org/patch/23307/" target="_blank">https://patchwork.kernel.org/patch/23307/</a></p>
<h2 id="ioeventfd"><a name="ioeventfd" class="anchor-navigation-ex-anchor" href="#ioeventfd"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. ioeventfd</h2>
<p>Allow an fd to be used to receive a signal from the guest<br><a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=d34e6b175e61821026893ec5298cc8e7558df43a" target="_blank">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=d34e6b175e61821026893ec5298cc8e7558df43a</a></p>
<blockquote>
<p>ioeventfd is a mechanism to register PIO/MMIO regions to trigger an eventfd
signal when written to by a guest. Host userspace can register any
arbitrary IO address with a corresponding eventfd and then pass the eventfd
to a specific end-point of interest for handling.</p>
<p>Normal IO requires a blocking round-trip since the operation may cause
side-effects in the emulated model or may return data to the caller.
Therefore, an IO in KVM traps from the guest to the host, causes a VMX/SVM
&quot;heavy-weight&quot; exit back to userspace, and is ultimately serviced by qemu&apos;s
device model synchronously before returning control back to the vcpu.</p>
<p>However, there is a subclass of IO which acts purely as a trigger for
other IO (such as to kick off an out-of-band DMA request, etc). For these
patterns, the synchronous call is particularly expensive since we really
only want to simply get our notification transmitted asychronously and
return as quickly as possible. All the sychronous infrastructure to ensure
proper data-dependencies are met in the normal IO case are just unecessary
overhead for signalling. This adds additional computational load on the
system, as well as latency to the signalling path.</p>
<p>Therefore, we provide a mechanism for registration of an in-kernel trigger
point that allows the VCPU to only require a very brief, lightweight
exit just long enough to signal an eventfd. This also means that any
clients compatible with the eventfd interface (which includes userspace
and kernelspace equally well) can now register to be notified. The end
result should be a more flexible and higher performance notification API
for the backend KVM hypervisor and perhipheral components.</p>
</blockquote>
<h1 id="eventfd&#x5728;ovs&#x7684;&#x4F7F;&#x7528;"><a name="eventfd&#x5728;ovs&#x7684;&#x4F7F;&#x7528;" class="anchor-navigation-ex-anchor" href="#eventfd&#x5728;ovs&#x7684;&#x4F7F;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>3. eventfd&#x5728;ovs&#x7684;&#x4F7F;&#x7528;</h1>
<h2 id="qemu&#x7684;&#x901A;&#x77E5;&#x673A;&#x5236;"><a name="qemu&#x7684;&#x901A;&#x77E5;&#x673A;&#x5236;" class="anchor-navigation-ex-anchor" href="#qemu&#x7684;&#x901A;&#x77E5;&#x673A;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. qemu&#x7684;&#x901A;&#x77E5;&#x673A;&#x5236;</h2>
<pre class="language-"><code class="lang-c"><span class="token comment">//qemu/util/event_notifier-posix.c </span>
<span class="token keyword">int</span> <span class="token function">event_notifier_init</span><span class="token punctuation">(</span>EventNotifier <span class="token operator">*</span>e<span class="token punctuation">,</span> <span class="token keyword">int</span> active<span class="token punctuation">)</span> 
    <span class="token comment">//&#x5982;&#x679C;&#x6709;&#x5B9A;&#x4E49;CONFIG_EVENTFD </span>
    ret <span class="token operator">=</span> <span class="token function">eventfd</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> EFD_NONBLOCK <span class="token operator">|</span> EFD_CLOEXEC<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    e<span class="token operator">-&gt;</span>rfd <span class="token operator">=</span> e<span class="token operator">-&gt;</span>wfd <span class="token operator">=</span> ret<span class="token punctuation">;</span> 
    <span class="token comment">//&#x5426;&#x5219;&#x7528;pipe()&#x548C;fcntl()&#x7684;&#x7EC4;&#x5408;&#x6765;&#x4EA7;&#x751F;&#x4E24;&#x4E2A;&#x975E;&#x963B;&#x585E;&#x7684;fd, &#x6700;&#x540E;e-&gt;rfd = fds[0];e-&gt;wfd = fds[1]; </span>

<span class="token keyword">int</span> <span class="token function">event_notifier_get_fd</span><span class="token punctuation">(</span><span class="token keyword">const</span> EventNotifier <span class="token operator">*</span>e<span class="token punctuation">)</span> 
    <span class="token keyword">return</span> e<span class="token operator">-&gt;</span>rfd<span class="token punctuation">;</span> 

<span class="token comment">//&#x5199;fd </span>
<span class="token keyword">int</span> <span class="token function">event_notifier_set</span><span class="token punctuation">(</span>EventNotifier <span class="token operator">*</span>e<span class="token punctuation">)</span> 
    ret <span class="token operator">=</span> <span class="token function">write</span><span class="token punctuation">(</span>e<span class="token operator">-&gt;</span>wfd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>value<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//&#x8BFB;fd </span>
<span class="token keyword">int</span> <span class="token function">event_notifier_test_and_clear</span><span class="token punctuation">(</span>EventNotifier <span class="token operator">*</span>e<span class="token punctuation">)</span> 
    <span class="token function">read</span><span class="token punctuation">(</span>e<span class="token operator">-&gt;</span>rfd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="qemu&#x91CC;&#x7684;eventfd"><a name="qemu&#x91CC;&#x7684;eventfd" class="anchor-navigation-ex-anchor" href="#qemu&#x91CC;&#x7684;eventfd"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. qemu&#x91CC;&#x7684;eventfd</h2>
<pre class="language-"><code class="lang-c"><span class="token comment">//qemu/hw/virtio/vhost-user.c </span>
<span class="token comment">//&#x8FD9;&#x91CC;&#x6211;&#x8981;&#x627E;file-&gt;fd; &#x90A3;&#x5173;&#x952E;&#x662F;&#x8981;&#x627E;&#x8C03;&#x7528;&#x4E86;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;file&#x53C2;&#x6570; </span>
<span class="token function">vhost_user_set_vring_call</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">vhost_dev</span> <span class="token operator">*</span>dev<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">vhost_vring_file</span> <span class="token operator">*</span>file<span class="token punctuation">)</span> 
    <span class="token function">vhost_set_vring_file</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> VHOST_USER_SET_VRING_CALL<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ioeventfd_enabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> file<span class="token operator">-&gt;</span>fd <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> 
            fds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> file<span class="token operator">-&gt;</span>fd<span class="token punctuation">;</span> 
            <span class="token function">vhost_user_write</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> fds<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> 
                <span class="token comment">//qemu/hw/virtio/vhost-user.c </span>
                <span class="token function">qemu_chr_fe_set_msgfds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                <span class="token function">qemu_chr_fe_write_all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                    <span class="token comment">//qemu/chardev/char.c </span>
                    <span class="token function">qemu_chr_write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                        <span class="token function">qemu_chr_write_buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                            <span class="token comment">//&#x5176;&#x5B9E;&#x662F;tcp_chr_write() </span>
                            cc<span class="token operator">-&gt;</span><span class="token function">chr_write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                            <span class="token function">tcp_chr_write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                                <span class="token function">io_channel_send_full</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                                    <span class="token comment">//qemu/io/channel.c </span>
                                    <span class="token function">qio_channel_writev_full</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                                        <span class="token comment">//&#x5176;&#x5B9E;&#x662F;qio_channel_socket_writev() </span>
                                        klass<span class="token operator">-&gt;</span><span class="token function">io_writev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                                        <span class="token comment">//qemu/io/channel-socket.c </span>
                                        <span class="token function">qio_channel_socket_writev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                                            cmsg<span class="token operator">-&gt;</span>cmsg_type <span class="token operator">=</span> SCM_RIGHTS<span class="token punctuation">;</span> 
                                            <span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token function">CMSG_DATA</span><span class="token punctuation">(</span>cmsg<span class="token punctuation">)</span><span class="token punctuation">,</span> fds<span class="token punctuation">,</span> fdsize<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                                            <span class="token function">sendmsg</span><span class="token punctuation">(</span>sioc<span class="token operator">-&gt;</span>fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">//qemu/hw/virtio/vhost-user.c </span>
<span class="token keyword">const</span> VhostOps user_ops <span class="token operator">=</span> <span class="token punctuation">{</span> 
    <span class="token punctuation">.</span>backend_type <span class="token operator">=</span> VHOST_BACKEND_TYPE_USER<span class="token punctuation">,</span> 
    <span class="token punctuation">.</span>vhost_backend_init <span class="token operator">=</span> vhost_user_init<span class="token punctuation">,</span> 
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
    <span class="token punctuation">.</span>vhost_set_vring_call <span class="token operator">=</span> vhost_user_set_vring_call<span class="token punctuation">,</span> 
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
<span class="token punctuation">}</span> 

<span class="token comment">//qemu/hw/virtio/vhost-backend.c </span>
<span class="token comment">//&#x6CE8;&#x518C;vhost user&#x5728;qemu&#x91CC;&#x9762;&#x7684;&#x9A71;&#x52A8; </span>
<span class="token keyword">int</span> <span class="token function">vhost_set_backend_type</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">vhost_dev</span> <span class="token operator">*</span>dev<span class="token punctuation">,</span> VhostBackendType backend_type<span class="token punctuation">)</span> 
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>backend_type<span class="token punctuation">)</span> 
        <span class="token keyword">case</span> VHOST_BACKEND_TYPE_KERNEL<span class="token operator">:</span> 
            dev<span class="token operator">-&gt;</span>vhost_ops <span class="token operator">=</span> <span class="token operator">&amp;</span>kernel_ops<span class="token punctuation">;</span> 
        <span class="token keyword">case</span> VHOST_BACKEND_TYPE_USER<span class="token operator">:</span> 
            dev<span class="token operator">-&gt;</span>vhost_ops <span class="token operator">=</span> <span class="token operator">&amp;</span>user_ops<span class="token punctuation">;</span> 

<span class="token comment">//&#x4E0B;&#x9762;&#x8981;&#x627E;dev-&gt;vhost_ops-&gt;vhost_set_vring_call </span>
<span class="token comment">//&#x5728;qemu/hw/virtio/vhost.c </span>
<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">vhost_virtqueue_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token comment">//&#x751F;&#x6210;eventfd </span>
    <span class="token function">event_notifier_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>vq<span class="token operator">-&gt;</span>masked_notifier<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//vq-&gt;masked_notifier-&gt;rfd&#x5C31;&#x662F;&#x521A;&#x624D;&#x751F;&#x6210;&#x7684;eventfd </span>
    file<span class="token punctuation">.</span>fd <span class="token operator">=</span> vq<span class="token operator">-&gt;</span>masked_notifier<span class="token operator">-&gt;</span>rfd 
    dev<span class="token operator">-&gt;</span>vhost_ops<span class="token operator">-&gt;</span><span class="token function">vhost_set_vring_call</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token operator">&amp;</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">//&#x4E5F;&#x6709;&#x53EF;&#x80FD;&#x662F;vq-&gt;guest_notifier-&gt;rfd </span>
<span class="token keyword">void</span> <span class="token function">vhost_virtqueue_mask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    file<span class="token punctuation">.</span>fd <span class="token operator">=</span> vq<span class="token operator">-&gt;</span>guest_notifier<span class="token operator">-&gt;</span>rfd<span class="token punctuation">;</span>
</code></pre>
<h2 id="eventfd&#x7531;qemu&#x901A;&#x8FC7;msg&#x4F20;&#x9012;&#x5230;ovs-dpdk"><a name="eventfd&#x7531;qemu&#x901A;&#x8FC7;msg&#x4F20;&#x9012;&#x5230;ovs-dpdk" class="anchor-navigation-ex-anchor" href="#eventfd&#x7531;qemu&#x901A;&#x8FC7;msg&#x4F20;&#x9012;&#x5230;ovs-dpdk"><i class="fa fa-link" aria-hidden="true"></i></a>3.3. eventfd&#x7531;qemu&#x901A;&#x8FC7;msg&#x4F20;&#x9012;&#x5230;ovs-dpdk</h2>
<pre class="language-"><code class="lang-c"><span class="token comment">//&#x5728;OVS&#x4EE3;&#x7801;&#x91CC;&#x9762;&#x7684;netdev_dpdk_vhost_client_reconfigure&#x88AB;&#x8C03;&#x7528; </span>
<span class="token comment">//ovs/lib/netdev-dpdk.c </span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">netdev_class</span> dpdk_vhost_client_class <span class="token operator">=</span> 
    <span class="token function">NETDEV_DPDK_CLASS</span><span class="token punctuation">(</span> 
        <span class="token string">&quot;dpdkvhostuserclient&quot;</span><span class="token punctuation">,</span> 
        <span class="token constant">NULL</span><span class="token punctuation">,</span> 
        netdev_dpdk_vhost_client_construct<span class="token punctuation">,</span> 
        netdev_dpdk_vhost_destruct<span class="token punctuation">,</span> 
        netdev_dpdk_vhost_client_set_config<span class="token punctuation">,</span> 
        <span class="token constant">NULL</span><span class="token punctuation">,</span> 
        netdev_dpdk_vhost_send<span class="token punctuation">,</span> 
        netdev_dpdk_vhost_get_carrier<span class="token punctuation">,</span> 
        netdev_dpdk_vhost_get_stats<span class="token punctuation">,</span> 
        <span class="token constant">NULL</span><span class="token punctuation">,</span> 
        <span class="token constant">NULL</span><span class="token punctuation">,</span> 
        netdev_dpdk_vhost_user_get_status<span class="token punctuation">,</span> 
        netdev_dpdk_vhost_client_reconfigure<span class="token punctuation">,</span> 
        netdev_dpdk_vhost_rxq_recv<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//DPDK&#x7684;&#x4EE3;&#x7801;: </span>
<span class="token comment">//lib/librte_vhost/socket.c </span>
<span class="token function">rte_vhost_driver_start</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">)</span> 
    vsocket <span class="token operator">=</span> <span class="token function">find_vhost_user_socket</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//&#x8D77;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;, &#x4E0D;&#x65AD;poll fdsets </span>
    <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>fdset_tid<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> fdset_event_dispatch<span class="token punctuation">,</span> <span class="token operator">&amp;</span>vhost_user<span class="token punctuation">.</span>fdset<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//fdset_event_dispatch()@lib/librte_vhost/fd_man.c </span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 
            <span class="token function">poll</span><span class="token punctuation">(</span>pfdset<span class="token operator">-&gt;</span>rwfds<span class="token punctuation">,</span> numfds<span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token comment">/* millisecs */</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token comment">//for pfdentry in pfdset </span>
            <span class="token comment">//&#x8BE5;fd&#x6CA1;&#x6709;event </span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pfd<span class="token operator">-&gt;</span>revents<span class="token punctuation">)</span> 
                    <span class="token keyword">continue</span><span class="token punctuation">;</span> 
                fd <span class="token operator">=</span> pfdentry<span class="token operator">-&gt;</span>fd<span class="token punctuation">;</span> 
                rcb <span class="token operator">=</span> pfdentry<span class="token operator">-&gt;</span>rcb<span class="token punctuation">;</span> 
                wcb <span class="token operator">=</span> pfdentry<span class="token operator">-&gt;</span>wcb<span class="token punctuation">;</span> 
                dat <span class="token operator">=</span> pfdentry<span class="token operator">-&gt;</span>dat<span class="token punctuation">;</span> 
                <span class="token keyword">if</span> <span class="token punctuation">(</span>rcb <span class="token operator">&amp;&amp;</span> pfd<span class="token operator">-&gt;</span>revents <span class="token operator">&amp;</span> <span class="token punctuation">(</span>POLLIN <span class="token operator">|</span> FDPOLLERR<span class="token punctuation">)</span><span class="token punctuation">)</span> 
                    <span class="token function">rcb</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> dat<span class="token punctuation">,</span> <span class="token operator">&amp;</span>remove1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                    <span class="token comment">//&#x8BFB;unix socket&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570; </span>
                    <span class="token function">vhost_user_read_cb</span><span class="token punctuation">(</span><span class="token keyword">int</span> connfd<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>dat<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>remove<span class="token punctuation">)</span> 
                        <span class="token comment">//lib/librte_vhost/vhost_user.c </span>
                        <span class="token function">vhost_user_msg_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> vid<span class="token punctuation">,</span> <span class="token keyword">int</span> fd<span class="token punctuation">)</span> 
                            <span class="token function">read_vhost_message</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                                <span class="token comment">//&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x6709;&#x8BB2;&#x7A76;: &#x901A;&#x8FC7;unix socket&#x7684;SCM_RIGHTS&#x53EF;&#x4EE5;&#x4F20;&#x9012;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;!&#x8BE6;&#x89C1;&#x4E0B;&#x5C0F;&#x8282; </span>
                                <span class="token comment">//lib/librte_vhost/socket.c </span>
                                <span class="token function">read_fd_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                                    <span class="token keyword">struct</span> <span class="token class-name">msghdr</span> msgh<span class="token punctuation">;</span> 
                                    <span class="token function">recvmsg</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>msgh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                                    cmsg <span class="token operator">=</span> <span class="token function">CMSG_FIRSTHDR</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>msgh<span class="token punctuation">)</span> 
                                    <span class="token comment">//fd&#x662F;&#x5728;msgh&#x7684;cmsg&#x7684;CMSG_DATA&#x5B57;&#x6BB5;&#x91CC; </span>
                                    <span class="token function">memcpy</span><span class="token punctuation">(</span>fds<span class="token punctuation">,</span> <span class="token function">CMSG_DATA</span><span class="token punctuation">(</span>cmsg<span class="token punctuation">)</span><span class="token punctuation">,</span> fdsize<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                            <span class="token function">vhost_user_check_and_alloc_queue_pair</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token operator">&amp;</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                            <span class="token keyword">switch</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>request<span class="token punctuation">.</span>master<span class="token punctuation">)</span> 
                                <span class="token keyword">case</span> VHOST_USER_SET_MEM_TABLE<span class="token operator">:</span> 
                                <span class="token keyword">case</span> VHOST_USER_SET_VRING_NUM<span class="token operator">:</span> 
                                <span class="token keyword">case</span> VHOST_USER_SET_VRING_ADDR<span class="token operator">:</span> 
                                <span class="token keyword">case</span> VHOST_USER_SET_VRING_BASE<span class="token operator">:</span> 
                                <span class="token keyword">case</span> VHOST_USER_SET_VRING_CALL<span class="token operator">:</span> 
                                    <span class="token function">vhost_user_set_vring_call</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token operator">&amp;</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                                        <span class="token comment">//&#x770B;&#x8D77;&#x6765;&#x8FD9;&#x4E2A;fd&#x662F;msg&#x4F20;&#x8FC7;&#x6765;&#x7684; </span>
                                        file<span class="token punctuation">.</span>fd <span class="token operator">=</span> pmsg<span class="token operator">-&gt;</span>fds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
                                        vq<span class="token operator">-&gt;</span>callfd <span class="token operator">=</span> file<span class="token punctuation">.</span>fd<span class="token punctuation">;</span> 
                <span class="token keyword">if</span> <span class="token punctuation">(</span>wcb <span class="token operator">&amp;&amp;</span> pfd<span class="token operator">-&gt;</span>revents <span class="token operator">&amp;</span> <span class="token punctuation">(</span>POLLOUT <span class="token operator">|</span> FDPOLLERR<span class="token punctuation">)</span><span class="token punctuation">)</span> 
                    <span class="token function">wcb</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> dat<span class="token punctuation">,</span> <span class="token operator">&amp;</span>remove2<span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token function">vhost_user_start_client</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">vhost_user_socket</span> <span class="token operator">*</span>vsocket<span class="token punctuation">)</span> 
        <span class="token comment">//unix domain socket </span>
        <span class="token keyword">int</span> fd <span class="token operator">=</span> vsocket<span class="token operator">-&gt;</span>socket_fd<span class="token punctuation">;</span> 
        <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path <span class="token operator">=</span> vsocket<span class="token operator">-&gt;</span>path<span class="token punctuation">;</span> 
        <span class="token function">vhost_user_connect_nonblock</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>vsocket<span class="token operator">-&gt;</span>un<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>vsocket<span class="token operator">-&gt;</span>un<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token function">vhost_user_add_connection</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">vhost_user_socket</span> <span class="token operator">*</span>vsocket<span class="token punctuation">)</span> 
            conn <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>conn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            vid <span class="token operator">=</span> <span class="token function">vhost_new_device</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            vsocket<span class="token operator">-&gt;</span>notify_ops<span class="token operator">-&gt;</span><span class="token function">new_connection</span><span class="token punctuation">(</span>vid<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token comment">//fd&#x52A0;&#x5165;fd_sets, &#x5F53;fd&#x53EF;&#x8BFB;&#x65F6;, &#x8C03;&#x7528;&#x56DE;&#x8C03;&#x51FD;&#x6570;; &#x7531;&#x4E0A;&#x9762;&#x7684;fdset_event_dispatch&#x7EBF;&#x7A0B;&#x8C03;&#x7528; </span>
            ret <span class="token operator">=</span> <span class="token function">fdset_add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>vhost_user<span class="token punctuation">.</span>fdset<span class="token punctuation">,</span> fd<span class="token punctuation">,</span> vhost_user_read_cb<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="&#x5728;dpdk&#x7684;vhost&#x9A71;&#x52A8;&#x4E2D;-&#x5199;eventfd"><a name="&#x5728;dpdk&#x7684;vhost&#x9A71;&#x52A8;&#x4E2D;-&#x5199;eventfd" class="anchor-navigation-ex-anchor" href="#&#x5728;dpdk&#x7684;vhost&#x9A71;&#x52A8;&#x4E2D;-&#x5199;eventfd"><i class="fa fa-link" aria-hidden="true"></i></a>3.4. &#x5728;dpdk&#x7684;vhost&#x9A71;&#x52A8;&#x4E2D;, &#x5199;eventfd</h2>
<pre class="language-"><code class="lang-c"><span class="token comment">//lib/librte_vhost/virtio_net.c </span>
<span class="token comment">//&#x8FDB;&#x961F;&#x5217; </span>
<span class="token function">rte_vhost_enqueue_burst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token function">virtio_dev_rx</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
        <span class="token function">eventfd_write</span><span class="token punctuation">(</span>vq<span class="token operator">-&gt;</span>callfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">eventfd_t</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//&#x51FA;&#x961F;&#x5217; </span>
<span class="token function">rte_vhost_dequeue_burst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token function">update_used_idx</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
        <span class="token function">eventfd_write</span><span class="token punctuation">(</span>vq<span class="token operator">-&gt;</span>callfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">eventfd_t</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="&#x8865;&#x5145;-&#x901A;&#x8FC7;unix-socket&#x6765;&#x4F20;&#x9012;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;"><a name="&#x8865;&#x5145;-&#x901A;&#x8FC7;unix-socket&#x6765;&#x4F20;&#x9012;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;" class="anchor-navigation-ex-anchor" href="#&#x8865;&#x5145;-&#x901A;&#x8FC7;unix-socket&#x6765;&#x4F20;&#x9012;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;"><i class="fa fa-link" aria-hidden="true"></i></a>3.5. &#x8865;&#x5145;: &#x901A;&#x8FC7;unix socket&#x6765;&#x4F20;&#x9012;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;</h2>
<p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x662F;&#x4E2A;&#x6BD4;&#x8F83;&#x5C0F;&#x7684;&#x6574;&#x6570;, &#x4E00;&#x822C;&#x662F;&#x4E0D;&#x80FD;&#x5171;&#x4EAB;&#x7ED9;&#x5176;&#x4ED6;unrelated&#x8FDB;&#x7A0B;&#x7684;, &#x5927;&#x90E8;&#x5206;&#x5171;&#x4EAB;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x7684;&#x64CD;&#x4F5C;&#x51FA;&#x73B0;&#x5728;&#x7236;&#x5B50;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;&#x573A;&#x666F;&#x4E0B;, &#x4F46;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;&#x4E2D;, qemu&#x901A;&#x8FC7;unix socket&#x628A;eventfd&#x4F20;&#x9012;&#x7ED9;OVS, &#x600E;&#x4E48;&#x505A;&#x5230;&#x7684;&#x5462;?</p>
<p>&#x8FD9;&#x7528;&#x5230;&#x4E86;unix socket&#x7684;&#x7279;&#x6027;, SCM_RIGHTS, unix socket&#x53EF;&#x4EE5;&#x4F20;&#x9012;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x6570;&#x7EC4;&#x7ED9;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;, &#x5C31;&#x50CF;&#x5B83;&#x4EEC;&#x88AB;<code>dup()</code>&#x8FC7;&#x4E00;&#x6837;.</p>
<p><code>man 7 unix</code>&#x641C;&#x7D22;SCM_RIGHTS<br><code>man 3 cmsg</code>&#x91CC;&#x6709;&#x793A;&#x4F8B;&#x4EE3;&#x7801;:</p>
<pre class="language-"><code class="lang-c"><span class="token keyword">struct</span> <span class="token class-name">msghdr</span> msg <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">struct</span> <span class="token class-name">cmsghdr</span> <span class="token operator">*</span>cmsg<span class="token punctuation">;</span> 
<span class="token keyword">int</span> myfds<span class="token punctuation">[</span>NUM_FD<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">/* Contains the file descriptors to pass */</span> 
<span class="token keyword">int</span> <span class="token operator">*</span>fdptr<span class="token punctuation">;</span> 
<span class="token keyword">char</span> iobuf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">struct</span> <span class="token class-name">iovec</span> io <span class="token operator">=</span> <span class="token punctuation">{</span> 
    <span class="token punctuation">.</span>iov_base <span class="token operator">=</span> iobuf<span class="token punctuation">,</span> 
    <span class="token punctuation">.</span>iov_len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>iobuf<span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">union</span> <span class="token punctuation">{</span>         <span class="token comment">/* Ancillary data buffer, wrapped in a union 
                   in order to ensure it is suitably aligned */</span> 
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token function">CMSG_SPACE</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>myfds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
    <span class="token keyword">struct</span> <span class="token class-name">cmsghdr</span> align<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> u<span class="token punctuation">;</span> 

msg<span class="token punctuation">.</span>msg_iov <span class="token operator">=</span> <span class="token operator">&amp;</span>io<span class="token punctuation">;</span> 
msg<span class="token punctuation">.</span>msg_iovlen <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> 
msg<span class="token punctuation">.</span>msg_control <span class="token operator">=</span> u<span class="token punctuation">.</span>buf<span class="token punctuation">;</span> 
msg<span class="token punctuation">.</span>msg_controllen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> 
cmsg <span class="token operator">=</span> <span class="token function">CMSG_FIRSTHDR</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> 
cmsg<span class="token operator">-&gt;</span>cmsg_level <span class="token operator">=</span> SOL_SOCKET<span class="token punctuation">;</span> 
cmsg<span class="token operator">-&gt;</span>cmsg_type <span class="token operator">=</span> SCM_RIGHTS<span class="token punctuation">;</span> 
cmsg<span class="token operator">-&gt;</span>cmsg_len <span class="token operator">=</span> <span class="token function">CMSG_LEN</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">*</span> NUM_FD<span class="token punctuation">)</span><span class="token punctuation">;</span> 
fdptr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">CMSG_DATA</span><span class="token punctuation">(</span>cmsg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* Initialize the payload */</span> 
<span class="token function">memcpy</span><span class="token punctuation">(</span>fdptr<span class="token punctuation">,</span> myfds<span class="token punctuation">,</span> NUM_FD <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x6CE8;&#x610F;: <strong>&#x901A;&#x8FC7;unix socket&#x4F20;&#x9012;&#x7684;fd, &#x5B9E;&#x9645;&#x6307;&#x5411;&#x7684;&#x6587;&#x4EF6;&#x662F;&#x540C;&#x4E00;&#x4E2A;, &#x4F46;&#x53D1;&#x9001;&#x65B9;&#x548C;&#x63A5;&#x6536;&#x65B9;&#x7684;fd&#x53F7;&#x5176;&#x5B9E;&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;, &#x7C7B;&#x4F3C;&#x4E8E;fd&#x88AB;<code>dup()</code>&#x8FC7;.</strong></p>
<h1 id="&#x5173;&#x4E8E;ovs&#x6D41;&#x5339;&#x914D;"><a name="&#x5173;&#x4E8E;ovs&#x6D41;&#x5339;&#x914D;" class="anchor-navigation-ex-anchor" href="#&#x5173;&#x4E8E;ovs&#x6D41;&#x5339;&#x914D;"><i class="fa fa-link" aria-hidden="true"></i></a>4. &#x5173;&#x4E8E;OVS&#x6D41;&#x5339;&#x914D;</h1>
<p><a href="https://www.cnblogs.com/neooelric/p/7160222.html" target="_blank">https://www.cnblogs.com/neooelric/p/7160222.html</a><br><a href="https://blog.csdn.net/u010378472/article/details/79146557" target="_blank">https://blog.csdn.net/u010378472/article/details/79146557</a></p>
<h1 id="smc-enable-signature-match-cache"><a name="smc-enable-signature-match-cache" class="anchor-navigation-ex-anchor" href="#smc-enable-signature-match-cache"><i class="fa fa-link" aria-hidden="true"></i></a>5. smc-enable: signature match cache</h1>
<p>&#x5B9E;&#x6D4B;&#x6027;&#x80FD;&#x63D0;&#x9AD8;10% - 15%<br><a href="https://mail.openvswitch.org/pipermail/ovs-dev/2018-July/348978.html" target="_blank">https://mail.openvswitch.org/pipermail/ovs-dev/2018-July/348978.html</a></p>
<blockquote>
<p>It is generally beneficial to turn on SMC but turn off EMC when traffic flow count is much larger than EMC size.</p>
</blockquote>
<h1 id="vhost&#x534F;&#x8BAE;"><a name="vhost&#x534F;&#x8BAE;" class="anchor-navigation-ex-anchor" href="#vhost&#x534F;&#x8BAE;"><i class="fa fa-link" aria-hidden="true"></i></a>6. vhost&#x534F;&#x8BAE;</h1>
<p><a href="https://blog.csdn.net/me_blue/article/details/77854595" target="_blank">https://blog.csdn.net/me_blue/article/details/77854595</a><br><a href="https://blog.csdn.net/me_blue/article/details/77969084" target="_blank">https://blog.csdn.net/me_blue/article/details/77969084</a><br><a href="https://access.redhat.com/solutions/3394851" target="_blank">https://access.redhat.com/solutions/3394851</a></p>
<ul>
<li>&#x63A7;&#x5236;&#x4FE1;&#x606F;&#x8D70;socket&#x6587;&#x4EF6;, &#x5305;&#x62EC;&#x4EA4;&#x6362;&#x5185;&#x5B58;map&#x8868;, door bell&#x901A;&#x77E5;&#x5BF9;&#x65B9;&#x6570;&#x636E;&#x5DF2;&#x7ECF;&#x653E;&#x5230;virtio queue&#x91CC;&#x9762;&#x4E86;<br>&#x901A;&#x8FC7;socket&#x4EE5;&quot;door bell&quot;&#x65B9;&#x5F0F;&#x901A;&#x77E5;&#x5BF9;&#x65B9;&#x662F;&#x6709;&#x4EE3;&#x4EF7;&#x7684;, &#x8BFB;&#x5199;socket&#x9700;&#x8981;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;, &#x53CC;&#x65B9;&#x8FD8;&#x8981;&#x5904;&#x7406;&#x5BF9;&#x5E94;&#x7684;&#x4E2D;&#x65AD;.</li>
<li>&#x6570;&#x636E;&#x9762;&#x76F4;&#x63A5;&#x7528;DMA(direct memory access), &#x6216;&#x8005;&#x8BF4;&#x662F;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x65B9;&#x5F0F;&#x8BFB;&#x5199;.<ul>
<li>VM&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;, &#x5185;&#x5B58;&#x521D;&#x59CB;&#x5316;&#x4E3A;shared</li>
<li>VM&#x7684;virtio-net&#x9A71;&#x52A8;&#x628A;&#x5185;&#x5B58;&#x5206;&#x914D;&#x7ED9;virtio queue, &#x76F8;&#x5173;&#x7684;&#x7ED3;&#x6784;&#x4F53;&#x7B26;&#x5408;virtio&#x89C4;&#x8303;</li>
<li>qemu&#x628A;&#x8FD9;&#x4E2A;&#x5185;&#x5B58;&#x5730;&#x5740;&#x901A;&#x8FC7;&#x63A7;&#x5236;&#x9762;socket&#x7ED9;OVS-DPDK</li>
<li>DPDK&#x628A;&#x8FD9;&#x4E2A;&#x5730;&#x5740;&#x6620;&#x5C04;&#x6210;&#x7B26;&#x5408;virtio&#x89C4;&#x8303;&#x7684;&#x7ED3;&#x6784;&#x4F53;, &#x6240;&#x4EE5;&#x5185;&#x5B58;&#x4E00;&#x6837;, &#x7ED3;&#x6784;&#x4F53;&#x4E5F;&#x4E00;&#x6837;.</li>
<li>&#x901A;&#x8FC7;&#x4EE5;&#x4E0A;&#x51E0;&#x6B65;, DPDK&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8BFB;&#x5199;VM&#x5728;&#x5176;hugepage&#x4E0A;&#x5206;&#x914D;&#x7684;virtio queue</li>
</ul>
</li>
<li>&#x4E00;&#x65B9;&#x628A;data&#x653E;&#x5230;virtio ring&#x540E;, &#x6570;&#x636E;&#x901A;&#x77E5;&#x65B9;&#x5F0F;&#x6709;&#x4E24;&#x79CD;:<ul>
<li>&#x53E6;&#x5916;&#x4E00;&#x65B9;&#x4E0D;&#x65AD;&#x7684;poll, &#x6BD4;&#x5982;DPDK&#x7684;pmd</li>
<li>&#x901A;&#x8FC7;&quot;&#x4E2D;&#x65AD;&quot;&#x65B9;&#x5F0F;&#x901A;&#x77E5;&#x5BF9;&#x65B9;<ul>
<li>&#x5229;&#x7528;KVM&#x63D0;&#x4F9B;&#x7684;ioeventfd&#x548C;irqfd&#x673A;&#x5236;</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>In the end the vhost instance only knows about the guest memory mapping, a kick eventfd, and a call eventfd.</p>
</blockquote>
<h2 id="vhost&#x67B6;&#x6784;"><a name="vhost&#x67B6;&#x6784;" class="anchor-navigation-ex-anchor" href="#vhost&#x67B6;&#x6784;"><i class="fa fa-link" aria-hidden="true"></i></a>6.1. vhost&#x67B6;&#x6784;</h2>
<p><a href="http://blog.allenx.org/2013/09/09/vhost-architecture" target="_blank">http://blog.allenx.org/2013/09/09/vhost-architecture</a></p>
<h2 id="&#x8865;&#x5145;"><a name="&#x8865;&#x5145;" class="anchor-navigation-ex-anchor" href="#&#x8865;&#x5145;"><i class="fa fa-link" aria-hidden="true"></i></a>6.2. &#x8865;&#x5145;</h2>
<p><a href="https://access.redhat.com/documentation/en-us/reference_architectures/2017/html/deploying_mobile_networks_using_network_functions_virtualization/performance_and_optimization" target="_blank">https://access.redhat.com/documentation/en-us/reference_architectures/2017/html/deploying_mobile_networks_using_network_functions_virtualization/performance_and_optimization</a></p>
<p><img src="img/OVS_&#x67B6;&#x6784;&#x548C;&#x4EE3;&#x7801;_20220928232518.png" alt="">  </p>
<p>&#x76F8;&#x5173;&#x4EE3;&#x7801;:</p>
<pre class="language-"><code>Here are the main points to begin exploring the code: 

    drivers/vhost/vhost.c - common vhost driver code 
    drivers/vhost/net.c - vhost-net driver 
    virt/kvm/eventfd.c - ioeventfd and irqfd 

The QEMU userspace code shows how to initialize the vhost instance: 

    hw/vhost.c - common vhost initialization code 
    hw/vhost_net.c - vhost-net initialization
</code></pre><h1 id="ovs-dpdk&#x5173;&#x952E;&#x8DEF;&#x5F84;"><a name="ovs-dpdk&#x5173;&#x952E;&#x8DEF;&#x5F84;" class="anchor-navigation-ex-anchor" href="#ovs-dpdk&#x5173;&#x952E;&#x8DEF;&#x5F84;"><i class="fa fa-link" aria-hidden="true"></i></a>7. OVS-DPDK&#x5173;&#x952E;&#x8DEF;&#x5F84;</h1>
<p><img src="img/OVS_&#x67B6;&#x6784;&#x548C;&#x4EE3;&#x7801;_20220928232716.png" alt="">  </p>
<p>&#x5148;&#x67E5;pmd&#x7684;q&#x5206;&#x5E03;</p>
<pre class="language-"><code>sudo ovs-appctl dpif-netdev/pmd-rxq-show
</code></pre><h2 id="dpdkp0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;"><a name="dpdkp0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;" class="anchor-navigation-ex-anchor" href="#dpdkp0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;"><i class="fa fa-link" aria-hidden="true"></i></a>7.1. dpdkp0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;</h2>
<p>&#x53D1;&#x73B0;dpdkp0&#x7684;q&#x8DD1;&#x5728;core 33&#x4E0A;, &#x662F;&#x4ECE;dpdkp0&#x7269;&#x7406;&#x53E3;&#x6536;&#x5305;, &#x518D;&#x53D1;&#x5230;vhostuser0&#x7684;&#x8FC7;&#x7A0B;.<br>&#x6293;&#x5173;&#x952E;&#x8DEF;&#x5F84;</p>
<pre class="language-"><code>sudo perf top -g -a -C 33 --no-children
</code></pre><p>&#x7ED3;&#x5408;&#x4EE3;&#x7801;, &#x8C03;&#x7528;&#x8DEF;&#x5F84;&#x5982;&#x4E0B;:</p>
<pre class="language-"><code class="lang-sh">start_thread 
ovsthread_wrapper 
pmd_thread_main 
  <span class="token comment">#&#x4E00;&#x4E2A;core&#x53EF;&#x4EE5;poll&#x591A;&#x4E2A;rxq </span>
  poll_cnt <span class="token operator">=</span> pmd_load_queues_and_ports<span class="token punctuation">(</span>pmd, <span class="token operator">&amp;</span>poll_list<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> poll_cnt<span class="token punctuation">;</span> i++<span class="token punctuation">)</span> 
    dp_netdev_process_rxq_port<span class="token punctuation">(</span>pmd, poll_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>.rxq,poll_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>.port_no<span class="token punctuation">)</span> 
        <span class="token comment">#&#x62A5;&#x6587;&#x662F;&#x653E;&#x5728;&#x8FD9;&#x91CC;&#x7684; </span>
        struct dp_packet_batch batch<span class="token punctuation">;</span> 
        dp_packet_batch_init<span class="token punctuation">(</span><span class="token operator">&amp;</span>batch<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">#&#x5148;&#x6536;&#x5305; </span>
        netdev_rxq_recv<span class="token punctuation">(</span>rxq-<span class="token operator">&gt;</span>rx, <span class="token operator">&amp;</span>batch<span class="token punctuation">)</span> 
            netdev_dpdk_rxq_recv 
                <span class="token comment">#&#x6536;&#x5305;&#x51FD;&#x6570;&#x5360;&#x6BD4;8.9%, &#x6392;&#x540D;&#x7B2C;&#x56DB; </span>
                mlx5_rx_burst_vec 
        <span class="token comment">#&#x518D;&#x8F6C;&#x53D1;, &#x4EA4;&#x6362;&#x673A;&#x7684;&#x57FA;&#x672C;&#x903B;&#x8F91; </span>
        dp_netdev_input<span class="token punctuation">(</span>pmd, <span class="token operator">&amp;</span>batch, port_no<span class="token punctuation">)</span> 
            <span class="token comment">#emc&#x662F;exact match cache:pmd-&gt;flow_cache </span>
            emc_processing 
                <span class="token comment">#&#x5BF9;&#x6BCF;&#x4E2A;packet&#x6267;&#x884C; </span>
                    pkt_metadata_init 
                    <span class="token comment">#&#x89E3;&#x6790;&#x62A5;&#x6587;, &#x89E3;&#x6790;&#x7C7B;&#x4F3C;&#x4E94;&#x5143;&#x7EC4;&#x7684;&#x4FE1;&#x606F; </span>
                    <span class="token comment">#&#x8FD9;&#x4E2A;&#x5360;&#x6BD4;&#x7B2C;&#x4E09;&#x9AD8;, 16% </span>
                    miniflow_extract 
                    <span class="token comment">#&#x5728;flow cache&#x91CC;&#x67E5;&#x627E;key(&#x7531;miniflow_extract&#x5F97;&#x6765;), &#x7528;memcmp;  </span>
                    flow <span class="token operator">=</span> emc_lookup<span class="token punctuation">(</span>flow_cache, key<span class="token punctuation">)</span> 
            fast_path_processing 
                <span class="token comment">#&#x591A;&#x6D41;(L2&#x6216;L3&#x53D8;&#x5316;)&#x7684;&#x65F6;&#x5019;, &#x8BE5;&#x51FD;&#x6570;&#x5360;&#x6BD4;&#x6700;&#x9AD8; </span>
                dpcls_lookup 
            packet_batch_per_flow_execute 
        dp_netdev_pmd_flush_output_packets<span class="token punctuation">(</span>pmd, <span class="token boolean">false</span><span class="token punctuation">)</span> 
            dp_netdev_pmd_flush_output_on_port 
                netdev_send 
                    <span class="token comment">#&#x5B9E;&#x9645;&#x6267;&#x884C;__netdev_dpdk_vhost_send </span>
                    <span class="token comment">#&#x5360;&#x6BD4;&#x7B2C;&#x4E8C;&#x9AD8;, %17 </span>
                    netdev_dpdk_vhost_send 
                        <span class="token comment">#&#x8BE5;&#x51FD;&#x6570;&#x5355;&#x6761;&#x6D41;&#x65F6;&#x5360;&#x6BD4;&#x6700;&#x9AD8;, 22% </span>
                        rte_vhost_enqueue_burst
</code></pre>
<h2 id="vhostuser0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;"><a name="vhostuser0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;" class="anchor-navigation-ex-anchor" href="#vhostuser0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;"><i class="fa fa-link" aria-hidden="true"></i></a>7.2. vhostuser0&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;</h2>
<p>&#x53D1;&#x73B0;vhostuser0&#x7684;q&#x8DD1;&#x5728;core 36&#x4E0A;, &#x662F;vhostuser0&#x4ECE;VM&#x6536;&#x5305;, &#x518D;&#x53D1;&#x5230;dpdkp0&#x7269;&#x7406;&#x53E3;&#x7684;&#x8FC7;&#x7A0B;.<br>&#x6293;&#x5173;&#x952E;&#x8DEF;&#x5F84;</p>
<pre class="language-"><code>sudo perf top -g -a -C 36 --no-children
</code></pre><p>&#x7ED3;&#x5408;&#x4EE3;&#x7801;, &#x8C03;&#x7528;&#x8DEF;&#x5F84;&#x5982;&#x4E0B;:</p>
<pre class="language-"><code class="lang-sh">start_thread 
ovsthread_wrapper 
pmd_thread_main 
  <span class="token comment">#&#x4E00;&#x4E2A;core&#x53EF;&#x4EE5;poll&#x591A;&#x4E2A;rxq </span>
  poll_cnt <span class="token operator">=</span> pmd_load_queues_and_ports<span class="token punctuation">(</span>pmd, <span class="token operator">&amp;</span>poll_list<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> poll_cnt<span class="token punctuation">;</span> i++<span class="token punctuation">)</span> 
    dp_netdev_process_rxq_port<span class="token punctuation">(</span>pmd, poll_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>.rxq,poll_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>.port_no<span class="token punctuation">)</span> 
        <span class="token comment">#&#x62A5;&#x6587;&#x662F;&#x653E;&#x5728;&#x8FD9;&#x91CC;&#x7684; </span>
        struct dp_packet_batch batch<span class="token punctuation">;</span> 
        dp_packet_batch_init<span class="token punctuation">(</span><span class="token operator">&amp;</span>batch<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">#&#x5148;&#x6536;&#x5305; </span>
        netdev_rxq_recv<span class="token punctuation">(</span>rxq-<span class="token operator">&gt;</span>rx, <span class="token operator">&amp;</span>batch<span class="token punctuation">)</span> 
            netdev_dpdk_rxq_recv 
                netdev_dpdk_vhost_rxq_recv 
                    <span class="token comment">#&#x5360;&#x6BD4;&#x6700;&#x9AD8;, 22.36% </span>
                    rte_vhost_dequeue_burst 
        <span class="token comment">#&#x518D;&#x8F6C;&#x53D1;, &#x4EA4;&#x6362;&#x673A;&#x7684;&#x57FA;&#x672C;&#x903B;&#x8F91; </span>
        dp_netdev_input<span class="token punctuation">(</span>pmd, <span class="token operator">&amp;</span>batch, port_no<span class="token punctuation">)</span> 
            <span class="token comment">#emc&#x662F;exact match cache:pmd-&gt;flow_cache </span>
            emc_processing 
                <span class="token comment">#&#x5BF9;&#x6BCF;&#x4E2A;packet&#x6267;&#x884C; </span>
                    pkt_metadata_init 
                    <span class="token comment">#&#x89E3;&#x6790;&#x62A5;&#x6587;, &#x89E3;&#x6790;&#x7C7B;&#x4F3C;&#x4E94;&#x5143;&#x7EC4;&#x7684;&#x4FE1;&#x606F; </span>
                    <span class="token comment">#&#x8FD9;&#x4E2A;&#x5360;&#x6BD4;&#x7B2C;&#x4E09;&#x9AD8;, 14% </span>
                    miniflow_extract 
                    <span class="token comment">#&#x53EA;&#x6709;&#x4ECE;vhostuser&#x6536;&#x5305;&#x624D;&#x6709;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;, &#x5360;&#x6BD4;11%, &#x53EF;&#x4EE5;&#x4F18;&#x5316;&#x5417;???? </span>
                    <span class="token comment">#x86&#x6709;SSE4&#x4F18;&#x5316; </span>
                    miniflow_hash_5tuple 
                    <span class="token comment">#&#x5728;flow cache&#x91CC;&#x67E5;&#x627E;key(&#x7531;miniflow_extract&#x5F97;&#x6765;), &#x7528;memcmp;  </span>
                    flow <span class="token operator">=</span> emc_lookup<span class="token punctuation">(</span>flow_cache, key<span class="token punctuation">)</span> 
            fast_path_processing 
                <span class="token comment">#&#x591A;&#x6D41;(L2&#x6216;L3&#x53D8;&#x5316;)&#x7684;&#x65F6;&#x5019;, &#x8BE5;&#x51FD;&#x6570;&#x5360;&#x6BD4;&#x6700;&#x9AD8; </span>
                dpcls_lookup 
            packet_batch_per_flow_execute 
        dp_netdev_pmd_flush_output_packets<span class="token punctuation">(</span>pmd, <span class="token boolean">false</span><span class="token punctuation">)</span> 
            dp_netdev_pmd_flush_output_on_port 
                netdev_send 
                    netdev_dpdk_eth_send 
                        <span class="token comment">#&#x8BE5;&#x51FD;&#x6570;&#x5355;&#x6761;&#x6D41;&#x65F6;&#x5360;&#x6BD4;10% </span>
                        mlx5_tx_burst_mpw
</code></pre>
<h1 id="buffer&#x5230;&#x5E95;&#x591A;&#x5927;"><a name="buffer&#x5230;&#x5E95;&#x591A;&#x5927;" class="anchor-navigation-ex-anchor" href="#buffer&#x5230;&#x5E95;&#x591A;&#x5927;"><i class="fa fa-link" aria-hidden="true"></i></a>8. buffer&#x5230;&#x5E95;&#x591A;&#x5927;</h1>
<p>&#x53C2;&#x8003;: <a href="https://developers.redhat.com/blog/2018/03/16/ovs-dpdk-hugepage-memory/" target="_blank">https://developers.redhat.com/blog/2018/03/16/ovs-dpdk-hugepage-memory/</a></p>
<p>&#x540C;&#x4E00;&#x4E2A;numa&#x4E0A;&#x7684;ports&#x53EF;&#x4EE5;&#x5171;&#x4EAB;mem pool, &#x4F46;&#x53D7;&#x591A;&#x65B9;&#x9762;&#x56E0;&#x7D20;&#x5F71;&#x54CD;, &#x4F8B;&#x5982;&#x4E24;&#x4E2A;&#x7269;&#x7406;dpdk port, &#x540C;&#x5728;&#x4E00;&#x4E2A;numa&#x4E0A;, MTU&#x90FD;&#x662F;1500, &#x90A3;&#x5F88;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x5728;&#x4E00;&#x4E2A;mem pool&#x91CC;.<br>mem pool&#x4E00;&#x822C;&#x662F;&#x9884;&#x5148;&#x5206;&#x597D;&#x7684;, &#x6BD4;&#x5982;</p>
<pre class="language-"><code class="lang-sh"><span class="token comment">#MTU&#x662F;1500&#x65F6;: </span>
Total size per buffer <span class="token operator">=</span> <span class="token number">3008</span> Bytes 
<span class="token comment">#MTU&#x662F;9000&#x65F6;: </span>
Total size per buffer <span class="token operator">=</span> <span class="token number">10176</span> Bytes
</code></pre>
<p>&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;, OVS&#x9884;&#x5148;&#x7533;&#x8BF7;256k&#x4E2A;buffer, &#x90A3;&#x4E48;</p>
<pre class="language-"><code class="lang-sh"><span class="token comment">#MTU&#x662F;1500&#x65F6;: </span>
Size of requested mempool <span class="token operator">=</span> <span class="token number">3008</span> Bytes * 256K 
Size of requested mempool <span class="token operator">=</span> <span class="token number">788</span> MBytes 
<span class="token comment">#MTU&#x662F;9000&#x65F6;: </span>
Size of requested mempool <span class="token operator">=</span> <span class="token number">10176</span> Bytes * 256K 
Size of requested mempool <span class="token operator">=</span> <span class="token number">2668</span> MBytes 
<span class="token comment">#&#x90A3;&#x4E48;OVS&#x4E00;&#x5171;&#x8981;&#x5206;: </span>
Size of mempools <span class="token operator">=</span> <span class="token number">788</span> MBytes + <span class="token number">2668</span> MBytes 
Size of mempools <span class="token operator">=</span> <span class="token number">3456</span> MBytes 

<span class="token comment">#&#x521D;&#x59CB;&#x5316;&#x65F6; </span>
ovs-vsctl --no-wait <span class="token builtin class-name">set</span> Open_vSwitch <span class="token builtin class-name">.</span> other_config:dpdk-socket-mem<span class="token operator">=</span><span class="token number">4096,4096</span>
</code></pre>
<p><img src="img/OVS_&#x67B6;&#x6784;&#x548C;&#x4EE3;&#x7801;_20220928233409.png" alt="">  </p>
<h1 id="datapath"><a name="datapath" class="anchor-navigation-ex-anchor" href="#datapath"><i class="fa fa-link" aria-hidden="true"></i></a>9. datapath</h1>
<p>OVS&#x6709;&#x4E24;&#x79CD;datapath: kernel datapath&#x548C;userspace datapath:
<img src="img/OVS_&#x67B6;&#x6784;&#x548C;&#x4EE3;&#x7801;_20220928233445.png" alt="">  </p>
<h2 id="kernel-datapath"><a name="kernel-datapath" class="anchor-navigation-ex-anchor" href="#kernel-datapath"><i class="fa fa-link" aria-hidden="true"></i></a>9.1. kernel datapath</h2>
<p>&#x9ED8;&#x8BA4;&#x5373;kernel datapath, &#x4F7F;&#x7528;&#x5185;&#x6838;&#x6A21;&#x5757;<code>openvswitch.ko</code></p>
<ul>
<li>&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x5728;lib/dpif-netlink.c  <blockquote>
<p>When a packet arrives on a vport, the kernel module processes it by extracting its flow key and looking it up in the flow table. If there is a matching flow, it executes the associated actions. If there is no match, it queues the packet to userspace for processing (as part of its processing, userspace will likely set up a flow to handle further packets of the same type entirely in-kernel).</p>
</blockquote>
</li>
<li>kernel datapath&#x6846;&#x56FE;<br><img src="img/OVS_&#x67B6;&#x6784;&#x548C;&#x4EE3;&#x7801;_20220928233612.png" alt="">  </li>
</ul>
<h2 id="userspace-datapath"><a name="userspace-datapath" class="anchor-navigation-ex-anchor" href="#userspace-datapath"><i class="fa fa-link" aria-hidden="true"></i></a>9.2. userspace datapath</h2>
<p>&#x5728;&#x521B;&#x5EFA;bridge&#x7684;&#x65F6;&#x5019;, &#x52A0;&#x9009;&#x9879;<code>datapath_type=netdev</code>, &#x5C31;&#x6253;&#x5F00;&#x4E86;userspace&#x6A21;&#x5F0F;</p>
<ul>
<li>&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x5728;lib/dpif-netdev.c</li>
<li>userspace datapath&#x67B6;&#x6784;&#x56FE;<br><img src="img/OVS_&#x67B6;&#x6784;&#x548C;&#x4EE3;&#x7801;_20220928233728.png" alt="">  </li>
</ul>
<h2 id="architecure"><a name="architecure" class="anchor-navigation-ex-anchor" href="#architecure"><i class="fa fa-link" aria-hidden="true"></i></a>9.3. Architecure</h2>
<pre class="language-"><code>           _ 
          |   +-------------------+ 
          |   |    ovs-vswitchd   |<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>--</span><span class="token punctuation">&gt;</span></span>ovsdb-server 
          |   +-------------------+ 
          |   |      ofproto      |<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>--</span><span class="token punctuation">&gt;</span></span>OpenFlow controllers 
          |   +--------+-+--------+  _ 
          |   | netdev | |ofproto-|   | 
userspace |   +--------+ |  dpif  |   | 
          |   | netdev | +--------+   | 
          |   |provider| |  dpif  |   | 
          |   +---||---+ +--------+   | 
          |       ||     |  dpif  |   | implementation of 
          |       ||     |provider|   | ofproto provider 
          |_      ||     +---||---+   | 
                  ||         ||       | 
           _  +---||-----+---||---+   | 
          |   |          |datapath|   | 
   kernel |   |          +--------+  _| 
          |   |                   | 
          |_  +--------||---------+ 
                       || 
                    physical 
                       NIC
</code></pre><h1 id="vport&#x7C7B;&#x578B;"><a name="vport&#x7C7B;&#x578B;" class="anchor-navigation-ex-anchor" href="#vport&#x7C7B;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>10. vport&#x7C7B;&#x578B;</h1>
<h2 id="netdev"><a name="netdev" class="anchor-navigation-ex-anchor" href="#netdev"><i class="fa fa-link" aria-hidden="true"></i></a>10.1. netdev</h2>
<pre class="language-"><code>.send = dev_queue_xmit
</code></pre><p>dev_queue_xmit(skb) will transmit the packet on a physical network device eventually</p>
<h2 id="internal"><a name="internal" class="anchor-navigation-ex-anchor" href="#internal"><i class="fa fa-link" aria-hidden="true"></i></a>10.2. internal</h2>
<pre class="language-"><code>.send = internal_dev_recv
</code></pre><p>the send method will call netif_rx(skb) insert the skb into TCP/IP stack, and packet will eventually be transmitted by stack</p>
<h2 id="patch"><a name="patch" class="anchor-navigation-ex-anchor" href="#patch"><i class="fa fa-link" aria-hidden="true"></i></a>10.3. patch</h2>
<pre class="language-"><code>.send = patch_send()
</code></pre><p>the send method will just pass the skb pointer to the peer vport</p>
<h2 id="tunnel-vports-vxlan-gre-etc"><a name="tunnel-vports-vxlan-gre-etc" class="anchor-navigation-ex-anchor" href="#tunnel-vports-vxlan-gre-etc"><i class="fa fa-link" aria-hidden="true"></i></a>10.4. tunnel vports: vxlan, gre, etc</h2>
<p>tunnel xmit method in kernel, e.g. .send = vxlan_xmit for vxlan</p>
<h1 id="&#x7528;&#x6237;&#x6001;&#x901A;&#x8FC7;&#x7269;&#x7406;&#x53E3;&#x53D1;&#x5305;&#x6D41;&#x7A0B;"><a name="&#x7528;&#x6237;&#x6001;&#x901A;&#x8FC7;&#x7269;&#x7406;&#x53E3;&#x53D1;&#x5305;&#x6D41;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#&#x7528;&#x6237;&#x6001;&#x901A;&#x8FC7;&#x7269;&#x7406;&#x53E3;&#x53D1;&#x5305;&#x6D41;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>11. &#x7528;&#x6237;&#x6001;&#x901A;&#x8FC7;&#x7269;&#x7406;&#x53E3;&#x53D1;&#x5305;&#x6D41;&#x7A0B;</h1>
<p>&#x5F53;&#x4F7F;&#x7528;ovs&#x521B;&#x5EFA;&#x7684;bridge&#x914D;&#x7F6E;&#x6210;&#x7528;&#x6237;&#x6001;datapath&#x6A21;&#x5F0F;&#x65F6;(datapath_type=netdev), &#x628A;&#x7269;&#x7406;&#x53E3;&#x6DFB;&#x52A0;&#x5230;ovs&#x4E0A;:</p>
<pre class="language-"><code>sudo ovs-vsctl del-port ovsbr0 enP5p1s0
</code></pre><p><img src="img/OVS_&#x67B6;&#x6784;&#x548C;&#x4EE3;&#x7801;_20220928234401.png" alt="">  </p>
<p>&#x53D1;&#x73B0;vm01(5.5.5.44)&#x662F;ping&#x4E0D;&#x901A;host B(5.5.5.22)&#x7684;, &#x4F46;&#x53EF;&#x4EE5;ping&#x901A;&#x5BF9;&#x7AEF;host A(5.5.5.11)</p>
<h2 id="&#x4F7F;&#x7528;perf&#x6293;&#x5173;&#x952E;&#x8DEF;&#x5F84;"><a name="&#x4F7F;&#x7528;perf&#x6293;&#x5173;&#x952E;&#x8DEF;&#x5F84;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;perf&#x6293;&#x5173;&#x952E;&#x8DEF;&#x5F84;"><i class="fa fa-link" aria-hidden="true"></i></a>11.1. &#x4F7F;&#x7528;perf&#x6293;&#x5173;&#x952E;&#x8DEF;&#x5F84;</h2>
<p>&#x91CD;&#x70B9;&#x5173;&#x6CE8;<code>lib/netdev-linux.c</code>&#x91CC;&#x9762;&#x7684;<code>netdev_linux_send()</code>&#x51FD;&#x6570;, &#x5728;Host B&#x4E0A;&#x9762;&#x6293;ovs-vswitchd&#x7684;&#x8C03;&#x7528;&#x8DEF;&#x5F84;.</p>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x56DE;&#x987E;&#x4E00;&#x4E0B;perf probe&#x7528;&#x6CD5;: &#x89E3;&#x6790;&#x7B26;&#x53F7;&#x8868; </span>
perf probe <span class="token parameter variable">-x</span> /lib64/libibverbs.so.1 <span class="token parameter variable">-F</span> 
perf probe <span class="token parameter variable">-x</span> <span class="token variable"><span class="token variable">`</span><span class="token function">which</span> ovs-vswitchd<span class="token variable">`</span></span> <span class="token parameter variable">-F</span> <span class="token operator">|</span> <span class="token function">grep</span> ibv 
<span class="token comment">#&#x7ED3;&#x5408;&#x4EE3;&#x7801;, &#x52A0;&#x52A8;&#x6001;probe&#x70B9; </span>
<span class="token function">sudo</span> perf probe <span class="token parameter variable">-x</span> <span class="token variable"><span class="token variable">`</span><span class="token function">which</span> ovs-vswitchd<span class="token variable">`</span></span> <span class="token parameter variable">--add</span> netdev_linux_send 
<span class="token function">sudo</span> perf probe <span class="token parameter variable">-x</span> <span class="token variable"><span class="token variable">`</span><span class="token function">which</span> ovs-vswitchd<span class="token variable">`</span></span> <span class="token parameter variable">--add</span> wrap_sendmmsg 
<span class="token comment">#&#x5F00;&#x59CB;&#x6293;&#x8C03;&#x7528;, 30&#x79D2;. </span>
<span class="token function">sudo</span> perf record <span class="token parameter variable">-e</span> probe_ovs:netdev_linux_send <span class="token parameter variable">-e</span> probe_ovs:wrap_sendmmsg <span class="token parameter variable">-e</span> net:net_dev_start_xmit <span class="token parameter variable">-p</span> <span class="token number">3470</span> <span class="token parameter variable">-g</span> <span class="token parameter variable">-o</span> perf-ping22.data -- <span class="token function">sleep</span> <span class="token number">30</span> 
<span class="token comment">#&#x5206;&#x6790;&#x7ED3;&#x679C; </span>
<span class="token function">sudo</span> perf report <span class="token parameter variable">-i</span> perf-no-ping.data <span class="token parameter variable">-n</span>
</code></pre>
<ul>
<li><p>Vm01 &#x4E0A;&#x4E0D;ping&#x4EFB;&#x4F55;IP<br>&#x7ED3;&#x679C;:&#x6CA1;&#x6709;&#x91C7;&#x6837;--&#x6B63;&#x5E38;</p>
</li>
<li><p>Vm01 ping Host A&#x573A;&#x666F;<br>&#x5728;Vm01&#x4E0A;:ping -f 5.5.5.11
&#x7ED3;&#x679C;:<br>netdev_linux_send&#x548C;wrap_sendmmsg&#x90FD;&#x6709;99K&#x6B21;&#x6570;&#x88AB;&#x91C7;&#x6837;&#x5230;:<br>&#x7ED3;&#x5408;&#x4EE3;&#x7801;, &#x8C03;&#x7528;&#x8DEF;&#x5F84;&#x5982;&#x4E0B;:  </p>
<pre class="language-"><code class="lang-sh">start_thread 
ovsthread_wrapper 
pmd_thread_main 
dp_netdev_process_rxq_port 
  <span class="token comment">#&#x5148;&#x6536;&#x5305; </span>
  netdev_rxq_recv 
  <span class="token comment">#&#x518D;&#x8F6C;&#x53D1;, &#x4EA4;&#x6362;&#x673A;&#x7684;&#x57FA;&#x672C;&#x903B;&#x8F91; </span>
  dp_netdev_input 
      packet_batch_per_flow_execute 
          dp_netdev_execute_actions 
          dp_execute_cb 
              <span class="token keyword">case</span> OVS_ACTION_ATTR_OUTPUT: 
              netdev_send 
                  netdev_linux_send 
                      <span class="token comment">#&#x4F7F;&#x7528;AF_PACKET socket, &#x76F4;&#x63A5;pypass&#x6389;ip&#x534F;&#x8BAE;&#x6808; </span>
                      sock <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_PACKET, SOCK_RAW, <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                      int ifindex <span class="token operator">=</span> netdev_get_ifindex<span class="token punctuation">(</span>netdev_<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                      netdev_linux_sock_batch_send<span class="token punctuation">(</span>sock, ifindex, batch<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                          sendmsg 
                          ---------- 
                          <span class="token comment">#kernel space </span>
                          sock_sendmsg 
                          packet_sendmsg 
                          packet_snd.isra.64 
                          dev_queue_xmit 
                          sch_direct_xmit 
                          dev_hard_start_xmit
</code></pre>
</li>
<li><p>Vm01 ping Host B&#x573A;&#x666F;<br>&#x5728;Vm01&#x4E0A;:ping -f 5.5.5.22<br>&#x7ED3;&#x679C;:<br>&#x91C7;&#x6837;&#x6B21;&#x6570;&#x6BD4;&#x4E0A;&#x4E2A;&#x573A;&#x666F;&#x5C11;&#x5F88;&#x591A;, &#x56E0;&#x4E3A;&#x53D1;&#x5305;&#x5C11;&#x5F88;&#x591A;, &#x8FDB;&#x4E00;&#x6B65;&#x8BB2;, ping&#x4E00;&#x76F4;&#x7B49;&#x4E0D;&#x5230;&#x56DE;&#x5E94;, &#x8D85;&#x65F6;&#x4E86;&#x624D;&#x53D1;&#x4E0B;&#x4E00;&#x4E2A;.<br>&#x57FA;&#x672C;&#x8DEF;&#x5F84;&#x548C;&#x4E0A;&#x4E00;&#x4E2A;&#x573A;&#x666F;&#x4E00;&#x6837;; &#x4F46;&#x6709;&#x65F6;&#x4F1A;&#x6293;&#x5230;&#x53E6;&#x4E00;&#x79CD;&#x8DEF;&#x5F84;:</p>
<pre class="language-"><code>_start 
__libc_start_main 
main 
bridge_run 
bridge_run__ 
ofproto_type_run 
type_run 
dpif_netdev_run 
dp_netdev_process_rxq_port 
dp_netdev_input__ 
fast_path_processing 
odp_execute_actions 
dp_execute_cb 
netdev_linux_send
</code></pre></li>
</ul>
<h2 id="&#x7ED3;&#x8BBA;"><a name="&#x7ED3;&#x8BBA;" class="anchor-navigation-ex-anchor" href="#&#x7ED3;&#x8BBA;"><i class="fa fa-link" aria-hidden="true"></i></a>11.2. &#x7ED3;&#x8BBA;</h2>
<p>&#x5728;userspace datapath(datapath_type=netdev)&#x6A21;&#x5F0F;&#x4E0B;, <strong>ovs&#x901A;&#x8FC7;socket(AF_PACKET, SOCK_RAW, 0)&#x53D1;&#x5305;, &#x4E0D;&#x8D70;ip&#x534F;&#x8BAE;&#x6808;.</strong></p>
<p>&#x53C2;&#x8003;:
<a href="https://arthurchiao.github.io/blog/ovs-deep-dive-3-datapath/" target="_blank">https://arthurchiao.github.io/blog/ovs-deep-dive-3-datapath/</a>
<a href="https://github.com/openvswitch/ovs/blob/master/Documentation/topics/porting.rst" target="_blank">https://github.com/openvswitch/ovs/blob/master/Documentation/topics/porting.rst</a>
<a href="https://github.com/openvswitch/ovs/blob/master/Documentation/topics/datapath.rst" target="_blank">https://github.com/openvswitch/ovs/blob/master/Documentation/topics/datapath.rst</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="OVS_DPDK_编译运行.html" class="navigation navigation-prev " aria-label="Previous page: OVS-DPDK编译运行">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="OVS_DPDK_performance_HXT_ARM_server.html" class="navigation navigation-next " aria-label="Next page: OVS-DPDK for ARM server 性能测试环境">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"OVS架构和代码","level":"3.7.2.2","depth":3,"next":{"title":"OVS-DPDK for ARM server 性能测试环境","level":"3.7.2.3","depth":3,"path":"notes/OVS_DPDK_performance_HXT_ARM_server.md","ref":"notes/OVS_DPDK_performance_HXT_ARM_server.md","articles":[]},"previous":{"title":"OVS-DPDK编译运行","level":"3.7.2.1","depth":3,"path":"notes/OVS_DPDK_编译运行.md","ref":"notes/OVS_DPDK_编译运行.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-livereload","-sharing","-lunr","-search","search-plus","-highlight","theme-comscore","prism","code","chapter-fold","github","splitter","wide-page","hide-navigation-buttons","anchor-navigation-ex","sequence"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"chapter-fold":{},"prism":{"css":["prismjs/themes/prism.css"]},"sequence":{"theme":"simple"},"github":{"url":"https://github.com/Bai-Yingjie/Bai-Yingjie.github.io"},"splitter":{},"wide-page":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"hide-navigation-buttons":{},"anchor-navigation-ex":{"mode":"float","pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"isRewritePageTitle":true,"showLevel":true,"tocLevel1Icon":"fa fa-hand-o-right","tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right","showGoTop":true,"isShowTocTitleIcon":true,"printLog":false,"multipleH1":true,"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false}},"theme-comscore":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"search-plus":{}},"theme":"default","author":"Bai Yingjie","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"My Notes","language":"zh-hans","gitbook":"*"},"file":{"path":"notes/OVS_架构和代码.md","mtime":"2022-10-12T07:33:44.725Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-10-12T07:35:01.076Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

