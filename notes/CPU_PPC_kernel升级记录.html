
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>PPC kernel升级记录 · My Notes</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Bai Yingjie">
        
        
    
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-wide-page/wide.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hide-navigation-buttons/index.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-mermaid-gb3/mermaid/mermaid.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    


    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="as_title_cpu3.html" />
    
    
    <link rel="prev" href="CPU_PPC启动多核Linux_流程和内存映射.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="recent_topics.html">
            
                <a href="recent_topics.html">
            
                    
                    recent topics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="as_title_kaiyuan.html">
            
                <a href="as_title_kaiyuan.html">
            
                    
                    开源
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="my_opensource.html">
            
                <a href="my_opensource.html">
            
                    
                    我的开源项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="my_upstream.html">
            
                <a href="my_upstream.html">
            
                    
                    我的upstream commit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="as_title_system.html">
            
                <a href="as_title_system.html">
            
                    
                    系统分析和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="as_title_perf_misc.html">
            
                <a href="as_title_perf_misc.html">
            
                    
                    调试和分析记录系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="profiling_调试和分析记录5.html">
            
                <a href="profiling_调试和分析记录5.html">
            
                    
                    调试和分析记录5
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="profiling_调试和分析记录4.html">
            
                <a href="profiling_调试和分析记录4.html">
            
                    
                    调试和分析记录4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="profiling_调试和分析记录3.html">
            
                <a href="profiling_调试和分析记录3.html">
            
                    
                    调试和分析记录3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="profiling_调试和分析记录2.html">
            
                <a href="profiling_调试和分析记录2.html">
            
                    
                    调试和分析记录2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="profiling_调试和分析记录1.html">
            
                <a href="profiling_调试和分析记录1.html">
            
                    
                    调试和分析记录1
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="调试和分析工具概览.html">
            
                <a href="调试和分析工具概览.html">
            
                    
                    profiling和debugging工具相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="profiling_Linux内核调试的方式以及工具集锦.html">
            
                <a href="profiling_Linux内核调试的方式以及工具集锦.html">
            
                    
                    Linux内核调试的方式以及工具集锦(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="profiling_user_space_Ptrace_Utrace_Uprobes.html">
            
                <a href="profiling_user_space_Ptrace_Utrace_Uprobes.html">
            
                    
                    Ptrace, Utrace, Uprobes: Lightweight, Dynamic Tracing of User Apps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="debugging_gdb备忘录.html">
            
                <a href="debugging_gdb备忘录.html">
            
                    
                    gdb备忘录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="profiling_perf命令备忘录.html">
            
                <a href="profiling_perf命令备忘录.html">
            
                    
                    perf命令备忘录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5" data-path="profiling_perf命令备忘录2.html">
            
                <a href="profiling_perf命令备忘录2.html">
            
                    
                    perf命令备忘录2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.6" data-path="profiling_perf学习笔记之实战篇.html">
            
                <a href="profiling_perf学习笔记之实战篇.html">
            
                    
                    perf学习笔记之实战篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.7" data-path="profiling_perf学习笔记之入门篇.html">
            
                <a href="profiling_perf学习笔记之入门篇.html">
            
                    
                    perf学习笔记之入门篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.8" data-path="profiling_用kprobe和perf_记录函数参数.html">
            
                <a href="profiling_用kprobe和perf_记录函数参数.html">
            
                    
                    使用kprobe和perf结合记录函数参数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.9" data-path="profiling_ftrace和trace-cmd记录.html">
            
                <a href="profiling_ftrace和trace-cmd记录.html">
            
                    
                    ftrace和trace-cmd记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.10" data-path="profiling_ftrace使用实例.html">
            
                <a href="profiling_ftrace使用实例.html">
            
                    
                    ftrace使用实例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.11" data-path="profiling_systemtap实例.html">
            
                <a href="profiling_systemtap实例.html">
            
                    
                    systemtap实例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.12" data-path="profiling_systemtap基础.html">
            
                <a href="profiling_systemtap基础.html">
            
                    
                    systemtap基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.13" data-path="profiling_perf-tools_example.html">
            
                <a href="profiling_perf-tools_example.html">
            
                    
                    perf-tools 系统tracing工具集
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.14" data-path="profiling_Comparing_SystemTap_and_bpftrace.html">
            
                <a href="profiling_Comparing_SystemTap_and_bpftrace.html">
            
                    
                    Comparing SystemTap and bpftrace(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.15" data-path="system_analysis_bcc和ebpf.html">
            
                <a href="system_analysis_bcc和ebpf.html">
            
                    
                    bcc和ebpf(starting)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.16" data-path="profiling_valgrind体验.html">
            
                <a href="profiling_valgrind体验.html">
            
                    
                    体验valgrind
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="as_title_os_perf.html">
            
                <a href="as_title_os_perf.html">
            
                    
                    profiling和debugging实例
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="debugging_gshellos_socket_leak.html">
            
                <a href="debugging_gshellos_socket_leak.html">
            
                    
                    gshell socket leak调查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="profiling_调查ftrace显示调用栈全0问题.html">
            
                <a href="profiling_调查ftrace显示调用栈全0问题.html">
            
                    
                    调查ftrace显示调用栈全0问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="profiling_eoe_filter写tap设备失败问题.html">
            
                <a href="profiling_eoe_filter写tap设备失败问题.html">
            
                    
                    eoe_filter写tap设备失败问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.4" data-path="performance_ovs进程调查.html">
            
                <a href="performance_ovs进程调查.html">
            
                    
                    OVS进程调查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.5" data-path="performance_ping流程和函数调用解析.html">
            
                <a href="performance_ping流程和函数调用解析.html">
            
                    
                    ping流程和函数调用解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.6" data-path="profiling_VM互相ping场景下的延迟分析.html">
            
                <a href="profiling_VM互相ping场景下的延迟分析.html">
            
                    
                    VM互相ping场景下的延迟分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.7" data-path="debugging_ftrace_谁创建了bond0设备.html">
            
                <a href="debugging_ftrace_谁创建了bond0设备.html">
            
                    
                    谁创建了bond0设备: ftrace kprobe uprobe perf综合使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.8" data-path="profiling_unixbench之filecopy分析.html">
            
                <a href="profiling_unixbench之filecopy分析.html">
            
                    
                    unixbench之file copy分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.9" data-path="profiling_lmbench之lat_tcp分析.html">
            
                <a href="profiling_lmbench之lat_tcp分析.html">
            
                    
                    lmbench之lat_tcp分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="as_title_arch_perf.html">
            
                <a href="as_title_arch_perf.html">
            
                    
                    CPU ARCH相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="performance_CPU_microarchiteture_pmu.html">
            
                <a href="performance_CPU_microarchiteture_pmu.html">
            
                    
                    Top-down Microarchitecture Analysis Method(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="as_title_cloud.html">
            
                <a href="as_title_cloud.html">
            
                    
                    Cloud和容器相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="container_linux_namespaces.html">
            
                <a href="container_linux_namespaces.html">
            
                    
                    linux名字空间
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="cloud_杂记.html">
            
                <a href="cloud_杂记.html">
            
                    
                    云杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="container_当代容器读书笔记.html">
            
                <a href="container_当代容器读书笔记.html">
            
                    
                    当代容器读书笔记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="multi-arch_docker_binfmt_misc.html">
            
                <a href="multi-arch_docker_binfmt_misc.html">
            
                    
                    multi-arch docker 和 binfmt_misc
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="as_title_vdevice.html">
            
                <a href="as_title_vdevice.html">
            
                    
                    CPU和device虚拟化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="as_title_gvisor.html">
            
                <a href="as_title_gvisor.html">
            
                    
                    gvisor
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="golang_gvisor代码_KVM.html">
            
                <a href="golang_gvisor代码_KVM.html">
            
                    
                    gvisor KVM模式代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="golang_gvisor调试.html">
            
                <a href="golang_gvisor调试.html">
            
                    
                    gvisor调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="golang_gvisor_ptrace.html">
            
                <a href="golang_gvisor_ptrace.html">
            
                    
                    gvisor ptrace模式介绍(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="rust_vmm_brief.html">
            
                <a href="rust_vmm_brief.html">
            
                    
                    rust VMM(virtual machine monitor)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="rust_vmm_简介.html">
            
                <a href="rust_vmm_简介.html">
            
                    
                    rust-vmm简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="rust_firecracker_代码.html">
            
                <a href="rust_firecracker_代码.html">
            
                    
                    firecracker代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="rust_firecracker_使用.html">
            
                <a href="rust_firecracker_使用.html">
            
                    
                    firecracker使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="rust_cloud-hypervisor_代码.html">
            
                <a href="rust_cloud-hypervisor_代码.html">
            
                    
                    cloud hypervisor代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.5" data-path="rust_cloud-hypervisor_使用.html">
            
                <a href="rust_cloud-hypervisor_使用.html">
            
                    
                    cloud hypervisor使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.6" data-path="rust_cloud-hypervisor_问题与解决.html">
            
                <a href="rust_cloud-hypervisor_问题与解决.html">
            
                    
                    cloud hypervisor问题与解决
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.7" data-path="rust_virtiofsd_代码.html">
            
                <a href="rust_virtiofsd_代码.html">
            
                    
                    virtiofsd代码阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.8" data-path="rust_virtio_vhost_libs.html">
            
                <a href="rust_virtio_vhost_libs.html">
            
                    
                    vhost virtio相关的rust库
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="virtualization_virtio规范阅读笔记.html">
            
                <a href="virtualization_virtio规范阅读笔记.html">
            
                    
                    virtio规范阅读笔记.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="qemu_ovs_虚拟化环境.html">
            
                <a href="qemu_ovs_虚拟化环境.html">
            
                    
                    qemu OVS 虚拟化环境准备
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="qemu使用.html">
            
                <a href="qemu使用.html">
            
                    
                    Qemu使用(old)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="qemu_binary_translation.html">
            
                <a href="qemu_binary_translation.html">
            
                    
                    QEMU 指令翻译
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="as_title_networking.html">
            
                <a href="as_title_networking.html">
            
                    
                    计算机网络相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="networking_杂记2.html">
            
                <a href="networking_杂记2.html">
            
                    
                    networking杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="networking_杂记1.html">
            
                <a href="networking_杂记1.html">
            
                    
                    networking杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="networking_优化linux网络栈_接收路径.html">
            
                <a href="networking_优化linux网络栈_接收路径.html">
            
                    
                    优化linux网络栈: 接收路径(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="networking_优化linux网络栈_发送路径.html">
            
                <a href="networking_优化linux网络栈_发送路径.html">
            
                    
                    优化linux网络栈: 发送路径(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="networking_Potential_Performance_Bottleneck_in_Linux_TCP.html">
            
                <a href="networking_Potential_Performance_Bottleneck_in_Linux_TCP.html">
            
                    
                    Potential Performance Bottleneck in Linux TCP(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="networking_xdp入门.html">
            
                <a href="networking_xdp入门.html">
            
                    
                    Get started with XDP(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="networking_linux收包路径图解.html">
            
                <a href="networking_linux收包路径图解.html">
            
                    
                    linux收包路径图解(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="vpp_compiling_on_alpine.md">
            
                <span>
            
                    
                    alpine编译vpp
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.8.1" data-path="vpp_host_interace.html">
            
                <a href="vpp_host_interace.html">
            
                    
                    vpp的host-interface
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="as_title_qemu_ovs.html">
            
                <a href="as_title_qemu_ovs.html">
            
                    
                    Qemu OVS和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.9.1" data-path="OVS_DPDK_编译运行.html">
            
                <a href="OVS_DPDK_编译运行.html">
            
                    
                    OVS-DPDK编译运行
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.2" data-path="OVS_架构和代码.html">
            
                <a href="OVS_架构和代码.html">
            
                    
                    OVS架构和代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.3" data-path="OVS_DPDK_performance_HXT_ARM_server.html">
            
                <a href="OVS_DPDK_performance_HXT_ARM_server.html">
            
                    
                    OVS-DPDK for ARM server 性能测试环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.4" data-path="DPDK_Mellanox.html">
            
                <a href="DPDK_Mellanox.html">
            
                    
                    DPDK Mellanox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.5" data-path="OVS_phy-vm-phy.html">
            
                <a href="OVS_phy-vm-phy.html">
            
                    
                    OVS PHY-VM-PHY
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.6" data-path="networking_网络虚拟化用例记录.html">
            
                <a href="networking_网络虚拟化用例记录.html">
            
                    
                    网络虚拟化用例记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.7" data-path="networking_网络虚拟化操作记录.html">
            
                <a href="networking_网络虚拟化操作记录.html">
            
                    
                    网络虚拟化操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="as_title_virtnet.html">
            
                <a href="as_title_virtnet.html">
            
                    
                    虚拟化网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.10.1" data-path="networking_tc_filter_连接veth和tap.html">
            
                <a href="networking_tc_filter_连接veth和tap.html">
            
                    
                    Connecting a veth device to tap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10.2" data-path="networking_multicast_vxlan_flannel.html">
            
                <a href="networking_multicast_vxlan_flannel.html">
            
                    
                    multicast vxlan和flannel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10.3" data-path="networking_virtio网络介绍.html">
            
                <a href="networking_virtio网络介绍.html">
            
                    
                    virtio网络介绍(网摘): vhost-net virtio-net vhost-user SRIOV
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10.4" data-path="networking_virtualization_杂记.html">
            
                <a href="networking_virtualization_杂记.html">
            
                    
                    虚拟化网络杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10.5" data-path="networking_linux虚拟网络接口.html">
            
                <a href="networking_linux虚拟网络接口.html">
            
                    
                    linux虚拟网络接口(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="as_title_arm_server.html">
            
                <a href="as_title_arm_server.html">
            
                    
                    ARM server
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="arm_server_杂记.html">
            
                <a href="arm_server_杂记.html">
            
                    
                    Arm server 杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="server_知识点.html">
            
                <a href="server_知识点.html">
            
                    
                    server知识点
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="as_title_embedded.html">
            
                <a href="as_title_embedded.html">
            
                    
                    嵌入式系统开发调试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="embedded_debugging.html">
            
                <a href="embedded_debugging.html">
            
                    
                    嵌入式调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="uboot_杂记.html">
            
                <a href="uboot_杂记.html">
            
                    
                    uboot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="buildroot_杂记.html">
            
                <a href="buildroot_杂记.html">
            
                    
                    buildroot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="toolchain_升级gcc问题解决.html">
            
                <a href="toolchain_升级gcc问题解决.html">
            
                    
                    升级GCC7.3问题解决
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="kernel_异常打印分析实例.html">
            
                <a href="kernel_异常打印分析实例.html">
            
                    
                    kernel bug异常打印分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="as_title_linuxdaily.html">
            
                <a href="as_title_linuxdaily.html">
            
                    
                    Linux工程实践
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="linux_日常使用.html">
            
                <a href="linux_日常使用.html">
            
                    
                    日常linux使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="git_日常使用.html">
            
                <a href="git_日常使用.html">
            
                    
                    日常git使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="向kernel提交补丁.html">
            
                <a href="向kernel提交补丁.html">
            
                    
                    向kernel提交补丁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="linux_ssh_relay.html">
            
                <a href="linux_ssh_relay.html">
            
                    
                    ssh relay
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="gitlab_ci.html">
            
                <a href="gitlab_ci.html">
            
                    
                    gitlab CI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="docker_操作记录.html">
            
                <a href="docker_操作记录.html">
            
                    
                    docker操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="centos_操作记录.html">
            
                <a href="centos_操作记录.html">
            
                    
                    centos操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="as_title_golang.html">
            
                <a href="as_title_golang.html">
            
                    
                    Golang
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="as_title_golang1.html">
            
                <a href="as_title_golang1.html">
            
                    
                    入门
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1.1" data-path="golang_语法基础.html">
            
                <a href="golang_语法基础.html">
            
                    
                    Golang 语法基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.2" data-path="golang_json性能.html">
            
                <a href="golang_json性能.html">
            
                    
                    Golang json性能比较
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="golang_原理.html">
            
                <a href="golang_原理.html">
            
                    
                    Golang 原理相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.1" data-path="golang_interface原理.html">
            
                <a href="golang_interface原理.html">
            
                    
                    Golang interface原理(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.2" data-path="golang_内存分配.html">
            
                <a href="golang_内存分配.html">
            
                    
                    Golang 内存分配(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="golang_标准库.html">
            
                <a href="golang_标准库.html">
            
                    
                    Golang 标准库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="golang_泛型.html">
            
                <a href="golang_泛型.html">
            
                    
                    Golang 泛型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="golang_我的反射代码.html">
            
                <a href="golang_我的反射代码.html">
            
                    
                    Golang 我的反射代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="golang_问答.html">
            
                <a href="golang_问答.html">
            
                    
                    Golang 问答
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="golang_plugin.html">
            
                <a href="golang_plugin.html">
            
                    
                    Golang plugin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="golang_高效go.html">
            
                <a href="golang_高效go.html">
            
                    
                    Golang 高效go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="golang_进阶.html">
            
                <a href="golang_进阶.html">
            
                    
                    Golang 进阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10" data-path="as_title_golang2.html">
            
                <a href="as_title_golang2.html">
            
                    
                    Golang 杂记
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.10.1" data-path="golang_杂记1.html">
            
                <a href="golang_杂记1.html">
            
                    
                    Golang 杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.2" data-path="golang_杂记2.html">
            
                <a href="golang_杂记2.html">
            
                    
                    Golang 杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.3" data-path="golang_杂记3.html">
            
                <a href="golang_杂记3.html">
            
                    
                    Golang 杂记3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.4" data-path="golang_lib选型.html">
            
                <a href="golang_lib选型.html">
            
                    
                    Golang lib选型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.5" data-path="golang_mod_proxy.html">
            
                <a href="golang_mod_proxy.html">
            
                    
                    go mod和go proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.6" data-path="golang_汇编_arm64.html">
            
                <a href="golang_汇编_arm64.html">
            
                    
                    Golang 汇编语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.7" data-path="golang_cgo_swig.html">
            
                <a href="golang_cgo_swig.html">
            
                    
                    go调用c可以用swig
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.11" data-path="as_title_golang3.html">
            
                <a href="as_title_golang3.html">
            
                    
                    Golang 环境和工具链生成
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.11.1" data-path="golang_toolchain_ppc.html">
            
                <a href="golang_toolchain_ppc.html">
            
                    
                    go tools增加ppc32支持
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.2" data-path="golang_toolchain_compile_gccgo.html">
            
                <a href="golang_toolchain_compile_gccgo.html">
            
                    
                    编译gccgo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.3" data-path="golang_go_on_mips.html">
            
                <a href="golang_go_on_mips.html">
            
                    
                    go on mips boards(not so updated)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.11.3.1" data-path="golang_go_on_mips_part1.html">
            
                <a href="golang_go_on_mips_part1.html">
            
                    
                    part 1: cross compile go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.3.2" data-path="golang_go_on_mips_part2.html">
            
                <a href="golang_go_on_mips_part2.html">
            
                    
                    part 2: build native go compiler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.3.3" data-path="golang_go_on_mips_part3.html">
            
                <a href="golang_go_on_mips_part3.html">
            
                    
                    part 3: gccgo experiments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.3.4" data-path="golang_go_on_mips_part4.html">
            
                <a href="golang_go_on_mips_part4.html">
            
                    
                    part 4: Golang json performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.3.5" data-path="golang_gentoo_on_mips_board_and_build_go.html">
            
                <a href="golang_gentoo_on_mips_board_and_build_go.html">
            
                    
                    Gentoo on mips board and build go
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.12" data-path="as_title_golang4.html">
            
                <a href="as_title_golang4.html">
            
                    
                    微服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.12.1" data-path="golang_micro.html">
            
                <a href="golang_micro.html">
            
                    
                    go-micro和micro
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12.2" data-path="golang_微服务概念.html">
            
                <a href="golang_微服务概念.html">
            
                    
                    微服务概念
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.13" data-path="as_title_golang5.html">
            
                <a href="as_title_golang5.html">
            
                    
                    解释器和编解码
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.13.1" data-path="golang_yeagi.html">
            
                <a href="golang_yeagi.html">
            
                    
                    解释器yeagi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.2" data-path="golang_tengo.html">
            
                <a href="golang_tengo.html">
            
                    
                    解释器tengo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.3" data-path="golang_govaluate.html">
            
                <a href="golang_govaluate.html">
            
                    
                    解释器govaluate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.4" data-path="golang_encoding_gotiny.html">
            
                <a href="golang_encoding_gotiny.html">
            
                    
                    gotiny编解码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.5" data-path="golang_abs.html">
            
                <a href="golang_abs.html">
            
                    
                    解释器abs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.14" data-path="as_title_golang6.html">
            
                <a href="as_title_golang6.html">
            
                    
                    调试和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.14.1" data-path="golang_调试记录.html">
            
                <a href="golang_调试记录.html">
            
                    
                    Golang 调试记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.14.2" data-path="golang_topid性能优化.html">
            
                <a href="golang_topid性能优化.html">
            
                    
                    Golang topid性能优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.14.3" data-path="golang_gshell性能调试.html">
            
                <a href="golang_gshell性能调试.html">
            
                    
                    Golang gshell性能调试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.15" data-path="as_title_golang7.html">
            
                <a href="as_title_golang7.html">
            
                    
                    网络和消息中间件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.15.1" data-path="golang_zmq.html">
            
                <a href="golang_zmq.html">
            
                    
                    消息中间件基本概念和zero mq
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.15.2" data-path="golang_mango.html">
            
                <a href="golang_mango.html">
            
                    
                    消息中间件mango
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.15.3" data-path="golang_libp2p.html">
            
                <a href="golang_libp2p.html">
            
                    
                    Golang p2p网络
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="as_title_rust.html">
            
                <a href="as_title_rust.html">
            
                    
                    Rust
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="rust_入门_brief.html">
            
                <a href="rust_入门_brief.html">
            
                    
                    Rust 入门系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1.1" data-path="rust_books.html">
            
                <a href="rust_books.html">
            
                    
                    Rust reference books
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.2" data-path="rust_入门1.html">
            
                <a href="rust_入门1.html">
            
                    
                    Rust 安装和基础语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.3" data-path="rust_入门2.html">
            
                <a href="rust_入门2.html">
            
                    
                    Rust 泛型和内存所有权
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.4" data-path="rust_入门3.html">
            
                <a href="rust_入门3.html">
            
                    
                    Rust 闭包 容器 迭代器 生成器 线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.5" data-path="rust_工程构建.html">
            
                <a href="rust_工程构建.html">
            
                    
                    Rust 工程构建
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="rust_coding_brief.html">
            
                <a href="rust_coding_brief.html">
            
                    
                    Rust 代码积累
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.2.1" data-path="rust_by_example_misc.html">
            
                <a href="rust_by_example_misc.html">
            
                    
                    Rust by example杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.2" data-path="rust_序列化.html">
            
                <a href="rust_序列化.html">
            
                    
                    Rust 序列化原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.3" data-path="rust_知识点积累.html">
            
                <a href="rust_知识点积累.html">
            
                    
                    Rust 知识点更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.4" data-path="rust_adaptiveservice.html">
            
                <a href="rust_adaptiveservice.html">
            
                    
                    rust版本的adaptiveservice探索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.5" data-path="rust_常用设施.html">
            
                <a href="rust_常用设施.html">
            
                    
                    Rust 常用设施
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.6" data-path="rust_代码小段.html">
            
                <a href="rust_代码小段.html">
            
                    
                    Rust 代码小段
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.7" data-path="rust_错误处理.html">
            
                <a href="rust_错误处理.html">
            
                    
                    Rust 错误处理(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="others.html">
            
                <a href="others.html">
            
                    
                    其他
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.3.1" data-path="rust_mdbook_使用.html">
            
                <a href="rust_mdbook_使用.html">
            
                    
                    Rust 使用mdbook
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="as_title_scripts.html">
            
                <a href="as_title_scripts.html">
            
                    
                    脚本
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="shell_变量.html">
            
                <a href="shell_变量.html">
            
                    
                    shell变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="shell_基础篇.html">
            
                <a href="shell_基础篇.html">
            
                    
                    shell命令和脚本记录-基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="shell_高级篇.html">
            
                <a href="shell_高级篇.html">
            
                    
                    shell命令和脚本记录-高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="shell_脚本片段.html">
            
                <a href="shell_脚本片段.html">
            
                    
                    shell脚本片段
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="python_记录.html">
            
                <a href="python_记录.html">
            
                    
                    python记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="lua_记录.html">
            
                <a href="lua_记录.html">
            
                    
                    lua记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="shell_rds脚本阅读.html">
            
                <a href="shell_rds脚本阅读.html">
            
                    
                    RDS脚本阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="Project_Euler.html">
            
                <a href="Project_Euler.html">
            
                    
                    Project Euler
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="as_title_app.html">
            
                <a href="as_title_app.html">
            
                    
                    应用相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="app_sysbench代码分析.html">
            
                <a href="app_sysbench代码分析.html">
            
                    
                    sysbench代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="as_title_algorithm.html">
            
                <a href="as_title_algorithm.html">
            
                    
                    算法相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="algorithm_radix_tree.html">
            
                <a href="algorithm_radix_tree.html">
            
                    
                    基数(radix)树(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="as_title_cos.html">
            
                <a href="as_title_cos.html">
            
                    
                    C和Operating System
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="system_libc_part1.html">
            
                <a href="system_libc_part1.html">
            
                    
                    libc概览1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="system_libc_part2.html">
            
                <a href="system_libc_part2.html">
            
                    
                    libc概览2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="system_libc_part3.html">
            
                <a href="system_libc_part3.html">
            
                    
                    libc概览3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4" data-path="system_原理杂记.html">
            
                <a href="system_原理杂记.html">
            
                    
                    系统原理杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.5" data-path="system_alpine.html">
            
                <a href="system_alpine.html">
            
                    
                    Alpine Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.6" data-path="system_进程间通信.html">
            
                <a href="system_进程间通信.html">
            
                    
                    进程间通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7" data-path="system_特殊功能fd.html">
            
                <a href="system_特殊功能fd.html">
            
                    
                    eventfd timerfd signalfd和fd共享
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.8" data-path="c_automake_autoconf.html">
            
                <a href="c_automake_autoconf.html">
            
                    
                    automake autoconf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.9" data-path="makefile_原理和实践.html">
            
                <a href="makefile_原理和实践.html">
            
                    
                    makefile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.10" data-path="c_编程杂记高级篇.html">
            
                <a href="c_编程杂记高级篇.html">
            
                    
                    C编程杂记高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.11" data-path="c_编程杂记基础篇.html">
            
                <a href="c_编程杂记基础篇.html">
            
                    
                    C编程杂记基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.12" data-path="c_networking_socket高阶用法.html">
            
                <a href="c_networking_socket高阶用法.html">
            
                    
                    网络编程: Advanced Socket Topics(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.13" data-path="c_protobuf介绍.html">
            
                <a href="c_protobuf介绍.html">
            
                    
                    序列化: protobuf介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.14" data-path="c_进程间通信_共享文件和共享内存.html">
            
                <a href="c_进程间通信_共享文件和共享内存.html">
            
                    
                    进程间通信: 共享文件和共享内存(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.15" data-path="c_pthread_condition和mutex.html">
            
                <a href="c_pthread_condition和mutex.html">
            
                    
                    并发 任务 事件 和锁.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.16" data-path="kernel_user_space_howto.html">
            
                <a href="kernel_user_space_howto.html">
            
                    
                    kernel space和user space交互(网摘, linux2.6)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.17" data-path="CentOS_系统性能优化配置.html">
            
                <a href="CentOS_系统性能优化配置.html">
            
                    
                    CentOS 性能优化系统配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.18" data-path="OS_gentoo使用.html">
            
                <a href="OS_gentoo使用.html">
            
                    
                    gentoo使用记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="as_title_driver.html">
            
                <a href="as_title_driver.html">
            
                    
                    内核 设备和驱动相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="device_driver_地址空间类型和DMA.html">
            
                <a href="device_driver_地址空间类型和DMA.html">
            
                    
                    地址空间类型和DMA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="platform_device_driver.html">
            
                <a href="platform_device_driver.html">
            
                    
                    平台驱动杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="platform_device_driver2.html">
            
                <a href="platform_device_driver2.html">
            
                    
                    平台驱动杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4" data-path="device_driver_pci驱动概述.html">
            
                <a href="device_driver_pci驱动概述.html">
            
                    
                    pci驱动概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.5" data-path="device_driver_内核中的时间和延迟操作.html">
            
                <a href="device_driver_内核中的时间和延迟操作.html">
            
                    
                    内核中的时间和延迟操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.6" data-path="device_driver_杂记.html">
            
                <a href="device_driver_杂记.html">
            
                    
                    驱动调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.7" data-path="device_localbus_16bit读写.html">
            
                <a href="device_localbus_16bit读写.html">
            
                    
                    CPLD做8bit到16bit转换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.8" data-path="driver_位域和大小端.html">
            
                <a href="driver_位域和大小端.html">
            
                    
                    位域和大小端
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.9" data-path="as_title_driver1.html">
            
                <a href="as_title_driver1.html">
            
                    
                    nand
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.9.1" data-path="device_driver_octeon_nand.html">
            
                <a href="device_driver_octeon_nand.html">
            
                    
                    octeon nand flash驱动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.9.2" data-path="device_driver_nand概率写失败问题分析.html">
            
                <a href="device_driver_nand概率写失败问题分析.html">
            
                    
                    Nand flash概率写失败问题分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.10" data-path="octeon_remote_pci.html">
            
                <a href="octeon_remote_pci.html">
            
                    
                    octeon remote-pci.c阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.11" data-path="Device_VFIO_notes.html">
            
                <a href="Device_VFIO_notes.html">
            
                    
                    VFIO简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12" data-path="as_title_driver2.html">
            
                <a href="as_title_driver2.html">
            
                    
                    智能网卡和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.12.1" data-path="smartNIC_智能网卡对比.html">
            
                <a href="smartNIC_智能网卡对比.html">
            
                    
                    智能网卡对比
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12.2" data-path="octeon_pci_NIC.html">
            
                <a href="octeon_pci_NIC.html">
            
                    
                    octeon PCI NIC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12.3" data-path="as_title_driver3.html">
            
                <a href="as_title_driver3.html">
            
                    
                    octeon liquidIO
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.12.3.1" data-path="smartNIC_liquidIO_代码阅读app篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读app篇.html">
            
                    
                    PCI-NIC 代码阅读 --app篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12.3.2" data-path="smartNIC_liquidIO_代码阅读api篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读api篇.html">
            
                    
                    PCI-NIC 代码阅读 --api篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12.3.3" data-path="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇之结构体
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12.3.4" data-path="smartNIC_liquidIO_代码阅读driver篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12.3.5" data-path="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                    
                    PCI-NIC 代码阅读 --真NIC篇
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.12.4" data-path="networking_dpdk使用_2014.html">
            
                <a href="networking_dpdk使用_2014.html">
            
                    
                    DPDK使用(2014)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.13" data-path="device_nvme要点介绍.html">
            
                <a href="device_nvme要点介绍.html">
            
                    
                    nvme要点介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="as_title_cpu.html">
            
                <a href="as_title_cpu.html">
            
                    
                    CPU Arch相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1" data-path="CPU_interconnection_networks.html">
            
                <a href="CPU_interconnection_networks.html">
            
                    
                    CPU核互联模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2" data-path="cache_CPU和cache一致性原理.html">
            
                <a href="cache_CPU和cache一致性原理.html">
            
                    
                    CPU和cache一致性原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3" data-path="as_title_cpu1.html">
            
                <a href="as_title_cpu1.html">
            
                    
                    ARM64
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.3.1" data-path="CPU_ARM64_知识杂记.html">
            
                <a href="CPU_ARM64_知识杂记.html">
            
                    
                    aarch64架构知识杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.2" data-path="CPU_ARM64_thunder_overview.html">
            
                <a href="CPU_ARM64_thunder_overview.html">
            
                    
                    thunder 概览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.3" data-path="CPU_ARM64_thunder_开发板操作记录.html">
            
                <a href="CPU_ARM64_thunder_开发板操作记录.html">
            
                    
                    thunder 开发板操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.4" data-path="CPU_ARM64_thunder_bdk.html">
            
                <a href="CPU_ARM64_thunder_bdk.html">
            
                    
                    thunder BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.5" data-path="CPU_ARM64_thunder_efi_rtc.html">
            
                <a href="CPU_ARM64_thunder_efi_rtc.html">
            
                    
                    thunder RTC时间和efi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.6" data-path="CPU_ARM64_thunder_uefi_fdt.html">
            
                <a href="CPU_ARM64_thunder_uefi_fdt.html">
            
                    
                    thunder uefi和fdt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.7" data-path="CPU_ARM64_thunder_atf.html">
            
                <a href="CPU_ARM64_thunder_atf.html">
            
                    
                    thunder atf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.8" data-path="CPU_ARM64_thunder_kernel_boot.html">
            
                <a href="CPU_ARM64_thunder_kernel_boot.html">
            
                    
                    thunder kernel启动打印流程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17.4" data-path="as_title_cpu2.html">
            
                <a href="as_title_cpu2.html">
            
                    
                    PPC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.4.1" data-path="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                <a href="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                    
                    PPC启动多核linux: 流程和内存映射
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.17.4.2" data-path="CPU_PPC_kernel升级记录.html">
            
                <a href="CPU_PPC_kernel升级记录.html">
            
                    
                    PPC kernel升级记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17.5" data-path="as_title_cpu3.html">
            
                <a href="as_title_cpu3.html">
            
                    
                    MIPS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.5.1" data-path="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                <a href="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                    
                    octeon 地址空间和寄存器访问
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.2" data-path="CPU_MIPS_octeon操作记录.html">
            
                <a href="CPU_MIPS_octeon操作记录.html">
            
                    
                    octeon 操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.3" data-path="CPU_MIPS_octeon_包处理性能.html">
            
                <a href="CPU_MIPS_octeon_包处理性能.html">
            
                    
                    octeon 系列处理器包处理性能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.4" data-path="CPU_MIPS_octeon_ddr调试记录.html">
            
                <a href="CPU_MIPS_octeon_ddr调试记录.html">
            
                    
                    octeon DDR调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.5" data-path="CPU_MIPS_octeon_BDK.html">
            
                <a href="CPU_MIPS_octeon_BDK.html">
            
                    
                    octeon CN78xx BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.6" data-path="kernel_增加ECC中断.html">
            
                <a href="kernel_增加ECC中断.html">
            
                    
                    octeon 增加ECC中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.7" data-path="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                <a href="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                    
                    octeon hw-ddr2代码走读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.8" data-path="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                <a href="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                    
                    octeon reboot调试和DDR中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.9" data-path="CPU_MIPS_octeon中断.html">
            
                <a href="CPU_MIPS_octeon中断.html">
            
                    
                    octeon 中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.10" data-path="CPU_MIPS_octeon原子操作.html">
            
                <a href="CPU_MIPS_octeon原子操作.html">
            
                    
                    octeon 原子操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.11" data-path="CPU_MIPS_octeon网口代码分析.html">
            
                <a href="CPU_MIPS_octeon网口代码分析.html">
            
                    
                    octeon 网口代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >PPC kernel升级记录</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#&#x65B0;kernel&#x542F;&#x52A8;&#x6CA1;&#x6253;&#x5370;"><b>1. </b>&#x65B0;kernel&#x542F;&#x52A8;&#x6CA1;&#x6253;&#x5370;</a></li><ul><li><span class="title-icon "></span><a href="#&#x73B0;&#x8C61;"><b>1.1. </b>&#x73B0;&#x8C61;</a></li><ul><li><span class="title-icon "></span><a href="#&#x8001;kernel&#x542F;&#x52A8;"><b>1.1.1. </b>&#x8001;kernel&#x542F;&#x52A8;</a></li><li><span class="title-icon "></span><a href="#&#x65B0;kernel&#x542F;&#x52A8;"><b>1.1.2. </b>&#x65B0;kernel&#x542F;&#x52A8;</a></li></ul><li><span class="title-icon "></span><a href="#&#x590D;&#x73B0;"><b>1.2. </b>&#x590D;&#x73B0;</a></li><li><span class="title-icon "></span><a href="#&#x8DF3;&#x8F6C;&#x5230;kernel&#x540E;-&#x65B0;kernel&#x4F1A;&#x4E00;&#x76F4;machine-check"><b>1.3. </b>&#x8DF3;&#x8F6C;&#x5230;kernel&#x540E;, &#x65B0;kernel&#x4F1A;&#x4E00;&#x76F4;machine check</a></li><ul><li><span class="title-icon "></span><a href="#&#x8C03;&#x67E5;tlb"><b>1.3.1. </b>&#x8C03;&#x67E5;tlb</a></li><li><span class="title-icon "></span><a href="#&#x65B0;kernel&#x7684;tlb&#x4E0D;&#x6B63;&#x5E38;"><b>1.3.2. </b>&#x65B0;kernel&#x7684;tlb&#x4E0D;&#x6B63;&#x5E38;</a></li></ul><li><span class="title-icon "></span><a href="#&#x95EE;&#x9898;-uboot&#x600E;&#x4E48;&#x8DF3;&#x8F6C;&#x5230;linux&#x7684;"><b>1.4. </b>&#x95EE;&#x9898;, uboot&#x600E;&#x4E48;&quot;&#x8DF3;&#x8F6C;&quot;&#x5230;linux&#x7684;?</a></li><li><span class="title-icon "></span><a href="#&#x7528;&#x4EFF;&#x771F;&#x5668;&#x67E5;&#x770B;uboot&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x914D;&#x7F6E;"><b>1.5. </b>&#x7528;&#x4EFF;&#x771F;&#x5668;&#x67E5;&#x770B;uboot&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x914D;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#&#x770B;&#x4EE3;&#x7801;"><b>1.6. </b>&#x770B;&#x4EE3;&#x7801;</a></li><li><span class="title-icon "></span><a href="#&#x4EFF;&#x771F;&#x5668;&#x6253;uboot&#x65AD;&#x70B9;"><b>1.7. </b>&#x4EFF;&#x771F;&#x5668;&#x6253;uboot&#x65AD;&#x70B9;</a></li><li><span class="title-icon "></span><a href="#&#x603B;&#x7ED3;-&#x8FD9;&#x91CC;&#x5B9E;&#x9645;&#x4E0A;&#x6709;&#x4E24;&#x4E2A;&#x95EE;&#x9898;"><b>1.8. </b>&#x603B;&#x7ED3;: &#x8FD9;&#x91CC;&#x5B9E;&#x9645;&#x4E0A;&#x6709;&#x4E24;&#x4E2A;&#x95EE;&#x9898;</a></li><li><span class="title-icon "></span><a href="#&#x90A3;&#x4E48;switchtoas1&#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4F5C;&#x7528;"><b>1.9. </b>&#x90A3;&#x4E48;switch_to_as1&#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4F5C;&#x7528;</a></li><li><span class="title-icon "></span><a href="#&#x4E3A;&#x4EC0;&#x4E48;memstartaddr&#x4E3A;0"><b>1.10. </b>&#x4E3A;&#x4EC0;&#x4E48;memstart_addr&#x4E3A;0</a></li><li><span class="title-icon "></span><a href="#&#x6700;&#x7EC8;&#x4FEE;&#x6539;"><b>1.11. </b>&#x6700;&#x7EC8;&#x4FEE;&#x6539;</a></li></ul><li><span class="title-icon "></span><a href="#&#x9A71;&#x52A8;&#x95EE;&#x9898;"><b>2. </b>&#x9A71;&#x52A8;&#x95EE;&#x9898;</a></li><ul><li><span class="title-icon "></span><a href="#&#x5185;&#x6838;&#x4E0D;&#x518D;&#x6709;irqfdisabled"><b>2.1. </b>&#x5185;&#x6838;&#x4E0D;&#x518D;&#x6709;IRQF_DISABLED</a></li><ul><li><span class="title-icon "></span><a href="#&#x4FEE;&#x6539;"><b>2.1.1. </b>&#x4FEE;&#x6539;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5185;&#x6838;&#x4E0D;&#x518D;&#x63D0;&#x4F9B;memoryaccessor"><b>2.2. </b>&#x5185;&#x6838;&#x4E0D;&#x518D;&#x63D0;&#x4F9B;memory_accessor</a></li><ul><li><span class="title-icon "></span><a href="#&#x4FEE;&#x6539;_1"><b>2.2.1. </b>&#x4FEE;&#x6539;</a></li></ul><li><span class="title-icon "></span><a href="#gpio&#x7684;gpiochipremove&#x51FD;&#x6570;&#x4E0D;&#x518D;&#x8FD4;&#x56DE;int"><b>2.3. </b>gpio&#x7684;gpiochip_remove()&#x51FD;&#x6570;&#x4E0D;&#x518D;&#x8FD4;&#x56DE;int</a></li><ul><li><span class="title-icon "></span><a href="#&#x4FEE;&#x6539;_2"><b>2.3.1. </b>&#x4FEE;&#x6539;</a></li></ul><li><span class="title-icon "></span><a href="#gpio&#x6CA1;&#x6709;member-dev"><b>2.4. </b>gpio&#x6CA1;&#x6709;member dev</a></li><ul><li><span class="title-icon "></span><a href="#&#x4FEE;&#x6539;_3"><b>2.4.1. </b>&#x4FEE;&#x6539;</a></li></ul><li><span class="title-icon "></span><a href="#noreturn&#x7F16;&#x8BD1;&#x6807;&#x8BB0;"><b>2.5. </b>__noreturn&#x7F16;&#x8BD1;&#x6807;&#x8BB0;</a></li><ul><li><span class="title-icon "></span><a href="#&#x771F;&#x7684;&#x8981;noreturn&#x5417;"><b>2.5.1. </b>&#x771F;&#x7684;&#x8981;noreturn&#x5417;?</a></li><li><span class="title-icon "></span><a href="#option1-&#x4FEE;&#x6539;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;driver"><b>2.5.2. </b>option1: &#x4FEE;&#x6539;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;driver</a></li><li><span class="title-icon "></span><a href="#&#x6216;&#x8005;"><b>2.5.3. </b>&#x6216;&#x8005;</a></li><li><span class="title-icon "></span><a href="#option2-&#x4FEE;&#x6539;kernel-&#x53BB;&#x6389;noreturn&#x8981;&#x6C42;"><b>2.5.4. </b>option2: &#x4FEE;&#x6539;kernel, &#x53BB;&#x6389;noreturn&#x8981;&#x6C42;</a></li></ul></ul><li><span class="title-icon "></span><a href="#kernel&#x4EE3;&#x7801;&#x8DEF;&#x5F84;"><b>3. </b>kernel&#x4EE3;&#x7801;&#x8DEF;&#x5F84;</a></li><ul><li><span class="title-icon "></span><a href="#kernel&#x8DEF;&#x5F84;"><b>3.1. </b>kernel&#x8DEF;&#x5F84;</a></li><li><span class="title-icon "></span><a href="#uboot"><b>3.2. </b>uboot</a></li></ul><li><span class="title-icon "></span><a href="#dts"><b>4. </b>DTS</a></li><ul><li><span class="title-icon "></span><a href="#&#x53C2;&#x8003;-dts&#x8BF4;&#x660E;"><b>4.1. </b>&#x53C2;&#x8003;: dts&#x8BF4;&#x660E;</a></li><li><span class="title-icon "></span><a href="#&#x7F16;&#x8BD1;dts"><b>4.2. </b>&#x7F16;&#x8BD1;dts</a></li><li><span class="title-icon "></span><a href="#fman-frame-manager"><b>4.3. </b>FMan: Frame Manager</a></li><li><span class="title-icon "></span><a href="#kernel49&#x548C;kernel312&#x7684;&#x90E8;&#x5206;dts&#x4E0D;&#x540C;&#x70B9;"><b>4.4. </b>kernel4.9&#x548C;kernel3.12&#x7684;&#x90E8;&#x5206;DTS&#x4E0D;&#x540C;&#x70B9;</a></li></ul></ul></div><a href="#&#x65B0;kernel&#x542F;&#x52A8;&#x6CA1;&#x6253;&#x5370;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><ul>
<li><a href="#&#x65B0;kernel&#x542F;&#x52A8;&#x6CA1;&#x6253;&#x5370;">&#x65B0;kernel&#x542F;&#x52A8;&#x6CA1;&#x6253;&#x5370;</a><ul>
<li><a href="#&#x73B0;&#x8C61;">&#x73B0;&#x8C61;</a><ul>
<li><a href="#&#x8001;kernel&#x542F;&#x52A8;">&#x8001;kernel&#x542F;&#x52A8;</a></li>
<li><a href="#&#x65B0;kernel&#x542F;&#x52A8;">&#x65B0;kernel&#x542F;&#x52A8;</a></li>
</ul>
</li>
<li><a href="#&#x590D;&#x73B0;">&#x590D;&#x73B0;</a></li>
<li><a href="#&#x8DF3;&#x8F6C;&#x5230;kernel&#x540E;-&#x65B0;kernel&#x4F1A;&#x4E00;&#x76F4;machine-check">&#x8DF3;&#x8F6C;&#x5230;kernel&#x540E;, &#x65B0;kernel&#x4F1A;&#x4E00;&#x76F4;machine check</a><ul>
<li><a href="#&#x8C03;&#x67E5;tlb">&#x8C03;&#x67E5;tlb</a><ul>
<li><a href="#&#x8001;kernel&#x6B63;&#x5E38;&#x7684;tlb">&#x8001;kernel&#x6B63;&#x5E38;&#x7684;tlb</a></li>
</ul>
</li>
<li><a href="#&#x65B0;kernel&#x7684;tlb&#x4E0D;&#x6B63;&#x5E38;">&#x65B0;kernel&#x7684;tlb&#x4E0D;&#x6B63;&#x5E38;</a></li>
</ul>
</li>
<li><a href="#&#x95EE;&#x9898;-uboot&#x600E;&#x4E48;&#x8DF3;&#x8F6C;&#x5230;linux&#x7684;">&#x95EE;&#x9898;, uboot&#x600E;&#x4E48;&quot;&#x8DF3;&#x8F6C;&quot;&#x5230;linux&#x7684;?</a></li>
<li><a href="#&#x7528;&#x4EFF;&#x771F;&#x5668;&#x67E5;&#x770B;uboot&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x914D;&#x7F6E;">&#x7528;&#x4EFF;&#x771F;&#x5668;&#x67E5;&#x770B;uboot&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x914D;&#x7F6E;</a></li>
<li><a href="#&#x770B;&#x4EE3;&#x7801;">&#x770B;&#x4EE3;&#x7801;</a></li>
<li><a href="#&#x4EFF;&#x771F;&#x5668;&#x6253;uboot&#x65AD;&#x70B9;">&#x4EFF;&#x771F;&#x5668;&#x6253;uboot&#x65AD;&#x70B9;</a></li>
<li><a href="#&#x603B;&#x7ED3;-&#x8FD9;&#x91CC;&#x5B9E;&#x9645;&#x4E0A;&#x6709;&#x4E24;&#x4E2A;&#x95EE;&#x9898;">&#x603B;&#x7ED3;: &#x8FD9;&#x91CC;&#x5B9E;&#x9645;&#x4E0A;&#x6709;&#x4E24;&#x4E2A;&#x95EE;&#x9898;</a></li>
<li><a href="#&#x90A3;&#x4E48;switch_to_as1&#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4F5C;&#x7528;">&#x90A3;&#x4E48;switch_to_as1&#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4F5C;&#x7528;</a></li>
<li><a href="#&#x4E3A;&#x4EC0;&#x4E48;memstart_addr&#x4E3A;0">&#x4E3A;&#x4EC0;&#x4E48;memstart_addr&#x4E3A;0</a></li>
<li><a href="#&#x6700;&#x7EC8;&#x4FEE;&#x6539;">&#x6700;&#x7EC8;&#x4FEE;&#x6539;</a></li>
</ul>
</li>
<li><a href="#&#x9A71;&#x52A8;&#x95EE;&#x9898;">&#x9A71;&#x52A8;&#x95EE;&#x9898;</a><ul>
<li><a href="#&#x5185;&#x6838;&#x4E0D;&#x518D;&#x6709;irqf_disabled">&#x5185;&#x6838;&#x4E0D;&#x518D;&#x6709;IRQF_DISABLED</a><ul>
<li><a href="#&#x4FEE;&#x6539;">&#x4FEE;&#x6539;</a></li>
</ul>
</li>
<li><a href="#&#x5185;&#x6838;&#x4E0D;&#x518D;&#x63D0;&#x4F9B;memory_accessor">&#x5185;&#x6838;&#x4E0D;&#x518D;&#x63D0;&#x4F9B;memory_accessor</a><ul>
<li><a href="#&#x4FEE;&#x6539;-1">&#x4FEE;&#x6539;</a></li>
</ul>
</li>
<li><a href="#gpio&#x7684;gpiochip_remove&#x51FD;&#x6570;&#x4E0D;&#x518D;&#x8FD4;&#x56DE;int">gpio&#x7684;gpiochip_remove()&#x51FD;&#x6570;&#x4E0D;&#x518D;&#x8FD4;&#x56DE;int</a><ul>
<li><a href="#&#x4FEE;&#x6539;-2">&#x4FEE;&#x6539;</a></li>
</ul>
</li>
<li><a href="#gpio&#x6CA1;&#x6709;member-dev">gpio&#x6CA1;&#x6709;member dev</a><ul>
<li><a href="#&#x4FEE;&#x6539;-3">&#x4FEE;&#x6539;</a></li>
</ul>
</li>
<li><a href="#__noreturn&#x7F16;&#x8BD1;&#x6807;&#x8BB0;">__noreturn&#x7F16;&#x8BD1;&#x6807;&#x8BB0;</a><ul>
<li><a href="#&#x771F;&#x7684;&#x8981;noreturn&#x5417;">&#x771F;&#x7684;&#x8981;noreturn&#x5417;?</a></li>
<li><a href="#option1-&#x4FEE;&#x6539;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;driver">option1: &#x4FEE;&#x6539;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;driver</a></li>
<li><a href="#&#x6216;&#x8005;">&#x6216;&#x8005;</a></li>
<li><a href="#option2-&#x4FEE;&#x6539;kernel-&#x53BB;&#x6389;noreturn&#x8981;&#x6C42;">option2: &#x4FEE;&#x6539;kernel, &#x53BB;&#x6389;noreturn&#x8981;&#x6C42;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#kernel&#x4EE3;&#x7801;&#x8DEF;&#x5F84;">kernel&#x4EE3;&#x7801;&#x8DEF;&#x5F84;</a><ul>
<li><a href="#kernel&#x8DEF;&#x5F84;">kernel&#x8DEF;&#x5F84;</a></li>
<li><a href="#uboot">uboot</a></li>
</ul>
</li>
<li><a href="#dts">DTS</a><ul>
<li><a href="#&#x53C2;&#x8003;-dts&#x8BF4;&#x660E;">&#x53C2;&#x8003;: dts&#x8BF4;&#x660E;</a></li>
<li><a href="#&#x7F16;&#x8BD1;dts">&#x7F16;&#x8BD1;dts</a></li>
<li><a href="#fman-frame-manager">FMan: Frame Manager</a></li>
<li><a href="#kernel49&#x548C;kernel312&#x7684;&#x90E8;&#x5206;dts&#x4E0D;&#x540C;&#x70B9;">kernel4.9&#x548C;kernel3.12&#x7684;&#x90E8;&#x5206;DTS&#x4E0D;&#x540C;&#x70B9;</a></li>
</ul>
</li>
</ul>
<h1 id="&#x65B0;kernel&#x542F;&#x52A8;&#x6CA1;&#x6253;&#x5370;"><a name="&#x65B0;kernel&#x542F;&#x52A8;&#x6CA1;&#x6253;&#x5370;" class="anchor-navigation-ex-anchor" href="#&#x65B0;kernel&#x542F;&#x52A8;&#x6CA1;&#x6253;&#x5370;"><i class="fa fa-link" aria-hidden="true"></i></a>1. &#x65B0;kernel&#x542F;&#x52A8;&#x6CA1;&#x6253;&#x5370;</h1>
<h2 id="&#x73B0;&#x8C61;"><a name="&#x73B0;&#x8C61;" class="anchor-navigation-ex-anchor" href="#&#x73B0;&#x8C61;"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. &#x73B0;&#x8C61;</h2>
<h3 id="&#x8001;kernel&#x542F;&#x52A8;"><a name="&#x8001;kernel&#x542F;&#x52A8;" class="anchor-navigation-ex-anchor" href="#&#x8001;kernel&#x542F;&#x52A8;"><i class="fa fa-link" aria-hidden="true"></i></a>1.1.1. &#x8001;kernel&#x542F;&#x52A8;</h3>
<pre class="language-"><code>do_linux_exec:current_time = 56650 ms
## Booting kernel from Legacy Image at 7a0002a4 ...
   Image Name: Linux-3.12.37-rt51
   Image Type: PowerPC Linux Kernel Image (gzip compressed)
   Data Size: 3620039 Bytes = 3.5 MiB
   Load Address: 00000000
   Entry Point: 00000000
   Verifying Checksum ... OK
## Flattened Device Tree blob at 11000000
   Booting using the fdt blob at 0x11000000
   Uncompressing Kernel Image ... OK
   reserving fdt memory region: addr=c10000 size=9d61c8
   reserving fdt memory region: addr=20000000 size=60000000
   Loading Device Tree to 03fdc000, end 03fff6e6 ... OK
WARNING: Missing crypto node
memory reserve level 1
set memory reserve region 0, base 0x20000000, size 0x60000000 ok
WARNING: could not find compatible node: FDT_ERR_NOTFOUND##
2 bytes read in 0 ms
load_image_from_cf_card: load image /images/cf_low_2g_reclaim to 1fddcb08 done, size 2
reclaim flag in file:1, in uboot env:31
[ 0.000000] memblock_reserve: [0x00000000000000-0x00000000790000] early_init_devtree+0x104/0x338
[ 0.000000] memblock_reserve: [0x00000003fdc000-0x00000003feb000] early_init_devtree+0x128/0x338
[ 0.000000] memblock_reserve: [0x00000000c10000-0x000000015e7000] early_init_devtree+0x18c/0x338
</code></pre><h3 id="&#x65B0;kernel&#x542F;&#x52A8;"><a name="&#x65B0;kernel&#x542F;&#x52A8;" class="anchor-navigation-ex-anchor" href="#&#x65B0;kernel&#x542F;&#x52A8;"><i class="fa fa-link" aria-hidden="true"></i></a>1.1.2. &#x65B0;kernel&#x542F;&#x52A8;</h3>
<p>&#x6CA1;&#x6709;&#x4E00;&#x884C;kernel&#x6253;&#x5370;, &#x524D;&#x9762;&#x7684;&#x6253;&#x5370;&#x5230;<code>reclaim flag in file:1, in uboot env:31</code>, &#x90FD;&#x6709;</p>
<h2 id="&#x590D;&#x73B0;"><a name="&#x590D;&#x73B0;" class="anchor-navigation-ex-anchor" href="#&#x590D;&#x73B0;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. &#x590D;&#x73B0;</h2>
<p>&#x542F;&#x52A8;kernel, uboot&#x4F1A;&#x628A;CF&#x5361;&#x91CC;&#x7684;linux.itb&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x91CC;, &#x5E76;&#x4ECE;&#x4E2D;&#x89E3;&#x6790;&#x51FA;uImage, dtb&#x548C;rootfs
&#x548C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x6548;&#x679C;&#x4E00;&#x6837;:</p>
<pre class="language-"><code>ext2load _cf 0:0 0x7a000000 /images/49/uImage
ext2load _cf 0:0 0x11000000 /images/49/fant-3041.dtb

ext2load _cf 0:0 0x7a000000 /images/312/uImage
ext2load _cf 0:0 0x11000000 /images/312/fant-3041.dtb

ext2load _cf 0:0 0xc10000 /images/linuxA/rootfs.cpio.xz

bootm 0x7a000000 - 0x11000000
</code></pre><h2 id="&#x8DF3;&#x8F6C;&#x5230;kernel&#x540E;-&#x65B0;kernel&#x4F1A;&#x4E00;&#x76F4;machine-check"><a name="&#x8DF3;&#x8F6C;&#x5230;kernel&#x540E;-&#x65B0;kernel&#x4F1A;&#x4E00;&#x76F4;machine-check" class="anchor-navigation-ex-anchor" href="#&#x8DF3;&#x8F6C;&#x5230;kernel&#x540E;-&#x65B0;kernel&#x4F1A;&#x4E00;&#x76F4;machine-check"><i class="fa fa-link" aria-hidden="true"></i></a>1.3. &#x8DF3;&#x8F6C;&#x5230;kernel&#x540E;, &#x65B0;kernel&#x4F1A;&#x4E00;&#x76F4;machine check</h2>
<p>&#x7528;&#x4EFF;&#x771F;&#x5668;&#x67E5;&#x770B;, &#x65B0;kernel&#x4E00;&#x76F4;&#x9677;&#x5728;0xc0000540, &#x4E0D;&#x8BBA;&#x5355;&#x6B65;&#x8FD0;&#x884C;, &#x8FD8;&#x662F;run free, &#x6BCF;&#x6B21;&#x505C;&#x4F4F;CPU&#x90FD;&#x5728;0xc0000540<br>&#x8FD9;&#x662F;&#x4E2A;machine check&#x5F02;&#x5E38;.</p>
<pre class="language-"><code>ppcP3041[0,c] % th
Core 0 halted; pc=0xc0000540
</code></pre><p>&#x6B64;&#x65F6;&#x770B;vmlinux&#x7684;&#x94FE;&#x63A5;&#x8D77;&#x59CB;&#x5730;&#x5740;&#x4EE3;&#x7801;: 0xc0000000, &#x548C;vmlinux&#x7684;objdump&#x6BD4;&#x8F83;, &#x5B8C;&#x5168;&#x5BF9;&#x4E0D;&#x4E0A;<br>&#x5F88;&#x53EF;&#x80FD;&#x662F;tlb&#x4E0D;&#x5BF9;, &#x5BFC;&#x81F4;&#x865A;&#x62DF;&#x5730;&#x5740;0xc0000000&#x6620;&#x5C04;&#x5230;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#x6CA1;&#x6709;&#x4EE3;&#x7801;. &#x6211;&#x4EEC;&#x8981;&#x67E5;&#x4E00;&#x4E0B;tlb</p>
<h3 id="&#x8C03;&#x67E5;tlb"><a name="&#x8C03;&#x67E5;tlb" class="anchor-navigation-ex-anchor" href="#&#x8C03;&#x67E5;tlb"><i class="fa fa-link" aria-hidden="true"></i></a>1.3.1. &#x8C03;&#x67E5;tlb</h3>
<h4 id="&#x8001;kernel&#x6B63;&#x5E38;&#x7684;tlb"><a name="&#x8001;kernel&#x6B63;&#x5E38;&#x7684;tlb" class="anchor-navigation-ex-anchor" href="#&#x8001;kernel&#x6B63;&#x5E38;&#x7684;tlb"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8001;kernel&#x6B63;&#x5E38;&#x7684;tlb</h4>
<p>&#x6B63;&#x5E38;&#x7684;tlb&#x4E2D;, 0xc0000000&#x88AB;&#x6620;&#x5C04;&#x5230;&#x7269;&#x7406;&#x5730;&#x5740;0x1:00000000, &#x8FD9;&#x4E2A;&#x662F;ddr&#x7684;&#x5730;&#x5740;, &#x4ECE;4G&#x5F00;&#x59CB;, &#x539F;&#x56E0;&#x89C1;&#x4E0B;.</p>
<pre class="language-"><code>ppcP3041[0,h] % tlbr *
idx w vaddr GsLpidVTsSizeTidWIMGEUrUwUxSrSwSx paddr VfX0X1U0U1U2U3Iprot
  0 0 0xc0000000 -- 0V-- 9 0--M--------SrSwSx -&gt; 0x1:00000000 --------------Iprot
  1 0 0xd0000000 -- 0V-- 9 0--M--------SrSwSx -&gt; 0x1:10000000 --------------Iprot
  2 0 0xe0000000 -- 0V-- 9 0--M--------SrSwSx -&gt; 0x1:20000000 --------------Iprot
</code></pre><h3 id="&#x65B0;kernel&#x7684;tlb&#x4E0D;&#x6B63;&#x5E38;"><a name="&#x65B0;kernel&#x7684;tlb&#x4E0D;&#x6B63;&#x5E38;" class="anchor-navigation-ex-anchor" href="#&#x65B0;kernel&#x7684;tlb&#x4E0D;&#x6B63;&#x5E38;"><i class="fa fa-link" aria-hidden="true"></i></a>1.3.2. &#x65B0;kernel&#x7684;tlb&#x4E0D;&#x6B63;&#x5E38;</h3>
<p>&#x8FD9;&#x91CC;&#x51FA;&#x73B0;&#x4E86;3&#x4E2A;0xc0000000&#x7684;&#x6620;&#x5C04;</p>
<pre class="language-"><code>ppcP3041[0,c] % th
Core 0 halted; pc=0xc0000540
ppcP3041[0,h] % tlbr *
idx w vaddr GsLpidVTsSizeTidWIMGEUrUwUxSrSwSx paddr VfX0X1U0U1U2U3Iprot
  0 0 0xc0000000 -- 0V-- 9 0--M--------SrSwSx -&gt; 0x0:00000000 --------------Iprot
  3 0 0xc0000000 -- 0VTs 8 0--M--------SrSwSx -&gt; 0x1:00000000 --------------Iprot
 63 0 0xc0000000 -- 0VTs 8 0--M--------SrSwSx -&gt; 0x1:00000000 --------------Iprot
</code></pre><h2 id="&#x95EE;&#x9898;-uboot&#x600E;&#x4E48;&#x8DF3;&#x8F6C;&#x5230;linux&#x7684;"><a name="&#x95EE;&#x9898;-uboot&#x600E;&#x4E48;&#x8DF3;&#x8F6C;&#x5230;linux&#x7684;" class="anchor-navigation-ex-anchor" href="#&#x95EE;&#x9898;-uboot&#x600E;&#x4E48;&#x8DF3;&#x8F6C;&#x5230;linux&#x7684;"><i class="fa fa-link" aria-hidden="true"></i></a>1.4. &#x95EE;&#x9898;, uboot&#x600E;&#x4E48;&quot;&#x8DF3;&#x8F6C;&quot;&#x5230;linux&#x7684;?</h2>
<p>&#x5728;uboot&#x89E3;&#x6790;uImage&#x7684;&#x65F6;&#x5019;, &#x5B83;&#x77E5;&#x9053;:</p>
<ul>
<li>Load Address: 00000000</li>
<li>Entry Point: 00000000</li>
</ul>
<p>&#x6CE8;&#x610F;&#x8FD9;&#x4E2A;Entry Point&#x5C31;&#x662F;uboot&#x8981;&#x8DF3;&#x8F6C;&#x5230;kernel&#x7684;&#x5730;&#x5740;
&#x8FD9;&#x4E2A;&#x5730;&#x5740;&#x88AB;uboot&#x8F6C;&#x6362;&#x4E3A;&#x51FD;&#x6570;&#x6307;&#x9488;, &#x8DF3;&#x8FC7;&#x53BB;.</p>
<pre class="language-"><code class="lang-c">      kernel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">bd_t</span> <span class="token operator">*</span><span class="token punctuation">,</span> ulong<span class="token punctuation">,</span> ulong<span class="token punctuation">,</span> ulong<span class="token punctuation">,</span> ulong<span class="token punctuation">,</span> ulong<span class="token punctuation">,</span> ulong<span class="token punctuation">)</span><span class="token punctuation">)</span>images<span class="token operator">-&gt;</span>ep<span class="token punctuation">;</span>
      <span class="token punctuation">(</span><span class="token operator">*</span>kernel<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">bd_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>of_flat_tree<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> EPAPR_MAGIC<span class="token punctuation">,</span> <span class="token function">getenv_bootm_mapsize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x6574;&#x4E2A;uboot&#x542F;&#x52A8;kernel&#x7684;&#x8FC7;&#x7A0B;&#x6253;&#x5370;, &#x548C;bootm&#x7684;&#x7B80;&#x8981;&#x8C03;&#x7528;&#x5982;&#x4E0B;:</p>
<pre class="language-"><code class="lang-c">## Booting kernel from Legacy Image at <span class="token number">7</span>a0002a4 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
   Image Name<span class="token operator">:</span> Linux<span class="token operator">-</span><span class="token number">3.12</span><span class="token number">.37</span><span class="token operator">-</span>rt51
   Image Type<span class="token operator">:</span> PowerPC Linux Kernel <span class="token function">Image</span> <span class="token punctuation">(</span>gzip compressed<span class="token punctuation">)</span>
   Data Size<span class="token operator">:</span> <span class="token number">3620039</span> Bytes <span class="token operator">=</span> <span class="token number">3.5</span> MiB
   Load Address<span class="token operator">:</span> <span class="token number">00000000</span>
   Entry Point<span class="token operator">:</span> <span class="token number">00000000</span>
   Verifying Checksum <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> OK
## Flattened Device Tree blob at <span class="token number">11000000</span>
   Booting using the fdt blob at <span class="token number">0x11000000</span>
   Uncompressing Kernel Image <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> OK
   reserving fdt memory region<span class="token operator">:</span> addr<span class="token operator">=</span>c10000 size<span class="token operator">=</span><span class="token number">9</span>d61c8
   reserving fdt memory region<span class="token operator">:</span> addr<span class="token operator">=</span><span class="token number">20000000</span> size<span class="token operator">=</span><span class="token number">60000000</span>
   Loading Device Tree to <span class="token number">03f</span>dc000<span class="token punctuation">,</span> end <span class="token number">03fff</span><span class="token number">6e6</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> OK


board<span class="token operator">/</span>_common<span class="token operator">/</span>uboot_wrappers<span class="token punctuation">.</span>c
do_linux_exec
    <span class="token comment">//&#x51C6;&#x5907;linux.itb, &#x5305;&#x62EC;uImage, fdt, rootfs</span>
    <span class="token function">prepare_images</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>kernel_addr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>kernel_size<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dtb_addr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dtb_size<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rootfs_addr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rootfs_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//&#x6267;&#x884C;fdt&#x547D;&#x4EE4;</span>
    fdt addr <span class="token number">0</span>x<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
     mchosen <span class="token number">0xc10000</span> <span class="token number">0x9d61c8</span><span class="token punctuation">;</span>
    fdt boa
        board<span class="token operator">/</span>freescale<span class="token operator">/</span>board<span class="token punctuation">.</span>c
        <span class="token function">ft_board_setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            base <span class="token operator">=</span> <span class="token function">getenv_bootm_low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            size <span class="token operator">=</span> <span class="token function">board_get_bootm_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">fdt_fixup_memory</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> <span class="token punctuation">(</span>u64<span class="token punctuation">)</span> base<span class="token punctuation">,</span> <span class="token punctuation">(</span>u64<span class="token punctuation">)</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">board_reserve_memory</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//&#x6267;&#x884C;bootm&#x547D;&#x4EE4;</span>
    bootm <span class="token number">0x7a0002a4</span> <span class="token operator">-</span> <span class="token number">0x11000000</span>
    do_bootm
        do_bootm_states
            <span class="token function">bootm_start</span><span class="token punctuation">(</span>cmdtp<span class="token punctuation">,</span> flag<span class="token punctuation">,</span> argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span>
            <span class="token function">bootm_find_os</span><span class="token punctuation">(</span>cmdtp<span class="token punctuation">,</span> flag<span class="token punctuation">,</span> argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span>
                <span class="token comment">/* &#x6253;&#x5370;## Booting kernel from Legacy Image at */</span>
                boot_get_kernel
            <span class="token comment">/* &#x6253;&#x5370;## Flattened Device Tree blob at */</span>
            <span class="token function">bootm_find_other</span><span class="token punctuation">(</span>cmdtp<span class="token punctuation">,</span> flag<span class="token punctuation">,</span> argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span>
            <span class="token comment">/* Load the OS */</span>
            <span class="token function">bootm_disable_interrupts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">bootm_load_os</span><span class="token punctuation">(</span>images<span class="token punctuation">,</span> <span class="token operator">&amp;</span>load_end<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token function">lmb_reserve</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>images<span class="token operator">-&gt;</span>lmb<span class="token punctuation">,</span> images<span class="token operator">-&gt;</span>os<span class="token punctuation">.</span>load<span class="token punctuation">,</span><span class="token punctuation">(</span>load_end <span class="token operator">-</span> images<span class="token operator">-&gt;</span>os<span class="token punctuation">.</span>load<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/* Relocate the ramdisk */</span>
            <span class="token function">boot_ramdisk_high</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">/* relocate flat device tree */</span>
            <span class="token function">boot_fdt_add_mem_rsv_regions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">boot_relocate_fdt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">/* boot linux */</span>
            <span class="token function">boot_selected_os</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                do_bootm_linux
                    boot_prep_linux
                    boot_body_linux
                    boot_jump_linux
                        <span class="token keyword">void</span>    <span class="token punctuation">(</span><span class="token operator">*</span>kernel<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">bd_t</span> <span class="token operator">*</span><span class="token punctuation">,</span> ulong r4<span class="token punctuation">,</span> ulong r5<span class="token punctuation">,</span> ulong r6<span class="token punctuation">,</span> ulong r7<span class="token punctuation">,</span> ulong r8<span class="token punctuation">,</span> ulong r9<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        kernel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">bd_t</span> <span class="token operator">*</span><span class="token punctuation">,</span> ulong<span class="token punctuation">,</span> ulong<span class="token punctuation">,</span> ulong<span class="token punctuation">,</span> ulong<span class="token punctuation">,</span> ulong<span class="token punctuation">,</span> ulong<span class="token punctuation">)</span><span class="token punctuation">)</span>images<span class="token operator">-&gt;</span>ep<span class="token punctuation">;</span>
                        <span class="token punctuation">(</span><span class="token operator">*</span>kernel<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">bd_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>of_flat_tree<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> EPAPR_MAGIC<span class="token punctuation">,</span> <span class="token function">getenv_bootm_mapsize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x603B;&#x7ED3;:</p>
<ul>
<li>&#x5BF9;kernel&#x6765;&#x8BF4;, &#x7B2C;&#x4E00;&#x6761;&#x547D;&#x4EE4;&#x5728;0xc0000000</li>
<li>&#x5BF9;uboot&#x6765;&#x8BF4;, kernel&#x88AB;load&#x540E;, &#x7B2C;&#x4E00;&#x6761;&#x547D;&#x4EE4;&#x5728;0x00000000</li>
<li>uboot&#x8DF3;&#x8F6C;&#x5230;0&#x5730;&#x5740;, &#x540E;&#x9762;&#x7684;&#x6240;&#x6709;&#x90FD;&#x662F;kernel&#x8D1F;&#x8D23;, &#x5305;&#x62EC;&#x914D;kernel&#x81EA;&#x5DF1;&#x7684;tlb.</li>
</ul>
<h2 id="&#x7528;&#x4EFF;&#x771F;&#x5668;&#x67E5;&#x770B;uboot&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x914D;&#x7F6E;"><a name="&#x7528;&#x4EFF;&#x771F;&#x5668;&#x67E5;&#x770B;uboot&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#&#x7528;&#x4EFF;&#x771F;&#x5668;&#x67E5;&#x770B;uboot&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>1.5. &#x7528;&#x4EFF;&#x771F;&#x5668;&#x67E5;&#x770B;uboot&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x914D;&#x7F6E;</h2>
<p>UBOOT tlb:<br>uboot&#x628A;&#x865A;&#x62DF;0&#x5730;&#x5740;&#x6620;&#x5C04;&#x5230;&#x7269;&#x7406;&#x5730;&#x5740;0x1:00000000.</p>
<pre class="language-"><code>  1 0 0x00000000 -- 0V-- a 0-----UrUwUxSrSwSx -&gt; 0x1:00000000 --------------Iprot
  2 0 0x40000000 -- 0V-- a 0-----UrUwUxSrSwSx -&gt; 0x1:40000000 --------------Iprot
 37 0 0xfe000000 -- 0V-- 7 0-I-G-------SrSw-- -&gt; 0xf:fe000000 --------------Iprot
</code></pre><p>&#x4E0A;&#x9762;&#x8BF4;&#x4E86;, 0x1:00000000&#x662F;ddr&#x7684;&#x5730;&#x5740;, &#x662F;&#x54EA;&#x91CC;&#x914D;&#x7684;?<br>&#x8FD9;&#x4E2A;&#x8981;&#x770B;LAW&#x5BC4;&#x5B58;&#x5668;, &#x5728;PPC&#x4E2D;, LAW&#x5BC4;&#x5B58;&#x5668;&#x7EC4;&#x5171;32&#x4E2A;, &#x7BA1;SOC&#x4E2D;, &#x5404;&#x4E2A;&#x6A21;&#x5757;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#x5E03;&#x5C40;&#x7684;.<br>&#x6CE8;&#x610F;, &#x6211;&#x7528;&#x7684;&#x662F;&#x5E03;&#x5C40;, &#x6307;&#x7684;&#x662F;&#x5404;&#x4E2A;&#x6A21;&#x5757;, &#x5728;36&#x4F4D;&#x7269;&#x7406;&#x5730;&#x5740;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;. &#x548C;&#x865A;&#x62DF;&#x5730;&#x5740;&#x65E0;&#x5173;.<br>&#x6240;&#x4EE5;LAW&#x5BC4;&#x5B58;&#x5668;, &#x662F;&#x7ED9;&#x6A21;&#x5757;&#x7528;&#x6765;&#x7075;&#x6D3B;&#x7684;&#x914D;&#x7F6E;&#x7269;&#x7406;&#x5730;&#x5740;&#x5E03;&#x5C40;&#x7684;<br>&#x6BCF;&#x4E2A;SOC&#x6A21;&#x5757;&#x90FD;&#x6709;&#x4E2A;&#x5168;&#x5C40;&#x7684;ID, &#x7528;&#x6765;&#x5728;SOC&#x5185;&#x90E8;&#x5BFB;&#x5740;, &#x6BD4;&#x5982;&#x4E00;&#x4E2A;transaction, &#x5B83;&#x7684;&#x6E90;&#x53EF;&#x80FD;&#x662F;PCIe, &#x76EE;&#x7684;&#x662F;DDR.<br>&#x5728;MIPS&#x7684;Octeon&#x7CFB;&#x5217;&#x4E0A;, &#x4E0D;&#x7528;LAW&#x5BC4;&#x5B58;&#x5668;&#x7EC4;, &#x800C;&#x662F;&#x76F4;&#x63A5;&#x56FA;&#x5B9A;&#x6BCF;&#x4E2A;&#x6A21;&#x5757;&#x7684;&#x5730;&#x5740;, &#x56E0;&#x4E3A;&#x5B83;&#x6709;64&#x4F4D;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x53EF;&#x4EE5;&#x7528;.<br><img src="img/CPU_PPC_kernel&#x5347;&#x7EA7;&#x8BB0;&#x5F55;_20220920090400.png" alt=""><br>&#x5BF9;DDR&#x6765;&#x8BF4;, &#x5B83;&#x7684;ID&#x662F;0x10&#x548C;0x11, &#x5B83;&#x4E0D;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;memory transaction&#x7684;&#x6E90;, &#x53EA;&#x53EF;&#x80FD;&#x662F;&#x76EE;&#x7684;.<br>LAW&#x5BC4;&#x5B58;&#x5668;: ddr&#x4F7F;&#x7528;fe00_0c70&#x548C;fe00_0c80, &#x88AB;map&#x5230;36&#x4F4D;&#x7269;&#x7406;&#x5730;&#x5740;0x1:00000000, &#x4E24;&#x6BB5;&#x5404;2G, &#x4E00;&#x5171;4G.<br>&#x5177;&#x4F53;LAW&#x5BC4;&#x5B58;&#x5668;&#x8981;&#x770B;&#x82AF;&#x7247;&#x624B;&#x518C;&#x7B2C;&#x4E8C;&#x7AE0;, memory map<br>&#x8FD9;&#x5C31;&#x5BF9;&#x4E0A;&#x4E86;.  </p>
<pre class="language-"><code>ppcP3041[0,h] % md 0xfe000c00 256
0xfe000c00:
fe00_0c00 0000000f ff800000 81f00016 00000000 ................
fe00_0c10 0000000f f4000000 81800014 00000000 ................
fe00_0c20 0000000f f4200000 83c00014 00000000 ..... ..........
fe00_0c30 0000000f ff000000 81f0000e 00000000 ................
fe00_0c40 0000000f ff200000 81f00013 00000000 ..... ..........
fe00_0c50 0000000f 00000000 81d00018 00000000 ................
fe00_0c60 0000000f 80000000 8000001c 00000000 ................

fe00_0c70 00000001 00000000 8100001e 00000000 ................
fe00_0c80 00000001 80000000 8100001e 00000000 ................

fe00_0c90 0000000f ff300000 8000000f 00000000 .....0..........
</code></pre><h2 id="&#x770B;&#x4EE3;&#x7801;"><a name="&#x770B;&#x4EE3;&#x7801;" class="anchor-navigation-ex-anchor" href="#&#x770B;&#x4EE3;&#x7801;"><i class="fa fa-link" aria-hidden="true"></i></a>1.6. &#x770B;&#x4EE3;&#x7801;</h2>
<p>&#x73B0;&#x5728;&#x6BD4;&#x8F83;&#x6E05;&#x695A;&#x4E86;, &#x8001;kernel&#x7684;tlb&#x914D;&#x7684;&#x662F;&#x5BF9;&#x7684;. &#x800C;&#x65B0;kernel&#x7684;tlb&#x914D;&#x7684;&#x5F88;&#x4E71;. 
0&#x53F7;tlb&#x4F3C;&#x4E4E;&#x662F;&#x9ED8;&#x8BA4;&#x7684;, &#x65B0;kernel&#x8BA4;&#x4E3A;0xc000000&#x5E94;&#x8BE5;&#x5BF9;&#x5E94;&#x7269;&#x7406;0&#x5730;&#x5740;.</p>
<pre class="language-"><code>idx w vaddr GsLpidVTsSizeTidWIMGEUrUwUxSrSwSx paddr VfX0X1U0U1U2U3Iprot
  0 0 0xc0000000 -- 0V-- 9 0--M--------SrSwSx -&gt; 0x0:00000000 --------------Iprot
  3 0 0xc0000000 -- 0VTs 8 0--M--------SrSwSx -&gt; 0x1:00000000 --------------Iprot
 63 0 0xc0000000 -- 0VTs 8 0--M--------SrSwSx -&gt; 0x1:00000000 --------------Iprot
</code></pre><p>&#x5728;<code>arch/powerpc/kernel/Makefile</code>&#x4E2D;, &#x6700;&#x540E;&#x7528;&#x7684;&#x662F;head_fsl_booke.o</p>
<pre class="language-"><code> 87 extra-y := head_$(BITS).o
 88 extra-$(CONFIG_40x) := head_40x.o
 89 extra-$(CONFIG_44x) := head_44x.o
 90 extra-$(CONFIG_FSL_BOOKE) := head_fsl_booke.o
 91 extra-$(CONFIG_8xx) := head_8xx.o
 92 extra-y += vmlinux.lds
</code></pre><h2 id="&#x4EFF;&#x771F;&#x5668;&#x6253;uboot&#x65AD;&#x70B9;"><a name="&#x4EFF;&#x771F;&#x5668;&#x6253;uboot&#x65AD;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x4EFF;&#x771F;&#x5668;&#x6253;uboot&#x65AD;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>1.7. &#x4EFF;&#x771F;&#x5668;&#x6253;uboot&#x65AD;&#x70B9;</h2>
<p>&#x65AD;&#x70B9;&#x5C31;&#x6253;&#x5728;0&#x5730;&#x5740;, &#x5FC5;&#x987B;&#x786C;&#x4EF6;&#x65AD;&#x70B9;&#x624D;&#x884C;.<br><code>0x1:00000000</code>: kernel&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;<br><code>0x0:00000000</code>: uboot&#x4E0B;&#x751F;&#x6548;&#x7684;&#x865A;&#x62DF;&#x5730;&#x5740;, map&#x5230;kernel&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;<br><code>0x0:c0000000</code>: kernel&#x7684;&#x7F16;&#x8BD1;&#x865A;&#x62DF;&#x5730;&#x5740;. kernel&#x4F1A;&#x81EA;&#x5DF1;&#x914D;tlb, &#x628A;&#x7269;&#x7406;&#x5730;&#x5740;map&#x5230;0xc0000000</p>
<pre class="language-"><code># &#x5E26;x&#x7684;&#x662F;&#x786C;&#x65AD;&#x70B9;.
bs x 0x00000000

# &#x80FD;&#x505C;&#x4F4F;
ppcP3041[0,R] % tc
Core 0 running
Core 0 hardware breakpoint hit; pc=0x00000000
ppcP3041[0,B] % md 0x00000000
0x00000000:
0000_0000 60000000 48001b81 7c7e1b78 7c9f2378 `...H...|~.x|.#x
0000_0010 3b200000 3b000000 3ae00000 48000005 ; ..;...:...H...
0000_0020 7cc802a6 7ce000a6 54e4dffe 7cf00aa6 |...|...T...|...
0000_0030 54e7801e 7ce72378 7cf69ba6 7c003724 T...|.#x|...|.7$

#&#x6B64;&#x65F6;&#x7684;tlb&#x8FD8;&#x662F;uboot&#x914D;&#x7684;.
</code></pre><p>OK, &#x73B0;&#x5728;&#x5F00;&#x59CB;&#x5355;&#x6B65;&#x8C03;&#x8BD5;kernel.</p>
<pre class="language-"><code class="lang-shell"><span class="token comment">#&#x65AD;&#x70B9;&#x8BBE;&#x5728;uboot&#x7684;&#x865A;&#x62DF;&#x5730;&#x5740;0, &#x8FD9;&#x662F;kernel&#x7684;&#x7B2C;&#x4E00;&#x6761;&#x6307;&#x4EE4;</span>
bs x 0x00000000
<span class="token comment">#&#x8BA9;target&#x7EE7;&#x7EED;&#x8FD0;&#x884C;</span>
tc
<span class="token comment">#uboot&#x91CC;&#x9762;load kernel</span>
ext2load _cf <span class="token number">0</span>:0 0x7a000000 /images/49/uImage
ext2load _cf <span class="token number">0</span>:0 0x11000000 /images/49/fant-3041.dtb
bootm 0x7a000000 - 0x11000000
<span class="token comment">#boom&#x6700;&#x540E;&#x4F1A;&#x8DF3;&#x8F6C;&#x5230;kenel&#x7684;&#x7B2C;&#x4E00;&#x6761;&#x6307;&#x4EE4;, &#x89E6;&#x53D1;&#x65AD;&#x70B9;</span>
<span class="token comment">#Core 0 hardware breakpoint hit; pc=0x00000000</span>
<span class="token comment">#&#x9996;&#x5148;&#x8981;get_phys_addr</span>
</code></pre>
<p>&#x5BF9;&#x5E94;&#x7684;head_fsl_booke.S</p>
<pre class="language-"><code class="lang-c">c0000000 <span class="token operator">&lt;</span>_start<span class="token operator">&gt;</span><span class="token operator">:</span>
<span class="token function">_ENTRY</span><span class="token punctuation">(</span>_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//&#x7B2C;&#x4E00;&#x547D;&#x4EE4;&#x662F;nop, &#x5360;&#x4F4D;&#x7684;</span>
c0000000<span class="token operator">:</span>       <span class="token number">60</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>     nop
<span class="token comment">//get_phys_addr&#x662F;&#x65B0;kernel&#x65B0;&#x589E;&#x7684;.</span>
<span class="token comment">/* Translate device tree address to physical, save in r30/r31 */</span>
<span class="token comment">//&#x5C31;&#x50CF;&#x6CE8;&#x91CA;&#x91CC;&#x8BF4;&#x7684;, r3&#x662F;device tree&#x7684;&#x5730;&#x5740;, &#x5728;tlb&#x4E2D;&#x641C;&#x7D22;r3, &#x8FD4;&#x56DE;&#x7269;&#x7406;&#x5730;&#x5740;</span>
c0000004<span class="token operator">:</span>       <span class="token number">48</span> <span class="token number">00</span> <span class="token number">1</span>b <span class="token number">81</span>     bl      c0001b84 <span class="token operator">&lt;</span>get_phys_addr<span class="token operator">&gt;</span>
mr  r30<span class="token punctuation">,</span>r3
mr  r31<span class="token punctuation">,</span>r4
<span class="token comment">//&#x9ED8;&#x8BA4;0&#x5730;&#x5740;</span>
li  r25<span class="token punctuation">,</span><span class="token number">0</span>           <span class="token comment">/* phys kernel start (low) */</span>
li  r24<span class="token punctuation">,</span><span class="token number">0</span>           <span class="token comment">/* CPU number */</span>
li  r23<span class="token punctuation">,</span><span class="token number">0</span>           <span class="token comment">/* phys kernel start (high) */</span>

<span class="token comment">//&#x5230;&#x8FD9;&#x91CC;&#x4E0D;&#x7BA1;boot&#x600E;&#x4E48;&#x4F7F;&#x7528;tlb, kernel&#x90FD;&#x4F1A;&#x505A;invalidate&#x64CD;&#x4F5C;. &#x4F46;&#x6709;&#x4E2A;&#x4F8B;&#x5916;, &#x6211;&#x4EEC;&#x5F53;&#x524D;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;tlb&#x662F;uboot&#x914D;&#x7684;, &#x867D;&#x7136;&#x865A;&#x62DF;&#x5730;&#x5740;&#x4E0D;&#x4E00;&#x5B9A;&#x662F;0xc0000000, &#x4F46;&#x8FD9;&#x6761;tlb&#x5FC5;&#x987B;&#x6709;IPROT=1&#x6807;&#x8BB0;, &#x8FD9;&#x6837;&#x4E0D;&#x4F1A;&#x88AB;invalidate&#x6389;.</span>
<span class="token comment">//kernel&#x4F1A;&#x914D;&#x7F6E;64M&#x7684;kernel&#x7A7A;&#x95F4;&#x5230;TLB1[0]</span>

<span class="token comment">//&#x5B9E;&#x9645;&#x914D;tlb&#x662F;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;. #include &quot;fsl_booke_entry_mapping.S&quot;</span>
<span class="token comment">//&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x6CA1;&#x95EE;&#x9898;, &#x5230;&#x8FD9;&#x91CC;&#x5C31;&#x53EA;&#x6709;kernel&#x7684;tlb 0xc0000000&#x751F;&#x6548;</span>
<span class="token number">0</span> <span class="token number">0</span> <span class="token number">0xc0000000</span> <span class="token operator">--</span>   <span class="token number">0</span>V<span class="token operator">--</span>   <span class="token number">8</span>  <span class="token number">0</span><span class="token operator">--</span>M<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>SrSwSx <span class="token operator">-&gt;</span> <span class="token number">0x1</span><span class="token operator">:</span><span class="token number">00000000</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>Iprot

<span class="token comment">//&#x7EE7;&#x7EED;&#x5F80;&#x4E0B;&#x8D70;&#x662F;&#x5EFA;&#x7ACB;&#x4E2D;&#x65AD;&#x8868;, &#x4F7F;&#x7528;&#x7279;&#x6B8A;&#x6307;&#x4EE4;mtivor0 .. mtivor15</span>
set_ivor<span class="token operator">:</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>  CriticalInput<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>  MachineCheck<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>  DataStorage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>  InstructionStorage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>  ExternalInput<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>  Alignment<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span>  Program<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span>  FloatingPointUnavailable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span>  SystemCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span>  AuxillaryProcessorUnavailable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> Decrementer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> FixedIntervalTimer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> WatchdogTimer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> DataTLBError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> InstructionTLBError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SET_IVOR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> DebugCrit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//&#x8BBE;&#x4E2D;&#x65AD;&#x57FA;&#x5740;&#x5BC4;&#x5B58;&#x5668;.</span>
<span class="token comment">/* Check to see if we&apos;re the second processor, and jump to the secondary_start code if so */</span>
<span class="token comment">//&#x5982;&#x679C;&#x662F;&#x4ECE;&#x6838;, &#x8DF3;&#x8F6C;&#x5230;secondary_start</span>

<span class="token comment">//&#x4E3B;&#x6838;&#x5F80;&#x4E0B;&#x8D70;</span>
<span class="token comment">//&#x5EFA;&#x7ACB;&#x7B2C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;ptr&#x5230;init_task, &#x4ECE;&#x6B64;current&#x5230;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;&#x6307;&#x9488;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;</span>
<span class="token comment">//&#x5EFA;&#x7ACB;&#x6808;</span>
<span class="token comment">//&#x8DF3;&#x8F6C;&#x5230;early_init, &#x7B2C;&#x4E00;&#x4E2A;C&#x51FD;&#x6570;</span>
c00003c4<span class="token operator">:</span>       <span class="token number">48</span> <span class="token number">64</span> <span class="token number">58</span> c9     bl      c0645c8c <span class="token operator">&lt;</span>early_init<span class="token operator">&gt;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
c00003d0<span class="token operator">:</span>       <span class="token number">48</span> <span class="token number">64</span> <span class="token number">59</span> <span class="token number">15</span>     bl      c0645ce4 <span class="token operator">&lt;</span>machine_init<span class="token operator">&gt;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">//&#x8FD9;&#x4E4B;&#x524D;&#x90FD;&#x6CA1;&#x95EE;&#x9898;</span>

<span class="token comment">//&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x6709;&#x95EE;&#x9898;, &#x5728;&#x91CC;&#x9762;&#x5F02;&#x5E38;&#x4E86;.</span>
c00003d4<span class="token operator">:</span>       <span class="token number">48</span> <span class="token number">64</span> <span class="token number">76</span> <span class="token number">6</span>d     bl      c0647a40 <span class="token operator">&lt;</span>MMU_init<span class="token operator">&gt;</span>
</code></pre>
<hr>
<p>head_fsl_booke.S&#x4E2D;&#x7684;&#x67E5;&#x627E;&#x7269;&#x7406;&#x5730;&#x5740;&#x7684;&#x51FD;&#x6570;: &#x901A;&#x8FC7;tlbsx&#x547D;&#x4EE4;, &#x77E5;&#x9053;&#x865A;&#x62DF;&#x5730;&#x5740;, &#x53EF;&#x4EE5;&#x627E;&#x5230;&#x7269;&#x7406;&#x5730;&#x5740;.</p>
<pre class="language-"><code class="lang-c"><span class="token comment">//Translate the effec addr in r3 to phys addr. The phys addr will be put</span>
<span class="token comment">//into r3(higher 32bit) and r4(lower 32bit)</span>
get_phys_addr<span class="token operator">:</span>
<span class="token comment">//&#x628A;msr&#x8D4B;&#x503C;&#x5230;r8, msr&#x662F;Machine State Register (MSR)</span>
c0001b84<span class="token operator">:</span>       <span class="token number">7</span>d <span class="token number">00</span> <span class="token number">00</span> a6     mfmsr   r8
<span class="token comment">//mfspr   r9,SPRN_PID, spr&#x662F;&#x4E00;&#x4E9B;&#x5217;&#x7684;special&#x7684;&#x5BC4;&#x5B58;&#x5668;, &#x5F88;&#x591A;, &#x540E;&#x9762;&#x7528;&#x679A;&#x4E3E;&#x6765;&#x6307;&#x5B9A;&#x5177;&#x4F53;spr</span>
<span class="token comment">//pid&#x662F;processor ID</span>
c0001b88<span class="token operator">:</span>       <span class="token number">7</span>d <span class="token number">30</span> <span class="token number">0</span>a a6     mfpid   r9
<span class="token comment">//&#x6709;&#x65F6;&#x5019;&#x53CD;&#x6C47;&#x7F16;&#x548C;&#x5B9E;&#x9645;&#x7684;&#x6C47;&#x7F16;&#x4E0D;&#x662F;&#x5B8C;&#x5168;&#x5BF9;&#x5E94;&#x7684;, &#x6BD4;&#x5982;&#x4E0B;&#x9762;:</span>
<span class="token comment">//MAS6&#x662F;spr&#x91CC;&#x9762;&#x7684; MMU assist register 6, MAS&#x4ECE;0&#x5230;8, &#x6709;9&#x4E2A;.</span>
<span class="token comment">//rlwinm  r9,r9,16,0x3fff0000 /* turn PID into MAS6[SPID] */</span>
c0001b8c<span class="token operator">:</span>       <span class="token number">55</span> <span class="token number">29</span> <span class="token number">80</span> <span class="token number">9</span>e     rlwinm  r9<span class="token punctuation">,</span>r9<span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">15</span>
<span class="token comment">//rlwimi  r9,r8,28,0x00000001 /* turn MSR[DS] into MAS6[SAS] */</span>
c0001b90<span class="token operator">:</span>       <span class="token number">51</span> <span class="token number">09</span> e7 fe     rlwimi  r9<span class="token punctuation">,</span>r8<span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">31</span>
<span class="token comment">//mtspr   SPRN_MAS6,r9</span>
c0001b94<span class="token operator">:</span>       <span class="token number">7</span>d <span class="token number">36</span> <span class="token number">9</span>b a6     mtspr   <span class="token number">630</span><span class="token punctuation">,</span>r9
<span class="token comment">//tlbsx   0,r3            /* must succeed */</span>
<span class="token comment">//&#x5728;tlb&#x4E2D;&#x5BFB;&#x627E;EA&#x5730;&#x5740;r3&#x5BF9;&#x5E94;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;</span>
c0001b98<span class="token operator">:</span>       <span class="token number">7</span>c <span class="token number">00</span> <span class="token number">1f</span> <span class="token number">24</span>     tlbsx   <span class="token number">0</span><span class="token punctuation">,</span>r3

mfspr   r8<span class="token punctuation">,</span>SPRN_MAS1
mfspr   r12<span class="token punctuation">,</span>SPRN_MAS3
rlwinm  r9<span class="token punctuation">,</span>r8<span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">0x1f</span>       <span class="token comment">/* r9 = log2(page size) */</span>
li  r10<span class="token punctuation">,</span><span class="token number">1024</span>
slw r10<span class="token punctuation">,</span>r10<span class="token punctuation">,</span>r9      <span class="token comment">/* r10 = page size */</span>
addi    r10<span class="token punctuation">,</span>r10<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span>
and r11<span class="token punctuation">,</span>r3<span class="token punctuation">,</span>r10      <span class="token comment">/* r11 = page offset */</span>
andc    r4<span class="token punctuation">,</span>r12<span class="token punctuation">,</span>r10      <span class="token comment">/* r4 = page base */</span>
or  r4<span class="token punctuation">,</span>r4<span class="token punctuation">,</span>r11       <span class="token comment">/* r4 = devtree phys addr */</span>
<span class="token comment">//&#x65E0;&#x6761;&#x4EF6;&#x8FD4;&#x56DE;</span>
blr
</code></pre>
<hr>
<p>fsl_booke_entry_mapping.S</p>
<pre class="language-"><code class="lang-c"><span class="token comment">/* 1. Find the index of the entry we&apos;re executing in */</span>
<span class="token comment">//LR&#x5BC4;&#x5B58;&#x5668;&#x5B9E;&#x9645;&#x4E0A;&#x662F;SPR&#x5BC4;&#x5B58;&#x5668;&#x7EC4;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;, &#x4FDD;&#x5B58;&#x4E86;return addr(bl&#x547D;&#x4EE4;&#x7684;&#x4E0B;&#x4E00;&#x6761;&#x547D;&#x4EE4;&#x7684;&#x5730;&#x5740;)</span>
bl  invstr              <span class="token comment">/* Find our address */</span>
invstr<span class="token operator">:</span> mflr    r6              <span class="token comment">/* Make it accessible */</span>
<span class="token comment">//&#x4E0A;&#x9762;&#x4E00;&#x53E5;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;: gpr6=0x00000020, r6&#x662F;LR, LR&#x662F;&#x73B0;&#x5728;&#x8FD9;&#x4E2A;&#x6307;&#x4EE4;&#x7684;&#x865A;&#x62DF;&#x5730;&#x5740;</span>

<span class="token comment">/* 2. Invalidate all entries except the entry we&apos;re executing in */</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment">/* 3. Setup a temp mapping and jump to it */</span>
<span class="token comment">//&#x5230;&#x8FD9;&#x91CC;, tlbr * &#x547D;&#x4EE4;&#x663E;&#x793A;, &#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x6709;&#x6548;&#x7684;tlb&#x4E86;. &#x5C31;&#x662F;uboot&#x914D;&#x7684;&#x90A3;&#x6761;</span>
<span class="token number">1</span> <span class="token number">0</span> <span class="token number">0x00000000</span> <span class="token operator">--</span>   <span class="token number">0</span>V<span class="token operator">--</span>   a  <span class="token number">0</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>UrUwUxSrSwSx <span class="token operator">-&gt;</span> <span class="token number">0x1</span><span class="token operator">:</span><span class="token number">00000000</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>Iprot

<span class="token comment">/* 4. Clear out PIDs &amp; Search info */</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">/* 5. Invalidate mapping we started in */</span>
<span class="token comment">//&#x5230;&#x8FD9;&#x91CC;&#x90FD;&#x662F;OK&#x7684;.&#x6B64;&#x65F6;tlb&#x4E3A;:</span>
ppcP3041<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>s<span class="token punctuation">]</span> <span class="token operator">%</span> tlbr <span class="token operator">*</span>
idx w vaddr      GsLpidVTsSizeTidWIMGEUrUwUxSrSwSx    paddr        VfX0X1U0U1U2U3Iprot
  <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0x00000000</span> <span class="token operator">--</span>   <span class="token number">0</span><span class="token operator">--</span><span class="token operator">-</span>   <span class="token number">0</span>  <span class="token number">0</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token operator">-&gt;</span> <span class="token number">0x0</span><span class="token operator">:</span><span class="token number">00000000</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
  <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0x00000000</span> <span class="token operator">--</span>   <span class="token number">0</span>V<span class="token operator">--</span>   a  <span class="token number">0</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>UrUwUxSrSwSx <span class="token operator">-&gt;</span> <span class="token number">0x1</span><span class="token operator">:</span><span class="token number">00000000</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
  <span class="token number">2</span> <span class="token number">0</span> <span class="token number">0x00000000</span> <span class="token operator">--</span>   <span class="token number">0</span>VTs   <span class="token number">1</span>  <span class="token number">0</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>SrSwSx <span class="token operator">-&gt;</span> <span class="token number">0x1</span><span class="token operator">:</span><span class="token number">00000000</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>Iprot
<span class="token comment">/* 6. Setup KERNELBASE mapping in TLB1[0] */</span>
c0000230<span class="token operator">:</span>       <span class="token number">7</span>c <span class="token number">00</span> <span class="token number">07</span> a4     tlbwe
<span class="token comment">//&#x5230;&#x8FD9;&#x91CC;&#x8FD8;&#x662F;&#x5BF9;&#x7684;. kernel&#x65B0;&#x589E;&#x52A0;&#x4E86;0xc0000000&#x7684;&#x6620;&#x5C04;. &#x4F46;&#x539F;&#x6765;&#x7684;uboot&#x7684;tlb&#x8FD8;&#x5728;</span>
Core <span class="token number">0</span> single<span class="token operator">-</span>stepped<span class="token punctuation">;</span> pc<span class="token operator">=</span><span class="token number">0x00000234</span>
ppcP3041<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>s<span class="token punctuation">]</span> <span class="token operator">%</span> tlbr <span class="token operator">*</span>
idx w vaddr      GsLpidVTsSizeTidWIMGEUrUwUxSrSwSx    paddr        VfX0X1U0U1U2U3Iprot
  <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0xc0000000</span> <span class="token operator">--</span>   <span class="token number">0</span>V<span class="token operator">--</span>   <span class="token number">8</span>  <span class="token number">0</span><span class="token operator">--</span>M<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>SrSwSx <span class="token operator">-&gt;</span> <span class="token number">0x1</span><span class="token operator">:</span><span class="token number">00000000</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>Iprot
  <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0x00000000</span> <span class="token operator">--</span>   <span class="token number">0</span><span class="token operator">--</span><span class="token operator">-</span>   a  <span class="token number">0</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>UrUwUxSrSwSx <span class="token operator">-&gt;</span> <span class="token number">0x1</span><span class="token operator">:</span><span class="token number">00000000</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
  <span class="token number">2</span> <span class="token number">0</span> <span class="token number">0x00000000</span> <span class="token operator">--</span>   <span class="token number">0</span>VTs   <span class="token number">1</span>  <span class="token number">0</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>SrSwSx <span class="token operator">-&gt;</span> <span class="token number">0x1</span><span class="token operator">:</span><span class="token number">00000000</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>Iprot

<span class="token comment">/* 7. Jump to KERNELBASE mapping */</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">/* 8. Clear out the temp mapping */</span>
c0000284<span class="token operator">:</span>       <span class="token number">7</span>c <span class="token number">00</span> <span class="token number">07</span> a4     tlbwe
c0000288<span class="token operator">:</span>       <span class="token number">39</span> <span class="token number">20</span> <span class="token number">00</span> <span class="token number">0</span>c     li      r9<span class="token punctuation">,</span><span class="token number">12</span>
c000028c<span class="token operator">:</span>       <span class="token number">7</span>c <span class="token number">00</span> <span class="token number">4</span>e <span class="token number">24</span>     tlbivax <span class="token number">0</span><span class="token punctuation">,</span>r9
c0000290<span class="token operator">:</span>       <span class="token number">7</span>c <span class="token number">00</span> <span class="token number">04</span> <span class="token number">6</span>c     tlbsync
c0000294<span class="token operator">:</span>       <span class="token number">7</span>c <span class="token number">00</span> <span class="token number">04</span> ac     msync
<span class="token comment">//&#x5230;&#x8FD9;&#x91CC;, uboot&#x914D;&#x7684;tlb&#x88AB;&#x6E05;&#x7406;&#x4E86;. &#x53EA;&#x6709;kernel&#x7684;tlb. </span>
Core <span class="token number">0</span> single<span class="token operator">-</span>stepped<span class="token punctuation">;</span> pc<span class="token operator">=</span><span class="token number">0xc0000288</span>
ppcP3041<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>s<span class="token punctuation">]</span> <span class="token operator">%</span> tlbr <span class="token operator">*</span>
idx w vaddr      GsLpidVTsSizeTidWIMGEUrUwUxSrSwSx    paddr        VfX0X1U0U1U2U3Iprot
  <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0xc0000000</span> <span class="token operator">--</span>   <span class="token number">0</span>V<span class="token operator">--</span>   <span class="token number">8</span>  <span class="token number">0</span><span class="token operator">--</span>M<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>SrSwSx <span class="token operator">-&gt;</span> <span class="token number">0x1</span><span class="token operator">:</span><span class="token number">00000000</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>Iprot

<span class="token comment">//&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x7ED3;&#x675F;, &#x6CA1;&#x6BDB;&#x75C5;.</span>
</code></pre>
<hr>
<p>MMU_init&#x6709;&#x95EE;&#x9898;!</p>
<pre class="language-"><code class="lang-c">c00003d4<span class="token operator">:</span>       <span class="token number">48</span> <span class="token number">64</span> <span class="token number">76</span> <span class="token number">6</span>d     bl      c0647a40 <span class="token operator">&lt;</span>MMU_init<span class="token operator">&gt;</span>
    <span class="token comment">//&#x8FD9;&#x91CC;&#x6709;&#x95EE;&#x9898;</span>
    c0647af8<span class="token operator">:</span>       <span class="token number">48</span> <span class="token number">00</span> <span class="token number">03</span> e5     bl      c0647edc <span class="token operator">&lt;</span>adjust_total_lowmem<span class="token operator">&gt;</span>
    <span class="token comment">//readelf vmlinux -a | grep -E &quot;total_lowmem|__max_low_memory&quot;</span>
    <span class="token comment">//__max_low_memory = c06a_8d20   30000000 00000000</span>
    <span class="token comment">//total_lowmem=c06b_8110   00000001 00000000</span>
    <span class="token comment">//&#x6240;&#x4EE5;&#x8FD9;&#x91CC;ram=768M</span>
    ram <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">phys_addr_t</span><span class="token punctuation">)</span>__max_low_memory<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">phys_addr_t</span><span class="token punctuation">)</span>total_lowmem<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//&#x540E;&#x8BB0;: &#x8FD9;&#x91CC;&#x6709;&#x95EE;&#x9898;, &#x672C;&#x610F;&#x662F;&#x4ECE;as0&#x7A7A;&#x95F4;&#x5207;&#x6362;&#x5230;as1&#x7A7A;&#x95F4;. </span>
    <span class="token comment">//&#x662F;git show 78a235efdc42ff363de81fdbc171385e8b86b69b &#x4FEE;&#x6539;&#x7684;: &#x5927;&#x610F;&#x662F;&#x7528;tlb1&#x6765;map&#x7B2C;&#x4E00;&#x4E2A;tlb&#x7684;&#x65F6;&#x5019;, &#x9ED8;&#x8BA4;&#x662F;map 64M &#x7ED9;kernel&#x4F7F;&#x7528;. &#x4F46;&#x6709;&#x65F6;&#x5019;64M&#x4E0D;&#x591F;, &#x6240;&#x4EE5;&#x4ED6;&#x8981;&#x5207;&#x6362;&#x5230;AS1. </span>
    <span class="token comment">//&#x6CE8;&#x91CA;&#x6389;&#x5C31;&#x597D;&#x4E86;.</span>
    i <span class="token operator">=</span> <span class="token function">switch_to_as1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> virt <span class="token operator">=</span> PAGE_OFFSET<span class="token punctuation">;</span>
    <span class="token comment">//readelf vmlinux -a | grep memstart_addr</span>
    <span class="token comment">//&#x8FD9;&#x91CC;&#x7684;memstart_addr&#x4F3C;&#x4E4E;&#x5E94;&#x8BE5;&#x662F;&#x5B9E;&#x9645;&#x7269;&#x7406;&#x5730;&#x5740;&#x624D;&#x597D;, &#x4F46;&#x8FD9;&#x91CC;&#x5168;&#x662F;0</span>
    <span class="token comment">//memstart_addr = c06a_8d28   00000000 00000000</span>
    <span class="token class-name">phys_addr_t</span> phys <span class="token operator">=</span> memstart_addr<span class="token punctuation">;</span>

    <span class="token comment">/*
     * Create a tlb entry with the same effective and physical address as
     * the tlb entry used by the current running code. But set the TS to 1.
     * Then switch to the address space 1. It will return with the r3 set to
     * the ESEL of the new created tlb.
     */</span>
    c0647f1c<span class="token operator">:</span>       <span class="token number">4</span>b <span class="token number">9</span>b <span class="token number">9</span>e <span class="token number">01</span>     bl      c0001d1c <span class="token operator">&lt;</span>switch_to_as1<span class="token operator">&gt;</span>
    <span class="token comment">//&#x8FC7;&#x4E86;, &#x4F46;&#x591A;&#x4E86;&#x4E00;&#x4E2A;tlb entry(&#x5E8F;&#x53F7;63), &#x548C;entry0&#x4E00;&#x6837;, &#x4F46;&#x591A;&#x4E86;Ts&#x6807;&#x8BB0;;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment">//&#x8FD9;&#x91CC;&#x6709;&#x95EE;&#x9898;</span>
    c0647f30<span class="token operator">:</span>       <span class="token number">4</span>b <span class="token number">9</span>c bc <span class="token number">19</span>     bl      c0013b48 <span class="token operator">&lt;</span>map_mem_in_cams<span class="token operator">&gt;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token keyword">struct</span> <span class="token class-name">tlbcamrange</span> <span class="token punctuation">{</span>
            <span class="token keyword">unsigned</span> <span class="token keyword">long</span> start<span class="token punctuation">;</span>
            <span class="token keyword">unsigned</span> <span class="token keyword">long</span> limit<span class="token punctuation">;</span>
            <span class="token class-name">phys_addr_t</span> phys<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> tlbcam_addrs<span class="token punctuation">[</span>NUM_TLBCAMS<span class="token punctuation">]</span><span class="token punctuation">;</span>

        &#x5F3A;&#x5236;phys <span class="token operator">=</span> <span class="token number">0x100000000</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x5728;for&#x4EE5;&#x540E;</span>
        <span class="token comment">//readelf vmlinux -a | grep tlbcam_addrs</span>
        ppcP3041<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>s<span class="token punctuation">]</span> <span class="token operator">%</span> md <span class="token number">0xc06bacc8</span>
        <span class="token number">0xc06bacc8</span><span class="token operator">:</span>
        c06b_acc8   c0000000 cfffffff <span class="token number">00000001</span> <span class="token number">00000000</span>              <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        c06b_acd8   d0000000 dfffffff <span class="token number">00000001</span> <span class="token number">10000000</span>              <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        c06b_ace8   e0000000 efffffff <span class="token number">00000001</span> <span class="token number">20000000</span>              <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        c06b_acf8   <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span>              <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token comment">// arch/powerpc/mm/tlb_nohash_low.S</span>
        <span class="token function">loadcam_multi</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> max_cam_idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        c0013938<span class="token operator">:</span>       <span class="token number">7</span>d <span class="token number">08</span> <span class="token number">02</span> a6     mflr    r8

    <span class="token comment">//&#x8FD4;&#x56DE;as0&#x7A7A;&#x95F4;</span>
    <span class="token function">restore_to_as0</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">_GLOBAL</span><span class="token punctuation">(</span>loadcam_multi<span class="token punctuation">)</span>
c0013938<span class="token operator">:</span>       <span class="token number">7</span>d <span class="token number">08</span> <span class="token number">02</span> a6     mflr    r8

<span class="token comment">//&#x7528;bl&#x548C;mfbl&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x865A;&#x62DF;&#x5730;&#x5740;, &#x589E;&#x52A0;&#x4E00;&#x6761;tlb entry</span>
c0013968<span class="token operator">:</span>       <span class="token number">7</span>c <span class="token number">00</span> <span class="token number">07</span> a4     tlbwe
<span class="token comment">//&#x518D;&#x589E;&#x52A0;&#x4E00;&#x6761;tlb, &#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x5730;&#x5740;&#x7A7A;&#x95F4;?</span>
ppcP3041<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>s<span class="token punctuation">]</span> <span class="token operator">%</span> tlbr <span class="token operator">*</span>
idx w vaddr      GsLpidVTsSizeTidWIMGEUrUwUxSrSwSx    paddr        VfX0X1U0U1U2U3Iprot
  <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0xc0000000</span> <span class="token operator">--</span>   <span class="token number">0</span>V<span class="token operator">--</span>   <span class="token number">8</span>  <span class="token number">0</span><span class="token operator">--</span>M<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>SrSwSx <span class="token operator">-&gt;</span> <span class="token number">0x1</span><span class="token operator">:</span><span class="token number">00000000</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>Iprot
  <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0x00000000</span> <span class="token operator">--</span>   <span class="token number">0</span><span class="token operator">--</span><span class="token operator">-</span>   a  <span class="token number">0</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>UrUwUxSrSwSx <span class="token operator">-&gt;</span> <span class="token number">0x1</span><span class="token operator">:</span><span class="token number">00000000</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
  <span class="token number">2</span> <span class="token number">0</span> <span class="token number">0x00000000</span> <span class="token operator">--</span>   <span class="token number">0</span><span class="token operator">-</span>Ts   <span class="token number">1</span>  <span class="token number">0</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>SrSwSx <span class="token operator">-&gt;</span> <span class="token number">0x1</span><span class="token operator">:</span><span class="token number">00000000</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
  <span class="token number">3</span> <span class="token number">0</span> <span class="token number">0xc0000000</span> <span class="token operator">--</span>   <span class="token number">0</span>VTs   <span class="token number">8</span>  <span class="token number">0</span><span class="token operator">--</span>M<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>SrSwSx <span class="token operator">-&gt;</span> <span class="token number">0x1</span><span class="token operator">:</span><span class="token number">00000000</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>Iprot

<span class="token comment">/* Switch to AS=1 */</span> <span class="token operator">--</span>&#x672C;&#x6765;&#x5C31;&#x662F;AS1&#x7A7A;&#x95F4;&#x5440;<span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>
c0013970<span class="token operator">:</span>       <span class="token number">7</span>c c0 <span class="token number">00</span> a6     mfmsr   r6
<span class="token comment">//ori r6,r6,MSR_IS|MSR_DS</span>
c0013974<span class="token operator">:</span>       <span class="token number">60</span> c6 <span class="token number">00</span> <span class="token number">30</span>     ori     r6<span class="token punctuation">,</span>r6<span class="token punctuation">,</span><span class="token number">48</span>
c0013978<span class="token operator">:</span>       <span class="token number">7</span>c c0 <span class="token number">01</span> <span class="token number">24</span>     mtmsr   r6
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

c0013988<span class="token operator">:</span>       <span class="token number">4</span>b ff ff <span class="token number">59</span>     bl      c00138e0 <span class="token operator">&lt;</span>loadcam_entry<span class="token operator">&gt;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token function">_GLOBAL</span><span class="token punctuation">(</span>loadcam_entry<span class="token punctuation">)</span>
c00138e0<span class="token operator">:</span>       <span class="token number">7</span>c a8 <span class="token number">02</span> a6     mflr    r5
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
c0013928<span class="token operator">:</span>       <span class="token number">4</span>c <span class="token number">00</span> <span class="token number">01</span> <span class="token number">2</span>c     isync
c001392c<span class="token operator">:</span>       <span class="token number">7</span>c <span class="token number">00</span> <span class="token number">07</span> a4     tlbwe    <span class="token comment">// &lt;--&#x8FD9;&#x884C;&#x6267;&#x884C;&#x540E;, 0xc0000000&#x88AB;map&#x5230;0x0:00000000; &#x5F3A;&#x5236;4G&#x7269;&#x7406;&#x5730;&#x5740;&#x540E;, &#x8FD8;&#x662F;&#x5F02;&#x5E38;.</span>
c0013930<span class="token operator">:</span>       <span class="token number">4</span>c <span class="token number">00</span> <span class="token number">01</span> <span class="token number">2</span>c     isync   <span class="token comment">// &lt;--&#x8FD9;&#x91CC;&#x5F02;&#x5E38;</span>
</code></pre>
<h2 id="&#x603B;&#x7ED3;-&#x8FD9;&#x91CC;&#x5B9E;&#x9645;&#x4E0A;&#x6709;&#x4E24;&#x4E2A;&#x95EE;&#x9898;"><a name="&#x603B;&#x7ED3;-&#x8FD9;&#x91CC;&#x5B9E;&#x9645;&#x4E0A;&#x6709;&#x4E24;&#x4E2A;&#x95EE;&#x9898;" class="anchor-navigation-ex-anchor" href="#&#x603B;&#x7ED3;-&#x8FD9;&#x91CC;&#x5B9E;&#x9645;&#x4E0A;&#x6709;&#x4E24;&#x4E2A;&#x95EE;&#x9898;"><i class="fa fa-link" aria-hidden="true"></i></a>1.8. &#x603B;&#x7ED3;: &#x8FD9;&#x91CC;&#x5B9E;&#x9645;&#x4E0A;&#x6709;&#x4E24;&#x4E2A;&#x95EE;&#x9898;</h2>
<ul>
<li>map_mem_in_cams()&#x51FD;&#x6570;&#x8D1F;&#x8D23;map kernel&#x7684;lowmem, &#x6240;&#x8C13;kernel&#x7684;lowmem&#x5C31;&#x662F;0xc0000000&#x5F00;&#x59CB;&#x7684;768M, PPC&#x7528;3&#x6761;TLB&#x6765;&#x505A;&#x56FA;&#x5B9A;&#x6620;&#x5C04;. kmalloc&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4ECE;&#x8FD9;&#x6BB5;&#x533A;&#x57DF;&#x76F4;&#x63A5;&#x7533;&#x8BF7;&#x5185;&#x5B58;. &#x770B;&#x8D77;&#x6765;&#x5E94;&#x8BE5;&#x662F;&#x8FD9;&#x6837;: 0xc0000000, 0xd0000000, 0xe0000000&#x5404;256M<pre class="language-"><code>ppcP3041[0,h] % tlbr *
idx w vaddr      GsLpidVTsSizeTidWIMGEUrUwUxSrSwSx    paddr        VfX0X1U0U1U2U3Iprot
0 0 0xc0000000 --   0V--   9  0--M--------SrSwSx -&gt; 0x1:00000000 --------------Iprot
1 0 0xd0000000 --   0V--   9  0--M--------SrSwSx -&gt; 0x1:10000000 --------------Iprot
2 0 0xe0000000 --   0V--   9  0--M--------SrSwSx -&gt; 0x1:20000000 --------------Iprot
</code></pre>map_mem_in_cams()&#x51FD;&#x6570;, &#x4ECE;memsart_addr&#x83B7;&#x53D6;&#x7269;&#x7406;&#x5730;&#x5740;, &#x4F5C;&#x4E3A;0xc0000000&#x5BF9;&#x5E94;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;.<br><code>phys_addr_t phys = memstart_addr;</code><br>&#x800C;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x5230;&#x8FD9;&#x91CC;&#x7684;&#x65F6;&#x5019;, memstart_addr&#x4E3A;0.</li>
</ul>
<p>&#x5728;default&#x5206;&#x652F;&#x4E0A;&#x7684;&#x4E5F;&#x4FEE;&#x590D;&#x4E86;&#x540C;&#x6837;&#x7684;&#x95EE;&#x9898;. &#x8BE5;&#x95EE;&#x9898;&#x7684;&#x6839;&#x672C;&#x539F;&#x56E0;&#x662F;&#x6211;&#x4EEC;&#x914D;&#x7F6E;&#x4E86;ddr&#x5728;4G&#x5F00;&#x59CB;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;.</p>
<ul>
<li>upstream&#x7684;&#x4E00;&#x4E2A;&#x4FEE;&#x6539;&#x4E5F;&#x4F1A;&#x9020;&#x6210;&#x5F02;&#x5E38;: </li>
</ul>
<pre class="language-"><code>git show 78a235efdc42ff363de81fdbc171385e8b86b69b
commit 78a235efdc42ff363de81fdbc171385e8b86b69b
Author: Kevin Hao <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>haokexin@gmail.com</span><span class="token punctuation">&gt;</span></span>
Date:   Tue Dec 24 15:12:07 2013 +0800

    powerpc/fsl_booke: set the tlb entry for the kernel address in AS1

    We use the tlb1 entries to map low mem to the kernel space. In the
    current code, it assumes that the first tlb entry would cover the
    kernel image. But this is not true for some special cases, such as
    when we run a relocatable kernel above the 64M or set
    CONFIG_KERNEL_START above 64M. So we choose to switch to address
    space 1 before setting these tlb entries.

    Signed-off-by: Kevin Hao <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>haokexin@gmail.com</span><span class="token punctuation">&gt;</span></span>
    Signed-off-by: Scott Wood <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scottwood@freescale.com</span><span class="token punctuation">&gt;</span></span>
</code></pre><ul>
<li>&#x6682;&#x65F6;&#x4FEE;&#x6539;:</li>
</ul>
<pre class="language-"><code class="lang-diff">$ hg diff arch/powerpc/mm/fsl_booke_mmu.c
diff --git a/arch/powerpc/mm/fsl_booke_mmu.c b/arch/powerpc/mm/fsl_booke_mmu.c
<span class="token coord">--- a/arch/powerpc/mm/fsl_booke_mmu.c</span>
<span class="token coord">+++ b/arch/powerpc/mm/fsl_booke_mmu.c</span>
@@ -212,6 +212,10 @@ unsigned long map_mem_in_cams(unsigned l
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       unsigned long virt = PAGE_OFFSET;
</span><span class="token prefix unchanged"> </span><span class="token line">       phys_addr_t phys = memstart_addr;
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       phys = 0x100000000;
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">       pr_info(&quot;low mem: virt = 0x%lx, phys = %pa \n&quot;, virt, &amp;phys);
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       return map_mem_in_cams_addr(phys, virt, ram, max_cam_idx, dryrun);
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span>
@@ -242,9 +246,9 @@ void __init adjust_total_lowmem(void)
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       /* adjust lowmem size to __max_low_memory */
</span><span class="token prefix unchanged"> </span><span class="token line">       ram = min((phys_addr_t)__max_low_memory, (phys_addr_t)total_lowmem);
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       i = switch_to_as1();
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       //i = switch_to_as1();
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       __max_low_memory = map_mem_in_cams(ram, CONFIG_LOWMEM_CAM_NUM, false);
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       restore_to_as0(i, 0, 0, 1);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       //restore_to_as0(i, 0, 0, 1);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       pr_info(&quot;Memory CAM mapping: &quot;);
</span><span class="token prefix unchanged"> </span><span class="token line">       for (i = 0; i &lt; tlbcam_index - 1; i++)
</span></span>
diff --git a/drivers/of/fdt.c b/drivers/of/fdt.c
<span class="token coord">--- a/drivers/of/fdt.c</span>
<span class="token coord">+++ b/drivers/of/fdt.c</span>
@@ -1044,7 +1044,8 @@ int __init early_init_dt_scan_memory(uns

<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       endp = reg + (l / sizeof(__be32));
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       pr_debug(&quot;memory scan node %s, reg size %d,\n&quot;, uname, l);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       pr_info(&quot;memory scan node %s, reg size %d,\n&quot;, uname, l);
</span><span class="token prefix inserted">+</span><span class="token line">       pr_info(&quot;reg: %lx, %lx, %lx, %lx\n&quot;, *reg, *(reg+1),*(reg+2),*(reg+3));
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       while ((endp - reg) &gt;= (dt_root_addr_cells + dt_root_size_cells)) {
</span><span class="token prefix unchanged"> </span><span class="token line">               u64 base, size;
</span></span>@@ -1054,7 +1055,7 @@ int __init early_init_dt_scan_memory(uns

<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">               if (size == 0)
</span><span class="token prefix unchanged"> </span><span class="token line">                       continue;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">               pr_debug(&quot; - %llx ,  %llx\n&quot;, (unsigned long long)base,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">               pr_info(&quot; - %llx ,  %llx\n&quot;, (unsigned long long)base,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">                   (unsigned long long)size);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">               early_init_dt_add_memory_arch(base, size);
</span></span></code></pre>
<h2 id="&#x90A3;&#x4E48;switchtoas1&#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4F5C;&#x7528;"><a name="&#x90A3;&#x4E48;switchtoas1&#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4F5C;&#x7528;" class="anchor-navigation-ex-anchor" href="#&#x90A3;&#x4E48;switchtoas1&#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4F5C;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>1.9. &#x90A3;&#x4E48;switch_to_as1&#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4F5C;&#x7528;</h2>
<p>&#x6211;&#x4EEC;&#x4EE5;&#x4ECE;&#x6838;&#x542F;&#x52A8;&#x4E3A;&#x4F8B;, head.s&#x914D;&#x7F6E;&#x521D;&#x59CB;&#x7684;64M tlb for 0xc000_000&#x540E;, &#x8C03;&#x7528;&#x4E86;switch_to_as1.<br>&#x5728;&#x8C03;&#x7528;switch_to_as1&#x4E4B;&#x524D;, tlb&#x662F;:</p>
<pre class="language-"><code>idx w vaddr      GsLpidVTsSizeTidWIMGEUrUwUxSrSwSx    paddr        VfX0X1U0U1U2U3Iprot
  0 0 0xc0000000 --   0V--   8  0--M--------SrSwSx -&gt; 0x1:00000000 --------------Iprot
</code></pre><p>&#x8C03;&#x7528;&#x540E;, tlb&#x591A;&#x4E86;&#x4E00;&#x6761;&#x4E00;&#x6837;&#x7684;&#x6620;&#x5C04;, &#x4F46;&#x6709;Ts&#x6807;&#x8BB0;. Ts&#x7684;&#x89E3;&#x91CA;&#x662F;&quot;compared with AS of the current access&quot;, &#x5373;&#x5F53;&#x524D;&#x662F;&#x6307;&#x4EE4;access&#x8FD8;&#x662F;&#x6570;&#x636E;access, &#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x4E48;&#x5206;?</p>
<pre class="language-"><code>idx w vaddr      GsLpidVTsSizeTidWIMGEUrUwUxSrSwSx    paddr        VfX0X1U0U1U2U3Iprot
  0 0 0xc0000000 --   0V--   8  0--M--------SrSwSx -&gt; 0x1:00000000 --------------Iprot
 63 0 0xc0000000 --   0VTs   8  0--M--------SrSwSx -&gt; 0x1:00000000 --------------Iprot
</code></pre><h2 id="&#x4E3A;&#x4EC0;&#x4E48;memstartaddr&#x4E3A;0"><a name="&#x4E3A;&#x4EC0;&#x4E48;memstartaddr&#x4E3A;0" class="anchor-navigation-ex-anchor" href="#&#x4E3A;&#x4EC0;&#x4E48;memstartaddr&#x4E3A;0"><i class="fa fa-link" aria-hidden="true"></i></a>1.10. &#x4E3A;&#x4EC0;&#x4E48;memstart_addr&#x4E3A;0</h2>
<p>memstart_addr&#x662F;&#x4E2A;&#x5168;&#x5C40;&#x53D8;&#x91CF;, &#x5728;&#x8FD9;&#x4E2A;&#x5730;&#x5740;&#x6253;&#x786C;&#x4EF6;&#x65AD;&#x70B9;, &#x5199;&#x65F6;&#x89E6;&#x53D1;:</p>
<pre class="language-"><code>readelf -a vmlinux | grep memstart_addr
&#x5F97;&#x5230;c06a8d28
</code></pre><p>&#x518D;&#x6839;&#x636E;&#x65AD;&#x70B9;&#x7684;pc&#x5730;&#x5740;, &#x5F97;&#x5230;memstart_addr&#x5B9E;&#x9645;&#x662F;&#x5728;&#x4E0B;&#x9762;&#x7684;&#x51FD;&#x6570;&#x91CC;&#x4FEE;&#x6539;&#x7684;.memstart_addr&#x521D;&#x59CB;&#x503C;&#x662F;&#x5168;F</p>
<pre class="language-"><code>early_init_dt_scan_memory()
    early_init_dt_scan_memory()
        if (base &lt; memstart_addr) {
            memstart_addr = base;
            first_memblock_size = size;
        }
</code></pre><p>base&#x5730;&#x5740;&#x662F;&#x4ECE;dts&#x89E3;&#x6790;&#x7684;.
&#x5373;&#x4F7F;</p>
<pre class="language-"><code>        memory {
                reg = &lt;0x00000001 0x00000001 0x00000001 0x00000008&gt;;
                device_type = &quot;memory&quot;;
        }
</code></pre><p>&#x4F46;uboot&#x8FD8;&#x662F;&#x4F1A;&#x6539;&#x6210;:</p>
<pre class="language-"><code>Freescale # fdt print /memory
memory {
        reg = &lt;0x00000000 0x00000000 0x00000001 0x00000000&gt;;
        device_type = &quot;memory&quot;;
};
</code></pre><p>reg&#x91CC;&#x9762;&#x7684;base&#x548C;size&#x90FD;&#x662F;2&#x4E2A;cell. &#x6240;&#x4EE5;uboot&#x914D;&#x6210;&#x4E86;base=0, size=4G</p>
<h2 id="&#x6700;&#x7EC8;&#x4FEE;&#x6539;"><a name="&#x6700;&#x7EC8;&#x4FEE;&#x6539;" class="anchor-navigation-ex-anchor" href="#&#x6700;&#x7EC8;&#x4FEE;&#x6539;"><i class="fa fa-link" aria-hidden="true"></i></a>1.11. &#x6700;&#x7EC8;&#x4FEE;&#x6539;</h2>
<ul>
<li>&#x4FEE;&#x6539;dts:</li>
</ul>
<pre class="language-"><code class="lang-diff">$ hg diff board/fant/fant-3041.dts
diff --git a/board/fant/fant-3041.dts b/board/fant/fant-3041.dts
<span class="token coord">--- a/board/fant/fant-3041.dts</span>
<span class="token coord">+++ b/board/fant/fant-3041.dts</span>
<span class="token coord">@@ -35,7 +35,18 @@</span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       };
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       memory {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">               reg = &lt;0x0 0x0 0x1 0x0&gt;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">               /* fant configs DDR to start from 4G in bootprom/uboot
</span><span class="token prefix inserted">+</span><span class="token line">               *  We pass physical ddr start address:0x100000000 to let
</span><span class="token prefix inserted">+</span><span class="token line">               *  kernel know which physical address should map to 0xc0000000
</span><span class="token prefix inserted">+</span><span class="token line">               *  Previously this was done by adding PHYSICAL_START_ADDR = 0x100000000
</span><span class="token prefix inserted">+</span><span class="token line">               *  to kernel config in kernel 3.12
</span><span class="token prefix inserted">+</span><span class="token line">               *  Check uboot ft_board_setup(), ensure it does not change
</span><span class="token prefix inserted">+</span><span class="token line">               *  the base address here.
</span><span class="token prefix inserted">+</span><span class="token line">               *  The misconfigured base address(eg. 0x0) causes kernel not boot.
</span><span class="token prefix inserted">+</span><span class="token line">               *  As a down-side, we pass a fixed ddr size, because we don&apos;t
</span><span class="token prefix inserted">+</span><span class="token line">               *  want uboot to do fdt_fixup_memory(), which forces the base to be 0x0.
</span><span class="token prefix inserted">+</span><span class="token line">               */
</span><span class="token prefix inserted">+</span><span class="token line">               reg = &lt;0x00000001 0x00000000 0x00000001 0x00000000&gt;;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">               device_type = &quot;memory&quot;;
</span><span class="token prefix unchanged"> </span><span class="token line">       };
</span></span></code></pre>
<ul>
<li>&#x4FEE;&#x6539;uboot: </li>
</ul>
<pre class="language-"><code class="lang-diff">$ hg diff
diff --git a/board/freescale/board.c b/board/freescale/board.c
<span class="token coord">--- a/board/freescale/board.c</span>
<span class="token coord">+++ b/board/freescale/board.c</span>
@@ -750,15 +750,18 @@ phys_size_t board_get_bootm_size(void)

<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">int ft_board_setup(void *blob, bd_t * bd)
</span><span class="token prefix unchanged"> </span><span class="token line">{
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    int ret = 0;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       ft_cpu_setup(blob, bd);
</span><span class="token prefix inserted">+</span><span class="token line">#if 0
</span><span class="token prefix inserted">+</span><span class="token line">/* don&apos;t overwrite base to 0, base must be set in .dts file
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       phys_addr_t base;
</span><span class="token prefix unchanged"> </span><span class="token line">       phys_size_t size;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       ft_cpu_setup(blob, bd);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       base = getenv_bootm_low();
</span><span class="token prefix unchanged"> </span><span class="token line">       size = board_get_bootm_size();
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       fdt_fixup_memory(blob, (u64) base, (u64) size);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">*/
</span><span class="token prefix inserted">+</span><span class="token line">#endif
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       board_reserve_memory(blob);
</span></span></code></pre>
<h1 id="&#x9A71;&#x52A8;&#x95EE;&#x9898;"><a name="&#x9A71;&#x52A8;&#x95EE;&#x9898;" class="anchor-navigation-ex-anchor" href="#&#x9A71;&#x52A8;&#x95EE;&#x9898;"><i class="fa fa-link" aria-hidden="true"></i></a>2. &#x9A71;&#x52A8;&#x95EE;&#x9898;</h1>
<h2 id="&#x5185;&#x6838;&#x4E0D;&#x518D;&#x6709;irqfdisabled"><a name="&#x5185;&#x6838;&#x4E0D;&#x518D;&#x6709;irqfdisabled" class="anchor-navigation-ex-anchor" href="#&#x5185;&#x6838;&#x4E0D;&#x518D;&#x6709;irqfdisabled"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. &#x5185;&#x6838;&#x4E0D;&#x518D;&#x6709;IRQF_DISABLED</h2>
<p>&#x4ECE;4.1&#x5F00;&#x59CB;, &#x5185;&#x6838;&#x4E0D;&#x518D;&#x6709;IRQF_DISABLED</p>
<pre class="language-"><code>commit d8bf368d0631d4bc2612d8bf2e4e8e74e620d0cc
Author: Valentin Rothberg <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>valentinrothberg@gmail.com</span><span class="token punctuation">&gt;</span></span>
Date:   Thu Mar 5 15:23:08 2015 +0100

    genirq: Remove the deprecated &apos;IRQF_DISABLED&apos; request_irq() flag entirely

    The IRQF_DISABLED flag is a NOOP and has been scheduled for removal
    since Linux v2.6.36 by commit 6932bf37bed4 (&quot;genirq: Remove
    IRQF_DISABLED from core code&quot;).

    According to commit e58aa3d2d0cc (&quot;genirq: Run irq handlers with
    interrupts disabled&quot;), running IRQ handlers with interrupts
    enabled can cause stack overflows when the interrupt line of the
    issuing device is still active.

    This patch ends the grace period for IRQF_DISABLED (i.e.,
    SA_INTERRUPT in older versions of Linux) and removes the
    definition and all remaining usages of this flag.
</code></pre><h3 id="&#x4FEE;&#x6539;"><a name="&#x4FEE;&#x6539;" class="anchor-navigation-ex-anchor" href="#&#x4FEE;&#x6539;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.1. &#x4FEE;&#x6539;</h3>
<p>&#x5220;&#x6389;</p>
<h2 id="&#x5185;&#x6838;&#x4E0D;&#x518D;&#x63D0;&#x4F9B;memoryaccessor"><a name="&#x5185;&#x6838;&#x4E0D;&#x518D;&#x63D0;&#x4F9B;memoryaccessor" class="anchor-navigation-ex-anchor" href="#&#x5185;&#x6838;&#x4E0D;&#x518D;&#x63D0;&#x4F9B;memoryaccessor"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. &#x5185;&#x6838;&#x4E0D;&#x518D;&#x63D0;&#x4F9B;memory_accessor</h2>
<pre class="language-"><code>/*
 * &apos;struct memory_accessor&apos; is a generic interface to provide
 * in-kernel access to persistent memory such as i2c or SPI EEPROMs
 */
struct memory_accessor {
    ssize_t (*read)(struct memory_accessor *, char *buf, off_t offset,
            size_t count);
    ssize_t (*write)(struct memory_accessor *, const char *buf,
             off_t offset, size_t count);
};
</code></pre><p>&#x4ECE;kernel4.6&#x5F00;&#x59CB;, &#x5185;&#x6838;&#x4E0D;&#x518D;&#x63D0;&#x4F9B;memory_accessor</p>
<pre class="language-"><code>commit bec3c11bad0e7ac05fb90f204d0ab6f79945822b
Author: Andrew Lunn <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>andrew@lunn.ch</span><span class="token punctuation">&gt;</span></span>
Date:   Fri Feb 26 20:59:24 2016 +0100

    misc: at24: replace memory_accessor with nvmem_device_read

    Now that the AT24 uses the NVMEM framework, replace the
    memory_accessor in the setup() callback with nvmem API calls.

commit 3ccea0e1fdf896645f8cccddcfcf60cb289fdf76
Author: Andrew Lunn <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>andrew@lunn.ch</span><span class="token punctuation">&gt;</span></span>
Date:   Fri Feb 26 20:59:21 2016 +0100
    eeprom: at25: Remove in kernel API for accessing the EEPROM
    The setup() callback is not used by any in kernel code. Remove it.
    Any new code which requires access to the eeprom can use the NVMEM
    API.
</code></pre><h3 id="&#x4FEE;&#x6539;_1"><a name="&#x4FEE;&#x6539;_1" class="anchor-navigation-ex-anchor" href="#&#x4FEE;&#x6539;_1"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.1. &#x4FEE;&#x6539;</h3>
<p>&#x53BB;&#x6389;&#x8BE5;&#x5F15;&#x7528;</p>
<h2 id="gpio&#x7684;gpiochipremove&#x51FD;&#x6570;&#x4E0D;&#x518D;&#x8FD4;&#x56DE;int"><a name="gpio&#x7684;gpiochipremove&#x51FD;&#x6570;&#x4E0D;&#x518D;&#x8FD4;&#x56DE;int" class="anchor-navigation-ex-anchor" href="#gpio&#x7684;gpiochipremove&#x51FD;&#x6570;&#x4E0D;&#x518D;&#x8FD4;&#x56DE;int"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. gpio&#x7684;gpiochip_remove()&#x51FD;&#x6570;&#x4E0D;&#x518D;&#x8FD4;&#x56DE;int</h2>
<p>&#x4ECE;3.18&#x5F00;&#x59CB;, <code>gpiochip_remove()</code>&#x8FD4;&#x56DE;void</p>
<h3 id="&#x4FEE;&#x6539;_2"><a name="&#x4FEE;&#x6539;_2" class="anchor-navigation-ex-anchor" href="#&#x4FEE;&#x6539;_2"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.1. &#x4FEE;&#x6539;</h3>
<pre class="language-"><code>+#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(3,18,0)
+       gpiochip_remove(chip);
+       return 0;
+#else
        return gpiochip_remove(chip);
+#endif
</code></pre><h2 id="gpio&#x6CA1;&#x6709;member-dev"><a name="gpio&#x6CA1;&#x6709;member-dev" class="anchor-navigation-ex-anchor" href="#gpio&#x6CA1;&#x6709;member-dev"><i class="fa fa-link" aria-hidden="true"></i></a>2.4. gpio&#x6CA1;&#x6709;member dev</h2>
<p>&#x4ECE;kernel4.5&#x5F00;&#x59CB;, <code>include/linux/gpio/driver.h</code>&#x91CC;
<code>struct  gpio_chip</code>&#x628A;<code>dev</code>&#x6210;&#x5458;&#x6539;&#x4E3A;&#x4E86;<code>parent</code></p>
<pre class="language-"><code>commit 58383c78425e4ee1c077253cf297b641c861c02e
Author: Linus Walleij <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>linus.walleij@linaro.org</span><span class="token punctuation">&gt;</span></span>
Date:   Wed Nov 4 09:56:26 2015 +0100

    gpio: change member .dev to .parent

    The name .dev in a struct is normally reserved for a struct device
    that is let us say a superclass to the thing described by the struct.
    struct gpio_chip stands out by confusingly using a struct device *dev
    to point to the parent device (such as a platform_device) that
    represents the hardware. As we want to give gpio_chip:s real devices,
    this is not working. We need to rename this member to parent.
</code></pre><h3 id="&#x4FEE;&#x6539;_3"><a name="&#x4FEE;&#x6539;_3" class="anchor-navigation-ex-anchor" href="#&#x4FEE;&#x6539;_3"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.1. &#x4FEE;&#x6539;</h3>
<pre class="language-"><code class="lang-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">               chip-&gt;label = &quot;gpio-cpld&quot;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(4,5,0)
</span><span class="token prefix inserted">+</span><span class="token line">               chip-&gt;parent = &amp;pdev-&gt;dev;
</span><span class="token prefix inserted">+</span><span class="token line">#else
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">               chip-&gt;dev = &amp;pdev-&gt;dev;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">#endif
</span></span></code></pre>
<h2 id="noreturn&#x7F16;&#x8BD1;&#x6807;&#x8BB0;"><a name="noreturn&#x7F16;&#x8BD1;&#x6807;&#x8BB0;" class="anchor-navigation-ex-anchor" href="#noreturn&#x7F16;&#x8BD1;&#x6807;&#x8BB0;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5. __noreturn&#x7F16;&#x8BD1;&#x6807;&#x8BB0;</h2>
<p>&#x4ECE;4.8&#x5F00;&#x59CB;, PPC&#x7684;kernel&#x8981;&#x6C42;<code>ppc_md.{halt, restart}</code>&#x6709;<code>__noreturn</code>&#x7F16;&#x8BD1;&#x6807;&#x8BB0;</p>
<pre class="language-"><code>Linux Mint 19.1 Tessa $ git log -S __noreturn arch/powerpc/include/asm/machdep.h
commit 95ec77c06e8e63fff50c497eca0668bf6da39813
Author: Daniel Axtens <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dja@axtens.net</span><span class="token punctuation">&gt;</span></span>
Date:   Tue Jul 12 10:54:52 2016 +1000

    powerpc: Make ppc_md.{halt, restart} __noreturn

    powernv marks it&apos;s halt and restart calls as __noreturn. However,
    ppc_md does not have this annotation. Add the annotation to ppc_md,
    and then to every halt/restart function that is missing it.

    Additionally, I have verified that all of these functions do not
    return. Occasionally I have added a spin loop to be sure.

    Signed-off-by: Daniel Axtens <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dja@axtens.net</span><span class="token punctuation">&gt;</span></span>
    Signed-off-by: Michael Ellerman <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mpe@ellerman.id.au</span><span class="token punctuation">&gt;</span></span>

# &#x67E5;&#x7248;&#x672C;
git describe --contains 95ec77c06e8e63fff50c497eca0668bf6da39813
v4.8-rc1~85^2~97
</code></pre><p>&#x800C;<code>reboot_helper/reboot_helper.c</code>&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x6807;&#x8BB0;, &#x7F16;&#x8BD1;&#x4E0D;&#x901A;&#x8FC7;.</p>
<h3 id="&#x771F;&#x7684;&#x8981;noreturn&#x5417;"><a name="&#x771F;&#x7684;&#x8981;noreturn&#x5417;" class="anchor-navigation-ex-anchor" href="#&#x771F;&#x7684;&#x8981;noreturn&#x5417;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.1. &#x771F;&#x7684;&#x8981;noreturn&#x5417;?</h3>
<p>&#x5728;<code>/home/coder/project/linux-fsl/arch/powerpc/kernel/setup-common.c</code>&#x4E2D;,
&#x5982;&#x679C;<code>ppc_md.restart(cmd)</code>&#x4E0D;&#x8FD4;&#x56DE;, &#x540E;&#x9762;&#x4E0D;&#x5C31;&#x6CA1;&#x6CD5;&#x6267;&#x884C;&#x4E86;&#x5417;?</p>
<pre class="language-"><code>void kernel_restart(char *cmd)
{
    kernel_restart_prepare(cmd);
    migrate_to_reboot_cpu();
    syscore_shutdown();
    if (!cmd)
        pr_emerg(&quot;Restarting system\n&quot;);
    else
        pr_emerg(&quot;Restarting system with command &apos;%s&apos;\n&quot;, cmd);
    kmsg_dump(KMSG_DUMP_RESTART);
    machine_restart(cmd);
}

void  machine_restart(char  *cmd)
{
    machine_shutdown();
    if (ppc_md.restart)
        ppc_md.restart(cmd);

    smp_send_stop();

    do_kernel_restart(cmd);
    mdelay(1000);

    machine_hang();
}
</code></pre><h3 id="option1-&#x4FEE;&#x6539;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;driver"><a name="option1-&#x4FEE;&#x6539;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;driver" class="anchor-navigation-ex-anchor" href="#option1-&#x4FEE;&#x6539;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;driver"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.2. option1: &#x4FEE;&#x6539;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;driver</h3>
<pre class="language-"><code>#include &lt;linux/version.h&gt;

diff --git a/reboot_helper/reboot_helper.c b/reboot_helper/reboot_helper.c
--- a/reboot_helper/reboot_helper.c
+++ b/reboot_helper/reboot_helper.c
@@ -166,6 +166,9 @@ static void machine_restart_warm(char *c
 {
        preserve_ram_contents();
 }
+#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(4,8,0)
+static __noreturn void machine_restart_warm(char *cmd);
+#endif
</code></pre><h3 id="&#x6216;&#x8005;"><a name="&#x6216;&#x8005;" class="anchor-navigation-ex-anchor" href="#&#x6216;&#x8005;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.3. &#x6216;&#x8005;</h3>
<p>&#x4F7F;&#x7528;
<code>register_reboot_notifier</code>, &#x4F1A;&#x5728;<code>kernel_restart_prepare</code>&#x8C03;&#x7528;
<code>register_restart_handler</code>, &#x4F1A;&#x5728;&#x6700;&#x540E;<code>do_kernel_restart</code>&#x8C03;&#x7528;</p>
<h3 id="option2-&#x4FEE;&#x6539;kernel-&#x53BB;&#x6389;noreturn&#x8981;&#x6C42;"><a name="option2-&#x4FEE;&#x6539;kernel-&#x53BB;&#x6389;noreturn&#x8981;&#x6C42;" class="anchor-navigation-ex-anchor" href="#option2-&#x4FEE;&#x6539;kernel-&#x53BB;&#x6389;noreturn&#x8981;&#x6C42;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.4. option2: &#x4FEE;&#x6539;kernel, &#x53BB;&#x6389;noreturn&#x8981;&#x6C42;</h3>
<h1 id="kernel&#x4EE3;&#x7801;&#x8DEF;&#x5F84;"><a name="kernel&#x4EE3;&#x7801;&#x8DEF;&#x5F84;" class="anchor-navigation-ex-anchor" href="#kernel&#x4EE3;&#x7801;&#x8DEF;&#x5F84;"><i class="fa fa-link" aria-hidden="true"></i></a>3. kernel&#x4EE3;&#x7801;&#x8DEF;&#x5F84;</h1>
<p><a href="https://source.codeaurora.org/external/qoriq/qoriq-components" target="_blank">https://source.codeaurora.org/external/qoriq/qoriq-components</a>
<a href="https://source.codeaurora.org/external/qoriq/qoriq-components/yocto-sdk/log/?h=thud" target="_blank">https://source.codeaurora.org/external/qoriq/qoriq-components/yocto-sdk/log/?h=thud</a>
<a href="http://git.yoctoproject.org" target="_blank">http://git.yoctoproject.org</a></p>
<h2 id="kernel&#x8DEF;&#x5F84;"><a name="kernel&#x8DEF;&#x5F84;" class="anchor-navigation-ex-anchor" href="#kernel&#x8DEF;&#x5F84;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. kernel&#x8DEF;&#x5F84;</h2>
<p><a href="http://git.yoctoproject.org/cgit/cgit.cgi/linux-yocto-4.9/log/?h=standard/base" target="_blank">http://git.yoctoproject.org/cgit/cgit.cgi/linux-yocto-4.9/log/?h=standard/base</a></p>
<pre class="language-"><code>git clone https://git.yoctoproject.org/git/linux-yocto-4.9 -b standard/base --single-branch --depth=100
</code></pre><h2 id="uboot"><a name="uboot" class="anchor-navigation-ex-anchor" href="#uboot"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. uboot</h2>
<p><a href="https://source.codeaurora.org/external/qoriq/qoriq-components/u-boot/" target="_blank">https://source.codeaurora.org/external/qoriq/qoriq-components/u-boot/</a></p>
<pre class="language-"><code>git clone https://source.codeaurora.org/external/qoriq/qoriq-components/u-boot -b git.denx.de/master --single-branch --depth=100
</code></pre><h1 id="dts"><a name="dts" class="anchor-navigation-ex-anchor" href="#dts"><i class="fa fa-link" aria-hidden="true"></i></a>4. DTS</h1>
<h2 id="&#x53C2;&#x8003;-dts&#x8BF4;&#x660E;"><a name="&#x53C2;&#x8003;-dts&#x8BF4;&#x660E;" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x8003;-dts&#x8BF4;&#x660E;"><i class="fa fa-link" aria-hidden="true"></i></a>4.1. &#x53C2;&#x8003;: dts&#x8BF4;&#x660E;</h2>
<p><a href="https://github.com/raspberrypi/documentation/blob/master/configuration/device-tree.md" target="_blank">&#x6811;&#x8393;&#x6D3E;dts&#x8BF4;&#x660E;</a></p>
<h2 id="&#x7F16;&#x8BD1;dts"><a name="&#x7F16;&#x8BD1;dts" class="anchor-navigation-ex-anchor" href="#&#x7F16;&#x8BD1;dts"><i class="fa fa-link" aria-hidden="true"></i></a>4.2. &#x7F16;&#x8BD1;dts</h2>
<pre class="language-"><code>cd /repo/yingjieb/ms/buildrootppc/output/build/linux-custom

cp ../../../board/fant/fant-4040.dts arch/powerpc/boot/dts/
scripts/dtc/dtc -O dts arch/powerpc/boot/dts/fant-4040.dts -o full-ref.dts
</code></pre><h2 id="fman-frame-manager"><a name="fman-frame-manager" class="anchor-navigation-ex-anchor" href="#fman-frame-manager"><i class="fa fa-link" aria-hidden="true"></i></a>4.3. FMan: Frame Manager</h2>
<p>P4080&#x6709;&#x4E24;&#x4E2A;FMan</p>
<ul>
<li>kernel4.9
Documentation/devicetree/bindings/powerpc/fsl/fman.txt</li>
<li>kernel3.12
Documentation/devicetree/bindings/powerpc/fsl/fman_device_tree.txt</li>
</ul>
<h2 id="kernel49&#x548C;kernel312&#x7684;&#x90E8;&#x5206;dts&#x4E0D;&#x540C;&#x70B9;"><a name="kernel49&#x548C;kernel312&#x7684;&#x90E8;&#x5206;dts&#x4E0D;&#x540C;&#x70B9;" class="anchor-navigation-ex-anchor" href="#kernel49&#x548C;kernel312&#x7684;&#x90E8;&#x5206;dts&#x4E0D;&#x540C;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>4.4. kernel4.9&#x548C;kernel3.12&#x7684;&#x90E8;&#x5206;DTS&#x4E0D;&#x540C;&#x70B9;</h2>
<p>FMan&#x662F;&#x4E2A;&#x7EC4;&#x5408;, &#x5305;&#x62EC;:ports, MACs&#x7B49;.</p>
<ul>
<li><p>kernel4.9&#x7B80;&#x5316;&#x4E86;&#x914D;&#x7F6E;
&#x53BB;&#x6389;&#x4E86;Parser KeyGen Coarse-Classification Policer
&#x589E;&#x52A0;&#x4E86;IEEE1588(&#x7BA1;&#x4EE5;&#x592A;&#x7F51;&#x7CBE;&#x5BC6;&#x65F6;&#x949F;&#x540C;&#x6B65;&#x7684;)</p>
</li>
<li><p>compatible&#x53BB;&#x6389;&#x4E86;&quot;simple-bus&quot;</p>
</li>
<li><p>FMan&#x5185;&#x90E8;ram, &#x6240;&#x6709;FMan&#x5171;&#x4EAB;</p>
<pre class="language-"><code>muram@0 {
  compatible = &quot;fsl,fman-muram&quot;;
  ranges = &lt;0 0x000000 0x28000&gt;;
}
</code></pre></li>
<li><p>FMan port<br>&#x4E09;&#x79CD;&#x7C7B;&#x578B;:<br>Ethernet receiver (RX)<br>Ethernet transmitter (TX)<br>Offline/Host command (O/H)<br>compatible&#x5168;&#x53D8;&#x4E86;  </p>
<ul>
<li>4.9<br>&quot;fsl,fman-v2-port-rx&quot; for FManV2 RX ports<br>&quot;fsl,fman-v2-port-tx&quot; for FManV2 TX ports<br>&quot;fsl,fman-v2-port-oh&quot; for FManV2 OH ports<br>&#x8FD8;&#x6709;v3&#x7684;, &#x6BD4;&#x5982;<br>&quot;fsl,fman-v3-port-oh&quot; for FManV3 OH ports<br><img src="img/CPU_PPC_kernel&#x5347;&#x7EA7;&#x8BB0;&#x5F55;_20220920093157.png" alt="">  </li>
<li>3.12<br><img src="img/CPU_PPC_kernel&#x5347;&#x7EA7;&#x8BB0;&#x5F55;_20220920093214.png" alt="">  </li>
</ul>
</li>
<li><p>&#x53BB;&#x6389;&#x4E86;<br>&quot;fsl,fman-parser&quot; : &#x5BF9;incoming&#x7684;fame&#x7684;&#x62A5;&#x6587;&#x5934;&#x89E3;&#x6790;, &#x751F;&#x6210;&#x7ED3;&#x679C;<br>&quot;fsl,fman-keygen&quot; : &#x751F;&#x6210;key&#x7528;&#x6765;&#x5206;&#x53D1;&#x5230;&#x591A;Q<br>&quot;fsl,fman-cc&quot; : FMan&#x5185;&#x90E8;&#x7684;&#x6811;&#x7ED3;&#x6784;, &#x518D;&#x5206;&#x6D41;&#x8868;&#x4E2D;&#x641C;&#x7D22;, &#x7528;&#x6765;exact matching<br>&quot;fsl,fman-policer&quot; : &#x914D;&#x7F6E;&#x6D41;&#x7684;&#x4F18;&#x5148;&#x7EA7;<br>&quot;fsl,p4080-fman-bmi&quot;, &quot;fsl,fman-bmi&quot; : &#x548C;BMan&#x5BF9;&#x63A5;, &#x7528;&#x6765;alloc/free frame buffer<br>&quot;fsl,p4080-fman-qmi&quot;, &quot;fsl,fman-qmi&quot; : &#x548C;QMan&#x7684;&#x63A5;&#x53E3;, &#x7528;&#x6765;&#x628A;frame&#x63CF;&#x8FF0;&#x7B26;(FD)&#x5165;Q&#x548C;&#x51FA;Q</p>
</li>
<li><p>mEMAC/dTSEC/XGEC  </p>
<ul>
<li>4.9<br>&quot;fsl,fman-dtsec&quot; for dTSEC MAC<br>&quot;fsl,fman-xgec&quot; for XGEC MAC<br>&quot;fsl,fman-memac for mEMAC MAC<br><img src="img/CPU_PPC_kernel&#x5347;&#x7EA7;&#x8BB0;&#x5F55;_20220920093305.png" alt="">  </li>
<li>3.12<br>&#x5FC5;&#x987B;&#x6709;&quot;fsl,fman-mac&quot;<br>&quot;fsl,fman-mac-dtsec&quot;<br>&quot;fsl,fman-mac-xgec&quot;<br><img src="img/CPU_PPC_kernel&#x5347;&#x7EA7;&#x8BB0;&#x5F55;_20220920093330.png" alt="">  </li>
</ul>
</li>
<li><p>MDIO<br>&#x5185;&#x90E8;phy&#x53EB;tbi phy  </p>
<ul>
<li>4.9<br><img src="img/CPU_PPC_kernel&#x5347;&#x7EA7;&#x8BB0;&#x5F55;_20220920093347.png" alt="">  </li>
<li>3.12<br><img src="img/CPU_PPC_kernel&#x5347;&#x7EA7;&#x8BB0;&#x5F55;_20220920093402.png" alt="">  </li>
</ul>
</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="CPU_PPC启动多核Linux_流程和内存映射.html" class="navigation navigation-prev " aria-label="Previous page: PPC启动多核linux: 流程和内存映射">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="as_title_cpu3.html" class="navigation navigation-next " aria-label="Next page: MIPS">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"PPC kernel升级记录","level":"1.17.4.2","depth":3,"next":{"title":"MIPS","level":"1.17.5","depth":2,"path":"notes/as_title_cpu3.md","ref":"notes/as_title_cpu3.md","articles":[{"title":"octeon 地址空间和寄存器访问","level":"1.17.5.1","depth":3,"path":"notes/CPU_MIPS_octeon地址空间和寄存器访问.md","ref":"notes/CPU_MIPS_octeon地址空间和寄存器访问.md","articles":[]},{"title":"octeon 操作记录","level":"1.17.5.2","depth":3,"path":"notes/CPU_MIPS_octeon操作记录.md","ref":"notes/CPU_MIPS_octeon操作记录.md","articles":[]},{"title":"octeon 系列处理器包处理性能","level":"1.17.5.3","depth":3,"path":"notes/CPU_MIPS_octeon_包处理性能.md","ref":"notes/CPU_MIPS_octeon_包处理性能.md","articles":[]},{"title":"octeon DDR调试","level":"1.17.5.4","depth":3,"path":"notes/CPU_MIPS_octeon_ddr调试记录.md","ref":"notes/CPU_MIPS_octeon_ddr调试记录.md","articles":[]},{"title":"octeon CN78xx BDK","level":"1.17.5.5","depth":3,"path":"notes/CPU_MIPS_octeon_BDK.md","ref":"notes/CPU_MIPS_octeon_BDK.md","articles":[]},{"title":"octeon 增加ECC中断","level":"1.17.5.6","depth":3,"path":"notes/kernel_增加ECC中断.md","ref":"notes/kernel_增加ECC中断.md","articles":[]},{"title":"octeon hw-ddr2代码走读","level":"1.17.5.7","depth":3,"path":"notes/CPU_MIPS_octeon_hw-ddr2代码走读.md","ref":"notes/CPU_MIPS_octeon_hw-ddr2代码走读.md","articles":[]},{"title":"octeon reboot调试和DDR中断","level":"1.17.5.8","depth":3,"path":"notes/CPU_MIPS_octeon_reboot调试和ddr中断.md","ref":"notes/CPU_MIPS_octeon_reboot调试和ddr中断.md","articles":[]},{"title":"octeon 中断","level":"1.17.5.9","depth":3,"path":"notes/CPU_MIPS_octeon中断.md","ref":"notes/CPU_MIPS_octeon中断.md","articles":[]},{"title":"octeon 原子操作","level":"1.17.5.10","depth":3,"path":"notes/CPU_MIPS_octeon原子操作.md","ref":"notes/CPU_MIPS_octeon原子操作.md","articles":[]},{"title":"octeon 网口代码分析","level":"1.17.5.11","depth":3,"path":"notes/CPU_MIPS_octeon网口代码分析.md","ref":"notes/CPU_MIPS_octeon网口代码分析.md","articles":[]}]},"previous":{"title":"PPC启动多核linux: 流程和内存映射","level":"1.17.4.1","depth":3,"path":"notes/CPU_PPC启动多核Linux_流程和内存映射.md","ref":"notes/CPU_PPC启动多核Linux_流程和内存映射.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-livereload","-sharing","-lunr","-search","search-plus","-highlight","theme-comscore","prism","code","chapter-fold","github","splitter","wide-page","hide-navigation-buttons","anchor-navigation-ex","sequence@0.1.1","mermaid-gb3"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"chapter-fold":{},"prism":{"css":["prismjs/themes/prism.css"],"ignore":["mermaid","sequence"]},"sequence":{"theme":"simple"},"github":{"url":"https://github.com/Bai-Yingjie/Bai-Yingjie.github.io"},"splitter":{},"wide-page":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"hide-navigation-buttons":{},"mermaid-gb3":{},"anchor-navigation-ex":{"mode":"float","pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"isRewritePageTitle":true,"showLevel":true,"tocLevel1Icon":"fa fa-hand-o-right","tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right","showGoTop":true,"isShowTocTitleIcon":true,"printLog":false,"multipleH1":true,"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false}},"theme-comscore":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"search-plus":{}},"theme":"default","author":"Bai Yingjie","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"My Notes","language":"zh-hans","gitbook":"*"},"file":{"path":"notes/CPU_PPC_kernel升级记录.md","mtime":"2024-09-08T12:33:31.997Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-09-08T12:34:27.685Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-mermaid-gb3/book/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    <script src="../gitbook/gitbook-plugin-mermaid-gb3/mermaid/mermaid.min.js"></script>

    </body>
</html>

