
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Golang 杂记3 · My Notes</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Bai Yingjie">
        
        
    
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-wide-page/wide.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hide-navigation-buttons/index.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-mermaid-gb3/mermaid/mermaid.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    


    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="golang_lib选型.html" />
    
    
    <link rel="prev" href="golang_杂记2.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="recent_topics.html">
            
                <a href="recent_topics.html">
            
                    
                    recent topics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="as_title_kaiyuan.html">
            
                <a href="as_title_kaiyuan.html">
            
                    
                    开源
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="my_opensource.html">
            
                <a href="my_opensource.html">
            
                    
                    我的开源项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="my_upstream.html">
            
                <a href="my_upstream.html">
            
                    
                    我的upstream commit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="as_title_system.html">
            
                <a href="as_title_system.html">
            
                    
                    系统分析和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="as_title_perf_misc.html">
            
                <a href="as_title_perf_misc.html">
            
                    
                    调试和分析记录系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="profiling_调试和分析记录5.html">
            
                <a href="profiling_调试和分析记录5.html">
            
                    
                    调试和分析记录5
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="profiling_调试和分析记录4.html">
            
                <a href="profiling_调试和分析记录4.html">
            
                    
                    调试和分析记录4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="profiling_调试和分析记录3.html">
            
                <a href="profiling_调试和分析记录3.html">
            
                    
                    调试和分析记录3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="profiling_调试和分析记录2.html">
            
                <a href="profiling_调试和分析记录2.html">
            
                    
                    调试和分析记录2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="profiling_调试和分析记录1.html">
            
                <a href="profiling_调试和分析记录1.html">
            
                    
                    调试和分析记录1
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="调试和分析工具概览.html">
            
                <a href="调试和分析工具概览.html">
            
                    
                    profiling和debugging工具相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="profiling_Linux内核调试的方式以及工具集锦.html">
            
                <a href="profiling_Linux内核调试的方式以及工具集锦.html">
            
                    
                    Linux内核调试的方式以及工具集锦(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="profiling_user_space_Ptrace_Utrace_Uprobes.html">
            
                <a href="profiling_user_space_Ptrace_Utrace_Uprobes.html">
            
                    
                    Ptrace, Utrace, Uprobes: Lightweight, Dynamic Tracing of User Apps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="debugging_gdb备忘录.html">
            
                <a href="debugging_gdb备忘录.html">
            
                    
                    gdb备忘录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="profiling_perf命令备忘录.html">
            
                <a href="profiling_perf命令备忘录.html">
            
                    
                    perf命令备忘录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5" data-path="profiling_perf命令备忘录2.html">
            
                <a href="profiling_perf命令备忘录2.html">
            
                    
                    perf命令备忘录2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.6" data-path="profiling_perf学习笔记之实战篇.html">
            
                <a href="profiling_perf学习笔记之实战篇.html">
            
                    
                    perf学习笔记之实战篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.7" data-path="profiling_perf学习笔记之入门篇.html">
            
                <a href="profiling_perf学习笔记之入门篇.html">
            
                    
                    perf学习笔记之入门篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.8" data-path="profiling_用kprobe和perf_记录函数参数.html">
            
                <a href="profiling_用kprobe和perf_记录函数参数.html">
            
                    
                    使用kprobe和perf结合记录函数参数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.9" data-path="profiling_ftrace和trace-cmd记录.html">
            
                <a href="profiling_ftrace和trace-cmd记录.html">
            
                    
                    ftrace和trace-cmd记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.10" data-path="profiling_ftrace使用实例.html">
            
                <a href="profiling_ftrace使用实例.html">
            
                    
                    ftrace使用实例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.11" data-path="profiling_systemtap实例.html">
            
                <a href="profiling_systemtap实例.html">
            
                    
                    systemtap实例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.12" data-path="profiling_systemtap基础.html">
            
                <a href="profiling_systemtap基础.html">
            
                    
                    systemtap基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.13" data-path="profiling_perf-tools_example.html">
            
                <a href="profiling_perf-tools_example.html">
            
                    
                    perf-tools 系统tracing工具集
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.14" data-path="profiling_Comparing_SystemTap_and_bpftrace.html">
            
                <a href="profiling_Comparing_SystemTap_and_bpftrace.html">
            
                    
                    Comparing SystemTap and bpftrace(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.15" data-path="system_analysis_bcc和ebpf.html">
            
                <a href="system_analysis_bcc和ebpf.html">
            
                    
                    bcc和ebpf(starting)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.16" data-path="profiling_valgrind体验.html">
            
                <a href="profiling_valgrind体验.html">
            
                    
                    体验valgrind
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="as_title_os_perf.html">
            
                <a href="as_title_os_perf.html">
            
                    
                    profiling和debugging实例
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="debugging_gshellos_socket_leak.html">
            
                <a href="debugging_gshellos_socket_leak.html">
            
                    
                    gshell socket leak调查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="profiling_调查ftrace显示调用栈全0问题.html">
            
                <a href="profiling_调查ftrace显示调用栈全0问题.html">
            
                    
                    调查ftrace显示调用栈全0问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="profiling_eoe_filter写tap设备失败问题.html">
            
                <a href="profiling_eoe_filter写tap设备失败问题.html">
            
                    
                    eoe_filter写tap设备失败问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.4" data-path="performance_ovs进程调查.html">
            
                <a href="performance_ovs进程调查.html">
            
                    
                    OVS进程调查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.5" data-path="performance_ping流程和函数调用解析.html">
            
                <a href="performance_ping流程和函数调用解析.html">
            
                    
                    ping流程和函数调用解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.6" data-path="profiling_VM互相ping场景下的延迟分析.html">
            
                <a href="profiling_VM互相ping场景下的延迟分析.html">
            
                    
                    VM互相ping场景下的延迟分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.7" data-path="debugging_ftrace_谁创建了bond0设备.html">
            
                <a href="debugging_ftrace_谁创建了bond0设备.html">
            
                    
                    谁创建了bond0设备: ftrace kprobe uprobe perf综合使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.8" data-path="profiling_unixbench之filecopy分析.html">
            
                <a href="profiling_unixbench之filecopy分析.html">
            
                    
                    unixbench之file copy分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.9" data-path="profiling_lmbench之lat_tcp分析.html">
            
                <a href="profiling_lmbench之lat_tcp分析.html">
            
                    
                    lmbench之lat_tcp分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="as_title_arch_perf.html">
            
                <a href="as_title_arch_perf.html">
            
                    
                    CPU ARCH相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="performance_CPU_microarchiteture_pmu.html">
            
                <a href="performance_CPU_microarchiteture_pmu.html">
            
                    
                    Top-down Microarchitecture Analysis Method(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="as_title_cloud.html">
            
                <a href="as_title_cloud.html">
            
                    
                    Cloud和容器相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="container_linux_namespaces.html">
            
                <a href="container_linux_namespaces.html">
            
                    
                    linux名字空间
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="cloud_杂记.html">
            
                <a href="cloud_杂记.html">
            
                    
                    云杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="container_当代容器读书笔记.html">
            
                <a href="container_当代容器读书笔记.html">
            
                    
                    当代容器读书笔记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="multi-arch_docker_binfmt_misc.html">
            
                <a href="multi-arch_docker_binfmt_misc.html">
            
                    
                    multi-arch docker 和 binfmt_misc
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="as_title_vdevice.html">
            
                <a href="as_title_vdevice.html">
            
                    
                    CPU和device虚拟化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="as_title_gvisor.html">
            
                <a href="as_title_gvisor.html">
            
                    
                    gvisor
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="golang_gvisor代码_KVM.html">
            
                <a href="golang_gvisor代码_KVM.html">
            
                    
                    gvisor KVM模式代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="golang_gvisor调试.html">
            
                <a href="golang_gvisor调试.html">
            
                    
                    gvisor调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="golang_gvisor_ptrace.html">
            
                <a href="golang_gvisor_ptrace.html">
            
                    
                    gvisor ptrace模式介绍(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="rust_vmm_brief.html">
            
                <a href="rust_vmm_brief.html">
            
                    
                    rust VMM(virtual machine monitor)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="rust_vmm_简介.html">
            
                <a href="rust_vmm_简介.html">
            
                    
                    rust-vmm简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="rust_firecracker_代码.html">
            
                <a href="rust_firecracker_代码.html">
            
                    
                    firecracker代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="rust_firecracker_使用.html">
            
                <a href="rust_firecracker_使用.html">
            
                    
                    firecracker使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="rust_cloud-hypervisor_代码.html">
            
                <a href="rust_cloud-hypervisor_代码.html">
            
                    
                    cloud hypervisor代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.5" data-path="rust_cloud-hypervisor_使用.html">
            
                <a href="rust_cloud-hypervisor_使用.html">
            
                    
                    cloud hypervisor使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.6" data-path="rust_cloud-hypervisor_问题与解决.html">
            
                <a href="rust_cloud-hypervisor_问题与解决.html">
            
                    
                    cloud hypervisor问题与解决
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.7" data-path="rust_virtiofsd_代码.html">
            
                <a href="rust_virtiofsd_代码.html">
            
                    
                    virtiofsd代码阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.8" data-path="rust_virtio_vhost_libs.html">
            
                <a href="rust_virtio_vhost_libs.html">
            
                    
                    vhost virtio相关的rust库
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="virtualization_virtio规范阅读笔记.html">
            
                <a href="virtualization_virtio规范阅读笔记.html">
            
                    
                    virtio规范阅读笔记.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="qemu_ovs_虚拟化环境.html">
            
                <a href="qemu_ovs_虚拟化环境.html">
            
                    
                    qemu OVS 虚拟化环境准备
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="qemu使用.html">
            
                <a href="qemu使用.html">
            
                    
                    Qemu使用(old)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="qemu_binary_translation.html">
            
                <a href="qemu_binary_translation.html">
            
                    
                    QEMU 指令翻译
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="as_title_networking.html">
            
                <a href="as_title_networking.html">
            
                    
                    计算机网络相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="networking_杂记2.html">
            
                <a href="networking_杂记2.html">
            
                    
                    networking杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="networking_杂记1.html">
            
                <a href="networking_杂记1.html">
            
                    
                    networking杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="networking_优化linux网络栈_接收路径.html">
            
                <a href="networking_优化linux网络栈_接收路径.html">
            
                    
                    优化linux网络栈: 接收路径(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="networking_优化linux网络栈_发送路径.html">
            
                <a href="networking_优化linux网络栈_发送路径.html">
            
                    
                    优化linux网络栈: 发送路径(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="networking_Potential_Performance_Bottleneck_in_Linux_TCP.html">
            
                <a href="networking_Potential_Performance_Bottleneck_in_Linux_TCP.html">
            
                    
                    Potential Performance Bottleneck in Linux TCP(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="networking_xdp入门.html">
            
                <a href="networking_xdp入门.html">
            
                    
                    Get started with XDP(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="networking_linux收包路径图解.html">
            
                <a href="networking_linux收包路径图解.html">
            
                    
                    linux收包路径图解(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="vpp_compiling_on_alpine.md">
            
                <span>
            
                    
                    alpine编译vpp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="as_title_qemu_ovs.html">
            
                <a href="as_title_qemu_ovs.html">
            
                    
                    Qemu OVS和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.9.1" data-path="OVS_DPDK_编译运行.html">
            
                <a href="OVS_DPDK_编译运行.html">
            
                    
                    OVS-DPDK编译运行
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.2" data-path="OVS_架构和代码.html">
            
                <a href="OVS_架构和代码.html">
            
                    
                    OVS架构和代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.3" data-path="OVS_DPDK_performance_HXT_ARM_server.html">
            
                <a href="OVS_DPDK_performance_HXT_ARM_server.html">
            
                    
                    OVS-DPDK for ARM server 性能测试环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.4" data-path="DPDK_Mellanox.html">
            
                <a href="DPDK_Mellanox.html">
            
                    
                    DPDK Mellanox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.5" data-path="OVS_phy-vm-phy.html">
            
                <a href="OVS_phy-vm-phy.html">
            
                    
                    OVS PHY-VM-PHY
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.6" data-path="networking_网络虚拟化用例记录.html">
            
                <a href="networking_网络虚拟化用例记录.html">
            
                    
                    网络虚拟化用例记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.7" data-path="networking_网络虚拟化操作记录.html">
            
                <a href="networking_网络虚拟化操作记录.html">
            
                    
                    网络虚拟化操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="as_title_virtnet.html">
            
                <a href="as_title_virtnet.html">
            
                    
                    虚拟化网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.10.1" data-path="networking_tc_filter_连接veth和tap.html">
            
                <a href="networking_tc_filter_连接veth和tap.html">
            
                    
                    Connecting a veth device to tap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10.2" data-path="networking_multicast_vxlan_flannel.html">
            
                <a href="networking_multicast_vxlan_flannel.html">
            
                    
                    multicast vxlan和flannel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10.3" data-path="networking_virtio网络介绍.html">
            
                <a href="networking_virtio网络介绍.html">
            
                    
                    virtio网络介绍(网摘): vhost-net virtio-net vhost-user SRIOV
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10.4" data-path="networking_virtualization_杂记.html">
            
                <a href="networking_virtualization_杂记.html">
            
                    
                    虚拟化网络杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10.5" data-path="networking_linux虚拟网络接口.html">
            
                <a href="networking_linux虚拟网络接口.html">
            
                    
                    linux虚拟网络接口(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="as_title_arm_server.html">
            
                <a href="as_title_arm_server.html">
            
                    
                    ARM server
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="arm_server_杂记.html">
            
                <a href="arm_server_杂记.html">
            
                    
                    Arm server 杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="server_知识点.html">
            
                <a href="server_知识点.html">
            
                    
                    server知识点
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="as_title_embedded.html">
            
                <a href="as_title_embedded.html">
            
                    
                    嵌入式系统开发调试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="embedded_debugging.html">
            
                <a href="embedded_debugging.html">
            
                    
                    嵌入式调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="uboot_杂记.html">
            
                <a href="uboot_杂记.html">
            
                    
                    uboot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="buildroot_杂记.html">
            
                <a href="buildroot_杂记.html">
            
                    
                    buildroot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="toolchain_升级gcc问题解决.html">
            
                <a href="toolchain_升级gcc问题解决.html">
            
                    
                    升级GCC7.3问题解决
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="kernel_异常打印分析实例.html">
            
                <a href="kernel_异常打印分析实例.html">
            
                    
                    kernel bug异常打印分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="as_title_linuxdaily.html">
            
                <a href="as_title_linuxdaily.html">
            
                    
                    Linux工程实践
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="linux_日常使用.html">
            
                <a href="linux_日常使用.html">
            
                    
                    日常linux使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="git_日常使用.html">
            
                <a href="git_日常使用.html">
            
                    
                    日常git使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="向kernel提交补丁.html">
            
                <a href="向kernel提交补丁.html">
            
                    
                    向kernel提交补丁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="linux_ssh_relay.html">
            
                <a href="linux_ssh_relay.html">
            
                    
                    ssh relay
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="gitlab_ci.html">
            
                <a href="gitlab_ci.html">
            
                    
                    gitlab CI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="docker_操作记录.html">
            
                <a href="docker_操作记录.html">
            
                    
                    docker操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="centos_操作记录.html">
            
                <a href="centos_操作记录.html">
            
                    
                    centos操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="as_title_golang.html">
            
                <a href="as_title_golang.html">
            
                    
                    Golang
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="as_title_golang1.html">
            
                <a href="as_title_golang1.html">
            
                    
                    入门
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1.1" data-path="golang_语法基础.html">
            
                <a href="golang_语法基础.html">
            
                    
                    Golang 语法基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.2" data-path="golang_json性能.html">
            
                <a href="golang_json性能.html">
            
                    
                    Golang json性能比较
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="golang_原理.html">
            
                <a href="golang_原理.html">
            
                    
                    Golang 原理相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.1" data-path="golang_interface原理.html">
            
                <a href="golang_interface原理.html">
            
                    
                    Golang interface原理(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.2" data-path="golang_内存分配.html">
            
                <a href="golang_内存分配.html">
            
                    
                    Golang 内存分配(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="golang_标准库.html">
            
                <a href="golang_标准库.html">
            
                    
                    Golang 标准库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="golang_泛型.html">
            
                <a href="golang_泛型.html">
            
                    
                    Golang 泛型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="golang_我的反射代码.html">
            
                <a href="golang_我的反射代码.html">
            
                    
                    Golang 我的反射代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="golang_问答.html">
            
                <a href="golang_问答.html">
            
                    
                    Golang 问答
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="golang_高效go.html">
            
                <a href="golang_高效go.html">
            
                    
                    Golang 高效go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="golang_进阶.html">
            
                <a href="golang_进阶.html">
            
                    
                    Golang 进阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="as_title_golang2.html">
            
                <a href="as_title_golang2.html">
            
                    
                    Golang 杂记
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.9.1" data-path="golang_杂记1.html">
            
                <a href="golang_杂记1.html">
            
                    
                    Golang 杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.2" data-path="golang_杂记2.html">
            
                <a href="golang_杂记2.html">
            
                    
                    Golang 杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.10.9.3" data-path="golang_杂记3.html">
            
                <a href="golang_杂记3.html">
            
                    
                    Golang 杂记3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.4" data-path="golang_lib选型.html">
            
                <a href="golang_lib选型.html">
            
                    
                    Golang lib选型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.5" data-path="golang_mod_proxy.html">
            
                <a href="golang_mod_proxy.html">
            
                    
                    go mod和go proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.6" data-path="golang_汇编_arm64.html">
            
                <a href="golang_汇编_arm64.html">
            
                    
                    Golang 汇编语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.7" data-path="golang_cgo_swig.html">
            
                <a href="golang_cgo_swig.html">
            
                    
                    go调用c可以用swig
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.10" data-path="as_title_golang3.html">
            
                <a href="as_title_golang3.html">
            
                    
                    Golang 环境和工具链生成
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.10.1" data-path="golang_toolchain_ppc.html">
            
                <a href="golang_toolchain_ppc.html">
            
                    
                    go tools增加ppc32支持
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.2" data-path="golang_toolchain_compile_gccgo.html">
            
                <a href="golang_toolchain_compile_gccgo.html">
            
                    
                    编译gccgo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.3" data-path="golang_go_on_mips.html">
            
                <a href="golang_go_on_mips.html">
            
                    
                    go on mips boards(not so updated)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.10.3.1" data-path="golang_go_on_mips_part1.html">
            
                <a href="golang_go_on_mips_part1.html">
            
                    
                    part 1: cross compile go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.3.2" data-path="golang_go_on_mips_part2.html">
            
                <a href="golang_go_on_mips_part2.html">
            
                    
                    part 2: build native go compiler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.3.3" data-path="golang_go_on_mips_part3.html">
            
                <a href="golang_go_on_mips_part3.html">
            
                    
                    part 3: gccgo experiments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.3.4" data-path="golang_go_on_mips_part4.html">
            
                <a href="golang_go_on_mips_part4.html">
            
                    
                    part 4: Golang json performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.3.5" data-path="golang_gentoo_on_mips_board_and_build_go.html">
            
                <a href="golang_gentoo_on_mips_board_and_build_go.html">
            
                    
                    Gentoo on mips board and build go
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.11" data-path="as_title_golang4.html">
            
                <a href="as_title_golang4.html">
            
                    
                    微服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.11.1" data-path="golang_micro.html">
            
                <a href="golang_micro.html">
            
                    
                    go-micro和micro
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.2" data-path="golang_微服务概念.html">
            
                <a href="golang_微服务概念.html">
            
                    
                    微服务概念
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.12" data-path="as_title_golang5.html">
            
                <a href="as_title_golang5.html">
            
                    
                    解释器和编解码
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.12.1" data-path="golang_yeagi.html">
            
                <a href="golang_yeagi.html">
            
                    
                    解释器yeagi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12.2" data-path="golang_tengo.html">
            
                <a href="golang_tengo.html">
            
                    
                    解释器tengo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12.3" data-path="golang_govaluate.html">
            
                <a href="golang_govaluate.html">
            
                    
                    解释器govaluate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12.4" data-path="golang_encoding_gotiny.html">
            
                <a href="golang_encoding_gotiny.html">
            
                    
                    gotiny编解码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12.5" data-path="golang_abs.html">
            
                <a href="golang_abs.html">
            
                    
                    解释器abs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.13" data-path="as_title_golang6.html">
            
                <a href="as_title_golang6.html">
            
                    
                    调试和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.13.1" data-path="golang_调试记录.html">
            
                <a href="golang_调试记录.html">
            
                    
                    Golang 调试记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.2" data-path="golang_topid性能优化.html">
            
                <a href="golang_topid性能优化.html">
            
                    
                    Golang topid性能优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.3" data-path="golang_gshell性能调试.html">
            
                <a href="golang_gshell性能调试.html">
            
                    
                    Golang gshell性能调试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.14" data-path="as_title_golang7.html">
            
                <a href="as_title_golang7.html">
            
                    
                    网络和消息中间件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.14.1" data-path="golang_zmq.html">
            
                <a href="golang_zmq.html">
            
                    
                    消息中间件基本概念和zero mq
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.14.2" data-path="golang_mango.html">
            
                <a href="golang_mango.html">
            
                    
                    消息中间件mango
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.14.3" data-path="golang_libp2p.html">
            
                <a href="golang_libp2p.html">
            
                    
                    Golang p2p网络
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="as_title_rust.html">
            
                <a href="as_title_rust.html">
            
                    
                    Rust
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="rust_入门_brief.html">
            
                <a href="rust_入门_brief.html">
            
                    
                    Rust 入门系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1.1" data-path="rust_books.html">
            
                <a href="rust_books.html">
            
                    
                    Rust reference books
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.2" data-path="rust_入门1.html">
            
                <a href="rust_入门1.html">
            
                    
                    Rust 安装和基础语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.3" data-path="rust_入门2.html">
            
                <a href="rust_入门2.html">
            
                    
                    Rust 泛型和内存所有权
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.4" data-path="rust_入门3.html">
            
                <a href="rust_入门3.html">
            
                    
                    Rust 闭包 容器 迭代器 生成器 线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.5" data-path="rust_工程构建.html">
            
                <a href="rust_工程构建.html">
            
                    
                    Rust 工程构建
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="rust_coding_brief.html">
            
                <a href="rust_coding_brief.html">
            
                    
                    Rust 代码积累
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.2.1" data-path="rust_by_example_misc.html">
            
                <a href="rust_by_example_misc.html">
            
                    
                    Rust by example杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.2" data-path="rust_序列化.html">
            
                <a href="rust_序列化.html">
            
                    
                    Rust 序列化原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.3" data-path="rust_知识点积累.html">
            
                <a href="rust_知识点积累.html">
            
                    
                    Rust 知识点更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.4" data-path="rust_adaptiveservice.html">
            
                <a href="rust_adaptiveservice.html">
            
                    
                    rust版本的adaptiveservice探索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.5" data-path="rust_常用设施.html">
            
                <a href="rust_常用设施.html">
            
                    
                    Rust 常用设施
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.6" data-path="rust_代码小段.html">
            
                <a href="rust_代码小段.html">
            
                    
                    Rust 代码小段
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.7" data-path="rust_错误处理.html">
            
                <a href="rust_错误处理.html">
            
                    
                    Rust 错误处理(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="others.html">
            
                <a href="others.html">
            
                    
                    其他
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.3.1" data-path="rust_mdbook_使用.html">
            
                <a href="rust_mdbook_使用.html">
            
                    
                    Rust 使用mdbook
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="as_title_scripts.html">
            
                <a href="as_title_scripts.html">
            
                    
                    脚本
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="shell_变量.html">
            
                <a href="shell_变量.html">
            
                    
                    shell变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="shell_基础篇.html">
            
                <a href="shell_基础篇.html">
            
                    
                    shell命令和脚本记录-基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="shell_高级篇.html">
            
                <a href="shell_高级篇.html">
            
                    
                    shell命令和脚本记录-高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="shell_脚本片段.html">
            
                <a href="shell_脚本片段.html">
            
                    
                    shell脚本片段
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="python_记录.html">
            
                <a href="python_记录.html">
            
                    
                    python记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="lua_记录.html">
            
                <a href="lua_记录.html">
            
                    
                    lua记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="shell_rds脚本阅读.html">
            
                <a href="shell_rds脚本阅读.html">
            
                    
                    RDS脚本阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="Project_Euler.html">
            
                <a href="Project_Euler.html">
            
                    
                    Project Euler
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="as_title_app.html">
            
                <a href="as_title_app.html">
            
                    
                    应用相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="app_sysbench代码分析.html">
            
                <a href="app_sysbench代码分析.html">
            
                    
                    sysbench代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="as_title_algorithm.html">
            
                <a href="as_title_algorithm.html">
            
                    
                    算法相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="algorithm_radix_tree.html">
            
                <a href="algorithm_radix_tree.html">
            
                    
                    基数(radix)树(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="as_title_cos.html">
            
                <a href="as_title_cos.html">
            
                    
                    C和Operating System
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="system_libc_part1.html">
            
                <a href="system_libc_part1.html">
            
                    
                    libc概览1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="system_libc_part2.html">
            
                <a href="system_libc_part2.html">
            
                    
                    libc概览2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="system_libc_part3.html">
            
                <a href="system_libc_part3.html">
            
                    
                    libc概览3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4" data-path="system_原理杂记.html">
            
                <a href="system_原理杂记.html">
            
                    
                    系统原理杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.5" data-path="system_alpine.html">
            
                <a href="system_alpine.html">
            
                    
                    Alpine Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.6" data-path="system_进程间通信.html">
            
                <a href="system_进程间通信.html">
            
                    
                    进程间通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7" data-path="system_特殊功能fd.html">
            
                <a href="system_特殊功能fd.html">
            
                    
                    eventfd timerfd signalfd和fd共享
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.8" data-path="c_automake_autoconf.html">
            
                <a href="c_automake_autoconf.html">
            
                    
                    automake autoconf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.9" data-path="makefile_原理和实践.html">
            
                <a href="makefile_原理和实践.html">
            
                    
                    makefile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.10" data-path="c_编程杂记高级篇.html">
            
                <a href="c_编程杂记高级篇.html">
            
                    
                    C编程杂记高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.11" data-path="c_编程杂记基础篇.html">
            
                <a href="c_编程杂记基础篇.html">
            
                    
                    C编程杂记基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.12" data-path="c_networking_socket高阶用法.html">
            
                <a href="c_networking_socket高阶用法.html">
            
                    
                    网络编程: Advanced Socket Topics(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.13" data-path="c_protobuf介绍.html">
            
                <a href="c_protobuf介绍.html">
            
                    
                    序列化: protobuf介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.14" data-path="c_进程间通信_共享文件和共享内存.html">
            
                <a href="c_进程间通信_共享文件和共享内存.html">
            
                    
                    进程间通信: 共享文件和共享内存(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.15" data-path="c_pthread_condition和mutex.html">
            
                <a href="c_pthread_condition和mutex.html">
            
                    
                    并发 任务 事件 和锁.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.16" data-path="kernel_user_space_howto.html">
            
                <a href="kernel_user_space_howto.html">
            
                    
                    kernel space和user space交互(网摘, linux2.6)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.17" data-path="CentOS_系统性能优化配置.html">
            
                <a href="CentOS_系统性能优化配置.html">
            
                    
                    CentOS 性能优化系统配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.18" data-path="OS_gentoo使用.html">
            
                <a href="OS_gentoo使用.html">
            
                    
                    gentoo使用记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="as_title_driver.html">
            
                <a href="as_title_driver.html">
            
                    
                    内核 设备和驱动相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="device_driver_地址空间类型和DMA.html">
            
                <a href="device_driver_地址空间类型和DMA.html">
            
                    
                    地址空间类型和DMA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="platform_device_driver.html">
            
                <a href="platform_device_driver.html">
            
                    
                    平台驱动杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="platform_device_driver2.html">
            
                <a href="platform_device_driver2.html">
            
                    
                    平台驱动杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4" data-path="device_driver_pci驱动概述.html">
            
                <a href="device_driver_pci驱动概述.html">
            
                    
                    pci驱动概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.5" data-path="device_driver_内核中的时间和延迟操作.html">
            
                <a href="device_driver_内核中的时间和延迟操作.html">
            
                    
                    内核中的时间和延迟操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.6" data-path="device_driver_杂记.html">
            
                <a href="device_driver_杂记.html">
            
                    
                    驱动调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.7" data-path="device_localbus_16bit读写.html">
            
                <a href="device_localbus_16bit读写.html">
            
                    
                    CPLD做8bit到16bit转换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.8" data-path="driver_位域和大小端.html">
            
                <a href="driver_位域和大小端.html">
            
                    
                    位域和大小端
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.9" data-path="as_title_driver1.html">
            
                <a href="as_title_driver1.html">
            
                    
                    nand
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.9.1" data-path="device_driver_octeon_nand.html">
            
                <a href="device_driver_octeon_nand.html">
            
                    
                    octeon nand flash驱动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.9.2" data-path="device_driver_nand概率写失败问题分析.html">
            
                <a href="device_driver_nand概率写失败问题分析.html">
            
                    
                    Nand flash概率写失败问题分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.10" data-path="octeon_remote_pci.html">
            
                <a href="octeon_remote_pci.html">
            
                    
                    octeon remote-pci.c阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.11" data-path="Device_VFIO_notes.html">
            
                <a href="Device_VFIO_notes.html">
            
                    
                    VFIO简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12" data-path="as_title_driver2.html">
            
                <a href="as_title_driver2.html">
            
                    
                    智能网卡和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.12.1" data-path="smartNIC_智能网卡对比.html">
            
                <a href="smartNIC_智能网卡对比.html">
            
                    
                    智能网卡对比
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12.2" data-path="octeon_pci_NIC.html">
            
                <a href="octeon_pci_NIC.html">
            
                    
                    octeon PCI NIC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12.3" data-path="as_title_driver3.html">
            
                <a href="as_title_driver3.html">
            
                    
                    octeon liquidIO
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.12.3.1" data-path="smartNIC_liquidIO_代码阅读app篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读app篇.html">
            
                    
                    PCI-NIC 代码阅读 --app篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12.3.2" data-path="smartNIC_liquidIO_代码阅读api篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读api篇.html">
            
                    
                    PCI-NIC 代码阅读 --api篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12.3.3" data-path="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇之结构体
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12.3.4" data-path="smartNIC_liquidIO_代码阅读driver篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12.3.5" data-path="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                    
                    PCI-NIC 代码阅读 --真NIC篇
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.12.4" data-path="networking_dpdk使用_2014.html">
            
                <a href="networking_dpdk使用_2014.html">
            
                    
                    DPDK使用(2014)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.13" data-path="device_nvme要点介绍.html">
            
                <a href="device_nvme要点介绍.html">
            
                    
                    nvme要点介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="as_title_cpu.html">
            
                <a href="as_title_cpu.html">
            
                    
                    CPU Arch相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1" data-path="CPU_interconnection_networks.html">
            
                <a href="CPU_interconnection_networks.html">
            
                    
                    CPU核互联模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2" data-path="cache_CPU和cache一致性原理.html">
            
                <a href="cache_CPU和cache一致性原理.html">
            
                    
                    CPU和cache一致性原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3" data-path="as_title_cpu1.html">
            
                <a href="as_title_cpu1.html">
            
                    
                    ARM64
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.3.1" data-path="CPU_ARM64_知识杂记.html">
            
                <a href="CPU_ARM64_知识杂记.html">
            
                    
                    aarch64架构知识杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.2" data-path="CPU_ARM64_thunder_overview.html">
            
                <a href="CPU_ARM64_thunder_overview.html">
            
                    
                    thunder 概览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.3" data-path="CPU_ARM64_thunder_开发板操作记录.html">
            
                <a href="CPU_ARM64_thunder_开发板操作记录.html">
            
                    
                    thunder 开发板操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.4" data-path="CPU_ARM64_thunder_bdk.html">
            
                <a href="CPU_ARM64_thunder_bdk.html">
            
                    
                    thunder BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.5" data-path="CPU_ARM64_thunder_efi_rtc.html">
            
                <a href="CPU_ARM64_thunder_efi_rtc.html">
            
                    
                    thunder RTC时间和efi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.6" data-path="CPU_ARM64_thunder_uefi_fdt.html">
            
                <a href="CPU_ARM64_thunder_uefi_fdt.html">
            
                    
                    thunder uefi和fdt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.7" data-path="CPU_ARM64_thunder_atf.html">
            
                <a href="CPU_ARM64_thunder_atf.html">
            
                    
                    thunder atf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.8" data-path="CPU_ARM64_thunder_kernel_boot.html">
            
                <a href="CPU_ARM64_thunder_kernel_boot.html">
            
                    
                    thunder kernel启动打印流程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17.4" data-path="as_title_cpu2.html">
            
                <a href="as_title_cpu2.html">
            
                    
                    PPC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.4.1" data-path="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                <a href="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                    
                    PPC启动多核linux: 流程和内存映射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.2" data-path="CPU_PPC_kernel升级记录.html">
            
                <a href="CPU_PPC_kernel升级记录.html">
            
                    
                    PPC kernel升级记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17.5" data-path="as_title_cpu3.html">
            
                <a href="as_title_cpu3.html">
            
                    
                    MIPS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.5.1" data-path="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                <a href="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                    
                    octeon 地址空间和寄存器访问
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.2" data-path="CPU_MIPS_octeon操作记录.html">
            
                <a href="CPU_MIPS_octeon操作记录.html">
            
                    
                    octeon 操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.3" data-path="CPU_MIPS_octeon_包处理性能.html">
            
                <a href="CPU_MIPS_octeon_包处理性能.html">
            
                    
                    octeon 系列处理器包处理性能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.4" data-path="CPU_MIPS_octeon_ddr调试记录.html">
            
                <a href="CPU_MIPS_octeon_ddr调试记录.html">
            
                    
                    octeon DDR调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.5" data-path="CPU_MIPS_octeon_BDK.html">
            
                <a href="CPU_MIPS_octeon_BDK.html">
            
                    
                    octeon CN78xx BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.6" data-path="kernel_增加ECC中断.html">
            
                <a href="kernel_增加ECC中断.html">
            
                    
                    octeon 增加ECC中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.7" data-path="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                <a href="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                    
                    octeon hw-ddr2代码走读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.8" data-path="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                <a href="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                    
                    octeon reboot调试和DDR中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.9" data-path="CPU_MIPS_octeon中断.html">
            
                <a href="CPU_MIPS_octeon中断.html">
            
                    
                    octeon 中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.10" data-path="CPU_MIPS_octeon原子操作.html">
            
                <a href="CPU_MIPS_octeon原子操作.html">
            
                    
                    octeon 原子操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5.11" data-path="CPU_MIPS_octeon网口代码分析.html">
            
                <a href="CPU_MIPS_octeon网口代码分析.html">
            
                    
                    octeon 网口代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Golang 杂记3</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#&#x4F7F;&#x80FD;cgo&#x7684;&#x540C;&#x65F6;&#x4E5F;&#x751F;&#x6210;static-build"><b>1. </b>&#x4F7F;&#x80FD;cgo&#x7684;&#x540C;&#x65F6;&#x4E5F;&#x751F;&#x6210;static build</a></li><li><span class="title-icon "></span><a href="#setns&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x548C;runtimelockosthread"><b>2. </b>setns&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x548C;runtime.LockOSThread()</a></li><ul><li><span class="title-icon "></span><a href="#setns"><b>2.1. </b>setns</a></li><ul><li><span class="title-icon "></span><a href="#&#x51FD;&#x6570;&#x539F;&#x578B;"><b>2.1.1. </b>&#x51FD;&#x6570;&#x539F;&#x578B;</a></li><li><span class="title-icon "></span><a href="#&#x4E03;&#x79CD;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7C7B;&#x578B;"><b>2.1.2. </b>&#x4E03;&#x79CD;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7C7B;&#x578B;</a></li><li><span class="title-icon "></span><a href="#pid-&#x540D;&#x5B57;&#x7A7A;&#x95F4;"><b>2.1.3. </b>PID &#x540D;&#x5B57;&#x7A7A;&#x95F4;</a></li><li><span class="title-icon "></span><a href="#&#x6743;&#x9650;"><b>2.1.4. </b>&#x6743;&#x9650;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5176;&#x4ED6;"><b>2.2. </b>&#x5176;&#x4ED6;</a></li><li><span class="title-icon "></span><a href="#mount&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7684;&#x95EE;&#x9898;&#x4EE5;&#x53CA;golang&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;"><b>2.3. </b>mount&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7684;&#x95EE;&#x9898;&#x4EE5;&#x53CA;golang&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;</a></li></ul><li><span class="title-icon "></span><a href="#select&#x968F;&#x673A;&#x9009;&#x62E9;ready&#x7684;case"><b>3. </b>select&#x968F;&#x673A;&#x9009;&#x62E9;ready&#x7684;case</a></li><ul><li><span class="title-icon "></span><a href="#&#x95EE;&#x9898;&#x80CC;&#x666F;"><b>3.1. </b>&#x95EE;&#x9898;&#x80CC;&#x666F;</a></li><li><span class="title-icon "></span><a href="#server&#x7AEF;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;"><b>3.2. </b>server&#x7AEF;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;</a></li><li><span class="title-icon "></span><a href="#&#x5982;&#x4F55;&#x4FEE;&#x6539;"><b>3.3. </b>&#x5982;&#x4F55;&#x4FEE;&#x6539;</a></li></ul><li><span class="title-icon "></span><a href="#&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x6307;&#x5B9A;cc"><b>4. </b>&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x6307;&#x5B9A;cc</a></li><li><span class="title-icon "></span><a href="#go-mod-tidy&#x603B;&#x662F;pull&#x8001;&#x7248;&#x672C;"><b>5. </b>go mod tidy&#x603B;&#x662F;pull&#x8001;&#x7248;&#x672C;</a></li><li><span class="title-icon "></span><a href="#update&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x7684;&#x7248;&#x672C;"><b>6. </b>update&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x7684;&#x7248;&#x672C;</a></li><ul><li><span class="title-icon "></span><a href="#&#x624B;&#x52A8;&#x66F4;&#x65B0;&#x6307;&#x5B9A;package&#x7684;&#x975E;tag&#x7248;&#x672C;"><b>6.1. </b>&#x624B;&#x52A8;&#x66F4;&#x65B0;&#x6307;&#x5B9A;package&#x7684;&#x975E;tag&#x7248;&#x672C;</a></li><li><span class="title-icon "></span><a href="#go-mod&#x7684;&#x7248;&#x672C;&#x9009;&#x62E9;&#x7B97;&#x6CD5;-minimal-version-selection-mvs"><b>6.2. </b>go mod&#x7684;&#x7248;&#x672C;&#x9009;&#x62E9;&#x7B97;&#x6CD5; Minimal version selection (MVS)</a></li></ul><li><span class="title-icon "></span><a href="#fmt&#x6253;&#x5370;&#x989C;&#x8272;"><b>7. </b>fmt&#x6253;&#x5370;&#x989C;&#x8272;</a></li><li><span class="title-icon "></span><a href="#&#x5347;&#x7EA7;go118&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;"><b>8. </b>&#x5347;&#x7EA7;go1.18&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;</a></li><ul><li><span class="title-icon "></span><a href="#mips64&#x8FD0;&#x884C;&#x65F6;&#x5D29;&#x6E83;"><b>8.1. </b>mips64&#x8FD0;&#x884C;&#x65F6;&#x5D29;&#x6E83;</a></li><ul><li><span class="title-icon "></span><a href="#&#x89E3;&#x51B3;"><b>8.1.1. </b>&#x89E3;&#x51B3;</a></li></ul></ul><li><span class="title-icon "></span><a href="#&#x5982;&#x4F55;&#x6B63;&#x786E;&#x9759;&#x6001;&#x94FE;&#x63A5;"><b>9. </b>&#x5982;&#x4F55;&#x6B63;&#x786E;&#x9759;&#x6001;&#x94FE;&#x63A5;</a></li><ul><li><span class="title-icon "></span><a href="#&#x7ED3;&#x8BBA;"><b>9.1. </b>&#x7ED3;&#x8BBA;</a></li></ul><li><span class="title-icon "></span><a href="#&#x4E0D;&#x80FD;&#x5728;for-range&#x91CC;&#x5220;&#x9664;slice&#x5143;&#x7D20;"><b>10. </b>&#x4E0D;&#x80FD;&#x5728;for range&#x91CC;&#x5220;&#x9664;slice&#x5143;&#x7D20;</a></li><li><span class="title-icon "></span><a href="#&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;buffer&#x4E3A;1&#x7684;channel"><b>11. </b>&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;buffer&#x4E3A;1&#x7684;channel</a></li><li><span class="title-icon "></span><a href="#go&#x6309;&#x4F4D;&#x53D6;&#x53CD;bitwise-not"><b>12. </b>go&#x6309;&#x4F4D;&#x53D6;&#x53CD;(bitwise not)</a></li><li><span class="title-icon "></span><a href="#go&#x7684;&#x76F8;&#x7B49;&#x6027;"><b>13. </b>go&#x7684;&#x76F8;&#x7B49;&#x6027;(==)</a></li><ul><li><span class="title-icon "></span><a href="#&#x666E;&#x901A;&#x7C7B;&#x578B;&#x7684;&#x6BD4;&#x8F83;"><b>13.1. </b>&#x666E;&#x901A;&#x7C7B;&#x578B;&#x7684;&#x6BD4;&#x8F83;</a></li><li><span class="title-icon "></span><a href="#&#x6307;&#x9488;&#x7684;&#x76F8;&#x7B49;&#x6027;"><b>13.2. </b>&#x6307;&#x9488;&#x7684;&#x76F8;&#x7B49;&#x6027;</a></li><ul><li><span class="title-icon "></span><a href="#errorsneweof&#x4E0D;&#x7B49;&#x4E8E;ioeof"><b>13.2.1. </b>errors.New(&quot;EOF&quot;)&#x4E0D;&#x7B49;&#x4E8E;io.EOF</a></li></ul><li><span class="title-icon "></span><a href="#channel&#x7684;&#x76F8;&#x7B49;&#x6027;"><b>13.3. </b>channel&#x7684;&#x76F8;&#x7B49;&#x6027;</a></li><li><span class="title-icon "></span><a href="#interface&#x7684;&#x76F8;&#x7B49;&#x6027;"><b>13.4. </b>interface&#x7684;&#x76F8;&#x7B49;&#x6027;</a></li><li><span class="title-icon "></span><a href="#&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x76F8;&#x7B49;&#x6027;"><b>13.5. </b>&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x76F8;&#x7B49;&#x6027;</a></li><li><span class="title-icon "></span><a href="#array&#x7684;&#x76F8;&#x7B49;&#x6027;"><b>13.6. </b>Array&#x7684;&#x76F8;&#x7B49;&#x6027;</a></li><li><span class="title-icon "></span><a href="#string"><b>13.7. </b>string</a></li><li><span class="title-icon "></span><a href="#byte&#x7528;bytesequal&#x6BD4;&#x8F83;"><b>13.8. </b>[]byte&#x7528;bytes.Equal&#x6BD4;&#x8F83;</a></li><li><span class="title-icon "></span><a href="#reflectdeepequal&#x4E07;&#x80FD;&#x6BD4;&#x8F83;"><b>13.9. </b>reflect.DeepEqual&#x4E07;&#x80FD;&#x6BD4;&#x8F83;</a></li><li><span class="title-icon "></span><a href="#cmp&#x5305;"><b>13.10. </b>cmp&#x5305;</a></li></ul><li><span class="title-icon "></span><a href="#&#x901A;&#x8FC7;unix-socket&#x53D1;&#x9001;fd"><b>14. </b>&#x901A;&#x8FC7;unix socket&#x53D1;&#x9001;fd</a></li><ul><li><span class="title-icon "></span><a href="#&#x53D1;&#x9001;"><b>14.1. </b>&#x53D1;&#x9001;</a></li><li><span class="title-icon "></span><a href="#&#x63A5;&#x6536;"><b>14.2. </b>&#x63A5;&#x6536;</a></li><li><span class="title-icon "></span><a href="#&#x53D1;&#x9001;2"><b>14.3. </b>&#x53D1;&#x9001;2</a></li><li><span class="title-icon "></span><a href="#&#x63A5;&#x6536;2"><b>14.4. </b>&#x63A5;&#x6536;2</a></li></ul><li><span class="title-icon "></span><a href="#&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x5E76;mmap&#x6210;&#x7ED3;&#x6784;&#x4F53;"><b>15. </b>&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x5E76;mmap&#x6210;&#x7ED3;&#x6784;&#x4F53;</a></li><ul><li><span class="title-icon "></span><a href="#memfdcreate&#x7CFB;&#x7EDF;&#x8C03;&#x7528;"><b>15.1. </b>memfd_create()&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</a></li><li><span class="title-icon "></span><a href="#gvisor&#x4E2D;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;"><b>15.2. </b>gvisor&#x4E2D;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;</a></li></ul><li><span class="title-icon "></span><a href="#&#x7528;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;-&#x904D;&#x5386;procselfmaps"><b>16. </b>&#x7528;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F; &#x904D;&#x5386;/proc/self/maps</a></li><li><span class="title-icon "></span><a href="#&#x9012;&#x5F52;&#x7F29;&#x8FDB;&#x6253;&#x5370;error"><b>17. </b>&#x9012;&#x5F52;&#x7F29;&#x8FDB;&#x6253;&#x5370;error</a></li><li><span class="title-icon "></span><a href="#&#x8BFB;go-micro"><b>18. </b>&#x8BFB;go micro</a></li><ul><li><span class="title-icon "></span><a href="#cmd"><b>18.1. </b>cmd</a></li><ul><li><span class="title-icon "></span><a href="#cmdapp"><b>18.1.1. </b>cmd.APP()</a></li><li><span class="title-icon "></span><a href="#&#x5DF2;&#x7ECF;&#x6CE8;&#x518C;&#x7684;cmd"><b>18.1.2. </b>&#x5DF2;&#x7ECF;&#x6CE8;&#x518C;&#x7684;cmd</a></li></ul><li><span class="title-icon "></span><a href="#cli&#x76F8;&#x5173;&#x7684;cmd"><b>18.2. </b>cli&#x76F8;&#x5173;&#x7684;cmd</a></li><ul><li><span class="title-icon "></span><a href="#cli&#x5B50;&#x547D;&#x4EE4;"><b>18.2.1. </b>cli&#x5B50;&#x547D;&#x4EE4;</a></li><li><span class="title-icon "></span><a href="#client&#x63A5;&#x53E3;"><b>18.2.2. </b>client&#x63A5;&#x53E3;</a></li></ul></ul><li><span class="title-icon "></span><a href="#pattern-match"><b>19. </b>pattern match</a></li><li><span class="title-icon "></span><a href="#&#x8BFB;fslinuxgo"><b>20. </b>&#x8BFB;fs_linux.go</a></li><li><span class="title-icon "></span><a href="#&#x5584;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x5E93;&#x51FD;&#x6570;--stringsjoin"><b>21. </b>&#x5584;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x5E93;&#x51FD;&#x6570;--strings.Join</a></li><li><span class="title-icon "></span><a href="#&#x5207;&#x7247;&#x7684;&#x63D2;&#x5165;"><b>22. </b>&#x5207;&#x7247;&#x7684;&#x63D2;&#x5165;</a></li><li><span class="title-icon "></span><a href="#&#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;"><b>23. </b>&#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;</a></li></ul></div><a href="#&#x4F7F;&#x80FD;cgo&#x7684;&#x540C;&#x65F6;&#x4E5F;&#x751F;&#x6210;static-build" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><ul>
<li><a href="#&#x4F7F;&#x80FD;cgo&#x7684;&#x540C;&#x65F6;&#x4E5F;&#x751F;&#x6210;static-build">&#x4F7F;&#x80FD;cgo&#x7684;&#x540C;&#x65F6;&#x4E5F;&#x751F;&#x6210;static build</a></li>
<li><a href="#setns&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x548C;runtimelockosthread">setns&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x548C;<code>runtime.LockOSThread()</code></a><ul>
<li><a href="#setns">setns</a><ul>
<li><a href="#&#x51FD;&#x6570;&#x539F;&#x578B;">&#x51FD;&#x6570;&#x539F;&#x578B;</a></li>
<li><a href="#&#x4E03;&#x79CD;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7C7B;&#x578B;">&#x4E03;&#x79CD;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7C7B;&#x578B;</a></li>
<li><a href="#pid-&#x540D;&#x5B57;&#x7A7A;&#x95F4;">PID &#x540D;&#x5B57;&#x7A7A;&#x95F4;</a></li>
<li><a href="#&#x6743;&#x9650;">&#x6743;&#x9650;</a></li>
</ul>
</li>
<li><a href="#&#x5176;&#x4ED6;">&#x5176;&#x4ED6;</a></li>
<li><a href="#mount&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7684;&#x95EE;&#x9898;&#x4EE5;&#x53CA;golang&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;">mount&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7684;&#x95EE;&#x9898;&#x4EE5;&#x53CA;golang&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;</a></li>
</ul>
</li>
<li><a href="#select&#x968F;&#x673A;&#x9009;&#x62E9;ready&#x7684;case">select&#x968F;&#x673A;&#x9009;&#x62E9;ready&#x7684;case</a><ul>
<li><a href="#&#x95EE;&#x9898;&#x80CC;&#x666F;">&#x95EE;&#x9898;&#x80CC;&#x666F;</a></li>
<li><a href="#server&#x7AEF;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;">server&#x7AEF;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;</a></li>
<li><a href="#&#x5982;&#x4F55;&#x4FEE;&#x6539;">&#x5982;&#x4F55;&#x4FEE;&#x6539;</a></li>
</ul>
</li>
<li><a href="#&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x6307;&#x5B9A;cc">&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x6307;&#x5B9A;cc</a></li>
<li><a href="#go-mod-tidy&#x603B;&#x662F;pull&#x8001;&#x7248;&#x672C;">go mod tidy&#x603B;&#x662F;pull&#x8001;&#x7248;&#x672C;</a></li>
<li><a href="#update&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x7684;&#x7248;&#x672C;">update&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x7684;&#x7248;&#x672C;</a><ul>
<li><a href="#&#x624B;&#x52A8;&#x66F4;&#x65B0;&#x6307;&#x5B9A;package&#x7684;&#x975E;tag&#x7248;&#x672C;">&#x624B;&#x52A8;&#x66F4;&#x65B0;&#x6307;&#x5B9A;package&#x7684;&#x975E;tag&#x7248;&#x672C;</a></li>
<li><a href="#go-mod&#x7684;&#x7248;&#x672C;&#x9009;&#x62E9;&#x7B97;&#x6CD5;-minimal-version-selection-mvs">go mod&#x7684;&#x7248;&#x672C;&#x9009;&#x62E9;&#x7B97;&#x6CD5; Minimal version selection (MVS)</a></li>
</ul>
</li>
<li><a href="#fmt&#x6253;&#x5370;&#x989C;&#x8272;">fmt&#x6253;&#x5370;&#x989C;&#x8272;</a></li>
<li><a href="#&#x5347;&#x7EA7;go118&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;">&#x5347;&#x7EA7;go1.18&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;</a><ul>
<li><a href="#mips64&#x8FD0;&#x884C;&#x65F6;&#x5D29;&#x6E83;">mips64&#x8FD0;&#x884C;&#x65F6;&#x5D29;&#x6E83;</a><ul>
<li><a href="#&#x89E3;&#x51B3;">&#x89E3;&#x51B3;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#&#x5982;&#x4F55;&#x6B63;&#x786E;&#x9759;&#x6001;&#x94FE;&#x63A5;">&#x5982;&#x4F55;&#x6B63;&#x786E;&#x9759;&#x6001;&#x94FE;&#x63A5;</a><ul>
<li><a href="#&#x7ED3;&#x8BBA;">&#x7ED3;&#x8BBA;</a></li>
</ul>
</li>
<li><a href="#&#x4E0D;&#x80FD;&#x5728;for-range&#x91CC;&#x5220;&#x9664;slice&#x5143;&#x7D20;">&#x4E0D;&#x80FD;&#x5728;for range&#x91CC;&#x5220;&#x9664;slice&#x5143;&#x7D20;</a></li>
<li><a href="#&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;buffer&#x4E3A;1&#x7684;channel">&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;buffer&#x4E3A;1&#x7684;channel</a></li>
<li><a href="#go&#x6309;&#x4F4D;&#x53D6;&#x53CD;bitwise-not">go&#x6309;&#x4F4D;&#x53D6;&#x53CD;(bitwise not)</a></li>
<li><a href="#go&#x7684;&#x76F8;&#x7B49;&#x6027;">go&#x7684;&#x76F8;&#x7B49;&#x6027;(==)</a><ul>
<li><a href="#&#x666E;&#x901A;&#x7C7B;&#x578B;&#x7684;&#x6BD4;&#x8F83;">&#x666E;&#x901A;&#x7C7B;&#x578B;&#x7684;&#x6BD4;&#x8F83;</a></li>
<li><a href="#&#x6307;&#x9488;&#x7684;&#x76F8;&#x7B49;&#x6027;">&#x6307;&#x9488;&#x7684;&#x76F8;&#x7B49;&#x6027;</a><ul>
<li><a href="#errorsneweof&#x4E0D;&#x7B49;&#x4E8E;ioeof"><code>errors.New(&quot;EOF&quot;)</code><strong>&#x4E0D;&#x7B49;&#x4E8E;</strong><code>io.EOF</code></a></li>
</ul>
</li>
<li><a href="#channel&#x7684;&#x76F8;&#x7B49;&#x6027;">channel&#x7684;&#x76F8;&#x7B49;&#x6027;</a></li>
<li><a href="#interface&#x7684;&#x76F8;&#x7B49;&#x6027;">interface&#x7684;&#x76F8;&#x7B49;&#x6027;</a></li>
<li><a href="#&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x76F8;&#x7B49;&#x6027;">&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x76F8;&#x7B49;&#x6027;</a></li>
<li><a href="#array&#x7684;&#x76F8;&#x7B49;&#x6027;">Array&#x7684;&#x76F8;&#x7B49;&#x6027;</a></li>
<li><a href="#string">string</a></li>
<li><a href="#byte&#x7528;bytesequal&#x6BD4;&#x8F83;">[]byte&#x7528;bytes.Equal&#x6BD4;&#x8F83;</a></li>
<li><a href="#reflectdeepequal&#x4E07;&#x80FD;&#x6BD4;&#x8F83;">reflect.DeepEqual&#x4E07;&#x80FD;&#x6BD4;&#x8F83;</a></li>
<li><a href="#cmp&#x5305;">cmp&#x5305;</a></li>
</ul>
</li>
<li><a href="#&#x901A;&#x8FC7;unix-socket&#x53D1;&#x9001;fd">&#x901A;&#x8FC7;unix socket&#x53D1;&#x9001;fd</a><ul>
<li><a href="#&#x53D1;&#x9001;">&#x53D1;&#x9001;</a></li>
<li><a href="#&#x63A5;&#x6536;">&#x63A5;&#x6536;</a></li>
<li><a href="#&#x53D1;&#x9001;2">&#x53D1;&#x9001;2</a></li>
<li><a href="#&#x63A5;&#x6536;2">&#x63A5;&#x6536;2</a></li>
</ul>
</li>
<li><a href="#&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x5E76;mmap&#x6210;&#x7ED3;&#x6784;&#x4F53;">&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x5E76;mmap&#x6210;&#x7ED3;&#x6784;&#x4F53;</a><ul>
<li><a href="#memfd_create&#x7CFB;&#x7EDF;&#x8C03;&#x7528;">memfd_create()&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</a></li>
<li><a href="#gvisor&#x4E2D;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;">gvisor&#x4E2D;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;</a></li>
</ul>
</li>
<li><a href="#&#x7528;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;-&#x904D;&#x5386;procselfmaps">&#x7528;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F; &#x904D;&#x5386;<code>/proc/self/maps</code></a></li>
<li><a href="#&#x9012;&#x5F52;&#x7F29;&#x8FDB;&#x6253;&#x5370;error">&#x9012;&#x5F52;&#x7F29;&#x8FDB;&#x6253;&#x5370;error</a></li>
<li><a href="#&#x8BFB;go-micro">&#x8BFB;go micro</a><ul>
<li><a href="#cmd">cmd</a><ul>
<li><a href="#cmdapp">cmd.APP()</a></li>
<li><a href="#&#x5DF2;&#x7ECF;&#x6CE8;&#x518C;&#x7684;cmd">&#x5DF2;&#x7ECF;&#x6CE8;&#x518C;&#x7684;cmd</a></li>
</ul>
</li>
<li><a href="#cli&#x76F8;&#x5173;&#x7684;cmd">cli&#x76F8;&#x5173;&#x7684;cmd</a><ul>
<li><a href="#cli&#x5B50;&#x547D;&#x4EE4;">cli&#x5B50;&#x547D;&#x4EE4;</a></li>
<li><a href="#client&#x63A5;&#x53E3;">client&#x63A5;&#x53E3;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#pattern-match">pattern match</a></li>
<li><a href="#&#x8BFB;fs_linuxgo">&#x8BFB;fs_linux.go</a></li>
<li><a href="#&#x5584;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x5E93;&#x51FD;&#x6570;--stringsjoin">&#x5584;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x5E93;&#x51FD;&#x6570;--strings.Join</a></li>
<li><a href="#&#x5207;&#x7247;&#x7684;&#x63D2;&#x5165;">&#x5207;&#x7247;&#x7684;&#x63D2;&#x5165;</a></li>
<li><a href="#&#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;">&#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;</a></li>
</ul>
<h1 id="&#x4F7F;&#x80FD;cgo&#x7684;&#x540C;&#x65F6;&#x4E5F;&#x751F;&#x6210;static-build"><a name="&#x4F7F;&#x80FD;cgo&#x7684;&#x540C;&#x65F6;&#x4E5F;&#x751F;&#x6210;static-build" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x80FD;cgo&#x7684;&#x540C;&#x65F6;&#x4E5F;&#x751F;&#x6210;static-build"><i class="fa fa-link" aria-hidden="true"></i></a>1. &#x4F7F;&#x80FD;cgo&#x7684;&#x540C;&#x65F6;&#x4E5F;&#x751F;&#x6210;static build</h1>
<pre class="language-"><code>LDFLAGS += -linkmode=external -extldflags=-static
CGO_ENABLED=1 go build -ldflags=&quot;$(LDFLAGS)&quot;
</code></pre><p>&#x8981;&#x70B9;:</p>
<ul>
<li>gcc&#x8981;&#x662F;musl based, &#x6BD4;&#x5982;<ul>
<li>&#x76F4;&#x63A5;&#x4F7F;&#x7528;alpine linux</li>
<li>&#x5728;ubuntu&#x4E0A;&#x5B89;&#x88C5;musl: <pre class="language-"><code>sudo apt-get install -y --no-install-recommends musl-dev musl-tools
LDFLAGS += -linkmode=external -extldflags=-static
CC=musl-gcc CGO_ENABLED=1 go build -ldflags=&quot;$(LDFLAGS)&quot;
</code></pre></li>
</ul>
</li>
</ul>
<h1 id="setns&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x548C;runtimelockosthread"><a name="setns&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x548C;runtimelockosthread" class="anchor-navigation-ex-anchor" href="#setns&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x548C;runtimelockosthread"><i class="fa fa-link" aria-hidden="true"></i></a>2. setns&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x548C;runtime.LockOSThread()</h1>
<h2 id="setns"><a name="setns" class="anchor-navigation-ex-anchor" href="#setns"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. setns</h2>
<h3 id="&#x51FD;&#x6570;&#x539F;&#x578B;"><a name="&#x51FD;&#x6570;&#x539F;&#x578B;" class="anchor-navigation-ex-anchor" href="#&#x51FD;&#x6570;&#x539F;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.1. &#x51FD;&#x6570;&#x539F;&#x578B;</h3>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_GNU_SOURCE</span>             <span class="token comment">/* See feature_test_macros(7) */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sched.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">setns</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token keyword">int</span> nstype<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="&#x4E03;&#x79CD;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7C7B;&#x578B;"><a name="&#x4E03;&#x79CD;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7C7B;&#x578B;" class="anchor-navigation-ex-anchor" href="#&#x4E03;&#x79CD;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7C7B;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.2. &#x4E03;&#x79CD;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7C7B;&#x578B;</h3>
<p><code>setns</code>&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x91CD;&#x65B0;&#x7ED1;&#x5B9A;caller<strong>&#x7EBF;&#x7A0B;</strong>&#x5230;&#x76EE;&#x6807;&#x540D;&#x5B57;&#x7A7A;&#x95F4;. &#x76EE;&#x6807;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7531;<code>fd</code>&#x6307;&#x5B9A;, &#x8FD9;&#x4E2A;<code>fd</code>&#x662F;&#x76EE;&#x6807;pid&#x4E0B;&#x9762;&#x7684;<code>/proc/[pid]/ns/</code>&#x7684;7&#x79CD;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x4E4B;&#x4E00;.</p>
<pre class="language-"><code>Namespace   Constant          Isolates
Cgroup      CLONE_NEWCGROUP   Cgroup root directory
IPC         CLONE_NEWIPC      System V IPC, POSIX message queues
Network     CLONE_NEWNET      Network devices, stacks, ports, etc.
Mount       CLONE_NEWNS       Mount points
PID         CLONE_NEWPID      Process IDs
User        CLONE_NEWUSER     User and group IDs
UTS         CLONE_NEWUTS      Hostname and NIS domain name
</code></pre><p><code>clone</code>, <code>setns</code>, <code>unshare</code>&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x80FD;&#x5904;&#x7406;<code>CLONE_NEW*</code> flag.</p>
<pre class="language-"><code>$ ls /proc/1770/ns -lh
total 0
lrwxrwxrwx 1 yingjieb platform 0 Apr  2 01:02 cgroup -&gt; &apos;cgroup:[4026531835]&apos;
lrwxrwxrwx 1 yingjieb platform 0 Apr  2 01:02 ipc -&gt; &apos;ipc:[4026531839]&apos;
lrwxrwxrwx 1 yingjieb platform 0 Apr  2 01:02 mnt -&gt; &apos;mnt:[4026531840]&apos;
lrwxrwxrwx 1 yingjieb platform 0 Apr  2 01:02 net -&gt; &apos;net:[4026531993]&apos;
lrwxrwxrwx 1 yingjieb platform 0 Apr  2 01:02 pid -&gt; &apos;pid:[4026531836]&apos;
lrwxrwxrwx 1 yingjieb platform 0 Apr  2 01:02 pid_for_children -&gt; &apos;pid:[4026531836]&apos;
lrwxrwxrwx 1 yingjieb platform 0 Apr  2 01:02 user -&gt; &apos;user:[4026531837]&apos;
lrwxrwxrwx 1 yingjieb platform 0 Apr  2 01:02 uts -&gt; &apos;uts:[4026531838]&apos;
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;, linux&#x7684;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x90FD;&#x662F;&#x548C;pid&#x7ED1;&#x5B9A;&#x7684;, &#x4F46;7&#x4E2A;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x662F;&#x72EC;&#x7ACB;&#x7684;. &#x4F46;&#x662F;, &#x5373;&#x4F7F;&#x8BE5;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x91CC;&#x9762;&#x7684;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#x90FD;&#x9000;&#x51FA;&#x4E86;, &#x8FD9;&#x4E2A;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x8FD8;&#x53EF;&#x80FD;&#x7EE7;&#x7EED;&#x5B58;&#x5728;:</p>
<ul>
<li>&#x5982;&#x679C;<code>/proc/pid/ns</code>&#x4E0B;&#x9762;&#x7684;&#x6587;&#x4EF6;&#x88AB;bind mount</li>
<li>&#x5982;&#x679C;<code>/proc/pid/ns</code>&#x4E0B;&#x9762;&#x7684;&#x6587;&#x4EF6;&#x8FD8;&#x5728;&#x88AB;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;open</li>
</ul>
<p>&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7684;&#x4E2A;&#x6570;&#x6709;&#x9650;&#x5236;, &#x6BD4;&#x5982;</p>
<pre class="language-"><code>$ ls /proc/sys/user
max_cgroup_namespaces  max_ipc_namespaces  max_pid_namespaces
max_inotify_instances  max_mnt_namespaces  max_user_namespaces
max_inotify_watches    max_net_namespaces  max_uts_namespaces

$ cat /proc/sys/user/max_mnt_namespaces
289679
</code></pre><h3 id="pid-&#x540D;&#x5B57;&#x7A7A;&#x95F4;"><a name="pid-&#x540D;&#x5B57;&#x7A7A;&#x95F4;" class="anchor-navigation-ex-anchor" href="#pid-&#x540D;&#x5B57;&#x7A7A;&#x95F4;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.3. PID &#x540D;&#x5B57;&#x7A7A;&#x95F4;</h3>
<p>PID&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x6709;&#x70B9;&#x7279;&#x6B8A;, setns&#x4E0D;&#x4F1A;&#x628A;calling&#x7EBF;&#x7A0B;put&#x5230;&#x76EE;&#x6807;PID&#x7A7A;&#x95F4;, &#x800C;&#x662F;&#x628A;calling&#x7EBF;&#x7A0B;&#x7684;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x653E;&#x5230;&#x76EE;&#x6807;PID&#x7A7A;&#x95F4;.</p>
<h3 id="&#x6743;&#x9650;"><a name="&#x6743;&#x9650;" class="anchor-navigation-ex-anchor" href="#&#x6743;&#x9650;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.4. &#x6743;&#x9650;</h3>
<p>&#x8C03;&#x7528;&#x7EBF;&#x7A0B;&#x9700;&#x8981;&#x6709;<code>CAP_SYS_ADMIN</code>&#x6743;&#x9650;</p>
<h2 id="&#x5176;&#x4ED6;"><a name="&#x5176;&#x4ED6;" class="anchor-navigation-ex-anchor" href="#&#x5176;&#x4ED6;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. &#x5176;&#x4ED6;</h2>
<p>&#x67E5;&#x770B;&#x6240;&#x6709;&#x540D;&#x5B57;&#x7A7A;&#x95F4;</p>
<pre class="language-"><code>lsns
</code></pre><h2 id="mount&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7684;&#x95EE;&#x9898;&#x4EE5;&#x53CA;golang&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;"><a name="mount&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7684;&#x95EE;&#x9898;&#x4EE5;&#x53CA;golang&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;" class="anchor-navigation-ex-anchor" href="#mount&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7684;&#x95EE;&#x9898;&#x4EE5;&#x53CA;golang&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. mount&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x7684;&#x95EE;&#x9898;&#x4EE5;&#x53CA;golang&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;</h2>
<p>&#x591A;&#x7EBF;&#x7A0B;&#x7684;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x4E0D;&#x80FD;<code>setns</code>&#x5230;mount&#x540D;&#x5B57;&#x7A7A;&#x95F4;. &#x53E6;&#x5916;, &#x9664;&#x4E86;<code>CAP_SYS_ADMIN</code>, mount&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x8FD8;&#x9700;&#x8981;<code>CAP_SYS_CHROOT</code>&#x6743;&#x9650;.</p>
<p>golang&#x91CC;&#x9762;, &#x56E0;&#x4E3A;goroutine&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x540C;&#x7EBF;&#x7A0B;&#x95F4;&#x88AB;&#x8C03;&#x5EA6;, &#x800C;<code>setns</code>&#x9700;&#x8981;&#x4EE5;&#x7EBF;&#x7A0B;&#x4E3A;&#x57FA;&#x7840;, &#x6240;&#x4EE5;<code>setns</code>&#x5230;mount&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x4F1A;&#x8FD4;&#x56DE;<code>invalid argument</code></p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sched.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">char</span> nspath<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>namespaces<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;ipc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;uts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;net&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pid&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mnt&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">geteuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;abort: you want to run this as root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;abort: you must provide a PID as the sole argument&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sprintf</span><span class="token punctuation">(</span>nspath<span class="token punctuation">,</span> <span class="token string">&quot;/proc/%s/ns/%s&quot;</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> namespaces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>nspath<span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">setns</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;setns on %s namespace failed: %s\n&quot;</span><span class="token punctuation">,</span> namespaces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token string">&quot;setns on %s namespace succeeded\n&quot;</span><span class="token punctuation">,</span> namespaces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//sudo ./checkns &lt;PID&gt;</span>
<span class="token comment">//output:</span>
setns on ipc namespace succeeded
setns on uts namespace succeeded
setns on net namespace succeeded
setns on pid namespace succeeded
setns on mnt namespace succeeded
</code></pre>
<p>&#x5BF9;&#x5E94;&#x7684;go&#x4EE3;&#x7801;&#x4F1A;&#x51FA;&#x73B0;&#x9519;&#x8BEF;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;os&quot;</span>
    <span class="token string">&quot;path/filepath&quot;</span>
    <span class="token string">&quot;syscall&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> syscall<span class="token punctuation">.</span><span class="token function">Geteuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;abort: you want to run this as root&quot;</span><span class="token punctuation">)</span>
        os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;abort: you must provide a PID as the sole argument&quot;</span><span class="token punctuation">)</span>
        os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    namespaces <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;ipc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;uts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;net&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pid&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mnt&quot;</span><span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> namespaces <span class="token punctuation">{</span>
        fd<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> syscall<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">&quot;/proc&quot;</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;ns&quot;</span><span class="token punctuation">,</span> namespaces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> syscall<span class="token punctuation">.</span>O_RDONLY<span class="token punctuation">,</span> <span class="token number">0644</span><span class="token punctuation">)</span>
        err<span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">,</span> msg <span class="token operator">:=</span> syscall<span class="token punctuation">.</span><span class="token function">RawSyscall</span><span class="token punctuation">(</span><span class="token number">308</span><span class="token punctuation">,</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 308 == setns</span>

        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;setns on&quot;</span><span class="token punctuation">,</span> namespaces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;namespace failed:&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;setns on&quot;</span><span class="token punctuation">,</span> namespaces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;namespace succeeded&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//sudo go run main.go &lt;PID&gt;</span>
<span class="token comment">//output:</span>
setns on ipc namespace succeeded
setns on uts namespace succeeded
setns on net namespace succeeded
setns on pid namespace succeeded
setns on mnt namespace failed<span class="token punctuation">:</span> invalid argument
</code></pre>
<p><a href="https://stackoverflow.com/questions/25704661/calling-setns-from-go-returns-einval-for-mnt-namespace" target="_blank">stackoverflow&#x7684;&#x8BA8;&#x8BBA;</a></p>
<p>&#x5728;<code>runc</code>&#x7684;&#x6E90;&#x4EE3;&#x7801;&#x4E2D;, 
<code>https://github.com/opencontainers/runc/blob/main/libcontainer/process_linux.go</code><br>&#x51FD;&#x6570;<code>func (p *initProcess) goCreateMountSources(ctx context.Context) (mountSourceRequestFn, context.CancelFunc, error)</code>&#x4E2D;&#x4F3C;&#x4E4E;&#x89E3;&#x51B3;&#x4E86;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;:</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// goCreateMountSources spawns a goroutine which creates open_tree(2)-style</span>
<span class="token comment">// mountfds based on the requested configs.Mount configuration. The returned</span>
<span class="token comment">// requestFn and cancelFn are used to interact with the goroutine.</span>
<span class="token comment">//</span>
<span class="token comment">// The caller of the returned mountSourceRequestFn is responsible for closing</span>
<span class="token comment">// the returned file.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>initProcess<span class="token punctuation">)</span> <span class="token function">goCreateMountSources</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">(</span>mountSourceRequestFn<span class="token punctuation">,</span> context<span class="token punctuation">.</span>CancelFunc<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> response <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        src <span class="token operator">*</span>mountSource
        err <span class="token builtin">error</span>
    <span class="token punctuation">}</span>

    errCh <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">error</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    requestCh <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token operator">*</span>configs<span class="token punctuation">.</span>Mount<span class="token punctuation">)</span>
    responseCh <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> response<span class="token punctuation">)</span>

    ctx<span class="token punctuation">,</span> cancelFn <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithTimeout</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Minute<span class="token punctuation">)</span>
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// We lock this thread because we need to setns(2) here. There is no</span>
        <span class="token comment">// UnlockOSThread() here, to ensure that the Go runtime will kill this</span>
        <span class="token comment">// thread once this goroutine returns (ensuring no other goroutines run</span>
        <span class="token comment">// in this context).</span>
        runtime<span class="token punctuation">.</span><span class="token function">LockOSThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment">// Detach from the shared fs of the rest of the Go process in order to</span>
        <span class="token comment">// be able to CLONE_NEWNS.</span>
        <span class="token keyword">if</span> err <span class="token operator">:=</span> unix<span class="token punctuation">.</span><span class="token function">Unshare</span><span class="token punctuation">(</span>unix<span class="token punctuation">.</span>CLONE_FS<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            err <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">NewSyscallError</span><span class="token punctuation">(</span><span class="token string">&quot;unshare(CLONE_FS)&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            errCh <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;mount source thread: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Attach to the container&apos;s mount namespace.</span>
        nsFd<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;/proc/%d/ns/mnt&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">pid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            errCh <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;mount source thread: open container mntns: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">defer</span> nsFd<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">:=</span> unix<span class="token punctuation">.</span><span class="token function">Setns</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>nsFd<span class="token punctuation">.</span><span class="token function">Fd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unix<span class="token punctuation">.</span>CLONE_NEWNS<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            err <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">NewSyscallError</span><span class="token punctuation">(</span><span class="token string">&quot;setns&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            errCh <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;mount source thread: join container mntns: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// No errors during setup!</span>
        <span class="token function">close</span><span class="token punctuation">(</span>errCh<span class="token punctuation">)</span>
        logrus<span class="token punctuation">.</span><span class="token function">Debugf</span><span class="token punctuation">(</span><span class="token string">&quot;mount source thread: successfully running in container mntns&quot;</span><span class="token punctuation">)</span>

        nsHandles <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>userns<span class="token punctuation">.</span>Handles<span class="token punctuation">)</span>
        <span class="token keyword">defer</span> nsHandles<span class="token punctuation">.</span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    loop<span class="token punctuation">:</span>
        <span class="token keyword">for</span> <span class="token punctuation">{</span>
            <span class="token keyword">select</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> m<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>requestCh<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
                    <span class="token keyword">break</span> loop
                <span class="token punctuation">}</span>
                src<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">mountFd</span><span class="token punctuation">(</span>nsHandles<span class="token punctuation">,</span> m<span class="token punctuation">)</span>
                logrus<span class="token punctuation">.</span><span class="token function">Debugf</span><span class="token punctuation">(</span><span class="token string">&quot;mount source thread: handling request for %q: %v %v&quot;</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>Source<span class="token punctuation">,</span> src<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
                responseCh <span class="token operator">&lt;-</span> response<span class="token punctuation">{</span>
                    src<span class="token punctuation">:</span> src<span class="token punctuation">,</span>
                    err<span class="token punctuation">:</span> err<span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
            <span class="token keyword">case</span> <span class="token operator">&lt;-</span>ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span> loop
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        logrus<span class="token punctuation">.</span><span class="token function">Debugf</span><span class="token punctuation">(</span><span class="token string">&quot;mount source thread: closing thread: %v&quot;</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">close</span><span class="token punctuation">(</span>responseCh<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Check for setup errors.</span>
    err <span class="token operator">:=</span> <span class="token operator">&lt;-</span>errCh
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token function">cancelFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>

    <span class="token comment">// TODO: Switch to context.AfterFunc when we switch to Go 1.21.</span>
    <span class="token keyword">var</span> requestChCloseOnce sync<span class="token punctuation">.</span>Once
    requestFn <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>m <span class="token operator">*</span>configs<span class="token punctuation">.</span>Mount<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>mountSource<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> err <span class="token builtin">error</span>
        <span class="token keyword">select</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> requestCh <span class="token operator">&lt;-</span> m<span class="token punctuation">:</span>
            <span class="token keyword">select</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> resp<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>responseCh<span class="token punctuation">:</span>
                <span class="token keyword">if</span> ok <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> resp<span class="token punctuation">.</span>src<span class="token punctuation">,</span> resp<span class="token punctuation">.</span>err
                <span class="token punctuation">}</span>
            <span class="token keyword">case</span> <span class="token operator">&lt;-</span>ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                err <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;receive mount source context cancelled: %w&quot;</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">case</span> <span class="token operator">&lt;-</span>ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            err <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;send mount request cancelled: %w&quot;</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        requestChCloseOnce<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">close</span><span class="token punctuation">(</span>requestCh<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> requestFn<span class="token punctuation">,</span> cancelFn<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5173;&#x952E;&#x5728;go&#x51FA;&#x53BB;&#x7684;routine&#x91CC;, &#x9996;&#x5148;&#x8C03;&#x7528;<code>runtime.LockOSThread()</code>
&#x8FD9;&#x91CC;&#x7684;&#x6CE8;&#x91CA;</p>
<pre class="language-"><code>// We lock this thread because we need to setns(2) here. There is no
// UnlockOSThread() here, to ensure that the Go runtime will kill this
// thread once this goroutine returns (ensuring no other goroutines run
// in this context).
</code></pre><p>&#x4EE5;&#x53CA;<code>https://github.com/opencontainers/runc/tree/main/libcontainer/nsenter</code>&#x7684;readme:</p>
<blockquote>
<p>The nsenter package registers a special init constructor that is called before the Go runtime has a chance to boot. This provides us the ability to setns on existing namespaces and avoid the issues that the Go runtime has with multiple threads. This constructor will be called if this package is registered, imported, in your go application.</p>
<p>The nsenter package will import &quot;C&quot; and it uses cgo package. In cgo, if the import of &quot;C&quot; is immediately preceded by a comment, that comment, called the preamble, is used as a header when compiling the C parts of the package. So every time we import package nsenter, the C code function nsexec() would be called. And package nsenter is only imported in init.go, so every time the runc init command is invoked, that C code is run.</p>
<p>Because nsexec() must be run before the Go runtime in order to use the Linux kernel namespace, you must import this library into a package if you plan to use libcontainer directly. Otherwise Go will not execute the nsexec() constructor, which means that the re-exec will not cause the namespaces to be joined. You can import it like this:</p>
<p><code>import _ &quot;github.com/opencontainers/runc/libcontainer/nsenter&quot;</code></p>
</blockquote>
<h1 id="select&#x968F;&#x673A;&#x9009;&#x62E9;ready&#x7684;case"><a name="select&#x968F;&#x673A;&#x9009;&#x62E9;ready&#x7684;case" class="anchor-navigation-ex-anchor" href="#select&#x968F;&#x673A;&#x9009;&#x62E9;ready&#x7684;case"><i class="fa fa-link" aria-hidden="true"></i></a>3. select&#x968F;&#x673A;&#x9009;&#x62E9;ready&#x7684;case</h1>
<p>adaptiveservice&#x7684;chan transport&#x5B9E;&#x73B0;&#x91CC;, &#x51FA;&#x73B0;&#x6765;&#x7684;&#x4E00;&#x4E2A;bug. &#x73B0;&#x8C61;&#x662F;&#x4E22;&#x6D88;&#x606F;. &#x6700;&#x540E;&#x8C03;&#x67E5;&#x4E0B;&#x6765;&#x548C;select&#x7684;&#x968F;&#x673A;&#x9009;&#x62E9;case&#x6709;&#x5173;.</p>
<h2 id="&#x95EE;&#x9898;&#x80CC;&#x666F;"><a name="&#x95EE;&#x9898;&#x80CC;&#x666F;" class="anchor-navigation-ex-anchor" href="#&#x95EE;&#x9898;&#x80CC;&#x666F;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. &#x95EE;&#x9898;&#x80CC;&#x666F;</h2>
<p>client&#x548C;server&#x901A;&#x8FC7;adaptiveservice&#x7684;channel transport&#x901A;&#x4FE1;. client&#x4E3B;&#x52A8;&#x53D1;&#x8D77;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;, &#x5E76;&#x5728;&#x7ED3;&#x675F;&#x540E;&#x5173;&#x95ED;&#x8FDE;&#x63A5;.</p>
<p>client&#x4EE3;&#x7801;&#x903B;&#x8F91;&#x7B80;&#x5316;&#x5982;&#x4E0B;:</p>
<pre class="language-"><code class="lang-go"><span class="token comment">//&#x53D1;&#x73B0;&#x5E76;&#x8FDE;&#x63A5;server</span>
c <span class="token operator">:=</span> <span class="token function">NewClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetDiscoverTimeout</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
conn <span class="token operator">:=</span> <span class="token operator">&lt;-</span>c<span class="token punctuation">.</span><span class="token function">Discover</span><span class="token punctuation">(</span>BuiltinPublisher<span class="token punctuation">,</span> SrvMessageTracing<span class="token punctuation">)</span>

<span class="token comment">//&#x53D1;&#x9001;</span>
tracedMsg <span class="token operator">:=</span> tracedMessageRecord<span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
conn<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tracedMsg<span class="token punctuation">)</span>
conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>bug&#x73B0;&#x8C61;&#x662F;client&#x53D1;&#x9001;&#x7684;<code>tracedMsg</code>&#x5E76;&#x6CA1;&#x6709;&#x88AB;server&#x5904;&#x7406;.</p>
<h2 id="server&#x7AEF;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;"><a name="server&#x7AEF;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;" class="anchor-navigation-ex-anchor" href="#server&#x7AEF;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. server&#x7AEF;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;</h2>
<p>server&#x7AEF;&#x9047;&#x5230;client&#x53D1;&#x8FC7;&#x6765;&#x7684;&#x63E1;&#x624B;&#x8BF7;&#x6C42;, &#x4F1A;&#x65B0;&#x5EFA;goroutine&#x5904;&#x7406;:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        <span class="token keyword">select</span> <span class="token punctuation">{</span>
            <span class="token comment">//&#x76D1;&#x6D4B;&#x662F;&#x5426;client&#x4E3B;&#x52A8;&#x5173;&#x95ED;&#x4E86;&#x901A;&#x9053;.</span>
            <span class="token comment">//connClose&#x7531;client&#x6301;&#x6709;</span>
            <span class="token keyword">case</span> <span class="token operator">&lt;-</span>connClose<span class="token punctuation">:</span>
                <span class="token comment">//&#x5173;&#x95ED;&#x8FDE;&#x63A5;</span>
                <span class="token keyword">return</span>
            <span class="token comment">//recvChan&#x662F;server&#x7AEF;&#x7ED9;&#x8FD9;&#x4E2A;client&#x65B0;&#x5EFA;&#x7684;&#x63A5;&#x6536;&#x961F;&#x5217;</span>
            <span class="token keyword">case</span> tm <span class="token operator">:=</span> <span class="token operator">&lt;-</span>recvChan<span class="token punctuation">:</span>
                <span class="token comment">//&#x5904;&#x7406;&#x6D88;&#x606F;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x95EE;&#x9898;&#x51FA;&#x5728;<code>case &lt;-connClose</code>&#x540E;&#x7684;&#x90A3;&#x4E2A;<code>return</code>&#x4E0A;.<br>client&#x51E0;&#x4E4E;&#x662F;&#x53D1;&#x4E86;&#x6D88;&#x606F;&#x9A6C;&#x4E0A;&#x5173;&#x95ED;&#x8FDE;&#x63A5;, &#x90A3;&#x4E48;server&#x7AEF;&#x7684;<code>select</code>&#x80CC;&#x540E;&#x7684;<code>epoll</code>&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x770B;&#x5230;&#x4E24;&#x4E2A;case&#x51E0;&#x4E4E;&#x540C;&#x65F6;ready.
&#x6839;&#x636E;go&#x7684;<a href="https://go.dev/ref/spec#Select_statements" target="_blank">spec</a></p>
<blockquote>
<p>If one or more of the communications can proceed, a single one that can proceed is chosen via a uniform pseudo-random selection. Otherwise, if there is a default case, that case is chosen. If there is no default case, the &quot;select&quot; statement blocks until at least one of the communications can proceed.</p>
</blockquote>
<p>case&#x7684;&#x9009;&#x62E9;&#x662F;&#x968F;&#x673A;&#x7684;. &#x90A3;&#x4E48;&#x5982;&#x679C;&#x9009;&#x62E9;&#x4E86;<code>case &lt;-connClose</code>, &#x8D70;return&#x6D41;&#x7A0B;, &#x90A3;&#x4E48;<code>recvChan</code>&#x91CC;&#x9762;&#x8FD8;&#x6CA1;&#x6765;&#x5F97;&#x53CA;&#x5904;&#x7406;&#x7684;&#x6D88;&#x606F;&#x90FD;&#x4F1A;&#x4E22;&#x5931;.</p>
<h2 id="&#x5982;&#x4F55;&#x4FEE;&#x6539;"><a name="&#x5982;&#x4F55;&#x4FEE;&#x6539;" class="anchor-navigation-ex-anchor" href="#&#x5982;&#x4F55;&#x4FEE;&#x6539;"><i class="fa fa-link" aria-hidden="true"></i></a>3.3. &#x5982;&#x4F55;&#x4FEE;&#x6539;</h2>
<p><img src="img/golang_select_bugfix.png" alt="Alt text"></p>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x4FEE;&#x6539;&#x4E2D;, <code>case &lt;-connClose</code>&#x53EA;&#x662F;&#x5173;&#x95ED;<code>recvChan</code>; &#x800C;<code>recvChan</code>&#x91CC;&#x9762;&#x8BFB;&#x7A7A;&#x624D;return.</p>
<h1 id="&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x6307;&#x5B9A;cc"><a name="&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x6307;&#x5B9A;cc" class="anchor-navigation-ex-anchor" href="#&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x6307;&#x5B9A;cc"><i class="fa fa-link" aria-hidden="true"></i></a>4. &#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x6307;&#x5B9A;cc</h1>
<pre class="language-"><code>CGO_ENABLED=1 GOARCH=arm64 CC=aarch64-alpine-linux-musl-gcc go build -buildmode=plugin -ldflags=&quot;-extld=aarch64-alpine-linux-musl-ld&quot;
</code></pre><h1 id="go-mod-tidy&#x603B;&#x662F;pull&#x8001;&#x7248;&#x672C;"><a name="go-mod-tidy&#x603B;&#x662F;pull&#x8001;&#x7248;&#x672C;" class="anchor-navigation-ex-anchor" href="#go-mod-tidy&#x603B;&#x662F;pull&#x8001;&#x7248;&#x672C;"><i class="fa fa-link" aria-hidden="true"></i></a>5. go mod tidy&#x603B;&#x662F;pull&#x8001;&#x7248;&#x672C;</h1>
<p>&#x539F;&#x56E0;&#x662F;go&#x5DE5;&#x5177;&#x94FE;&#x4F7F;&#x7528;&#x4E86;proxy, &#x6709;cache.<br>&#x7528;<code>GOPRIVATE</code>&#x6307;&#x5B9A;<code>github</code>&#x4E0D;&#x8D70;proxy&#x53EF;&#x4EE5;&#x89E3;&#x51B3;:</p>
<pre class="language-"><code>GOPRIVATE=github.com go get github.com/godevsig/grepo@master
</code></pre><h1 id="update&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x7684;&#x7248;&#x672C;"><a name="update&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x7684;&#x7248;&#x672C;" class="anchor-navigation-ex-anchor" href="#update&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x7684;&#x7248;&#x672C;"><i class="fa fa-link" aria-hidden="true"></i></a>6. update&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x7684;&#x7248;&#x672C;</h1>
<pre class="language-"><code class="lang-shell"><span class="token assign-left variable">GOPRIVATE</span><span class="token operator">=</span>github.com go get <span class="token parameter variable">-u</span> ./<span class="token punctuation">..</span>.
<span class="token assign-left variable">GOPRIVATE</span><span class="token operator">=</span>github.com go mod tidy
</code></pre>
<h2 id="&#x624B;&#x52A8;&#x66F4;&#x65B0;&#x6307;&#x5B9A;package&#x7684;&#x975E;tag&#x7248;&#x672C;"><a name="&#x624B;&#x52A8;&#x66F4;&#x65B0;&#x6307;&#x5B9A;package&#x7684;&#x975E;tag&#x7248;&#x672C;" class="anchor-navigation-ex-anchor" href="#&#x624B;&#x52A8;&#x66F4;&#x65B0;&#x6307;&#x5B9A;package&#x7684;&#x975E;tag&#x7248;&#x672C;"><i class="fa fa-link" aria-hidden="true"></i></a>6.1. &#x624B;&#x52A8;&#x66F4;&#x65B0;&#x6307;&#x5B9A;package&#x7684;&#x975E;tag&#x7248;&#x672C;</h2>
<p>&#x7528;<code>go get -u</code>&#x53EA;&#x80FD;&#x66F4;&#x65B0;package&#x5230;tag&#x7248;&#x672C;, &#x5982;&#x679C;&#x9700;&#x8981;&#x66F4;&#x65B0;&#x7684;&#x7248;&#x672C;, &#x9700;&#x8981;&#x624B;&#x52A8;&#x4FEE;&#x6539;<code>go.mod</code>&#x6587;&#x4EF6;, &#x6BD4;&#x5982;&#x4FEE;&#x6539;&#x6307;&#x5B9A;package&#x4E3A;master&#x5206;&#x652F;:</p>
<pre class="language-"><code class="lang-shell">github.com/godevsig/glib master
</code></pre>
<p>&#x518D;&#x7528;<code>go mod tidy</code>&#x5C31;&#x53EF;&#x4EE5;&#x66F4;&#x65B0;&#x5230;&#x6700;&#x65B0;&#x7248;&#x672C;. &#x6BD4;&#x5982;&#x8FD9;&#x91CC;&#x8FD0;&#x884C;&#x540E;, <code>go.mod</code>&#x88AB;&#x81EA;&#x52A8;&#x4FEE;&#x6539;&#x4E3A;:</p>
<pre class="language-"><code class="lang-shell">github.com/godevsig/glib v0.1.2-0.20230826061212-649e5e40e117
</code></pre>
<h2 id="go-mod&#x7684;&#x7248;&#x672C;&#x9009;&#x62E9;&#x7B97;&#x6CD5;-minimal-version-selection-mvs"><a name="go-mod&#x7684;&#x7248;&#x672C;&#x9009;&#x62E9;&#x7B97;&#x6CD5;-minimal-version-selection-mvs" class="anchor-navigation-ex-anchor" href="#go-mod&#x7684;&#x7248;&#x672C;&#x9009;&#x62E9;&#x7B97;&#x6CD5;-minimal-version-selection-mvs"><i class="fa fa-link" aria-hidden="true"></i></a>6.2. go mod&#x7684;&#x7248;&#x672C;&#x9009;&#x62E9;&#x7B97;&#x6CD5; Minimal version selection (MVS)</h2>
<p>&#x57FA;&#x672C;&#x5047;&#x8BBE;&#x5C31;&#x662F;package&#x6EE1;&#x8DB3;&#x5411;&#x524D;&#x517C;&#x5BB9;&#x6027;&#x539F;&#x5219;, &#x65B0;&#x7248;&#x672C;&#x603B;&#x662F;&#x6BD4;&#x8001;&#x7248;&#x672C;&#x597D;.</p>
<p>&#x6240;&#x4EE5;MVS&#x867D;&#x7136;&#x540D;&#x5B57;&#x91CC;&#x6709;minimal&#x5B57;&#x6837;, &#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x5B83;&#x503E;&#x5411;&#x4E8E;&#x9009;&#x62E9;&#x65B0;&#x7248;&#x672C;, &#x6BD4;&#x5982;&#x4E0B;&#x56FE;:  </p>
<blockquote>
<p>MVS produces the build list as output, the list of module versions used for a build.</p>
<p>MVS starts at the main modules (special vertices in the graph that have no version) and traverses the graph, tracking the highest required version of each module. At the end of the traversal, the highest required versions comprise the build list: they are the minimum versions that satisfy all requirements.</p>
<p>MVS visits and loads the go.mod file for each of the module versions highlighted in blue. At the end of the graph traversal, MVS returns a build list containing the bolded versions: A 1.2, B 1.2, C 1.4, and D 1.2. Note that higher versions of B and D are available but MVS does not select them, since nothing requires them.</p>
</blockquote>
<p><img src="img/golang_mvs.png" alt="go mod &#x9009;&#x62E9;&#x7B97;&#x6CD5;"></p>
<p><strong>&#x7528;<code>go list -m all</code>&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x8FD9;&#x4E2A;build list.</strong></p>
<blockquote>
<p>The build list may be inspected with the command go list -m all. Unlike other dependency management systems, the build list is not saved in a &#x201C;lock&#x201D; file. MVS is deterministic, and the build list doesn&#x2019;t change when new versions of dependencies are released, so MVS is used to compute it at the beginning of every module-aware command.</p>
</blockquote>
<p>&#x8BE6;&#x89C1;:</p>
<ul>
<li><a href="https://go.dev/ref/mod#minimal-version-selection" target="_blank">https://go.dev/ref/mod#minimal-version-selection</a></li>
<li><a href="https://research.swtch.com/vgo-mvs" target="_blank">https://research.swtch.com/vgo-mvs</a></li>
</ul>
<h1 id="fmt&#x6253;&#x5370;&#x989C;&#x8272;"><a name="fmt&#x6253;&#x5370;&#x989C;&#x8272;" class="anchor-navigation-ex-anchor" href="#fmt&#x6253;&#x5370;&#x989C;&#x8272;"><i class="fa fa-link" aria-hidden="true"></i></a>7. fmt&#x6253;&#x5370;&#x989C;&#x8272;</h1>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Print colored text</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\x1b[31mRed Text\x1b[0m&quot;</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\x1b[32mGreen Text\x1b[0m&quot;</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\x1b[33mYellow Text\x1b[0m&quot;</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\x1b[34mBlue Text\x1b[0m&quot;</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\x1b[35mMagenta Text\x1b[0m&quot;</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\x1b[36mCyan Text\x1b[0m&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="&#x5347;&#x7EA7;go118&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;"><a name="&#x5347;&#x7EA7;go118&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;" class="anchor-navigation-ex-anchor" href="#&#x5347;&#x7EA7;go118&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;"><i class="fa fa-link" aria-hidden="true"></i></a>8. &#x5347;&#x7EA7;go1.18&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;</h1>
<h2 id="mips64&#x8FD0;&#x884C;&#x65F6;&#x5D29;&#x6E83;"><a name="mips64&#x8FD0;&#x884C;&#x65F6;&#x5D29;&#x6E83;" class="anchor-navigation-ex-anchor" href="#mips64&#x8FD0;&#x884C;&#x65F6;&#x5D29;&#x6E83;"><i class="fa fa-link" aria-hidden="true"></i></a>8.1. mips64&#x8FD0;&#x884C;&#x65F6;&#x5D29;&#x6E83;</h2>
<p>&#x8FD0;&#x884C;&#x73AF;&#x5883;: octeon3 CPU(mips64)<br>&#x6211;&#x628A;gshell&#x7684;toolchain&#x4ECE;1.16&#x5347;&#x7EA7;&#x5230;&#x4E86;1.18, &#x5C0F;&#x7684;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x6CA1;&#x95EE;&#x9898;.<br>&#x4F46;gshell daemon&#x8FD0;&#x884C;&#x51FA;&#x9519;:</p>
<pre class="language-"><code class="lang-shell">~/gshell <span class="token comment"># bin_latest/gshell -loglevel info daemon -registry 10.182.105.179:11985 -bcast 9923</span>
trap:5111, <span class="token assign-left variable">a123456</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0,0</span>,0,0,0,0<span class="token punctuation">]</span>
results: got <span class="token punctuation">{</span>r1<span class="token operator">=</span><span class="token number">0</span>,r2<span class="token operator">=</span><span class="token number">5111</span>,errno<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">}</span>, want <span class="token punctuation">{</span>r1<span class="token operator">=</span><span class="token number">0</span>,r2<span class="token operator">=</span><span class="token number">0</span>,errno<span class="token operator">=</span><span class="token number">0</span>
fatal error: AllThreadsSyscall6 results differ between threads<span class="token punctuation">;</span> runtime corrupted
trap:5111, <span class="token assign-left variable">a123456</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0,0</span>,0,0,0,0<span class="token punctuation">]</span>
results: got <span class="token punctuation">{</span>r1<span class="token operator">=</span><span class="token number">0</span>,r2<span class="token operator">=</span><span class="token number">5111</span>,errno<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">}</span>, want <span class="token punctuation">{</span>r1<span class="token operator">=</span><span class="token number">0</span>,r2<span class="token operator">=</span><span class="token number">0</span>,errno<span class="token operator">=</span><span class="token number">0</span>
fatal error: AllThreadsSyscall6 results differ between threads<span class="token punctuation">;</span> runtime corrupted


goroutine <span class="token number">0</span> <span class="token punctuation">[</span>idle<span class="token punctuation">]</span>:
runtime: unexpected <span class="token builtin class-name">return</span> pc <span class="token keyword">for</span> runtime.sigtramp called from 0xffeccc3580
stack: <span class="token assign-left variable">frame</span><span class="token operator">=</span><span class="token punctuation">{</span>sp:0xc00004fc88, fp:0xc00004fcd0<span class="token punctuation">}</span> <span class="token assign-left variable">stack</span><span class="token operator">=</span><span class="token punctuation">[</span>0xc000048000,0xc000050000<span class="token punctuation">)</span>
//&#x7701;&#x7565;&#x6808;&#x6253;&#x5370;
runtime.throw<span class="token punctuation">(</span><span class="token punctuation">{</span>0x649b1f, 0x44<span class="token punctuation">}</span><span class="token punctuation">)</span>
        /usr/local/go/src/runtime/panic.go:992 +0x6c
runtime.runPerThreadSyscall<span class="token punctuation">(</span><span class="token punctuation">)</span>
        /usr/local/go/src/runtime/os_linux.go:874 +0x410
runtime.sighandler<span class="token punctuation">(</span>0x21, 0xc00004fce8, 0xc00004fd68, 0xc0000029c0<span class="token punctuation">)</span>
        /usr/local/go/src/runtime/signal_unix.go:631 +0x770
runtime.sigtrampgo<span class="token punctuation">(</span>0x21, 0xc00004fce8, 0xc00004fd68<span class="token punctuation">)</span>
        /usr/local/go/src/runtime/signal_unix.go:477 +0x228
runtime: unexpected <span class="token builtin class-name">return</span> pc <span class="token keyword">for</span> runtime.sigtramp called from 0xffeccc3580
stack: <span class="token assign-left variable">frame</span><span class="token operator">=</span><span class="token punctuation">{</span>sp:0xc00004fc88, fp:0xc00004fcd0<span class="token punctuation">}</span> <span class="token assign-left variable">stack</span><span class="token operator">=</span><span class="token punctuation">[</span>0xc000048000,0xc000050000<span class="token punctuation">)</span>
//&#x7701;&#x7565;&#x6808;&#x6253;&#x5370;
runtime.sigtramp<span class="token punctuation">(</span><span class="token punctuation">)</span>
        /usr/local/go/src/runtime/sys_linux_mips64x.s:435 +0x54

goroutine <span class="token number">1</span> <span class="token punctuation">[</span>running<span class="token punctuation">]</span>:
        goroutine running on other thread<span class="token punctuation">;</span> stack unavailable
trap:5111, <span class="token assign-left variable">a123456</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0,0</span>,0,0,0,0<span class="token punctuation">]</span>

goroutine <span class="token number">0</span> <span class="token punctuation">[</span>idle<span class="token punctuation">]</span>:
runtime: unexpected <span class="token builtin class-name">return</span> pc <span class="token keyword">for</span> runtime.sigtramp called from 0xffeccc3580
stack: <span class="token assign-left variable">frame</span><span class="token operator">=</span><span class="token punctuation">{</span>sp:0xc00003fc88, fp:0xc00003fcd0<span class="token punctuation">}</span> <span class="token assign-left variable">stack</span><span class="token operator">=</span><span class="token punctuation">[</span>0xc000038000,0xc000040000<span class="token punctuation">)</span>

runtime.throw<span class="token punctuation">(</span><span class="token punctuation">{</span>0x649b1f, 0x44<span class="token punctuation">}</span><span class="token punctuation">)</span>
        /usr/local/go/src/runtime/panic.go:992 +0x6c
runtime.runPerThreadSyscall<span class="token punctuation">(</span><span class="token punctuation">)</span>
        /usr/local/go/src/runtime/os_linux.go:874 +0x410
runtime.sighandler<span class="token punctuation">(</span>0x21, 0xc00003fce8, 0xc00003fd68, 0xc0000024e0<span class="token punctuation">)</span>
        /usr/local/go/src/runtime/signal_unix.go:631 +0x770
runtime.sigtrampgo<span class="token punctuation">(</span>0x21, 0xc00003fce8, 0xc00003fd68<span class="token punctuation">)</span>
        /usr/local/go/src/runtime/signal_unix.go:477 +0x228
runtime: unexpected <span class="token builtin class-name">return</span> pc <span class="token keyword">for</span> runtime.sigtramp called from 0xffeccc3580
stack: <span class="token assign-left variable">frame</span><span class="token operator">=</span><span class="token punctuation">{</span>sp:0xc00003fc88, fp:0xc00003fcd0<span class="token punctuation">}</span> <span class="token assign-left variable">stack</span><span class="token operator">=</span><span class="token punctuation">[</span>0xc000038000,0xc000040000<span class="token punctuation">)</span>
runtime.sigtramp<span class="token punctuation">(</span><span class="token punctuation">)</span>
        /usr/local/go/src/runtime/sys_linux_mips64x.s:435 +0x54
</code></pre>
<p>&#x8FD9;&#x4E2A;error message&#x610F;&#x601D;&#x662F;&#x8BF4;r2&#x5BC4;&#x5B58;&#x5668;&#x5E94;&#x8BE5;&#x662F;0, &#x4F46;&#x5B9E;&#x9645;&#x5374;&#x662F;5111</p>
<h3 id="&#x89E3;&#x51B3;"><a name="&#x89E3;&#x51B3;" class="anchor-navigation-ex-anchor" href="#&#x89E3;&#x51B3;"><i class="fa fa-link" aria-hidden="true"></i></a>8.1.1. &#x89E3;&#x51B3;</h3>
<p>&#x6839;&#x636E;<a href="https://github.com/golang/go/issues/56426" target="_blank">https://github.com/golang/go/issues/56426</a>, &#x8FD9;&#x662F;go1.18&#x5F15;&#x5165;&#x7684;bug, 1.20+&#x624D;fix. &#x770B;&#x6765;&#x8981;backporting <a href="https://github.com/golang/go/commit/2c7c98c3ad719aa9d6d2594827a6894ff9950042" target="_blank">&#x8FD9;&#x4E2A;patch</a>&#x4E86;.</p>
<blockquote>
<p>All mips variant perform syscalls similarly. R2 (v0) holds r1 and R3 (v1) holds r2 of a syscall. The latter is only used by 2-ret syscalls. A 1-ret syscall would not touch R3 but keeps it as is, making r2 be a random value. Always reset it to 0 before SYSCALL to fix the issue.</p>
</blockquote>
<h1 id="&#x5982;&#x4F55;&#x6B63;&#x786E;&#x9759;&#x6001;&#x94FE;&#x63A5;"><a name="&#x5982;&#x4F55;&#x6B63;&#x786E;&#x9759;&#x6001;&#x94FE;&#x63A5;" class="anchor-navigation-ex-anchor" href="#&#x5982;&#x4F55;&#x6B63;&#x786E;&#x9759;&#x6001;&#x94FE;&#x63A5;"><i class="fa fa-link" aria-hidden="true"></i></a>9. &#x5982;&#x4F55;&#x6B63;&#x786E;&#x9759;&#x6001;&#x94FE;&#x63A5;</h1>
<p>&#x53C2;&#x8003;: </p>
<ul>
<li><a href="https://mt165.co.uk/blog/static-link-go/" target="_blank">https://mt165.co.uk/blog/static-link-go/</a></li>
<li><a href="https://www.arp242.net/static-go.html" target="_blank">https://www.arp242.net/static-go.html</a></li>
</ul>
<h2 id="&#x7ED3;&#x8BBA;"><a name="&#x7ED3;&#x8BBA;" class="anchor-navigation-ex-anchor" href="#&#x7ED3;&#x8BBA;"><i class="fa fa-link" aria-hidden="true"></i></a>9.1. &#x7ED3;&#x8BBA;</h2>
<table>
<thead>
<tr>
<th></th>
<th>Dynamically-linked binary</th>
<th>Statically-linked binary</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Libc functions</strong></td>
<td><code>go build</code></td>
<td><code>go build -ldflags &quot;-linkmode &apos;external&apos; -extldflags &apos;-static&apos;&quot;</code></td>
</tr>
<tr>
<td><strong>Golang functions</strong></td>
<td>n/a</td>
<td><code>CGO_ENABLED=0 go build</code></td>
</tr>
</tbody>
</table>
<p>I.e.</p>
<ul>
<li>To get a static binary, under most circumstances: <code>CGO_ENABLED=0 go build</code></li>
<li>To use the libc functions for <code>net</code> and <code>os/user</code>, and still get a static binary (for containers): <code>go build -ldflags &quot;-linkmode &apos;external&apos; -extldflags &apos;-static&apos;&quot;</code></li>
</ul>
<h1 id="&#x4E0D;&#x80FD;&#x5728;for-range&#x91CC;&#x5220;&#x9664;slice&#x5143;&#x7D20;"><a name="&#x4E0D;&#x80FD;&#x5728;for-range&#x91CC;&#x5220;&#x9664;slice&#x5143;&#x7D20;" class="anchor-navigation-ex-anchor" href="#&#x4E0D;&#x80FD;&#x5728;for-range&#x91CC;&#x5220;&#x9664;slice&#x5143;&#x7D20;"><i class="fa fa-link" aria-hidden="true"></i></a>10. &#x4E0D;&#x80FD;&#x5728;for range&#x91CC;&#x5220;&#x9664;slice&#x5143;&#x7D20;</h1>
<p>&#x6211;&#x95EE;chatgpt&#x5982;&#x4F55;&#x5728;for range&#x91CC;&#x5220;&#x9664;slice&#x5143;&#x7D20;, chatgpt&#x7ED9;&#x51FA;&#x7684;&#x4EE3;&#x7801;:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Create a slice of integers</span>
    nums <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span>

    <span class="token comment">// Iterate over the slice using range</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> num <span class="token operator">:=</span> <span class="token keyword">range</span> nums <span class="token punctuation">{</span> <span class="token comment">// for range&#x5728;&#x4E00;&#x5F00;&#x59CB;&#x5C31;&#x5B9A;&#x597D;&#x4E86;&#x8981;interate&#x591A;&#x5C11;&#x6B21;</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> num<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &#x800C;&#x4E14;&#x4E0D;&#x53D7;index&#x8D8A;&#x754C;&#x9650;&#x5236;</span>
        <span class="token comment">//fmt.Println(i, num, nums[i], len(nums)) // &#x6211;&#x52A0;&#x7684;&#x8FD9;&#x884C;&#x4F1A;panic</span>
        <span class="token comment">// Check if the element should be deleted</span>
        <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">||</span> num <span class="token operator">==</span> <span class="token number">4</span> <span class="token punctuation">{</span>
            <span class="token comment">// Delete the element from the slice using append</span>
            nums <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">...</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Print the updated slice</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//&#x7ED3;&#x679C;</span>
<span class="token number">0</span> <span class="token number">1</span> <span class="token number">5</span>
<span class="token number">1</span> <span class="token number">2</span> <span class="token number">5</span>
<span class="token number">2</span> <span class="token number">3</span> <span class="token number">5</span>
<span class="token number">3</span> <span class="token number">5</span> <span class="token number">4</span>
<span class="token number">4</span> <span class="token number">5</span> <span class="token number">4</span> <span class="token comment">//&#x6CE8;&#x610F;&#x770B;&#x8FD9;&#x884C;, &#x5B9E;&#x9645;&#x4E0A;&#x65B0;&#x7684;nums&#x5DF2;&#x7ECF;&#x6CA1;&#x6709;index 4&#x4E86;, for range&#x91CC;&#x9762;&#x7684;i&#x548C;num&#x8FD8;&#x662F;&#x80FD;&#x5728;&#x8FD9;&#x4E00;&#x8F6E;&#x53D6;&#x5230;&#x503C;</span>
<span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">4</span> <span class="token number">5</span><span class="token punctuation">]</span>
</code></pre>
<p>&#x5982;&#x679C;&#x544A;&#x8BC9;chatgpt&#x7B54;&#x6848;&#x662F;&#x9519;&#x7684;, &#x5B83;&#x4F1A;&#x4FEE;&#x6B63;&#x4EE3;&#x7801;:</p>
<pre class="language-"><code>ME: the output is [1 2 4 5], which is not correct

CHATGPT: You are correct, I apologize for the mistake in my previous answer. When you delete elements from a slice while iterating over it with range, you need to adjust the index variable to account for the removed elements.
</code></pre><p>&#x518D;&#x7ED9;&#x51FA;&#x7684;&#x7B54;&#x6848;&#x662F;&#x5BF9;&#x7684;:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Create a slice of integers</span>
    nums <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span>

    <span class="token comment">// Iterate over the slice using range</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        num <span class="token operator">:=</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token comment">// Check if the element should be deleted</span>
        <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">||</span> num <span class="token operator">==</span> <span class="token number">4</span> <span class="token punctuation">{</span>
            <span class="token comment">// Delete the element from the slice</span>
            nums <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">...</span><span class="token punctuation">)</span>
            <span class="token comment">// Adjust the index variable to account for the removed element</span>
            i<span class="token operator">--</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Print the updated slice</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;buffer&#x4E3A;1&#x7684;channel"><a name="&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;buffer&#x4E3A;1&#x7684;channel" class="anchor-navigation-ex-anchor" href="#&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;buffer&#x4E3A;1&#x7684;channel"><i class="fa fa-link" aria-hidden="true"></i></a>11. &#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;buffer&#x4E3A;1&#x7684;channel</h1>
<p>&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;errors&quot;</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errorChan <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">error</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span><span class="token function">AfterFunc</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> errorChan <span class="token operator">&lt;-</span> <span class="token boolean">nil</span><span class="token punctuation">;</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;time out&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// &#x5B9E;&#x9645;&#x573A;&#x666F;&#x53EF;&#x4EE5;&#x662F;cmd.Wait()</span>
        errorChan <span class="token operator">&lt;-</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;new error&quot;</span><span class="token punctuation">)</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;error happened&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>errorChan<span class="token punctuation">)</span>

    time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="go&#x6309;&#x4F4D;&#x53D6;&#x53CD;bitwise-not"><a name="go&#x6309;&#x4F4D;&#x53D6;&#x53CD;bitwise-not" class="anchor-navigation-ex-anchor" href="#go&#x6309;&#x4F4D;&#x53D6;&#x53CD;bitwise-not"><i class="fa fa-link" aria-hidden="true"></i></a>12. go&#x6309;&#x4F4D;&#x53D6;&#x53CD;(bitwise not)</h1>
<p>go&#x6CA1;&#x6709;&#x4E13;&#x7528;&#x7684;&#x53D6;&#x53CD;&#x64CD;&#x4F5C;&#x7B26;, &#x4F46;&#x7528;&#x5F02;&#x6216;&#x53EF;&#x4EE5;&#x53D6;&#x53CD;:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> bitwisenot <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token number">0x0F</span>

    <span class="token comment">// printing the number in 8-Bit</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%08b\n&quot;</span><span class="token punctuation">,</span> bitwisenot<span class="token punctuation">)</span> <span class="token comment">// 00001111</span>

    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%08b\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">^</span>bitwisenot<span class="token punctuation">)</span> <span class="token comment">// 11110000</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%08b\n&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">^</span>bitwisenot<span class="token punctuation">)</span> <span class="token comment">// 00001110 &#x548C;&#x4E0A;&#x9762;&#x7ED3;&#x679C;&#x4E0D;&#x4E00;&#x6837;</span>

    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%08b\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">^</span><span class="token number">0x0F</span><span class="token punctuation">)</span> <span class="token comment">// -0010000 &#x9ED8;&#x8BA4;&#x6570;&#x5B57;&#x90FD;&#x662F;int</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%08b\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0x0F</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// -0010000</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%08b\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0x0F</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1111111111111111111111111111111111111111111111111111111111110000 &#x4E0D;&#x5E26;&#x7B26;&#x53F7;&#x4F4D;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x7ED3;&#x679C;:</p>
<pre class="language-"><code>00001111
11110000
00001110
-0010000
-0010000
1111111111111111111111111111111111111111111111111111111111110000
</code></pre><h1 id="go&#x7684;&#x76F8;&#x7B49;&#x6027;"><a name="go&#x7684;&#x76F8;&#x7B49;&#x6027;" class="anchor-navigation-ex-anchor" href="#go&#x7684;&#x76F8;&#x7B49;&#x6027;"><i class="fa fa-link" aria-hidden="true"></i></a>13. go&#x7684;&#x76F8;&#x7B49;&#x6027;(==)</h1>
<p>&#x9996;&#x5148;, map&#x548C;slice&#x4E0D;&#x80FD;&#x7528;<code>==</code>&#x6BD4;&#x8F83;
function&#x4E5F;&#x4E0D;&#x80FD;&#x6BD4;&#x8F83;.</p>
<pre class="language-"><code class="lang-go">f <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">1</span> <span class="token punctuation">}</span>
g <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">2</span> <span class="token punctuation">}</span>
f <span class="token operator">==</span> g
<span class="token comment">//&#x8FD9;&#x6837;&#x6BD4;&#x8F83;&#x4F1A;&#x7F16;&#x8BD1;&#x9519;&#x8BEF;</span>
</code></pre>
<p>&#x4F46;function&#x53EF;&#x4EE5;&#x8DDF;nil&#x6BD4;&#x8F83;.</p>
<h2 id="&#x666E;&#x901A;&#x7C7B;&#x578B;&#x7684;&#x6BD4;&#x8F83;"><a name="&#x666E;&#x901A;&#x7C7B;&#x578B;&#x7684;&#x6BD4;&#x8F83;" class="anchor-navigation-ex-anchor" href="#&#x666E;&#x901A;&#x7C7B;&#x578B;&#x7684;&#x6BD4;&#x8F83;"><i class="fa fa-link" aria-hidden="true"></i></a>13.1. &#x666E;&#x901A;&#x7C7B;&#x578B;&#x7684;&#x6BD4;&#x8F83;</h2>
<p>boo, int, float, complex&#x7684;&#x6BD4;&#x8F83;&#x5C31;&#x662F;&#x666E;&#x901A;&#x6BD4;&#x8F83;. &#x4F46;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;float&#x7684;NaN&#x4E0D;&#x7B49;&#x4E8E;NaN</p>
<pre class="language-"><code class="lang-go">nan <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">NaN</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
pos_inf <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Inf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
neg_inf <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Inf</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>nan <span class="token operator">==</span> nan<span class="token punctuation">)</span>         <span class="token comment">// false</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>pos_inf <span class="token operator">==</span> pos_inf<span class="token punctuation">)</span> <span class="token comment">// true</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>neg_inf <span class="token operator">==</span> neg_inf<span class="token punctuation">)</span> <span class="token comment">// true</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>pos_inf <span class="token operator">==</span> neg_inf<span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre>
<h2 id="&#x6307;&#x9488;&#x7684;&#x76F8;&#x7B49;&#x6027;"><a name="&#x6307;&#x9488;&#x7684;&#x76F8;&#x7B49;&#x6027;" class="anchor-navigation-ex-anchor" href="#&#x6307;&#x9488;&#x7684;&#x76F8;&#x7B49;&#x6027;"><i class="fa fa-link" aria-hidden="true"></i></a>13.2. &#x6307;&#x9488;&#x7684;&#x76F8;&#x7B49;&#x6027;</h2>
<p>&#x8981;&#x4E48;&#x4E24;&#x4E2A;&#x6307;&#x9488;&#x90FD;&#x662F;nil, &#x8981;&#x4E48;&#x4E24;&#x4E2A;&#x6307;&#x9488;&#x6307;&#x5411;&#x540C;&#x6837;&#x7684;&#x5730;&#x5740;:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">var</span> p1<span class="token punctuation">,</span> p2 <span class="token operator">*</span><span class="token builtin">string</span>
name <span class="token operator">:=</span> <span class="token string">&quot;foo&quot;</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>p1 <span class="token operator">==</span> p2<span class="token punctuation">)</span> <span class="token comment">// true</span>
p1 <span class="token operator">=</span> <span class="token operator">&amp;</span>name
p2 <span class="token operator">=</span> <span class="token operator">&amp;</span>name
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>       <span class="token comment">// 0x40c148</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span>       <span class="token comment">// 0x40c148</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p1<span class="token punctuation">)</span>      <span class="token comment">// 0x40c138</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span>      <span class="token comment">// 0x40c140</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">*</span>p1<span class="token punctuation">)</span>      <span class="token comment">// foo</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">*</span>p2<span class="token punctuation">)</span>      <span class="token comment">// foo</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>p1 <span class="token operator">==</span> p2<span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;, &#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;empty struct(&#x5373;&#x7A7A;&#x7684;struct&#x5B9E;&#x4F8B;)&#x7684;&#x5730;&#x5740;&#x53EF;&#x80FD;&#x76F8;&#x7B49;</p>
<blockquote>
<p>A struct or array type has size zero if it contains no fields (or elements, respectively) that have a size greater than zero. Two distinct zero-size variables may have the same address in memory.</p>
</blockquote>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> S <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">,</span> p2 <span class="token operator">*</span>S
    s1 <span class="token operator">:=</span> S<span class="token punctuation">{</span><span class="token punctuation">}</span>
    s2 <span class="token operator">:=</span> S<span class="token punctuation">{</span><span class="token punctuation">}</span>
    p1 <span class="token operator">=</span> <span class="token operator">&amp;</span>s1
    p2 <span class="token operator">=</span> <span class="token operator">&amp;</span>s2
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%p\n&quot;</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span> <span class="token comment">// 0x1e52bc</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%p\n&quot;</span><span class="token punctuation">,</span> p2<span class="token punctuation">)</span> <span class="token comment">// 0x1e52bc</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>        <span class="token comment">// &amp;{}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span>        <span class="token comment">// &amp;{}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p1<span class="token punctuation">)</span>       <span class="token comment">// 0x40c138</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span>       <span class="token comment">// 0x40c140</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">*</span>p1<span class="token punctuation">)</span>       <span class="token comment">// {}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">*</span>p2<span class="token punctuation">)</span>       <span class="token comment">// {}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>p1 <span class="token operator">==</span> p2<span class="token punctuation">)</span>  <span class="token comment">// true &#x672C;&#x6765;s1&#x548C;s2&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x4E1C;&#x897F;, &#x5F53;&#x90FD;&#x662F;&#x7A7A;, &#x4ED6;&#x4EEC;&#x7684;&#x5730;&#x5740;&#x76F8;&#x540C;, &#x6240;&#x4EE5;&#x76F8;&#x7B49;.</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5982;&#x679C;&#x7ED3;&#x6784;&#x4F53;&#x975E;&#x7A7A;, <code>S struct {f int}</code>, <code>p1</code>&#x548C;<code>p2</code>&#x5C31;&#x4E0D;&#x76F8;&#x7B49;&#x4E86;.</p>
<h3 id="errorsneweof&#x4E0D;&#x7B49;&#x4E8E;ioeof"><a name="errorsneweof&#x4E0D;&#x7B49;&#x4E8E;ioeof" class="anchor-navigation-ex-anchor" href="#errorsneweof&#x4E0D;&#x7B49;&#x4E8E;ioeof"><i class="fa fa-link" aria-hidden="true"></i></a>13.2.1. errors.New(&quot;EOF&quot;)&#x4E0D;&#x7B49;&#x4E8E;io.EOF</h3>
<p><code>io.EOF</code>&#x5728;io&#x5305;&#x91CC;&#x5B9A;&#x4E49;&#x4E3A;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">var</span> EOF <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;EOF&quot;</span><span class="token punctuation">)</span>
</code></pre>
<p>New&#x51FA;&#x6765;&#x7684;&#x5BF9;&#x8C61;&#x662F;&#x4E2A;&#x6307;&#x9488;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">package</span> errors

<span class="token comment">// New returns an error that formats as the given text.</span>
<span class="token comment">// Each call to New returns a distinct error value even if the text is identical.</span>
<span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>text <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>errorString<span class="token punctuation">{</span>text<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// errorString is a trivial implementation of error.</span>
<span class="token keyword">type</span> errorString <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    s <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>e <span class="token operator">*</span>errorString<span class="token punctuation">)</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> e<span class="token punctuation">.</span>s
<span class="token punctuation">}</span>
</code></pre>
<p>&#x6839;&#x636E;&#x6307;&#x9488;&#x7684;&#x76F8;&#x7B49;&#x6027;, &#x5176;&#x6307;&#x5411;&#x7684;&#x5730;&#x5740;&#x76F8;&#x7B49;&#x624D;&#x7B97;&#x76F8;&#x7B49;.<br>&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x663E;&#x793A;&#x867D;&#x7136;myErr&#x548C;io.EOF&#x90FD;&#x662F;&#x540C;&#x6837;&#x7684;&#x5185;&#x5BB9;, &#x4F46;&#x4E8C;&#x8005;<strong>&#x5E76;&#x4E0D;&#x76F8;&#x7B49;</strong>.</p>
<pre class="language-"><code>package main

import (
    &quot;errors&quot;
    &quot;fmt&quot;
    &quot;io&quot;
)

func main() {
    myErr := errors.New(&quot;EOF&quot;)
    fmt.Printf(&quot;%#v\n&quot;, myErr)
    fmt.Printf(&quot;%#v\n&quot;, io.EOF)
    if myErr == io.EOF {
        fmt.Println(&quot;equal&quot;)
    } else {
        fmt.Println(&quot;not equal&quot;)
    }
}

//&#x8F93;&#x51FA;
&amp;errors.errorString{s:&quot;EOF&quot;}
&amp;errors.errorString{s:&quot;EOF&quot;}
not equal
</code></pre><h2 id="channel&#x7684;&#x76F8;&#x7B49;&#x6027;"><a name="channel&#x7684;&#x76F8;&#x7B49;&#x6027;" class="anchor-navigation-ex-anchor" href="#channel&#x7684;&#x76F8;&#x7B49;&#x6027;"><i class="fa fa-link" aria-hidden="true"></i></a>13.3. channel&#x7684;&#x76F8;&#x7B49;&#x6027;</h2>
<p>&#x6EE1;&#x8DB3;&#x4E0B;&#x9762;&#x6761;&#x4EF6;&#x4E4B;&#x4E00;</p>
<ul>
<li>&#x4E24;&#x4E2A;chnnel&#x90FD;&#x662F;nil</li>
<li>&#x4E24;&#x4E2A;&#x90FD;&#x662F;&#x4ECE;&#x540C;&#x4E00;&#x4E2A;make&#x51FD;&#x6570;&#x751F;&#x6210;&#x7684;</li>
</ul>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">f</span><span class="token punctuation">(</span>ch1 <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> ch2 <span class="token operator">*</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>ch1 <span class="token operator">==</span> <span class="token operator">*</span>ch2<span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> ch1<span class="token punctuation">,</span> ch2 <span class="token keyword">chan</span> <span class="token builtin">int</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>ch1 <span class="token operator">==</span> ch2<span class="token punctuation">)</span> <span class="token comment">// true</span>
    ch1 <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
    ch2 <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>ch1 <span class="token operator">==</span> ch2<span class="token punctuation">)</span> <span class="token comment">// false</span>
    ch2 <span class="token operator">=</span> ch1
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%p\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ch1<span class="token punctuation">)</span> <span class="token comment">// 0x40c138</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%p\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ch2<span class="token punctuation">)</span> <span class="token comment">// 0x40c140</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>ch1 <span class="token operator">==</span> ch2<span class="token punctuation">)</span>  <span class="token comment">// true</span>
    <span class="token function">f</span><span class="token punctuation">(</span>ch1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ch1<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="interface&#x7684;&#x76F8;&#x7B49;&#x6027;"><a name="interface&#x7684;&#x76F8;&#x7B49;&#x6027;" class="anchor-navigation-ex-anchor" href="#interface&#x7684;&#x76F8;&#x7B49;&#x6027;"><i class="fa fa-link" aria-hidden="true"></i></a>13.4. interface&#x7684;&#x76F8;&#x7B49;&#x6027;</h2>
<ul>
<li>&#x4E24;&#x4E2A;interface&#x90FD;&#x662F;nil(&#x6CE8;&#x610F;&#x52A8;&#x6001;&#x7C7B;&#x578B;&#x4E5F;&#x8981;&#x662F;nil)<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> I <span class="token keyword">interface</span><span class="token punctuation">{</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword">type</span> T <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>t T<span class="token punctuation">)</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> t T
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
  <span class="token keyword">var</span> i I <span class="token operator">=</span> t
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>                   <span class="token comment">// false</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token comment">// main.T</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsNil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
<li>&#x52A8;&#x6001;&#x7C7B;&#x578B;&#x76F8;&#x540C;, &#x5E76;&#x4E14;&#x52A8;&#x6001;&#x503C;&#x76F8;&#x7B49;<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> A <span class="token builtin">int</span>
<span class="token keyword">type</span> B <span class="token operator">=</span> A
<span class="token keyword">type</span> C <span class="token builtin">int</span>
<span class="token keyword">type</span> I <span class="token keyword">interface</span><span class="token punctuation">{</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>a A<span class="token punctuation">)</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c C<span class="token punctuation">)</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a I <span class="token operator">=</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> b I <span class="token operator">=</span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> c I <span class="token operator">=</span> <span class="token function">C</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span> <span class="token comment">// true &#x8FD9;&#x91CC;A&#x548C;B&#x662F;&#x5F3A;&#x522B;&#x540D;(=&#x53F7;&#x522B;&#x540D;), &#x7C7B;&#x578B;&#x662F;&#x4E00;&#x6837;&#x7684;.</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b <span class="token operator">==</span> c<span class="token punctuation">)</span> <span class="token comment">// false &#x7C7B;&#x578B;&#x4E0D;&#x540C;&#x4E0D;&#x76F8;&#x7B49;</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a <span class="token operator">==</span> c<span class="token punctuation">)</span> <span class="token comment">// false &#x7C7B;&#x578B;&#x4E0D;&#x540C;&#x4E0D;&#x76F8;&#x7B49;</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
</ul>
<p>&#x7C7B;&#x578B;I&#x7684;interface&#x53D8;&#x91CF;i&#x53EF;&#x4EE5;&#x548C;&#x666E;&#x901A;&#x7C7B;&#x578B;X&#x7684;&#x5B9E;&#x4F8B;x&#x6BD4;&#x8F83;, &#x53EA;&#x8981;</p>
<ul>
<li>&#x7C7B;&#x578B;X&#x5B9E;&#x73B0;&#x4E86;&#x63A5;&#x53E3;I</li>
<li>&#x7C7B;&#x578B;X&#x53EF;&#x4EE5;&#x6BD4;&#x8F83;</li>
</ul>
<p>&#x6240;&#x4EE5;i&#x548C;x&#x6BD4;&#x8F83;, &#x5982;&#x679C;i&#x7684;&#x52A8;&#x6001;&#x7C7B;&#x578B;&#x662F;X, i&#x7684;&#x52A8;&#x6001;&#x503C;&#x53C8;&#x7B49;&#x4E8E;x, &#x90A3;&#x4E48;i&#x548C;x&#x76F8;&#x7B49;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> I <span class="token keyword">interface</span><span class="token punctuation">{</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword">type</span> X <span class="token builtin">int</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>x X<span class="token punctuation">)</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">type</span> Y <span class="token builtin">int</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>y Y<span class="token punctuation">)</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">type</span> Z <span class="token builtin">int</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> i I <span class="token operator">=</span> <span class="token function">X</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token function">X</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token function">Y</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
    <span class="token comment">// fmt.Println(i == Z(1)) // mismatched types I and C</span>
    <span class="token comment">// fmt.Println(i == 1) // mismatched types I and int</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5982;&#x679C;&#x52A8;&#x6001;&#x7C7B;&#x578B;&#x76F8;&#x7B49;, &#x4F46;&#x8FD9;&#x4E2A;&#x7C7B;&#x578B;&#x4E0D;&#x80FD;&#x6BD4;&#x8F83;, &#x5219;&#x4F1A;&#x4EA7;&#x751F;panic:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> A <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> i <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">=</span> A<span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">var</span> j <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">=</span> A<span class="token punctuation">{</span><span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i <span class="token operator">==</span> j<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token builtin">panic</span><span class="token punctuation">:</span> runtime <span class="token builtin">error</span><span class="token punctuation">:</span> comparing uncomparable <span class="token keyword">type</span> main<span class="token punctuation">.</span>A
</code></pre>
<p>&#x5982;&#x679C;&#x52A8;&#x6001;&#x7C7B;&#x578B;&#x4E0D;&#x4E00;&#x6837;, &#x90A3;&#x5C31;&#x76F4;&#x63A5;&#x4E0D;&#x7B49;:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> A <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
<span class="token keyword">type</span> B <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// A{} == A{} // slice can only be compared to nil</span>
    <span class="token keyword">var</span> i <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">=</span> A<span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">var</span> j <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">=</span> B<span class="token punctuation">{</span><span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i <span class="token operator">==</span> j<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x76F8;&#x7B49;&#x6027;"><a name="&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x76F8;&#x7B49;&#x6027;" class="anchor-navigation-ex-anchor" href="#&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x76F8;&#x7B49;&#x6027;"><i class="fa fa-link" aria-hidden="true"></i></a>13.5. &#x7ED3;&#x6784;&#x4F53;&#x7684;&#x76F8;&#x7B49;&#x6027;</h2>
<p>&#x9996;&#x5148;, &#x7ED3;&#x6784;&#x4F53;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7528;<code>==</code>&#x64CD;&#x4F5C;&#x7B26;&#x6BD4;&#x8F83;.
&#x5982;&#x679C;&#x91CC;&#x9762;&#x7684;&#x975E;<code>_</code>&#x57DF;&#x90FD;&#x76F8;&#x7B49;, &#x5219;&#x4E24;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x76F8;&#x7B49;. &#x6CE8;&#x610F;, &#x7ED3;&#x6784;&#x4F53;&#x91CC;&#x9762;&#x7684;&#x5927;&#x5199;, &#x5C0F;&#x5199;&#x57DF;&#x90FD;&#x8981;&#x76F8;&#x7B49;.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> A <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token boolean">_</span> <span class="token builtin">float64</span>
    f1 <span class="token builtin">int</span>
    F2 <span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> B <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token boolean">_</span> <span class="token builtin">float64</span>
    f1 <span class="token builtin">int</span>
    F2 <span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>A<span class="token punctuation">{</span><span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">}</span> <span class="token operator">==</span> A<span class="token punctuation">{</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
    <span class="token comment">// fmt.Println(A{} == B{}) // mismatched types A and B </span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5F53;&#x5224;&#x65AD;<code>x==y</code>&#x65F6;, &#x53EA;&#x6709;x&#x53EF;&#x4EE5;&#x8D4B;&#x503C;&#x7ED9;y&#x6216;&#x8005;y&#x53EF;&#x4EE5;&#x8D4B;&#x503C;&#x7ED9;x&#x624D;&#x80FD;&#x7528;<code>==</code>&#x64CD;&#x505A;&#x7B26;.
&#x6240;&#x4EE5;&#x4E0B;&#x9762;&#x7684;&#x5224;&#x65AD;&#x662F;&#x4E0D;&#x884C;&#x7684;, &#x7F16;&#x8BD1;&#x65F6;&#x5C31;&#x4F1A;&#x62A5;&#x9519;.</p>
<pre class="language-"><code class="lang-go">A<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">==</span> B<span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre>
<h2 id="array&#x7684;&#x76F8;&#x7B49;&#x6027;"><a name="array&#x7684;&#x76F8;&#x7B49;&#x6027;" class="anchor-navigation-ex-anchor" href="#array&#x7684;&#x76F8;&#x7B49;&#x6027;"><i class="fa fa-link" aria-hidden="true"></i></a>13.6. Array&#x7684;&#x76F8;&#x7B49;&#x6027;</h2>
<p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x8BF4;&#x7684;&#x662F;Array, &#x4E0D;&#x662F;slice.
Array&#x91CC;&#x9762;&#x7684;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x90FD;&#x76F8;&#x7B49;&#x7684;&#x8BDD;, &#x4E24;&#x4E2A;array&#x76F8;&#x7B49;.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> T <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    name <span class="token builtin">string</span>
    age <span class="token builtin">int</span>
    <span class="token boolean">_</span> <span class="token builtin">float64</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   x <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{</span><span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3.14</span><span class="token punctuation">}</span>
   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{</span><span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3.14</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
   y <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>T<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>y <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>T<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="string"><a name="string" class="anchor-navigation-ex-anchor" href="#string"><i class="fa fa-link" aria-hidden="true"></i></a>13.7. string</h2>
<p>string&#x7684;&#x6BD4;&#x8F83;&#x6309;&#x7167;<code>[]byte</code>&#x6309;&#x5B57;&#x8282;&#x6BD4;&#x8F83;.</p>
<pre class="language-"><code class="lang-go">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span><span class="token string">&quot;&#x142;&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;&#x141;&quot;</span><span class="token punctuation">)</span>     <span class="token comment">// true</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>                  <span class="token comment">// true</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;FOO&quot;</span><span class="token punctuation">)</span>                  <span class="token comment">// false</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Micha&#x142;&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;Michal&quot;</span><span class="token punctuation">)</span>            <span class="token comment">// false</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x17C;ond&#x142;o&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;&#x17C;ond&#x142;o&quot;</span><span class="token punctuation">)</span>            <span class="token comment">// true</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x17C;ond&#x142;o&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;&#x17C;ond&#x142;o&quot;</span><span class="token punctuation">)</span>            <span class="token comment">// false</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">EqualFold</span><span class="token punctuation">(</span><span class="token string">&quot;&#x105;&#x106;&#x17A;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&#x104;&#x107;&#x179;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre>
<h2 id="byte&#x7528;bytesequal&#x6BD4;&#x8F83;"><a name="byte&#x7528;bytesequal&#x6BD4;&#x8F83;" class="anchor-navigation-ex-anchor" href="#byte&#x7528;bytesequal&#x6BD4;&#x8F83;"><i class="fa fa-link" aria-hidden="true"></i></a>13.8. []byte&#x7528;bytes.Equal&#x6BD4;&#x8F83;</h2>
<p>&#x5207;&#x7247;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x6BD4;&#x8F83;. &#x4F46;<code>bytes.Equal</code>&#x53EF;&#x4EE5;&#x6BD4;&#x8F83;&#x4E24;&#x4E2A;<code>[]byte</code></p>
<pre class="language-"><code class="lang-go">s1 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span><span class="token char">&apos;f&apos;</span><span class="token punctuation">,</span> <span class="token char">&apos;o&apos;</span><span class="token punctuation">,</span> <span class="token char">&apos;o&apos;</span><span class="token punctuation">}</span>
s2 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span><span class="token char">&apos;f&apos;</span><span class="token punctuation">,</span> <span class="token char">&apos;o&apos;</span><span class="token punctuation">,</span> <span class="token char">&apos;o&apos;</span><span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
s2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span><span class="token char">&apos;b&apos;</span><span class="token punctuation">,</span> <span class="token char">&apos;a&apos;</span><span class="token punctuation">,</span> <span class="token char">&apos;r&apos;</span><span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
s2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span><span class="token char">&apos;f&apos;</span><span class="token punctuation">,</span> <span class="token char">&apos;O&apos;</span><span class="token punctuation">,</span> <span class="token char">&apos;O&apos;</span><span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">EqualFold</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
s1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;&#x17A;d&#x17A;b&#x142;o&quot;</span><span class="token punctuation">)</span>
s2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;&#x17A;d&#x179;b&#x141;O&quot;</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">EqualFold</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
s1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
s2 <span class="token operator">=</span> <span class="token boolean">nil</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre>
<h2 id="reflectdeepequal&#x4E07;&#x80FD;&#x6BD4;&#x8F83;"><a name="reflectdeepequal&#x4E07;&#x80FD;&#x6BD4;&#x8F83;" class="anchor-navigation-ex-anchor" href="#reflectdeepequal&#x4E07;&#x80FD;&#x6BD4;&#x8F83;"><i class="fa fa-link" aria-hidden="true"></i></a>13.9. reflect.DeepEqual&#x4E07;&#x80FD;&#x6BD4;&#x8F83;</h2>
<p><code>func DeepEqual(x, y interface{}) bool</code>&#x53EF;&#x4EE5;&#x6BD4;&#x8F83;&#x4EFB;&#x610F;&#x4E24;&#x4E2A;&#x503C;.
&#x6BD4;&#x5982;map</p>
<pre class="language-"><code class="lang-go">m1 <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
m2 <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
<span class="token comment">// fmt.Println(m1 == m2) // map can only be compared to nil</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>m1<span class="token punctuation">,</span> m2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
m2 <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>m1<span class="token punctuation">,</span> m2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
m3 <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
m4 <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>m3<span class="token punctuation">,</span> m4<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token keyword">var</span> m5 <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">float64</span><span class="token punctuation">]</span><span class="token builtin">string</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>m5<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>m5 <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre>
<p>&#x6BD4;&#x5982;slice</p>
<pre class="language-"><code class="lang-go">s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
s <span class="token operator">=</span> <span class="token boolean">nil</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre>
<p>&#x6BD4;&#x5982;&#x7ED3;&#x6784;&#x4F53;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> T <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    name <span class="token builtin">string</span>
    Age  <span class="token builtin">int</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t <span class="token operator">:=</span> T<span class="token punctuation">{</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> T<span class="token punctuation">{</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> T<span class="token punctuation">{</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> T<span class="token punctuation">{</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="cmp&#x5305;"><a name="cmp&#x5305;" class="anchor-navigation-ex-anchor" href="#cmp&#x5305;"><i class="fa fa-link" aria-hidden="true"></i></a>13.10. cmp&#x5305;</h2>
<p>google&#x63D0;&#x4F9B;&#x4E86;cmp&#x5305;, &#x53EF;&#x4EE5;&#x6253;&#x5370;&#x4E24;&#x4E2A;&#x503C;&#x7684;&#x5DEE;&#x5F02;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;github.com/google/go-cmp/cmp&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">type</span> T <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Name <span class="token builtin">string</span>
    Age  <span class="token builtin">int</span>
    City <span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x <span class="token operator">:=</span> T<span class="token punctuation">{</span><span class="token string">&quot;Micha&#x142;&quot;</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token string">&quot;London&quot;</span><span class="token punctuation">}</span>
    y <span class="token operator">:=</span> T<span class="token punctuation">{</span><span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token string">&quot;London&quot;</span><span class="token punctuation">}</span>
    <span class="token keyword">if</span> diff <span class="token operator">:=</span> cmp<span class="token punctuation">.</span><span class="token function">Diff</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> diff <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>diff<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x8F93;&#x51FA;</p>
<pre class="language-"><code class="lang-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> main.T{
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       Name: &quot;Micha&#x142;&quot;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       Name: &quot;Adam&quot;,
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       Age:  99,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       Age:  88,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       City: &quot;London&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span></code></pre>
<h1 id="&#x901A;&#x8FC7;unix-socket&#x53D1;&#x9001;fd"><a name="&#x901A;&#x8FC7;unix-socket&#x53D1;&#x9001;fd" class="anchor-navigation-ex-anchor" href="#&#x901A;&#x8FC7;unix-socket&#x53D1;&#x9001;fd"><i class="fa fa-link" aria-hidden="true"></i></a>14. &#x901A;&#x8FC7;unix socket&#x53D1;&#x9001;fd</h1>
<p>gvisor&#x7684;<code>pkg/unet/unet.go</code>&#x91CC;&#x9762;&#x63D0;&#x4F9B;&#x4E86;listen, accept&#x7B49;&#x65B9;&#x6CD5;
unet&#x662F;&#x7ED9;server&#x7AEF;&#x7528;&#x7684;. &#x6BD4;&#x5982;read&#x548C;write&#x65B9;&#x6CD5;, &#x5148;&#x5C1D;&#x8BD5;&#x7528;&#x963B;&#x585E;&#x5F0F;&#x7684;<code>unix.RawSyscall(unix.SYS_RECVMSG, ...)</code>, &#x4E0D;&#x884C;&#x518D;&#x7528;&#x5BF9;fd&#x7684;poll<code>unix.Syscall6(unix.SYS_PPOLL, ...)</code></p>
<p>&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x901A;&#x8FC7;unix socket&#x53D1;&#x9001;/&#x63A5;&#x6536;fd&#x7684;&#x65B9;&#x6CD5;:</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// PackFDs packs the given list of FDs in the control message.</span>
<span class="token comment">//</span>
<span class="token comment">// This must be used prior to WriteVec.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>ControlMessage<span class="token punctuation">)</span> <span class="token function">PackFDs</span><span class="token punctuation">(</span>fds <span class="token operator">...</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">*</span>c <span class="token operator">=</span> <span class="token function">ControlMessage</span><span class="token punctuation">(</span>unix<span class="token punctuation">.</span><span class="token function">UnixRights</span><span class="token punctuation">(</span>fds<span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ExtractFDs returns the list of FDs in the control message.</span>
<span class="token comment">//</span>
<span class="token comment">// Either this or CloseFDs should be used after EnableFDs.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>ControlMessage<span class="token punctuation">)</span> <span class="token function">ExtractFDs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    msgs<span class="token punctuation">,</span> err <span class="token operator">:=</span> unix<span class="token punctuation">.</span><span class="token function">ParseSocketControlMessage</span><span class="token punctuation">(</span><span class="token operator">*</span>c<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> fds <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> msg <span class="token operator">:=</span> <span class="token keyword">range</span> msgs <span class="token punctuation">{</span>
        thisFds<span class="token punctuation">,</span> err <span class="token operator">:=</span> unix<span class="token punctuation">.</span><span class="token function">ParseUnixRights</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>msg<span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            <span class="token comment">// Different control message.</span>
            <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> fd <span class="token operator">:=</span> <span class="token keyword">range</span> thisFds <span class="token punctuation">{</span>
            <span class="token keyword">if</span> fd <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
                fds <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>fds<span class="token punctuation">,</span> fd<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> fds<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x88AB;extract&#x51FA;&#x6765;&#x7684;fd&#x53EF;&#x4EE5;&#x7528;&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x51FD;&#x6570;&#x6765;&#x751F;&#x6210;&#x4E00;&#x4E2A;File&#x5BF9;&#x8C61;.</p>
<pre class="language-"><code class="lang-go"><span class="token comment">//&#x6BD4;&#x5982;&#x8C03;&#x7528;</span>
os<span class="token punctuation">.</span><span class="token function">NewFile</span><span class="token punctuation">(</span><span class="token function">uintptr</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;urpc&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// NewFile returns a new File with the given file descriptor and</span>
<span class="token comment">// name. The returned value will be nil if fd is not a valid file</span>
<span class="token comment">// descriptor. On Unix systems, if the file descriptor is in</span>
<span class="token comment">// non-blocking mode, NewFile will attempt to return a pollable File</span>
<span class="token comment">// (one for which the SetDeadline methods work).</span>
<span class="token comment">//</span>
<span class="token comment">// After passing it to NewFile, fd may become invalid under the same</span>
<span class="token comment">// conditions described in the comments of the Fd method, and the same</span>
<span class="token comment">// constraints apply.</span>
<span class="token keyword">func</span> <span class="token function">NewFile</span><span class="token punctuation">(</span>fd <span class="token builtin">uintptr</span><span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>File
</code></pre>
<h2 id="&#x53D1;&#x9001;"><a name="&#x53D1;&#x9001;" class="anchor-navigation-ex-anchor" href="#&#x53D1;&#x9001;"><i class="fa fa-link" aria-hidden="true"></i></a>14.1. &#x53D1;&#x9001;</h2>
<pre class="language-"><code class="lang-go"><span class="token comment">//@pkg/lisafs/sock.go</span>
<span class="token comment">// writeTo writes the passed iovec to the UDS and donates any passed FDs.</span>
<span class="token keyword">func</span> <span class="token function">writeTo</span><span class="token punctuation">(</span>sock <span class="token operator">*</span>unet<span class="token punctuation">.</span>Socket<span class="token punctuation">,</span> iovec <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> dataLen <span class="token builtin">int</span><span class="token punctuation">,</span> fds <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    w <span class="token operator">:=</span> sock<span class="token punctuation">.</span><span class="token function">Writer</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token comment">//&#x8FD9;&#x91CC;&#x7684;fds&#x662F;&#x53EF;&#x9009;&#x7684;, &#x4F1A;&#x505A;&#x4E3A;control msg&#x6765;&#x53D1;&#x9001;</span>
    <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>fds<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        w<span class="token punctuation">.</span><span class="token function">PackFDs</span><span class="token punctuation">(</span>fds<span class="token operator">...</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> n <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> dataLen<span class="token punctuation">;</span> <span class="token punctuation">{</span>
        cur<span class="token punctuation">,</span> err <span class="token operator">:=</span> w<span class="token punctuation">.</span><span class="token function">WriteVec</span><span class="token punctuation">(</span>iovec<span class="token punctuation">)</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x63A5;&#x6536;"><a name="&#x63A5;&#x6536;" class="anchor-navigation-ex-anchor" href="#&#x63A5;&#x6536;"><i class="fa fa-link" aria-hidden="true"></i></a>14.2. &#x63A5;&#x6536;</h2>
<pre class="language-"><code class="lang-go"><span class="token comment">//@pkg/lisafs/sock.go</span>
<span class="token comment">// readFrom fills the passed buffer with data from the socket. It also returns</span>
<span class="token comment">// any donated FDs.</span>
<span class="token keyword">func</span> <span class="token function">readFrom</span><span class="token punctuation">(</span>sock <span class="token operator">*</span>unet<span class="token punctuation">.</span>Socket<span class="token punctuation">,</span> buf <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> wantFDs <span class="token builtin">uint8</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    r <span class="token operator">:=</span> sock<span class="token punctuation">.</span><span class="token function">Reader</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">EnableFDs</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>wantFDs<span class="token punctuation">)</span><span class="token punctuation">)</span>
    n <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>
    <span class="token keyword">for</span> got <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> got <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token punctuation">{</span>
        cur<span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">ReadVec</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span>buf<span class="token punctuation">[</span>got<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x53D1;&#x9001;2"><a name="&#x53D1;&#x9001;2" class="anchor-navigation-ex-anchor" href="#&#x53D1;&#x9001;2"><i class="fa fa-link" aria-hidden="true"></i></a>14.3. &#x53D1;&#x9001;2</h2>
<pre class="language-"><code class="lang-go"><span class="token comment">//@pkg/urpc/urpc.go</span>
<span class="token comment">// marshal sends the given FD and json struct.</span>
<span class="token keyword">func</span> <span class="token function">marshal</span><span class="token punctuation">(</span>s <span class="token operator">*</span>unet<span class="token punctuation">.</span>Socket<span class="token punctuation">,</span> v <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> fs <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>os<span class="token punctuation">.</span>File<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token comment">// Marshal to a buffer.</span>
    data<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Warningf</span><span class="token punctuation">(</span><span class="token string">&quot;urpc: error marshalling %s: %s&quot;</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%v&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> err
    <span class="token punctuation">}</span>

    <span class="token comment">// Write to the socket.</span>
    w <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Writer</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> fs <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> fds <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>
        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> f <span class="token operator">:=</span> <span class="token keyword">range</span> fs <span class="token punctuation">{</span>
            fds <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>fds<span class="token punctuation">,</span> <span class="token function">int</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">Fd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        w<span class="token punctuation">.</span><span class="token function">PackFDs</span><span class="token punctuation">(</span>fds<span class="token operator">...</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x63A5;&#x6536;2"><a name="&#x63A5;&#x6536;2" class="anchor-navigation-ex-anchor" href="#&#x63A5;&#x6536;2"><i class="fa fa-link" aria-hidden="true"></i></a>14.4. &#x63A5;&#x6536;2</h2>
<pre class="language-"><code class="lang-go"><span class="token comment">//@pkg/urpc/urpc.go</span>
<span class="token comment">// unmarhsal receives an FD (optional) and unmarshals the given struct.</span>
<span class="token keyword">func</span> <span class="token function">unmarshal</span><span class="token punctuation">(</span>s <span class="token operator">*</span>unet<span class="token punctuation">.</span>Socket<span class="token punctuation">,</span> v <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>os<span class="token punctuation">.</span>File<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Receive a single byte.</span>
    r <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Reader</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">EnableFDs</span><span class="token punctuation">(</span>maxFiles<span class="token punctuation">)</span>
    firstByte <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token comment">// Extract any FDs that may be there.</span>
    <span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">ReadVec</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span>firstByte<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
    fds<span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">ExtractFDs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x5E76;mmap&#x6210;&#x7ED3;&#x6784;&#x4F53;"><a name="&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x5E76;mmap&#x6210;&#x7ED3;&#x6784;&#x4F53;" class="anchor-navigation-ex-anchor" href="#&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x5E76;mmap&#x6210;&#x7ED3;&#x6784;&#x4F53;"><i class="fa fa-link" aria-hidden="true"></i></a>15. &#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x5E76;mmap&#x6210;&#x7ED3;&#x6784;&#x4F53;</h1>
<h2 id="memfdcreate&#x7CFB;&#x7EDF;&#x8C03;&#x7528;"><a name="memfdcreate&#x7CFB;&#x7EDF;&#x8C03;&#x7528;" class="anchor-navigation-ex-anchor" href="#memfdcreate&#x7CFB;&#x7EDF;&#x8C03;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>15.1. memfd_create()&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</h2>
<pre class="language-"><code class="lang-c">       <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/memfd.h&gt;</span></span>

       <span class="token keyword">int</span> <span class="token function">memfd_create</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x7528;tmpfs&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x6587;&#x4EF6;, &#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x548C;&#x901A;&#x5E38;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x6CA1;&#x5173;&#x7CFB;, &#x4F46;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x64CD;&#x505A;.
&#x53EF;&#x4EE5;&#x7528;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x6765;&#x5171;&#x4EAB;&#x5185;&#x5B58;:</p>
<ul>
<li>&#x8FDB;&#x7A0B;A&#x8C03;&#x7528;memfd_create(), &#x8FD4;&#x56DE;fd</li>
<li>&#x8FDB;&#x7A0B;B&#x53BB;&#x6253;&#x5F00;<code>/proc/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pid</span><span class="token punctuation">&gt;</span></span>/fd/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fd</span><span class="token punctuation">&gt;</span></span></code>(pid&#x662F;&#x8FDB;&#x7A0B;A&#x7684;pid, fd&#x662F;A&#x8C03;&#x7528;memfd_create()&#x8FD4;&#x56DE;&#x7684;fd&#x53F7;.), &#x6253;&#x5F00;&#x540E;&#x53EF;&#x4EE5;mmap, &#x5C31;&#x770B;&#x5230;&#x8FDB;&#x7A0B;A&#x4E00;&#x6837;&#x7684;&#x5185;&#x5BB9;&#x4E86;.</li>
</ul>
<h2 id="gvisor&#x4E2D;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;"><a name="gvisor&#x4E2D;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;" class="anchor-navigation-ex-anchor" href="#gvisor&#x4E2D;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;"><i class="fa fa-link" aria-hidden="true"></i></a>15.2. gvisor&#x4E2D;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;</h2>
<pre class="language-"><code class="lang-go"><span class="token comment">//RTMemoryStats&#x662F;&#x8981;&#x88AB;mmap&#x7684;&#x7ED3;&#x6784;&#x4F53;</span>
<span class="token comment">// RTMemoryStatsSize is the size of the RTMemoryStats struct.</span>
<span class="token keyword">var</span> RTMemoryStatsSize <span class="token operator">=</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>RTMemoryStats<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// RTMemoryStatsPointer casts addr to a RTMemoryStats pointer.</span>
<span class="token keyword">func</span> <span class="token function">RTMemoryStatsPointer</span><span class="token punctuation">(</span>addr <span class="token builtin">uintptr</span><span class="token punctuation">)</span> <span class="token operator">*</span>RTMemoryStats <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">*</span>RTMemoryStats<span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">&quot;memory-usage&quot;</span>
fd<span class="token punctuation">,</span> err <span class="token operator">:=</span> memutil<span class="token punctuation">.</span><span class="token function">CreateMemFD</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    p<span class="token punctuation">,</span> err <span class="token operator">:=</span> unix<span class="token punctuation">.</span><span class="token function">BytePtrFromString</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    fd<span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">,</span> e <span class="token operator">:=</span> unix<span class="token punctuation">.</span><span class="token function">Syscall</span><span class="token punctuation">(</span>unix<span class="token punctuation">.</span>SYS_MEMFD_CREATE<span class="token punctuation">,</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>flags<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
file <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">NewFile</span><span class="token punctuation">(</span><span class="token function">uintptr</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
<span class="token comment">//&#x8BBE;&#x7F6E;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x4E3A;&#x7ED3;&#x6784;&#x4F53;RTMemoryStatsSize&#x7684;&#x5927;&#x5C0F;</span>
file<span class="token punctuation">.</span><span class="token function">Truncate</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>RTMemoryStatsSize<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//mmap&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;</span>
mmap<span class="token punctuation">,</span> err <span class="token operator">:=</span> memutil<span class="token punctuation">.</span><span class="token function">MapFile</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> RTMemoryStatsSize<span class="token punctuation">,</span> unix<span class="token punctuation">.</span>PROT_READ<span class="token operator">|</span>unix<span class="token punctuation">.</span>PROT_WRITE<span class="token punctuation">,</span> unix<span class="token punctuation">.</span>MAP_SHARED<span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">Fd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">//&#x73B0;&#x5728;&#x5168;&#x5C40;&#x53D8;&#x91CF;MemoryAccounting.RTMemoryStats&#x5C31;&#x6307;&#x5411;&#x4E86;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;.</span>
<span class="token comment">//&#x76F4;&#x63A5;&#x7528;&#x90A3;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x4E0D;&#x9999;&#x5417;?</span>
MemoryAccounting <span class="token operator">=</span> <span class="token operator">&amp;</span>MemoryLocked<span class="token punctuation">{</span>
    File<span class="token punctuation">:</span>          file<span class="token punctuation">,</span>
    RTMemoryStats<span class="token punctuation">:</span> <span class="token function">RTMemoryStatsPointer</span><span class="token punctuation">(</span>mmap<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="&#x7528;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;-&#x904D;&#x5386;procselfmaps"><a name="&#x7528;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;-&#x904D;&#x5386;procselfmaps" class="anchor-navigation-ex-anchor" href="#&#x7528;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;-&#x904D;&#x5386;procselfmaps"><i class="fa fa-link" aria-hidden="true"></i></a>16. &#x7528;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F; &#x904D;&#x5386;/proc/self/maps</h1>
<p>&#x6BD4;&#x5982;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#x60F3;&#x89E3;&#x6790;&#x5F53;&#x524D;&#x8FDB;&#x7A0B;&#x7684;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;:</p>
<pre class="language-"><code class="lang-sh">$ <span class="token function">cat</span> /proc/self/maps
55cb9cb6b000-55cb9cb73000 r-xp 00000000 fc:02 <span class="token number">396</span>                        /bin/cat
55cb9cd72000-55cb9cd73000 r--p 00007000 fc:02 <span class="token number">396</span>                        /bin/cat
55cb9cd73000-55cb9cd74000 rw-p 00008000 fc:02 <span class="token number">396</span>                        /bin/cat
55cb9e7a2000-55cb9e7c3000 rw-p 00000000 00:00 <span class="token number">0</span>                          <span class="token punctuation">[</span>heap<span class="token punctuation">]</span>
7f3367281000-7f336754d000 r--p 00000000 fc:02 <span class="token number">7228</span>                       /usr/lib/locale/locale-archive
7f336754d000-7f3367734000 r-xp 00000000 fc:02 <span class="token number">44721</span>                      /lib/x86_64-linux-gnu/libc-2.27.so
7f3367734000-7f3367934000 ---p 001e7000 fc:02 <span class="token number">44721</span>                      /lib/x86_64-linux-gnu/libc-2.27.so
7f3367934000-7f3367938000 r--p 001e7000 fc:02 <span class="token number">44721</span>                      /lib/x86_64-linux-gnu/libc-2.27.so
7f3367938000-7f336793a000 rw-p 001eb000 fc:02 <span class="token number">44721</span>                      /lib/x86_64-linux-gnu/libc-2.27.so
7f336793a000-7f336793e000 rw-p 00000000 00:00 <span class="token number">0</span>
7f336793e000-7f3367967000 r-xp 00000000 fc:02 <span class="token number">44717</span>                      /lib/x86_64-linux-gnu/ld-2.27.so
7f3367b33000-7f3367b57000 rw-p 00000000 00:00 <span class="token number">0</span>
7f3367b67000-7f3367b68000 r--p 00029000 fc:02 <span class="token number">44717</span>                      /lib/x86_64-linux-gnu/ld-2.27.so
7f3367b68000-7f3367b69000 rw-p 0002a000 fc:02 <span class="token number">44717</span>                      /lib/x86_64-linux-gnu/ld-2.27.so
7f3367b69000-7f3367b6a000 rw-p 00000000 00:00 <span class="token number">0</span>
7fff4ad74000-7fff4ad95000 rw-p 00000000 00:00 <span class="token number">0</span>                          <span class="token punctuation">[</span>stack<span class="token punctuation">]</span>
7fff4adda000-7fff4addd000 r--p 00000000 00:00 <span class="token number">0</span>                          <span class="token punctuation">[</span>vvar<span class="token punctuation">]</span>
7fff4addd000-7fff4addf000 r-xp 00000000 00:00 <span class="token number">0</span>                          <span class="token punctuation">[</span>vdso<span class="token punctuation">]</span>
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 <span class="token number">0</span>                  <span class="token punctuation">[</span>vsyscall<span class="token punctuation">]</span>
</code></pre>
<p>&#x53EF;&#x4EE5;&#x7528;regex</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// mapsLine matches a single line from /proc/PID/maps.</span>
<span class="token keyword">var</span> mapsLine <span class="token operator">=</span> regexp<span class="token punctuation">.</span><span class="token function">MustCompile</span><span class="token punctuation">(</span><span class="token string">&quot;([0-9a-f]+)-([0-9a-f]+) ([r-][w-][x-][sp]) ([0-9a-f]+) [0-9a-f]{2,3}:[0-9a-f]{2,} [0-9]+\\s+(.*)&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">parseMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;/proc/self/maps&quot;</span><span class="token punctuation">)</span>
    r <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        b<span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">ReadBytes</span><span class="token punctuation">(</span><span class="token char">&apos;\n&apos;</span><span class="token punctuation">)</span>
        m <span class="token operator">:=</span> mapsLine<span class="token punctuation">.</span><span class="token function">FindSubmatch</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
        start<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseUint</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
        end<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseUint</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
        read <span class="token operator">:=</span> m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">&apos;r&apos;</span>
        write <span class="token operator">:=</span> m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">&apos;w&apos;</span>
        execute <span class="token operator">:=</span> m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">&apos;x&apos;</span>
        shared <span class="token operator">:=</span> m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">&apos;s&apos;</span>
        offset<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseUint</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="&#x9012;&#x5F52;&#x7F29;&#x8FDB;&#x6253;&#x5370;error"><a name="&#x9012;&#x5F52;&#x7F29;&#x8FDB;&#x6253;&#x5370;error" class="anchor-navigation-ex-anchor" href="#&#x9012;&#x5F52;&#x7F29;&#x8FDB;&#x6253;&#x5370;error"><i class="fa fa-link" aria-hidden="true"></i></a>17. &#x9012;&#x5F52;&#x7F29;&#x8FDB;&#x6253;&#x5370;error</h1>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> vmError <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    self     <span class="token builtin">error</span>
    children <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">error</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>vme vmError<span class="token punctuation">)</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> b strings<span class="token punctuation">.</span>Builder
    fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>b<span class="token punctuation">,</span> <span class="token string">&quot;----\n&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> vme<span class="token punctuation">.</span>self <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>b<span class="token punctuation">,</span> <span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> vme<span class="token punctuation">.</span>self<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token keyword">range</span> vme<span class="token punctuation">.</span>children <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> s <span class="token operator">:=</span> <span class="token keyword">range</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> s <span class="token operator">!=</span> <span class="token string">&quot;\tat -&quot;</span> <span class="token punctuation">{</span>
                fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>b<span class="token punctuation">,</span> <span class="token string">&quot;\t%s\n&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="&#x8BFB;go-micro"><a name="&#x8BFB;go-micro" class="anchor-navigation-ex-anchor" href="#&#x8BFB;go-micro"><i class="fa fa-link" aria-hidden="true"></i></a>18. &#x8BFB;go micro</h1>
<h2 id="cmd"><a name="cmd" class="anchor-navigation-ex-anchor" href="#cmd"><i class="fa fa-link" aria-hidden="true"></i></a>18.1. cmd</h2>
<p>micro&#x7684;&#x5165;&#x53E3;&#x547D;&#x4EE4;, &#x53EA;&#x8C03;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x51FD;&#x6570;
&#x8FD9;&#x91CC;import&#x4E2D;&#x7684;&#x7684;v2&#x9009;&#x62E9;&#x4E86;v2&#x7684;tag.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;github.com/micro/micro/v2/cmd&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cmd<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x8FD9;&#x91CC;&#x7684;Init&#x539F;&#x578B;&#x5F88;&#x7279;&#x522B;:
<code>cmd/cmd.go</code>&#x4E2D;, </p>
<pre class="language-"><code class="lang-go"><span class="token comment">// Init initialised the command line</span>
<span class="token keyword">func</span> <span class="token function">Init</span><span class="token punctuation">(</span>options <span class="token operator">...</span>micro<span class="token punctuation">.</span>Option<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Setup</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token operator">...</span><span class="token punctuation">)</span>

    cmd<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span>
        cmd<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
        cmd<span class="token punctuation">.</span><span class="token function">Description</span><span class="token punctuation">(</span>description<span class="token punctuation">)</span><span class="token punctuation">,</span>
        cmd<span class="token punctuation">.</span><span class="token function">Version</span><span class="token punctuation">(</span><span class="token function">buildVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x8FD9;&#x91CC;&#x9762;&#x7684;<code>Option</code>&#x662F;<code>type Option func(*Options)</code>, &#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7B7E;&#x540D;, &#x5165;&#x53C2;&#x662F;<code>*Options</code>
<code>Options</code>&#x662F;&#x4E2A;&#x5DE8;&#x5927;&#x7684;&#x7ED3;&#x6784;&#x4F53;, &#x5305;&#x542B;&#x4E86;&#x6240;&#x6709;&#x7684;micro&#x7684;&#x6982;&#x5FF5;.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> Options <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Auth      auth<span class="token punctuation">.</span>Auth
    Broker    broker<span class="token punctuation">.</span>Broker
    Cmd       cmd<span class="token punctuation">.</span>Cmd
    Config    config<span class="token punctuation">.</span>Config
    Client    client<span class="token punctuation">.</span>Client
    Server    server<span class="token punctuation">.</span>Server
    Store     store<span class="token punctuation">.</span>Store
    Registry  registry<span class="token punctuation">.</span>Registry
    Runtime   runtime<span class="token punctuation">.</span>Runtime
    Transport transport<span class="token punctuation">.</span>Transport
    Profile   profile<span class="token punctuation">.</span>Profile

    <span class="token comment">// Before and After funcs</span>
    BeforeStart <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
    BeforeStop  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
    AfterStart  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
    AfterStop   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>

    <span class="token comment">// Other options for implementations of the interface</span>
    <span class="token comment">// can be stored in a context</span>
    Context context<span class="token punctuation">.</span>Context

    Signal <span class="token builtin">bool</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img src="img/golang_&#x6742;&#x8BB0;3_20220902085229.png" alt="">  </p>
<h3 id="cmdapp"><a name="cmdapp" class="anchor-navigation-ex-anchor" href="#cmdapp"><i class="fa fa-link" aria-hidden="true"></i></a>18.1.1. cmd.APP()</h3>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>cli<span class="token punctuation">.</span>App <span class="token punctuation">{</span>
    <span class="token comment">//&#x8FD9;&#x91CC;&#x7684;DefaultCmd&#x662F;&#x4E2A;interface, &#x7531;newCmd&#x5B9E;&#x4F8B;&#x5316;</span>
    <span class="token comment">//&#x5373;var DefaultCmd = newCmd()</span>
    <span class="token keyword">return</span> DefaultCmd<span class="token punctuation">.</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> cmd <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    opts Options
    app  <span class="token operator">*</span>cli<span class="token punctuation">.</span>App
<span class="token punctuation">}</span>

<span class="token comment">//newCmd&#x8FD4;&#x56DE;&#x7684;&#x662F;Cmd&#x8FD9;&#x4E2A;interface</span>
<span class="token keyword">func</span> <span class="token function">newCmd</span><span class="token punctuation">(</span>opts <span class="token operator">...</span>Option<span class="token punctuation">)</span> Cmd <span class="token punctuation">{</span>
    <span class="token comment">//&#x5B9E;&#x9645;&#x7684;cmd&#x662F;&#x4E0A;&#x9762;&#x7684;&#x7ED3;&#x6784;&#x4F53;</span>
    cmd <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>
    cmd<span class="token punctuation">.</span>opts <span class="token operator">=</span> options
    cmd<span class="token punctuation">.</span>app <span class="token operator">=</span> cli<span class="token punctuation">.</span><span class="token function">NewApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//&#x8FD4;&#x56DE;cmd&#x5B9E;&#x4F8B;, &#x4F46;&#x4ECE;&#x5916;&#x9762;&#x770B;&#x8D77;&#x6765;&#x662F;Cmd interface</span>
    <span class="token keyword">return</span> cmd
<span class="token punctuation">}</span>

<span class="token comment">//&#x7EFC;&#x4E0A;, DefaultCmd.App()&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>cmd<span class="token punctuation">)</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>cli<span class="token punctuation">.</span>App <span class="token punctuation">{</span>
    <span class="token keyword">return</span> c<span class="token punctuation">.</span>app
<span class="token punctuation">}</span>
<span class="token comment">//&#x90A3;&#x4E48;c.app&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;cli.NewApp()&#x7684;&#x5B9E;&#x4F8B;&#x5316;&#x7ED3;&#x679C;.</span>
</code></pre>
<p>&#x4E0A;&#x9762;&#x7684;<code>cli.NewApp()</code>&#x5728;<a href="https://github.com/asim/cli" target="_blank"><code>github.com/micro/cli/v2</code></a>, &#x5B83;&#x5B9E;&#x9645;&#x4E0A;&#x662F;<code>urfave/cli</code>&#x7684;fork.</p>
<h3 id="&#x5DF2;&#x7ECF;&#x6CE8;&#x518C;&#x7684;cmd"><a name="&#x5DF2;&#x7ECF;&#x6CE8;&#x518C;&#x7684;cmd" class="anchor-navigation-ex-anchor" href="#&#x5DF2;&#x7ECF;&#x6CE8;&#x518C;&#x7684;cmd"><i class="fa fa-link" aria-hidden="true"></i></a>18.1.2. &#x5DF2;&#x7ECF;&#x6CE8;&#x518C;&#x7684;cmd</h3>
<p><code>cmd/cmd.go</code></p>
<pre class="language-"><code class="lang-go">    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> <span class="token builtin">new</span><span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> runtime<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> config<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> api<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> auth<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> bot<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> cli<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> broker<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> health<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> proxy<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> router<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> tunnel<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> network<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> registry<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> debug<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> server<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> service<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> build<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>Commands <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Commands<span class="token punctuation">,</span> web<span class="token punctuation">.</span><span class="token function">Commands</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="cli&#x76F8;&#x5173;&#x7684;cmd"><a name="cli&#x76F8;&#x5173;&#x7684;cmd" class="anchor-navigation-ex-anchor" href="#cli&#x76F8;&#x5173;&#x7684;cmd"><i class="fa fa-link" aria-hidden="true"></i></a>18.2. cli&#x76F8;&#x5173;&#x7684;cmd</h2>
<p>cli&#x9664;&#x4E86;&#x6CE8;&#x518C;&#x4E86;&#x81EA;&#x5DF1;&#x7684;cmd, &#x8FD8;&#x6CE8;&#x518C;&#x4E86;call stream publish&#x7B49;&#x547D;&#x4EE4;.
&#x800C;&#x4E14;<code>cli.Commands()&#x4E2D;</code>, cli&#x547D;&#x4EE4;&#x672C;&#x8EAB;&#x548C;&#x6240;&#x6709;&#x7684;&#x5B50;&#x547D;&#x4EE4;&#x90FD;&#x662F;&#x540C;&#x7EA7;&#x7684;. &#x53EA;&#x662F;cli&#x88AB;&#x5B89;&#x6392;&#x5728;&#x4E86;&#x7B2C;&#x4E00;&#x4E2A;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">Commands</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>cli<span class="token punctuation">.</span>Command <span class="token punctuation">{</span>
    commands <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>cli<span class="token punctuation">.</span>Command<span class="token punctuation">{</span>
        <span class="token punctuation">{</span>
            Name<span class="token punctuation">:</span>   <span class="token string">&quot;cli&quot;</span><span class="token punctuation">,</span>
            Usage<span class="token punctuation">:</span>  <span class="token string">&quot;Run the interactive CLI&quot;</span><span class="token punctuation">,</span>
            Action<span class="token punctuation">:</span> Run<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            Name<span class="token punctuation">:</span>   <span class="token string">&quot;call&quot;</span><span class="token punctuation">,</span>
            Usage<span class="token punctuation">:</span>  <span class="token string">&quot;Call a service e.g micro call greeter Say.Hello &apos;{\&quot;name\&quot;: \&quot;John\&quot;}&quot;</span><span class="token punctuation">,</span>
            <span class="token comment">//&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684;Print&#x662F;&#x4E2A;&#x95ED;&#x5305;&#x51FD;&#x6570;, &#x8FD4;&#x56DE;callService&#x7684;&#x5305;&#x88C5;. &#x7C7B;&#x4F3C;&#x88C5;&#x9970;&#x5668;</span>
            Action<span class="token punctuation">:</span> <span class="token function">Print</span><span class="token punctuation">(</span>callService<span class="token punctuation">)</span><span class="token punctuation">,</span>
            Flags<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>cli<span class="token punctuation">.</span>Flag<span class="token punctuation">{</span>
                <span class="token operator">&amp;</span>cli<span class="token punctuation">.</span>StringFlag<span class="token punctuation">{</span>
                    Name<span class="token punctuation">:</span>    <span class="token string">&quot;address&quot;</span><span class="token punctuation">,</span>
                    Usage<span class="token punctuation">:</span>   <span class="token string">&quot;Set the address of the service instance to call&quot;</span><span class="token punctuation">,</span>
                    EnvVars<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;MICRO_ADDRESS&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token operator">&amp;</span>cli<span class="token punctuation">.</span>StringFlag<span class="token punctuation">{</span>
                    Name<span class="token punctuation">:</span>    <span class="token string">&quot;output, o&quot;</span><span class="token punctuation">,</span>
                    Usage<span class="token punctuation">:</span>   <span class="token string">&quot;Set the output format; json (default), raw&quot;</span><span class="token punctuation">,</span>
                    EnvVars<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;MICRO_OUTPUT&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token operator">&amp;</span>cli<span class="token punctuation">.</span>StringSliceFlag<span class="token punctuation">{</span>
                    Name<span class="token punctuation">:</span>    <span class="token string">&quot;metadata&quot;</span><span class="token punctuation">,</span>
                    Usage<span class="token punctuation">:</span>   <span class="token string">&quot;A list of key-value pairs to be forwarded as metadata&quot;</span><span class="token punctuation">,</span>
                    EnvVars<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;MICRO_METADATA&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>cli&#x547D;&#x4EE4;&#x5BF9;&#x5E94;&#x7684;Action&#x662F;Run.
&#x8FD9;&#x4E2A;Run&#x662F;&#x4E2A;&#x5178;&#x578B;&#x7684;Read-Eval-Print-Loop, &#x57FA;&#x672C;&#x4E0A;&#x662F;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">for</span> <span class="token punctuation">{</span>
    <span class="token comment">//&#x5148;readline()</span>
    args<span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Readline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//&#x51C6;&#x5907;&#x53C2;&#x6570;</span>
    args <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">TrimSpace</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
    parts <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//&#x627E;&#x5230;cmd</span>
    cmd<span class="token punctuation">,</span> ok <span class="token operator">:=</span> commands<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
    <span class="token comment">//&#x6267;&#x884C;cmd</span>
    rsp<span class="token punctuation">,</span> err <span class="token operator">:=</span> cmd<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>rsp<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>micro&#x7684;&#x4EA4;&#x4E92;&#x5F0F;cli&#x5F88;&#x7B80;&#x5355;, &#x5C31;&#x662F;&#x5728;&#x9876;&#x5C42;&#x6709;&#x4E2A;&#x5FAA;&#x73AF;&#x6765;readline, &#x6267;&#x884C;cmd.
&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x529F;&#x80FD;.</p>
<h3 id="cli&#x5B50;&#x547D;&#x4EE4;"><a name="cli&#x5B50;&#x547D;&#x4EE4;" class="anchor-navigation-ex-anchor" href="#cli&#x5B50;&#x547D;&#x4EE4;"><i class="fa fa-link" aria-hidden="true"></i></a>18.2.1. cli&#x5B50;&#x547D;&#x4EE4;</h3>
<p>&#x8FD9;&#x4E9B;&#x5B50;&#x547D;&#x4EE4;, &#x6BD4;&#x5982;call, publish, &#x5B9E;&#x9645;&#x8C03;&#x7528;&#x7684;&#x662F;<code>internal/command/cli/command.go</code>&#x4E2D;&#x7684;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">CallService</span><span class="token punctuation">(</span>c <span class="token operator">*</span>cli<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> args <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    &#x53C2;&#x6570;&#x548C;&#x8FD4;&#x56DE;&#x503C;&#x90FD;&#x901A;&#x8FC7;json&#x683C;&#x5F0F;&#x7F16;&#x7801;
    d <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span>
    ctx <span class="token operator">:=</span> <span class="token function">callContext</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    creq <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span>cmd<span class="token punctuation">.</span><span class="token function">DefaultOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Client<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NewRequest</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> endpoint<span class="token punctuation">,</span> request<span class="token punctuation">,</span> client<span class="token punctuation">.</span><span class="token function">WithContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">//&#x5B9E;&#x9645;&#x8C03;&#x7528;&#x7684;&#x662F;client&#x7684;call&#x63A5;&#x53E3;, &#x8FD9;&#x662F;&#x4E2A;&#x540C;&#x6B65;&#x8C03;&#x7528;, &#x53D1;req, &#x7B49;rsp</span>
    err <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>cmd<span class="token punctuation">.</span><span class="token function">DefaultOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Client<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> creq<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rsp<span class="token punctuation">,</span> opts<span class="token operator">...</span><span class="token punctuation">)</span>
    <span class="token comment">//&#x7B49;&#x5F85;rsp&#x5E76;&#x6253;&#x5370;&#x7ED3;&#x679C;.</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="client&#x63A5;&#x53E3;"><a name="client&#x63A5;&#x53E3;" class="anchor-navigation-ex-anchor" href="#client&#x63A5;&#x53E3;"><i class="fa fa-link" aria-hidden="true"></i></a>18.2.2. client&#x63A5;&#x53E3;</h3>
<p>client&#x662F;micro&#x7684;&#x6838;&#x5FC3;&#x62BD;&#x8C61;, &#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;:</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// Client is the interface used to make requests to services.</span>
<span class="token comment">// It supports Request/Response via Transport and Publishing via the Broker.</span>
<span class="token comment">// It also supports bidirectional streaming of requests.</span>
<span class="token keyword">type</span> Client <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Init</span><span class="token punctuation">(</span><span class="token operator">...</span>Option<span class="token punctuation">)</span> <span class="token builtin">error</span>
    <span class="token function">Options</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Options
    <span class="token function">NewMessage</span><span class="token punctuation">(</span>topic <span class="token builtin">string</span><span class="token punctuation">,</span> msg <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> opts <span class="token operator">...</span>MessageOption<span class="token punctuation">)</span> Message
    <span class="token function">NewRequest</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> endpoint <span class="token builtin">string</span><span class="token punctuation">,</span> req <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> reqOpts <span class="token operator">...</span>RequestOption<span class="token punctuation">)</span> Request
    <span class="token function">Call</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req Request<span class="token punctuation">,</span> rsp <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> opts <span class="token operator">...</span>CallOption<span class="token punctuation">)</span> <span class="token builtin">error</span>
    <span class="token function">Stream</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req Request<span class="token punctuation">,</span> opts <span class="token operator">...</span>CallOption<span class="token punctuation">)</span> <span class="token punctuation">(</span>Stream<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
    <span class="token function">Publish</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> msg Message<span class="token punctuation">,</span> opts <span class="token operator">...</span>PublishOption<span class="token punctuation">)</span> <span class="token builtin">error</span>
    <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre>
<p>client&#x652F;&#x6301;Req/Rsp(&#x901A;&#x8FC7;Transport&#x62BD;&#x8C61;), &#x652F;&#x6301;Pub/Sub(&#x901A;&#x8FC7;Broker)&#x62BD;&#x8C61;, &#x8FD8;&#x652F;&#x6301;stream&#x6A21;&#x5F0F;.</p>
<h1 id="pattern-match"><a name="pattern-match" class="anchor-navigation-ex-anchor" href="#pattern-match"><i class="fa fa-link" aria-hidden="true"></i></a>19. pattern match</h1>
<p>&#x7B80;&#x5355;&#x7684;<code>*</code>&#x901A;&#x914D;&#x7B26;&#x5339;&#x914D;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">patternMatchs</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> pattern <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    strs <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//fmt.Println(strs, len(strs))</span>
    <span class="token keyword">var</span> pos<span class="token punctuation">,</span> index <span class="token builtin">int</span>
    <span class="token keyword">if</span> index <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> strs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> index <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    end <span class="token operator">:=</span> strs<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> index <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">LastIndex</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span> index<span class="token operator">+</span><span class="token function">len</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">len</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> substr <span class="token operator">:=</span> <span class="token keyword">range</span> strs <span class="token punctuation">{</span>
        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> i <span class="token operator">==</span> <span class="token function">len</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> <span class="token function">len</span><span class="token punctuation">(</span>substr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            <span class="token keyword">continue</span>
        <span class="token punctuation">}</span>
        index <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span>pos<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> substr<span class="token punctuation">)</span>
        <span class="token keyword">if</span> index <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
        pos <span class="token operator">+=</span> index <span class="token operator">+</span> <span class="token function">len</span><span class="token punctuation">(</span>substr<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="&#x8BFB;fslinuxgo"><a name="&#x8BFB;fslinuxgo" class="anchor-navigation-ex-anchor" href="#&#x8BFB;fslinuxgo"><i class="fa fa-link" aria-hidden="true"></i></a>20. &#x8BFB;fs_linux.go</h1>
<p><code>periph.io/x/periph@v3.6.2+incompatible/host/sysfs/fs_linux.go</code></p>
<h1 id="&#x5584;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x5E93;&#x51FD;&#x6570;--stringsjoin"><a name="&#x5584;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x5E93;&#x51FD;&#x6570;--stringsjoin" class="anchor-navigation-ex-anchor" href="#&#x5584;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x5E93;&#x51FD;&#x6570;--stringsjoin"><i class="fa fa-link" aria-hidden="true"></i></a>21. &#x5584;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x5E93;&#x51FD;&#x6570;--strings.Join</h1>
<p>&#x6BD4;&#x5982;&#x89E3;&#x6790;&#x6216;<code>|</code>&#x5173;&#x7CFB;, &#x666E;&#x901A;&#x7684;&#x601D;&#x8DEF;&#x662F;&#x81EA;&#x5DF1;&#x7EC4;&#x7C7B;&#x4F3C;<code>flag1|flag2|flag3</code>&#x7684;&#x5B57;&#x7B26;&#x4E32;.
&#x5B9E;&#x9645;&#x4E0A;, &#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x5148;&#x628A;<code>flag1 flag2 flag3</code>&#x5206;&#x522B;append&#x5230;<code>[]string</code>&#x5207;&#x7247;, &#x6700;&#x540E;&#x7528;<code>strings.Join(out, &quot;|&quot;)</code>&#x52A0;&#x6216;<code>|</code>&#x64CD;&#x4F5C;&#x7B26;.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>e epollEvent<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> out <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> b <span class="token operator">:=</span> <span class="token keyword">range</span> bitmaskString <span class="token punctuation">{</span>
        <span class="token keyword">if</span> e<span class="token operator">&amp;</span>b<span class="token punctuation">.</span>e <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            out <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> b<span class="token punctuation">.</span>s<span class="token punctuation">)</span>
            e <span class="token operator">&amp;^=</span> b<span class="token punctuation">.</span>e
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> e <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        out <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token string">&quot;0x&quot;</span><span class="token operator">+</span>strconv<span class="token punctuation">.</span><span class="token function">FormatUint</span><span class="token punctuation">(</span><span class="token function">uint64</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        out <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token string">&quot;|&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="&#x5207;&#x7247;&#x7684;&#x63D2;&#x5165;"><a name="&#x5207;&#x7247;&#x7684;&#x63D2;&#x5165;" class="anchor-navigation-ex-anchor" href="#&#x5207;&#x7247;&#x7684;&#x63D2;&#x5165;"><i class="fa fa-link" aria-hidden="true"></i></a>22. &#x5207;&#x7247;&#x7684;&#x63D2;&#x5165;</h1>
<p>&#x8FD9;&#x4E2A;&#x5207;&#x7247;&#x662F;&#x4E2A;&#x4E8C;&#x53C9;&#x6811;&#x7684;&#x987A;&#x5E8F;&#x8868;&#x7684;&#x8868;&#x8FBE;, &#x548C;sort&#x5305;&#x7684;&#x601D;&#x8DEF;&#x4E00;&#x81F4;.
&#x5148;&#x627E;&#x5230;<code>r.Name</code>&#x7684;&#x4F4D;&#x7F6E;<code>i</code>, &#x7136;&#x540E;&#x7528;<code>append</code>&#x4E00;&#x4E2A;<code>nil</code>&#x7684;&#x65B9;&#x5F0F;&#x628A;&#x5207;&#x7247;&#x6269;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;&#x51FA;&#x6765;, &#x7136;&#x540E;&#x7528;&#x5185;&#x7F6E;&#x7684;<code>copy</code>&#x51FD;&#x6570;&#x628A;<code>i</code>&#x540E;&#x9762;&#x7684;&#x5143;&#x7D20;&#x5F80;&#x540E;&#x90FD;&#x632A;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;; &#x6700;&#x540E;&#x628A;&#x4F4D;&#x7F6E;<code>i</code>&#x7684;&#x5143;&#x7D20;&#x586B;&#x4E0A;.</p>
<p>&#x4E3A;&#x4E86;&#x628A;&#x4F4D;&#x7F6E;<code>i</code>&#x540E;&#x9762;&#x7684;&#x5143;&#x7D20;&#x90FD;&#x632A;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;, &#x4EE3;&#x4EF7;&#x662F;&#x628A;&#x8FD9;&#x540E;&#x9762;&#x7684;&#x6240;&#x6709;&#x5143;&#x7D20;&#x90FD;copy&#x4E00;&#x904D;
&#x8FD9;&#x91CC;&#x7684;copy&#x5B9E;&#x9645;&#x4E0A;&#x662F;overlap&#x7684;, copy&#x7684;&#x65F6;&#x5019;, &#x6E90;&#x4E3A;<code>l[i:]</code>, &#x76EE;&#x7684;&#x662F;<code>l[i+1:]</code>, &#x76EE;&#x7684;&#x6BD4;&#x6E90;&#x5411;&#x540E;&#x79FB;&#x52A8;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;, &#x800C;&#x4E14;&#x76EE;&#x7684;&#x7684;&#x5143;&#x7D20;&#x4E2A;&#x6570;&#x4E5F;&#x5C11;&#x4E86;&#x4E00;&#x4E2A;.
&#x6CE8;&#x610F;, &#x5982;&#x679C;&#x6309;&#x7167;&#x666E;&#x901A;&#x7684;for&#x5FAA;&#x73AF;&#x5F0F;&#x7684;copy&#x601D;&#x8DEF;, src&#x548C;dst&#x91CD;&#x53E0;&#x65F6;&#x4E0D;&#x80FD;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x7684;.
&#x6709;&#x4EBA;&#x8BA8;&#x8BBA;&#x8BF4;<a href="https://github.com/golang/go/issues/4142" target="_blank">golang&#x7684;copy&#x8BED;&#x4E49;&#x7C7B;&#x4F3C;memmove</a></p>
<ul>
<li>memcpy: &#x5F53;src&#x548C;dst&#x91CD;&#x53E0;&#x65F6;, &#x7ED3;&#x679C;&#x4E0D;&#x786E;&#x5B9A;</li>
<li>memmove: src&#x548C;dst&#x53EF;&#x4EE5;&#x91CD;&#x53E0;, &#x7ED3;&#x679C;&#x662F;&#x6B63;&#x786E;&#x7684;&#x62F7;&#x8D1D;; &#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x6210;&#x6709;&#x4E2A;&#x4E34;&#x65F6;&#x7F13;&#x51B2;&#x505A;&#x4E2D;&#x8F6C;. &#x5B9E;&#x9645;&#x4E0A;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x4E2D;&#x95F4;buffer, <a href="https://vgable.com/blog/2008/05/24/memcopy-memmove-and-speed-over-safety/#:~:text=The%20difference%20between%20memcpy%20and,It%20might%20work.&amp;text=memcpy%20can%20be%20faster%2C%20and%20usually%20is." target="_blank">&#x53EA;&#x9700;&#x8981;&#x5728;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#x5224;&#x65AD;&#x662F;&#x4ECE;&#x524D;&#x5F80;&#x540E;&#x62F7;&#x8D1D;&#x8FD8;&#x662F;&#x4ECE;&#x540E;&#x5F80;&#x524D;&#x62F7;&#x8D1D;&#x5C31;&#x884C;&#x4E86;.</a></li>
<li>&#x7ED3;&#x8BBA;: golang&#x7684;copy&#x652F;&#x6301;overlap, &#x53EF;&#x4EE5;&#x6B63;&#x786E;&#x7684;&#x62F7;&#x8D1D;</li>
</ul>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">insertRef</span><span class="token punctuation">(</span>l <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Ref<span class="token punctuation">,</span> r <span class="token operator">*</span>Ref<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Ref <span class="token punctuation">{</span>
    n <span class="token operator">:=</span> r<span class="token punctuation">.</span>Name
    i <span class="token operator">:=</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> l<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Name <span class="token operator">&gt;</span> n <span class="token punctuation">}</span><span class="token punctuation">)</span>
    l <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
    <span class="token function">copy</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> l<span class="token punctuation">[</span>i<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    l<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> r
    <span class="token keyword">return</span> l
<span class="token punctuation">}</span>
</code></pre>
<p>&#x4E0B;&#x9762;&#x662F;&#x5BF9;&#x5E94;&#x7684;&#x5FEB;&#x6392;
&#x6CE8;&#x610F;&#x5728;search&#x51FD;&#x6570;&#x91CC;, &#x5E76;&#x4E0D;&#x9700;&#x8981;&#x4F20;&#x5165;&#x8981;&#x67E5;&#x627E;&#x7684;&#x5207;&#x7247;; search&#x8C03;&#x7528;f&#x7684;&#x65F6;&#x5019;, <code>f</code>&#x4F1A;&#x6BD4;&#x8F83;&#x5207;&#x7247;&#x5143;&#x7D20;, f&#x4F1A;&#x8BBF;&#x95EE;&#x5207;&#x7247;.
&#x5728;&#x672C;&#x4F8B;&#x4E2D;, <code>f</code>&#x80FD;&#x8BBF;&#x95EE;insertRef&#x51FD;&#x6570;&#x7684;<code>l []*Ref</code>&#x53D8;&#x91CF;, &#x8FD9;&#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x95ED;&#x5305;&#x5F62;&#x5F0F;?</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// search implements the same algorithm as sort.Search().</span>
<span class="token comment">//</span>
<span class="token comment">// It was extracted to to not depend on sort, which depends on reflect.</span>
<span class="token keyword">func</span> <span class="token function">search</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> f <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
    lo <span class="token operator">:=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> hi <span class="token operator">:=</span> n<span class="token punctuation">;</span> lo <span class="token operator">&lt;</span> hi<span class="token punctuation">;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> i <span class="token operator">:=</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token function">uint</span><span class="token punctuation">(</span>lo<span class="token operator">+</span>hi<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">!</span><span class="token function">f</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lo <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            hi <span class="token operator">=</span> i
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> lo
<span class="token punctuation">}</span>
</code></pre>
<h1 id="&#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;"><a name="&#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;" class="anchor-navigation-ex-anchor" href="#&#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;"><i class="fa fa-link" aria-hidden="true"></i></a>23. &#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;</h1>
<p>&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;, &#x533F;&#x540D;&#x884C;&#x6570;&#x5728;&#x5B9A;&#x4E49;&#x540E;&#x5C31;&#x6267;&#x884C;, &#x5C31;&#x50CF;&#x666E;&#x901A;&#x7684;&#x4EE3;&#x7801;&#x5757;&#x6267;&#x884C;&#x4E00;&#x6837;: &#x53D8;&#x91CF;<code>r</code>&#x548C;<code>err</code>&#x90FD;&#x80FD;&#x76F4;&#x63A5;&#x88AB;&#x533F;&#x540D;&#x51FD;&#x6570;&#x5F15;&#x7528;&#x5230;.
&#x90A3;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x7528;<code>func(){}()</code>&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x5462;? 
&#x9996;&#x5148;, &#x533F;&#x540D;&#x51FD;&#x6570;&#x4E5F;&#x662F;&#x8981;&#x51FD;&#x6570;&#x6808;&#x7684;, &#x591A;&#x4E86;&#x533F;&#x540D;&#x51FD;&#x6570;&#x6027;&#x80FD;&#x4E0A;&#x4E0D;&#x4F1A;&#x66F4;&#x597D;;
&#x4F46;&#x662F;, &#x56E0;&#x4E3A;&#x904D;&#x5386;&#x5168;&#x5C40;&#x7684;map <code>byName</code> <code>byNumber</code> &#x6709;&#x9501;&#x64CD;&#x4F5C;, &#x90A3;&#x4E48;&#x4F7F;&#x7528;&#x533F;&#x540D;&#x51FD;&#x6570;&#x914D;&#x5408;defer&#x5173;&#x952E;&#x8BCD;&#x6765;&#x52A0;&#x9501;&#x548C;&#x89E3;&#x9501;, &#x4EE3;&#x7801;&#x66F4;&#x4F18;&#x96C5;.
&#x5982;&#x679C;&#x4E0D;&#x8981;&#x8FD9;&#x4E2A;&#x533F;&#x540D;&#x7684;&#x58F3;&#x5B50;, &#x8981;&#x4E48;&#x4E0D;&#x7528;defer, &#x81EA;&#x5DF1;&#x627E;&#x5730;&#x65B9;&#x52A0;<code>unlock</code>; &#x8FD8;&#x60F3;&#x7528;defer&#x7684;&#x8BDD;, defer&#x4F1A;&#x5728;<code>r.Open()</code>&#x540E;&#x6267;&#x884C;. 
&#x4F30;&#x8BA1;&#x8FD9;&#x91CC;&#x7684;&#x903B;&#x8F91;&#x662F;: &#x4E00;&#x5B9A;&#x8981;&#x5728;<code>r.Open()</code>&#x524D;<code>unlock</code></p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">Open</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>i2c<span class="token punctuation">.</span>BusCloser<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> r <span class="token operator">*</span>Ref
    <span class="token keyword">var</span> err <span class="token builtin">error</span>
    <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">defer</span> mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>byName<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            err <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;i2creg: no bus found; did you forget to call Init()?&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            r <span class="token operator">=</span> <span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Try by name, by alias, by number.</span>
        <span class="token keyword">if</span> r <span class="token operator">=</span> byName<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span> r <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> r <span class="token operator">=</span> byAlias<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span> r <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> i<span class="token punctuation">,</span> err2 <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> err2 <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                    r <span class="token operator">=</span> byNumber<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> r <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;i2creg: can&apos;t open unknown bus: &quot;</span> <span class="token operator">+</span> strconv<span class="token punctuation">.</span><span class="token function">Quote</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> r<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="golang_杂记2.html" class="navigation navigation-prev " aria-label="Previous page: Golang 杂记2">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="golang_lib选型.html" class="navigation navigation-next " aria-label="Next page: Golang lib选型">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Golang 杂记3","level":"1.10.9.3","depth":3,"next":{"title":"Golang lib选型","level":"1.10.9.4","depth":3,"path":"notes/golang_lib选型.md","ref":"notes/golang_lib选型.md","articles":[]},"previous":{"title":"Golang 杂记2","level":"1.10.9.2","depth":3,"path":"notes/golang_杂记2.md","ref":"notes/golang_杂记2.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-livereload","-sharing","-lunr","-search","search-plus","-highlight","theme-comscore","prism","code","chapter-fold","github","splitter","wide-page","hide-navigation-buttons","anchor-navigation-ex","sequence@0.1.1","mermaid-gb3"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"chapter-fold":{},"prism":{"css":["prismjs/themes/prism.css"],"ignore":["mermaid","sequence"]},"sequence":{"theme":"simple"},"github":{"url":"https://github.com/Bai-Yingjie/Bai-Yingjie.github.io"},"splitter":{},"wide-page":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"hide-navigation-buttons":{},"mermaid-gb3":{},"anchor-navigation-ex":{"mode":"float","pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"isRewritePageTitle":true,"showLevel":true,"tocLevel1Icon":"fa fa-hand-o-right","tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right","showGoTop":true,"isShowTocTitleIcon":true,"printLog":false,"multipleH1":true,"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false}},"theme-comscore":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"search-plus":{}},"theme":"default","author":"Bai Yingjie","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"My Notes","language":"zh-hans","gitbook":"*"},"file":{"path":"notes/golang_杂记3.md","mtime":"2024-05-07T02:12:58.703Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-05-07T02:13:53.958Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-mermaid-gb3/book/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    <script src="../gitbook/gitbook-plugin-mermaid-gb3/mermaid/mermaid.min.js"></script>

    </body>
</html>

