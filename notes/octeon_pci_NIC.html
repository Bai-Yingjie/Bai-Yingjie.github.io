
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>octeon PCI NIC · My Notes</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Bai Yingjie">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-coldark-cold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-wide-page/wide.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hide-navigation-buttons/index.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="as_title.html" />
    
    
    <link rel="prev" href="as_title.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    CPU和device虚拟化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    gvisor
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="golang_gvisor代码_KVM.html">
            
                <a href="golang_gvisor代码_KVM.html">
            
                    
                    gvisor KVM模式代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="golang_gvisor调试.html">
            
                <a href="golang_gvisor调试.html">
            
                    
                    gvisor调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="golang_gvisor_ptrace.html">
            
                <a href="golang_gvisor_ptrace.html">
            
                    
                    gvisor ptrace模式介绍(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="rust_vmm_brief.html">
            
                <a href="rust_vmm_brief.html">
            
                    
                    rust VMM(virtual machine monitor)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="rust_vmm_简介.html">
            
                <a href="rust_vmm_简介.html">
            
                    
                    rust-vmm简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="rust_firecracker_代码.html">
            
                <a href="rust_firecracker_代码.html">
            
                    
                    firecracker代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="rust_firecracker_使用.html">
            
                <a href="rust_firecracker_使用.html">
            
                    
                    firecracker使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="rust_cloud-hypervisor_代码.html">
            
                <a href="rust_cloud-hypervisor_代码.html">
            
                    
                    cloud hypervisor代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="rust_cloud-hypervisor_使用.html">
            
                <a href="rust_cloud-hypervisor_使用.html">
            
                    
                    cloud hypervisor使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="rust_cloud-hypervisor_问题与解决.html">
            
                <a href="rust_cloud-hypervisor_问题与解决.html">
            
                    
                    cloud hypervisor问题与解决
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="qemu使用.html">
            
                <a href="qemu使用.html">
            
                    
                    Qemu使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    虚拟化网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="networking_virtualization_杂记.html">
            
                <a href="networking_virtualization_杂记.html">
            
                    
                    虚拟化网络杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="networking_linux虚拟网络接口.html">
            
                <a href="networking_linux虚拟网络接口.html">
            
                    
                    linux虚拟网络接口(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    开源
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="my_opensource.html">
            
                <a href="my_opensource.html">
            
                    
                    我的开源项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="my_upstream.html">
            
                <a href="my_upstream.html">
            
                    
                    我的upstream commit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Golang
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    入门
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="golang_语法基础.html">
            
                <a href="golang_语法基础.html">
            
                    
                    语法基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="golang_json性能.html">
            
                <a href="golang_json性能.html">
            
                    
                    json性能比较
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="golang_原理.html">
            
                <a href="golang_原理.html">
            
                    
                    原理相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="golang_interface原理.html">
            
                <a href="golang_interface原理.html">
            
                    
                    interface原理(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="golang_内存分配.html">
            
                <a href="golang_内存分配.html">
            
                    
                    内存分配(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="golang_标准库.html">
            
                <a href="golang_标准库.html">
            
                    
                    标准库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="golang_我的反射代码.html">
            
                <a href="golang_我的反射代码.html">
            
                    
                    我的反射代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="golang_问答.html">
            
                <a href="golang_问答.html">
            
                    
                    问答
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="golang_高效go.html">
            
                <a href="golang_高效go.html">
            
                    
                    高效go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="golang_进阶.html">
            
                <a href="golang_进阶.html">
            
                    
                    进阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    杂记
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.8.1" data-path="golang_杂记1.html">
            
                <a href="golang_杂记1.html">
            
                    
                    杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.2" data-path="golang_杂记2.html">
            
                <a href="golang_杂记2.html">
            
                    
                    杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.3" data-path="golang_杂记3.html">
            
                <a href="golang_杂记3.html">
            
                    
                    杂记3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.4" data-path="golang_lib选型.html">
            
                <a href="golang_lib选型.html">
            
                    
                    lib选型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.5" data-path="golang_mod_proxy.html">
            
                <a href="golang_mod_proxy.html">
            
                    
                    go mod和go proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.6" data-path="golang_汇编_arm64.html">
            
                <a href="golang_汇编_arm64.html">
            
                    
                    汇编语法和arm64小知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.7" data-path="golang_cgo_swig.html">
            
                <a href="golang_cgo_swig.html">
            
                    
                    go调用c可以用swig
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    环境和工具链生成
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.9.1" data-path="golang_toolchain_ppc.html">
            
                <a href="golang_toolchain_ppc.html">
            
                    
                    go tools增加ppc32支持.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9.2" data-path="golang_toolchain_compile_gccgo.html">
            
                <a href="golang_toolchain_compile_gccgo.html">
            
                    
                    编译gccgo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9.3" data-path="golang_go_on_mips.html">
            
                <a href="golang_go_on_mips.html">
            
                    
                    go on mips boards(not so updated)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.9.3.1" data-path="golang_go_on_mips_part1.html">
            
                <a href="golang_go_on_mips_part1.html">
            
                    
                    part 1: cross compile go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9.3.2" data-path="golang_go_on_mips_part2.html">
            
                <a href="golang_go_on_mips_part2.html">
            
                    
                    part 2: build native go compiler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9.3.3" data-path="golang_go_on_mips_part3.html">
            
                <a href="golang_go_on_mips_part3.html">
            
                    
                    part 3: gccgo experiments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9.3.4" data-path="golang_go_on_mips_part4.html">
            
                <a href="golang_go_on_mips_part4.html">
            
                    
                    part 4: json performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9.3.5" data-path="golang_gentoo_on_mips_board_and_build_go.html">
            
                <a href="golang_gentoo_on_mips_board_and_build_go.html">
            
                    
                    Gentoo on mips board and build go
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    微服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.10.1" data-path="golang_micro.html">
            
                <a href="golang_micro.html">
            
                    
                    go-micro和micro
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10.2" data-path="golang_微服务概念.html">
            
                <a href="golang_微服务概念.html">
            
                    
                    微服务概念
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    解释器和编解码
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.11.1" data-path="golang_yeagi.html">
            
                <a href="golang_yeagi.html">
            
                    
                    解释器yeagi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11.2" data-path="golang_tengo.html">
            
                <a href="golang_tengo.html">
            
                    
                    解释器tengo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11.3" data-path="golang_govaluate.html">
            
                <a href="golang_govaluate.html">
            
                    
                    解释器govaluate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11.4" data-path="golang_encoding_gotiny.html">
            
                <a href="golang_encoding_gotiny.html">
            
                    
                    gotiny编解码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11.5" data-path="golang_abs.html">
            
                <a href="golang_abs.html">
            
                    
                    解释器abs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.12" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    调试和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.12.1" data-path="golang_调试记录.html">
            
                <a href="golang_调试记录.html">
            
                    
                    调试记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.12.2" data-path="golang_topid性能优化.html">
            
                <a href="golang_topid性能优化.html">
            
                    
                    topid性能优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.12.3" data-path="golang_gshell性能调试.html">
            
                <a href="golang_gshell性能调试.html">
            
                    
                    gshell性能调试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.13" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    网络和消息中间件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.13.1" data-path="golang_zmq.html">
            
                <a href="golang_zmq.html">
            
                    
                    消息中间件基本概念和zero mq
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.2" data-path="golang_mango.html">
            
                <a href="golang_mango.html">
            
                    
                    消息中间件mango
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.3" data-path="golang_libp2p.html">
            
                <a href="golang_libp2p.html">
            
                    
                    p2p网络
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Rust
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="rust_入门_brief.html">
            
                <a href="rust_入门_brief.html">
            
                    
                    入门系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="rust_books.html">
            
                <a href="rust_books.html">
            
                    
                    reference books
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.2" data-path="rust_入门1.html">
            
                <a href="rust_入门1.html">
            
                    
                    安装和基础语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.3" data-path="rust_入门2.html">
            
                <a href="rust_入门2.html">
            
                    
                    泛型和内存所有权
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.4" data-path="rust_入门3.html">
            
                <a href="rust_入门3.html">
            
                    
                    闭包 容器 迭代器 生成器 线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.5" data-path="rust_工程构建.html">
            
                <a href="rust_工程构建.html">
            
                    
                    工程构建
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="rust_coding_brief.html">
            
                <a href="rust_coding_brief.html">
            
                    
                    代码积累
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="rust_序列化.html">
            
                <a href="rust_序列化.html">
            
                    
                    序列化原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.2" data-path="rust_知识点积累.html">
            
                <a href="rust_知识点积累.html">
            
                    
                    知识点更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.3" data-path="rust_adaptiveservice.html">
            
                <a href="rust_adaptiveservice.html">
            
                    
                    rust版本的adaptiveservice探索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.4" data-path="rust_常用设施.html">
            
                <a href="rust_常用设施.html">
            
                    
                    常用设施
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.5" data-path="rust_代码小段.html">
            
                <a href="rust_代码小段.html">
            
                    
                    代码小段
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="others.html">
            
                <a href="others.html">
            
                    
                    其他
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.3.1" data-path="rust_mdbook_使用.html">
            
                <a href="rust_mdbook_使用.html">
            
                    
                    使用mdbook
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    ARM server
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="arm_server_杂记.html">
            
                <a href="arm_server_杂记.html">
            
                    
                    杂记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    脚本
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="shell_变量.html">
            
                <a href="shell_变量.html">
            
                    
                    shell变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="shell_基础篇.html">
            
                <a href="shell_基础篇.html">
            
                    
                    shell命令和脚本记录-基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="shell_高级篇.html">
            
                <a href="shell_高级篇.html">
            
                    
                    shell命令和脚本记录-高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="shell_脚本片段.html">
            
                <a href="shell_脚本片段.html">
            
                    
                    shell脚本片段
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="python_记录.html">
            
                <a href="python_记录.html">
            
                    
                    python记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="lua_记录.html">
            
                <a href="lua_记录.html">
            
                    
                    lua记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="shell_rds脚本阅读.html">
            
                <a href="shell_rds脚本阅读.html">
            
                    
                    RDS脚本阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.8" data-path="Project_Euler.html">
            
                <a href="Project_Euler.html">
            
                    
                    Project Euler
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    CPU Arch相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    PPC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                <a href="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                    
                    PPC启动多核linux: 流程和内存映射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.2" data-path="CPU_PPC_kernel升级记录.html">
            
                <a href="CPU_PPC_kernel升级记录.html">
            
                    
                    PPC kernel升级记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    MIPS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.2.1" data-path="CPU_MIPS_octeon操作记录.html">
            
                <a href="CPU_MIPS_octeon操作记录.html">
            
                    
                    octeon操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    设备和驱动相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="device_driver_杂记.html">
            
                <a href="device_driver_杂记.html">
            
                    
                    驱动杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="device_driver_nand概率写失败问题分析.html">
            
                <a href="device_driver_nand概率写失败问题分析.html">
            
                    
                    Nand flash概率写失败问题分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="octeon_remote_pci.html">
            
                <a href="octeon_remote_pci.html">
            
                    
                    octeon remote-pci.c阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    智能网卡和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.10.4.1" data-path="octeon_pci_NIC.html">
            
                <a href="octeon_pci_NIC.html">
            
                    
                    octeon PCI NIC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.2" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    octeon liquidIO
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.4.2.1" data-path="smartNIC_liquidIO_代码阅读app篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读app篇.html">
            
                    
                    PCI-NIC 代码阅读 --app篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.2.2" data-path="smartNIC_liquidIO_代码阅读api篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读api篇.html">
            
                    
                    PCI-NIC 代码阅读 --api篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.2.3" data-path="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇之结构体
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.2.4" data-path="smartNIC_liquidIO_代码阅读driver篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.2.5" data-path="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                    
                    PCI-NIC 代码阅读 --真NIC篇
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.4.3" data-path="networking_dpdk使用_2014.html">
            
                <a href="networking_dpdk使用_2014.html">
            
                    
                    DPDK使用(2014)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Linux 开发调试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Operating System
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1.1" data-path="system_libc_part1.html">
            
                <a href="system_libc_part1.html">
            
                    
                    libc概览1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.2" data-path="system_libc_part2.html">
            
                <a href="system_libc_part2.html">
            
                    
                    libc概览2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.3" data-path="system_libc_part3.html">
            
                <a href="system_libc_part3.html">
            
                    
                    libc概览3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.4" data-path="system_原理杂记.html">
            
                <a href="system_原理杂记.html">
            
                    
                    原理杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.5" data-path="system_alpine.html">
            
                <a href="system_alpine.html">
            
                    
                    Alpine Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.6" data-path="system_进程间通信.html">
            
                <a href="system_进程间通信.html">
            
                    
                    进程间通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.7" data-path="system_特殊功能fd.html">
            
                <a href="system_特殊功能fd.html">
            
                    
                    eventfd timerfd signalfd和fd共享
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    嵌入式系统开发调试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.2.1" data-path="embedded_debugging.html">
            
                <a href="embedded_debugging.html">
            
                    
                    调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.2" data-path="uboot_杂记.html">
            
                <a href="uboot_杂记.html">
            
                    
                    uboot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.3" data-path="buildroot_杂记.html">
            
                <a href="buildroot_杂记.html">
            
                    
                    buildroot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.4" data-path="toolchain_升级gcc问题解决.html">
            
                <a href="toolchain_升级gcc问题解决.html">
            
                    
                    升级GCC7.3问题解决
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    工程实践
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="gitlab_ci.html">
            
                <a href="gitlab_ci.html">
            
                    
                    gitlab CI
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >octeon PCI NIC</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#pci-nic&#x652F;&#x6301;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;"><b>1. </b>pci NIC&#x652F;&#x6301;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;</a></li><li><span class="title-icon "></span><a href="#pem"><b>2. </b>PEM</a></li><ul><li><span class="title-icon "></span><a href="#in-ep-mode"><b>2.1. </b>in EP mode</a></li><li><span class="title-icon "></span><a href="#37-------------------------2221---------------------------0"><b>2.2. </b>37                         22|21                           0</a></li><li><span class="title-icon "></span><a href="#pem0bar1indexnaddridx--entryofffrom-bar1-address-"><b>2.3. </b>+ PEM0_BAR1_INDEXn[ADDR_IDX] | EntryOff(from BAR1 address) +</a></li><li><span class="title-icon "></span><a href="#19--------------------------4-3--2-----1---0"><b>2.4. </b>19                          4 3  2     1   0</a></li><li><span class="title-icon "></span><a href="#-------addridx------------caendswpaddrv"><b>2.5. </b>+        ADDR_IDX            |CA|END_SWP|ADDR_V+</a></li><li><span class="title-icon "></span><a href="#test"><b>2.6. </b>test</a></li></ul></ul></div><a href="#pci-nic&#x652F;&#x6301;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><ul>
<li><a href="#pci-nic&#x652F;&#x6301;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;">pci NIC&#x652F;&#x6301;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;</a></li>
<li><a href="#pem">PEM</a><ul>
<li><a href="#in-ep-mode">in EP mode</a></li>
<li><a href="#in-rc-mode">in RC mode</a></li>
</ul>
</li>
<li><a href="#dpi--sli">DPI &amp; SLI</a></li>
<li><a href="#dpi&#x4EE5;&#x4E0B;&#x4EE5;61xx&#x4E3A;&#x4F8B;">DPI(&#x4EE5;&#x4E0B;&#x4EE5;61xx&#x4E3A;&#x4F8B;)</a><ul>
<li><a href="#input">input</a></li>
<li><a href="#output">output</a></li>
<li><a href="#dpi-dma">DPI DMA</a></li>
<li><a href="#dma&#x7684;&#x547D;&#x4EE4;&#x5B57;">DMA&#x7684;&#x547D;&#x4EE4;&#x5B57;</a></li>
<li><a href="#dma&#x7684;&#x547D;&#x4EE4;queue">DMA&#x7684;&#x547D;&#x4EE4;queue</a></li>
<li><a href="#dma-engine-05">DMA engine 0..5</a></li>
</ul>
</li>
<li><a href="#pci-base">PCI-BASE</a><ul>
<li><a href="#packages">packages</a></li>
<li><a href="#overview">overview</a></li>
<li><a href="#input-rings">input rings</a></li>
<li><a href="#output-rings">output rings</a></li>
<li><a href="#dma">dma</a></li>
<li><a href="#dir-tree">dir tree</a></li>
<li><a href="#host-driver">host driver</a><ul>
<li><a href="#device-configuration">device configuration</a></li>
<li><a href="#input-ring-initialization">input ring initialization</a></li>
<li><a href="#output-ring-initialization">output ring initialization</a></li>
<li><a href="#dma-initialization">dma initialization</a></li>
<li><a href="#other-initialization">other initialization</a></li>
<li><a href="#linux-ko">linux ko</a></li>
</ul>
</li>
<li><a href="#input-ring-processing">input ring processing</a><ul>
<li><a href="#&#x53D1;&#x9001;&#x62A5;&#x6587;">&#x53D1;&#x9001;&#x62A5;&#x6587;</a><ul>
<li><a href="#&#x53D1;&#x9001;&#x62A5;&#x6587;&#x5C5E;&#x6027;">&#x53D1;&#x9001;&#x62A5;&#x6587;&#x5C5E;&#x6027;</a></li>
<li><a href="#dma&#x652F;&#x6301;&#x7684;&#x56DB;&#x79CD;&#x6A21;&#x5F0F;">DMA&#x652F;&#x6301;&#x7684;&#x56DB;&#x79CD;&#x6A21;&#x5F0F;</a></li>
<li><a href="#&#x8F6F;&#x4EF6;&#x53D1;&#x9001;&#x63A5;&#x53E3;">&#x8F6F;&#x4EF6;&#x53D1;&#x9001;&#x63A5;&#x53E3;</a></li>
<li><a href="#response&#x683C;&#x5F0F;">response&#x683C;&#x5F0F;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#octeon&#x8BBE;&#x5907;&#x6587;&#x4EF6;">octeon&#x8BBE;&#x5907;&#x6587;&#x4EF6;</a></li>
<li><a href="#output-ring-processing">output ring processing</a></li>
<li><a href="#se&#x90FD;&#x505A;&#x4E86;&#x4EC0;&#x4E48;">SE&#x90FD;&#x505A;&#x4E86;&#x4EC0;&#x4E48;</a></li>
<li><a href="#test">test</a></li>
</ul>
</li>
</ul>
<h1 id="pci-nic&#x652F;&#x6301;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;"><a name="pci-nic&#x652F;&#x6301;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#pci-nic&#x652F;&#x6301;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>1. pci NIC&#x652F;&#x6301;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;</h1>
<ul>
<li>Packet Mode: &#x7C7B;&#x4F3C;&#x7F51;&#x5361;</li>
<li>Coprocessor Mode: host&#x53D1;&#x8BF7;&#x6C42;, octeon&#x7ED9;response</li>
</ul>
<h1 id="pem"><a name="pem" class="anchor-navigation-ex-anchor" href="#pem"><i class="fa fa-link" aria-hidden="true"></i></a>2. PEM</h1>
<p>RC mode: type1 configuration space header
EP mode: type 0 configuration space header<br><img src="img/octeon_pci_NIC_20220922225128.png" alt="">  </p>
<ul>
<li>pcie2.0</li>
<li>port0: RC or EP</li>
<li>port 1/2: RC</li>
</ul>
<h2 id="in-ep-mode"><a name="in-ep-mode" class="anchor-navigation-ex-anchor" href="#in-ep-mode"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. in EP mode</h2>
<ul>
<li>no I/O space</li>
<li>bar0: CN71xx SLI CSR; 16KB<br>SLI<em>WIN</em>* enable indirect access to all other CPU CSRs(or mem?)<br><img src="img/octeon_pci_NIC_20220922225412.png" alt="">  </li>
<li>bar1: 64M, indirect access to L2/DRAM<br>```
EP: pcie bar1(64MB window)</li>
</ul>
<p>38-bit L2/DRAM address referenced by the PCIe read/write operations in BAR1 space:</p>
<h2 id="37-------------------------2221---------------------------0"><a name="37-------------------------2221---------------------------0" class="anchor-navigation-ex-anchor" href="#37-------------------------2221---------------------------0"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. 37                         22|21                           0</h2>
<h2 id="pem0bar1indexnaddridx--entryofffrom-bar1-address-"><a name="pem0bar1indexnaddridx--entryofffrom-bar1-address-" class="anchor-navigation-ex-anchor" href="#pem0bar1indexnaddridx--entryofffrom-bar1-address-"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. + PEM0_BAR1_INDEXn[ADDR_IDX] | EntryOff(from BAR1 address) +</h2>
<p>|                ^           |\                             \
|                |           |  \                             \
|                |           |    \                             \
|                |           |      \                             \
|                |           |        v                             v
|                |           |  pcie address from X86_64(lower 26bit)
|                |           |  25  22 21                           0
|                |           |  -------------------------------------
|                |           |  +Entry|        EntryOff(4M)         +
|                |           |  -------------------------------------
|                |           |     |
|              +-+-----------+-----+<br>v              v             v 
PEM0_BAR1_INDEXn(0..15) CSR</p>
<h2 id="19--------------------------4-3--2-----1---0"><a name="19--------------------------4-3--2-----1---0" class="anchor-navigation-ex-anchor" href="#19--------------------------4-3--2-----1---0"><i class="fa fa-link" aria-hidden="true"></i></a>2.4. 19                          4 3  2     1   0</h2>
<h2 id="-------addridx------------caendswpaddrv"><a name="-------addridx------------caendswpaddrv" class="anchor-navigation-ex-anchor" href="#-------addridx------------caendswpaddrv"><i class="fa fa-link" aria-hidden="true"></i></a>2.5. +        ADDR_IDX            |CA|END_SWP|ADDR_V+</h2>
<p>64M window = 16 block * 4M</p>
<pre class="language-"><code>
* bar2: direct access to L2/DRAM; 512G/2T capability;   
PEM0_BAR_CTL[BAR2_ENB ]: default is disable --how to enable as default?  
![](img/octeon_pci_NIC_20220922225610.png)  

`cat /proc/iomem`
* rom bar: to bootbus; 64KB  

## in RC mode
* RC mode: does not use the base address in type 1 header.
* RC mode: use internal bar0 bar1 bar2 to access octeon from EP device
* internal bar0: 16K, --&quot;just like in EP mode&quot;  
PEM0_P2N_BAR0_START make no sense? only expose SLI CSRs to device? 
* internal bar1: 64M, --&quot;just like in EP mode&quot;, but can change base? --PEM1_P2N_BAR0_START
* internal bar2: 2T, --&quot;just like in EP mode&quot;, but can change base? --PEM2_P2N_BAR0_START ?



# DPI &amp; SLI
![](img/octeon_pci_NIC_20220922225900.png)  

* DPI&#x8D1F;&#x8D23;DMA
* SLI&#x8D1F;&#x8D23;IO BUS
* &#x4E3A;&#x4EC0;&#x4E48;DMA&#x80FD;&#x628A;X86&#x7684;&#x5185;&#x5B58;&#x62F7;&#x8D1D;&#x5230;OCTEON? &#x53CD;&#x5411;&#x770B;X86&#x7684;&#x5185;&#x5B58;?
* &#x7528;&#x6237;&#x6001;&#x4E2D;&#x65AD;&#x600E;&#x4E48;&#x5904;&#x7406;?UIO? VFIO?
* &#x53EF;DMA&#x7684;buffer&#x600E;&#x4E48;&#x7533;&#x8BF7;? &#x5C24;&#x5176;&#x662F;&#x7528;&#x6237;&#x6001;?  
&#x53C2;&#x8003;  
  * &#x641C;&#x7D22;`Mastering the DMA and IOMMU APIs`
  * http://lxr.free-electrons.com/source/Documentation/dma-buf-sharing.txt 
  * http://stackoverflow.com/questions/11137058/from-the-kernel-to-the-user-space-dma
  * http://stackoverflow.com/questions/5539375/linux-kernel-device-driver-to-dma-from-a-device-into-user-space-memory
  * http://minghuasweblog.wordpress.com/2013/03/25/mapping-dma-buffers-to-user-space-on-linux-with-mmap/
  * &#x96F6;&#x62F7;&#x8D1D; http://www.linuxjournal.com/article/6345?page=0,1
  * stack over flow QA
</code></pre><p>The technical basics are mostly summarized on a stackoverflow QA: Mapping DMA buffers to userspace. The key steps of different alternatives, are copied below:</p>
<pre class="language-"><code>LDD chapter 15, page 435, Direct IO operations. Use kernel call of get_user_pages.
Asynchronous IO may achieve the same result, but without userspace application having to wait for the read to finish.
Check the infiband drivers which goes to much effort to make zero-copy DMA and RDMA to user space work.
    The person also commented: Doing DMA directly to user space memory mappings is full of problems. Copying DMA&#x2019;d data into the userspace buffers will save much of the grief.
Preallcate n buffers with myAddr[i] = pci_alloc_consistent(blah,size,&amp;pci_addr[i]) until it fails. On a machine with 4G space usually it gets 2.5G of buffers each 4MiB. Cat /proc/buddyinfo to verify. Tell the device to DMA data into the buffer and send interrupt to tell the driver which buffer has been filled. In user space mmap the buffer, then wait on read or ioctl till the driver tells it which buffer is usable.
get_user_pages to pin the user pages and to get an array of struct page * . dma_map_page on each struct page * to get the DMA addresses, this also creates an IOMMU mapping. Tell the device to do the DMA. dma_sync_single_for_cpu to flush etc. Then dma_unmap_page and put_page.
Sometimes, all the normal operations as above will not work. The vendor (like on iMX51) provides special API for SDMA.
</code></pre><p>Though the topic is about DMA memory used by device operation, the approach is the same if a memory mapped memory is shared by multiple processes on different virtual mappings.</p>
<pre class="language-"><code>

# DPI(&#x4EE5;&#x4E0B;&#x4EE5;61xx&#x4E3A;&#x4F8B;)
![](img/octeon_pci_NIC_20220922231139.png)  

* 32 instruction input ring: 8 ring each port
* DPI input ports in PIP/IPD: 32 33 34 35

## input
![](img/octeon_pci_NIC_20220922231201.png)  

&#x8FD9;&#x91CC;&#x9762;DPTR&#x8981;&#x4E48;
1. &#x76F4;&#x63A5;&#x6A21;&#x5F0F;: &#x548C;DPTR1 2 3 &#x8054;&#x7528;, &#x6307;&#x5411;data
2. &#x95F4;&#x63A5;&#x6A21;&#x5F0F;: &#x6307;&#x5411;&#x4E00;&#x4E2A;&#x94FE;&#x8868;, &#x6BCF;&#x4E2A;component&#x5982;&#x4E0B;, 64bit&#x5BF9;&#x9F50;  
![](img/octeon_pci_NIC_20220922231234.png)  

* DPI &#x6839;&#x636E;instruction&#x6784;&#x9020;packet  
![](img/octeon_pci_NIC_20220922231434.png)  

* 4&#x79CD;DPTR format  
![](img/octeon_pci_NIC_20220922231502.png)  
![](img/octeon_pci_NIC_20220922231625.png)  
![](img/octeon_pci_NIC_20220922231535.png)  
![](img/octeon_pci_NIC_20220922231643.png)  
![](img/octeon_pci_NIC_20220922231700.png)  

## output
* 32 output ring: 8 ring each port
* 4 output port of PKO: 32 33 34 35
* ring&#x91CC;&#x9762;&#x7684;&#x6BCF;&#x4E2A;&#x9879;:
![](img/octeon_pci_NIC_20220922231731.png)  

&#x5BF9;&#x6BCF;&#x4E2A;ring  
SLI_PKT_DPADDR[DPTR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>n</span><span class="token punctuation">&gt;</span></span>]=1&#x65F6;,  

&#x8FD9;&#x4E24;&#x4E2A;pointer&#x7684;format&#x662F;&#x4E0A;&#x9762;&#x7684;DPTR0  
SLI_PKT_DPADDR[DPTR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>n</span><span class="token punctuation">&gt;</span></span>]=0&#x65F6;, 

&#x8FD9;&#x4E24;&#x4E2A;pointer&#x7684;format&#x662F;&#x4E0A;&#x9762;&#x7684;DPTR1

* output&#x6709;&#x4E24;&#x79CD;mode  
SLI_PKT_IPTR[IPTR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>n</span><span class="token punctuation">&gt;</span></span>]=1&#x65F6;,  Info-Pointer Mode  
&#x5F53;&#x62A5;&#x6587;&#x5C0F;&#x4E8E;&#x4E00;&#x4E2A;buffer size&#x7684;&#x65F6;&#x5019;, &#x5F88;&#x7B80;&#x5355;, DPI&#x628A;&#x62A5;&#x6587;&#x5199;&#x5165;buffer pointer&#x7684;&#x5730;&#x65B9;, &#x540C;&#x65F6;&#x628A;&#x5927;&#x5C0F;&#x5199;&#x5165;info pointer&#x7684;packet length;  
&#x4F46;&#x62A5;&#x6587;&#x592A;&#x5927;&#x7684;&#x65F6;&#x5019;, DPI&#x628A;&#x62A5;&#x6587;&#x4F9D;&#x6B21;&#x5199;&#x5728;buffer pointer&#x91CC;&#x9762;, &#x4F46;&#x53EA;&#x7528;&#x7B2C;&#x4E00;&#x4E2A;&#x5BF9;&#x5E94;&#x7684;Info pointer, &#x8FD9;&#x91CC;&#x9762;&#x4F1A;&#x8BB0;&#x5F55;&#x6574;&#x4E2A;packet&#x7684;size  
info&#x7684;&#x683C;&#x5F0F;  
![](img/octeon_pci_NIC_20220922231908.png)  

&#x6CE8;: &#x8FD9;&#x91CC;&#x9762;&#x7684;info bytes&#x7531;SLI_PKT(0..31)_OUT_SIZE[ISIZE]&#x51B3;&#x5B9A;, &#x6700;&#x591A;120  
&#x540C;&#x65F6;SLI_PKT(0..31)_OUT_SIZE[BSIZE]&#x51B3;&#x5B9A;&#x4E86;buffer size, &#x6700;&#x591A;65536

SLI_PKT_IPTR[IPTR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>n</span><span class="token punctuation">&gt;</span></span>]=0&#x65F6;,  Buffer-Pointer-Only Mode  
&#x5148;&#x5199;packet size, &#x7D27;&#x8DDF;&#x7740;&#x662F;data

## DPI DMA
* 8&#x4E2A;&#x547D;&#x4EE4;queue, &#x7ED9;6&#x4E2A;DMA engine
## DMA&#x7684;&#x547D;&#x4EE4;&#x5B57;
![](img/octeon_pci_NIC_20220922232120.png)  
![](img/octeon_pci_NIC_20220922232141.png)  

HDR&#x91CC;&#x9762;&#x4F1A;&#x6307;&#x660E;DMA&#x7684;&#x79CD;&#x7C7B;
![](img/octeon_pci_NIC_20220922232206.png)  

pointer&#x7684;&#x683C;&#x5F0F;  
&#x8FD9;&#x91CC;&#x9762;&#x7684;size&#x53EA;&#x6709;12&#x4F4D;, &#x8BF4;&#x660E;&#x6BCF;&#x4E2A;PTR&#x53EA;&#x80FD;&#x7BA1;4K byte  
![](img/octeon_pci_NIC_20220922232303.png)  

## DMA&#x7684;&#x547D;&#x4EE4;queue
* &#x662F;&#x4E2A;&#x94FE;&#x8868;, &#x5728;ram&#x91CC;. &#x8F6F;&#x4EF6;&#x5199;&#x94FE;&#x8868;&#x5934;, &#x786C;&#x4EF6;&#x8BFB;&#x94FE;&#x8868;&#x5C3E;  
![](img/octeon_pci_NIC_20220922232325.png)  

## DMA engine 0..5
* DPI_DMA_CONTROL[PKT_EN]=1 ==&gt; DPI use engine 5; &#x5176;&#x4ED6;&#x60C5;&#x51B5;&#x4ECE;8 queue &#x5230;6 engine&#x4EFB;&#x610F;map
* &#x5176;&#x4ED6;&#x60C5;&#x51B5;&#x4E0B;, DMA&#x548C;DPI&#x6709;&#x9E1F;&#x5173;&#x7CFB;? &#x53EF;&#x80FD;&#x53EA;&#x662F;&#x7ED9;&#x901A;&#x7528;DMA&#x7528;&#x7684;? &#x4ECE;core&#x5230;host mem, &#x901A;&#x7528;&#x65B9;&#x5F0F;?

# PCI-BASE
components/driver/OCT-PCI-BASE-GUIDE-2.3.pdf
## packages
* OCTEON-PCI-BASE: x86 pci driver &amp;&amp; octeon se
* OCTEON-PCI-NIC: x86 network device; on top of OCTEON-PCI-BASE
* OCTEON-PCI-CNTQ: x86 app; on top of OCTEON-PCI-BASE

## overview
![](img/octeon_pci_NIC_20220922232710.png)  
![](img/octeon_pci_NIC_20220922232727.png)  

## input rings
![](img/octeon_pci_NIC_20220922232756.png)  

## output rings
![](img/octeon_pci_NIC_20220922232810.png)  

## dma
![](img/octeon_pci_NIC_20220922232824.png)  

## dir tree
![](img/octeon_pci_NIC_20220922232859.png)  

## host driver
* Initialization of various OCTEON PCI blocks including Input/Output  
rings and DMA engines.
* Receiving requests from user and kernel space applications and
forwarding them to OCTEON.
* Managing different requests types while they wait being fetched by
OCTEON or till a response arrives from OCTEON.
* Receiving packets from OCTEON via the output rings and dispatch them
to kernel applications.
* Managing various hooks that other kernel modules (like NIC) can call to change the default packet processing behavior.

### device configuration
See OCTEON_config.h/OCTEON_main.c

### input ring initialization
See `request_manager.c` - `OCTEON_init_instr_queue()`  
&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;:  
* 32&#x5B57;&#x8282;type, 1024 entries for ring0, 128 entries for other rings  
* for all input rings: 64-bit endian swapping and disables relaxed ordering and NoSnoop operations

### output ring initialization
See `OCTEON_droq.c` - `OCTEON_init_droq()`
&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;:
* 1024 entries for ring0, 128 entries for other rings
* info pointer mode
* pre-allocated buffer(1024 bytes) for each entry in descriptor ring
* 100ms timer interrupt

### dma initialization
&#x5B8C;&#x6210;&#x901A;&#x77E5;:
* Issue a work-queue entry to the POW
* Write 0 to a memory location

### other initialization
* request list: from app
* poll list: in kernel thread
* dispatch: opcode for packages arriving on output rings

### linux ko
`components/driver/host/driver/linux/octeon_linux.c`

## input ring processing
![](img/octeon_pci_NIC_20220922233859.png)  
![](img/octeon_pci_NIC_20220922233919.png)  

### &#x53D1;&#x9001;&#x62A5;&#x6587;
![](img/octeon_pci_NIC_20220922234031.png)  
* `OCTEON_send_request()` from kernel space
* `ioctl` from user space

#### &#x53D1;&#x9001;&#x62A5;&#x6587;&#x5C5E;&#x6027;
![](img/octeon_pci_NIC_20220922234105.png)  
![](img/octeon_pci_NIC_20220922234155.png)  

#### DMA&#x652F;&#x6301;&#x7684;&#x56DB;&#x79CD;&#x6A21;&#x5F0F;
![](img/octeon_pci_NIC_20220922234221.png)  
&#x6CE8;: &#x5373;&#x4F7F;&#x5BF9;app&#x652F;&#x6301;&#x591A;buffer&#x6A21;&#x5F0F;, &#x4F46;&#x4ECE;user space&#x62F7;&#x8D1D;&#x5230;kernel space&#x65F6;, &#x9A71;&#x52A8;&#x4F1A;&#x62F7;&#x8D1D;&#x5230;&#x4E00;&#x4E2A;buffer&#x91CC;&#x9762;

#### &#x8F6F;&#x4EF6;&#x53D1;&#x9001;&#x63A5;&#x53E3;
`OCTEON_soft_request()`, &#x7528;&#x5230;&#x7684;&#x7ED3;&#x6784;&#x4F53;OCTEON_soft_request_t&#x5728;`components/driver/host/include/cavium_defs.h`

#### response&#x683C;&#x5F0F;
![](img/octeon_pci_NIC_20220922234425.png)  
![](img/octeon_pci_NIC_20220922234536.png)  
![](img/octeon_pci_NIC_20220922234554.png)  

## octeon&#x8BBE;&#x5907;&#x6587;&#x4EF6;
`/dev/OCTEON_device`, user api &#x5E93;(liboctapi.a)&#x4F9D;&#x8D56;&#x5B83;
api&#x5728;`components/driver/host/api/octeon_user.h`

## output ring processing
* 100ms&#x4E2D;&#x65AD;
* &#x4ECE;ring0&#x5F00;&#x59CB;&#x4F9D;&#x6B21;&#x5904;&#x7406;

![](img/octeon_pci_NIC_20220922234715.png)  

&#x53EF;&#x4EE5;&#x6839;&#x636E;opcode&#x8C03;&#x7528;&#x76F8;&#x5E94;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;  
&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;ring&#x505A;fast path, &#x7528;`OCTEON_register_droq_ops()`&#x6765;&#x6CE8;&#x518C;fast path&#x5904;&#x7406;&#x51FD;&#x6570;  
&#x9ED8;&#x8BA4;&#x8D70;slow path: &#x5373;&#x6240;&#x6709;&#x6765;&#x7684;package&#x90FD;&#x67E5;opcode&#x505A;&#x76F8;&#x5E94;&#x5904;&#x7406;, &#x6CA1;&#x6709;&#x5904;&#x7406;&#x51FD;&#x6570;&#x5219;driver&#x5C31;&#x628A;buffer&#x56DE;&#x6536;&#x4E86;  
output ring &#x91CD;&#x586B;&#x53EF;&#x4EE5;update&#x65B0;&#x7684;buffer info

## SE&#x90FD;&#x505A;&#x4E86;&#x4EC0;&#x4E48;
&#x6BD4;&#x5982;&#x521D;&#x59CB;&#x5316;DMA
</code></pre><p>cvm_drv_init()
cvm_drv_local_init()
cvm_drv_setup_app_mode()
cvm_drv_start()
```
&#x4ECE;pcie&#x8FDB;&#x6765;&#x7684;&#x62A5;&#x6587;&#x8FDB;WQE, &#x548C;&#x5176;&#x4ED6;&#x63A5;&#x53E3;&#x8FDB;&#x6765;&#x7684;&#x62A5;&#x6587;&#x7C7B;&#x4F3C;.data&#x524D;&#x6709;24&#x5B57;&#x8282;&#x7684;&#x5934;?<br><img src="img/octeon_pci_NIC_20220922234812.png" alt="">  </p>
<p>octeon&#x53D1;&#x62A5;&#x6587;&#x7ED9;x86&#x65F6;, &#x5C31;&#x50CF;&#x53D1;&#x7ED9;SGMII&#x4E00;&#x6837;, &#x7ED9;PKO&#x5199;&#x547D;&#x4EE4;, &#x6B64;&#x65F6;, &#x786C;&#x4EF6;&#x5B8C;&#x6210;</p>
<ol>
<li>&#x4ECE;output ring&#x83B7;&#x53D6;&#x4E0B;&#x4E00;&#x4E2A;&#x62A5;&#x6587;buffer</li>
<li>&#x628A;PKO&#x6765;&#x7684;&#x62A5;&#x6587;&#x5206;&#x7247;, &#x4EE5;&#x5199;&#x5165;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;buffer</li>
<li>&#x5199;info pointer, &#x6BD4;&#x5982;&#x8981;&#x5199;&#x62A5;&#x6587;&#x957F;&#x5EA6;</li>
<li>&#x53D1;&#x4E2D;&#x65AD;(&#x62A5;&#x6587;&#x6570;&#x6216;&#x8005;&#x65F6;&#x95F4;&#x7247;)
DMA&#x4E0D;&#x8981;&#x6C42;octeon&#x548C;x86&#x7684;buffer&#x6570;&#x662F;&#x4E00;&#x6837;&#x7684;, &#x5728;DMA&#x4F20;&#x8F93;&#x65F6;, &#x53EA;&#x8981;&#x603B;&#x5B57;&#x8282;&#x6570;&#x4E00;&#x6837;&#x5C31;OK<br>core driver&#x4F1A;&#x586B;DMA&#x547D;&#x4EE4;&#x5B57;&#x6765;&#x505A;DMA&#x53CC;&#x5411;&#x4F20;&#x8F93;</li>
</ol>
<h2 id="test"><a name="test" class="anchor-navigation-ex-anchor" href="#test"><i class="fa fa-link" aria-hidden="true"></i></a>2.6. test</h2>
<ul>
<li>oct_req&#x662F;&#x7528;&#x6237;&#x6001;&#x7A0B;&#x5E8F;</li>
<li>req_resp&#x662F;&#x5185;&#x6838;&#x6001;&#x7A0B;&#x5E8F;</li>
<li>droq_test&#x662F;&#x5185;&#x6838;&#x6001;&#x7A0B;&#x5E8F;, &#x5728;output ring&#x4E0A;&#x6CE8;&#x518C;&#x4E86;&#x4E00;&#x4E2A;&#x6536;&#x5305;&#x51FD;&#x6570;</li>
<li>cvmcs:SE &#x5728;applications/pci-core-app</li>
<li>oct_dbg:&#x4E00;&#x4E2A;&#x5E26;menu&#x7684;dgb&#x5DE5;&#x5177;</li>
<li>oct_stats:&#x663E;&#x793A;input output DMA queue&#x7684;&#x5DE5;&#x5177;</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="as_title.html" class="navigation navigation-prev " aria-label="Previous page: 智能网卡和DPDK">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="as_title.html" class="navigation navigation-next " aria-label="Next page: octeon liquidIO">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"octeon PCI NIC","level":"1.10.4.1","depth":3,"next":{"title":"octeon liquidIO","level":"1.10.4.2","depth":3,"path":"notes/as_title.md","ref":"notes/as_title.md","articles":[{"title":"PCI-NIC 代码阅读 --app篇","level":"1.10.4.2.1","depth":4,"path":"notes/smartNIC_liquidIO_代码阅读app篇.md","ref":"notes/smartNIC_liquidIO_代码阅读app篇.md","articles":[]},{"title":"PCI-NIC 代码阅读 --api篇","level":"1.10.4.2.2","depth":4,"path":"notes/smartNIC_liquidIO_代码阅读api篇.md","ref":"notes/smartNIC_liquidIO_代码阅读api篇.md","articles":[]},{"title":"PCI-NIC 代码阅读 --driver篇之结构体","level":"1.10.4.2.3","depth":4,"path":"notes/smartNIC_liquidIO_代码阅读driver篇之结构体.md","ref":"notes/smartNIC_liquidIO_代码阅读driver篇之结构体.md","articles":[]},{"title":"PCI-NIC 代码阅读 --driver篇","level":"1.10.4.2.4","depth":4,"path":"notes/smartNIC_liquidIO_代码阅读driver篇.md","ref":"notes/smartNIC_liquidIO_代码阅读driver篇.md","articles":[]},{"title":"PCI-NIC 代码阅读 --真NIC篇","level":"1.10.4.2.5","depth":4,"path":"notes/smartNIC_liquidIO_代码阅读真NIC篇.md","ref":"notes/smartNIC_liquidIO_代码阅读真NIC篇.md","articles":[]}]},"previous":{"title":"智能网卡和DPDK","level":"1.10.4","depth":2,"path":"notes/as_title.md","ref":"notes/as_title.md","articles":[{"title":"octeon PCI NIC","level":"1.10.4.1","depth":3,"path":"notes/octeon_pci_NIC.md","ref":"notes/octeon_pci_NIC.md","articles":[]},{"title":"octeon liquidIO","level":"1.10.4.2","depth":3,"path":"notes/as_title.md","ref":"notes/as_title.md","articles":[{"title":"PCI-NIC 代码阅读 --app篇","level":"1.10.4.2.1","depth":4,"path":"notes/smartNIC_liquidIO_代码阅读app篇.md","ref":"notes/smartNIC_liquidIO_代码阅读app篇.md","articles":[]},{"title":"PCI-NIC 代码阅读 --api篇","level":"1.10.4.2.2","depth":4,"path":"notes/smartNIC_liquidIO_代码阅读api篇.md","ref":"notes/smartNIC_liquidIO_代码阅读api篇.md","articles":[]},{"title":"PCI-NIC 代码阅读 --driver篇之结构体","level":"1.10.4.2.3","depth":4,"path":"notes/smartNIC_liquidIO_代码阅读driver篇之结构体.md","ref":"notes/smartNIC_liquidIO_代码阅读driver篇之结构体.md","articles":[]},{"title":"PCI-NIC 代码阅读 --driver篇","level":"1.10.4.2.4","depth":4,"path":"notes/smartNIC_liquidIO_代码阅读driver篇.md","ref":"notes/smartNIC_liquidIO_代码阅读driver篇.md","articles":[]},{"title":"PCI-NIC 代码阅读 --真NIC篇","level":"1.10.4.2.5","depth":4,"path":"notes/smartNIC_liquidIO_代码阅读真NIC篇.md","ref":"notes/smartNIC_liquidIO_代码阅读真NIC篇.md","articles":[]}]},{"title":"DPDK使用(2014)","level":"1.10.4.3","depth":3,"path":"notes/networking_dpdk使用_2014.md","ref":"notes/networking_dpdk使用_2014.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["-sharing","-lunr","-search","search-plus","-highlight","prism","prism-themes","expandable-chapters-small","github","disqus","splitter","wide-page","hide-navigation-buttons","anchor-navigation-ex","sequence"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prism-themes/themes/prism-coldark-cold.css"]},"disqus":{"useIdentifier":false,"shortName":"bai-yingjie-notes"},"sequence":{"theme":"simple"},"github":{"url":"https://github.com/Bai-Yingjie/Bai-Yingjie.github.io"},"splitter":{},"wide-page":{},"fontsettings":{"theme":"white","family":"sans","size":2},"hide-navigation-buttons":{},"anchor-navigation-ex":{"mode":"float","pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"isRewritePageTitle":true,"showLevel":true,"tocLevel1Icon":"fa fa-hand-o-right","tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right","showGoTop":true,"isShowTocTitleIcon":true,"printLog":false,"multipleH1":true,"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false}},"prism-themes":{},"expandable-chapters-small":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"search-plus":{}},"theme":"default","author":"Bai Yingjie","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"My Notes","language":"zh-hans","gitbook":"*"},"file":{"path":"notes/octeon_pci_NIC.md","mtime":"2022-09-23T00:09:01.472Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-09-23T00:10:02.844Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

