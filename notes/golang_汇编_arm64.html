
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>汇编语法和arm64小知识 · My Notes</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Bai Yingjie">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-coldark-cold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-wide-page/wide.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hide-navigation-buttons/index.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="golang_cgo_swig.html" />
    
    
    <link rel="prev" href="golang_mod_proxy.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    CPU和device虚拟化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    gvisor
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="golang_gvisor代码_KVM.html">
            
                <a href="golang_gvisor代码_KVM.html">
            
                    
                    gvisor KVM模式代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="golang_gvisor调试.html">
            
                <a href="golang_gvisor调试.html">
            
                    
                    gvisor调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="golang_gvisor_ptrace.html">
            
                <a href="golang_gvisor_ptrace.html">
            
                    
                    gvisor ptrace模式介绍(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="rust_vmm_brief.html">
            
                <a href="rust_vmm_brief.html">
            
                    
                    rust VMM(virtual machine monitor)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="rust_vmm_简介.html">
            
                <a href="rust_vmm_简介.html">
            
                    
                    rust-vmm简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="rust_firecracker_代码.html">
            
                <a href="rust_firecracker_代码.html">
            
                    
                    firecracker代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="rust_firecracker_使用.html">
            
                <a href="rust_firecracker_使用.html">
            
                    
                    firecracker使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="rust_cloud-hypervisor_代码.html">
            
                <a href="rust_cloud-hypervisor_代码.html">
            
                    
                    cloud hypervisor代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="rust_cloud-hypervisor_使用.html">
            
                <a href="rust_cloud-hypervisor_使用.html">
            
                    
                    cloud hypervisor使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="rust_cloud-hypervisor_问题与解决.html">
            
                <a href="rust_cloud-hypervisor_问题与解决.html">
            
                    
                    cloud hypervisor问题与解决
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="qemu使用.html">
            
                <a href="qemu使用.html">
            
                    
                    Qemu使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    虚拟化网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="networking_virtualization_杂记.html">
            
                <a href="networking_virtualization_杂记.html">
            
                    
                    虚拟化网络杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="networking_linux虚拟网络接口.html">
            
                <a href="networking_linux虚拟网络接口.html">
            
                    
                    linux虚拟网络接口(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    开源
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="my_opensource.html">
            
                <a href="my_opensource.html">
            
                    
                    我的开源项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="my_upstream.html">
            
                <a href="my_upstream.html">
            
                    
                    我的upstream commit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Golang
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    入门
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="golang_语法基础.html">
            
                <a href="golang_语法基础.html">
            
                    
                    语法基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="golang_json性能.html">
            
                <a href="golang_json性能.html">
            
                    
                    json性能比较
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="golang_原理.html">
            
                <a href="golang_原理.html">
            
                    
                    原理相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="golang_interface原理.html">
            
                <a href="golang_interface原理.html">
            
                    
                    interface原理(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="golang_内存分配.html">
            
                <a href="golang_内存分配.html">
            
                    
                    内存分配(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="golang_标准库.html">
            
                <a href="golang_标准库.html">
            
                    
                    标准库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="golang_我的反射代码.html">
            
                <a href="golang_我的反射代码.html">
            
                    
                    我的反射代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="golang_问答.html">
            
                <a href="golang_问答.html">
            
                    
                    问答
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="golang_高效go.html">
            
                <a href="golang_高效go.html">
            
                    
                    高效go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="golang_进阶.html">
            
                <a href="golang_进阶.html">
            
                    
                    进阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    杂记
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.8.1" data-path="golang_杂记1.html">
            
                <a href="golang_杂记1.html">
            
                    
                    杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.2" data-path="golang_杂记2.html">
            
                <a href="golang_杂记2.html">
            
                    
                    杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.3" data-path="golang_杂记3.html">
            
                <a href="golang_杂记3.html">
            
                    
                    杂记3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.4" data-path="golang_lib选型.html">
            
                <a href="golang_lib选型.html">
            
                    
                    lib选型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.5" data-path="golang_mod_proxy.html">
            
                <a href="golang_mod_proxy.html">
            
                    
                    go mod和go proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.8.6" data-path="golang_汇编_arm64.html">
            
                <a href="golang_汇编_arm64.html">
            
                    
                    汇编语法和arm64小知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.7" data-path="golang_cgo_swig.html">
            
                <a href="golang_cgo_swig.html">
            
                    
                    go调用c可以用swig
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    环境和工具链生成
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.9.1" data-path="golang_toolchain_ppc.html">
            
                <a href="golang_toolchain_ppc.html">
            
                    
                    go tools增加ppc32支持.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9.2" data-path="golang_toolchain_compile_gccgo.html">
            
                <a href="golang_toolchain_compile_gccgo.html">
            
                    
                    编译gccgo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9.3" data-path="golang_go_on_mips.html">
            
                <a href="golang_go_on_mips.html">
            
                    
                    go on mips boards(not so updated)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.9.3.1" data-path="golang_go_on_mips_part1.html">
            
                <a href="golang_go_on_mips_part1.html">
            
                    
                    part 1: cross compile go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9.3.2" data-path="golang_go_on_mips_part2.html">
            
                <a href="golang_go_on_mips_part2.html">
            
                    
                    part 2: build native go compiler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9.3.3" data-path="golang_go_on_mips_part3.html">
            
                <a href="golang_go_on_mips_part3.html">
            
                    
                    part 3: gccgo experiments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9.3.4" data-path="golang_go_on_mips_part4.html">
            
                <a href="golang_go_on_mips_part4.html">
            
                    
                    part 4: json performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9.3.5" data-path="golang_gentoo_on_mips_board_and_build_go.html">
            
                <a href="golang_gentoo_on_mips_board_and_build_go.html">
            
                    
                    Gentoo on mips board and build go
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    微服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.10.1" data-path="golang_micro.html">
            
                <a href="golang_micro.html">
            
                    
                    go-micro和micro
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10.2" data-path="golang_微服务概念.html">
            
                <a href="golang_微服务概念.html">
            
                    
                    微服务概念
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    解释器和编解码
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.11.1" data-path="golang_yeagi.html">
            
                <a href="golang_yeagi.html">
            
                    
                    解释器yeagi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11.2" data-path="golang_tengo.html">
            
                <a href="golang_tengo.html">
            
                    
                    解释器tengo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11.3" data-path="golang_govaluate.html">
            
                <a href="golang_govaluate.html">
            
                    
                    解释器govaluate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11.4" data-path="golang_encoding_gotiny.html">
            
                <a href="golang_encoding_gotiny.html">
            
                    
                    gotiny编解码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11.5" data-path="golang_abs.html">
            
                <a href="golang_abs.html">
            
                    
                    解释器abs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.12" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    调试和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.12.1" data-path="golang_调试记录.html">
            
                <a href="golang_调试记录.html">
            
                    
                    调试记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.12.2" data-path="golang_topid性能优化.html">
            
                <a href="golang_topid性能优化.html">
            
                    
                    topid性能优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.12.3" data-path="golang_gshell性能调试.html">
            
                <a href="golang_gshell性能调试.html">
            
                    
                    gshell性能调试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.13" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    网络和消息中间件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.13.1" data-path="golang_zmq.html">
            
                <a href="golang_zmq.html">
            
                    
                    消息中间件基本概念和zero mq
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.2" data-path="golang_mango.html">
            
                <a href="golang_mango.html">
            
                    
                    消息中间件mango
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.3" data-path="golang_libp2p.html">
            
                <a href="golang_libp2p.html">
            
                    
                    p2p网络
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Rust
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="rust_入门_brief.html">
            
                <a href="rust_入门_brief.html">
            
                    
                    入门系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="rust_books.html">
            
                <a href="rust_books.html">
            
                    
                    reference books
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.2" data-path="rust_入门1.html">
            
                <a href="rust_入门1.html">
            
                    
                    安装和基础语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.3" data-path="rust_入门2.html">
            
                <a href="rust_入门2.html">
            
                    
                    泛型和内存所有权
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.4" data-path="rust_入门3.html">
            
                <a href="rust_入门3.html">
            
                    
                    闭包 容器 迭代器 生成器 线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.5" data-path="rust_工程构建.html">
            
                <a href="rust_工程构建.html">
            
                    
                    工程构建
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="rust_coding_brief.html">
            
                <a href="rust_coding_brief.html">
            
                    
                    代码积累
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="rust_序列化.html">
            
                <a href="rust_序列化.html">
            
                    
                    序列化原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.2" data-path="rust_知识点积累.html">
            
                <a href="rust_知识点积累.html">
            
                    
                    知识点更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.3" data-path="rust_adaptiveservice.html">
            
                <a href="rust_adaptiveservice.html">
            
                    
                    rust版本的adaptiveservice探索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.4" data-path="rust_常用设施.html">
            
                <a href="rust_常用设施.html">
            
                    
                    常用设施
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.5" data-path="rust_代码小段.html">
            
                <a href="rust_代码小段.html">
            
                    
                    代码小段
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="others.html">
            
                <a href="others.html">
            
                    
                    其他
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.3.1" data-path="rust_mdbook_使用.html">
            
                <a href="rust_mdbook_使用.html">
            
                    
                    使用mdbook
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    ARM server
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="arm_server_杂记.html">
            
                <a href="arm_server_杂记.html">
            
                    
                    杂记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    脚本
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="shell_变量.html">
            
                <a href="shell_变量.html">
            
                    
                    shell变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="shell_基础篇.html">
            
                <a href="shell_基础篇.html">
            
                    
                    shell命令和脚本记录-基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="shell_高级篇.html">
            
                <a href="shell_高级篇.html">
            
                    
                    shell命令和脚本记录-高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="shell_脚本片段.html">
            
                <a href="shell_脚本片段.html">
            
                    
                    shell脚本片段
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="python_记录.html">
            
                <a href="python_记录.html">
            
                    
                    python记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="lua_记录.html">
            
                <a href="lua_记录.html">
            
                    
                    lua记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="shell_rds脚本阅读.html">
            
                <a href="shell_rds脚本阅读.html">
            
                    
                    RDS脚本阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.8" data-path="Project_Euler.html">
            
                <a href="Project_Euler.html">
            
                    
                    Project Euler
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    CPU Arch相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    PPC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                <a href="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                    
                    PPC启动多核linux: 流程和内存映射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.2" data-path="CPU_PPC_kernel升级记录.html">
            
                <a href="CPU_PPC_kernel升级记录.html">
            
                    
                    PPC kernel升级记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    MIPS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.2.1" data-path="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                <a href="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                    
                    octeon 地址空间和寄存器访问
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.2" data-path="CPU_MIPS_octeon操作记录.html">
            
                <a href="CPU_MIPS_octeon操作记录.html">
            
                    
                    octeon 操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.3" data-path="CPU_MIPS_octeon_包处理性能.html">
            
                <a href="CPU_MIPS_octeon_包处理性能.html">
            
                    
                    octeon 系列处理器包处理性能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.4" data-path="CPU_MIPS_octeon_ddr调试记录.html">
            
                <a href="CPU_MIPS_octeon_ddr调试记录.html">
            
                    
                    octeon DDR调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.5" data-path="CPU_MIPS_octeon_BDK.html">
            
                <a href="CPU_MIPS_octeon_BDK.html">
            
                    
                    octeon CN78xx BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.6" data-path="kernel_增加ECC中断.html">
            
                <a href="kernel_增加ECC中断.html">
            
                    
                    octeon 增加ECC中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.7" data-path="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                <a href="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                    
                    octeon hw-ddr2代码走读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.8" data-path="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                <a href="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                    
                    octeon reboot调试和DDR中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.9" data-path="CPU_MIPS_octeon中断.html">
            
                <a href="CPU_MIPS_octeon中断.html">
            
                    
                    octeon 中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.10" data-path="CPU_MIPS_octeon原子操作.html">
            
                <a href="CPU_MIPS_octeon原子操作.html">
            
                    
                    octeon 原子操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.11" data-path="CPU_MIPS_octeon网口代码分析.html">
            
                <a href="CPU_MIPS_octeon网口代码分析.html">
            
                    
                    octeon 网口代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    设备和驱动相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="device_driver_杂记.html">
            
                <a href="device_driver_杂记.html">
            
                    
                    驱动杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="device_localbus_16bit读写.html">
            
                <a href="device_localbus_16bit读写.html">
            
                    
                    CPLD做8bit到16bit转换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    nand
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.3.1" data-path="device_driver_octeon_nand.html">
            
                <a href="device_driver_octeon_nand.html">
            
                    
                    octeon nand flash驱动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3.2" data-path="device_driver_nand概率写失败问题分析.html">
            
                <a href="device_driver_nand概率写失败问题分析.html">
            
                    
                    Nand flash概率写失败问题分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="octeon_remote_pci.html">
            
                <a href="octeon_remote_pci.html">
            
                    
                    octeon remote-pci.c阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    智能网卡和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.5.1" data-path="octeon_pci_NIC.html">
            
                <a href="octeon_pci_NIC.html">
            
                    
                    octeon PCI NIC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5.2" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    octeon liquidIO
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.5.2.1" data-path="smartNIC_liquidIO_代码阅读app篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读app篇.html">
            
                    
                    PCI-NIC 代码阅读 --app篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5.2.2" data-path="smartNIC_liquidIO_代码阅读api篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读api篇.html">
            
                    
                    PCI-NIC 代码阅读 --api篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5.2.3" data-path="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇之结构体
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5.2.4" data-path="smartNIC_liquidIO_代码阅读driver篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5.2.5" data-path="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                    
                    PCI-NIC 代码阅读 --真NIC篇
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.5.3" data-path="networking_dpdk使用_2014.html">
            
                <a href="networking_dpdk使用_2014.html">
            
                    
                    DPDK使用(2014)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Linux 开发调试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Operating System
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1.1" data-path="system_libc_part1.html">
            
                <a href="system_libc_part1.html">
            
                    
                    libc概览1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.2" data-path="system_libc_part2.html">
            
                <a href="system_libc_part2.html">
            
                    
                    libc概览2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.3" data-path="system_libc_part3.html">
            
                <a href="system_libc_part3.html">
            
                    
                    libc概览3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.4" data-path="system_原理杂记.html">
            
                <a href="system_原理杂记.html">
            
                    
                    原理杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.5" data-path="system_alpine.html">
            
                <a href="system_alpine.html">
            
                    
                    Alpine Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.6" data-path="system_进程间通信.html">
            
                <a href="system_进程间通信.html">
            
                    
                    进程间通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.7" data-path="system_特殊功能fd.html">
            
                <a href="system_特殊功能fd.html">
            
                    
                    eventfd timerfd signalfd和fd共享
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    嵌入式系统开发调试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.2.1" data-path="embedded_debugging.html">
            
                <a href="embedded_debugging.html">
            
                    
                    调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.2" data-path="uboot_杂记.html">
            
                <a href="uboot_杂记.html">
            
                    
                    uboot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.3" data-path="buildroot_杂记.html">
            
                <a href="buildroot_杂记.html">
            
                    
                    buildroot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.4" data-path="toolchain_升级gcc问题解决.html">
            
                <a href="toolchain_升级gcc问题解决.html">
            
                    
                    升级GCC7.3问题解决
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    工程实践
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="gitlab_ci.html">
            
                <a href="gitlab_ci.html">
            
                    
                    gitlab CI
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >汇编语法和arm64小知识</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#pseudo&#x5BC4;&#x5B58;&#x5668;"><b>1. </b>pseudo&#x5BC4;&#x5B58;&#x5668;</a></li><li><span class="title-icon "></span><a href="#&#x51FD;&#x6570;"><b>2. </b>&#x51FD;&#x6570;</a></li><li><span class="title-icon "></span><a href="#arm64&#x6C47;&#x7F16;"><b>3. </b>arm64&#x6C47;&#x7F16;</a></li><ul><li><span class="title-icon "></span><a href="#register-mapping-rules"><b>3.1. </b>Register mapping rules</a></li></ul><li><span class="title-icon "></span><a href="#arm64&#x5F02;&#x5E38;&#x5904;&#x7406;&#x8FC7;&#x7A0B;"><b>4. </b>ARM64&#x5F02;&#x5E38;&#x5904;&#x7406;&#x8FC7;&#x7A0B;</a></li><li><span class="title-icon "></span><a href="#arm64&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;"><b>5. </b>ARM64&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;</a></li><li><span class="title-icon "></span><a href="#&#x4EC0;&#x4E48;&#x662F;vhe"><b>6. </b>&#x4EC0;&#x4E48;&#x662F;VHE</a></li></ul></div><a href="#pseudo&#x5BC4;&#x5B58;&#x5668;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><p>golang&#x6C47;&#x7F16;&#x8BED;&#x6CD5;&#x53C2;&#x8003;: <a href="https://go.dev/doc/asm" target="_blank">https://go.dev/doc/asm</a></p>
<ul>
<li><a href="#pseudo&#x5BC4;&#x5B58;&#x5668;">pseudo&#x5BC4;&#x5B58;&#x5668;</a></li>
<li><a href="#&#x51FD;&#x6570;">&#x51FD;&#x6570;</a></li>
<li><a href="#arm64&#x6C47;&#x7F16;">arm64&#x6C47;&#x7F16;</a><ul>
<li><a href="#register-mapping-rules">Register mapping rules</a></li>
</ul>
</li>
<li><a href="#arm64&#x5F02;&#x5E38;&#x5904;&#x7406;&#x8FC7;&#x7A0B;">ARM64&#x5F02;&#x5E38;&#x5904;&#x7406;&#x8FC7;&#x7A0B;</a></li>
<li><a href="#arm64&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;">ARM64&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;</a></li>
<li><a href="#&#x4EC0;&#x4E48;&#x662F;vhe">&#x4EC0;&#x4E48;&#x662F;VHE</a></li>
</ul>
<h1 id="pseudo&#x5BC4;&#x5B58;&#x5668;"><a name="pseudo&#x5BC4;&#x5B58;&#x5668;" class="anchor-navigation-ex-anchor" href="#pseudo&#x5BC4;&#x5B58;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>1. pseudo&#x5BC4;&#x5B58;&#x5668;</h1>
<ul>
<li>SB: Static base pointer &#x5168;&#x5C40;&#x57FA;&#x5730;&#x5740;. &#x6BD4;&#x5982;foo(SB)&#x5C31;&#x662F;foo&#x8FD9;&#x4E2A;symbol&#x7684;&#x5730;&#x5740;</li>
<li>FP: &#x5E27;&#x6307;&#x9488;. &#x7528;&#x6765;&#x4F20;&#x53C2;&#x7684;, &#x6BD4;&#x5982;<ul>
<li><code>first_arg+0(FP)</code>: &#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;</li>
<li><code>second_arg+8(FP)</code>: &#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;(64bit CPU)</li>
</ul>
</li>
<li>SP: &#x6808;&#x6307;&#x9488;. &#x6307;&#x5411;&#x6808;&#x9876;. &#x7528;&#x4E8E;&#x5C40;&#x90E8;&#x53D8;&#x91CF;. CPU&#x90FD;&#x6709;&#x7269;&#x7406;SP, &#x8BED;&#x6CD5;&#x4E0A;&#x770B;&#x524D;&#x7F00;&#x6765;&#x533A;&#x5206;:<ul>
<li><code>x-8(SP)</code>, <code>y-4(SP)</code>: &#x4F7F;&#x7528;pseudo SP</li>
<li><code>-8(SP)</code>&#x4F7F;&#x7528;&#x7269;&#x7406;SP</li>
</ul>
</li>
<li>PC: &#x7A0B;&#x5E8F;&#x6307;&#x9488;</li>
</ul>
<h1 id="&#x51FD;&#x6570;"><a name="&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>2. &#x51FD;&#x6570;</h1>
<p>&#x683C;&#x5F0F;: <code>TEXT symbol(SB), [flags,] $framesize[-argsize]</code></p>
<ul>
<li>symbol: &#x51FD;&#x6570;&#x540D;</li>
<li>SB: SB&#x4F2A;&#x5BC4;&#x5B58;&#x5668;</li>
<li>flags: &#x53EF;&#x4EE5;&#x662F;<ul>
<li>NOSPLIT: &#x4E0D;&#x8BA9;&#x7F16;&#x8BD1;&#x5668;&#x63D2;&#x5165;&#x6808;&#x5206;&#x88C2;&#x7684;&#x4EE3;&#x7801;</li>
<li>WRAPPER: &#x4E0D;&#x589E;&#x52A0;&#x51FD;&#x6570;&#x5E27;&#x8BA1;&#x6570;</li>
<li>NEEDCTXT: &#x9700;&#x8981;&#x4E0A;&#x4E0B;&#x6587;&#x53C2;&#x6570;, &#x4E00;&#x822C;&#x7528;&#x4E8E;&#x95ED;&#x5305;</li>
</ul>
</li>
<li>framesize: &#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x5927;&#x5C0F;, &#x5305;&#x542B;&#x8981;&#x4F20;&#x7ED9;&#x5B50;&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x90E8;&#x5206;</li>
<li>argsize: &#x53C2;&#x6570;+&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x5927;&#x5C0F;, &#x53EF;&#x4EE5;&#x7701;&#x7565;&#x7531;&#x7F16;&#x8BD1;&#x5668;&#x81EA;&#x5DF1;&#x63A8;&#x5BFC;</li>
</ul>
<p>&#x6BD4;&#x5982;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">//go:nosplit</span>
<span class="token keyword">func</span> <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x53EF;&#x4EE5;&#x5199;&#x4E3A;:</p>
<pre class="language-"><code class="lang-go">TEXT &#xB7;<span class="token function">swap</span><span class="token punctuation">(</span>SB<span class="token punctuation">)</span><span class="token punctuation">,</span> NOSPLIT<span class="token punctuation">,</span> $<span class="token number">0</span><span class="token operator">-</span><span class="token number">32</span>
&#x6216;&#x8005;
TEXT &#xB7;<span class="token function">swap</span><span class="token punctuation">(</span>SB<span class="token punctuation">)</span><span class="token punctuation">,</span> NOSPLIT<span class="token punctuation">,</span> $<span class="token number">0</span>
</code></pre>
<p>&#x8FD9;&#x91CC;<code>-32</code>&#x662F;4&#x4E2A;8&#x5B57;&#x8282;&#x7684;int, &#x5373;&#x5165;&#x53C2;a, b&#x548C;&#x4E24;&#x4E2A;&#x51FA;&#x53C2;.<br>&#x6CE8;&#x610F;go&#x5E76;&#x4E0D;&#x533A;&#x5206;&#x5165;&#x53C2;&#x548C;&#x51FA;&#x53C2;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
&#x6216;
<span class="token keyword">func</span> <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d <span class="token builtin">int</span><span class="token punctuation">)</span>
&#x6216;
<span class="token keyword">func</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d <span class="token builtin">int</span><span class="token punctuation">)</span>
&#x6216;
<span class="token keyword">func</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> d <span class="token builtin">int</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x6C47;&#x7F16;&#x90FD;&#x4E00;&#x6837;</p>
<h1 id="arm64&#x6C47;&#x7F16;"><a name="arm64&#x6C47;&#x7F16;" class="anchor-navigation-ex-anchor" href="#arm64&#x6C47;&#x7F16;"><i class="fa fa-link" aria-hidden="true"></i></a>3. arm64&#x6C47;&#x7F16;</h1>
<p><a href="https://pkg.go.dev/cmd/internal/obj/arm64#pkg-overview" target="_blank">https://pkg.go.dev/cmd/internal/obj/arm64#pkg-overview</a></p>
<h2 id="register-mapping-rules"><a name="register-mapping-rules" class="anchor-navigation-ex-anchor" href="#register-mapping-rules"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. Register mapping rules</h2>
<ol>
<li>All basic register names are written as Rn.</li>
<li>Go uses ZR as the zero register and RSP as the stack pointer.</li>
<li>Bn, Hn, Dn, Sn and Qn instructions are written as Fn in floating-point instructions and as Vn in SIMD instructions.</li>
</ol>
<h1 id="arm64&#x5F02;&#x5E38;&#x5904;&#x7406;&#x8FC7;&#x7A0B;"><a name="arm64&#x5F02;&#x5E38;&#x5904;&#x7406;&#x8FC7;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#arm64&#x5F02;&#x5E38;&#x5904;&#x7406;&#x8FC7;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>4. ARM64&#x5F02;&#x5E38;&#x5904;&#x7406;&#x8FC7;&#x7A0B;</h1>
<blockquote>
<p>When an event which causes an exception occurs, the processor hardware automatically performs certain actions. The <code>SPSR_ELn</code> is updated, (where n is the Exception level where the exception is taken), to store the <code>PSTATE</code> information required to correctly return at the end of the exception. <code>PSTATE</code> is updated to reflect the new processor status (and this may mean that the Exception level is raised, or it may stay the same). The return address to be used at the end of the exception is stored in <code>ELR_ELn</code>.</p>
</blockquote>
<p>&#x5F02;&#x5E38;&#x53D1;&#x751F;&#x7684;&#x65F6;&#x5019;, CPU&#x4F1A;&#x81EA;&#x52A8;&#x7684;&#x5B9E;&#x65BD;&#x5982;&#x4E0B;&#x52A8;&#x4F5C;:</p>
<ul>
<li>&#x5C06;<code>PSTATE</code>&#x4FDD;&#x5B58;&#x5230;<code>SPSR_ELn</code><br>&#x6BD4;&#x5982;&#x5F02;&#x5E38;&#x53D1;&#x751F;&#x5728;EL0, &#x4E00;&#x822C;&#x4F1A;&#x5728;EL1&#x5904;&#x7406;. &#x90A3;<code>PSTATE</code>&#x4F1A;&#x4FDD;&#x5B58;&#x5728;<code>SPSR_EL1</code></li>
<li>&#x66F4;&#x65B0;<code>PSTATE</code>&#x4EE5;&#x53CD;&#x6620;&#x65B0;&#x7684;CPU&#x72B6;&#x6001;, &#x6BD4;&#x5982;&#x5DF2;&#x7ECF;&#x8FDB;&#x5165;EL1</li>
<li>&#x786C;&#x4EF6;&#x4F1A;&#x5C06;&#x8FD4;&#x56DE;&#x5730;&#x5740;&#x4FDD;&#x5B58;&#x5728;<code>ELR_Eln</code>.<br>&#x8FD8;&#x662F;&#x6BD4;&#x5982;&#x5F02;&#x5E38;&#x53D1;&#x751F;&#x5728;EL0, &#x4F46;&#x5728;EL1&#x5904;&#x7406;, &#x90A3;&#x8FD4;&#x56DE;&#x5730;&#x5740;&#x4FDD;&#x5B58;&#x5728;<code>ELR_EL1</code><br><img src="img/golang_&#x6C47;&#x7F16;_arm64_20220810232527.png" alt="">  </li>
</ul>
<blockquote>
<p>The processor has to be told when to return from an exception by software. This is done by executing the ERET instruction. This restores the pre-exception <code>PSTATE</code> from <code>SPSR_ELn</code> and returns program execution back to the original location by restoring the PC from <code>ELR_ELn</code>.</p>
</blockquote>
<p>eret&#x6307;&#x4EE4;&#x7528;&#x6765;&#x4ECE;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x8FD4;&#x56DE;:</p>
<ul>
<li>&#x4ECE;<code>SPSR_ELn</code>&#x6062;&#x590D;&#x5F02;&#x5E38;&#x524D;&#x7684;<code>PSTATE</code></li>
<li>&#x4ECE;<code>ELR_ELn</code>&#x6062;&#x590D;PC</li>
<li>&#x5F02;&#x5E38;&#x8FD4;&#x56DE;, &#x4ECE;&#x6062;&#x590D;&#x7684;PC&#x548C;<code>PSTATE</code>&#x7EE7;&#x7EED;&#x6267;&#x884C;</li>
</ul>
<blockquote>
<p><code>ELR_ELn</code> contains the return address which is preferred for the specific exception type. For some exceptions, this is the address of the next instruction after the one which generated the exception. For example, when an SVC (system call) instruction is executed, we simply wish to return to the following instruction in the application. In other cases, we may wish to re-execute the instruction that generated the exception.</p>
</blockquote>
<p>&#x5728;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x65F6;, &#x786C;&#x4EF6;&#x4F1A;&#x81EA;&#x52A8;&#x66F4;&#x65B0;ELR, &#x6839;&#x636E;&#x60C5;&#x51B5;, &#x8FD4;&#x56DE;&#x5730;&#x5740;&#x6709;&#x51E0;&#x79CD;&#x53EF;&#x80FD;:</p>
<ul>
<li>&#x6BD4;&#x5982;SVC&#x6307;&#x4EE4;&#x89E6;&#x53D1;&#x7684;&#x540C;&#x6B65;&#x5F02;&#x5E38;, ELR&#x91CC;&#x4FDD;&#x5B58;&#x7684;&#x662F;&#x5176;&#x4E0B;&#x4E00;&#x6761;&#x6307;&#x4EE4;</li>
<li>&#x6BD4;&#x5982;&#x5F02;&#x6B65;&#x5F02;&#x5E38;(&#x5373;&#x5916;&#x90E8;&#x4E2D;&#x65AD;), ELR&#x91CC;&#x4FDD;&#x5B58;&#x7684;&#x662F;&#x4E0B;&#x4E00;&#x4E2A;&#x6CA1;&#x88AB;&#x6267;&#x884C;(&#x6216;&#x5B8C;&#x5168;&#x6267;&#x884C;)&#x7684;&#x6307;&#x4EE4;</li>
</ul>
<p>ELR&#x53EF;&#x4EE5;&#x5728;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x91CC;&#x9762;&#x88AB;&#x66F4;&#x6539;.</p>
<blockquote>
<p>In addition to the <code>SPSR</code> and <code>ELR</code> registers, each Exception level has its own dedicated Stack Pointer register. These are named <code>SP_EL0</code>, <code>SP_EL1</code>, <code>SP_EL2</code> and <code>SP_EL3</code>. These registers are used to point to a dedicated stack that can, for example, be used to store registers which are corrupted by the exception handler, so that they can be restored to their original value before returning to the original code.</p>
<p>Handler code may switch from using <code>SP_ELn</code> to <code>SP_EL0</code>. For example, it may be that <code>SP_EL1</code> points to a piece of memory which holds a small stack that the kernel can guarantee to always be valid. <code>SP_EL0</code> might point to a kernel task stack which is larger, but not guaranteed to be safe from overflow. This switching is controlled by writing to the <code>[SPSel]</code> bit, as shown in the following code:</p>
<pre class="language-"><code class="lang-go">  MSR SPSel<span class="token punctuation">,</span> #<span class="token number">0</span>  <span class="token comment">// switch to SP_EL0</span>
  MSR SPSel<span class="token punctuation">,</span> #<span class="token number">1</span>  <span class="token comment">// switch to SP_ELn</span>
</code></pre>
</blockquote>
<p>&#x6BCF;&#x4E2A;EL&#x90FD;&#x6709;&#x72EC;&#x7ACB;&#x7684;SP, &#x5E76;&#x4E14;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x5207;&#x6362;&#x4F7F;&#x7528;<code>SP_EL0</code>&#x548C;<code>SP_ELn</code>.</p>
<h1 id="arm64&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;"><a name="arm64&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;" class="anchor-navigation-ex-anchor" href="#arm64&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;"><i class="fa fa-link" aria-hidden="true"></i></a>5. ARM64&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;</h1>
<blockquote>
<p>Processors that implement the ARMv8-A Architecture are typically used in systems running a complex operating system with many applications or tasks that run concurrently. Each process has its own unique translation tables residing in physical memory. When an application starts, the operating system allocates it a set of translation table entries that map both the code and data used by the application to physical memory. These tables can subsequently be modified by the kernel, for example, to map in extra space, and are removed when the application is no longer running.</p>
<p>There might therefore be multiple tasks present in the memory system. The kernel scheduler periodically transfers execution from one task to another. This is called a context switch and requires the kernel to save all execution state associated with the process and to restore the state of the process to be run next. The kernel also switches translation table entries to those of the next process to be run. The memory of the tasks that are not currently running is completely protected from the task that is running.</p>
</blockquote>
<p>&#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;translation table, &#x8FD9;&#x4E2A;table&#x662F;kernel&#x5206;&#x914D;&#x7684;, &#x628A;&#x5176;&#x7269;&#x7406;&#x5730;&#x5740;&#x914D;&#x7F6E;&#x5230;ttbr0&#x5BC4;&#x5B58;&#x5668;.
&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#x7684;&#x65F6;&#x5019;, kernel&#x4F1A;&#x4FDD;&#x5B58;/&#x6062;&#x590D;&#x5982;&#x4E0B;&#x4E0A;&#x4E0B;&#x6587;:</p>
<ul>
<li>general-purpose registers X0-X30.</li>
<li>Advanced SIMD and Floating-point registers V0 - V31.</li>
<li>Some status registers.</li>
<li><code>TTBR0_EL1</code> and <code>TTBR0</code>.</li>
<li>Thread Process ID (<code>TPIDxxx</code>) Registers.</li>
<li>Address Space ID (<code>ASID</code>).</li>
</ul>
<blockquote>
<p>For EL0 and EL1, there are two translation tables. <code>TTBR0_EL1</code> provides translations for the bottom of Virtual Address space, which is typically application space and <code>TTBR1_EL1</code> covers the top of Virtual Address space, typically kernel space. This split means that the OS mappings do not have to be replicated in the translation tables of each task.</p>
</blockquote>
<p>EL0&#x548C;EL1&#x6709;&#x4E24;&#x4E2A;translation table, <code>TTBR0_EL1</code>&#x8D1F;&#x8D23;bottom&#x7A7A;&#x95F4;(&#x7528;&#x6237;&#x7A7A;&#x95F4;), <code>TTBR1_EL1</code>&#x8D1F;&#x8D23;top&#x7A7A;&#x95F4;(kernel&#x7A7A;&#x95F4;). &#x5927;&#x5BB6;&#x90FD;&#x7528;<code>TTBR1_EL1</code>&#x505A;kernel&#x7A7A;&#x95F4;, &#x6240;&#x4EE5;&#x8FDB;&#x7A0B;&#x5207;&#x6362;&#x7684;&#x65F6;&#x5019;, <code>TTBR1_EL1</code>&#x4E0D;&#x7528;&#x53D8;, &#x6240;&#x4EE5;kernel&#x7684;&#x6620;&#x5C04;&#x4E0D;&#x7528;&#x53D8;.</p>
<blockquote>
<p>Translation table entries contain a non-global (nG) bit. If the nG bit is set for a particular page, it is associated with a specific task or application. If the bit is marked as 0, then the entry is global and applies to all tasks.</p>
</blockquote>
<p>&#x9875;&#x8868;entry&#x91CC;&#x6709;&#x4E2A;nG&#x4F4D;, &#x7528;&#x6765;&#x8868;&#x793A;non-global, &#x4E3A;0&#x7684;&#x65F6;&#x5019;, &#x8FD9;&#x4E2A;&#x9875;&#x8868;entry&#x5C31;&#x662F;&#x5168;&#x5C40;&#x7684;, &#x5BF9;&#x6240;&#x6709;task&#x90FD;&#x6709;&#x6548;.</p>
<blockquote>
<p>For non-global entries, when the TLB is updated and the entry is marked as non-global, a value is stored in the TLB entry in addition to the normal translation information. This value is called the Address Space ID (ASID), which is a number assigned by the OS to each individual task. Subsequent TLB look-ups only match on that entry if the current ASID matches with the ASID that is stored in the entry. This permits multiple valid TLB entries to be present for a particular page marked as non-global, but with different ASID values. In other words, we do not necessarily need to flush the TLBs when we context switch.</p>
</blockquote>
<p>ASID(<em>Address Space ID</em>)&#x5BC4;&#x5B58;&#x5668;&#x7528;&#x6765;&#x6807;&#x8BB0;&#x9875;&#x8868;entry&#x6240;&#x5C5E;&#x7684;task, &#x7531;kernel&#x5206;&#x914D;. &#x5F53;TLB&#x66F4;&#x65B0;&#x7684;&#x65F6;&#x5019;, TLB entry&#x9664;&#x4E86;&#x4FDD;&#x5B58;&#x5730;&#x5740;&#x7FFB;&#x8BD1;&#x4FE1;&#x606F;, &#x8FD8;&#x4F1A;&#x5305;&#x62EC;&#x8FD9;&#x4E2A;ASID. TLB&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x5019;, &#x53EA;&#x6709;&#x5F53;&#x524D;&#x7684;ASID&#x548C;TLB entry&#x4FDD;&#x5B58;&#x7684;ASID&#x5339;&#x914D;&#x7684;&#x65F6;&#x5019;, &#x624D;&#x7B97;TLB&#x547D;&#x4E2D;. &#x6240;&#x4EE5;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x9700;&#x8981;flush TLB.</p>
<blockquote>
<p>In AArch64, this ASID value can be specified as either an 8-bit or 16-bit value, controlled by the <code>TCR_EL1</code>.AS bit. The current ASID value is specified in either <code>TTBR0_EL1</code> or TTBR1_EL1. <code>TCR_EL1</code> controls which TTBR holds the ASID, but it is normally <code>TTBR0_EL1</code>, as this corresponds to application space.</p>
</blockquote>
<p>ASID&#x53EF;&#x4EE5;8&#x4F4D;&#x6216;16&#x4F4D;. &#x4E00;&#x822C;&#x914D;&#x7F6E;&#x5728;<code>TTBR0_EL1</code>&#x4E2D;.</p>
<blockquote>
<p>Having the current value of the ASID stored in the translation table register means that you can atomically modify both the translation tables as well as the ASID in a single instruction. This simplifies the process of changing the table and ASID when compared with the ARMv7-A Architecture.</p>
</blockquote>
<p>&#x628A;ASID&#x503C;&#x653E;&#x5728;<code>TTBR0_EL1</code>&#x91CC;&#x7684;&#x597D;&#x5904;&#x662F;, &#x4E00;&#x4E2A;&#x6307;&#x4EE4;&#x5C31;&#x53EF;&#x4EE5;&#x539F;&#x5B50;&#x7684;&#x66F4;&#x6539;ASID&#x548C;&#x9875;&#x8868;.</p>
<blockquote>
<p>Additionally, the ARMv8-A Architecture provides Thread ID registers for use by operating system software. These have no hardware significance and are typically used by threading libraries as a base pointer to per-thread data. This is often referred to as Thread Local Storage (TLS). For example, the pthreads library uses this feature and includes the following registers:</p>
<ul>
<li>User Read and Write Thread ID Register (<code>TPIDR_EL0</code>).</li>
<li>User Read-Only Thread ID Register (<code>TPIDRRO_EL0</code>).</li>
<li>Thread ID Register, privileged accesses only (<code>TPIDR_EL1</code>).</li>
</ul>
</blockquote>
<p>TPIDR(Thread ID registers)&#x662F;&#x7ED9;&#x7CFB;&#x7EDF;&#x8F6F;&#x4EF6;&#x4FDD;&#x5B58;Thread Local Storage (TLS)&#x7528;&#x7684;.
EL0&#x53EF;&#x4EE5;&#x7528;<code>TPIDR_EL0</code>
EL1&#x8FD8;&#x6709;<code>TPIDR_EL1</code></p>
<h1 id="&#x4EC0;&#x4E48;&#x662F;vhe"><a name="&#x4EC0;&#x4E48;&#x662F;vhe" class="anchor-navigation-ex-anchor" href="#&#x4EC0;&#x4E48;&#x662F;vhe"><i class="fa fa-link" aria-hidden="true"></i></a>6. &#x4EC0;&#x4E48;&#x662F;VHE</h1>
<p><strong>Note</strong>: The DynamIQ processors (Cortex-A55, Cortex-A75 and Cortex-A76) support Virtualization Host Extensions (VHEs).</p>
<p>&#x901A;&#x5E38;kernel&#x8FD0;&#x884C;&#x5728;EL1, &#x4E00;&#x4E2A;&#x540C;&#x6837;&#x7684;kernel, &#x5982;&#x679C;&#x8FD0;&#x884C;&#x5728;VHE&#x4F7F;&#x80FD;&#x4E86;, &#x786C;&#x4EF6;&#x4F1A;&#x91CD;&#x5B9A;&#x5411;&#x5BC4;&#x5B58;&#x5668;&#x8BBF;&#x95EE;:</p>
<blockquote>
<p>We saw in the section on Virtualizing generic timers that enabling VHE changes the layout of the EL2 virtual address space. However, we still have a problem with the configuration of the MMU. This is because our kernel will try to access _EL1 registers, such as <code>TTBR0_EL1</code>, rather than <code>_EL2</code> registers such as <code>TTBR0_EL2</code>.</p>
<p>To run the same binary at EL2, we need to redirect the accesses from the EL1 registers to the EL2 equivalents. Setting E2H will do this, so that accesses to <code>_EL1</code> system registers are redirected to their EL2 equivalents. This redirection illustrated in the following diagram:</p>
</blockquote>
<p><img src="img/golang_&#x6C47;&#x7F16;_arm64_20220810232622.png" alt="">  </p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="golang_mod_proxy.html" class="navigation navigation-prev " aria-label="Previous page: go mod和go proxy">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="golang_cgo_swig.html" class="navigation navigation-next " aria-label="Next page: go调用c可以用swig">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"汇编语法和arm64小知识","level":"1.5.8.6","depth":3,"next":{"title":"go调用c可以用swig","level":"1.5.8.7","depth":3,"path":"notes/golang_cgo_swig.md","ref":"notes/golang_cgo_swig.md","articles":[]},"previous":{"title":"go mod和go proxy","level":"1.5.8.5","depth":3,"path":"notes/golang_mod_proxy.md","ref":"notes/golang_mod_proxy.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","-lunr","-search","search-plus","-highlight","prism","prism-themes","expandable-chapters-small","github","disqus","splitter","wide-page","hide-navigation-buttons","anchor-navigation-ex","sequence"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prism-themes/themes/prism-coldark-cold.css"]},"disqus":{"useIdentifier":false,"shortName":"bai-yingjie-notes"},"sequence":{"theme":"simple"},"github":{"url":"https://github.com/Bai-Yingjie/Bai-Yingjie.github.io"},"splitter":{},"wide-page":{},"fontsettings":{"theme":"white","family":"sans","size":2},"hide-navigation-buttons":{},"anchor-navigation-ex":{"mode":"float","pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"isRewritePageTitle":true,"showLevel":true,"tocLevel1Icon":"fa fa-hand-o-right","tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right","showGoTop":true,"isShowTocTitleIcon":true,"printLog":false,"multipleH1":true,"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false}},"prism-themes":{},"expandable-chapters-small":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"search-plus":{}},"theme":"default","author":"Bai Yingjie","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"My Notes","language":"zh-hans","gitbook":"*"},"file":{"path":"notes/golang_汇编_arm64.md","mtime":"2022-09-25T14:58:54.076Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-09-25T15:00:00.825Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

