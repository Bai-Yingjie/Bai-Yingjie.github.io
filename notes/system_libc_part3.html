
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>libc概览3 · My Notes</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Bai Yingjie">
        
        
    
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-wide-page/wide.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hide-navigation-buttons/index.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-mermaid-gb3/mermaid/mermaid.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    


    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="system_原理杂记.html" />
    
    
    <link rel="prev" href="system_libc_part2.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="as_title_kaiyuan.html">
            
                <a href="as_title_kaiyuan.html">
            
                    
                    开源
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="my_opensource.html">
            
                <a href="my_opensource.html">
            
                    
                    我的开源项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="my_upstream.html">
            
                <a href="my_upstream.html">
            
                    
                    我的upstream commit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="as_title_system.html">
            
                <a href="as_title_system.html">
            
                    
                    系统分析和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="as_title_perf_misc.html">
            
                <a href="as_title_perf_misc.html">
            
                    
                    调试和分析记录系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="profiling_调试和分析记录5.html">
            
                <a href="profiling_调试和分析记录5.html">
            
                    
                    调试和分析记录5
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="profiling_调试和分析记录4.html">
            
                <a href="profiling_调试和分析记录4.html">
            
                    
                    调试和分析记录4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="profiling_调试和分析记录3.html">
            
                <a href="profiling_调试和分析记录3.html">
            
                    
                    调试和分析记录3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="profiling_调试和分析记录2.html">
            
                <a href="profiling_调试和分析记录2.html">
            
                    
                    调试和分析记录2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="profiling_调试和分析记录1.html">
            
                <a href="profiling_调试和分析记录1.html">
            
                    
                    调试和分析记录1
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="调试和分析工具概览.html">
            
                <a href="调试和分析工具概览.html">
            
                    
                    profiling和debugging工具相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="profiling_Linux内核调试的方式以及工具集锦.html">
            
                <a href="profiling_Linux内核调试的方式以及工具集锦.html">
            
                    
                    Linux内核调试的方式以及工具集锦(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="profiling_user_space_Ptrace_Utrace_Uprobes.html">
            
                <a href="profiling_user_space_Ptrace_Utrace_Uprobes.html">
            
                    
                    Ptrace, Utrace, Uprobes: Lightweight, Dynamic Tracing of User Apps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="debugging_gdb备忘录.html">
            
                <a href="debugging_gdb备忘录.html">
            
                    
                    gdb备忘录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="profiling_perf命令备忘录.html">
            
                <a href="profiling_perf命令备忘录.html">
            
                    
                    perf命令备忘录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5" data-path="profiling_perf命令备忘录2.html">
            
                <a href="profiling_perf命令备忘录2.html">
            
                    
                    perf命令备忘录2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.6" data-path="profiling_perf学习笔记之实战篇.html">
            
                <a href="profiling_perf学习笔记之实战篇.html">
            
                    
                    perf学习笔记之实战篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.7" data-path="profiling_perf学习笔记之入门篇.html">
            
                <a href="profiling_perf学习笔记之入门篇.html">
            
                    
                    perf学习笔记之入门篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.8" data-path="profiling_用kprobe和perf_记录函数参数.html">
            
                <a href="profiling_用kprobe和perf_记录函数参数.html">
            
                    
                    使用kprobe和perf结合记录函数参数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.9" data-path="profiling_ftrace和trace-cmd记录.html">
            
                <a href="profiling_ftrace和trace-cmd记录.html">
            
                    
                    ftrace和trace-cmd记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.10" data-path="profiling_ftrace使用实例.html">
            
                <a href="profiling_ftrace使用实例.html">
            
                    
                    ftrace使用实例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.11" data-path="profiling_systemtap实例.html">
            
                <a href="profiling_systemtap实例.html">
            
                    
                    systemtap实例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.12" data-path="profiling_systemtap基础.html">
            
                <a href="profiling_systemtap基础.html">
            
                    
                    systemtap基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.13" data-path="profiling_perf-tools_example.html">
            
                <a href="profiling_perf-tools_example.html">
            
                    
                    perf-tools 系统tracing工具集
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.14" data-path="profiling_Comparing_SystemTap_and_bpftrace.html">
            
                <a href="profiling_Comparing_SystemTap_and_bpftrace.html">
            
                    
                    Comparing SystemTap and bpftrace(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.15" data-path="system_analysis_bcc和ebpf.html">
            
                <a href="system_analysis_bcc和ebpf.html">
            
                    
                    bcc和ebpf(starting)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="as_title_os_perf.html">
            
                <a href="as_title_os_perf.html">
            
                    
                    profiling和debugging实例
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="profiling_调查ftrace显示调用栈全0问题.html">
            
                <a href="profiling_调查ftrace显示调用栈全0问题.html">
            
                    
                    调查ftrace显示调用栈全0问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="profiling_eoe_filter写tap设备失败问题.html">
            
                <a href="profiling_eoe_filter写tap设备失败问题.html">
            
                    
                    eoe_filter写tap设备失败问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="performance_ovs进程调查.html">
            
                <a href="performance_ovs进程调查.html">
            
                    
                    OVS进程调查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.4" data-path="performance_ping流程和函数调用解析.html">
            
                <a href="performance_ping流程和函数调用解析.html">
            
                    
                    ping流程和函数调用解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.5" data-path="profiling_VM互相ping场景下的延迟分析.html">
            
                <a href="profiling_VM互相ping场景下的延迟分析.html">
            
                    
                    VM互相ping场景下的延迟分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.6" data-path="debugging_ftrace_谁创建了bond0设备.html">
            
                <a href="debugging_ftrace_谁创建了bond0设备.html">
            
                    
                    谁创建了bond0设备: ftrace kprobe uprobe perf综合使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.7" data-path="profiling_unixbench之filecopy分析.html">
            
                <a href="profiling_unixbench之filecopy分析.html">
            
                    
                    unixbench之file copy分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.8" data-path="profiling_lmbench之lat_tcp分析.html">
            
                <a href="profiling_lmbench之lat_tcp分析.html">
            
                    
                    lmbench之lat_tcp分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="as_title_arch_perf.html">
            
                <a href="as_title_arch_perf.html">
            
                    
                    CPU ARCH相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="performance_CPU_microarchiteture_pmu.html">
            
                <a href="performance_CPU_microarchiteture_pmu.html">
            
                    
                    Top-down Microarchitecture Analysis Method(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="as_title_cloud.html">
            
                <a href="as_title_cloud.html">
            
                    
                    Cloud和容器相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="cloud_杂记.html">
            
                <a href="cloud_杂记.html">
            
                    
                    云杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="container_当代容器读书笔记.html">
            
                <a href="container_当代容器读书笔记.html">
            
                    
                    当代容器读书笔记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="as_title_vdevice.html">
            
                <a href="as_title_vdevice.html">
            
                    
                    CPU和device虚拟化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="as_title_gvisor.html">
            
                <a href="as_title_gvisor.html">
            
                    
                    gvisor
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="golang_gvisor代码_KVM.html">
            
                <a href="golang_gvisor代码_KVM.html">
            
                    
                    gvisor KVM模式代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="golang_gvisor调试.html">
            
                <a href="golang_gvisor调试.html">
            
                    
                    gvisor调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="golang_gvisor_ptrace.html">
            
                <a href="golang_gvisor_ptrace.html">
            
                    
                    gvisor ptrace模式介绍(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="rust_vmm_brief.html">
            
                <a href="rust_vmm_brief.html">
            
                    
                    rust VMM(virtual machine monitor)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="rust_vmm_简介.html">
            
                <a href="rust_vmm_简介.html">
            
                    
                    rust-vmm简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="rust_firecracker_代码.html">
            
                <a href="rust_firecracker_代码.html">
            
                    
                    firecracker代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="rust_firecracker_使用.html">
            
                <a href="rust_firecracker_使用.html">
            
                    
                    firecracker使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="rust_cloud-hypervisor_代码.html">
            
                <a href="rust_cloud-hypervisor_代码.html">
            
                    
                    cloud hypervisor代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.5" data-path="rust_cloud-hypervisor_使用.html">
            
                <a href="rust_cloud-hypervisor_使用.html">
            
                    
                    cloud hypervisor使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.6" data-path="rust_cloud-hypervisor_问题与解决.html">
            
                <a href="rust_cloud-hypervisor_问题与解决.html">
            
                    
                    cloud hypervisor问题与解决
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="virtualization_virtio规范阅读笔记.html">
            
                <a href="virtualization_virtio规范阅读笔记.html">
            
                    
                    virtio规范阅读笔记.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="qemu_ovs_虚拟化环境.html">
            
                <a href="qemu_ovs_虚拟化环境.html">
            
                    
                    qemu OVS 虚拟化环境准备
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="qemu使用.html">
            
                <a href="qemu使用.html">
            
                    
                    Qemu使用(old)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="as_title_networking.html">
            
                <a href="as_title_networking.html">
            
                    
                    计算机网络相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="networking_杂记2.html">
            
                <a href="networking_杂记2.html">
            
                    
                    networking杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="networking_杂记1.html">
            
                <a href="networking_杂记1.html">
            
                    
                    networking杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="networking_优化linux网络栈_接收路径.html">
            
                <a href="networking_优化linux网络栈_接收路径.html">
            
                    
                    优化linux网络栈: 接收路径(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="networking_优化linux网络栈_发送路径.html">
            
                <a href="networking_优化linux网络栈_发送路径.html">
            
                    
                    优化linux网络栈: 发送路径(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="networking_Potential_Performance_Bottleneck_in_Linux_TCP.html">
            
                <a href="networking_Potential_Performance_Bottleneck_in_Linux_TCP.html">
            
                    
                    Potential Performance Bottleneck in Linux TCP(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="networking_xdp入门.html">
            
                <a href="networking_xdp入门.html">
            
                    
                    Get started with XDP(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="networking_linux收包路径图解.html">
            
                <a href="networking_linux收包路径图解.html">
            
                    
                    linux收包路径图解(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="as_title_qemu_ovs.html">
            
                <a href="as_title_qemu_ovs.html">
            
                    
                    Qemu OVS和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.8.1" data-path="OVS_DPDK_编译运行.html">
            
                <a href="OVS_DPDK_编译运行.html">
            
                    
                    OVS-DPDK编译运行
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.2" data-path="OVS_架构和代码.html">
            
                <a href="OVS_架构和代码.html">
            
                    
                    OVS架构和代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.3" data-path="OVS_DPDK_performance_HXT_ARM_server.html">
            
                <a href="OVS_DPDK_performance_HXT_ARM_server.html">
            
                    
                    OVS-DPDK for ARM server 性能测试环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.4" data-path="DPDK_Mellanox.html">
            
                <a href="DPDK_Mellanox.html">
            
                    
                    DPDK Mellanox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.5" data-path="OVS_phy-vm-phy.html">
            
                <a href="OVS_phy-vm-phy.html">
            
                    
                    OVS PHY-VM-PHY
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.6" data-path="networking_网络虚拟化用例记录.html">
            
                <a href="networking_网络虚拟化用例记录.html">
            
                    
                    网络虚拟化用例记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.7" data-path="networking_网络虚拟化操作记录.html">
            
                <a href="networking_网络虚拟化操作记录.html">
            
                    
                    网络虚拟化操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="as_title_virtnet.html">
            
                <a href="as_title_virtnet.html">
            
                    
                    虚拟化网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.9.1" data-path="networking_tc_filter_连接veth和tap.html">
            
                <a href="networking_tc_filter_连接veth和tap.html">
            
                    
                    Connecting a veth device to tap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.2" data-path="networking_multicast_vxlan_flannel.html">
            
                <a href="networking_multicast_vxlan_flannel.html">
            
                    
                    multicast vxlan和flannel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.3" data-path="networking_virtio网络介绍.html">
            
                <a href="networking_virtio网络介绍.html">
            
                    
                    virtio网络介绍(网摘): vhost-net virtio-net vhost-user SRIOV
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.4" data-path="networking_virtualization_杂记.html">
            
                <a href="networking_virtualization_杂记.html">
            
                    
                    虚拟化网络杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.5" data-path="networking_linux虚拟网络接口.html">
            
                <a href="networking_linux虚拟网络接口.html">
            
                    
                    linux虚拟网络接口(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="as_title_arm_server.html">
            
                <a href="as_title_arm_server.html">
            
                    
                    ARM server
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="arm_server_杂记.html">
            
                <a href="arm_server_杂记.html">
            
                    
                    Arm server 杂记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="as_title_embedded.html">
            
                <a href="as_title_embedded.html">
            
                    
                    嵌入式系统开发调试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="embedded_debugging.html">
            
                <a href="embedded_debugging.html">
            
                    
                    嵌入式调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="uboot_杂记.html">
            
                <a href="uboot_杂记.html">
            
                    
                    uboot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="buildroot_杂记.html">
            
                <a href="buildroot_杂记.html">
            
                    
                    buildroot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="toolchain_升级gcc问题解决.html">
            
                <a href="toolchain_升级gcc问题解决.html">
            
                    
                    升级GCC7.3问题解决
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="kernel_异常打印分析实例.html">
            
                <a href="kernel_异常打印分析实例.html">
            
                    
                    kernel bug异常打印分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="as_title_linuxdaily.html">
            
                <a href="as_title_linuxdaily.html">
            
                    
                    Linux工程实践
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="linux_日常使用.html">
            
                <a href="linux_日常使用.html">
            
                    
                    日常linux使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="git_日常使用.html">
            
                <a href="git_日常使用.html">
            
                    
                    日常git使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="向kernel提交补丁.html">
            
                <a href="向kernel提交补丁.html">
            
                    
                    向kernel提交补丁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="linux_ssh_relay.html">
            
                <a href="linux_ssh_relay.html">
            
                    
                    ssh relay
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="gitlab_ci.html">
            
                <a href="gitlab_ci.html">
            
                    
                    gitlab CI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="docker_操作记录.html">
            
                <a href="docker_操作记录.html">
            
                    
                    docker操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="centos_操作记录.html">
            
                <a href="centos_操作记录.html">
            
                    
                    centos操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="as_title_golang.html">
            
                <a href="as_title_golang.html">
            
                    
                    Golang
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="as_title_golang1.html">
            
                <a href="as_title_golang1.html">
            
                    
                    入门
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1.1" data-path="golang_语法基础.html">
            
                <a href="golang_语法基础.html">
            
                    
                    Golang 语法基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.2" data-path="golang_json性能.html">
            
                <a href="golang_json性能.html">
            
                    
                    Golang json性能比较
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="golang_原理.html">
            
                <a href="golang_原理.html">
            
                    
                    Golang 原理相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.1" data-path="golang_interface原理.html">
            
                <a href="golang_interface原理.html">
            
                    
                    Golang interface原理(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.2" data-path="golang_内存分配.html">
            
                <a href="golang_内存分配.html">
            
                    
                    Golang 内存分配(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="golang_标准库.html">
            
                <a href="golang_标准库.html">
            
                    
                    Golang 标准库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="golang_我的反射代码.html">
            
                <a href="golang_我的反射代码.html">
            
                    
                    Golang 我的反射代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="golang_问答.html">
            
                <a href="golang_问答.html">
            
                    
                    Golang 问答
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="golang_高效go.html">
            
                <a href="golang_高效go.html">
            
                    
                    Golang 高效go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="golang_进阶.html">
            
                <a href="golang_进阶.html">
            
                    
                    Golang 进阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="as_title_golang2.html">
            
                <a href="as_title_golang2.html">
            
                    
                    Golang 杂记
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.8.1" data-path="golang_杂记1.html">
            
                <a href="golang_杂记1.html">
            
                    
                    Golang 杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.2" data-path="golang_杂记2.html">
            
                <a href="golang_杂记2.html">
            
                    
                    Golang 杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.3" data-path="golang_杂记3.html">
            
                <a href="golang_杂记3.html">
            
                    
                    Golang 杂记3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.4" data-path="golang_lib选型.html">
            
                <a href="golang_lib选型.html">
            
                    
                    Golang lib选型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.5" data-path="golang_mod_proxy.html">
            
                <a href="golang_mod_proxy.html">
            
                    
                    go mod和go proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.6" data-path="golang_汇编_arm64.html">
            
                <a href="golang_汇编_arm64.html">
            
                    
                    Golang 汇编语法和arm64小知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.7" data-path="golang_cgo_swig.html">
            
                <a href="golang_cgo_swig.html">
            
                    
                    go调用c可以用swig
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="as_title_golang3.html">
            
                <a href="as_title_golang3.html">
            
                    
                    Golang 环境和工具链生成
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.9.1" data-path="golang_toolchain_ppc.html">
            
                <a href="golang_toolchain_ppc.html">
            
                    
                    go tools增加ppc32支持.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.2" data-path="golang_toolchain_compile_gccgo.html">
            
                <a href="golang_toolchain_compile_gccgo.html">
            
                    
                    编译gccgo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3" data-path="golang_go_on_mips.html">
            
                <a href="golang_go_on_mips.html">
            
                    
                    go on mips boards(not so updated)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.9.3.1" data-path="golang_go_on_mips_part1.html">
            
                <a href="golang_go_on_mips_part1.html">
            
                    
                    part 1: cross compile go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.2" data-path="golang_go_on_mips_part2.html">
            
                <a href="golang_go_on_mips_part2.html">
            
                    
                    part 2: build native go compiler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.3" data-path="golang_go_on_mips_part3.html">
            
                <a href="golang_go_on_mips_part3.html">
            
                    
                    part 3: gccgo experiments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.4" data-path="golang_go_on_mips_part4.html">
            
                <a href="golang_go_on_mips_part4.html">
            
                    
                    part 4: Golang json performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.5" data-path="golang_gentoo_on_mips_board_and_build_go.html">
            
                <a href="golang_gentoo_on_mips_board_and_build_go.html">
            
                    
                    Gentoo on mips board and build go
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.10" data-path="as_title_golang4.html">
            
                <a href="as_title_golang4.html">
            
                    
                    微服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.10.1" data-path="golang_micro.html">
            
                <a href="golang_micro.html">
            
                    
                    go-micro和micro
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.2" data-path="golang_微服务概念.html">
            
                <a href="golang_微服务概念.html">
            
                    
                    微服务概念
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.11" data-path="as_title_golang5.html">
            
                <a href="as_title_golang5.html">
            
                    
                    解释器和编解码
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.11.1" data-path="golang_yeagi.html">
            
                <a href="golang_yeagi.html">
            
                    
                    解释器yeagi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.2" data-path="golang_tengo.html">
            
                <a href="golang_tengo.html">
            
                    
                    解释器tengo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.3" data-path="golang_govaluate.html">
            
                <a href="golang_govaluate.html">
            
                    
                    解释器govaluate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.4" data-path="golang_encoding_gotiny.html">
            
                <a href="golang_encoding_gotiny.html">
            
                    
                    gotiny编解码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.5" data-path="golang_abs.html">
            
                <a href="golang_abs.html">
            
                    
                    解释器abs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.12" data-path="as_title_golang6.html">
            
                <a href="as_title_golang6.html">
            
                    
                    调试和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.12.1" data-path="golang_调试记录.html">
            
                <a href="golang_调试记录.html">
            
                    
                    Golang 调试记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12.2" data-path="golang_topid性能优化.html">
            
                <a href="golang_topid性能优化.html">
            
                    
                    Golang topid性能优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12.3" data-path="golang_gshell性能调试.html">
            
                <a href="golang_gshell性能调试.html">
            
                    
                    Golang gshell性能调试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.13" data-path="as_title_golang7.html">
            
                <a href="as_title_golang7.html">
            
                    
                    网络和消息中间件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.13.1" data-path="golang_zmq.html">
            
                <a href="golang_zmq.html">
            
                    
                    消息中间件基本概念和zero mq
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.2" data-path="golang_mango.html">
            
                <a href="golang_mango.html">
            
                    
                    消息中间件mango
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.3" data-path="golang_libp2p.html">
            
                <a href="golang_libp2p.html">
            
                    
                    Golang p2p网络
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="as_title_rust.html">
            
                <a href="as_title_rust.html">
            
                    
                    Rust
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="rust_入门_brief.html">
            
                <a href="rust_入门_brief.html">
            
                    
                    Rust 入门系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1.1" data-path="rust_books.html">
            
                <a href="rust_books.html">
            
                    
                    Rust reference books
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.2" data-path="rust_入门1.html">
            
                <a href="rust_入门1.html">
            
                    
                    Rust 安装和基础语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.3" data-path="rust_入门2.html">
            
                <a href="rust_入门2.html">
            
                    
                    Rust 泛型和内存所有权
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.4" data-path="rust_入门3.html">
            
                <a href="rust_入门3.html">
            
                    
                    Rust 闭包 容器 迭代器 生成器 线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.5" data-path="rust_工程构建.html">
            
                <a href="rust_工程构建.html">
            
                    
                    Rust 工程构建
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="rust_coding_brief.html">
            
                <a href="rust_coding_brief.html">
            
                    
                    Rust 代码积累
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.2.1" data-path="rust_序列化.html">
            
                <a href="rust_序列化.html">
            
                    
                    Rust 序列化原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.2" data-path="rust_知识点积累.html">
            
                <a href="rust_知识点积累.html">
            
                    
                    Rust 知识点更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.3" data-path="rust_adaptiveservice.html">
            
                <a href="rust_adaptiveservice.html">
            
                    
                    rust版本的adaptiveservice探索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.4" data-path="rust_常用设施.html">
            
                <a href="rust_常用设施.html">
            
                    
                    Rust 常用设施
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.5" data-path="rust_代码小段.html">
            
                <a href="rust_代码小段.html">
            
                    
                    Rust 代码小段
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="others.html">
            
                <a href="others.html">
            
                    
                    其他
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.3.1" data-path="rust_mdbook_使用.html">
            
                <a href="rust_mdbook_使用.html">
            
                    
                    Rust 使用mdbook
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="as_title_scripts.html">
            
                <a href="as_title_scripts.html">
            
                    
                    脚本
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="shell_变量.html">
            
                <a href="shell_变量.html">
            
                    
                    shell变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="shell_基础篇.html">
            
                <a href="shell_基础篇.html">
            
                    
                    shell命令和脚本记录-基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="shell_高级篇.html">
            
                <a href="shell_高级篇.html">
            
                    
                    shell命令和脚本记录-高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="shell_脚本片段.html">
            
                <a href="shell_脚本片段.html">
            
                    
                    shell脚本片段
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="python_记录.html">
            
                <a href="python_记录.html">
            
                    
                    python记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="lua_记录.html">
            
                <a href="lua_记录.html">
            
                    
                    lua记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="shell_rds脚本阅读.html">
            
                <a href="shell_rds脚本阅读.html">
            
                    
                    RDS脚本阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="Project_Euler.html">
            
                <a href="Project_Euler.html">
            
                    
                    Project Euler
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="as_title_app.html">
            
                <a href="as_title_app.html">
            
                    
                    应用相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="app_sysbench代码分析.html">
            
                <a href="app_sysbench代码分析.html">
            
                    
                    sysbench代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="as_title_cos.html">
            
                <a href="as_title_cos.html">
            
                    
                    C和Operating System
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="system_libc_part1.html">
            
                <a href="system_libc_part1.html">
            
                    
                    libc概览1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="system_libc_part2.html">
            
                <a href="system_libc_part2.html">
            
                    
                    libc概览2
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.14.3" data-path="system_libc_part3.html">
            
                <a href="system_libc_part3.html">
            
                    
                    libc概览3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.4" data-path="system_原理杂记.html">
            
                <a href="system_原理杂记.html">
            
                    
                    系统原理杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5" data-path="system_alpine.html">
            
                <a href="system_alpine.html">
            
                    
                    Alpine Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.6" data-path="system_进程间通信.html">
            
                <a href="system_进程间通信.html">
            
                    
                    进程间通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.7" data-path="system_特殊功能fd.html">
            
                <a href="system_特殊功能fd.html">
            
                    
                    eventfd timerfd signalfd和fd共享
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.8" data-path="c_automake_autoconf.html">
            
                <a href="c_automake_autoconf.html">
            
                    
                    automake autoconf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.9" data-path="makefile_原理和实践.html">
            
                <a href="makefile_原理和实践.html">
            
                    
                    makefile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.10" data-path="c_编程杂记高级篇.html">
            
                <a href="c_编程杂记高级篇.html">
            
                    
                    C编程杂记高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.11" data-path="c_编程杂记基础篇.html">
            
                <a href="c_编程杂记基础篇.html">
            
                    
                    C编程杂记基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.12" data-path="c_networking_socket高阶用法.html">
            
                <a href="c_networking_socket高阶用法.html">
            
                    
                    网络编程: Advanced Socket Topics(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.13" data-path="c_protobuf介绍.html">
            
                <a href="c_protobuf介绍.html">
            
                    
                    序列化: protobuf介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.14" data-path="c_进程间通信_共享文件和共享内存.html">
            
                <a href="c_进程间通信_共享文件和共享内存.html">
            
                    
                    进程间通信: 共享文件和共享内存(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.15" data-path="c_pthread_condition和mutex.html">
            
                <a href="c_pthread_condition和mutex.html">
            
                    
                    并发 任务 事件 和锁.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.16" data-path="kernel_user_space_howto.html">
            
                <a href="kernel_user_space_howto.html">
            
                    
                    kernel space和user space交互(网摘, linux2.6)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.17" data-path="CentOS_系统性能优化配置.html">
            
                <a href="CentOS_系统性能优化配置.html">
            
                    
                    CentOS 性能优化系统配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="as_title_driver.html">
            
                <a href="as_title_driver.html">
            
                    
                    内核 设备和驱动相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="device_driver_地址空间类型和DMA.html">
            
                <a href="device_driver_地址空间类型和DMA.html">
            
                    
                    地址空间类型和DMA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="platform_device_driver.html">
            
                <a href="platform_device_driver.html">
            
                    
                    平台驱动杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="platform_device_driver2.html">
            
                <a href="platform_device_driver2.html">
            
                    
                    平台驱动杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4" data-path="device_driver_内核中的时间和延迟操作.html">
            
                <a href="device_driver_内核中的时间和延迟操作.html">
            
                    
                    内核中的时间和延迟操作.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.5" data-path="device_driver_杂记.html">
            
                <a href="device_driver_杂记.html">
            
                    
                    驱动调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.6" data-path="device_localbus_16bit读写.html">
            
                <a href="device_localbus_16bit读写.html">
            
                    
                    CPLD做8bit到16bit转换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7" data-path="as_title_driver1.html">
            
                <a href="as_title_driver1.html">
            
                    
                    nand
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.7.1" data-path="device_driver_octeon_nand.html">
            
                <a href="device_driver_octeon_nand.html">
            
                    
                    octeon nand flash驱动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.2" data-path="device_driver_nand概率写失败问题分析.html">
            
                <a href="device_driver_nand概率写失败问题分析.html">
            
                    
                    Nand flash概率写失败问题分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.8" data-path="octeon_remote_pci.html">
            
                <a href="octeon_remote_pci.html">
            
                    
                    octeon remote-pci.c阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.9" data-path="Device_VFIO_notes.html">
            
                <a href="Device_VFIO_notes.html">
            
                    
                    VFIO简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.10" data-path="as_title_driver2.html">
            
                <a href="as_title_driver2.html">
            
                    
                    智能网卡和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.10.1" data-path="smartNIC_智能网卡对比.html">
            
                <a href="smartNIC_智能网卡对比.html">
            
                    
                    智能网卡对比
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.10.2" data-path="octeon_pci_NIC.html">
            
                <a href="octeon_pci_NIC.html">
            
                    
                    octeon PCI NIC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.10.3" data-path="as_title_driver3.html">
            
                <a href="as_title_driver3.html">
            
                    
                    octeon liquidIO
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.10.3.1" data-path="smartNIC_liquidIO_代码阅读app篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读app篇.html">
            
                    
                    PCI-NIC 代码阅读 --app篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.10.3.2" data-path="smartNIC_liquidIO_代码阅读api篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读api篇.html">
            
                    
                    PCI-NIC 代码阅读 --api篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.10.3.3" data-path="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇之结构体
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.10.3.4" data-path="smartNIC_liquidIO_代码阅读driver篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.10.3.5" data-path="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                    
                    PCI-NIC 代码阅读 --真NIC篇
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.10.4" data-path="networking_dpdk使用_2014.html">
            
                <a href="networking_dpdk使用_2014.html">
            
                    
                    DPDK使用(2014)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.11" data-path="device_nvme要点介绍.html">
            
                <a href="device_nvme要点介绍.html">
            
                    
                    nvme要点介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="as_title_cpu.html">
            
                <a href="as_title_cpu.html">
            
                    
                    CPU Arch相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="cache_CPU和cache一致性原理.html">
            
                <a href="cache_CPU和cache一致性原理.html">
            
                    
                    CPU和cache一致性原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="as_title_cpu1.html">
            
                <a href="as_title_cpu1.html">
            
                    
                    ARM64
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.2.1" data-path="CPU_ARM64_thunder_overview.html">
            
                <a href="CPU_ARM64_thunder_overview.html">
            
                    
                    thunder 概览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.2" data-path="CPU_ARM64_thunder_开发板操作记录.html">
            
                <a href="CPU_ARM64_thunder_开发板操作记录.html">
            
                    
                    thunder 开发板操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.3" data-path="CPU_ARM64_thunder_bdk.html">
            
                <a href="CPU_ARM64_thunder_bdk.html">
            
                    
                    thunder BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.4" data-path="CPU_ARM64_thunder_efi_rtc.html">
            
                <a href="CPU_ARM64_thunder_efi_rtc.html">
            
                    
                    thunder RTC时间和efi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.5" data-path="CPU_ARM64_thunder_uefi_fdt.html">
            
                <a href="CPU_ARM64_thunder_uefi_fdt.html">
            
                    
                    thunder uefi和fdt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.6" data-path="CPU_ARM64_thunder_atf.html">
            
                <a href="CPU_ARM64_thunder_atf.html">
            
                    
                    thunder atf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.7" data-path="CPU_ARM64_thunder_kernel_boot.html">
            
                <a href="CPU_ARM64_thunder_kernel_boot.html">
            
                    
                    thunder kernel启动打印流程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="as_title_cpu2.html">
            
                <a href="as_title_cpu2.html">
            
                    
                    PPC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.3.1" data-path="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                <a href="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                    
                    PPC启动多核linux: 流程和内存映射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3.2" data-path="CPU_PPC_kernel升级记录.html">
            
                <a href="CPU_PPC_kernel升级记录.html">
            
                    
                    PPC kernel升级记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.4" data-path="as_title_cpu3.html">
            
                <a href="as_title_cpu3.html">
            
                    
                    MIPS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.4.1" data-path="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                <a href="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                    
                    octeon 地址空间和寄存器访问
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.2" data-path="CPU_MIPS_octeon操作记录.html">
            
                <a href="CPU_MIPS_octeon操作记录.html">
            
                    
                    octeon 操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.3" data-path="CPU_MIPS_octeon_包处理性能.html">
            
                <a href="CPU_MIPS_octeon_包处理性能.html">
            
                    
                    octeon 系列处理器包处理性能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.4" data-path="CPU_MIPS_octeon_ddr调试记录.html">
            
                <a href="CPU_MIPS_octeon_ddr调试记录.html">
            
                    
                    octeon DDR调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.5" data-path="CPU_MIPS_octeon_BDK.html">
            
                <a href="CPU_MIPS_octeon_BDK.html">
            
                    
                    octeon CN78xx BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.6" data-path="kernel_增加ECC中断.html">
            
                <a href="kernel_增加ECC中断.html">
            
                    
                    octeon 增加ECC中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.7" data-path="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                <a href="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                    
                    octeon hw-ddr2代码走读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.8" data-path="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                <a href="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                    
                    octeon reboot调试和DDR中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.9" data-path="CPU_MIPS_octeon中断.html">
            
                <a href="CPU_MIPS_octeon中断.html">
            
                    
                    octeon 中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.10" data-path="CPU_MIPS_octeon原子操作.html">
            
                <a href="CPU_MIPS_octeon原子操作.html">
            
                    
                    octeon 原子操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.11" data-path="CPU_MIPS_octeon网口代码分析.html">
            
                <a href="CPU_MIPS_octeon网口代码分析.html">
            
                    
                    octeon 网口代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >libc概览3</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;"><b>1. </b>&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;</a></li><ul><li><span class="title-icon "></span><a href="#&#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal"><b>1.1. </b>&#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal</a></li><li><span class="title-icon "></span><a href="#&#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;"><b>1.2. </b>&#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;</a></li></ul><li><span class="title-icon "></span><a href="#signal"><b>2. </b>signal</a></li><ul><li><span class="title-icon "></span><a href="#&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal-&#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;"><b>2.1. </b>&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal, &#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;</a></li><li><span class="title-icon "></span><a href="#&#x7ED3;&#x675F;&#x7C7B;signal"><b>2.2. </b>&#x7ED3;&#x675F;&#x7C7B;signal</a></li><li><span class="title-icon "></span><a href="#&#x5B9A;&#x65F6;&#x7C7B;signal"><b>2.3. </b>&#x5B9A;&#x65F6;&#x7C7B;signal</a></li><li><span class="title-icon "></span><a href="#&#x5F02;&#x6B65;signal-&#x9ED8;&#x8BA4;&#x5FFD;&#x7565;"><b>2.4. </b>&#x5F02;&#x6B65;signal, &#x9ED8;&#x8BA4;&#x5FFD;&#x7565;</a></li><li><span class="title-icon "></span><a href="#&#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal"><b>2.5. </b>&#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal</a></li><li><span class="title-icon "></span><a href="#&#x64CD;&#x4F5C;error-signal-&#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;"><b>2.6. </b>&#x64CD;&#x4F5C;error signal, &#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;</a></li><li><span class="title-icon "></span><a href="#&#x5176;&#x4ED6;signal"><b>2.7. </b>&#x5176;&#x4ED6;signal</a></li><li><span class="title-icon "></span><a href="#&#x6253;&#x5370;signal&#x7C7B;&#x578B;"><b>2.8. </b>&#x6253;&#x5370;signal&#x7C7B;&#x578B;</a></li><li><span class="title-icon "></span><a href="#signal&#x5904;&#x7406;"><b>2.9. </b>signal&#x5904;&#x7406;</a></li><li><span class="title-icon "></span><a href="#sigaction"><b>2.10. </b>sigaction</a></li><li><span class="title-icon "></span><a href="#signal&#x7684;flag"><b>2.11. </b>signal&#x7684;flag</a></li><li><span class="title-icon "></span><a href="#signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;"><b>2.12. </b>signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;</a></li><li><span class="title-icon "></span><a href="#signal&#x5904;&#x7406;&#x51FD;&#x6570;"><b>2.13. </b>signal&#x5904;&#x7406;&#x51FD;&#x6570;</a></li><li><span class="title-icon "></span><a href="#signal-handler&#x88AB;&#x6253;&#x65AD;"><b>2.14. </b>signal handler&#x88AB;&#x6253;&#x65AD;?</a></li><li><span class="title-icon "></span><a href="#signal&#x5408;&#x5E76;"><b>2.15. </b>signal&#x5408;&#x5E76;</a></li><li><span class="title-icon "></span><a href="#signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;"><b>2.16. </b>signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;</a></li><li><span class="title-icon "></span><a href="#&#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;"><b>2.17. </b>&#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;?</a></li><li><span class="title-icon "></span><a href="#&#x89E6;&#x53D1;signal"><b>2.18. </b>&#x89E6;&#x53D1;signal</a></li><li><span class="title-icon "></span><a href="#&#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal"><b>2.19. </b>&#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal</a></li><li><span class="title-icon "></span><a href="#kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;"><b>2.20. </b>kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;</a></li><li><span class="title-icon "></span><a href="#signal&#x7684;&#x963B;&#x585E;"><b>2.21. </b>signal&#x7684;&#x963B;&#x585E;</a></li><li><span class="title-icon "></span><a href="#&#x6B63;&#x5728;pending&#x7684;signal&#x5DF2;&#x5230;&#x8FBE;-&#x672A;&#x5904;&#x7406;"><b>2.22. </b>&#x6B63;&#x5728;pending&#x7684;signal(&#x5DF2;&#x5230;&#x8FBE;, &#x672A;&#x5904;&#x7406;)</a></li><li><span class="title-icon "></span><a href="#&#x7B49;&#x5F85;signal"><b>2.23. </b>&#x7B49;&#x5F85;signal</a></li><li><span class="title-icon "></span><a href="#signal&#x7684;&#x6808;"><b>2.24. </b>signal&#x7684;&#x6808;</a></li></ul><li><span class="title-icon "></span><a href="#&#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;"><b>3. </b>&#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;</a></li><ul><li><span class="title-icon "></span><a href="#&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getoptlong"><b>3.1. </b>&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getopt_long</a></li><li><span class="title-icon "></span><a href="#&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argpparse"><b>3.2. </b>&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argp_parse</a></li><li><span class="title-icon "></span><a href="#&#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;"><b>3.3. </b>&#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;</a></li><li><span class="title-icon "></span><a href="#&#x73AF;&#x5883;&#x53D8;&#x91CF;"><b>3.4. </b>&#x73AF;&#x5883;&#x53D8;&#x91CF;</a></li><li><span class="title-icon "></span><a href="#syscall"><b>3.5. </b>syscall</a></li><li><span class="title-icon "></span><a href="#&#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;"><b>3.6. </b>&#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;</a></li></ul><li><span class="title-icon "></span><a href="#&#x8FDB;&#x7A0B;"><b>4. </b>&#x8FDB;&#x7A0B;</a></li><ul><li><span class="title-icon "></span><a href="#fork"><b>4.1. </b>fork</a></li><li><span class="title-icon "></span><a href="#exec"><b>4.2. </b>exec</a></li><li><span class="title-icon "></span><a href="#&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;"><b>4.3. </b>&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;</a></li><li><span class="title-icon "></span><a href="#&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;"><b>4.4. </b>&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;</a></li></ul><li><span class="title-icon "></span><a href="#job&#x63A7;&#x5236;"><b>5. </b>job&#x63A7;&#x5236;</a></li><ul><li><span class="title-icon "></span><a href="#&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;"><b>5.1. </b>&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;(&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;?)</a></li><li><span class="title-icon "></span><a href="#&#x8FDB;&#x7A0B;&#x7EC4;api"><b>5.2. </b>&#x8FDB;&#x7A0B;&#x7EC4;api</a></li><li><span class="title-icon "></span><a href="#&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell"><b>5.3. </b>&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell</a></li></ul><li><span class="title-icon "></span><a href="#include-"><b>6. </b>include </a></li><li><span class="title-icon "></span><a href="#include-_1"><b>7. </b>include </a></li><li><span class="title-icon "></span><a href="#include-_2"><b>8. </b>include </a></li><li><span class="title-icon "></span><a href="#&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;"><b>9. </b>&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;</a></li><li><span class="title-icon "></span><a href="#&#x8C03;&#x8BD5;"><b>10. </b>&#x8C03;&#x8BD5;</a></li><ul><li><span class="title-icon "></span><a href="#&#x8C03;&#x7528;&#x6808;"><b>10.1. </b>&#x8C03;&#x7528;&#x6808;</a></li></ul><li><span class="title-icon "></span><a href="#pthread"><b>11. </b>pthread</a></li><ul><li><span class="title-icon "></span><a href="#gnu&#x6269;&#x5C55;"><b>11.1. </b>gnu&#x6269;&#x5C55;</a></li></ul><li><span class="title-icon "></span><a href="#libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;&#x7565;"><b>12. </b>libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;(&#x7565;)</a></li><li><span class="title-icon "></span><a href="#libc&#x57FA;&#x7840;&#x51FD;&#x6570;"><b>13. </b>libc&#x57FA;&#x7840;&#x51FD;&#x6570;</a></li></ul></div><a href="#&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><ul>
<li><a href="#&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;">&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;</a><ul>
<li><a href="#&#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal">&#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal</a></li>
<li><a href="#&#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;">&#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;</a></li>
</ul>
</li>
<li><a href="#signal">signal</a><ul>
<li><a href="#&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal-&#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;">&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal, &#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;</a></li>
<li><a href="#&#x7ED3;&#x675F;&#x7C7B;signal">&#x7ED3;&#x675F;&#x7C7B;signal</a></li>
<li><a href="#&#x5B9A;&#x65F6;&#x7C7B;signal">&#x5B9A;&#x65F6;&#x7C7B;signal</a></li>
<li><a href="#&#x5F02;&#x6B65;signal-&#x9ED8;&#x8BA4;&#x5FFD;&#x7565;">&#x5F02;&#x6B65;signal, &#x9ED8;&#x8BA4;&#x5FFD;&#x7565;</a></li>
<li><a href="#&#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal">&#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal</a></li>
<li><a href="#&#x64CD;&#x4F5C;error-signal-&#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;">&#x64CD;&#x4F5C;error signal, &#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;</a></li>
<li><a href="#&#x5176;&#x4ED6;signal">&#x5176;&#x4ED6;signal</a></li>
<li><a href="#&#x6253;&#x5370;signal&#x7C7B;&#x578B;">&#x6253;&#x5370;signal&#x7C7B;&#x578B;</a></li>
<li><a href="#signal&#x5904;&#x7406;">signal&#x5904;&#x7406;</a></li>
<li><a href="#sigaction">sigaction</a></li>
<li><a href="#signal&#x7684;flag">signal&#x7684;flag</a></li>
<li><a href="#signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;">signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;</a></li>
<li><a href="#signal&#x5904;&#x7406;&#x51FD;&#x6570;">signal&#x5904;&#x7406;&#x51FD;&#x6570;</a></li>
<li><a href="#signal-handler&#x88AB;&#x6253;&#x65AD;">signal handler&#x88AB;&#x6253;&#x65AD;?</a></li>
<li><a href="#signal&#x5408;&#x5E76;">signal&#x5408;&#x5E76;</a></li>
<li><a href="#signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;">signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;</a></li>
<li><a href="#&#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;">&#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;?</a></li>
<li><a href="#&#x89E6;&#x53D1;signal">&#x89E6;&#x53D1;signal</a></li>
<li><a href="#&#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal">&#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal</a></li>
<li><a href="#kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;">kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;</a></li>
<li><a href="#signal&#x7684;&#x963B;&#x585E;">signal&#x7684;&#x963B;&#x585E;</a></li>
<li><a href="#&#x6B63;&#x5728;pending&#x7684;signal&#x5DF2;&#x5230;&#x8FBE;-&#x672A;&#x5904;&#x7406;">&#x6B63;&#x5728;pending&#x7684;signal(&#x5DF2;&#x5230;&#x8FBE;, &#x672A;&#x5904;&#x7406;)</a></li>
<li><a href="#&#x7B49;&#x5F85;signal">&#x7B49;&#x5F85;signal</a></li>
<li><a href="#signal&#x7684;&#x6808;">signal&#x7684;&#x6808;</a></li>
</ul>
</li>
<li><a href="#&#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;">&#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;</a><ul>
<li><a href="#&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getopt_long">&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getopt_long</a></li>
<li><a href="#&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argp_parse">&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argp_parse</a></li>
<li><a href="#&#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;">&#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;</a></li>
<li><a href="#&#x73AF;&#x5883;&#x53D8;&#x91CF;">&#x73AF;&#x5883;&#x53D8;&#x91CF;</a></li>
<li><a href="#syscall">syscall</a></li>
<li><a href="#&#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;">&#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;</a></li>
</ul>
</li>
<li><a href="#&#x8FDB;&#x7A0B;">&#x8FDB;&#x7A0B;</a><ul>
<li><a href="#fork">fork</a></li>
<li><a href="#exec">exec</a></li>
<li><a href="#&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;">&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;</a></li>
<li><a href="#&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;">&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;</a></li>
</ul>
</li>
<li><a href="#job&#x63A7;&#x5236;">job&#x63A7;&#x5236;</a><ul>
<li><a href="#&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;">&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;(&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;?)</a></li>
<li><a href="#&#x8FDB;&#x7A0B;&#x7EC4;api">&#x8FDB;&#x7A0B;&#x7EC4;api</a></li>
<li><a href="#&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell">&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell</a></li>
</ul>
</li>
<li><a href="#&#x7528;&#x6237;&#x548C;&#x7EC4;">&#x7528;&#x6237;&#x548C;&#x7EC4;</a><ul>
<li><a href="#api">api</a></li>
</ul>
</li>
<li><a href="#&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;">&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;</a></li>
<li><a href="#&#x8C03;&#x8BD5;">&#x8C03;&#x8BD5;</a><ul>
<li><a href="#&#x8C03;&#x7528;&#x6808;">&#x8C03;&#x7528;&#x6808;</a></li>
</ul>
</li>
<li><a href="#pthread">pthread</a><ul>
<li><a href="#gnu&#x6269;&#x5C55;">gnu&#x6269;&#x5C55;</a></li>
</ul>
</li>
<li><a href="#libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;&#x7565;">libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;(&#x7565;)</a></li>
<li><a href="#libc&#x57FA;&#x7840;&#x51FD;&#x6570;">libc&#x57FA;&#x7840;&#x51FD;&#x6570;</a></li>
</ul>
<h1 id="&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;"><a name="&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;" class="anchor-navigation-ex-anchor" href="#&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;"><i class="fa fa-link" aria-hidden="true"></i></a>1. &#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;</h1>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;setjmp.h&gt;</span></span>
<span class="token comment">//&#x7ED3;&#x6784;&#x4F53;, &#x7528;&#x6765;&#x4FDD;&#x5B58;&#x4E0A;&#x4E0B;&#x6587;</span>
jmp_buf
<span class="token comment">/*&#x8FD4;&#x56DE;0&#x8868;&#x793A;&#x8BBE;&#x7F6E;jmp_buf&#x6210;&#x529F;
**&#x975E;&#x96F6;&#x503C;&#x8868;&#x793A;&#x6709;&#x4E00;&#x6B21;&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;, &#x503C;&#x662F;longjmp&#x7ED9;&#x51FA;&#x7684;
**&#x5B9E;&#x9645;&#x4E0A;, segjump&#x662F;&#x4E2A;&#x5B8F;
*/</span>
<span class="token keyword">int</span> <span class="token function">setjmp</span> <span class="token punctuation">(</span>jmp buf state<span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">longjmp</span> <span class="token punctuation">(</span>jmp buf state<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;:</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;setjmp.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
jmp_buf main_loop<span class="token punctuation">;</span>
<span class="token keyword">void</span>
<span class="token function">abort_to_main_loop</span><span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">longjmp</span><span class="token punctuation">(</span>main_loop<span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">setjmp</span><span class="token punctuation">(</span>main_loop<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;Back at main loop....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token function">do_command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span>
<span class="token function">do_command</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fgets</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token function">abort_to_main_loop</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_SUCCESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal"><a name="&#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal" class="anchor-navigation-ex-anchor" href="#&#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. &#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal</h2>
<p>&#x4F46;&#x4E5F;&#x53EF;&#x4EE5;&#x4FDD;&#x5B58;&#x5F53;&#x65F6;&#x7684;signal, &#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;&#x65F6;&#x6062;&#x590D;</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;setjmp.h&gt;</span></span>
<span class="token comment">//&#x7ED3;&#x6784;&#x4F53;</span>
sigjmp_buf
<span class="token comment">//savesigs&#x662F;&#x8981;&#x4FDD;&#x5B58;&#x7684;&#x5F53;&#x65F6;&#x7684;signal set</span>
<span class="token keyword">int</span> <span class="token function">sigsetjmp</span> <span class="token punctuation">(</span>sigjmp buf state<span class="token punctuation">,</span> <span class="token keyword">int</span> savesigs<span class="token punctuation">)</span>
<span class="token comment">//signal&#x5728;longjump&#x65F6;&#x4F1A;&#x6062;&#x590D;</span>
<span class="token keyword">void</span> <span class="token function">siglongjmp</span> <span class="token punctuation">(</span>sigjmp buf state<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span>
</code></pre>
<h2 id="&#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;"><a name="&#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;" class="anchor-navigation-ex-anchor" href="#&#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. &#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;</h2>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ucontext.h&gt;</span></span>
<span class="token comment">//&#x6BD4;jmp_buf&#x4FE1;&#x606F;&#x66F4;&#x591A;, &#x5F00;&#x9500;&#x4E5F;&#x66F4;&#x5927;</span>
<span class="token class-name">ucontext_t</span>
    <span class="token class-name">ucontext_t</span> <span class="token operator">*</span>uc_link
    <span class="token class-name">sigset_t</span> uc_sigmask
    <span class="token class-name">stack_t</span> uc_stack
    <span class="token class-name">mcontext_t</span> uc_mcontext
<span class="token comment">//&#x521D;&#x59CB;&#x5316;&#x4E0A;&#x4E0B;&#x6587;ucp</span>
<span class="token keyword">int</span> <span class="token function">getcontext</span> <span class="token punctuation">(</span>ucontext t <span class="token operator">*</span>ucp<span class="token punctuation">)</span>
<span class="token comment">//&#x4FEE;&#x6539;&#x4E0A;&#x4E0B;&#x6587;</span>
<span class="token keyword">void</span> <span class="token function">makecontext</span> <span class="token punctuation">(</span>ucontext t <span class="token operator">*</span>ucp<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>func<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token comment">//&#x6062;&#x590D;&#x4E0A;&#x4E0B;&#x6587;</span>
<span class="token keyword">int</span> <span class="token function">setcontext</span> <span class="token punctuation">(</span><span class="token keyword">const</span> ucontext t <span class="token operator">*</span>ucp<span class="token punctuation">)</span>
<span class="token comment">//&#x4FDD;&#x5B58;&#x73B0;&#x5728;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x5230;oucp, &#x5E76;&#x5207;&#x6362;&#x5230;ucp</span>
<span class="token keyword">int</span> <span class="token function">swapcontext</span> <span class="token punctuation">(</span>ucontext t <span class="token operator">*</span>restrict oucp<span class="token punctuation">,</span> <span class="token keyword">const</span> ucontext t <span class="token operator">*</span>restrict ucp<span class="token punctuation">)</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;:&#x573A;&#x666F;&#x662F;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x5F88;&#x590D;&#x6742;&#x7684;&#x641C;&#x7D22;&#x51FD;&#x6570;fn, &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x590D;&#x6742;&#x5230;&#x4E0D;&#x80FD;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x8FD4;&#x56DE;</p>
<pre class="language-"><code class="lang-c"><span class="token keyword">int</span>
<span class="token function">random_search</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>fp<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">ucontext_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">volatile</span> <span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">ucontext_t</span> uc<span class="token punctuation">;</span>

    <span class="token comment">/* Safe current context. */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getcontext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uc<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">/* If we have not tried n times try again. */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt<span class="token operator">++</span> <span class="token operator">&lt;</span> n<span class="token punctuation">)</span>

        <span class="token comment">/* Call the function with a new random number
        and the context. */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fp</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>uc<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token comment">/* We found what we were looking for. */</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">/* Not found. */</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;:</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ucontext.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h&gt;</span></span>
<span class="token comment">/* Set by the signal handler. */</span>
<span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> expired<span class="token punctuation">;</span>
<span class="token comment">/* The contexts. */</span>
<span class="token keyword">static</span> <span class="token class-name">ucontext_t</span> uc<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">/* We do only a certain number of switches. */</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> switches<span class="token punctuation">;</span>
<span class="token comment">/* This is the function doing the work. It is just a
skeleton, real code has to be filled in. */</span>
<span class="token keyword">static</span> <span class="token keyword">void</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/* This is where the work would be done. */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>m <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">putchar</span><span class="token punctuation">(</span>&#x2019;<span class="token punctuation">.</span>&#x2019;<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/* Regularly the expire variable must be checked. */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>expired<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/* We do not want the program to run forever. */</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>switches <span class="token operator">==</span> <span class="token number">20</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>

            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\nswitching from %d to %d\n&quot;</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">-</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
            expired <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token comment">/* Switch to the other context, saving the current one. */</span>
            <span class="token function">swapcontext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uc<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>uc<span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">-</span> n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/* This is the signal handler which simply set the variable. */</span>
<span class="token keyword">void</span>
<span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> signal<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    expired <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> sa<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">itimerval</span> it<span class="token punctuation">;</span>
    <span class="token keyword">char</span> st1<span class="token punctuation">[</span><span class="token number">8192</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> st2<span class="token punctuation">[</span><span class="token number">8192</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">/* Initialize the data structures for the interval timer. */</span>
    sa<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> SA_RESTART<span class="token punctuation">;</span>
    <span class="token function">sigfillset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sa<span class="token punctuation">.</span>sa_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sa<span class="token punctuation">.</span>sa_handler <span class="token operator">=</span> handler<span class="token punctuation">;</span>
    it<span class="token punctuation">.</span>it_interval<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    it<span class="token punctuation">.</span>it_interval<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    it<span class="token punctuation">.</span>it_value <span class="token operator">=</span> it<span class="token punctuation">.</span>it_interval<span class="token punctuation">;</span>

    <span class="token comment">/* Install the timer and get the context we can manipulate. */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sigaction</span><span class="token punctuation">(</span>SIGPROF<span class="token punctuation">,</span> <span class="token operator">&amp;</span>sa<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span>
        <span class="token operator">||</span> <span class="token function">setitimer</span><span class="token punctuation">(</span>ITIMER_PROF<span class="token punctuation">,</span> <span class="token operator">&amp;</span>it<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span>
        <span class="token operator">||</span> <span class="token function">getcontext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token operator">||</span> <span class="token function">getcontext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uc<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Create a context with a separate stack which causes the
    function f to be call with the parameter 1.
    Note that the uc_link points to the main context
    which will cause the program to terminate once the function
    return. */</span>
    uc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>uc_link <span class="token operator">=</span> <span class="token operator">&amp;</span>uc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    uc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>uc_stack<span class="token punctuation">.</span>ss_sp <span class="token operator">=</span> st1<span class="token punctuation">;</span>
    uc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>uc_stack<span class="token punctuation">.</span>ss_size <span class="token operator">=</span> <span class="token keyword">sizeof</span> st1<span class="token punctuation">;</span>
    <span class="token function">makecontext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span> f<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* Similarly, but 2 is passed as the parameter to f. */</span>
    uc<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>uc_link <span class="token operator">=</span> <span class="token operator">&amp;</span>uc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    uc<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>uc_stack<span class="token punctuation">.</span>ss_sp <span class="token operator">=</span> st2<span class="token punctuation">;</span>
    uc<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>uc_stack<span class="token punctuation">.</span>ss_size <span class="token operator">=</span> <span class="token keyword">sizeof</span> st2<span class="token punctuation">;</span>
    <span class="token function">makecontext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uc<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span> f<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* Start running. */</span>
    <span class="token function">swapcontext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>uc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">putchar</span><span class="token punctuation">(</span>&#x2019;\n&#x2019;<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="signal"><a name="signal" class="anchor-navigation-ex-anchor" href="#signal"><i class="fa fa-link" aria-hidden="true"></i></a>2. signal</h1>
<ul>
<li>&#x7531;&#x7A0B;&#x5E8F;&#x81EA;&#x8EAB;&#x5F15;&#x8D77;&#x7684;error&#x89E6;&#x53D1;&#x7684;signal&#x4E00;&#x822C;&#x90FD;&#x662F;&#x540C;&#x6B65;&#x7684;</li>
<li>&#x5916;&#x90E8;&#x89E6;&#x53D1;&#x7684;signal&#x4E00;&#x822C;&#x90FD;&#x662F;&#x5F02;&#x6B65;&#x7684;.</li>
<li>&#x5982;&#x679C;&#x4E00;&#x4E2A;signal&#x6B63;&#x5728;&#x88AB;&#x5904;&#x7406;, &#x90A3;&#x5904;&#x7406;&#x671F;&#x95F4;&#x8FD9;&#x4E2A;&#x4FE1;&#x53F7;&#x662F;&#x963B;&#x585E;&#x7684;.</li>
<li>&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;signal&#x95F4;&#x9694;&#x5F88;&#x77ED;, one handler can run within another<h2 id="&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal-&#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;"><a name="&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal-&#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal-&#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. &#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal, &#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;</h2>
</li>
<li>SIGFPE: &#x8FD0;&#x7B97;&#x9519;&#x8BEF;, &#x5305;&#x62EC;&#x9664;&#x96F6;&#x548C;&#x6D6E;&#x70B9;&#x5F02;&#x5E38;&#x7B49;&#x6240;&#x6709;&#x7684;&#x8FD0;&#x7B97;&#x9519;&#x8BEF;</li>
<li>SIGILL: &#x975E;&#x6CD5;&#x6307;&#x4EE4;, &#x53EF;&#x80FD;&#x662F;&#x7279;&#x6743;&#x6307;&#x4EE4;&#x6216;&#x6839;&#x672C;&#x4E0D;&#x662F;&#x6761;CPU&#x6307;&#x4EE4;</li>
<li>SIGSEGV: &#x8457;&#x540D;&#x7684;&#x6BB5;&#x9519;&#x8BEF;. &#x8BBF;&#x95EE;&#x975E;&#x6CD5;&#x6570;&#x636E;</li>
<li>SIGBUS: bus error. &#x53EF;&#x80FD;&#x662F;&#x8BBF;&#x95EE;&#x4E86;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x5730;&#x5740;, &#x6216;&#x5730;&#x5740;&#x4E0D;&#x5BF9;&#x9F50;</li>
<li>SIGABRT: &#x7A0B;&#x5E8F;&#x81EA;&#x5DF1;&#x8C03;&#x7528;&#x4E86;abort()</li>
<li>SIGTRAP: &#x65AD;&#x70B9;, &#x7528;&#x4E8E;debugger</li>
<li>SIGSYS: &#x975E;&#x6CD5;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;, &#x53EF;&#x80FD;&#x4E0D;&#x5B58;&#x5728;&#x8FD9;&#x4E2A;&#x8C03;&#x7528;&#x53F7;</li>
<li>SIGEMT: &#x865A;&#x62DF;&#x6307;&#x4EE4;&#x9519;&#x8BEF;?<h2 id="&#x7ED3;&#x675F;&#x7C7B;signal"><a name="&#x7ED3;&#x675F;&#x7C7B;signal" class="anchor-navigation-ex-anchor" href="#&#x7ED3;&#x675F;&#x7C7B;signal"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. &#x7ED3;&#x675F;&#x7C7B;signal</h2>
</li>
<li>SIGTERM: &#x793C;&#x8C8C;&#x7684;&#x8BA9;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;. &#x548C;SIGKILL&#x4E0D;&#x540C;, SIGTERM&#x53EF;&#x4EE5;&#x88AB;block, handle&#x548C;ignore.
&#x6CE8;: shell&#x4E0B;&#x7684;kill&#x547D;&#x4EE4;&#x9ED8;&#x8BA4;&#x662F;&#x53D1;SIGTERM&#x4FE1;&#x53F7;</li>
<li>SIGINT: ctrl+C, &#x7528;&#x6237;&#x4E2D;&#x65AD;&#x7A0B;&#x5E8F;&#x7684;&#x6267;&#x884C;</li>
<li>SIGQUIT: ctrl+\, &#x4F1A;&#x751F;&#x6210;coredump. &#x63A8;&#x8350;&#x6536;&#x5230;&#x8FD9;&#x4E2A;&#x4FE1;&#x53F7;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x6E05;&#x7406;&#x73B0;&#x573A;, &#x4EE5;&#x4FBF;&#x5B9A;&#x4F4D;.</li>
<li>SIGKILL: &#x9A6C;&#x4E0A;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;. &#x4E0D;&#x80FD;&#x88AB;&#x5904;&#x7406;&#x6216;&#x5FFD;&#x7565;, &#x4E5F;&#x4E0D;&#x4F1A;&#x963B;&#x585E;</li>
<li>SIGHUP: &#x4E00;&#x822C;&#x8868;&#x793A;&#x7528;&#x6237;&#x4E2D;&#x65AD;&#x4E86;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;<h2 id="&#x5B9A;&#x65F6;&#x7C7B;signal"><a name="&#x5B9A;&#x65F6;&#x7C7B;signal" class="anchor-navigation-ex-anchor" href="#&#x5B9A;&#x65F6;&#x7C7B;signal"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. &#x5B9A;&#x65F6;&#x7C7B;signal</h2>
</li>
<li>SIGALRM: &#x5B9A;&#x65F6;&#x5668;&#x65F6;&#x95F4;&#x5230;. &#x6BD4;&#x5982;alarm</li>
<li>SIGVTALRM: &#x865A;&#x62DF;&#x5B9A;&#x65F6;&#x5668;</li>
<li>SIGPROF: &#x6027;&#x80FD;&#x5206;&#x6790;<h2 id="&#x5F02;&#x6B65;signal-&#x9ED8;&#x8BA4;&#x5FFD;&#x7565;"><a name="&#x5F02;&#x6B65;signal-&#x9ED8;&#x8BA4;&#x5FFD;&#x7565;" class="anchor-navigation-ex-anchor" href="#&#x5F02;&#x6B65;signal-&#x9ED8;&#x8BA4;&#x5FFD;&#x7565;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4. &#x5F02;&#x6B65;signal, &#x9ED8;&#x8BA4;&#x5FFD;&#x7565;</h2>
</li>
<li>SIGIO: &#x5F02;&#x6B65;io, &#x9700;&#x8981;&#x5148;&#x7528;fcntl()&#x6765;&#x4F7F;&#x80FD;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;</li>
<li>SIGURG: socket&#x7684;urgent&#x4E8B;&#x4EF6;</li>
<li>SIGPOLL: &#x7C7B;&#x4F3C;SIGIO<h2 id="&#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal"><a name="&#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal" class="anchor-navigation-ex-anchor" href="#&#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal"><i class="fa fa-link" aria-hidden="true"></i></a>2.5. &#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal</h2>
</li>
<li>SIGCHLD SIGCLD: &#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;&#x6216;&#x505C;&#x6B62;&#x65F6;&#x53D1;&#x9001;&#x7ED9;&#x7236;&#x8FDB;&#x7A0B;, &#x9ED8;&#x8BA4;&#x5FFD;&#x7565;</li>
<li>SIGSTOP: &#x505C;&#x6B62;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;. &#x6CE8;&#x610F;&#x4E0D;&#x662F;&#x7EC8;&#x6B62;. &#x4E0D;&#x80FD;&#x963B;&#x585E;, &#x5904;&#x7406;&#x548C;&#x5FFD;&#x7565;</li>
<li>SIGTSTP: crtl+Z, &#x4E0E;SIGSTOP&#x4E0D;&#x540C;&#x7684;&#x662F;, &#x5B83;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x6216;&#x5FFD;&#x7565;. </li>
<li>SIGTTIN: &#x5904;&#x4E8E;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#x7684;&#x7A0B;&#x5E8F;&#x8BD5;&#x56FE;&#x4ECE;terminal&#x83B7;&#x53D6;&#x8F93;&#x5165;, &#x9ED8;&#x8BA4;&#x505C;&#x6B62;&#x8FDB;&#x7A0B;.<h2 id="&#x64CD;&#x4F5C;error-signal-&#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;"><a name="&#x64CD;&#x4F5C;error-signal-&#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#&#x64CD;&#x4F5C;error-signal-&#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.6. &#x64CD;&#x4F5C;error signal, &#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;</h2>
</li>
<li>SIGPIPE: &#x7BA1;&#x9053;error. &#x6BD4;&#x5982;&#x5728;&#x8BFB;open&#x4E4B;&#x524D;&#x5199;pipe, &#x6216;&#x5728;connect&#x4E4B;&#x524D;&#x5199;socket</li>
<li>SIGLOST: &#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#x610F;&#x5916;&#x7EC8;&#x6B62;</li>
<li>SIGXCPU: &#x8FDB;&#x7A0B;&#x8D85;&#x51FA;&#x8D44;&#x6E90;&#x9650;&#x5236;. &#x89C1;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;</li>
<li>SIGXFSZ: &#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x8D85;&#x51FA;&#x9650;&#x5236;<h2 id="&#x5176;&#x4ED6;signal"><a name="&#x5176;&#x4ED6;signal" class="anchor-navigation-ex-anchor" href="#&#x5176;&#x4ED6;signal"><i class="fa fa-link" aria-hidden="true"></i></a>2.7. &#x5176;&#x4ED6;signal</h2>
</li>
<li>SIGUSR1 SIGUSR2: &#x5E38;&#x7528;&#x4E8E;&#x7B80;&#x5355;&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;, &#x9ED8;&#x8BA4;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;</li>
<li>SIGWINCH: &#x7A97;&#x53E3;&#x5927;&#x5C0F;&#x6539;&#x53D8;. &#x9ED8;&#x8BA4;ignore</li>
<li>SIGINFO: ??<h2 id="&#x6253;&#x5370;signal&#x7C7B;&#x578B;"><a name="&#x6253;&#x5370;signal&#x7C7B;&#x578B;" class="anchor-navigation-ex-anchor" href="#&#x6253;&#x5370;signal&#x7C7B;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.8. &#x6253;&#x5370;signal&#x7C7B;&#x578B;</h2>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token keyword">char</span> <span class="token operator">*</span> <span class="token function">strsignal</span> <span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token keyword">void</span> <span class="token function">psignal</span> <span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>message<span class="token punctuation">)</span>
</code></pre>
</li>
</ul>
<h2 id="signal&#x5904;&#x7406;"><a name="signal&#x5904;&#x7406;" class="anchor-navigation-ex-anchor" href="#signal&#x5904;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>2.9. signal&#x5904;&#x7406;</h2>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token comment">//sighandler_t</span>
<span class="token keyword">void</span> <span class="token function">handler</span> <span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token comment">/*&#x6CE8;&#x518C;handler, action&#x53EF;&#x4EE5;&#x662F;&#x4E2A;handler&#x51FD;&#x6570;, &#x4E5F;&#x53EF;&#x4EE5;&#x662F;SIG_DFL, SIG_IGN
**&#x6CE8;&#x610F;&#x4E0D;&#x540C;&#x7684;&#x7CFB;&#x7EDF;&#x6709;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;: BSD&#x6A21;&#x5F0F;, SVID&#x6A21;&#x5F0F;
**SVID&#x7CFB;&#x7EDF;&#x4E0B;&#x9762;, handler&#x53EA;&#x8FD0;&#x884C;&#x4E00;&#x6B21;, &#x7136;&#x540E;handler&#x4F1A;&#x88AB;deinstall
**BSD&#x7CFB;&#x7EDF;&#x4E0B;&#x9762;, handler&#x4E00;&#x76F4;&#x6709;&#x6548;
**GNU&#x7684;libc&#x662F;BSD&#x6A21;&#x5F0F;
*/</span>
<span class="token class-name">sighandler_t</span> <span class="token function">signal</span> <span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">,</span> sighandler t action<span class="token punctuation">)</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x5982;&#x679C;&#x9ED8;&#x8BA4;&#x662F;ignore, &#x5219;&#x4E0D;&#x6539;&#x53D8;&#x5B83;&#x7684;&#x884C;&#x4E3A;</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token keyword">void</span>
<span class="token function">termination_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">temp_file</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> temp_file_list<span class="token punctuation">;</span> p<span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span>
        <span class="token function">unlink</span><span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> termination_handler<span class="token punctuation">)</span> <span class="token operator">==</span> SIG_IGN<span class="token punctuation">)</span>
        <span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> SIG_IGN<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">signal</span><span class="token punctuation">(</span>SIGHUP<span class="token punctuation">,</span> termination_handler<span class="token punctuation">)</span> <span class="token operator">==</span> SIG_IGN<span class="token punctuation">)</span>
        <span class="token function">signal</span><span class="token punctuation">(</span>SIGHUP<span class="token punctuation">,</span> SIG_IGN<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">signal</span><span class="token punctuation">(</span>SIGTERM<span class="token punctuation">,</span> termination_handler<span class="token punctuation">)</span> <span class="token operator">==</span> SIG_IGN<span class="token punctuation">)</span>
        <span class="token function">signal</span><span class="token punctuation">(</span>SIGTERM<span class="token punctuation">,</span> SIG_IGN<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="sigaction"><a name="sigaction" class="anchor-navigation-ex-anchor" href="#sigaction"><i class="fa fa-link" aria-hidden="true"></i></a>2.10. sigaction</h2>
<pre class="language-"><code class="lang-c"><span class="token keyword">struct</span> <span class="token class-name">sigaction</span>
    <span class="token class-name">sighandler_t</span> sa_handler
    <span class="token class-name">sigset_t</span> sa_mask <span class="token comment">//&#x5F53;sa_handler&#x6267;&#x884C;&#x65F6;, &#x9700;&#x8981;&#x963B;&#x585E;&#x7684;signal set</span>
    <span class="token keyword">int</span> sa_flags
<span class="token comment">//&#x63A8;&#x8350;&#x7528;sigaction, action&#x4E3A;NULL&#x8868;&#x793A;&#x67E5;&#x8BE2;</span>
<span class="token keyword">int</span> <span class="token function">sigaction</span> <span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> <span class="token operator">*</span>restrict action<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> <span class="token operator">*</span>restrict old<span class="token operator">-</span>action<span class="token punctuation">)</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;:</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token keyword">void</span>
<span class="token function">termination_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">temp_file</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> temp_file_list<span class="token punctuation">;</span> p<span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span>
        <span class="token function">unlink</span><span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> new_action<span class="token punctuation">,</span> old_action<span class="token punctuation">;</span>
    <span class="token comment">/* Set up the structure to specify the new action. */</span>
    new_action<span class="token punctuation">.</span>sa_handler <span class="token operator">=</span> termination_handler<span class="token punctuation">;</span>
    <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>new_action<span class="token punctuation">.</span>sa_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    new_action<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>old_action<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>old_action<span class="token punctuation">.</span>sa_handler <span class="token operator">!=</span> SIG_IGN<span class="token punctuation">)</span>
        <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>new_action<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGHUP<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>old_action<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>old_action<span class="token punctuation">.</span>sa_handler <span class="token operator">!=</span> SIG_IGN<span class="token punctuation">)</span>
        <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGHUP<span class="token punctuation">,</span> <span class="token operator">&amp;</span>new_action<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGTERM<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>old_action<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>old_action<span class="token punctuation">.</span>sa_handler <span class="token operator">!=</span> SIG_IGN<span class="token punctuation">)</span>
        <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGTERM<span class="token punctuation">,</span> <span class="token operator">&amp;</span>new_action<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="signal&#x7684;flag"><a name="signal&#x7684;flag" class="anchor-navigation-ex-anchor" href="#signal&#x7684;flag"><i class="fa fa-link" aria-hidden="true"></i></a>2.11. signal&#x7684;flag</h2>
<ul>
<li>SA_NOCLDSTOP: &#x53EA;&#x5BF9;SIGCHLD&#x6709;&#x6548;. &#x53EA;&#x62A5;&#x544A;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;</li>
<li>SA_ONSTACK: &#x4E0D;&#x4F7F;&#x7528;signal&#x6808;.</li>
<li>SA_RESTART: &#x88AB;signal&#x6253;&#x65AD;&#x7684;&#x5E93;&#x51FD;&#x6570;&#x4F1A;resume, &#x5426;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x5931;&#x8D25;, &#x6B64;&#x65F6;error&#x662F;EINTR.<h2 id="signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;"><a name="signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;" class="anchor-navigation-ex-anchor" href="#signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;"><i class="fa fa-link" aria-hidden="true"></i></a>2.12. signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;</h2>
&#x4E00;&#x822C;&#x90FD;&#x662F;&#x4ECE;&#x7236;&#x8FDB;&#x7A0B;&#x7EE7;&#x627F;&#x7684;, &#x4F46;&#x5982;&#x679C;&#x5B50;&#x8FDB;&#x7A0B;&#x7528;exec*&#x6765;&#x6267;&#x884C;&#x5176;&#x4ED6;&#x7A0B;&#x5E8F;, &#x5219;signal&#x4F1A;&#x88AB;&#x521D;&#x59CB;&#x5316;&#x4E3A;&#x9ED8;&#x8BA4;&#x72B6;&#x6001;.
&#x4E3E;&#x4F8B;: &#x5728;signal&#x4E0D;&#x662F;&#x88AB;ignore&#x7684;&#x65F6;&#x5019;&#x624D;&#x7528;sigaction.
&#x662F;&#x5426;&#x56E0;&#x4E3A;&#x4E00;&#x65E6;signal&#x88AB;ignore&#x8FC7;, &#x90A3;&#x4E48;&#x5373;&#x4F7F;&#x91CD;&#x65B0;&#x8C03;&#x7528;sigaction&#x4E5F;&#x4E0D;&#x4F1A;&#x751F;&#x6548;?--&#x7ECF;&#x8FC7;&#x9A8C;&#x8BC1;, &#x4E0D;&#x662F;<pre class="language-"><code class="lang-c"><span class="token keyword">struct</span> <span class="token class-name">sigaction</span> temp<span class="token punctuation">;</span>
<span class="token function">sigaction</span> <span class="token punctuation">(</span>SIGHUP<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>temp<span class="token punctuation">.</span>sa_handler <span class="token operator">!=</span> SIG_IGN<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
temp<span class="token punctuation">.</span>sa_handler <span class="token operator">=</span> handle_sighup<span class="token punctuation">;</span>
<span class="token function">sigemptyset</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>temp<span class="token punctuation">.</span>sa_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sigaction</span> <span class="token punctuation">(</span>SIGHUP<span class="token punctuation">,</span> <span class="token operator">&amp;</span>temp<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
</ul>
<h2 id="signal&#x5904;&#x7406;&#x51FD;&#x6570;"><a name="signal&#x5904;&#x7406;&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#signal&#x5904;&#x7406;&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>2.13. signal&#x5904;&#x7406;&#x51FD;&#x6570;</h2>
<ul>
<li>handler&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x5168;&#x5C40;&#x53D8;&#x91CF;, &#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x5E94;&#x8BE5;&#x662F;sig_atomic_t &#x7C7B;&#x578B;</li>
<li>handler&#x53EF;&#x4EE5;return</li>
<li>handler&#x53EF;&#x4EE5;&#x7EC8;&#x6B62;&#x7A0B;&#x5E8F;</li>
<li><p>handler&#x53EF;&#x4EE5;&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;
&#x4E3E;&#x4F8B;: return&#x7684;&#x60C5;&#x51B5;</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token comment">/* This flag controls termination of the main loop. */</span>
<span class="token keyword">volatile</span> <span class="token class-name">sig_atomic_t</span> keep_going <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">/* The signal handler just clears the flag and re-enables itself. */</span>
<span class="token keyword">void</span>
<span class="token function">catch_alarm</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 keep_going <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token function">signal</span><span class="token punctuation">(</span>sig<span class="token punctuation">,</span> catch_alarm<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span>
<span class="token function">do_stuff</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;Doing stuff while waiting for alarm....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token comment">/* Establish a handler for SIGALRM signals. */</span>
 <span class="token function">signal</span><span class="token punctuation">(</span>SIGALRM<span class="token punctuation">,</span> catch_alarm<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">/* Set an alarm to go off in a little while. */</span>
 <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">/* Check the flag once in a while to see when to quit. */</span>
 <span class="token keyword">while</span> <span class="token punctuation">(</span>keep_going<span class="token punctuation">)</span>
     <span class="token function">do_stuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">return</span> EXIT_SUCCESS<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x7EC8;&#x6B62;&#x7684;&#x60C5;&#x51B5;</p>
<pre class="language-"><code class="lang-c"><span class="token keyword">volatile</span> <span class="token class-name">sig_atomic_t</span> fatal_error_in_progress <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>
<span class="token function">fatal_error_signal</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token comment">/* Since this handler is established for more than one kind of signal,
 it might still get invoked recursively by delivery of some other kind
 of signal. Use a static variable to keep track of that. */</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>fatal_error_in_progress<span class="token punctuation">)</span>
     <span class="token function">raise</span><span class="token punctuation">(</span>sig<span class="token punctuation">)</span><span class="token punctuation">;</span>

 fatal_error_in_progress <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
 <span class="token comment">/* Now do the clean up actions:
 - reset terminal modes
 - kill child processes
 - remove lock files */</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token comment">/* Now reraise the signal. We reactivate the signal&#x2019;s
 default handling, which is to terminate the process.
 We could just call exit or abort,
 but reraising the signal sets the return status
 from the process correctly. */</span>
 <span class="token function">signal</span><span class="token punctuation">(</span>sig<span class="token punctuation">,</span> SIG_DFL<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">raise</span><span class="token punctuation">(</span>sig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;&#x7684;&#x60C5;&#x51B5;. 
&#x6CE8;&#x610F;&#x7531;&#x4E8E;&#x4E00;&#x4E9B;&#x91CD;&#x8981;&#x7684;&#x7ED3;&#x6784;&#x4F53;&#x6216;&#x53D8;&#x91CF;&#x53EF;&#x80FD;&#x8FD8;&#x6CA1;&#x6709;&#x4FEE;&#x6539;&#x5B8C;&#x6BD5;&#x5C31;&#x88AB;signal&#x6253;&#x65AD;, &#x6B64;&#x65F6;&#x5982;&#x679C;&#x8FDB;&#x884C;&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;&#x7684;&#x8BDD;, &#x90A3;&#x4E9B;&#x91CD;&#x8981;&#x7ED3;&#x6784;&#x53EF;&#x80FD;&#x4E0D;&#x5B8C;&#x6574;, &#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x6709;&#x4E24;&#x79CD;&#x529E;&#x6CD5;&#x53EF;&#x4EE5;&#x907F;&#x514D;:</p>
</li>
<li>&#x4E3B;&#x7A0B;&#x5E8F;&#x4FEE;&#x6539;&#x91CD;&#x8981;&#x53D8;&#x91CF;&#x65F6;&#x963B;&#x585E;signal</li>
<li><p>&#x5728;signal handler&#x91CC;&#x9762;&#x91CD;&#x65B0;&#x521D;&#x59CB;&#x5316;&#x8FD9;&#x4E9B;&#x91CD;&#x8981;&#x53D8;&#x91CF;</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;setjmp.h&gt;</span></span>
jmp_buf return_to_top_level<span class="token punctuation">;</span>
<span class="token keyword">volatile</span> <span class="token class-name">sig_atomic_t</span> waiting_for_input<span class="token punctuation">;</span>
<span class="token keyword">void</span>
<span class="token function">handle_sigint</span><span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token comment">/* We may have been waiting for input when the signal arrived,
 but we are no longer waiting once we transfer control. */</span>
 waiting_for_input <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token function">longjmp</span><span class="token punctuation">(</span>return_to_top_level<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> sigint_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

 <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">prepare_for_command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">setjmp</span><span class="token punctuation">(</span>return_to_top_level<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
         <span class="token function">read_and_execute_command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/* Imagine this is a subroutine used by various commands. */</span>
<span class="token keyword">char</span> <span class="token operator">*</span>
<span class="token function">read_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>input_from_terminal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     waiting_for_input <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
     waiting_for_input <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
</ul>
<h2 id="signal-handler&#x88AB;&#x6253;&#x65AD;"><a name="signal-handler&#x88AB;&#x6253;&#x65AD;" class="anchor-navigation-ex-anchor" href="#signal-handler&#x88AB;&#x6253;&#x65AD;"><i class="fa fa-link" aria-hidden="true"></i></a>2.14. signal handler&#x88AB;&#x6253;&#x65AD;?</h2>
<p>&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;handler&#x4F1A;&#x81EA;&#x52A8;block&#x5B83;&#x7684;signum, &#x4F46;&#x662F;&#x5176;&#x4ED6;&#x79CD;&#x7C7B;&#x7684;signal&#x4F9D;&#x7136;&#x53EF;&#x4EE5;&#x6253;&#x65AD;&#x5F53;&#x524D;&#x7684;handler.
&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;sigaction&#x6709;&#x4E2A;sa_mask&#x7684;&#x539F;&#x56E0;, &#x88AB;mask&#x7684;signal&#x4F1A;&#x88AB;&#x963B;&#x585E;.
sigprocmask&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x4E34;&#x65F6;&#x6539;&#x53D8;&#x8FD9;&#x4E2A;mask, &#x4F46;&#x53EA;&#x5728;handler&#x91CC;&#x9762;&#x751F;&#x6548;. &#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;handler return&#x4EE5;&#x540E;, mask&#x4F1A;&#x6062;&#x590D;.</p>
<h2 id="signal&#x5408;&#x5E76;"><a name="signal&#x5408;&#x5E76;" class="anchor-navigation-ex-anchor" href="#signal&#x5408;&#x5E76;"><i class="fa fa-link" aria-hidden="true"></i></a>2.15. signal&#x5408;&#x5E76;</h2>
<p>&#x540C;&#x7C7B;signal&#x5728;&#x6CA1;&#x5904;&#x7406;&#x4E4B;&#x524D;&#x4F1A;&#x88AB;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;, &#x6240;&#x4EE5;&#x5BF9;signal&#x7684;&#x8BA1;&#x6570;&#x662F;&#x4E0D;&#x51C6;&#x7684;. &#x5C24;&#x5176;&#x6CE8;&#x610F;&#x5BF9;SIGCHLD&#x662F;&#x5982;&#x6B64;.
&#x4E3E;&#x4F8B;: </p>
<pre class="language-"><code class="lang-c"><span class="token keyword">struct</span> <span class="token class-name">process</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">process</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
    <span class="token comment">/* The process ID of this child. */</span>
    <span class="token keyword">int</span> pid<span class="token punctuation">;</span>
    <span class="token comment">/* The descriptor of the pipe or pseudo terminal
    on which output comes from this child. */</span>
    <span class="token keyword">int</span> input_descriptor<span class="token punctuation">;</span>
    <span class="token comment">/* Nonzero if this process has stopped or terminated. */</span>
    <span class="token class-name">sig_atomic_t</span> have_status<span class="token punctuation">;</span>
    <span class="token comment">/* The status of this child; 0 if running,
    otherwise a status value from waitpid. */</span>
    <span class="token keyword">int</span> status<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">process</span> <span class="token operator">*</span>process_list<span class="token punctuation">;</span>
<span class="token comment">//This example also uses a flag to indicate whether signals have arrived since some time</span>
<span class="token comment">//in the past&#x2014;whenever the program last cleared it to zero.</span>
<span class="token comment">/* Nonzero means some child&#x2019;s status has changed
so look at process_list for the details. */</span>
<span class="token keyword">int</span> process_status_change<span class="token punctuation">;</span>
Here is the handler itself<span class="token operator">:</span>
<span class="token keyword">void</span>
<span class="token function">sigchld_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> signo<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> old_errno <span class="token operator">=</span> errno<span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">register</span> <span class="token keyword">int</span> pid<span class="token punctuation">;</span>
        <span class="token keyword">int</span> w<span class="token punctuation">;</span>
        <span class="token keyword">struct</span> <span class="token class-name">process</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>

        <span class="token comment">/* Keep asking for a status until we get a definitive result. */</span>
        <span class="token keyword">do</span> <span class="token punctuation">{</span>
            errno <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            pid <span class="token operator">=</span> <span class="token function">waitpid</span><span class="token punctuation">(</span>WAIT_ANY<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w<span class="token punctuation">,</span> WNOHANG <span class="token operator">|</span> WUNTRACED<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>pid <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> errno <span class="token operator">==</span> EINTR<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/* A real failure means there are no more
            stopped or terminated child processes, so return. */</span>
            errno <span class="token operator">=</span> old_errno<span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/* Find the process that signaled us, and record its status. */</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> process_list<span class="token punctuation">;</span> p<span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>pid <span class="token operator">==</span> pid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                p<span class="token operator">-&gt;</span>status <span class="token operator">=</span> w<span class="token punctuation">;</span>
                <span class="token comment">/* Indicate that the status field
                has data to look at. We do this only after storing it. */</span>
                p<span class="token operator">-&gt;</span>have_status <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

                <span class="token comment">/* If process has terminated, stop waiting for its output. */</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">WIFSIGNALED</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">WIFEXITED</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>input_descriptor<span class="token punctuation">)</span>
                        <span class="token function">FD_CLR</span><span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>input_descriptor<span class="token punctuation">,</span> <span class="token operator">&amp;</span>input_wait_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">/* The program should check this flag from time to time
                to see if there is any news in process_list. */</span>
                <span class="token operator">++</span>process_status_change<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token comment">/* Loop around to handle all the processes
        that have something to tell us. */</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//Here is the proper way to check the flag process_status_change:</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process_status_change<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">process</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>
    process_status_change <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> process_list<span class="token punctuation">;</span> p<span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>have_status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> Examine p<span class="token operator">-&gt;</span>status <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x4E3B;&#x7A0B;&#x5E8F;&#x600E;&#x4E48;&#x77E5;&#x9053;handler&#x8C03;&#x7528;&#x8FC7;&#x5462;? &#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x662F;&#x6709;&#x4E2A;&#x53D8;&#x91CF;, &#x53EA;&#x5728;handler&#x91CC;&#x9762;&#x6539;. &#x4E3B;&#x7A0B;&#x5E8F;&#x67E5;&#x8BE2;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;</p>
<pre class="language-"><code class="lang-c"><span class="token class-name">sig_atomic_t</span> process_status_change<span class="token punctuation">;</span>
<span class="token class-name">sig_atomic_t</span> last_process_status_change<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">{</span>
    <span class="token class-name">sig_atomic_t</span> prev <span class="token operator">=</span> last_process_status_change<span class="token punctuation">;</span>
    last_process_status_change <span class="token operator">=</span> process_status_change<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>last_process_status_change <span class="token operator">!=</span> prev<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">struct</span> <span class="token class-name">process</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> process_list<span class="token punctuation">;</span> p<span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>have_status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> Examine p<span class="token operator">-&gt;</span>status <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;"><a name="signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;" class="anchor-navigation-ex-anchor" href="#signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;"><i class="fa fa-link" aria-hidden="true"></i></a>2.16. signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;</h2>
<p>&#x65F6;&#x523B;&#x8BB0;&#x4F4F;handler&#x7684;&#x5904;&#x7406;&#x662F;&#x5F02;&#x6B65;&#x7684;, &#x53EF;&#x80FD;&#x5728;&#x4EFB;&#x4F55;&#x65F6;&#x95F4;&#x70B9;&#x6253;&#x65AD;&#x4E3B;&#x7A0B;&#x5E8F;, &#x5305;&#x62EC;&#x5173;&#x952E;&#x6570;&#x636E;&#x6B63;&#x5728;&#x6539;&#x5199;&#x8FC7;&#x7A0B;&#x4E2D;, &#x6216;&#x4E0D;&#x53EF;&#x91CD;&#x5165;&#x7684;&#x51FD;&#x6570;&#x6B63;&#x5728;&#x6267;&#x884C;&#x4E2D;&#x7B49;&#x7B49;, &#x751A;&#x81F3;&#x4E00;&#x4E2A;&#x6574;&#x5F62;&#x53D8;&#x91CF;&#x6B63;&#x5728;&#x88AB;&#x8D4B;&#x503C;.
&#x6700;&#x597D;&#x7684;&#x60C5;&#x51B5;&#x4E0B;, handler&#x53EA;&#x662F;&#x5BF9;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x8D4B;&#x503C;, &#x771F;&#x6B63;&#x7684;&#x4E8B;&#x60C5;, &#x9700;&#x8981;&#x7B49;&#x5230;&#x4E3B;&#x7A0B;&#x5E8F;&#x68C0;&#x6D4B;&#x5230;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x53D8;&#x5316;&#x4EE5;&#x540E;&#x518D;&#x5904;&#x7406;.
&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;, &#x4E00;&#x4E2A;&#x4E0D;&#x53EF;&#x91CD;&#x5165;&#x7684;&#x51FD;&#x6570;, &#x4E5F;&#x4E0D;&#x662F;&#x4E00;&#x5B9A;&#x4E0D;&#x80FD;&#x5728;handler&#x91CC;&#x9762;&#x4F7F;&#x7528;, &#x8981;&#x4F7F;&#x7528;&#x5B83;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x4E00;&#x4E2A;&#x524D;&#x63D0;:
&#x4FDD;&#x8BC1;&#x4E3B;&#x7A0B;&#x5E8F;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x4F1A;&#x88AB;handler&#x6253;&#x65AD;, &#x600E;&#x4E48;&#x4FDD;&#x8BC1;&#x5462;?</p>
<ul>
<li>&#x4E3B;&#x7A0B;&#x5E8F;&#x6839;&#x672C;&#x4E0D;&#x4F1A;&#x8C03;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;, &#x6216;&#x7C7B;&#x4F3C;&#x7684;&#x51FD;&#x6570;</li>
<li>&#x4E3B;&#x7A0B;&#x5E8F;&#x8C03;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x65F6;&#x663E;&#x5F0F;&#x963B;&#x585E;&#x5F71;&#x54CD;&#x5B83;&#x7684;signal
&#x4E0B;&#x9762;&#x662F;handler&#x7684;&#x4E00;&#x4E9B;&#x57FA;&#x672C;&#x539F;&#x5219;:</li>
<li>handler&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x6210;volatile, &#x548C;sig_atomic_t(&#x5176;&#x5B9E;&#x5C31;&#x662F;int, &#x56E0;&#x4E3A;int&#x7684;&#x8BFB;&#x5199;&#x662F;&#x539F;&#x5B50;&#x7684;)?</li>
<li>&#x6BD4;&#x5982;gethostbyname&#x8FD9;&#x4E2A;&#x51FD;&#x6570;, &#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x53D8;&#x91CF;, &#x8FD9;&#x9759;&#x6001;&#x53D8;&#x91CF;&#x53EF;&#x80FD;&#x4E0B;&#x6B21;&#x8C03;&#x7528;gethostbyname&#x5C31;&#x53D8;&#x4E86;.
&#x6B64;&#x65F6;&#x5047;&#x8BBE;&#x4E3B;&#x7A0B;&#x5E8F;&#x6B63;&#x5728;&#x8C03;&#x7528;gethostbyname&#x8FD8;&#x6CA1;&#x8FD4;&#x56DE;, &#x88AB;signal&#x6253;&#x65AD;&#x4E86;, handler&#x91CC;&#x9762;&#x4E5F;&#x8C03;&#x4E86;gethostbyname, &#x90A3;&#x4E48;&#x4E3B;&#x7A0B;&#x5E8F;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5C31;&#x4E0D;&#x5BF9;&#x4E86;.</li>
<li>&#x6BD4;&#x5982;printf, &#x5176;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;, &#x5728;&#x4E3B;&#x7A0B;&#x5E8F;&#x548C;handler&#x91CC;&#x9762;&#x540C;&#x65F6;&#x8C03;&#x7528;&#x4F1A;&#x4E92;&#x76F8;&#x5E72;&#x6270;.</li>
<li>malloc&#x548C;free&#x4E5F;&#x4E0D;&#x53EF;&#x91CD;&#x5165;, &#x5728;handler&#x4F7F;&#x7528;&#x7684;&#x5185;&#x5B58;&#x53EF;&#x4EE5;&#x9884;&#x5148;&#x5728;&#x4E3B;&#x7A0B;&#x5E8F;&#x7533;&#x8BF7;&#x597D;.</li>
<li><p>errno&#x4E5F;&#x4E0D;&#x53EF;&#x91CD;&#x5165;, &#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x5728;handler&#x5F00;&#x59CB;&#x5148;&#x4FDD;&#x5B58;errno, &#x6700;&#x540E;&#x6062;&#x590D;&#x5B83;.
&#x5176;&#x5B9E;&#x8FD9;&#x62DB;&#x4E5F;&#x5F88;&#x901A;&#x7528;, &#x5982;&#x679C;&#x4E3B;&#x7A0B;&#x5E8F;&#x548C;handler&#x8981;&#x4FEE;&#x6539;&#x540C;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;, &#x5728;handler&#x91CC;&#x9762;&#x5148;&#x4FDD;&#x5B58;&#x518D;&#x6062;&#x590D;.
&#x9519;&#x8BEF;&#x4E3E;&#x4F8B;: &#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x91CC;&#x9762;, &#x4E3B;&#x7A0B;&#x5E8F;&#x4E0D;&#x65AD;&#x7684;&#x7ED9;memory&#x8D4B;&#x503C;, handler&#x91CC;&#x9762;&#x53EF;&#x80FD;&#x4F1A;&#x6253;&#x51FA;0,1&#x6216;1,0.</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">volatile</span> <span class="token keyword">struct</span> <span class="token class-name">two_words</span> <span class="token punctuation">{</span>
 <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span> memory<span class="token punctuation">;</span>
<span class="token keyword">void</span>
<span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">//printf is safe here because main not use it</span>
 <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d,%d\n&quot;</span><span class="token punctuation">,</span> memory<span class="token punctuation">.</span>a<span class="token punctuation">,</span> memory<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">two_words</span> zeros <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> ones <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
 <span class="token function">signal</span><span class="token punctuation">(</span>SIGALRM<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
 memory <span class="token operator">=</span> zeros<span class="token punctuation">;</span>
 <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     memory <span class="token operator">=</span> zeros<span class="token punctuation">;</span>
     memory <span class="token operator">=</span> ones<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
</ul>
<h2 id="&#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;"><a name="&#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;" class="anchor-navigation-ex-anchor" href="#&#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;"><i class="fa fa-link" aria-hidden="true"></i></a>2.17. &#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;?</h2>
<ul>
<li>&#x5E93;&#x51FD;&#x6570;&#x8FD4;&#x56DE;EINTR&#x8868;&#x793A;&#x88AB;&#x6253;&#x65AD;, &#x53EF;&#x4EE5;&#x7528;sigaction&#x7684;SA_RESTART&#x6765;&#x8BBE;&#x7F6E;&#x81EA;&#x52A8;&#x91CD;&#x8BD5;.
&#x4E5F;&#x53EF;&#x4EE5;TEMP_FAILURE_RETRY (expression)&#x91CD;&#x8BD5;</li>
<li>read&#x548C;write&#x4E0D;&#x53D7;SA_RESTART&#x63A7;&#x5236;, &#x56E0;&#x4E3A;&#x53EF;&#x80FD;&#x6709;&#x90E8;&#x5206;&#x7684;&#x6570;&#x636E;&#x5DF2;&#x7ECF;&#x4F20;&#x9001;&#x5B8C;&#x6BD5;&#x4E86;. 
&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x901A;&#x8FC7;&#x8FD4;&#x56DE;&#x503C;&#x6765;&#x8868;&#x793A;&#x5DF2;&#x7ECF;&#x4F20;&#x9001;&#x7684;&#x5B57;&#x8282;&#x6570;, &#x8868;&#x793A;&quot;&#x90E8;&#x5206;&#x6210;&#x529F;&quot;<h2 id="&#x89E6;&#x53D1;signal"><a name="&#x89E6;&#x53D1;signal" class="anchor-navigation-ex-anchor" href="#&#x89E6;&#x53D1;signal"><i class="fa fa-link" aria-hidden="true"></i></a>2.18. &#x89E6;&#x53D1;signal</h2>
<pre class="language-"><code class="lang-c"><span class="token comment">//&#x5411;&#x81EA;&#x5DF1;&#x53D1;signal</span>
<span class="token keyword">int</span> <span class="token function">raise</span> <span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">)</span>
</code></pre>
&#x5178;&#x578B;&#x7684;&#x5E94;&#x7528;&#x662F;&#x5728;handler&#x91CC;&#x9762;&#x518D;&#x6B21;&#x89E6;&#x53D1;signal:<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token comment">/* When a stop signal arrives, set the action back to the default
and then resend the signal after doing cleanup actions. */</span>
<span class="token keyword">void</span>
<span class="token function">tstp_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token function">signal</span><span class="token punctuation">(</span>SIGTSTP<span class="token punctuation">,</span> SIG_DFL<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">/* Do cleanup actions here. */</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token function">raise</span><span class="token punctuation">(</span>SIGTSTP<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* When the process is continued again, restore the signal handler. */</span>
<span class="token keyword">void</span>
<span class="token function">cont_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token function">signal</span><span class="token punctuation">(</span>SIGCONT<span class="token punctuation">,</span> cont_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">signal</span><span class="token punctuation">(</span>SIGTSTP<span class="token punctuation">,</span> tstp_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* Enable both handlers during program initialization. */</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token function">signal</span><span class="token punctuation">(</span>SIGCONT<span class="token punctuation">,</span> cont_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">signal</span><span class="token punctuation">(</span>SIGTSTP<span class="token punctuation">,</span> tstp_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
</ul>
<h2 id="&#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal"><a name="&#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal" class="anchor-navigation-ex-anchor" href="#&#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal"><i class="fa fa-link" aria-hidden="true"></i></a>2.19. &#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal</h2>
<pre class="language-"><code class="lang-c"><span class="token comment">/* pid &gt; 0         &#x6B63;&#x5E38;&#x7684;pid
** pid == 0       &#x540C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7EC4;&#x7684;&#x6240;&#x6709;&#x8FDB;&#x7A0B;
** pid &lt; -1        -pid&#x7684;&#x8FDB;&#x7A0B;&#x7EC4;
** pid == -1      &#x5411;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#x53D1;(root&#x6743;&#x9650;), &#x5411;&#x540C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x7684;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#x53D1;
** &#x4F7F;&#x7528;kill&#x6709;&#x6743;&#x9650;&#x8981;&#x6C42;, root&#x6216;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x7684;&#x8FDB;&#x7A0B;
*/</span>
<span class="token keyword">int</span> <span class="token function">kill</span> <span class="token punctuation">(</span>pid t pid<span class="token punctuation">,</span> <span class="token keyword">int</span> signum<span class="token punctuation">)</span>
</code></pre>
<h2 id="kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;"><a name="kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;" class="anchor-navigation-ex-anchor" href="#kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;"><i class="fa fa-link" aria-hidden="true"></i></a>2.20. kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;</h2>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token comment">/* When a SIGUSR1 signal arrives, set this variable. */</span>
<span class="token keyword">volatile</span> <span class="token class-name">sig_atomic_t</span> usr_interrupt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>
<span class="token function">synch_signal</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    usr_interrupt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* The child process executes this function. */</span>
<span class="token keyword">void</span>
<span class="token function">child_function</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">/* Perform initialization. */</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;I&apos;m herehistory! My pid is %d.\n&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* Let parent know you&#x2019;re done. */</span>
    <span class="token function">kill</span><span class="token punctuation">(</span><span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> SIGUSR1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* Continue with execution. */</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;Bye, now....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> usr_action<span class="token punctuation">;</span>
    <span class="token class-name">sigset_t</span> block_mask<span class="token punctuation">;</span>
    <span class="token class-name">pid_t</span> child_id<span class="token punctuation">;</span>
    <span class="token comment">/* Establish the signal handler. */</span>
    <span class="token function">sigfillset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>block_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    usr_action<span class="token punctuation">.</span>sa_handler <span class="token operator">=</span> synch_signal<span class="token punctuation">;</span>
    usr_action<span class="token punctuation">.</span>sa_mask <span class="token operator">=</span> block_mask<span class="token punctuation">;</span>
    usr_action<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGUSR1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>usr_action<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* Create the child process. */</span>
    child_id <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>child_id <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token function">child_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* Does not return. */</span>

    <span class="token comment">/* Busy wait for the child to send a signal. */</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>usr_interrupt<span class="token punctuation">)</span>
        <span class="token punctuation">;</span>

    <span class="token comment">/* Now continue execution. */</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;That&#x2019;s all, folks!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="signal&#x7684;&#x963B;&#x585E;"><a name="signal&#x7684;&#x963B;&#x585E;" class="anchor-navigation-ex-anchor" href="#signal&#x7684;&#x963B;&#x585E;"><i class="fa fa-link" aria-hidden="true"></i></a>2.21. signal&#x7684;&#x963B;&#x585E;</h2>
<ul>
<li>&#x7528;sigprocmask&#x53EF;&#x4EE5;&#x663E;&#x5F0F;&#x7684;&#x963B;&#x585E;signal, &#x7528;&#x4E8E;&#x4FDD;&#x62A4;&#x654F;&#x611F;&#x53D8;&#x91CF;</li>
<li><p>sigaction&#x7684;sa_mask&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x5728;&#x8FD0;&#x884C;handler&#x65F6;mask&#x6389;&#x76F8;&#x5E94;&#x7684;signal, &#x4F46;hander&#x5B8C;&#x6210;&#x540E;&#x4F1A;&#x6062;&#x590D;&#x539F;&#x6765;&#x7684;mask
&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x7528;&#x5230;sigset_t</p>
<pre class="language-"><code class="lang-c"><span class="token comment">//&#x521D;&#x59CB;&#x5316;&#x4E3A;&#x5168;0&#x7684;set</span>
<span class="token keyword">int</span> <span class="token function">sigemptyset</span> <span class="token punctuation">(</span>sigset t <span class="token operator">*</span>set<span class="token punctuation">)</span>
<span class="token comment">//&#x521D;&#x59CB;&#x5316;&#x4E3A;&#x5168;1&#x7684;set</span>
<span class="token keyword">int</span> <span class="token function">sigfillset</span> <span class="token punctuation">(</span>sigset t <span class="token operator">*</span>set<span class="token punctuation">)</span>
<span class="token comment">//&#x6DFB;&#x52A0;</span>
<span class="token keyword">int</span> <span class="token function">sigaddset</span> <span class="token punctuation">(</span>sigset t <span class="token operator">*</span>set<span class="token punctuation">,</span> <span class="token keyword">int</span> signum<span class="token punctuation">)</span>
<span class="token comment">//&#x5220;&#x9664;</span>
<span class="token keyword">int</span> <span class="token function">sigdelset</span> <span class="token punctuation">(</span>sigset t <span class="token operator">*</span>set<span class="token punctuation">,</span> <span class="token keyword">int</span> signum<span class="token punctuation">)</span>
<span class="token comment">//&#x5224;&#x65AD;</span>
<span class="token keyword">int</span> <span class="token function">sigismember</span> <span class="token punctuation">(</span><span class="token keyword">const</span> sigset t <span class="token operator">*</span>set<span class="token punctuation">,</span> <span class="token keyword">int</span> signum<span class="token punctuation">)</span>
<span class="token comment">//&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x91CC;, &#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;signal mask, &#x800C;sigprocmask&#x7684;&#x884C;&#x4E3A;&#x662F;&#x4E0D;&#x786E;&#x5B9A;&#x7684;. &#x6B64;&#x65F6;&#x8981;&#x7528;pthread_sigmask</span>
<span class="token keyword">int</span> <span class="token function">sigprocmask</span> <span class="token punctuation">(</span><span class="token keyword">int</span> how<span class="token punctuation">,</span> <span class="token keyword">const</span> sigset t <span class="token operator">*</span>restrict set<span class="token punctuation">,</span> sigset t <span class="token operator">*</span>restrict oldset<span class="token punctuation">)</span>
&#x4E3E;&#x4F8B;<span class="token operator">:</span> 
```c
<span class="token comment">/* This variable is set by the SIGALRM signal handler. */</span>
<span class="token keyword">volatile</span> <span class="token class-name">sig_atomic_t</span> flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token class-name">sigset_t</span> block_alarm<span class="token punctuation">;</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token comment">/* Initialize the signal mask. */</span>
 <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>block_alarm<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>block_alarm<span class="token punctuation">,</span> SIGALRM<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">/* Check if a signal has arrived; if so, reset the flag. */</span>
     <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>block_alarm<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>

         actions <span class="token operator">-</span> <span class="token keyword">if</span> <span class="token operator">-</span> not <span class="token operator">-</span> arrived
         flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_UNBLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>block_alarm<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x4FDD;&#x62A4;handler&#x4E0D;&#x88AB;&#x5176;&#x4ED6;signal&#x6253;&#x65AD;</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stddef.h&gt;</span></span>
<span class="token keyword">void</span> <span class="token function">catch_stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span>
<span class="token function">install_handler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> setup_action<span class="token punctuation">;</span>
 <span class="token class-name">sigset_t</span> block_mask<span class="token punctuation">;</span>
 <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>block_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">/* Block other terminal-generated signals while handler runs. */</span>
 <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>block_mask<span class="token punctuation">,</span> SIGINT<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>block_mask<span class="token punctuation">,</span> SIGQUIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
 setup_action<span class="token punctuation">.</span>sa_handler <span class="token operator">=</span> catch_stop<span class="token punctuation">;</span>
 setup_action<span class="token punctuation">.</span>sa_mask <span class="token operator">=</span> block_mask<span class="token punctuation">;</span>
 setup_action<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGTSTP<span class="token punctuation">,</span> <span class="token operator">&amp;</span>setup_action<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
</ul>
<h2 id="&#x6B63;&#x5728;pending&#x7684;signal&#x5DF2;&#x5230;&#x8FBE;-&#x672A;&#x5904;&#x7406;"><a name="&#x6B63;&#x5728;pending&#x7684;signal&#x5DF2;&#x5230;&#x8FBE;-&#x672A;&#x5904;&#x7406;" class="anchor-navigation-ex-anchor" href="#&#x6B63;&#x5728;pending&#x7684;signal&#x5DF2;&#x5230;&#x8FBE;-&#x672A;&#x5904;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>2.22. &#x6B63;&#x5728;pending&#x7684;signal(&#x5DF2;&#x5230;&#x8FBE;, &#x672A;&#x5904;&#x7406;)</h2>
<pre class="language-"><code class="lang-c"><span class="token comment">//&#x4E00;&#x822C;&#x7528;&#x4E0D;&#x5230;&#x8FD9;&#x51FD;&#x6570;, &#x9664;&#x975E;&#x662F;&#x5728;sigprocmask&#x6216;sa_mask&#x4FDD;&#x62A4;&#x7684;&#x4EE3;&#x7801;&#x91CC;</span>
<span class="token keyword">int</span> <span class="token function">sigpending</span> <span class="token punctuation">(</span>sigset t <span class="token operator">*</span>set<span class="token punctuation">)</span>
</code></pre>
<h2 id="&#x7B49;&#x5F85;signal"><a name="&#x7B49;&#x5F85;signal" class="anchor-navigation-ex-anchor" href="#&#x7B49;&#x5F85;signal"><i class="fa fa-link" aria-hidden="true"></i></a>2.23. &#x7B49;&#x5F85;signal</h2>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token comment">//&#x963B;&#x585E;&#x8FDB;&#x7A0B;&#x76F4;&#x5230;signal&#x6267;&#x884C;</span>
<span class="token keyword">int</span> <span class="token function">pause</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
&#x9700;&#x8981;&#x6CE8;&#x610F;<span class="token operator">:</span>
```c
<span class="token comment">/* usr_interrupt is set by the signal handler. */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>usr_interrupt<span class="token punctuation">)</span>
    <span class="token comment">//&#x5982;&#x679C;&#x5728;&#x8FD9;&#x4E4B;&#x95F4;signal&#x6765;&#x4E86;, &#x5E76;&#x8BA9;usr_interrupt=1, &#x90A3;&#x4E48;&#x8FD9;&#x4E2A;signal&#x7684;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E0D;&#x4F1A;&#x5F97;&#x5230;&#x5904;&#x7406;.</span>
    <span class="token function">pause</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* Do work once the signal arrives. */</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre>
<p>&#x53EF;&#x4EE5;&#x6539;&#x6210;&#x8FD9;&#x6837;: &#x4E0D;&#x7528;pause()</p>
<pre class="language-"><code class="lang-c"><span class="token comment">/* usr_interrupt is set by the signal handler.
while (!usr_interrupt)
sleep (1);
/* Do work once the signal arrives. */</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre>
<p>&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;:</p>
<pre class="language-"><code class="lang-c"><span class="token comment">//&#x963B;&#x585E;&#x8FDB;&#x7A0B;, block set&#x91CC;&#x9762;&#x7684;signal. &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4E00;&#x76F4;&#x963B;&#x585E;, &#x76F4;&#x5230;&#x975E;set&#x6210;&#x5458;&#x7684;signal&#x7684;handler&#x8FD4;&#x56DE;&#x4EE5;&#x540E;&#x624D;&#x8FD4;&#x56DE;.</span>
<span class="token keyword">int</span> <span class="token function">sigsuspend</span> <span class="token punctuation">(</span><span class="token keyword">const</span> sigset t <span class="token operator">*</span>set<span class="token punctuation">)</span>
</code></pre>
<h2 id="signal&#x7684;&#x6808;"><a name="signal&#x7684;&#x6808;" class="anchor-navigation-ex-anchor" href="#signal&#x7684;&#x6808;"><i class="fa fa-link" aria-hidden="true"></i></a>2.24. signal&#x7684;&#x6808;</h2>
<p>signal&#x7684;&#x6808;&#x5728;&#x7279;&#x6B8A;&#x7684;&#x5730;&#x65B9;(&#x4E0D;&#x662F;&#x8FDB;&#x7A0B;&#x6808;&#x5417;?--&#x9ED8;&#x8BA4;&#x662F;&#x7528;&#x8FDB;&#x7A0B;&#x6808;), &#x53EF;&#x4EE5;&#x7528;sigaltstack&#x8BBE;&#x5B9A;.</p>
<pre class="language-"><code class="lang-c"><span class="token class-name">stack_t</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>ss_sp
    <span class="token class-name">size_t</span> ss_size
    <span class="token keyword">int</span> ss_flags
        SS_DISABLE<span class="token operator">:</span> &#x4E0D;&#x4F7F;&#x7528;signal&#x6808;
        SS_ONSTACK<span class="token operator">:</span> &#x4E3A;<span class="token number">1</span>&#x8868;&#x793A;&#x6B63;&#x5728;&#x7528;signal&#x6808;<span class="token punctuation">.</span> &#x4E3A;<span class="token number">0</span>&#x8868;&#x793A;&#x7528;&#x7684;&#x662F;&#x8FDB;&#x7A0B;&#x7684;&#x6808;<span class="token punctuation">.</span> &#x7531;OS&#x8BBE;&#x7F6E;
<span class="token comment">/* &#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5728;&#x677F;&#x5B50;&#x4E0A;&#x6D4B;&#x8BD5;, &#x7ED3;&#x679C;&#x4E3A;
** ss_sp:(nil), ss_size:0, ss_flags:0x2(SS_DISABLE)
** &#x8868;&#x793A;&#x4E0D;&#x7528;signal&#x7684;&#x6808;, &#x4F7F;&#x7528;&#x8FDB;&#x7A0B;&#x6808;
*/</span>
<span class="token keyword">int</span> <span class="token function">sigaltstack</span> <span class="token punctuation">(</span><span class="token keyword">const</span> stack t <span class="token operator">*</span>restrict stack<span class="token punctuation">,</span> stack t <span class="token operator">*</span>restrict oldstack<span class="token punctuation">)</span>
</code></pre>
<h1 id="&#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;"><a name="&#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;" class="anchor-navigation-ex-anchor" href="#&#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;"><i class="fa fa-link" aria-hidden="true"></i></a>3. &#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;</h1>
<pre class="language-"><code class="lang-c"><span class="token comment">//main</span>
<span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">//&#x957F;&#x53C2;&#x6570;&#x5F62;&#x5F0F;: --name=value</span>
## &#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getopt 
```c
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token comment">/* &#x4F1A;&#x7528;&#x5230;&#x51E0;&#x4E2A;&#x53D8;&#x91CF;
** int opterr; int optopt; int optind; char * optarg;
** : &#x8868;&#x793A;&#x9700;&#x8981;&#x53C2;&#x6570; :: &#x8868;&#x793A;&#x53C2;&#x6570;&#x53EF;&#x9009;
** &#x5728;&#x5FAA;&#x73AF;&#x91CC;&#x8C03;&#x7528;
*/</span>
<span class="token keyword">int</span> <span class="token function">getopt</span> <span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>options<span class="token punctuation">)</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;:</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ctype.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> aflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> bflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>cvalue <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> index<span class="token punctuation">;</span>
    <span class="token keyword">int</span> c<span class="token punctuation">;</span>
    opterr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">getopt</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token string">&quot;abc:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> &#x2019;a&#x2019;<span class="token operator">:</span>
            aflag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> &#x2019;b&#x2019;<span class="token operator">:</span>
            bflag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> &#x2019;c&#x2019;<span class="token operator">:</span>
            cvalue <span class="token operator">=</span> optarg<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> &#x2019;<span class="token operator">?</span>&#x2019; <span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>optopt <span class="token operator">==</span> &#x2019;c&#x2019;<span class="token punctuation">)</span>
                    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;Option -%c requires an argument.\n&quot;</span><span class="token punctuation">,</span> optopt<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isprint</span><span class="token punctuation">(</span>optopt<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;Unknown option &#x2018;-%c&#x2019;.\n&quot;</span><span class="token punctuation">,</span> optopt<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span>
                    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span>
                            <span class="token string">&quot;Unknown option character &#x2018;\x%x&#x2019;.\n&quot;</span><span class="token punctuation">,</span>
                            optopt<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;aflag = %d, bflag = %d, cvalue = %s\n&quot;</span><span class="token punctuation">,</span>
           aflag<span class="token punctuation">,</span> bflag<span class="token punctuation">,</span> cvalue<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> optind<span class="token punctuation">;</span> index <span class="token operator">&lt;</span> argc<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Non-option argument %s\n&quot;</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x7ED3;&#x679C;:</p>
<pre class="language-"><code class="lang-c"><span class="token operator">%</span> testopt
aflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> bflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> cvalue <span class="token operator">=</span> <span class="token punctuation">(</span>null<span class="token punctuation">)</span>
<span class="token operator">%</span> testopt <span class="token operator">-</span>a <span class="token operator">-</span>b
aflag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> bflag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> cvalue <span class="token operator">=</span> <span class="token punctuation">(</span>null<span class="token punctuation">)</span>
<span class="token operator">%</span> testopt <span class="token operator">-</span>ab
aflag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> bflag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> cvalue <span class="token operator">=</span> <span class="token punctuation">(</span>null<span class="token punctuation">)</span>
<span class="token operator">%</span> testopt <span class="token operator">-</span>c foo
aflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> bflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> cvalue <span class="token operator">=</span> foo
<span class="token operator">%</span> testopt <span class="token operator">-</span>cfoo
aflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> bflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> cvalue <span class="token operator">=</span> foo
<span class="token operator">%</span> testopt arg1
aflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> bflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> cvalue <span class="token operator">=</span> <span class="token punctuation">(</span>null<span class="token punctuation">)</span>
Non<span class="token operator">-</span>option argument arg1
<span class="token operator">%</span> testopt <span class="token operator">-</span>a arg1
aflag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> bflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> cvalue <span class="token operator">=</span> <span class="token punctuation">(</span>null<span class="token punctuation">)</span>
Non<span class="token operator">-</span>option argument arg1
<span class="token operator">%</span> testopt <span class="token operator">-</span>c foo arg1
aflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> bflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> cvalue <span class="token operator">=</span> foo
Non<span class="token operator">-</span>option argument arg1
<span class="token operator">%</span> testopt <span class="token operator">-</span>a <span class="token operator">--</span> <span class="token operator">-</span>b
aflag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> bflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> cvalue <span class="token operator">=</span> <span class="token punctuation">(</span>null<span class="token punctuation">)</span>
Non<span class="token operator">-</span>option argument <span class="token operator">-</span>b
<span class="token operator">%</span> testopt <span class="token operator">-</span>a <span class="token operator">-</span>aflag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> bflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> cvalue <span class="token operator">=</span> <span class="token punctuation">(</span>null<span class="token punctuation">)</span>
Non<span class="token operator">-</span>option argument <span class="token operator">-</span>
</code></pre>
<h2 id="&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getoptlong"><a name="&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getoptlong" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getoptlong"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. &#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getopt_long</h2>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;getopt.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">getopt_long</span> <span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>shortopts<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">option</span> <span class="token operator">*</span>longopts<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>indexptr<span class="token punctuation">)</span>
<span class="token keyword">struct</span> <span class="token class-name">option</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name
    <span class="token keyword">int</span> has_arg
    <span class="token keyword">int</span> <span class="token operator">*</span>flag
    <span class="token keyword">int</span> val
</code></pre>
<p>&#x4E3E;&#x4F8B;:</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;getopt.h&gt;</span></span>
<span class="token comment">/* Flag set by &#x2018;--verbose&#x2019;. */</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> verbose_flag<span class="token punctuation">;</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> c<span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">option</span> long_options<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token comment">/* These options set a flag. */</span>
            <span class="token punctuation">{</span><span class="token string">&quot;verbose&quot;</span><span class="token punctuation">,</span> no_argument<span class="token punctuation">,</span> <span class="token operator">&amp;</span>verbose_flag<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">&quot;brief&quot;</span><span class="token punctuation">,</span> no_argument<span class="token punctuation">,</span> <span class="token operator">&amp;</span>verbose_flag<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">/* These options don&#x2019;t set a flag.
            We distinguish them by their indices. */</span>
            <span class="token punctuation">{</span><span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span> no_argument<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> &#x2019;a&#x2019;<span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">&quot;append&quot;</span><span class="token punctuation">,</span> no_argument<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> &#x2019;b&#x2019;<span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">&quot;delete&quot;</span><span class="token punctuation">,</span> required_argument<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> &#x2019;d&#x2019;<span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> required_argument<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> &#x2019;c&#x2019;<span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span> required_argument<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> &#x2019;f&#x2019;<span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">/* getopt_long stores the option index here. */</span>
        <span class="token keyword">int</span> option_index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        c <span class="token operator">=</span> <span class="token function">getopt_long</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token string">&quot;abc:d:f:&quot;</span><span class="token punctuation">,</span>
                        long_options<span class="token punctuation">,</span> <span class="token operator">&amp;</span>option_index<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* Detect the end of the options. */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>

            <span class="token comment">/* If this option set a flag, do nothing else now. */</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>long_options<span class="token punctuation">[</span>option_index<span class="token punctuation">]</span><span class="token punctuation">.</span>flag <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;option %s&quot;</span><span class="token punctuation">,</span> long_options<span class="token punctuation">[</span>option_index<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>optarg<span class="token punctuation">)</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot; with arg %s&quot;</span><span class="token punctuation">,</span> optarg<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> &#x2019;a&#x2019;<span class="token operator">:</span>
            <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;option -a\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> &#x2019;b&#x2019;<span class="token operator">:</span>
            <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;option -b\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> &#x2019;c&#x2019;<span class="token operator">:</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;option -c with value &#x2018;%s&#x2019;\n&quot;</span><span class="token punctuation">,</span> optarg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> &#x2019;d&#x2019;<span class="token operator">:</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;option -d with value &#x2018;%s&#x2019;\n&quot;</span><span class="token punctuation">,</span> optarg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> &#x2019;f&#x2019;<span class="token operator">:</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;option -f with value &#x2018;%s&#x2019;\n&quot;</span><span class="token punctuation">,</span> optarg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> &#x2019;<span class="token operator">?</span>&#x2019; <span class="token operator">:</span>
                <span class="token comment">/* getopt_long already printed an error message. */</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* Instead of reporting &#x2018;--verbose&#x2019;
    and &#x2018;--brief&#x2019; as they are encountered,
    we report the final status resulting from them. */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>verbose_flag<span class="token punctuation">)</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;verbose flag is set&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Print any remaining command line arguments (not options). */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>optind <span class="token operator">&lt;</span> argc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;non-option ARGV-elements: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span>optind <span class="token operator">&lt;</span> argc<span class="token punctuation">)</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s &quot;</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span>optind<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">putchar</span><span class="token punctuation">(</span>&#x2019;\n&#x2019;<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argpparse"><a name="&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argpparse" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argpparse"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. &#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argp_parse</h2>
<pre class="language-"><code class="lang-c"><span class="token comment">//&#x597D;&#x50CF;&#x5F88;&#x590D;&#x6742;</span>
<span class="token class-name">error_t</span> <span class="token function">argp_parse</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">argp</span> <span class="token operator">*</span>argp<span class="token punctuation">,</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> flags<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>arg_index<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>input<span class="token punctuation">)</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;:&#x6700;&#x7B80;&#x5355;</p>
<pre class="language-"><code class="lang-c"><span class="token comment">/* This is (probably) the smallest possible program that
uses argp. It won&#x2019;t do much except give an error
messages and exit when there are any arguments, and print
a (rather pointless) messages for &#x2013;help. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;argp.h&gt;</span></span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">argp_parse</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x9009;&#x9879;&#x7684;&#x4F8B;&#x5B50;</p>
<pre class="language-"><code class="lang-c"><span class="token comment">/* This program doesn&#x2019;t use any options or arguments, but uses
argp to be compliant with the GNU standard command line
format.
In addition to making sure no arguments are given, and
implementing a &#x2013;help option, this example will have a
&#x2013;version option, and will put the given documentation string
and bug address in the &#x2013;help output, as per GNU standards.
The variable ARGP contains the argument parser specification;
adding fields to this structure is the way most parameters are
passed to argp parse (the first three fields are usually used,
but not in this small program). There are also two global
variables that argp knows about defined here,
ARGP PROGRAM VERSION and ARGP PROGRAM BUG ADDRESS (they are
global variables because they will almost always be constant
for a given program, even if it uses different argument
parsers for various tasks). */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;argp.h&gt;</span></span>
<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argp_program_version <span class="token operator">=</span>
    <span class="token string">&quot;argp-ex2 1.0&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argp_program_bug_address <span class="token operator">=</span>
    <span class="token string">&quot;&lt;bug-gnu-utils@gnu.org&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/* Program documentation. */</span>
<span class="token keyword">static</span> <span class="token keyword">char</span> doc<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
    <span class="token string">&quot;Argp example #2 -- a pretty minimal program using argp&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/* Our argument parser. The options, parser, and
args_doc fields are zero because we have neither options or
arguments; doc and argp_program_bug_address will be
used in the output for &#x2018;--help&#x2019;, and the &#x2018;--version&#x2019;
option will print out argp_program_version. */</span>
<span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">argp</span> argp <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> doc <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">argp_parse</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argp<span class="token punctuation">,</span> argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x589E;&#x52A0;&#x4E00;&#x4E9B;option</p>
<pre class="language-"><code class="lang-c"><span class="token comment">/* This program uses the same features as example 2, and uses options and
arguments.
We now use the first four fields in ARGP, so here&#x2019;s a description of them:
OPTIONS &#x2013; A pointer to a vector of struct argp option (see below)
PARSER &#x2013; A function to parse a single option, called by argp
ARGS DOC &#x2013; A string describing how the non-option arguments should look
DOC &#x2013; A descriptive string about this program; if it contains a
vertical tab character (\v), the part after it will be
printed *following* the options
The function PARSER takes the following arguments:
KEY &#x2013; An integer specifying which option this is (taken
from the KEY field in each struct argp option), or
a special key specifying something else; the only
special keys we use here are ARGP KEY ARG, meaning
a non-option argument, and ARGP KEY END, meaning
that all arguments have been parsed
ARG &#x2013; For an option KEY, the string value of its
argument, or NULL if it has none
STATE&#x2013; A pointer to a struct argp state, containing
various useful information about the parsing state; used here
are the INPUT field, which reflects the INPUT argument to
argp parse, and the ARG NUM field, which is the number of the
current non-option argument being parsed
It should return either 0, meaning success, ARGP ERR UNKNOWN, meaning the
given KEY wasn&#x2019;t recognized, or an errno value indicating some other
error.
Note that in this example, main uses a structure to communicate with the
parse opt function, a pointer to which it passes in the INPUT argument to
argp parse. Of course, it&#x2019;s also possible to use global variables
instead, but this is somewhat more flexible.
The OPTIONS field contains a pointer to a vector of struct argp option&#x2019;s;
that structure has the following fields (if you assign your option
structures using array initialization like this example, unspecified
fields will be defaulted to 0, and need not be specified):
NAME &#x2013; The name of this option&#x2019;s long option (may be zero)
KEY &#x2013; The KEY to pass to the PARSER function when parsing this option,
*and* the name of this option&#x2019;s short option, if it is a
printable ascii character
ARG &#x2013; The name of this option&#x2019;s argument, if any
FLAGS &#x2013; Flags describing this option; some of them are:
OPTION ARG OPTIONAL &#x2013; The argument to this option is optional
OPTION ALIAS &#x2013; This option is an alias for the
previous option
OPTION HIDDEN &#x2013; Don&#x2019;t show this option in &#x2013;help output
DOC &#x2013; A documentation string for this option, shown in &#x2013;help output
An options vector should be terminated by an option with all fields zero. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;argp.h&gt;</span></span>
<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argp_program_version <span class="token operator">=</span>
    <span class="token string">&quot;argp-ex3 1.0&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argp_program_bug_address <span class="token operator">=</span>
    <span class="token string">&quot;&lt;bug-gnu-utils@gnu.org&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/* Program documentation. */</span>
<span class="token keyword">static</span> <span class="token keyword">char</span> doc<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
    <span class="token string">&quot;Argp example #3 -- a program with options and arguments using argp&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/* A description of the arguments we accept. */</span>
<span class="token keyword">static</span> <span class="token keyword">char</span> args_doc<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;ARG1 ARG2&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/* The options we understand. */</span>
<span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">argp_option</span> options<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span><span class="token string">&quot;verbose&quot;</span><span class="token punctuation">,</span> &#x2019;v&#x2019;<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;Produce verbose output&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;quiet&quot;</span><span class="token punctuation">,</span> &#x2019;q&#x2019;<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;Don&#x2019;t produce any output&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;silent&quot;</span><span class="token punctuation">,</span> &#x2019;s&#x2019;<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> OPTION_ALIAS <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;output&quot;</span><span class="token punctuation">,</span> &#x2019;o&#x2019;<span class="token punctuation">,</span> <span class="token string">&quot;FILE&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Output to FILE instead of standard output&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/* Used by main to communicate with parse_opt. */</span>
<span class="token keyword">struct</span> <span class="token class-name">arguments</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>args<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* arg1 &amp; arg2 */</span>
    <span class="token keyword">int</span> silent<span class="token punctuation">,</span> verbose<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>output_file<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/* Parse a single option. */</span>
<span class="token keyword">static</span> <span class="token class-name">error_t</span>
<span class="token function">parse_opt</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>arg<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">argp_state</span> <span class="token operator">*</span>state<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">/* Get the input argument from argp_parse, which we
    know is a pointer to our arguments structure. */</span>
    <span class="token keyword">struct</span> <span class="token class-name">arguments</span> <span class="token operator">*</span>arguments <span class="token operator">=</span> state<span class="token operator">-&gt;</span>input<span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> &#x2019;q&#x2019;<span class="token operator">:</span>
    <span class="token keyword">case</span> &#x2019;s&#x2019;<span class="token operator">:</span>
        arguments<span class="token operator">-&gt;</span>silent <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> &#x2019;v&#x2019;<span class="token operator">:</span>
        arguments<span class="token operator">-&gt;</span>verbose <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> &#x2019;o&#x2019;<span class="token operator">:</span>
        arguments<span class="token operator">-&gt;</span>output_file <span class="token operator">=</span> arg<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> ARGP_KEY_ARG<span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token operator">-&gt;</span>arg_num <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token comment">/* Too many arguments. */</span>
            <span class="token function">argp_usage</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>

        arguments<span class="token operator">-&gt;</span>args<span class="token punctuation">[</span>state<span class="token operator">-&gt;</span>arg_num<span class="token punctuation">]</span> <span class="token operator">=</span> arg<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> ARGP_KEY_END<span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token operator">-&gt;</span>arg_num <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token comment">/* Not enough arguments. */</span>
            <span class="token function">argp_usage</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">return</span> ARGP_ERR_UNKNOWN<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* Our argp parser. */</span>
<span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">argp</span> argp <span class="token operator">=</span> <span class="token punctuation">{</span> options<span class="token punctuation">,</span> parse_opt<span class="token punctuation">,</span> args_doc<span class="token punctuation">,</span> doc <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">arguments</span> arguments<span class="token punctuation">;</span>
    <span class="token comment">/* Default values. */</span>
    arguments<span class="token punctuation">.</span>silent <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    arguments<span class="token punctuation">.</span>verbose <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    arguments<span class="token punctuation">.</span>output_file <span class="token operator">=</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">/* Parse our arguments; every option seen by parse_opt will
    be reflected in arguments. */</span>
    <span class="token function">argp_parse</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argp<span class="token punctuation">,</span> argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;ARG1 = %s\nARG2 = %s\nOUTPUT_FILE = %s\n&quot;</span>
           <span class="token string">&quot;VERBOSE = %s\nSILENT = %s\n&quot;</span><span class="token punctuation">,</span>
           arguments<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arguments<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           arguments<span class="token punctuation">.</span>output_file<span class="token punctuation">,</span>
           arguments<span class="token punctuation">.</span>verbose <span class="token operator">?</span> <span class="token string">&quot;yes&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;no&quot;</span><span class="token punctuation">,</span>
           arguments<span class="token punctuation">.</span>silent <span class="token operator">?</span> <span class="token string">&quot;yes&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x66F4;&#x590D;&#x6742;&#x7684;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;</p>
<pre class="language-"><code class="lang-c"><span class="token comment">/* This program uses the same features as example 3, but has more
options, and somewhat more structure in the -help output. It
also shows how you can &#x2018;steal&#x2019; the remainder of the input
arguments past a certain point, for programs that accept a
list of items. It also shows the special argp KEY value
ARGP KEY NO ARGS, which is only given if no non-option
arguments were supplied to the program.
For structuring the help output, two features are used,
*headers* which are entries in the options vector with the
first four fields being zero, and a two part documentation
string (in the variable DOC), which allows documentation both
before and after the options; the two parts of DOC are
separated by a vertical-tab character (&#x2019;\v&#x2019;, or &#x2019;\013&#x2019;). By
convention, the documentation before the options is just a
short string saying what the program does, and that afterwards
is longer, describing the behavior in more detail. All
documentation strings are automatically filled for output,
although newlines may be included to force a line break at a
particular point. All documentation strings are also passed to
the &#x2018;gettext&#x2019; function, for possible translation into the
current locale. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;error.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;argp.h&gt;</span></span>
<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argp_program_version <span class="token operator">=</span>
    <span class="token string">&quot;argp-ex4 1.0&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argp_program_bug_address <span class="token operator">=</span>
    <span class="token string">&quot;&lt;bug-gnu-utils@prep.ai.mit.edu&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/* Program documentation. */</span>
<span class="token keyword">static</span> <span class="token keyword">char</span> doc<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
    <span class="token string">&quot;Argp example #4 -- a program with somewhat more complicatedoptions\vThis part of the documentation comes *after* the options;note that the text is automatically filled, but it&#x2019;s possibleto force a line-break, e.g.\n&lt;-- here.&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/* A description of the arguments we accept. */</span>
<span class="token keyword">static</span> <span class="token keyword">char</span> args_doc<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;ARG1 [STRING...]&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/* Keys for options without short-options. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OPT_ABORT</span> <span class="token expression"><span class="token number">1</span> </span><span class="token comment">/* &#x2013;abort */</span></span>
<span class="token comment">/* The options we understand. */</span>
<span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">argp_option</span> options<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span><span class="token string">&quot;verbose&quot;</span><span class="token punctuation">,</span> &#x2019;v&#x2019;<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;Produce verbose output&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;quiet&quot;</span><span class="token punctuation">,</span> &#x2019;q&#x2019;<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;Don&#x2019;t produce any output&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;silent&quot;</span><span class="token punctuation">,</span> &#x2019;s&#x2019;<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> OPTION_ALIAS <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;output&quot;</span><span class="token punctuation">,</span> &#x2019;o&#x2019;<span class="token punctuation">,</span> <span class="token string">&quot;FILE&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Output to FILE instead of standard output&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;The following options should be grouped together:&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;repeat&quot;</span><span class="token punctuation">,</span> &#x2019;r&#x2019;<span class="token punctuation">,</span> <span class="token string">&quot;COUNT&quot;</span><span class="token punctuation">,</span> OPTION_ARG_OPTIONAL<span class="token punctuation">,</span>
        <span class="token string">&quot;Repeat the output COUNT (default 10) times&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;abort&quot;</span><span class="token punctuation">,</span> OPT_ABORT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;Abort before showing any output&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/* Used by main to communicate with parse_opt. */</span>
<span class="token keyword">struct</span> <span class="token class-name">arguments</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>arg1<span class="token punctuation">;</span> <span class="token comment">/* arg1 */</span>
    <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>strings<span class="token punctuation">;</span> <span class="token comment">/* [string . . .] */</span>
    <span class="token keyword">int</span> silent<span class="token punctuation">,</span> verbose<span class="token punctuation">,</span> abort<span class="token punctuation">;</span> <span class="token comment">/* &#x2018;-s&#x2019;, &#x2018;-v&#x2019;, &#x2018;--abort&#x2019; */</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>output_file<span class="token punctuation">;</span> <span class="token comment">/* file arg to &#x2018;--output&#x2019; */</span>
    <span class="token keyword">int</span> repeat_count<span class="token punctuation">;</span> <span class="token comment">/* count arg to &#x2018;--repeat&#x2019; */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/* Parse a single option. */</span>
<span class="token keyword">static</span> <span class="token class-name">error_t</span>
<span class="token function">parse_opt</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>arg<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">argp_state</span> <span class="token operator">*</span>state<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">/* Get the input argument from argp_parse, which we
    know is a pointer to our arguments structure. */</span>
    <span class="token keyword">struct</span> <span class="token class-name">arguments</span> <span class="token operator">*</span>arguments <span class="token operator">=</span> state<span class="token operator">-&gt;</span>input<span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> &#x2019;q&#x2019;<span class="token operator">:</span>
    <span class="token keyword">case</span> &#x2019;s&#x2019;<span class="token operator">:</span>
        arguments<span class="token operator">-&gt;</span>silent <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> &#x2019;v&#x2019;<span class="token operator">:</span>
        arguments<span class="token operator">-&gt;</span>verbose <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> &#x2019;o&#x2019;<span class="token operator">:</span>
        arguments<span class="token operator">-&gt;</span>output_file <span class="token operator">=</span> arg<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> &#x2019;r&#x2019;<span class="token operator">:</span>
        arguments<span class="token operator">-&gt;</span>repeat_count <span class="token operator">=</span> arg <span class="token operator">?</span> <span class="token function">atoi</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> OPT_ABORT<span class="token operator">:</span>
        arguments<span class="token operator">-&gt;</span>abort <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> ARGP_KEY_NO_ARGS<span class="token operator">:</span>
        <span class="token function">argp_usage</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> ARGP_KEY_ARG<span class="token operator">:</span>
        <span class="token comment">/* Here we know that state-&gt;arg_num == 0, since we
        force argument parsing to end before any more arguments can
        get here. */</span>
        arguments<span class="token operator">-&gt;</span>arg1 <span class="token operator">=</span> arg<span class="token punctuation">;</span>
        <span class="token comment">/* Now we consume all the rest of the arguments.
        state-&gt;next is the index in state-&gt;argv of the
        next argument to be parsed, which is the first string
        we&#x2019;re interested in, so we can just use
        &amp;state-&gt;argv[state-&gt;next] as the value for
        arguments-&gt;strings.
        In addition, by setting state-&gt;next to the end
        of the arguments, we can force argp to stop parsing here and
        return. */</span>
        arguments<span class="token operator">-&gt;</span>strings <span class="token operator">=</span> <span class="token operator">&amp;</span>state<span class="token operator">-&gt;</span>argv<span class="token punctuation">[</span>state<span class="token operator">-&gt;</span>next<span class="token punctuation">]</span><span class="token punctuation">;</span>
        state<span class="token operator">-&gt;</span>next <span class="token operator">=</span> state<span class="token operator">-&gt;</span>argc<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">return</span> ARGP_ERR_UNKNOWN<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* Our argp parser. */</span>
<span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">argp</span> argp <span class="token operator">=</span> <span class="token punctuation">{</span> options<span class="token punctuation">,</span> parse_opt<span class="token punctuation">,</span> args_doc<span class="token punctuation">,</span> doc <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">arguments</span> arguments<span class="token punctuation">;</span>
    <span class="token comment">/* Default values. */</span>
    arguments<span class="token punctuation">.</span>silent <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    arguments<span class="token punctuation">.</span>verbose <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    arguments<span class="token punctuation">.</span>output_file <span class="token operator">=</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">;</span>
    arguments<span class="token punctuation">.</span>repeat_count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    arguments<span class="token punctuation">.</span>abort <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">/* Parse our arguments; every option seen by parse_opt will be
    reflected in arguments. */</span>
    <span class="token function">argp_parse</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argp<span class="token punctuation">,</span> argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>abort<span class="token punctuation">)</span>
        <span class="token function">error</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;ABORTED&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>repeat_count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;ARG1 = %s\n&quot;</span><span class="token punctuation">,</span> arguments<span class="token punctuation">.</span>arg1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;STRINGS = &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> arguments<span class="token punctuation">.</span>strings<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token function">printf</span><span class="token punctuation">(</span>j <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">&quot;%s&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;, %s&quot;</span><span class="token punctuation">,</span> arguments<span class="token punctuation">.</span>strings<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;OUTPUT_FILE = %s\nVERBOSE = %s\nSILENT = %s\n&quot;</span><span class="token punctuation">,</span>
               arguments<span class="token punctuation">.</span>output_file<span class="token punctuation">,</span>
               arguments<span class="token punctuation">.</span>verbose <span class="token operator">?</span> <span class="token string">&quot;yes&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;no&quot;</span><span class="token punctuation">,</span>
               arguments<span class="token punctuation">.</span>silent <span class="token operator">?</span> <span class="token string">&quot;yes&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;"><a name="&#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;" class="anchor-navigation-ex-anchor" href="#&#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;"><i class="fa fa-link" aria-hidden="true"></i></a>3.3. &#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;</h2>
<pre class="language-"><code class="lang-c"><span class="token keyword">int</span> <span class="token function">getsubopt</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>optionp<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token operator">*</span>tokens<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>valuep<span class="token punctuation">)</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;:</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">int</span> do_all<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>type<span class="token punctuation">;</span>
<span class="token keyword">int</span> read_size<span class="token punctuation">;</span>
<span class="token keyword">int</span> write_size<span class="token punctuation">;</span>
<span class="token keyword">int</span> read_only<span class="token punctuation">;</span>
<span class="token keyword">enum</span> <span class="token punctuation">{</span>
    RO_OPTION <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    RW_OPTION<span class="token punctuation">,</span>
    READ_SIZE_OPTION<span class="token punctuation">,</span>
    WRITE_SIZE_OPTION<span class="token punctuation">,</span>
    THE_END
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>mount_opts<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>RO_OPTION<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;ro&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>RW_OPTION<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;rw&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>READ_SIZE_OPTION<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;rsize&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>WRITE_SIZE_OPTION<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;wsize&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>THE_END<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">NULL</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>subopts<span class="token punctuation">,</span> <span class="token operator">*</span>value<span class="token punctuation">;</span>
    <span class="token keyword">int</span> opt<span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>opt <span class="token operator">=</span> <span class="token function">getopt</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token string">&quot;at:o:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>opt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> &#x2019;a&#x2019;<span class="token operator">:</span>
            do_all <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> &#x2019;t&#x2019;<span class="token operator">:</span>
            type <span class="token operator">=</span> optarg<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> &#x2019;o&#x2019;<span class="token operator">:</span>
            subopts <span class="token operator">=</span> optarg<span class="token punctuation">;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span>subopts <span class="token operator">!=</span> &#x2019;\<span class="token number">0</span>&#x2019;<span class="token punctuation">)</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token function">getsubopt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>subopts<span class="token punctuation">,</span> mount_opts<span class="token punctuation">,</span> <span class="token operator">&amp;</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> RO_OPTION<span class="token operator">:</span>
                    read_only <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">case</span> RW_OPTION<span class="token operator">:</span>
                    read_only <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">case</span> READ_SIZE_OPTION<span class="token operator">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                        <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    read_size <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">case</span> WRITE_SIZE_OPTION<span class="token operator">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                        <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    write_size <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">default</span><span class="token operator">:</span>
                    <span class="token comment">/* Unknown suboption. */</span>
                    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Unknown suboption &#x2018;%s&#x2019;\n&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token comment">/* Do the real work. */</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x73AF;&#x5883;&#x53D8;&#x91CF;"><a name="&#x73AF;&#x5883;&#x53D8;&#x91CF;" class="anchor-navigation-ex-anchor" href="#&#x73AF;&#x5883;&#x53D8;&#x91CF;"><i class="fa fa-link" aria-hidden="true"></i></a>3.4. &#x73AF;&#x5883;&#x53D8;&#x91CF;</h2>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token keyword">char</span> <span class="token operator">*</span> <span class="token function">getenv</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span>
<span class="token keyword">char</span> <span class="token operator">*</span> <span class="token function">secure_getenv</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span>
<span class="token comment">//name=value, &#x5982;&#x679C;&#x6CA1;&#x6709;=, &#x76F8;&#x5F53;&#x4E8E;&#x5B9A;&#x4E49;xxxx&#x4E3A;&#x7A7A;</span>
<span class="token keyword">int</span> <span class="token function">putenv</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>string<span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">setenv</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>value<span class="token punctuation">,</span> <span class="token keyword">int</span> replace<span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">unsetenv</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">clearenv</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token comment">//env&#x7684;&#x5168;&#x5C40;&#x6570;&#x7EC4;, &#x6BCF;&#x4E00;&#x9879;&#x90FD;&#x662F;name=value</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span> environ
</code></pre>
<h2 id="syscall"><a name="syscall" class="anchor-navigation-ex-anchor" href="#syscall"><i class="fa fa-link" aria-hidden="true"></i></a>3.5. syscall</h2>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/syscall.h&gt;</span></span>
</code></pre>
<p>&#x4F8B;&#x5982;:</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/syscall.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h&gt;</span></span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">int</span> rc<span class="token punctuation">;</span>
rc <span class="token operator">=</span> <span class="token function">syscall</span><span class="token punctuation">(</span>SYS_chmod<span class="token punctuation">,</span> <span class="token string">&quot;/etc/passwd&quot;</span><span class="token punctuation">,</span> <span class="token number">0444</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>rc <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;chmod failed, errno = %d\n&quot;</span><span class="token punctuation">,</span> errno<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x53C8;&#x5982;:</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h&gt;</span></span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">int</span> rc<span class="token punctuation">;</span>
rc <span class="token operator">=</span> <span class="token function">chmod</span><span class="token punctuation">(</span><span class="token string">&quot;/etc/passwd&quot;</span><span class="token punctuation">,</span> <span class="token number">0444</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>rc <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;chmod failed, errno = %d\n&quot;</span><span class="token punctuation">,</span> errno<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="&#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;"><a name="&#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;" class="anchor-navigation-ex-anchor" href="#&#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;"><i class="fa fa-link" aria-hidden="true"></i></a>3.6. &#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;</h2>
<ul>
<li>main&#x7684;return</li>
<li>abort&#x4F1A;&#x89E6;&#x53D1;SIGABRT</li>
<li>exit<pre class="language-"><code class="lang-c"><span class="token comment">/*&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;, &#x4E0D;&#x8FD4;&#x56DE;; main&#x7684;return&#x503C;&#x968F;&#x540E;&#x88AB;&#x4F20;&#x5165;status
**status&#x8303;&#x56F4;&#x662F;0-255, &#x901A;&#x5E38;0(EXIT_SUCCESS)&#x8868;&#x793A;&#x6210;&#x529F;, 1(EXIT_FAILURE)&#x8868;&#x793A;&#x5931;&#x8D25;
**&#x7528;atexit&#x6216;on_exit&#x6CE8;&#x518C;&#x7684;&#x51FD;&#x6570;&#x4F1A;&#x88AB;&#x8C03;&#x7528;
**&#x5173;&#x95ED;&#x6240;&#x6709;stream, flush buffers, remove tmpfile
**&#x6700;&#x540E;&#x8C03;&#x7528;_exit&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;
*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token keyword">void</span> <span class="token function">exit</span> <span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span>
```c
<span class="token comment">//exit&#x94A9;&#x5B50;&#x51FD;&#x6570;</span>
<span class="token keyword">int</span> <span class="token function">atexit</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>function<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">on_exit</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>function<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span>
<span class="token comment">//abort&#x51FD;&#x6570;, &#x4F1A;&#x89E6;&#x53D1;SIGABRT. &#x4E0D;&#x4F1A;&#x56DE;&#x8C03;exit&#x94A9;&#x5B50;. &#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;</span>
<span class="token keyword">void</span> <span class="token function">abort</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token comment">/*&#x771F;&#x6B63;&#x7684;&#x7EC8;&#x6B62;&#x51FD;&#x6570;, &#x4E0D;&#x7BA1;&#x662F;&#x54EA;&#x79CD;&#x7EC8;&#x6B62;, &#x6700;&#x7EC8;&#x90FD;&#x4F1A;&#x8C03;&#x7528;&#x5B83;:
** 1. &#x5173;&#x95ED;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;, &#x6CE8;&#x610F;&#x5B83;&#x4E0D;&#x4F1A;&#x628A;&#x6D41;&#x6587;&#x4EF6;flush buffer(exit&#x4F1A;).
** 2. &#x62A5;&#x544A;&#x8FDB;&#x7A0B;&#x7684;exit status&#x5230;&#x7236;&#x8FDB;&#x7A0B;&#x7684;wait
** 3. &#x4E0B;&#x9762;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x88AB;init&#x8FDB;&#x7A0B;&#x63A5;&#x7BA1;
** 4. &#x5411;&#x7236;&#x8FDB;&#x7A0B;&#x53D1;&#x9001;SIGCHLD
** 5. &#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#x662F;&#x4E2A;&#x7EC8;&#x7AEF;&#x4F1A;&#x8BDD;&#x4E3B;&#x8FDB;&#x7A0B;(&#x6BD4;&#x5982;ssh), &#x90A3;&#x4E48;&#x5B83;&#x4F1A;&#x53D1;&#x9001;SIGHUP&#x5230;&#x6240;&#x6709;&#x524D;&#x53F0;&#x5B50;&#x8FDB;&#x7A0B;, &#x5E76;&#x91CA;&#x653E;&#x8FD9;&#x4E2A;&#x7EC8;&#x7AEF;.
** 6. &#x5982;&#x679C;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;&#x5BFC;&#x81F4;&#x8FDB;&#x7A0B;&#x7EC4;&#x53D8;&#x4E3A;&#x5B64;&#x513F;, &#x5219;&#x8FD9;&#x4E2A;&#x5B64;&#x513F;&#x8FDB;&#x7A0B;&#x7EC4;&#x4F1A;&#x53D8;&#x4E3A;stop&#x72B6;&#x6001;, &#x7136;&#x540E;&#x7EC4;&#x91CC;&#x7684;&#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;&#x90FD;&#x4F1A;&#x6536;&#x5230;SIGHUP&#x548C;SIGCONT
*/</span>
<span class="token keyword">void</span> <span class="token function">_exit</span> <span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span>
</code></pre>
</li>
</ul>
<h1 id="&#x8FDB;&#x7A0B;"><a name="&#x8FDB;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#&#x8FDB;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>4. &#x8FDB;&#x7A0B;</h1>
<pre class="language-"><code class="lang-c"><span class="token comment">//&#x4EE5;&#x963B;&#x585E;&#x65B9;&#x5F0F;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x5B50;&#x7A0B;&#x5E8F;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">system</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>command<span class="token punctuation">)</span>
<span class="token comment">//&#x8FDB;&#x7A0B;id&#x548C;&#x7236;&#x8FDB;&#x7A0B;id</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token class-name">pid_t</span> <span class="token function">getpid</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token class-name">pid_t</span> <span class="token function">getppid</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="fork"><a name="fork" class="anchor-navigation-ex-anchor" href="#fork"><i class="fa fa-link" aria-hidden="true"></i></a>4.1. fork</h2>
<pre class="language-"><code class="lang-c"><span class="token comment">/* &#x65B0;&#x8FDB;&#x7A0B;
** pid&#x4E0D;&#x540C;
** &#x7236;&#x5B50;&#x5171;&#x4EAB;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x7684;posion?
** &#x5B50;&#x8FDB;&#x7A0B;&#x4E0D;&#x7EE7;&#x627F;&#x6587;&#x4EF6;&#x9501;
** &#x4E0D;&#x7EE7;&#x627F;alarm
** &#x7EE7;&#x627F;signal, &#x4EE5;&#x53CA;block mask, &#x4F46;&#x6E05;&#x9664;pending&#x7684;signal
*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token class-name">pid_t</span> <span class="token function">fork</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token comment">//&#x5171;&#x4EAB;&#x7236;&#x8FDB;&#x7A0B;&#x5730;&#x5740;&#x7A7A;&#x95F4;</span>
<span class="token class-name">pid_t</span> <span class="token function">vfork</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="exec"><a name="exec" class="anchor-navigation-ex-anchor" href="#exec"><i class="fa fa-link" aria-hidden="true"></i></a>4.2. exec</h2>
<pre class="language-"><code class="lang-c"><span class="token comment">/*exec
** pid ppid group session user pwd&#x4E0D;&#x53D8;
** alarm&#x4E0D;&#x53D8;
** fd&#x4E0D;&#x53D8;, &#x4F46;stream&#x90FD;&#x6CA1;&#x4E86;(&#x56E0;&#x4E3A;stream&#x5C5E;&#x4E8E;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;, &#x800C;fd&#x662F;&#x5185;&#x6838;&#x7BA1;&#x7406;?)
** signal&#x53D8;&#x6210;default, &#x4F46;ignore&#x7684;signal&#x7EE7;&#x627F;
** &#x65F6;&#x95F4;&#x7247;&#x4E0D;&#x53D8;
*/</span>
<span class="token keyword">int</span> <span class="token function">execv</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token keyword">const</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">execl</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>arg0<span class="token punctuation">,</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">execve</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token keyword">const</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token keyword">const</span> env<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">execle</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>arg0<span class="token punctuation">,</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token keyword">const</span> env<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">execvp</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token keyword">const</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">execlp</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>arg0<span class="token punctuation">,</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">)</span>
</code></pre>
<h2 id="&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;"><a name="&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;" class="anchor-navigation-ex-anchor" href="#&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3. &#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;</h2>
<pre class="language-"><code class="lang-c"><span class="token class-name">pid_t</span> <span class="token function">waitpid</span> <span class="token punctuation">(</span>pid t pid<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>status<span class="token operator">-</span>ptr<span class="token punctuation">,</span> <span class="token keyword">int</span> options<span class="token punctuation">)</span>
<span class="token comment">//&#x76F8;&#x5F53;&#x4E8E;waitpid (-1, &amp;status, 0)</span>
<span class="token class-name">pid_t</span> <span class="token function">wait</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>status<span class="token operator">-</span>ptr<span class="token punctuation">)</span>
<span class="token comment">//&#x591A;&#x4E86;&#x4E00;&#x4E2A;&#x53C2;&#x6570;usage, &#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x8D44;&#x6E90;</span>
<span class="token class-name">pid_t</span> <span class="token function">wait4</span> <span class="token punctuation">(</span>pid t pid<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>status<span class="token operator">-</span>ptr<span class="token punctuation">,</span> <span class="token keyword">int</span> options<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">rusage</span> <span class="token operator">*</span>usage<span class="token punctuation">)</span>
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x4F7F;&#x7528;signal&#x6765;&#x5904;&#x7406;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;</p>
<pre class="language-"><code class="lang-c"><span class="token keyword">void</span>
<span class="token function">sigchld_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> pid<span class="token punctuation">,</span> status<span class="token punctuation">,</span> serrno<span class="token punctuation">;</span>
    serrno <span class="token operator">=</span> errno<span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pid <span class="token operator">=</span> <span class="token function">waitpid</span><span class="token punctuation">(</span>WAIT_ANY<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status<span class="token punctuation">,</span> WNOHANG<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;waitpid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token function">notice_termination</span><span class="token punctuation">(</span>pid<span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    errno <span class="token operator">=</span> serrno<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;"><a name="&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;" class="anchor-navigation-ex-anchor" href="#&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;"><i class="fa fa-link" aria-hidden="true"></i></a>4.4. &#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;</h2>
<pre class="language-"><code class="lang-c"><span class="token comment">//&#x5B50;&#x8FDB;&#x7A0B;&#x7528;exit&#x6216;_exit&#x9000;&#x51FA;</span>
<span class="token keyword">int</span> <span class="token function">WIFEXITED</span> <span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span>
<span class="token comment">//&#x4E0A;&#x9762;&#x4E3A;&#x771F;, &#x5219;&#x8FD9;&#x4E2A;&#x8FD4;&#x56DE;main&#x7684;&#x8FD4;&#x56DE;&#x503C;, &#x6216;&#x8C03;&#x7528;exit()&#x4F20;&#x5165;&#x7684;&#x8FD4;&#x56DE;&#x503C;</span>
<span class="token keyword">int</span> <span class="token function">WEXITSTATUS</span> <span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span>
<span class="token comment">//signal&#x5BFC;&#x81F4;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;</span>
<span class="token keyword">int</span> <span class="token function">WIFSIGNALED</span> <span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span>
<span class="token comment">//&#x4E0A;&#x9762;&#x4E3A;&#x771F;&#x65F6;&#x8FD4;&#x56DE;signal&#x53F7;</span>
<span class="token keyword">int</span> <span class="token function">WTERMSIG</span> <span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span>
<span class="token comment">//&#x662F;&#x5426;&#x4EA7;&#x751F;&#x4E86;core dump</span>
<span class="token keyword">int</span> <span class="token function">WCOREDUMP</span> <span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span>
<span class="token comment">//&#x5B50;&#x8FDB;&#x7A0B;stop</span>
<span class="token keyword">int</span> <span class="token function">WIFSTOPPED</span> <span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span>
<span class="token comment">//signal&#x5BFC;&#x81F4;&#x5B50;&#x8FDB;&#x7A0B;stop</span>
<span class="token keyword">int</span> <span class="token function">WSTOPSIG</span> <span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span>
&#x4E3E;&#x4F8B;<span class="token operator">:</span>
```c
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stddef.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h&gt;</span></span>
<span class="token comment">/* Execute the command using this shell program. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SHELL</span> <span class="token string">&quot;/bin/sh&quot;</span></span>
<span class="token keyword">int</span>
<span class="token function">my_system</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>command<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> status<span class="token punctuation">;</span>
    <span class="token class-name">pid_t</span> pid<span class="token punctuation">;</span>
    pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/* This is the child process. Execute the shell command. */</span>
        <span class="token function">execl</span><span class="token punctuation">(</span>SHELL<span class="token punctuation">,</span> SHELL<span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> command<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*exec&#x5931;&#x8D25;, &#x76F4;&#x63A5;&#x7EC8;&#x6B62;&#x5B50;&#x8FDB;&#x7A0B;; &#x4E0D;&#x8981;&#x8C03;&#x7528;exit(), &#x56E0;&#x4E3A;&#x5B83;&#x4F1A;flush&#x4ECE;&#x7236;&#x8FDB;&#x7A0B;&#x7EE7;&#x627F;&#x8FC7;&#x6765;&#x7684;stream
        **&#x800C;&#x8FD9;&#x4E9B;stream&#x4F1A;&#x88AB;&#x7236;&#x8FDB;&#x7A0B;flush, &#x5BFC;&#x81F4;output&#x4E24;&#x6B21;
        */</span>
        <span class="token function">_exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment">/* The fork failed. Report failure. */</span>
        status <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>

        <span class="token comment">/* This is the parent process. Wait for the child to complete. */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">waitpid</span><span class="token punctuation">(</span>pid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">!=</span> pid<span class="token punctuation">)</span>
            status <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> status<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="job&#x63A7;&#x5236;"><a name="job&#x63A7;&#x5236;" class="anchor-navigation-ex-anchor" href="#job&#x63A7;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>5. job&#x63A7;&#x5236;</h1>
<ul>
<li>signal&#x7684;&#x5206;&#x53D1;&#x662F;&#x7531;&#x8FDB;&#x7A0B;&#x7EC4;&#x51B3;&#x5B9A;&#x7684;. &#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;&#x7684;&#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;&#x90FD;&#x4F1A;&#x6536;&#x5230;&#x7531;&#x7528;&#x6237;&#x89E6;&#x53D1;&#x7684;SIGTSTP, SIGQUIT, SIGINT &#x4FE1;&#x53F7;
&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;&#x4E0D;&#x5141;&#x8BB8;&#x8BFB;&#x63A7;&#x5236;&#x53F0;, &#x5426;&#x5219;&#x4F1A;&#x89E6;&#x53D1; SIGTTIN and SIGTTOU&#x4FE1;&#x53F7;&#x5230;&#x7EC4;&#x5185;&#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;(&#x9ED8;&#x8BA4;stop), &#x4F46;&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;&#x4E00;&#x822C;&#x53EF;&#x4EE5;&#x5199;&#x63A7;&#x5236;&#x53F0;</li>
<li>shell&#x4F1A;&#x628A;&#x547D;&#x4EE4;&#x7BA1;&#x9053;&#x5206;&#x6210;&#x82E5;&#x5E72;&#x8FDB;&#x7A0B;&#x7EC4;, &#x5E76;&#x9009;&#x5B9A;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7EC4;&#x4E3A;&#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;, &#x8BE5;&#x8FDB;&#x7A0B;&#x7EC4;&#x4EAB;&#x6709;&#x63A7;&#x5236;&#x53F0;. &#x5269;&#x4E0B;&#x7684;&#x8FDB;&#x7A0B;&#x7EC4;&#x4E3A;&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;.</li>
<li>&#x4E00;&#x822C;&#x4E00;&#x6B21;&#x767B;&#x5F55;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;, &#x91CC;&#x9762;&#x5305;&#x542B;&#x82E5;&#x4E2A;&#x8FDB;&#x7A0B;&#x7EC4;. </li>
<li>&#x4F1A;&#x8BDD;leader&#x8FDB;&#x7A0B;&#x4E5F;&#x79F0;&#x4E3A;&#x7EC8;&#x7AEF;&#x7684;&#x63A7;&#x5236;&#x8FDB;&#x7A0B;, &#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#x6302;&#x4E86;, &#x5219;&#x8FD9;&#x4E2A;&#x4F1A;&#x8BDD;&#x7684;&#x8FDB;&#x7A0B;&#x7EC4;&#x5C31;&#x6210;&#x4E86;&#x5B64;&#x513F;&#x8FDB;&#x7A0B;&#x7EC4;, &#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;(&#x8FD8;&#x662F;&#x524D;&#x5929;&#x8FDB;&#x7A0B;?)&#x90FD;&#x4F1A;&#x6536;&#x5230;SIGHUP&#x4FE1;&#x53F7;</li>
<li>tcsetpgrp&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7EC8;&#x7AEF;&#x63A7;&#x5236;&#x6743;, shell&#x8D77;&#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x65F6;&#x9700;&#x8981;&#x8C03;&#x7528;, &#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x8FD4;&#x56DE;&#x540E;, shell&#x4E5F;&#x8981;&#x8C03;&#x7528;tcsetpgrp&#x4E00;&#x6B21;&#x4EE5;&#x91CD;&#x65B0;&#x83B7;&#x5F97;&#x7EC8;&#x7AEF;&#x63A7;&#x5236;&#x6743;.</li>
<li><p>&#x7EC8;&#x7AEF;&#x63A7;&#x5236;&#x6743;&#x5207;&#x6362;&#x65F6;, &#x9700;&#x8981;&#x7528;tcgetattr()&#x548C;tcsetattr()&#x6765;&#x6062;&#x590D;&#x7EC8;&#x7AEF;&#x5C5E;&#x6027;.
&#x9ED8;&#x8BA4;&#x7EC8;&#x6B62;&#x8BE5;&#x8FDB;&#x7A0B;</p>
<h2 id="&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;"><a name="&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;" class="anchor-navigation-ex-anchor" href="#&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;"><i class="fa fa-link" aria-hidden="true"></i></a>5.1. &#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;(&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;?)</h2>
<pre class="language-"><code class="lang-c"><span class="token keyword">char</span> <span class="token operator">*</span> <span class="token function">ctermid</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>string<span class="token punctuation">)</span>
</code></pre>
<h2 id="&#x8FDB;&#x7A0B;&#x7EC4;api"><a name="&#x8FDB;&#x7A0B;&#x7EC4;api" class="anchor-navigation-ex-anchor" href="#&#x8FDB;&#x7A0B;&#x7EC4;api"><i class="fa fa-link" aria-hidden="true"></i></a>5.2. &#x8FDB;&#x7A0B;&#x7EC4;api</h2>
<pre class="language-"><code class="lang-c"><span class="token comment">//&#x8C03;&#x7528;&#x8FDB;&#x7A0B;&#x4F1A;&#x65B0;&#x5EFA;&#x4F1A;&#x8BDD;, &#x5E76;&#x6210;&#x4E3A;leader, &#x5176;pid==&#x8FDB;&#x7A0B;&#x7EC4;id</span>
<span class="token class-name">pid_t</span> <span class="token function">setsid</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token comment">//&#x83B7;&#x5F97;session leader&#x7684;&#x8FDB;&#x7A0B;&#x7EC4;id</span>
<span class="token class-name">pid_t</span> <span class="token function">getsid</span> <span class="token punctuation">(</span>pid t pid<span class="token punctuation">)</span>
<span class="token comment">//&#x83B7;&#x5F97;&#x8C03;&#x7528;&#x8FDB;&#x7A0B;&#x7684;&#x8FDB;&#x7A0B;&#x7EC4;id</span>
<span class="token class-name">pid_t</span> <span class="token function">getpgrp</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token comment">//&#x83B7;&#x5F97;pid&#x7684;&#x8FDB;&#x7A0B;&#x7EC4;id</span>
<span class="token keyword">int</span> <span class="token function">getpgid</span> <span class="token punctuation">(</span>pid t pid<span class="token punctuation">)</span>
<span class="token comment">//&#x5C06;pid&#x52A0;&#x5165;pgid&#x7EC4;</span>
<span class="token keyword">int</span> <span class="token function">setpgid</span> <span class="token punctuation">(</span>pid t pid<span class="token punctuation">,</span> pid t pgid<span class="token punctuation">)</span>
<span class="token comment">//&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;</span>
<span class="token class-name">pid_t</span> <span class="token function">tcgetpgrp</span> <span class="token punctuation">(</span><span class="token keyword">int</span> filedes<span class="token punctuation">)</span>
<span class="token comment">//&#x8BBE;&#x7F6E;&#x63A7;&#x5236;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;</span>
<span class="token keyword">int</span> <span class="token function">tcsetpgrp</span> <span class="token punctuation">(</span><span class="token keyword">int</span> filedes<span class="token punctuation">,</span> pid t pgid<span class="token punctuation">)</span>
</code></pre>
<h2 id="&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell"><a name="&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell" class="anchor-navigation-ex-anchor" href="#&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell"><i class="fa fa-link" aria-hidden="true"></i></a>5.3. &#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell</h2>
<p>```c
/<em> A process is a single process. </em>/
typedef struct process {
 struct process <em>next; /</em> next process in pipeline <em>/
 char **argv; /</em> for exec <em>/
 pid_t pid; /</em> process ID <em>/
 char completed; /</em> true if process has completed <em>/
 char stopped; /</em> true if process has stopped <em>/
 int status; /</em> reported status value <em>/
} process;
/</em> A job is a pipeline of processes. <em>/
typedef struct job {
 struct job </em>next; /<em> next active job </em>/
 char <em>command; /</em> command line, used for messages <em>/
 process </em>first_process; /<em> list of processes in this job </em>/
 pid_t pgid; /<em> process group ID </em>/
 char notified; /<em> true if user told about stopped job </em>/
 struct termios tmodes; /<em> saved terminal modes </em>/
 int stdin, stdout, stderr; /<em> standard i/o channels </em>/
} job;
/<em> The active jobs are linked into a list. This is its head. </em>/
job <em>first_job = NULL;
/</em> Find the active job with the indicated pgid. <em>/
job </em>
find_job(pid_t pgid)
{
 job *j;</p>
<p> for (j = first_job; j; j = j-&gt;next)</p>
<pre class="language-"><code> if (j-&gt;pgid == pgid)
     return j;
</code></pre><p> return NULL;
}
/<em> Return true if all processes in the job have stopped or completed. </em>/
int
job_is_stopped(job <em>j)
{
 process </em>p;</p>
<p> for (p = j-&gt;first_process; p; p = p-&gt;next)</p>
<pre class="language-"><code> if (ps &gt; completed &amp;&amp; !p-&gt;stopped)
     return 0;
</code></pre><p> return 1;
}
/<em> Return true if all processes in the job have completed. </em>/
int
job_is_completed(job <em>j)
{
 process </em>p;</p>
<p> for (p = j-&gt;first_process; p; p = p-&gt;next)</p>
<pre class="language-"><code> if (!p-&gt;completed)
     return 0;
</code></pre><p> return 1;
}</p>
</li>
</ul>
<p>/<em> Keep track of attributes of the shell. </em>/</p>
<h1 id="include-"><a name="include-" class="anchor-navigation-ex-anchor" href="#include-"><i class="fa fa-link" aria-hidden="true"></i></a>6. include </h1>
<h1 id="include-_1"><a name="include-_1" class="anchor-navigation-ex-anchor" href="#include-_1"><i class="fa fa-link" aria-hidden="true"></i></a>7. include </h1>
<h1 id="include-_2"><a name="include-_2" class="anchor-navigation-ex-anchor" href="#include-_2"><i class="fa fa-link" aria-hidden="true"></i></a>8. include </h1>
<p>pid_t shell_pgid;
struct termios shell_tmodes;
int shell_terminal;
int shell_is_interactive;
/<em> Make sure the shell is running interactively as the foreground job
before proceeding. </em>/
void
init_shell()
{
    /<em> See if we are running interactively. </em>/
    shell_terminal = STDIN_FILENO;
    shell_is_interactive = isatty(shell_terminal);</p>
<pre class="language-"><code>if (shell_is_interactive) {
    /* Loop until we are in the foreground. */
    while (tcgetpgrp(shell_terminal) != (shell_pgid = getpgrp()))
        kill(- shell_pgid, SIGTTIN);

    /* Ignore interactive and job-control signals. */
    signal(SIGINT, SIG_IGN);
    signal(SIGQUIT, SIG_IGN);
    signal(SIGTSTP, SIG_IGN);
    signal(SIGTTIN, SIG_IGN);
    signal(SIGTTOU, SIG_IGN);
    signal(SIGCHLD, SIG_IGN);
    /* Put ourselves in our own process group. */
    shell_pgid = getpid();

    if (setpgid(shell_pgid, shell_pgid) &lt; 0) {
        perror(&quot;Couldn&#x2019;t put the shell in its own process group&quot;);
        exit(1);
    }

    /* Grab control of the terminal. */
    tcsetpgrp(shell_terminal, shell_pgid);
    /* Save default terminal attributes for shell. */
    tcgetattr(shell_terminal, &amp;shell_tmodes);
}
</code></pre><p>}</p>
<p>void
launch_process(process *p, pid_t pgid,
               int infile, int outfile, int errfile,
               int foreground)
{
    pid_t pid;</p>
<pre class="language-"><code>if (shell_is_interactive) {
    /* Put the process into the process group and give the process group
    the terminal, if appropriate.
    This has to be done both by the shell and in the individual
    child processes because of potential race conditions. */
    pid = getpid();

    if (pgid == 0) pgid = pid;

    setpgid(pid, pgid);

    if (foreground)
        tcsetpgrp(shell_terminal, pgid);

    /* Set the handling for job control signals back to the default. */
    signal(SIGINT, SIG_DFL);
    signal(SIGQUIT, SIG_DFL);
    signal(SIGTSTP, SIG_DFL);
    signal(SIGTTIN, SIG_DFL);
    signal(SIGTTOU, SIG_DFL);
    signal(SIGCHLD, SIG_DFL);
}

/* Set the standard input/output channels of the new process. */
if (infile != STDIN_FILENO) {
    dup2(infile, STDIN_FILENO);
    close(infile);
}

if (outfile != STDOUT_FILENO) {
    dup2(outfile, STDOUT_FILENO);
    close(outfile);
}

if (errfile != STDERR_FILENO) {
    dup2(errfile, STDERR_FILENO);
    close(errfile);
}

/* Exec the new process. Make sure we exit. */
execvp(p-&gt;argv[0], p-&gt;argv);
perror(&quot;execvp&quot;);
exit(1);
</code></pre><p>}</p>
<p>void
launch_job(job <em>j, int foreground)
{
    process </em>p;
    pid_t pid;
    int mypipe[2], infile, outfile;
    infile = j-&gt;stdin;</p>
<pre class="language-"><code>for (p = j-&gt;first_process; p; p = p-&gt;next) {
    /* Set up pipes, if necessary. */
    if (p-&gt;next) {
        if (pipe(mypipe) &lt; 0) {
            perror(&quot;pipe&quot;);
            exit(1);
        }

        outfile = mypipe[1];
    } else
        outfile = j-&gt;stdout;

    /* Fork the child processes. */
    pid = fork();

    if (pid == 0)
        /* This is the child process. */
        launch_process(p, j-&gt;pgid, infile,
                       outfile, j-&gt;stderr, foreground);
    else if (pid &lt; 0) {
        /* The fork failed. */
        perror(&quot;fork&quot;);
        exit(1);
    } else {
        /* This is the parent process. */
        p-&gt;pid = pid;

        if (shell_is_interactive) {
            if (!j-&gt;pgid)
                j-&gt;pgid = pid;

            setpgid(pid, j-&gt;pgid);
        }
    }

    /* Clean up after pipes. */
    if (infile != j-&gt;stdin)
        close(infile);

    if (outfile != j-&gt;stdout)
        close(outfile);

    infile = mypipe[0];
}

format_job_info(j, &quot;launched&quot;);

if (!shell_is_interactive)
    wait_for_job(j);
else if (foreground)
    put_job_in_foreground(j, 0);
else
    put_job_in_background(j, 0);
</code></pre><p>}</p>
<p>/<em> Put job j in the foreground. If cont is nonzero,
restore the saved terminal modes and send the process group a
SIGCONT signal to wake it up before we block. </em>/
void
put_job_in_foreground(job <em>j, int cont)
{
    /</em> Put the job into the foreground. */
    tcsetpgrp(shell_terminal, j-&gt;pgid);</p>
<pre class="language-"><code>/* Send the job a continue signal, if necessary. */
if (cont) {
    tcsetattr(shell_terminal, TCSADRAIN, &amp;j-&gt;tmodes);

    if (kill(- j-&gt;pgid, SIGCONT) &lt; 0)
        perror(&quot;kill (SIGCONT)&quot;);
}

/* Wait for it to report. */
wait_for_job(j);
/* Put the shell back in the foreground. */
tcsetpgrp(shell_terminal, shell_pgid);
/* Restore the shell&#x2019;s terminal modes. */
tcgetattr(shell_terminal, &amp;j-&gt;tmodes);
tcsetattr(shell_terminal, TCSADRAIN, &amp;shell_tmodes);
</code></pre><p>}</p>
<p>/<em> Put a job in the background. If the cont argument is true, send
the process group a SIGCONT signal to wake it up. </em>/
void
put_job_in_background(job <em>j, int cont)
{
    /</em> Send the job a continue signal, if necessary. */
    if (cont)
        if (kill(-j-&gt;pgid, SIGCONT) &lt; 0)
            perror(&quot;kill (SIGCONT)&quot;);
}</p>
<p>/<em> Store the status of the process pid that was returned by waitpid.
Return 0 if all went well, nonzero otherwise. </em>/
int
mark_process_status(pid_t pid, int status)
{
    job <em>j;
    process </em>p;</p>
<pre class="language-"><code>if (pid &gt; 0) {
    /* Update the record for the process. */
    for (j = first_job; j; j = j-&gt;next)
        for (p = j-&gt;first_process; p; p = p-&gt;next)
            if (p-&gt;pid == pid) {
                p-&gt;status = status;

                if (WIFSTOPPED(status))
                    p-&gt;stopped = 1;
                else {
                    p-&gt;completed = 1;

                    if (WIFSIGNALED(status))
                        fprintf(stderr, &quot;%d: Terminated by signal %d.\n&quot;,
                                (int) pid, WTERMSIG(p-&gt;status));
                }

                return 0;
            }

    fprintf(stderr, &quot;No child process %d.\n&quot;, pid);
    return -1;
} else if (pid == 0 || errno == ECHILD)
    /* No processes ready to report. */
    return -1;
else {
    /* Other weird errors. */
    perror(&quot;waitpid&quot;);
    return -1;
}
</code></pre><p>}
/<em> Check for processes that have status information available,
without blocking. </em>/
void
update_status(void)
{
    int status;
    pid_t pid;</p>
<pre class="language-"><code>do
    pid = waitpid(WAIT_ANY, &amp;status, WUNTRACED | WNOHANG);

while (!mark_process_status(pid, status));
</code></pre><p>}
/<em> Check for processes that have status information available,
blocking until all processes in the given job have reported. </em>/
void
wait_for_job(job *j)
{
    int status;
    pid_t pid;</p>
<pre class="language-"><code>do
    pid = waitpid(WAIT_ANY, &amp;status, WUNTRACED);

while (!mark_process_status(pid, status)
       &amp;&amp; !job_is_stopped(j)
       &amp;&amp; !job_is_completed(j));
</code></pre><p>}
/<em> Format information about job status for the user to look at. </em>/
void
format_job_info(job <em>j, const char </em>status)
{
    fprintf(stderr, &quot;%ld (%s): %s\n&quot;, (long)j-&gt;pgid, status, j-&gt;command);
}
/<em> Notify the user about stopped or terminated jobs.
Delete terminated jobs from the active job list. </em>/
void
do_job_notification(void)
{
    job <em>j, </em>jlast, <em>jnext;
    process </em>p;
    /<em> Update status information for child processes. </em>/
    update_status();
    jlast = NULL;</p>
<pre class="language-"><code>for (j = first_job; j; j = jnext) {
    jnext = j-&gt;next;

    /* If all processes have completed, tell the user the job has
    completed and delete it from the list of active jobs. */
    if (job_is_completed(j)) {
        format_job_info(j, &quot;completed&quot;);

        if (jlast)
            jlast-&gt;next = jnext;
        else
            first_job = jnext;

        free_job(j);
    }
    /* Notify the user about stopped jobs,
    marking them so that we won&#x2019;t do this more than once. */
    else if (job_is_stopped(j) &amp;&amp; j &gt; notified) {
        format_job_info(j, &quot;stopped&quot;);
        j-&gt;notified = 1;
        jlast = j;
    }
    /* Don&#x2019;t say anything about jobs that are still running. */
    else
        jlast = j;
}
</code></pre><p>}
/<em> Mark a stopped job J as being running again. </em>/
void
mark_job_as_running(job <em>j)
{
    Process </em>p;</p>
<pre class="language-"><code>for (p = j-&gt;first_process; p; p = p-&gt;next)
    p-&gt;stopped = 0;

j-&gt;notified = 0;
</code></pre><p>}
/<em> Continue the job J. </em>/
void
continue_job(job *j, int foreground)
{
    mark_job_as_running(j);</p>
<pre class="language-"><code>if (foreground)
    put_job_in_foreground(j, 1);
else
    put_job_in_background(j, 1);
</code></pre><p>}</p>
<pre class="language-"><code>
# &#x7528;&#x6237;&#x548C;&#x7EC4;
*  &#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x6709;effective&#x7528;&#x6237;ID(&#x6743;&#x9650;&#x63A7;&#x5236;)&#x548C;real&#x7528;&#x6237;ID(who&#x521B;&#x5EFA;&#x4E86;&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;)
## api
```c
uid_t getuid (void)
gid_t getgid (void)
uid_t geteuid (void)
gid_t getegid (void)
int getgroups (int count, gid t *groups)
int seteuid (uid t neweuid)
int setuid (uid t newuid)
int setreuid (uid t ruid, uid t euid)
int setegid (gid t newgid)
int setgid (gid t newgid)
int setregid (gid t rgid, gid t egid)
int setgroups (size t count, const gid t *groups)
int initgroups (const char *user, gid t group)
int getgrouplist (const char *user, gid t group, gid t *groups, int *ngroups)
char * getlogin (void)
char * cuserid (char *string)
int login_tty (int filedes)
void login (const struct utmp *entry)
int logout (const char *ut_line)
void logwtmp (const char *ut_line, const char *ut_name, const char *ut_host)
</code></pre><h1 id="&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;"><a name="&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;" class="anchor-navigation-ex-anchor" href="#&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>9. &#x7CFB;&#x7EDF;&#x7BA1;&#x7406;</h1>
<pre class="language-"><code class="lang-c"><span class="token keyword">int</span> <span class="token function">gethostname</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> size t size<span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">sethostname</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> size t length<span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">getdomainnname</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> size t length<span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">setdomainname</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> size t length<span class="token punctuation">)</span>
<span class="token keyword">long</span> <span class="token keyword">int</span> <span class="token function">gethostid</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">sethostid</span> <span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">uname</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">utsname</span> <span class="token operator">*</span>info<span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">mount</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>special_file<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>dir<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fstype<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span> options<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">umount</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>file<span class="token punctuation">)</span>
</code></pre>
<p>&#x4F8B;&#x5982;:</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mount.h&gt;</span></span>
<span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;/dev/hdb&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/cdrom&quot;</span><span class="token punctuation">,</span> MS_MGC_VAL <span class="token operator">|</span> MS_RDONLY <span class="token operator">|</span> MS_NOSUID<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;/dev/hda2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/mnt&quot;</span><span class="token punctuation">,</span> MS_MGC_VAL <span class="token operator">|</span> MS_REMOUNT<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-"><code class="lang-c"><span class="token comment">//&#x7CFB;&#x7EDF;&#x53C2;&#x6570;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/sysctl.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">sysctl</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>names<span class="token punctuation">,</span> <span class="token keyword">int</span> nlen<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>oldval<span class="token punctuation">,</span> size t <span class="token operator">*</span>oldlenp<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>newval<span class="token punctuation">,</span> size t newlen<span class="token punctuation">)</span>
```c
<span class="token comment">//&#x83B7;&#x53D6;&#x7CFB;&#x7EDF;&#x8FD0;&#x884C;&#x65F6;&#x914D;&#x7F6E;&#x53C2;&#x6570;</span>
<span class="token keyword">long</span> <span class="token keyword">int</span> <span class="token function">sysconf</span> <span class="token punctuation">(</span><span class="token keyword">int</span> parameter<span class="token punctuation">)</span>

<span class="token keyword">int</span>
<span class="token function">have_job_control</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_POSIX_JOB_CONTROL</span></span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
    <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token function">sysconf</span> <span class="token punctuation">(</span>_SC_JOB_CONTROL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment">/* If the system is that badly wedged,
        there&#x2019;s no use trying to go on. */</span>
        <span class="token function">fatal</span> <span class="token punctuation">(</span><span class="token function">strerror</span> <span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span>
<span class="token function">get_child_max</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">CHILD_MAX</span></span>
    <span class="token keyword">return</span> CHILD_MAX<span class="token punctuation">;</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
    <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token function">sysconf</span> <span class="token punctuation">(</span>_SC_CHILD_MAX<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token function">fatal</span> <span class="token punctuation">(</span><span class="token function">strerror</span> <span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="&#x8C03;&#x8BD5;"><a name="&#x8C03;&#x8BD5;" class="anchor-navigation-ex-anchor" href="#&#x8C03;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a>10. &#x8C03;&#x8BD5;</h1>
<h2 id="&#x8C03;&#x7528;&#x6808;"><a name="&#x8C03;&#x7528;&#x6808;" class="anchor-navigation-ex-anchor" href="#&#x8C03;&#x7528;&#x6808;"><i class="fa fa-link" aria-hidden="true"></i></a>10.1. &#x8C03;&#x7528;&#x6808;</h2>
<pre class="language-"><code class="lang-c"><span class="token comment">/*&#x8C03;&#x7528;&#x6808;
**buffer&#x91CC;&#x4E00;&#x4E2A;frame&#x6307;&#x9488;&#x5BF9;&#x5E94;&#x4E00;&#x9879;
**&#x8FD4;&#x56DE;&#x5B9E;&#x9645;&#x7684;&#x6808;&#x5E27;&#x6570;
**&#x4F18;&#x5316;&#x9009;&#x9879;&#x4F1A;&#x5F71;&#x54CD;&#x6808;&#x56DE;&#x6EAF;, &#x6BD4;&#x5982;inline&#x548C;frame pointer elimination
*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;execinfo.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">backtrace</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span>
<span class="token comment">//&#x89E3;&#x6790;&#x8C03;&#x7528;&#x6808;&#x7B26;&#x53F7;&#x8868;, &#x524D;&#x63D0;&#x662F;&#x8FD0;&#x884C;&#x7684;elf&#x4E0D;&#x662F;strip&#x8FC7;&#x7684;?</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span> <span class="token function">backtrace_symbols</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span>
&#x4E3E;&#x4F8B;<span class="token operator">:</span>
```c
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;execinfo.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token comment">/* Obtain a backtrace and print it to stdout. */</span>
<span class="token keyword">void</span>
<span class="token function">print_trace</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>array<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> size<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>strings<span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> i<span class="token punctuation">;</span>
    size <span class="token operator">=</span> <span class="token function">backtrace</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    strings <span class="token operator">=</span> <span class="token function">backtrace_symbols</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Obtained %zd stack frames.\n&quot;</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> strings<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">free</span><span class="token punctuation">(</span>strings<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* A dummy function to make the backtrace more interesting. */</span>
<span class="token keyword">void</span>
<span class="token function">dummy_function</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">print_trace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">dummy_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="pthread"><a name="pthread" class="anchor-navigation-ex-anchor" href="#pthread"><i class="fa fa-link" aria-hidden="true"></i></a>11. pthread</h1>
<p>&#x8BE6;&#x89C1;POSIX Threads Programming(&#x975E;&#x5E38;&#x5F3A;&#x5927;)</p>
<h2 id="gnu&#x6269;&#x5C55;"><a name="gnu&#x6269;&#x5C55;" class="anchor-navigation-ex-anchor" href="#gnu&#x6269;&#x5C55;"><i class="fa fa-link" aria-hidden="true"></i></a>11.1. gnu&#x6269;&#x5C55;</h2>
<pre class="language-"><code class="lang-c"><span class="token comment">//&#x7EBF;&#x7A0B;&#x72EC;&#x7ACB;&#x7684;data</span>
<span class="token keyword">int</span> <span class="token function">pthread_key_create</span> <span class="token punctuation">(</span>pthread key t <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>destructor<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">pthread_key_delete</span> <span class="token punctuation">(</span>pthread key t key<span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">pthread_getspecific</span> <span class="token punctuation">(</span>pthread key t key<span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">pthread_setspecific</span> <span class="token punctuation">(</span>pthread key t key<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>value<span class="token punctuation">)</span>
</code></pre>
<h1 id="libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;&#x7565;"><a name="libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;&#x7565;" class="anchor-navigation-ex-anchor" href="#libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;&#x7565;"><i class="fa fa-link" aria-hidden="true"></i></a>12. libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;(&#x7565;)</h1>
<h1 id="libc&#x57FA;&#x7840;&#x51FD;&#x6570;"><a name="libc&#x57FA;&#x7840;&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#libc&#x57FA;&#x7840;&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>13. libc&#x57FA;&#x7840;&#x51FD;&#x6570;</h1>
<pre class="language-"><code class="lang-c"><span class="token comment">//&#x65AD;&#x8A00;, false&#x5219;&#x6253;&#x5370;__FILE__ __LINE__&#x5E76;abort(). &#x65AD;&#x8A00;&#x53EF;&#x4EE5;&#x7528;&#x5B8F;NDEBUG&#x7981;&#x6B62;&#x65AD;&#x8A00;&#x68C0;&#x67E5;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assert.h&gt;</span></span>
<span class="token keyword">void</span> <span class="token function">assert</span> <span class="token punctuation">(</span><span class="token keyword">int</span> expression<span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">assert_perror</span> <span class="token punctuation">(</span><span class="token keyword">int</span> errnum<span class="token punctuation">)</span>

<span class="token comment">//&#x53EF;&#x53D8;&#x53C2;&#x6570;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdarg.h&gt;</span></span>
</code></pre>
<p>&#x4E3E;&#x4F8B;:</p>
<pre class="language-"><code class="lang-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdarg.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span>
<span class="token function">add_em_up</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    va_list ap<span class="token punctuation">;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">,</span> sum<span class="token punctuation">;</span>
    <span class="token function">va_start</span><span class="token punctuation">(</span>ap<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* Initialize the argument list. */</span>
    sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        sum <span class="token operator">+=</span> <span class="token function">va_arg</span><span class="token punctuation">(</span>ap<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* Get the next argument value. */</span>

    <span class="token function">va_end</span><span class="token punctuation">(</span>ap<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* Clean up. */</span>
    <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">/* This call prints 16. */</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">add_em_up</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* This call prints 55. */</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">add_em_up</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//&#x7ED3;&#x6784;&#x4F53;&#x504F;&#x79FB;&#x91CF;</span>
<span class="token class-name">size_t</span> <span class="token function">offsetof</span> <span class="token punctuation">(</span>type<span class="token punctuation">,</span> member<span class="token punctuation">)</span>
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="system_libc_part2.html" class="navigation navigation-prev " aria-label="Previous page: libc概览2">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="system_原理杂记.html" class="navigation navigation-next " aria-label="Next page: 系统原理杂记">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"libc概览3","level":"1.14.3","depth":2,"next":{"title":"系统原理杂记","level":"1.14.4","depth":2,"path":"notes/system_原理杂记.md","ref":"notes/system_原理杂记.md","articles":[]},"previous":{"title":"libc概览2","level":"1.14.2","depth":2,"path":"notes/system_libc_part2.md","ref":"notes/system_libc_part2.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-livereload","-sharing","-lunr","-search","search-plus","-highlight","theme-comscore","prism","code","chapter-fold","github","splitter","wide-page","hide-navigation-buttons","anchor-navigation-ex","sequence","mermaid-gb3"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"chapter-fold":{},"prism":{"css":["prismjs/themes/prism.css"],"ignore":["mermaid","sequence"]},"sequence":{"theme":"simple"},"github":{"url":"https://github.com/Bai-Yingjie/Bai-Yingjie.github.io"},"splitter":{},"wide-page":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"hide-navigation-buttons":{},"mermaid-gb3":{},"anchor-navigation-ex":{"mode":"float","pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"isRewritePageTitle":true,"showLevel":true,"tocLevel1Icon":"fa fa-hand-o-right","tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right","showGoTop":true,"isShowTocTitleIcon":true,"printLog":false,"multipleH1":true,"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false}},"theme-comscore":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"search-plus":{}},"theme":"default","author":"Bai Yingjie","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"My Notes","language":"zh-hans","gitbook":"*"},"file":{"path":"notes/system_libc_part3.md","mtime":"2022-10-25T14:51:03.777Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-10-25T14:52:02.376Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-mermaid-gb3/book/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    <script src="../gitbook/gitbook-plugin-mermaid-gb3/mermaid/mermaid.min.js"></script>

    </body>
</html>

