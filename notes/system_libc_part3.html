
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>libc概览3 · My Notes</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Bai Yingjie">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-wide-page/wide.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hide-navigation-buttons/index.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="system_原理杂记.html" />
    
    
    <link rel="prev" href="system_libc_part2.html" />
    

    </head>
    <body>
        


<div class="book">
    <div class="book-summary">
        
            <div class="theme-code-header">
                <a href="" class="link">
                    <h1 class="title">My Notes</h1>
                </a>
            </div>
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    开源
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="my_opensource.html">
            
                <a href="my_opensource.html">
            
                    
                    我的开源项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="my_upstream.html">
            
                <a href="my_upstream.html">
            
                    
                    我的upstream commit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    系统分析和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="system_analysis_bcc和ebpf.html">
            
                <a href="system_analysis_bcc和ebpf.html">
            
                    
                    bcc和ebpf(starting)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="performance_ovs进程调查.html">
            
                <a href="performance_ovs进程调查.html">
            
                    
                    OVS进程调查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="performance_ping流程和函数调用解析.html">
            
                <a href="performance_ping流程和函数调用解析.html">
            
                    
                    ping流程和函数调用解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="CentOS_系统性能优化配置.html">
            
                <a href="CentOS_系统性能优化配置.html">
            
                    
                    CentOS 性能优化系统配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    ARM server
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="arm_server_杂记.html">
            
                <a href="arm_server_杂记.html">
            
                    
                    Arm server 杂记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    嵌入式系统开发调试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="embedded_debugging.html">
            
                <a href="embedded_debugging.html">
            
                    
                    嵌入式调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="uboot_杂记.html">
            
                <a href="uboot_杂记.html">
            
                    
                    uboot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="buildroot_杂记.html">
            
                <a href="buildroot_杂记.html">
            
                    
                    buildroot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="toolchain_升级gcc问题解决.html">
            
                <a href="toolchain_升级gcc问题解决.html">
            
                    
                    升级GCC7.3问题解决
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Linux工程实践
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="linux_日常使用.html">
            
                <a href="linux_日常使用.html">
            
                    
                    日常linux使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="git_日常使用.html">
            
                <a href="git_日常使用.html">
            
                    
                    日常git使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="向kernel提交补丁.html">
            
                <a href="向kernel提交补丁.html">
            
                    
                    向kernel提交补丁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="linux_ssh_relay.html">
            
                <a href="linux_ssh_relay.html">
            
                    
                    ssh relay
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="gitlab_ci.html">
            
                <a href="gitlab_ci.html">
            
                    
                    gitlab CI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="docker_操作记录.html">
            
                <a href="docker_操作记录.html">
            
                    
                    docker操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="centos_操作记录.html">
            
                <a href="centos_操作记录.html">
            
                    
                    centos操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Golang
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    入门
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1.1" data-path="golang_语法基础.html">
            
                <a href="golang_语法基础.html">
            
                    
                    Golang 语法基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.1.2" data-path="golang_json性能.html">
            
                <a href="golang_json性能.html">
            
                    
                    Golang json性能比较
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="golang_原理.html">
            
                <a href="golang_原理.html">
            
                    
                    Golang 原理相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.2.1" data-path="golang_interface原理.html">
            
                <a href="golang_interface原理.html">
            
                    
                    Golang interface原理(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.2" data-path="golang_内存分配.html">
            
                <a href="golang_内存分配.html">
            
                    
                    Golang 内存分配(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="golang_标准库.html">
            
                <a href="golang_标准库.html">
            
                    
                    Golang 标准库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="golang_我的反射代码.html">
            
                <a href="golang_我的反射代码.html">
            
                    
                    Golang 我的反射代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="golang_问答.html">
            
                <a href="golang_问答.html">
            
                    
                    Golang 问答
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="golang_高效go.html">
            
                <a href="golang_高效go.html">
            
                    
                    Golang 高效go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="golang_进阶.html">
            
                <a href="golang_进阶.html">
            
                    
                    Golang 进阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Golang 杂记
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.8.1" data-path="golang_杂记1.html">
            
                <a href="golang_杂记1.html">
            
                    
                    Golang 杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.2" data-path="golang_杂记2.html">
            
                <a href="golang_杂记2.html">
            
                    
                    Golang 杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.3" data-path="golang_杂记3.html">
            
                <a href="golang_杂记3.html">
            
                    
                    Golang 杂记3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.4" data-path="golang_lib选型.html">
            
                <a href="golang_lib选型.html">
            
                    
                    Golang lib选型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.5" data-path="golang_mod_proxy.html">
            
                <a href="golang_mod_proxy.html">
            
                    
                    go mod和go proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.6" data-path="golang_汇编_arm64.html">
            
                <a href="golang_汇编_arm64.html">
            
                    
                    Golang 汇编语法和arm64小知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8.7" data-path="golang_cgo_swig.html">
            
                <a href="golang_cgo_swig.html">
            
                    
                    go调用c可以用swig
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Golang 环境和工具链生成
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.9.1" data-path="golang_toolchain_ppc.html">
            
                <a href="golang_toolchain_ppc.html">
            
                    
                    go tools增加ppc32支持.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9.2" data-path="golang_toolchain_compile_gccgo.html">
            
                <a href="golang_toolchain_compile_gccgo.html">
            
                    
                    编译gccgo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9.3" data-path="golang_go_on_mips.html">
            
                <a href="golang_go_on_mips.html">
            
                    
                    go on mips boards(not so updated)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.9.3.1" data-path="golang_go_on_mips_part1.html">
            
                <a href="golang_go_on_mips_part1.html">
            
                    
                    part 1: cross compile go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9.3.2" data-path="golang_go_on_mips_part2.html">
            
                <a href="golang_go_on_mips_part2.html">
            
                    
                    part 2: build native go compiler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9.3.3" data-path="golang_go_on_mips_part3.html">
            
                <a href="golang_go_on_mips_part3.html">
            
                    
                    part 3: gccgo experiments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9.3.4" data-path="golang_go_on_mips_part4.html">
            
                <a href="golang_go_on_mips_part4.html">
            
                    
                    part 4: Golang json performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9.3.5" data-path="golang_gentoo_on_mips_board_and_build_go.html">
            
                <a href="golang_gentoo_on_mips_board_and_build_go.html">
            
                    
                    Gentoo on mips board and build go
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.10" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    微服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.10.1" data-path="golang_micro.html">
            
                <a href="golang_micro.html">
            
                    
                    go-micro和micro
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.10.2" data-path="golang_微服务概念.html">
            
                <a href="golang_微服务概念.html">
            
                    
                    微服务概念
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.11" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    解释器和编解码
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.11.1" data-path="golang_yeagi.html">
            
                <a href="golang_yeagi.html">
            
                    
                    解释器yeagi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.11.2" data-path="golang_tengo.html">
            
                <a href="golang_tengo.html">
            
                    
                    解释器tengo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.11.3" data-path="golang_govaluate.html">
            
                <a href="golang_govaluate.html">
            
                    
                    解释器govaluate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.11.4" data-path="golang_encoding_gotiny.html">
            
                <a href="golang_encoding_gotiny.html">
            
                    
                    gotiny编解码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.11.5" data-path="golang_abs.html">
            
                <a href="golang_abs.html">
            
                    
                    解释器abs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.12" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    调试和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.12.1" data-path="golang_调试记录.html">
            
                <a href="golang_调试记录.html">
            
                    
                    Golang 调试记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12.2" data-path="golang_topid性能优化.html">
            
                <a href="golang_topid性能优化.html">
            
                    
                    Golang topid性能优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12.3" data-path="golang_gshell性能调试.html">
            
                <a href="golang_gshell性能调试.html">
            
                    
                    Golang gshell性能调试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.13" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    网络和消息中间件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.13.1" data-path="golang_zmq.html">
            
                <a href="golang_zmq.html">
            
                    
                    消息中间件基本概念和zero mq
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.13.2" data-path="golang_mango.html">
            
                <a href="golang_mango.html">
            
                    
                    消息中间件mango
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.13.3" data-path="golang_libp2p.html">
            
                <a href="golang_libp2p.html">
            
                    
                    Golang p2p网络
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Rust
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="rust_入门_brief.html">
            
                <a href="rust_入门_brief.html">
            
                    
                    Rust 入门系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1" data-path="rust_books.html">
            
                <a href="rust_books.html">
            
                    
                    Rust reference books
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.2" data-path="rust_入门1.html">
            
                <a href="rust_入门1.html">
            
                    
                    Rust 安装和基础语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.3" data-path="rust_入门2.html">
            
                <a href="rust_入门2.html">
            
                    
                    Rust 泛型和内存所有权
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.4" data-path="rust_入门3.html">
            
                <a href="rust_入门3.html">
            
                    
                    Rust 闭包 容器 迭代器 生成器 线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.5" data-path="rust_工程构建.html">
            
                <a href="rust_工程构建.html">
            
                    
                    Rust 工程构建
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="rust_coding_brief.html">
            
                <a href="rust_coding_brief.html">
            
                    
                    Rust 代码积累
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.1" data-path="rust_序列化.html">
            
                <a href="rust_序列化.html">
            
                    
                    Rust 序列化原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.2" data-path="rust_知识点积累.html">
            
                <a href="rust_知识点积累.html">
            
                    
                    Rust 知识点更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.3" data-path="rust_adaptiveservice.html">
            
                <a href="rust_adaptiveservice.html">
            
                    
                    rust版本的adaptiveservice探索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.4" data-path="rust_常用设施.html">
            
                <a href="rust_常用设施.html">
            
                    
                    Rust 常用设施
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.5" data-path="rust_代码小段.html">
            
                <a href="rust_代码小段.html">
            
                    
                    Rust 代码小段
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="others.html">
            
                <a href="others.html">
            
                    
                    其他
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.3.1" data-path="rust_mdbook_使用.html">
            
                <a href="rust_mdbook_使用.html">
            
                    
                    Rust 使用mdbook
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    C开发
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="c_automake_autoconf.html">
            
                <a href="c_automake_autoconf.html">
            
                    
                    automake autoconf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="makefile_原理和实践.html">
            
                <a href="makefile_原理和实践.html">
            
                    
                    makefile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="c_编程杂记高级篇.html">
            
                <a href="c_编程杂记高级篇.html">
            
                    
                    C编程杂记高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="c_编程杂记基础篇.html">
            
                <a href="c_编程杂记基础篇.html">
            
                    
                    C编程杂记基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="c_networking_socket高阶用法.html">
            
                <a href="c_networking_socket高阶用法.html">
            
                    
                    网络编程: Advanced Socket Topics(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="c_protobuf介绍.html">
            
                <a href="c_protobuf介绍.html">
            
                    
                    序列化: protobuf介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="c_进程间通信_共享文件和共享内存.html">
            
                <a href="c_进程间通信_共享文件和共享内存.html">
            
                    
                    进程间通信: 共享文件和共享内存(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="c_pthread_condition和mutex.html">
            
                <a href="c_pthread_condition和mutex.html">
            
                    
                    并发 任务 事件 和锁.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.9" data-path="kernel_user_space_howto.html">
            
                <a href="kernel_user_space_howto.html">
            
                    
                    kernel space和user space交互(网摘, linux2.6)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    脚本
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="shell_变量.html">
            
                <a href="shell_变量.html">
            
                    
                    shell变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="shell_基础篇.html">
            
                <a href="shell_基础篇.html">
            
                    
                    shell命令和脚本记录-基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="shell_高级篇.html">
            
                <a href="shell_高级篇.html">
            
                    
                    shell命令和脚本记录-高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="shell_脚本片段.html">
            
                <a href="shell_脚本片段.html">
            
                    
                    shell脚本片段
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="python_记录.html">
            
                <a href="python_记录.html">
            
                    
                    python记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="lua_记录.html">
            
                <a href="lua_记录.html">
            
                    
                    lua记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="shell_rds脚本阅读.html">
            
                <a href="shell_rds脚本阅读.html">
            
                    
                    RDS脚本阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="Project_Euler.html">
            
                <a href="Project_Euler.html">
            
                    
                    Project Euler
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    cloud和容器相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="cloud_杂记.html">
            
                <a href="cloud_杂记.html">
            
                    
                    云杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="container_当代容器读书笔记.html">
            
                <a href="container_当代容器读书笔记.html">
            
                    
                    当代容器读书笔记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Operating System
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="system_libc_part1.html">
            
                <a href="system_libc_part1.html">
            
                    
                    libc概览1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="system_libc_part2.html">
            
                <a href="system_libc_part2.html">
            
                    
                    libc概览2
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.12.3" data-path="system_libc_part3.html">
            
                <a href="system_libc_part3.html">
            
                    
                    libc概览3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="system_原理杂记.html">
            
                <a href="system_原理杂记.html">
            
                    
                    系统原理杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="system_alpine.html">
            
                <a href="system_alpine.html">
            
                    
                    Alpine Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="system_进程间通信.html">
            
                <a href="system_进程间通信.html">
            
                    
                    进程间通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="system_特殊功能fd.html">
            
                <a href="system_特殊功能fd.html">
            
                    
                    eventfd timerfd signalfd和fd共享
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    CPU和device虚拟化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    gvisor
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1.1" data-path="golang_gvisor代码_KVM.html">
            
                <a href="golang_gvisor代码_KVM.html">
            
                    
                    gvisor KVM模式代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.1.2" data-path="golang_gvisor调试.html">
            
                <a href="golang_gvisor调试.html">
            
                    
                    gvisor调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.1.3" data-path="golang_gvisor_ptrace.html">
            
                <a href="golang_gvisor_ptrace.html">
            
                    
                    gvisor ptrace模式介绍(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="rust_vmm_brief.html">
            
                <a href="rust_vmm_brief.html">
            
                    
                    rust VMM(virtual machine monitor)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.2.1" data-path="rust_vmm_简介.html">
            
                <a href="rust_vmm_简介.html">
            
                    
                    rust-vmm简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2.2" data-path="rust_firecracker_代码.html">
            
                <a href="rust_firecracker_代码.html">
            
                    
                    firecracker代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2.3" data-path="rust_firecracker_使用.html">
            
                <a href="rust_firecracker_使用.html">
            
                    
                    firecracker使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2.4" data-path="rust_cloud-hypervisor_代码.html">
            
                <a href="rust_cloud-hypervisor_代码.html">
            
                    
                    cloud hypervisor代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2.5" data-path="rust_cloud-hypervisor_使用.html">
            
                <a href="rust_cloud-hypervisor_使用.html">
            
                    
                    cloud hypervisor使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2.6" data-path="rust_cloud-hypervisor_问题与解决.html">
            
                <a href="rust_cloud-hypervisor_问题与解决.html">
            
                    
                    cloud hypervisor问题与解决
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13.3" data-path="virtualization_virtio规范阅读笔记.html">
            
                <a href="virtualization_virtio规范阅读笔记.html">
            
                    
                    virtio规范阅读笔记.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4" data-path="qemu_ovs_虚拟化环境.html">
            
                <a href="qemu_ovs_虚拟化环境.html">
            
                    
                    qemu OVS 虚拟化环境准备
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.5" data-path="qemu使用.html">
            
                <a href="qemu使用.html">
            
                    
                    Qemu使用(old)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    计算机网络相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="networking_杂记1.html">
            
                <a href="networking_杂记1.html">
            
                    
                    networking杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    Qemu OVS和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.2.1" data-path="OVS_DPDK_编译运行.html">
            
                <a href="OVS_DPDK_编译运行.html">
            
                    
                    OVS-DPDK编译运行
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2.2" data-path="OVS_架构和代码.html">
            
                <a href="OVS_架构和代码.html">
            
                    
                    OVS架构和代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2.3" data-path="OVS_DPDK_performance_HXT_ARM_server.html">
            
                <a href="OVS_DPDK_performance_HXT_ARM_server.html">
            
                    
                    OVS-DPDK for ARM server 性能测试环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2.4" data-path="DPDK_Mellanox.html">
            
                <a href="DPDK_Mellanox.html">
            
                    
                    DPDK Mellanox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2.5" data-path="OVS_phy-vm-phy.html">
            
                <a href="OVS_phy-vm-phy.html">
            
                    
                    OVS PHY-VM-PHY
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2.6" data-path="networking_网络虚拟化用例记录.html">
            
                <a href="networking_网络虚拟化用例记录.html">
            
                    
                    网络虚拟化用例记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2.7" data-path="networking_网络虚拟化操作记录.html">
            
                <a href="networking_网络虚拟化操作记录.html">
            
                    
                    网络虚拟化操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14.3" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    虚拟化网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.3.1" data-path="networking_tc_filter_连接veth和tap.html">
            
                <a href="networking_tc_filter_连接veth和tap.html">
            
                    
                    Connecting a veth device to tap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3.2" data-path="networking_multicast_vxlan_flannel.html">
            
                <a href="networking_multicast_vxlan_flannel.html">
            
                    
                    multicast vxlan和flannel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3.3" data-path="networking_virtio网络介绍.html">
            
                <a href="networking_virtio网络介绍.html">
            
                    
                    virtio网络介绍(网摘): vhost-net virtio-net vhost-user SRIOV
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3.4" data-path="networking_virtualization_杂记.html">
            
                <a href="networking_virtualization_杂记.html">
            
                    
                    虚拟化网络杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3.5" data-path="networking_linux虚拟网络接口.html">
            
                <a href="networking_linux虚拟网络接口.html">
            
                    
                    linux虚拟网络接口(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    内核 设备和驱动相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="driver_驱动中使用工作队列轮询.html">
            
                <a href="driver_驱动中使用工作队列轮询.html">
            
                    
                    驱动中使用工作队列轮询
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="device_driver_杂记.html">
            
                <a href="device_driver_杂记.html">
            
                    
                    驱动调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="device_driver_原理相关.html">
            
                <a href="device_driver_原理相关.html">
            
                    
                    kernel和驱动原理相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4" data-path="device_localbus_16bit读写.html">
            
                <a href="device_localbus_16bit读写.html">
            
                    
                    CPLD做8bit到16bit转换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.5" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    nand
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.5.1" data-path="device_driver_octeon_nand.html">
            
                <a href="device_driver_octeon_nand.html">
            
                    
                    octeon nand flash驱动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.5.2" data-path="device_driver_nand概率写失败问题分析.html">
            
                <a href="device_driver_nand概率写失败问题分析.html">
            
                    
                    Nand flash概率写失败问题分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.6" data-path="octeon_remote_pci.html">
            
                <a href="octeon_remote_pci.html">
            
                    
                    octeon remote-pci.c阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7" data-path="Device_VFIO_notes.html">
            
                <a href="Device_VFIO_notes.html">
            
                    
                    VFIO简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.8" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    智能网卡和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.8.1" data-path="smartNIC_智能网卡对比.html">
            
                <a href="smartNIC_智能网卡对比.html">
            
                    
                    智能网卡对比
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.8.2" data-path="octeon_pci_NIC.html">
            
                <a href="octeon_pci_NIC.html">
            
                    
                    octeon PCI NIC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.8.3" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    octeon liquidIO
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.8.3.1" data-path="smartNIC_liquidIO_代码阅读app篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读app篇.html">
            
                    
                    PCI-NIC 代码阅读 --app篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.8.3.2" data-path="smartNIC_liquidIO_代码阅读api篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读api篇.html">
            
                    
                    PCI-NIC 代码阅读 --api篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.8.3.3" data-path="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇之结构体
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.8.3.4" data-path="smartNIC_liquidIO_代码阅读driver篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.8.3.5" data-path="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                    
                    PCI-NIC 代码阅读 --真NIC篇
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.8.4" data-path="networking_dpdk使用_2014.html">
            
                <a href="networking_dpdk使用_2014.html">
            
                    
                    DPDK使用(2014)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.9" data-path="device_nvme要点介绍.html">
            
                <a href="device_nvme要点介绍.html">
            
                    
                    nvme要点介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    CPU Arch相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    ARM64
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1.1" data-path="CPU_ARM64_thunder_overview.html">
            
                <a href="CPU_ARM64_thunder_overview.html">
            
                    
                    thunder 概览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.1.2" data-path="CPU_ARM64_thunder_开发板操作记录.html">
            
                <a href="CPU_ARM64_thunder_开发板操作记录.html">
            
                    
                    thunder 开发板操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.1.3" data-path="CPU_ARM64_thunder_bdk.html">
            
                <a href="CPU_ARM64_thunder_bdk.html">
            
                    
                    thunder BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.1.4" data-path="CPU_ARM64_thunder_efi_rtc.html">
            
                <a href="CPU_ARM64_thunder_efi_rtc.html">
            
                    
                    thunder RTC时间和efi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.1.5" data-path="CPU_ARM64_thunder_uefi_fdt.html">
            
                <a href="CPU_ARM64_thunder_uefi_fdt.html">
            
                    
                    thunder uefi和fdt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.1.6" data-path="CPU_ARM64_thunder_atf.html">
            
                <a href="CPU_ARM64_thunder_atf.html">
            
                    
                    thunder atf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.1.7" data-path="CPU_ARM64_thunder_kernel_boot.html">
            
                <a href="CPU_ARM64_thunder_kernel_boot.html">
            
                    
                    thunder kernel启动打印流程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    PPC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.2.1" data-path="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                <a href="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                    
                    PPC启动多核linux: 流程和内存映射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.2" data-path="CPU_PPC_kernel升级记录.html">
            
                <a href="CPU_PPC_kernel升级记录.html">
            
                    
                    PPC kernel升级记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="as_title.html">
            
                <a href="as_title.html">
            
                    
                    MIPS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.3.1" data-path="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                <a href="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                    
                    octeon 地址空间和寄存器访问
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3.2" data-path="CPU_MIPS_octeon操作记录.html">
            
                <a href="CPU_MIPS_octeon操作记录.html">
            
                    
                    octeon 操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3.3" data-path="CPU_MIPS_octeon_包处理性能.html">
            
                <a href="CPU_MIPS_octeon_包处理性能.html">
            
                    
                    octeon 系列处理器包处理性能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3.4" data-path="CPU_MIPS_octeon_ddr调试记录.html">
            
                <a href="CPU_MIPS_octeon_ddr调试记录.html">
            
                    
                    octeon DDR调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3.5" data-path="CPU_MIPS_octeon_BDK.html">
            
                <a href="CPU_MIPS_octeon_BDK.html">
            
                    
                    octeon CN78xx BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3.6" data-path="kernel_增加ECC中断.html">
            
                <a href="kernel_增加ECC中断.html">
            
                    
                    octeon 增加ECC中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3.7" data-path="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                <a href="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                    
                    octeon hw-ddr2代码走读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3.8" data-path="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                <a href="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                    
                    octeon reboot调试和DDR中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3.9" data-path="CPU_MIPS_octeon中断.html">
            
                <a href="CPU_MIPS_octeon中断.html">
            
                    
                    octeon 中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3.10" data-path="CPU_MIPS_octeon原子操作.html">
            
                <a href="CPU_MIPS_octeon原子操作.html">
            
                    
                    octeon 原子操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3.11" data-path="CPU_MIPS_octeon网口代码分析.html">
            
                <a href="CPU_MIPS_octeon网口代码分析.html">
            
                    
                    octeon 网口代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="" target="_blank" class="gitbook-link">
            Author: Bai Yingjie
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >libc概览3</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;"><b>1. </b>&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;</a></li><ul><li><span class="title-icon "></span><a href="#&#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal"><b>1.1. </b>&#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal</a></li><li><span class="title-icon "></span><a href="#&#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;"><b>1.2. </b>&#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;</a></li></ul><li><span class="title-icon "></span><a href="#signal"><b>2. </b>signal</a></li><ul><li><span class="title-icon "></span><a href="#&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal-&#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;"><b>2.1. </b>&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal, &#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;</a></li><li><span class="title-icon "></span><a href="#&#x7ED3;&#x675F;&#x7C7B;signal"><b>2.2. </b>&#x7ED3;&#x675F;&#x7C7B;signal</a></li><li><span class="title-icon "></span><a href="#&#x5B9A;&#x65F6;&#x7C7B;signal"><b>2.3. </b>&#x5B9A;&#x65F6;&#x7C7B;signal</a></li><li><span class="title-icon "></span><a href="#&#x5F02;&#x6B65;signal-&#x9ED8;&#x8BA4;&#x5FFD;&#x7565;"><b>2.4. </b>&#x5F02;&#x6B65;signal, &#x9ED8;&#x8BA4;&#x5FFD;&#x7565;</a></li><li><span class="title-icon "></span><a href="#&#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal"><b>2.5. </b>&#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal</a></li><li><span class="title-icon "></span><a href="#&#x64CD;&#x4F5C;error-signal-&#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;"><b>2.6. </b>&#x64CD;&#x4F5C;error signal, &#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;</a></li><li><span class="title-icon "></span><a href="#&#x5176;&#x4ED6;signal"><b>2.7. </b>&#x5176;&#x4ED6;signal</a></li><li><span class="title-icon "></span><a href="#&#x6253;&#x5370;signal&#x7C7B;&#x578B;"><b>2.8. </b>&#x6253;&#x5370;signal&#x7C7B;&#x578B;</a></li><li><span class="title-icon "></span><a href="#signal&#x5904;&#x7406;"><b>2.9. </b>signal&#x5904;&#x7406;</a></li><li><span class="title-icon "></span><a href="#sigaction"><b>2.10. </b>sigaction</a></li><li><span class="title-icon "></span><a href="#signal&#x7684;flag"><b>2.11. </b>signal&#x7684;flag</a></li><li><span class="title-icon "></span><a href="#signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;"><b>2.12. </b>signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;</a></li><li><span class="title-icon "></span><a href="#signal&#x5904;&#x7406;&#x51FD;&#x6570;"><b>2.13. </b>signal&#x5904;&#x7406;&#x51FD;&#x6570;</a></li><li><span class="title-icon "></span><a href="#signal-handler&#x88AB;&#x6253;&#x65AD;"><b>2.14. </b>signal handler&#x88AB;&#x6253;&#x65AD;?</a></li><li><span class="title-icon "></span><a href="#signal&#x5408;&#x5E76;"><b>2.15. </b>signal&#x5408;&#x5E76;</a></li><li><span class="title-icon "></span><a href="#signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;"><b>2.16. </b>signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;</a></li><li><span class="title-icon "></span><a href="#&#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;"><b>2.17. </b>&#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;?</a></li><li><span class="title-icon "></span><a href="#&#x89E6;&#x53D1;signal"><b>2.18. </b>&#x89E6;&#x53D1;signal</a></li><li><span class="title-icon "></span><a href="#&#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal"><b>2.19. </b>&#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal</a></li><li><span class="title-icon "></span><a href="#kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;"><b>2.20. </b>kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;</a></li><li><span class="title-icon "></span><a href="#signal&#x7684;&#x963B;&#x585E;"><b>2.21. </b>signal&#x7684;&#x963B;&#x585E;</a></li><li><span class="title-icon "></span><a href="#&#x6B63;&#x5728;pending&#x7684;signal&#x5DF2;&#x5230;&#x8FBE;-&#x672A;&#x5904;&#x7406;"><b>2.22. </b>&#x6B63;&#x5728;pending&#x7684;signal(&#x5DF2;&#x5230;&#x8FBE;, &#x672A;&#x5904;&#x7406;)</a></li><li><span class="title-icon "></span><a href="#&#x7B49;&#x5F85;signal"><b>2.23. </b>&#x7B49;&#x5F85;signal</a></li><li><span class="title-icon "></span><a href="#signal&#x7684;&#x6808;"><b>2.24. </b>signal&#x7684;&#x6808;</a></li></ul><li><span class="title-icon "></span><a href="#&#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;"><b>3. </b>&#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;</a></li><ul><li><span class="title-icon "></span><a href="#&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getoptlong"><b>3.1. </b>&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getopt_long</a></li><li><span class="title-icon "></span><a href="#&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argpparse"><b>3.2. </b>&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argp_parse</a></li><li><span class="title-icon "></span><a href="#&#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;"><b>3.3. </b>&#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;</a></li><li><span class="title-icon "></span><a href="#&#x73AF;&#x5883;&#x53D8;&#x91CF;"><b>3.4. </b>&#x73AF;&#x5883;&#x53D8;&#x91CF;</a></li><li><span class="title-icon "></span><a href="#syscall"><b>3.5. </b>syscall</a></li><li><span class="title-icon "></span><a href="#&#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;"><b>3.6. </b>&#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;</a></li></ul><li><span class="title-icon "></span><a href="#&#x8FDB;&#x7A0B;"><b>4. </b>&#x8FDB;&#x7A0B;</a></li><ul><li><span class="title-icon "></span><a href="#fork"><b>4.1. </b>fork</a></li><li><span class="title-icon "></span><a href="#exec"><b>4.2. </b>exec</a></li><li><span class="title-icon "></span><a href="#&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;"><b>4.3. </b>&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;</a></li><li><span class="title-icon "></span><a href="#&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;"><b>4.4. </b>&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;</a></li></ul><li><span class="title-icon "></span><a href="#job&#x63A7;&#x5236;"><b>5. </b>job&#x63A7;&#x5236;</a></li><ul><li><span class="title-icon "></span><a href="#&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;"><b>5.1. </b>&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;(&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;?)</a></li><li><span class="title-icon "></span><a href="#&#x8FDB;&#x7A0B;&#x7EC4;api"><b>5.2. </b>&#x8FDB;&#x7A0B;&#x7EC4;api</a></li><li><span class="title-icon "></span><a href="#&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell"><b>5.3. </b>&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell</a></li></ul><li><span class="title-icon "></span><a href="#include-"><b>6. </b>include </a></li><li><span class="title-icon "></span><a href="#include-_1"><b>7. </b>include </a></li><li><span class="title-icon "></span><a href="#include-_2"><b>8. </b>include </a></li><li><span class="title-icon "></span><a href="#&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;"><b>9. </b>&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;</a></li><li><span class="title-icon "></span><a href="#&#x8C03;&#x8BD5;"><b>10. </b>&#x8C03;&#x8BD5;</a></li><ul><li><span class="title-icon "></span><a href="#&#x8C03;&#x7528;&#x6808;"><b>10.1. </b>&#x8C03;&#x7528;&#x6808;</a></li></ul><li><span class="title-icon "></span><a href="#pthread"><b>11. </b>pthread</a></li><ul><li><span class="title-icon "></span><a href="#gnu&#x6269;&#x5C55;"><b>11.1. </b>gnu&#x6269;&#x5C55;</a></li></ul><li><span class="title-icon "></span><a href="#libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;&#x7565;"><b>12. </b>libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;(&#x7565;)</a></li><li><span class="title-icon "></span><a href="#libc&#x57FA;&#x7840;&#x51FD;&#x6570;"><b>13. </b>libc&#x57FA;&#x7840;&#x51FD;&#x6570;</a></li></ul></div><a href="#&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><ul>
<li><a href="#&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;">&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;</a><ul>
<li><a href="#&#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal">&#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal</a></li>
<li><a href="#&#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;">&#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;</a></li>
</ul>
</li>
<li><a href="#signal">signal</a><ul>
<li><a href="#&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal-&#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;">&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal, &#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;</a></li>
<li><a href="#&#x7ED3;&#x675F;&#x7C7B;signal">&#x7ED3;&#x675F;&#x7C7B;signal</a></li>
<li><a href="#&#x5B9A;&#x65F6;&#x7C7B;signal">&#x5B9A;&#x65F6;&#x7C7B;signal</a></li>
<li><a href="#&#x5F02;&#x6B65;signal-&#x9ED8;&#x8BA4;&#x5FFD;&#x7565;">&#x5F02;&#x6B65;signal, &#x9ED8;&#x8BA4;&#x5FFD;&#x7565;</a></li>
<li><a href="#&#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal">&#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal</a></li>
<li><a href="#&#x64CD;&#x4F5C;error-signal-&#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;">&#x64CD;&#x4F5C;error signal, &#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;</a></li>
<li><a href="#&#x5176;&#x4ED6;signal">&#x5176;&#x4ED6;signal</a></li>
<li><a href="#&#x6253;&#x5370;signal&#x7C7B;&#x578B;">&#x6253;&#x5370;signal&#x7C7B;&#x578B;</a></li>
<li><a href="#signal&#x5904;&#x7406;">signal&#x5904;&#x7406;</a></li>
<li><a href="#sigaction">sigaction</a></li>
<li><a href="#signal&#x7684;flag">signal&#x7684;flag</a></li>
<li><a href="#signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;">signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;</a></li>
<li><a href="#signal&#x5904;&#x7406;&#x51FD;&#x6570;">signal&#x5904;&#x7406;&#x51FD;&#x6570;</a></li>
<li><a href="#signal-handler&#x88AB;&#x6253;&#x65AD;">signal handler&#x88AB;&#x6253;&#x65AD;?</a></li>
<li><a href="#signal&#x5408;&#x5E76;">signal&#x5408;&#x5E76;</a></li>
<li><a href="#signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;">signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;</a></li>
<li><a href="#&#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;">&#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;?</a></li>
<li><a href="#&#x89E6;&#x53D1;signal">&#x89E6;&#x53D1;signal</a></li>
<li><a href="#&#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal">&#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal</a></li>
<li><a href="#kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;">kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;</a></li>
<li><a href="#signal&#x7684;&#x963B;&#x585E;">signal&#x7684;&#x963B;&#x585E;</a></li>
<li><a href="#&#x6B63;&#x5728;pending&#x7684;signal&#x5DF2;&#x5230;&#x8FBE;-&#x672A;&#x5904;&#x7406;">&#x6B63;&#x5728;pending&#x7684;signal(&#x5DF2;&#x5230;&#x8FBE;, &#x672A;&#x5904;&#x7406;)</a></li>
<li><a href="#&#x7B49;&#x5F85;signal">&#x7B49;&#x5F85;signal</a></li>
<li><a href="#signal&#x7684;&#x6808;">signal&#x7684;&#x6808;</a></li>
</ul>
</li>
<li><a href="#&#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;">&#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;</a><ul>
<li><a href="#&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getopt_long">&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getopt_long</a></li>
<li><a href="#&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argp_parse">&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argp_parse</a></li>
<li><a href="#&#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;">&#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;</a></li>
<li><a href="#&#x73AF;&#x5883;&#x53D8;&#x91CF;">&#x73AF;&#x5883;&#x53D8;&#x91CF;</a></li>
<li><a href="#syscall">syscall</a></li>
<li><a href="#&#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;">&#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;</a></li>
</ul>
</li>
<li><a href="#&#x8FDB;&#x7A0B;">&#x8FDB;&#x7A0B;</a><ul>
<li><a href="#fork">fork</a></li>
<li><a href="#exec">exec</a></li>
<li><a href="#&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;">&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;</a></li>
<li><a href="#&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;">&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;</a></li>
</ul>
</li>
<li><a href="#job&#x63A7;&#x5236;">job&#x63A7;&#x5236;</a><ul>
<li><a href="#&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;">&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;(&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;?)</a></li>
<li><a href="#&#x8FDB;&#x7A0B;&#x7EC4;api">&#x8FDB;&#x7A0B;&#x7EC4;api</a></li>
<li><a href="#&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell">&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell</a></li>
</ul>
</li>
<li><a href="#&#x7528;&#x6237;&#x548C;&#x7EC4;">&#x7528;&#x6237;&#x548C;&#x7EC4;</a><ul>
<li><a href="#api">api</a></li>
</ul>
</li>
<li><a href="#&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;">&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;</a></li>
<li><a href="#&#x8C03;&#x8BD5;">&#x8C03;&#x8BD5;</a><ul>
<li><a href="#&#x8C03;&#x7528;&#x6808;">&#x8C03;&#x7528;&#x6808;</a></li>
</ul>
</li>
<li><a href="#pthread">pthread</a><ul>
<li><a href="#gnu&#x6269;&#x5C55;">gnu&#x6269;&#x5C55;</a></li>
</ul>
</li>
<li><a href="#libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;&#x7565;">libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;(&#x7565;)</a></li>
<li><a href="#libc&#x57FA;&#x7840;&#x51FD;&#x6570;">libc&#x57FA;&#x7840;&#x51FD;&#x6570;</a></li>
</ul>
<h1 id="&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;"><a name="&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;" class="anchor-navigation-ex-anchor" href="#&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;"><i class="fa fa-link" aria-hidden="true"></i></a>1. &#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;</h1>
<pre><code class="lang-c">#include &lt;setjmp.h&gt;
//&#x7ED3;&#x6784;&#x4F53;, &#x7528;&#x6765;&#x4FDD;&#x5B58;&#x4E0A;&#x4E0B;&#x6587;
jmp_buf
/*&#x8FD4;&#x56DE;0&#x8868;&#x793A;&#x8BBE;&#x7F6E;jmp_buf&#x6210;&#x529F;
**&#x975E;&#x96F6;&#x503C;&#x8868;&#x793A;&#x6709;&#x4E00;&#x6B21;&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;, &#x503C;&#x662F;longjmp&#x7ED9;&#x51FA;&#x7684;
**&#x5B9E;&#x9645;&#x4E0A;, segjump&#x662F;&#x4E2A;&#x5B8F;
*/
int setjmp (jmp buf state)
void longjmp (jmp buf state, int value)
</code></pre>
<p>&#x4E3E;&#x4F8B;:</p>
<pre><code class="lang-c">#include &lt;setjmp.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
jmp_buf main_loop;
void
abort_to_main_loop(int status)
{
    longjmp(main_loop, status);
}
int
main(void)
{
    while (1)
        if (setjmp(main_loop))
            puts(&quot;Back at main loop....&quot;);
        else
            do_command();
}
void
do_command(void)
{
    char buffer[128];

    if (fgets(buffer, 128, stdin) == NULL)
        abort_to_main_loop(-1);
    else
        exit(EXIT_SUCCESS);
}
</code></pre>
<h2 id="&#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal"><a name="&#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal" class="anchor-navigation-ex-anchor" href="#&#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. &#x9ED8;&#x8BA4;&#x4E0D;&#x6539;&#x53D8;signal</h2>
<p>&#x4F46;&#x4E5F;&#x53EF;&#x4EE5;&#x4FDD;&#x5B58;&#x5F53;&#x65F6;&#x7684;signal, &#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;&#x65F6;&#x6062;&#x590D;</p>
<pre><code class="lang-c">#include &lt;setjmp.h&gt;
//&#x7ED3;&#x6784;&#x4F53;
sigjmp_buf
//savesigs&#x662F;&#x8981;&#x4FDD;&#x5B58;&#x7684;&#x5F53;&#x65F6;&#x7684;signal set
int sigsetjmp (sigjmp buf state, int savesigs)
//signal&#x5728;longjump&#x65F6;&#x4F1A;&#x6062;&#x590D;
void siglongjmp (sigjmp buf state, int value)
</code></pre>
<h2 id="&#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;"><a name="&#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;" class="anchor-navigation-ex-anchor" href="#&#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. &#x5B8C;&#x5168;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x63A7;&#x5236;</h2>
<pre><code class="lang-c">#include &lt;ucontext.h&gt;
//&#x6BD4;jmp_buf&#x4FE1;&#x606F;&#x66F4;&#x591A;, &#x5F00;&#x9500;&#x4E5F;&#x66F4;&#x5927;
ucontext_t
    ucontext_t *uc_link
    sigset_t uc_sigmask
    stack_t uc_stack
    mcontext_t uc_mcontext
//&#x521D;&#x59CB;&#x5316;&#x4E0A;&#x4E0B;&#x6587;ucp
int getcontext (ucontext t *ucp)
//&#x4FEE;&#x6539;&#x4E0A;&#x4E0B;&#x6587;
void makecontext (ucontext t *ucp, void (*func) (void), int argc, . . . )
//&#x6062;&#x590D;&#x4E0A;&#x4E0B;&#x6587;
int setcontext (const ucontext t *ucp)
//&#x4FDD;&#x5B58;&#x73B0;&#x5728;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x5230;oucp, &#x5E76;&#x5207;&#x6362;&#x5230;ucp
int swapcontext (ucontext t *restrict oucp, const ucontext t *restrict ucp)
</code></pre>
<p>&#x4E3E;&#x4F8B;:&#x573A;&#x666F;&#x662F;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x5F88;&#x590D;&#x6742;&#x7684;&#x641C;&#x7D22;&#x51FD;&#x6570;fn, &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x590D;&#x6742;&#x5230;&#x4E0D;&#x80FD;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x8FD4;&#x56DE;</p>
<pre><code class="lang-c">int
random_search(int n, int (*fp)(int, ucontext_t *))
{
    volatile int cnt = 0;
    ucontext_t uc;

    /* Safe current context. */
    if (getcontext(&amp;uc) &lt; 0)
        return -1;

    /* If we have not tried n times try again. */
    if (cnt++ &lt; n)

        /* Call the function with a new random number
        and the context. */
        if (fp(rand(), &amp;uc) != 0)
            /* We found what we were looking for. */
            return 1;

    /* Not found. */
    return 0;
}
</code></pre>
<p>&#x4E3E;&#x4F8B;:</p>
<pre><code class="lang-c">#include &lt;signal.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;ucontext.h&gt;
#include &lt;sys/time.h&gt;
/* Set by the signal handler. */
static volatile int expired;
/* The contexts. */
static ucontext_t uc[3];
/* We do only a certain number of switches. */
static int switches;
/* This is the function doing the work. It is just a
skeleton, real code has to be filled in. */
static void
f(int n)
{
    int m = 0;

    while (1) {
        /* This is where the work would be done. */
        if (++m % 100 == 0) {
            putchar(&#x2019;.&#x2019;);
            fflush(stdout);
        }

        /* Regularly the expire variable must be checked. */
        if (expired) {
            /* We do not want the program to run forever. */
            if (++switches == 20)
                return;

            printf(&quot;\nswitching from %d to %d\n&quot;, n, 3 - n);
            expired = 0;
            /* Switch to the other context, saving the current one. */
            swapcontext(&amp;uc[n], &amp;uc[3 - n]);
        }
    }
}
/* This is the signal handler which simply set the variable. */
void
handler(int signal)
{
    expired = 1;
}
int
main(void)
{
    struct sigaction sa;
    struct itimerval it;
    char st1[8192];
    char st2[8192];
    /* Initialize the data structures for the interval timer. */
    sa.sa_flags = SA_RESTART;
    sigfillset(&amp;sa.sa_mask);
    sa.sa_handler = handler;
    it.it_interval.tv_sec = 0;
    it.it_interval.tv_usec = 1;
    it.it_value = it.it_interval;

    /* Install the timer and get the context we can manipulate. */
    if (sigaction(SIGPROF, &amp;sa, NULL) &lt; 0
        || setitimer(ITIMER_PROF, &amp;it, NULL) &lt; 0
        || getcontext(&amp;uc[1]) == -1
        || getcontext(&amp;uc[2]) == -1)
        abort();

    /* Create a context with a separate stack which causes the
    function f to be call with the parameter 1.
    Note that the uc_link points to the main context
    which will cause the program to terminate once the function
    return. */
    uc[1].uc_link = &amp;uc[0];
    uc[1].uc_stack.ss_sp = st1;
    uc[1].uc_stack.ss_size = sizeof st1;
    makecontext(&amp;uc[1], (void (*)(void)) f, 1, 1);
    /* Similarly, but 2 is passed as the parameter to f. */
    uc[2].uc_link = &amp;uc[0];
    uc[2].uc_stack.ss_sp = st2;
    uc[2].uc_stack.ss_size = sizeof st2;
    makecontext(&amp;uc[2], (void (*)(void)) f, 1, 2);
    /* Start running. */
    swapcontext(&amp;uc[0], &amp;uc[1]);
    putchar(&#x2019;\n&#x2019;);
    return 0;
}
</code></pre>
<h1 id="signal"><a name="signal" class="anchor-navigation-ex-anchor" href="#signal"><i class="fa fa-link" aria-hidden="true"></i></a>2. signal</h1>
<ul>
<li>&#x7531;&#x7A0B;&#x5E8F;&#x81EA;&#x8EAB;&#x5F15;&#x8D77;&#x7684;error&#x89E6;&#x53D1;&#x7684;signal&#x4E00;&#x822C;&#x90FD;&#x662F;&#x540C;&#x6B65;&#x7684;</li>
<li>&#x5916;&#x90E8;&#x89E6;&#x53D1;&#x7684;signal&#x4E00;&#x822C;&#x90FD;&#x662F;&#x5F02;&#x6B65;&#x7684;.</li>
<li>&#x5982;&#x679C;&#x4E00;&#x4E2A;signal&#x6B63;&#x5728;&#x88AB;&#x5904;&#x7406;, &#x90A3;&#x5904;&#x7406;&#x671F;&#x95F4;&#x8FD9;&#x4E2A;&#x4FE1;&#x53F7;&#x662F;&#x963B;&#x585E;&#x7684;.</li>
<li>&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;signal&#x95F4;&#x9694;&#x5F88;&#x77ED;, one handler can run within another<h2 id="&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal-&#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;"><a name="&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal-&#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal-&#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. &#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x7C7B;signal, &#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;</h2>
</li>
<li>SIGFPE: &#x8FD0;&#x7B97;&#x9519;&#x8BEF;, &#x5305;&#x62EC;&#x9664;&#x96F6;&#x548C;&#x6D6E;&#x70B9;&#x5F02;&#x5E38;&#x7B49;&#x6240;&#x6709;&#x7684;&#x8FD0;&#x7B97;&#x9519;&#x8BEF;</li>
<li>SIGILL: &#x975E;&#x6CD5;&#x6307;&#x4EE4;, &#x53EF;&#x80FD;&#x662F;&#x7279;&#x6743;&#x6307;&#x4EE4;&#x6216;&#x6839;&#x672C;&#x4E0D;&#x662F;&#x6761;CPU&#x6307;&#x4EE4;</li>
<li>SIGSEGV: &#x8457;&#x540D;&#x7684;&#x6BB5;&#x9519;&#x8BEF;. &#x8BBF;&#x95EE;&#x975E;&#x6CD5;&#x6570;&#x636E;</li>
<li>SIGBUS: bus error. &#x53EF;&#x80FD;&#x662F;&#x8BBF;&#x95EE;&#x4E86;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x5730;&#x5740;, &#x6216;&#x5730;&#x5740;&#x4E0D;&#x5BF9;&#x9F50;</li>
<li>SIGABRT: &#x7A0B;&#x5E8F;&#x81EA;&#x5DF1;&#x8C03;&#x7528;&#x4E86;abort()</li>
<li>SIGTRAP: &#x65AD;&#x70B9;, &#x7528;&#x4E8E;debugger</li>
<li>SIGSYS: &#x975E;&#x6CD5;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;, &#x53EF;&#x80FD;&#x4E0D;&#x5B58;&#x5728;&#x8FD9;&#x4E2A;&#x8C03;&#x7528;&#x53F7;</li>
<li>SIGEMT: &#x865A;&#x62DF;&#x6307;&#x4EE4;&#x9519;&#x8BEF;?<h2 id="&#x7ED3;&#x675F;&#x7C7B;signal"><a name="&#x7ED3;&#x675F;&#x7C7B;signal" class="anchor-navigation-ex-anchor" href="#&#x7ED3;&#x675F;&#x7C7B;signal"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. &#x7ED3;&#x675F;&#x7C7B;signal</h2>
</li>
<li>SIGTERM: &#x793C;&#x8C8C;&#x7684;&#x8BA9;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;. &#x548C;SIGKILL&#x4E0D;&#x540C;, SIGTERM&#x53EF;&#x4EE5;&#x88AB;block, handle&#x548C;ignore.
&#x6CE8;: shell&#x4E0B;&#x7684;kill&#x547D;&#x4EE4;&#x9ED8;&#x8BA4;&#x662F;&#x53D1;SIGTERM&#x4FE1;&#x53F7;</li>
<li>SIGINT: ctrl+C, &#x7528;&#x6237;&#x4E2D;&#x65AD;&#x7A0B;&#x5E8F;&#x7684;&#x6267;&#x884C;</li>
<li>SIGQUIT: ctrl+\, &#x4F1A;&#x751F;&#x6210;coredump. &#x63A8;&#x8350;&#x6536;&#x5230;&#x8FD9;&#x4E2A;&#x4FE1;&#x53F7;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x6E05;&#x7406;&#x73B0;&#x573A;, &#x4EE5;&#x4FBF;&#x5B9A;&#x4F4D;.</li>
<li>SIGKILL: &#x9A6C;&#x4E0A;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;. &#x4E0D;&#x80FD;&#x88AB;&#x5904;&#x7406;&#x6216;&#x5FFD;&#x7565;, &#x4E5F;&#x4E0D;&#x4F1A;&#x963B;&#x585E;</li>
<li>SIGHUP: &#x4E00;&#x822C;&#x8868;&#x793A;&#x7528;&#x6237;&#x4E2D;&#x65AD;&#x4E86;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;<h2 id="&#x5B9A;&#x65F6;&#x7C7B;signal"><a name="&#x5B9A;&#x65F6;&#x7C7B;signal" class="anchor-navigation-ex-anchor" href="#&#x5B9A;&#x65F6;&#x7C7B;signal"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. &#x5B9A;&#x65F6;&#x7C7B;signal</h2>
</li>
<li>SIGALRM: &#x5B9A;&#x65F6;&#x5668;&#x65F6;&#x95F4;&#x5230;. &#x6BD4;&#x5982;alarm</li>
<li>SIGVTALRM: &#x865A;&#x62DF;&#x5B9A;&#x65F6;&#x5668;</li>
<li>SIGPROF: &#x6027;&#x80FD;&#x5206;&#x6790;<h2 id="&#x5F02;&#x6B65;signal-&#x9ED8;&#x8BA4;&#x5FFD;&#x7565;"><a name="&#x5F02;&#x6B65;signal-&#x9ED8;&#x8BA4;&#x5FFD;&#x7565;" class="anchor-navigation-ex-anchor" href="#&#x5F02;&#x6B65;signal-&#x9ED8;&#x8BA4;&#x5FFD;&#x7565;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4. &#x5F02;&#x6B65;signal, &#x9ED8;&#x8BA4;&#x5FFD;&#x7565;</h2>
</li>
<li>SIGIO: &#x5F02;&#x6B65;io, &#x9700;&#x8981;&#x5148;&#x7528;fcntl()&#x6765;&#x4F7F;&#x80FD;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;</li>
<li>SIGURG: socket&#x7684;urgent&#x4E8B;&#x4EF6;</li>
<li>SIGPOLL: &#x7C7B;&#x4F3C;SIGIO<h2 id="&#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal"><a name="&#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal" class="anchor-navigation-ex-anchor" href="#&#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal"><i class="fa fa-link" aria-hidden="true"></i></a>2.5. &#x4EFB;&#x52A1;&#x63A7;&#x5236;&#x7C7B;signal</h2>
</li>
<li>SIGCHLD SIGCLD: &#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;&#x6216;&#x505C;&#x6B62;&#x65F6;&#x53D1;&#x9001;&#x7ED9;&#x7236;&#x8FDB;&#x7A0B;, &#x9ED8;&#x8BA4;&#x5FFD;&#x7565;</li>
<li>SIGSTOP: &#x505C;&#x6B62;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;. &#x6CE8;&#x610F;&#x4E0D;&#x662F;&#x7EC8;&#x6B62;. &#x4E0D;&#x80FD;&#x963B;&#x585E;, &#x5904;&#x7406;&#x548C;&#x5FFD;&#x7565;</li>
<li>SIGTSTP: crtl+Z, &#x4E0E;SIGSTOP&#x4E0D;&#x540C;&#x7684;&#x662F;, &#x5B83;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x6216;&#x5FFD;&#x7565;. </li>
<li>SIGTTIN: &#x5904;&#x4E8E;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#x7684;&#x7A0B;&#x5E8F;&#x8BD5;&#x56FE;&#x4ECE;terminal&#x83B7;&#x53D6;&#x8F93;&#x5165;, &#x9ED8;&#x8BA4;&#x505C;&#x6B62;&#x8FDB;&#x7A0B;.<h2 id="&#x64CD;&#x4F5C;error-signal-&#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;"><a name="&#x64CD;&#x4F5C;error-signal-&#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#&#x64CD;&#x4F5C;error-signal-&#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.6. &#x64CD;&#x4F5C;error signal, &#x9ED8;&#x8BA4;&#x662F;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;</h2>
</li>
<li>SIGPIPE: &#x7BA1;&#x9053;error. &#x6BD4;&#x5982;&#x5728;&#x8BFB;open&#x4E4B;&#x524D;&#x5199;pipe, &#x6216;&#x5728;connect&#x4E4B;&#x524D;&#x5199;socket</li>
<li>SIGLOST: &#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#x610F;&#x5916;&#x7EC8;&#x6B62;</li>
<li>SIGXCPU: &#x8FDB;&#x7A0B;&#x8D85;&#x51FA;&#x8D44;&#x6E90;&#x9650;&#x5236;. &#x89C1;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;</li>
<li>SIGXFSZ: &#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x8D85;&#x51FA;&#x9650;&#x5236;<h2 id="&#x5176;&#x4ED6;signal"><a name="&#x5176;&#x4ED6;signal" class="anchor-navigation-ex-anchor" href="#&#x5176;&#x4ED6;signal"><i class="fa fa-link" aria-hidden="true"></i></a>2.7. &#x5176;&#x4ED6;signal</h2>
</li>
<li>SIGUSR1 SIGUSR2: &#x5E38;&#x7528;&#x4E8E;&#x7B80;&#x5355;&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;, &#x9ED8;&#x8BA4;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;</li>
<li>SIGWINCH: &#x7A97;&#x53E3;&#x5927;&#x5C0F;&#x6539;&#x53D8;. &#x9ED8;&#x8BA4;ignore</li>
<li>SIGINFO: ??<h2 id="&#x6253;&#x5370;signal&#x7C7B;&#x578B;"><a name="&#x6253;&#x5370;signal&#x7C7B;&#x578B;" class="anchor-navigation-ex-anchor" href="#&#x6253;&#x5370;signal&#x7C7B;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.8. &#x6253;&#x5370;signal&#x7C7B;&#x578B;</h2>
<pre><code class="lang-c">#include &lt;string.h&gt;
char * strsignal (int signum)
#include &lt;signal.h&gt;
void psignal (int signum, const char *message)
</code></pre>
</li>
</ul>
<h2 id="signal&#x5904;&#x7406;"><a name="signal&#x5904;&#x7406;" class="anchor-navigation-ex-anchor" href="#signal&#x5904;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>2.9. signal&#x5904;&#x7406;</h2>
<pre><code class="lang-c">#include &lt;signal.h&gt;
//sighandler_t
void handler (int signum) { ... }
/*&#x6CE8;&#x518C;handler, action&#x53EF;&#x4EE5;&#x662F;&#x4E2A;handler&#x51FD;&#x6570;, &#x4E5F;&#x53EF;&#x4EE5;&#x662F;SIG_DFL, SIG_IGN
**&#x6CE8;&#x610F;&#x4E0D;&#x540C;&#x7684;&#x7CFB;&#x7EDF;&#x6709;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;: BSD&#x6A21;&#x5F0F;, SVID&#x6A21;&#x5F0F;
**SVID&#x7CFB;&#x7EDF;&#x4E0B;&#x9762;, handler&#x53EA;&#x8FD0;&#x884C;&#x4E00;&#x6B21;, &#x7136;&#x540E;handler&#x4F1A;&#x88AB;deinstall
**BSD&#x7CFB;&#x7EDF;&#x4E0B;&#x9762;, handler&#x4E00;&#x76F4;&#x6709;&#x6548;
**GNU&#x7684;libc&#x662F;BSD&#x6A21;&#x5F0F;
*/
sighandler_t signal (int signum, sighandler t action)
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x5982;&#x679C;&#x9ED8;&#x8BA4;&#x662F;ignore, &#x5219;&#x4E0D;&#x6539;&#x53D8;&#x5B83;&#x7684;&#x884C;&#x4E3A;</p>
<pre><code class="lang-c">#include &lt;signal.h&gt;
void
termination_handler(int signum)
{
    struct temp_file *p;

    for (p = temp_file_list; p; p = p-&gt;next)
        unlink(p-&gt;name);
}
int
main(void)
{
    ...

    if (signal(SIGINT, termination_handler) == SIG_IGN)
        signal(SIGINT, SIG_IGN);

    if (signal(SIGHUP, termination_handler) == SIG_IGN)
        signal(SIGHUP, SIG_IGN);

    if (signal(SIGTERM, termination_handler) == SIG_IGN)
        signal(SIGTERM, SIG_IGN);

    ...
}
</code></pre>
<h2 id="sigaction"><a name="sigaction" class="anchor-navigation-ex-anchor" href="#sigaction"><i class="fa fa-link" aria-hidden="true"></i></a>2.10. sigaction</h2>
<pre><code class="lang-c">struct sigaction
    sighandler_t sa_handler
    sigset_t sa_mask //&#x5F53;sa_handler&#x6267;&#x884C;&#x65F6;, &#x9700;&#x8981;&#x963B;&#x585E;&#x7684;signal set
    int sa_flags
//&#x63A8;&#x8350;&#x7528;sigaction, action&#x4E3A;NULL&#x8868;&#x793A;&#x67E5;&#x8BE2;
int sigaction (int signum, const struct sigaction *restrict action, struct sigaction *restrict old-action)
</code></pre>
<p>&#x4E3E;&#x4F8B;:</p>
<pre><code class="lang-c">#include &lt;signal.h&gt;
void
termination_handler(int signum)
{
    struct temp_file *p;

    for (p = temp_file_list; p; p = p-&gt;next)
        unlink(p-&gt;name);
}
int
main(void)
{
    ...
    struct sigaction new_action, old_action;
    /* Set up the structure to specify the new action. */
    new_action.sa_handler = termination_handler;
    sigemptyset(&amp;new_action.sa_mask);
    new_action.sa_flags = 0;
    sigaction(SIGINT, NULL, &amp;old_action);

    if (old_action.sa_handler != SIG_IGN)
        sigaction(SIGINT, &amp;new_action, NULL);

    sigaction(SIGHUP, NULL, &amp;old_action);

    if (old_action.sa_handler != SIG_IGN)
        sigaction(SIGHUP, &amp;new_action, NULL);

    sigaction(SIGTERM, NULL, &amp;old_action);

    if (old_action.sa_handler != SIG_IGN)
        sigaction(SIGTERM, &amp;new_action, NULL);

    ...
}
</code></pre>
<h2 id="signal&#x7684;flag"><a name="signal&#x7684;flag" class="anchor-navigation-ex-anchor" href="#signal&#x7684;flag"><i class="fa fa-link" aria-hidden="true"></i></a>2.11. signal&#x7684;flag</h2>
<ul>
<li>SA_NOCLDSTOP: &#x53EA;&#x5BF9;SIGCHLD&#x6709;&#x6548;. &#x53EA;&#x62A5;&#x544A;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;</li>
<li>SA_ONSTACK: &#x4E0D;&#x4F7F;&#x7528;signal&#x6808;.</li>
<li>SA_RESTART: &#x88AB;signal&#x6253;&#x65AD;&#x7684;&#x5E93;&#x51FD;&#x6570;&#x4F1A;resume, &#x5426;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x5931;&#x8D25;, &#x6B64;&#x65F6;error&#x662F;EINTR.<h2 id="signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;"><a name="signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;" class="anchor-navigation-ex-anchor" href="#signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;"><i class="fa fa-link" aria-hidden="true"></i></a>2.12. signal&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;</h2>
&#x4E00;&#x822C;&#x90FD;&#x662F;&#x4ECE;&#x7236;&#x8FDB;&#x7A0B;&#x7EE7;&#x627F;&#x7684;, &#x4F46;&#x5982;&#x679C;&#x5B50;&#x8FDB;&#x7A0B;&#x7528;exec*&#x6765;&#x6267;&#x884C;&#x5176;&#x4ED6;&#x7A0B;&#x5E8F;, &#x5219;signal&#x4F1A;&#x88AB;&#x521D;&#x59CB;&#x5316;&#x4E3A;&#x9ED8;&#x8BA4;&#x72B6;&#x6001;.
&#x4E3E;&#x4F8B;: &#x5728;signal&#x4E0D;&#x662F;&#x88AB;ignore&#x7684;&#x65F6;&#x5019;&#x624D;&#x7528;sigaction.
&#x662F;&#x5426;&#x56E0;&#x4E3A;&#x4E00;&#x65E6;signal&#x88AB;ignore&#x8FC7;, &#x90A3;&#x4E48;&#x5373;&#x4F7F;&#x91CD;&#x65B0;&#x8C03;&#x7528;sigaction&#x4E5F;&#x4E0D;&#x4F1A;&#x751F;&#x6548;?--&#x7ECF;&#x8FC7;&#x9A8C;&#x8BC1;, &#x4E0D;&#x662F;<pre><code class="lang-c">struct sigaction temp;
sigaction (SIGHUP, NULL, &amp;temp);
if (temp.sa_handler != SIG_IGN)
{
temp.sa_handler = handle_sighup;
sigemptyset (&amp;temp.sa_mask);
sigaction (SIGHUP, &amp;temp, NULL);
}
</code></pre>
</li>
</ul>
<h2 id="signal&#x5904;&#x7406;&#x51FD;&#x6570;"><a name="signal&#x5904;&#x7406;&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#signal&#x5904;&#x7406;&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>2.13. signal&#x5904;&#x7406;&#x51FD;&#x6570;</h2>
<ul>
<li>handler&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x5168;&#x5C40;&#x53D8;&#x91CF;, &#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x5E94;&#x8BE5;&#x662F;sig_atomic_t &#x7C7B;&#x578B;</li>
<li>handler&#x53EF;&#x4EE5;return</li>
<li>handler&#x53EF;&#x4EE5;&#x7EC8;&#x6B62;&#x7A0B;&#x5E8F;</li>
<li><p>handler&#x53EF;&#x4EE5;&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;
&#x4E3E;&#x4F8B;: return&#x7684;&#x60C5;&#x51B5;</p>
<pre><code class="lang-c">#include &lt;signal.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
/* This flag controls termination of the main loop. */
volatile sig_atomic_t keep_going = 1;
/* The signal handler just clears the flag and re-enables itself. */
void
catch_alarm(int sig)
{
 keep_going = 0;
 signal(sig, catch_alarm);
}
void
do_stuff(void)
{
 puts(&quot;Doing stuff while waiting for alarm....&quot;);
}
int
main(void)
{
 /* Establish a handler for SIGALRM signals. */
 signal(SIGALRM, catch_alarm);
 /* Set an alarm to go off in a little while. */
 alarm(2);

 /* Check the flag once in a while to see when to quit. */
 while (keep_going)
     do_stuff();

 return EXIT_SUCCESS;
}
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x7EC8;&#x6B62;&#x7684;&#x60C5;&#x51B5;</p>
<pre><code class="lang-c">volatile sig_atomic_t fatal_error_in_progress = 0;
void
fatal_error_signal(int sig)
{
 /* Since this handler is established for more than one kind of signal,
 it might still get invoked recursively by delivery of some other kind
 of signal. Use a static variable to keep track of that. */
 if (fatal_error_in_progress)
     raise(sig);

 fatal_error_in_progress = 1;
 /* Now do the clean up actions:
 - reset terminal modes
 - kill child processes
 - remove lock files */
 ...
 /* Now reraise the signal. We reactivate the signal&#x2019;s
 default handling, which is to terminate the process.
 We could just call exit or abort,
 but reraising the signal sets the return status
 from the process correctly. */
 signal(sig, SIG_DFL);
 raise(sig);
}
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;&#x7684;&#x60C5;&#x51B5;. 
&#x6CE8;&#x610F;&#x7531;&#x4E8E;&#x4E00;&#x4E9B;&#x91CD;&#x8981;&#x7684;&#x7ED3;&#x6784;&#x4F53;&#x6216;&#x53D8;&#x91CF;&#x53EF;&#x80FD;&#x8FD8;&#x6CA1;&#x6709;&#x4FEE;&#x6539;&#x5B8C;&#x6BD5;&#x5C31;&#x88AB;signal&#x6253;&#x65AD;, &#x6B64;&#x65F6;&#x5982;&#x679C;&#x8FDB;&#x884C;&#x975E;&#x672C;&#x5730;&#x8DF3;&#x8F6C;&#x7684;&#x8BDD;, &#x90A3;&#x4E9B;&#x91CD;&#x8981;&#x7ED3;&#x6784;&#x53EF;&#x80FD;&#x4E0D;&#x5B8C;&#x6574;, &#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x6709;&#x4E24;&#x79CD;&#x529E;&#x6CD5;&#x53EF;&#x4EE5;&#x907F;&#x514D;:</p>
</li>
<li>&#x4E3B;&#x7A0B;&#x5E8F;&#x4FEE;&#x6539;&#x91CD;&#x8981;&#x53D8;&#x91CF;&#x65F6;&#x963B;&#x585E;signal</li>
<li><p>&#x5728;signal handler&#x91CC;&#x9762;&#x91CD;&#x65B0;&#x521D;&#x59CB;&#x5316;&#x8FD9;&#x4E9B;&#x91CD;&#x8981;&#x53D8;&#x91CF;</p>
<pre><code class="lang-c">#include &lt;signal.h&gt;
#include &lt;setjmp.h&gt;
jmp_buf return_to_top_level;
volatile sig_atomic_t waiting_for_input;
void
handle_sigint(int signum)
{
 /* We may have been waiting for input when the signal arrived,
 but we are no longer waiting once we transfer control. */
 waiting_for_input = 0;
 longjmp(return_to_top_level, 1);
}
int
main(void)
{
 ...
 signal(SIGINT, sigint_handler);
 ...

 while (1) {
     prepare_for_command();

     if (setjmp(return_to_top_level) == 0)
         read_and_execute_command();
 }
}
/* Imagine this is a subroutine used by various commands. */
char *
read_data()
{
 if (input_from_terminal) {
     waiting_for_input = 1;
     ...
     waiting_for_input = 0;
 } else {
     ...
 }
}
</code></pre>
</li>
</ul>
<h2 id="signal-handler&#x88AB;&#x6253;&#x65AD;"><a name="signal-handler&#x88AB;&#x6253;&#x65AD;" class="anchor-navigation-ex-anchor" href="#signal-handler&#x88AB;&#x6253;&#x65AD;"><i class="fa fa-link" aria-hidden="true"></i></a>2.14. signal handler&#x88AB;&#x6253;&#x65AD;?</h2>
<p>&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;handler&#x4F1A;&#x81EA;&#x52A8;block&#x5B83;&#x7684;signum, &#x4F46;&#x662F;&#x5176;&#x4ED6;&#x79CD;&#x7C7B;&#x7684;signal&#x4F9D;&#x7136;&#x53EF;&#x4EE5;&#x6253;&#x65AD;&#x5F53;&#x524D;&#x7684;handler.
&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;sigaction&#x6709;&#x4E2A;sa_mask&#x7684;&#x539F;&#x56E0;, &#x88AB;mask&#x7684;signal&#x4F1A;&#x88AB;&#x963B;&#x585E;.
sigprocmask&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x4E34;&#x65F6;&#x6539;&#x53D8;&#x8FD9;&#x4E2A;mask, &#x4F46;&#x53EA;&#x5728;handler&#x91CC;&#x9762;&#x751F;&#x6548;. &#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;handler return&#x4EE5;&#x540E;, mask&#x4F1A;&#x6062;&#x590D;.</p>
<h2 id="signal&#x5408;&#x5E76;"><a name="signal&#x5408;&#x5E76;" class="anchor-navigation-ex-anchor" href="#signal&#x5408;&#x5E76;"><i class="fa fa-link" aria-hidden="true"></i></a>2.15. signal&#x5408;&#x5E76;</h2>
<p>&#x540C;&#x7C7B;signal&#x5728;&#x6CA1;&#x5904;&#x7406;&#x4E4B;&#x524D;&#x4F1A;&#x88AB;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;, &#x6240;&#x4EE5;&#x5BF9;signal&#x7684;&#x8BA1;&#x6570;&#x662F;&#x4E0D;&#x51C6;&#x7684;. &#x5C24;&#x5176;&#x6CE8;&#x610F;&#x5BF9;SIGCHLD&#x662F;&#x5982;&#x6B64;.
&#x4E3E;&#x4F8B;: </p>
<pre><code class="lang-c">struct process {
    struct process *next;
    /* The process ID of this child. */
    int pid;
    /* The descriptor of the pipe or pseudo terminal
    on which output comes from this child. */
    int input_descriptor;
    /* Nonzero if this process has stopped or terminated. */
    sig_atomic_t have_status;
    /* The status of this child; 0 if running,
    otherwise a status value from waitpid. */
    int status;
};
struct process *process_list;
//This example also uses a flag to indicate whether signals have arrived since some time
//in the past&#x2014;whenever the program last cleared it to zero.
/* Nonzero means some child&#x2019;s status has changed
so look at process_list for the details. */
int process_status_change;
Here is the handler itself:
void
sigchld_handler(int signo)
{
    int old_errno = errno;

    while (1) {
        register int pid;
        int w;
        struct process *p;

        /* Keep asking for a status until we get a definitive result. */
        do {
            errno = 0;
            pid = waitpid(WAIT_ANY, &amp;w, WNOHANG | WUNTRACED);
        } while (pid &lt;= 0 &amp;&amp; errno == EINTR);

        if (pid &lt;= 0) {
            /* A real failure means there are no more
            stopped or terminated child processes, so return. */
            errno = old_errno;
            return;
        }

        /* Find the process that signaled us, and record its status. */
        for (p = process_list; p; p = p-&gt;next)
            if (p-&gt;pid == pid) {
                p-&gt;status = w;
                /* Indicate that the status field
                has data to look at. We do this only after storing it. */
                p-&gt;have_status = 1;

                /* If process has terminated, stop waiting for its output. */
                if (WIFSIGNALED(w) || WIFEXITED(w))
                    if (p-&gt;input_descriptor)
                        FD_CLR(p-&gt;input_descriptor, &amp;input_wait_mask);

                /* The program should check this flag from time to time
                to see if there is any news in process_list. */
                ++process_status_change;
            }

        /* Loop around to handle all the processes
        that have something to tell us. */
    }
}
//Here is the proper way to check the flag process_status_change:
if (process_status_change)
{
    struct process *p;
    process_status_change = 0;

    for (p = process_list; p; p = p-&gt;next)
        if (p-&gt;have_status) {
            ... Examine p-&gt;status ...
        }
}
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x4E3B;&#x7A0B;&#x5E8F;&#x600E;&#x4E48;&#x77E5;&#x9053;handler&#x8C03;&#x7528;&#x8FC7;&#x5462;? &#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x662F;&#x6709;&#x4E2A;&#x53D8;&#x91CF;, &#x53EA;&#x5728;handler&#x91CC;&#x9762;&#x6539;. &#x4E3B;&#x7A0B;&#x5E8F;&#x67E5;&#x8BE2;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;</p>
<pre><code class="lang-c">sig_atomic_t process_status_change;
sig_atomic_t last_process_status_change;
... {
    sig_atomic_t prev = last_process_status_change;
    last_process_status_change = process_status_change;

    if (last_process_status_change != prev)
    {
        struct process *p;

        for (p = process_list; p; p = p-&gt;next)
            if (p-&gt;have_status) {
                ... Examine p-&gt;status ...
            }
    }
}
</code></pre>
<h2 id="signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;"><a name="signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;" class="anchor-navigation-ex-anchor" href="#signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;"><i class="fa fa-link" aria-hidden="true"></i></a>2.16. signal&#x7684;&#x5904;&#x7406;&#x539F;&#x5219;</h2>
<p>&#x65F6;&#x523B;&#x8BB0;&#x4F4F;handler&#x7684;&#x5904;&#x7406;&#x662F;&#x5F02;&#x6B65;&#x7684;, &#x53EF;&#x80FD;&#x5728;&#x4EFB;&#x4F55;&#x65F6;&#x95F4;&#x70B9;&#x6253;&#x65AD;&#x4E3B;&#x7A0B;&#x5E8F;, &#x5305;&#x62EC;&#x5173;&#x952E;&#x6570;&#x636E;&#x6B63;&#x5728;&#x6539;&#x5199;&#x8FC7;&#x7A0B;&#x4E2D;, &#x6216;&#x4E0D;&#x53EF;&#x91CD;&#x5165;&#x7684;&#x51FD;&#x6570;&#x6B63;&#x5728;&#x6267;&#x884C;&#x4E2D;&#x7B49;&#x7B49;, &#x751A;&#x81F3;&#x4E00;&#x4E2A;&#x6574;&#x5F62;&#x53D8;&#x91CF;&#x6B63;&#x5728;&#x88AB;&#x8D4B;&#x503C;.
&#x6700;&#x597D;&#x7684;&#x60C5;&#x51B5;&#x4E0B;, handler&#x53EA;&#x662F;&#x5BF9;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x8D4B;&#x503C;, &#x771F;&#x6B63;&#x7684;&#x4E8B;&#x60C5;, &#x9700;&#x8981;&#x7B49;&#x5230;&#x4E3B;&#x7A0B;&#x5E8F;&#x68C0;&#x6D4B;&#x5230;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x53D8;&#x5316;&#x4EE5;&#x540E;&#x518D;&#x5904;&#x7406;.
&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;, &#x4E00;&#x4E2A;&#x4E0D;&#x53EF;&#x91CD;&#x5165;&#x7684;&#x51FD;&#x6570;, &#x4E5F;&#x4E0D;&#x662F;&#x4E00;&#x5B9A;&#x4E0D;&#x80FD;&#x5728;handler&#x91CC;&#x9762;&#x4F7F;&#x7528;, &#x8981;&#x4F7F;&#x7528;&#x5B83;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x4E00;&#x4E2A;&#x524D;&#x63D0;:
&#x4FDD;&#x8BC1;&#x4E3B;&#x7A0B;&#x5E8F;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x4F1A;&#x88AB;handler&#x6253;&#x65AD;, &#x600E;&#x4E48;&#x4FDD;&#x8BC1;&#x5462;?</p>
<ul>
<li>&#x4E3B;&#x7A0B;&#x5E8F;&#x6839;&#x672C;&#x4E0D;&#x4F1A;&#x8C03;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;, &#x6216;&#x7C7B;&#x4F3C;&#x7684;&#x51FD;&#x6570;</li>
<li>&#x4E3B;&#x7A0B;&#x5E8F;&#x8C03;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x65F6;&#x663E;&#x5F0F;&#x963B;&#x585E;&#x5F71;&#x54CD;&#x5B83;&#x7684;signal
&#x4E0B;&#x9762;&#x662F;handler&#x7684;&#x4E00;&#x4E9B;&#x57FA;&#x672C;&#x539F;&#x5219;:</li>
<li>handler&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x6210;volatile, &#x548C;sig_atomic_t(&#x5176;&#x5B9E;&#x5C31;&#x662F;int, &#x56E0;&#x4E3A;int&#x7684;&#x8BFB;&#x5199;&#x662F;&#x539F;&#x5B50;&#x7684;)?</li>
<li>&#x6BD4;&#x5982;gethostbyname&#x8FD9;&#x4E2A;&#x51FD;&#x6570;, &#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x53D8;&#x91CF;, &#x8FD9;&#x9759;&#x6001;&#x53D8;&#x91CF;&#x53EF;&#x80FD;&#x4E0B;&#x6B21;&#x8C03;&#x7528;gethostbyname&#x5C31;&#x53D8;&#x4E86;.
&#x6B64;&#x65F6;&#x5047;&#x8BBE;&#x4E3B;&#x7A0B;&#x5E8F;&#x6B63;&#x5728;&#x8C03;&#x7528;gethostbyname&#x8FD8;&#x6CA1;&#x8FD4;&#x56DE;, &#x88AB;signal&#x6253;&#x65AD;&#x4E86;, handler&#x91CC;&#x9762;&#x4E5F;&#x8C03;&#x4E86;gethostbyname, &#x90A3;&#x4E48;&#x4E3B;&#x7A0B;&#x5E8F;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5C31;&#x4E0D;&#x5BF9;&#x4E86;.</li>
<li>&#x6BD4;&#x5982;printf, &#x5176;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;, &#x5728;&#x4E3B;&#x7A0B;&#x5E8F;&#x548C;handler&#x91CC;&#x9762;&#x540C;&#x65F6;&#x8C03;&#x7528;&#x4F1A;&#x4E92;&#x76F8;&#x5E72;&#x6270;.</li>
<li>malloc&#x548C;free&#x4E5F;&#x4E0D;&#x53EF;&#x91CD;&#x5165;, &#x5728;handler&#x4F7F;&#x7528;&#x7684;&#x5185;&#x5B58;&#x53EF;&#x4EE5;&#x9884;&#x5148;&#x5728;&#x4E3B;&#x7A0B;&#x5E8F;&#x7533;&#x8BF7;&#x597D;.</li>
<li><p>errno&#x4E5F;&#x4E0D;&#x53EF;&#x91CD;&#x5165;, &#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x5728;handler&#x5F00;&#x59CB;&#x5148;&#x4FDD;&#x5B58;errno, &#x6700;&#x540E;&#x6062;&#x590D;&#x5B83;.
&#x5176;&#x5B9E;&#x8FD9;&#x62DB;&#x4E5F;&#x5F88;&#x901A;&#x7528;, &#x5982;&#x679C;&#x4E3B;&#x7A0B;&#x5E8F;&#x548C;handler&#x8981;&#x4FEE;&#x6539;&#x540C;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;, &#x5728;handler&#x91CC;&#x9762;&#x5148;&#x4FDD;&#x5B58;&#x518D;&#x6062;&#x590D;.
&#x9519;&#x8BEF;&#x4E3E;&#x4F8B;: &#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x91CC;&#x9762;, &#x4E3B;&#x7A0B;&#x5E8F;&#x4E0D;&#x65AD;&#x7684;&#x7ED9;memory&#x8D4B;&#x503C;, handler&#x91CC;&#x9762;&#x53EF;&#x80FD;&#x4F1A;&#x6253;&#x51FA;0,1&#x6216;1,0.</p>
<pre><code class="lang-c">#include &lt;signal.h&gt;
#include &lt;stdio.h&gt;
volatile struct two_words {
 int a, b;
} memory;
void
handler(int signum)
{
//printf is safe here because main not use it
 printf(&quot;%d,%d\n&quot;, memory.a, memory.b);
 alarm(1);
}
int
main(void)
{
 static struct two_words zeros = { 0, 0 }, ones = { 1, 1 };
 signal(SIGALRM, handler);
 memory = zeros;
 alarm(1);

 while (1) {
     memory = zeros;
     memory = ones;
 }
}
</code></pre>
</li>
</ul>
<h2 id="&#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;"><a name="&#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;" class="anchor-navigation-ex-anchor" href="#&#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;"><i class="fa fa-link" aria-hidden="true"></i></a>2.17. &#x5E93;&#x51FD;&#x6570;&#x88AB;&#x6253;&#x65AD;?</h2>
<ul>
<li>&#x5E93;&#x51FD;&#x6570;&#x8FD4;&#x56DE;EINTR&#x8868;&#x793A;&#x88AB;&#x6253;&#x65AD;, &#x53EF;&#x4EE5;&#x7528;sigaction&#x7684;SA_RESTART&#x6765;&#x8BBE;&#x7F6E;&#x81EA;&#x52A8;&#x91CD;&#x8BD5;.
&#x4E5F;&#x53EF;&#x4EE5;TEMP_FAILURE_RETRY (expression)&#x91CD;&#x8BD5;</li>
<li>read&#x548C;write&#x4E0D;&#x53D7;SA_RESTART&#x63A7;&#x5236;, &#x56E0;&#x4E3A;&#x53EF;&#x80FD;&#x6709;&#x90E8;&#x5206;&#x7684;&#x6570;&#x636E;&#x5DF2;&#x7ECF;&#x4F20;&#x9001;&#x5B8C;&#x6BD5;&#x4E86;. 
&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x901A;&#x8FC7;&#x8FD4;&#x56DE;&#x503C;&#x6765;&#x8868;&#x793A;&#x5DF2;&#x7ECF;&#x4F20;&#x9001;&#x7684;&#x5B57;&#x8282;&#x6570;, &#x8868;&#x793A;&quot;&#x90E8;&#x5206;&#x6210;&#x529F;&quot;<h2 id="&#x89E6;&#x53D1;signal"><a name="&#x89E6;&#x53D1;signal" class="anchor-navigation-ex-anchor" href="#&#x89E6;&#x53D1;signal"><i class="fa fa-link" aria-hidden="true"></i></a>2.18. &#x89E6;&#x53D1;signal</h2>
<pre><code class="lang-c">//&#x5411;&#x81EA;&#x5DF1;&#x53D1;signal
int raise (int signum)
</code></pre>
&#x5178;&#x578B;&#x7684;&#x5E94;&#x7528;&#x662F;&#x5728;handler&#x91CC;&#x9762;&#x518D;&#x6B21;&#x89E6;&#x53D1;signal:<pre><code class="lang-c">#include &lt;signal.h&gt;
/* When a stop signal arrives, set the action back to the default
and then resend the signal after doing cleanup actions. */
void
tstp_handler(int sig)
{
 signal(SIGTSTP, SIG_DFL);
 /* Do cleanup actions here. */
 ...
 raise(SIGTSTP);
}
/* When the process is continued again, restore the signal handler. */
void
cont_handler(int sig)
{
 signal(SIGCONT, cont_handler);
 signal(SIGTSTP, tstp_handler);
}
/* Enable both handlers during program initialization. */
int
main(void)
{
 signal(SIGCONT, cont_handler);
 signal(SIGTSTP, tstp_handler);
 ...
}
</code></pre>
</li>
</ul>
<h2 id="&#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal"><a name="&#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal" class="anchor-navigation-ex-anchor" href="#&#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal"><i class="fa fa-link" aria-hidden="true"></i></a>2.19. &#x5411;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53D1;signal</h2>
<pre><code class="lang-c">/* pid &gt; 0         &#x6B63;&#x5E38;&#x7684;pid
** pid == 0       &#x540C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7EC4;&#x7684;&#x6240;&#x6709;&#x8FDB;&#x7A0B;
** pid &lt; -1        -pid&#x7684;&#x8FDB;&#x7A0B;&#x7EC4;
** pid == -1      &#x5411;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#x53D1;(root&#x6743;&#x9650;), &#x5411;&#x540C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x7684;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#x53D1;
** &#x4F7F;&#x7528;kill&#x6709;&#x6743;&#x9650;&#x8981;&#x6C42;, root&#x6216;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x7684;&#x8FDB;&#x7A0B;
*/
int kill (pid t pid, int signum)
</code></pre>
<h2 id="kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;"><a name="kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;" class="anchor-navigation-ex-anchor" href="#kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;"><i class="fa fa-link" aria-hidden="true"></i></a>2.20. kill&#x7528;&#x4E8E;&#x8FDB;&#x7A0B;&#x95F4;&#x540C;&#x6B65;</h2>
<pre><code class="lang-c">#include &lt;signal.h&gt;
#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;
/* When a SIGUSR1 signal arrives, set this variable. */
volatile sig_atomic_t usr_interrupt = 0;
void
synch_signal(int sig)
{
    usr_interrupt = 1;
}
/* The child process executes this function. */
void
child_function(void)
{
    /* Perform initialization. */
    printf(&quot;I&apos;m herehistory! My pid is %d.\n&quot;, (int) getpid());
    /* Let parent know you&#x2019;re done. */
    kill(getppid(), SIGUSR1);
    /* Continue with execution. */
    puts(&quot;Bye, now....&quot;);
    exit(0);
}
int
main(void)
{
    struct sigaction usr_action;
    sigset_t block_mask;
    pid_t child_id;
    /* Establish the signal handler. */
    sigfillset(&amp;block_mask);
    usr_action.sa_handler = synch_signal;
    usr_action.sa_mask = block_mask;
    usr_action.sa_flags = 0;
    sigaction(SIGUSR1, &amp;usr_action, NULL);
    /* Create the child process. */
    child_id = fork();

    if (child_id == 0)
        child_function();  /* Does not return. */

    /* Busy wait for the child to send a signal. */
    while (!usr_interrupt)
        ;

    /* Now continue execution. */
    puts(&quot;That&#x2019;s all, folks!&quot;);
    return 0;
}
</code></pre>
<h2 id="signal&#x7684;&#x963B;&#x585E;"><a name="signal&#x7684;&#x963B;&#x585E;" class="anchor-navigation-ex-anchor" href="#signal&#x7684;&#x963B;&#x585E;"><i class="fa fa-link" aria-hidden="true"></i></a>2.21. signal&#x7684;&#x963B;&#x585E;</h2>
<ul>
<li>&#x7528;sigprocmask&#x53EF;&#x4EE5;&#x663E;&#x5F0F;&#x7684;&#x963B;&#x585E;signal, &#x7528;&#x4E8E;&#x4FDD;&#x62A4;&#x654F;&#x611F;&#x53D8;&#x91CF;</li>
<li><p>sigaction&#x7684;sa_mask&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x5728;&#x8FD0;&#x884C;handler&#x65F6;mask&#x6389;&#x76F8;&#x5E94;&#x7684;signal, &#x4F46;hander&#x5B8C;&#x6210;&#x540E;&#x4F1A;&#x6062;&#x590D;&#x539F;&#x6765;&#x7684;mask
&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x7528;&#x5230;sigset_t</p>
<pre><code class="lang-c">//&#x521D;&#x59CB;&#x5316;&#x4E3A;&#x5168;0&#x7684;set
int sigemptyset (sigset t *set)
//&#x521D;&#x59CB;&#x5316;&#x4E3A;&#x5168;1&#x7684;set
int sigfillset (sigset t *set)
//&#x6DFB;&#x52A0;
int sigaddset (sigset t *set, int signum)
//&#x5220;&#x9664;
int sigdelset (sigset t *set, int signum)
//&#x5224;&#x65AD;
int sigismember (const sigset t *set, int signum)
//&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x91CC;, &#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;signal mask, &#x800C;sigprocmask&#x7684;&#x884C;&#x4E3A;&#x662F;&#x4E0D;&#x786E;&#x5B9A;&#x7684;. &#x6B64;&#x65F6;&#x8981;&#x7528;pthread_sigmask
int sigprocmask (int how, const sigset t *restrict set, sigset t *restrict oldset)
&#x4E3E;&#x4F8B;: 
```c
/* This variable is set by the SIGALRM signal handler. */
volatile sig_atomic_t flag = 0;
int
main(void)
{
 sigset_t block_alarm;
 ...
 /* Initialize the signal mask. */
 sigemptyset(&amp;block_alarm);
 sigaddset(&amp;block_alarm, SIGALRM);

 while (1) {
     /* Check if a signal has arrived; if so, reset the flag. */
     sigprocmask(SIG_BLOCK, &amp;block_alarm, NULL);

     if (flag) {

         actions - if - not - arrived
         flag = 0;
 }

 sigprocmask(SIG_UNBLOCK, &amp;block_alarm, NULL);
     ...
 }
}
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x4FDD;&#x62A4;handler&#x4E0D;&#x88AB;&#x5176;&#x4ED6;signal&#x6253;&#x65AD;</p>
<pre><code class="lang-c">#include &lt;signal.h&gt;
#include &lt;stddef.h&gt;
void catch_stop();
void
install_handler(void)
{
 struct sigaction setup_action;
 sigset_t block_mask;
 sigemptyset(&amp;block_mask);
 /* Block other terminal-generated signals while handler runs. */
 sigaddset(&amp;block_mask, SIGINT);
 sigaddset(&amp;block_mask, SIGQUIT);
 setup_action.sa_handler = catch_stop;
 setup_action.sa_mask = block_mask;
 setup_action.sa_flags = 0;
 sigaction(SIGTSTP, &amp;setup_action, NULL);
}
</code></pre>
</li>
</ul>
<h2 id="&#x6B63;&#x5728;pending&#x7684;signal&#x5DF2;&#x5230;&#x8FBE;-&#x672A;&#x5904;&#x7406;"><a name="&#x6B63;&#x5728;pending&#x7684;signal&#x5DF2;&#x5230;&#x8FBE;-&#x672A;&#x5904;&#x7406;" class="anchor-navigation-ex-anchor" href="#&#x6B63;&#x5728;pending&#x7684;signal&#x5DF2;&#x5230;&#x8FBE;-&#x672A;&#x5904;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>2.22. &#x6B63;&#x5728;pending&#x7684;signal(&#x5DF2;&#x5230;&#x8FBE;, &#x672A;&#x5904;&#x7406;)</h2>
<pre><code class="lang-c">//&#x4E00;&#x822C;&#x7528;&#x4E0D;&#x5230;&#x8FD9;&#x51FD;&#x6570;, &#x9664;&#x975E;&#x662F;&#x5728;sigprocmask&#x6216;sa_mask&#x4FDD;&#x62A4;&#x7684;&#x4EE3;&#x7801;&#x91CC;
int sigpending (sigset t *set)
</code></pre>
<h2 id="&#x7B49;&#x5F85;signal"><a name="&#x7B49;&#x5F85;signal" class="anchor-navigation-ex-anchor" href="#&#x7B49;&#x5F85;signal"><i class="fa fa-link" aria-hidden="true"></i></a>2.23. &#x7B49;&#x5F85;signal</h2>
<pre><code class="lang-c">#include &lt;unistd.h&gt;
//&#x963B;&#x585E;&#x8FDB;&#x7A0B;&#x76F4;&#x5230;signal&#x6267;&#x884C;
int pause (void)
&#x9700;&#x8981;&#x6CE8;&#x610F;:
```c
/* usr_interrupt is set by the signal handler. */
if (!usr_interrupt)
    //&#x5982;&#x679C;&#x5728;&#x8FD9;&#x4E4B;&#x95F4;signal&#x6765;&#x4E86;, &#x5E76;&#x8BA9;usr_interrupt=1, &#x90A3;&#x4E48;&#x8FD9;&#x4E2A;signal&#x7684;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E0D;&#x4F1A;&#x5F97;&#x5230;&#x5904;&#x7406;.
    pause ();
/* Do work once the signal arrives. */
...
</code></pre>
<p>&#x53EF;&#x4EE5;&#x6539;&#x6210;&#x8FD9;&#x6837;: &#x4E0D;&#x7528;pause()</p>
<pre><code class="lang-c">/* usr_interrupt is set by the signal handler.
while (!usr_interrupt)
sleep (1);
/* Do work once the signal arrives. */
...
</code></pre>
<p>&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;:</p>
<pre><code class="lang-c">//&#x963B;&#x585E;&#x8FDB;&#x7A0B;, block set&#x91CC;&#x9762;&#x7684;signal. &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4E00;&#x76F4;&#x963B;&#x585E;, &#x76F4;&#x5230;&#x975E;set&#x6210;&#x5458;&#x7684;signal&#x7684;handler&#x8FD4;&#x56DE;&#x4EE5;&#x540E;&#x624D;&#x8FD4;&#x56DE;.
int sigsuspend (const sigset t *set)
</code></pre>
<h2 id="signal&#x7684;&#x6808;"><a name="signal&#x7684;&#x6808;" class="anchor-navigation-ex-anchor" href="#signal&#x7684;&#x6808;"><i class="fa fa-link" aria-hidden="true"></i></a>2.24. signal&#x7684;&#x6808;</h2>
<p>signal&#x7684;&#x6808;&#x5728;&#x7279;&#x6B8A;&#x7684;&#x5730;&#x65B9;(&#x4E0D;&#x662F;&#x8FDB;&#x7A0B;&#x6808;&#x5417;?--&#x9ED8;&#x8BA4;&#x662F;&#x7528;&#x8FDB;&#x7A0B;&#x6808;), &#x53EF;&#x4EE5;&#x7528;sigaltstack&#x8BBE;&#x5B9A;.</p>
<pre><code class="lang-c">stack_t
    void *ss_sp
    size_t ss_size
    int ss_flags
        SS_DISABLE: &#x4E0D;&#x4F7F;&#x7528;signal&#x6808;
        SS_ONSTACK: &#x4E3A;1&#x8868;&#x793A;&#x6B63;&#x5728;&#x7528;signal&#x6808;. &#x4E3A;0&#x8868;&#x793A;&#x7528;&#x7684;&#x662F;&#x8FDB;&#x7A0B;&#x7684;&#x6808;. &#x7531;OS&#x8BBE;&#x7F6E;
/* &#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5728;&#x677F;&#x5B50;&#x4E0A;&#x6D4B;&#x8BD5;, &#x7ED3;&#x679C;&#x4E3A;
** ss_sp:(nil), ss_size:0, ss_flags:0x2(SS_DISABLE)
** &#x8868;&#x793A;&#x4E0D;&#x7528;signal&#x7684;&#x6808;, &#x4F7F;&#x7528;&#x8FDB;&#x7A0B;&#x6808;
*/
int sigaltstack (const stack t *restrict stack, stack t *restrict oldstack)
</code></pre>
<h1 id="&#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;"><a name="&#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;" class="anchor-navigation-ex-anchor" href="#&#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;"><i class="fa fa-link" aria-hidden="true"></i></a>3. &#x57FA;&#x7840;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;</h1>
<pre><code class="lang-c">//main
int main (int argc, char *argv[])
//&#x957F;&#x53C2;&#x6570;&#x5F62;&#x5F0F;: --name=value
## &#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getopt 
```c
#include &lt;unistd.h&gt;
/* &#x4F1A;&#x7528;&#x5230;&#x51E0;&#x4E2A;&#x53D8;&#x91CF;
** int opterr; int optopt; int optind; char * optarg;
** : &#x8868;&#x793A;&#x9700;&#x8981;&#x53C2;&#x6570; :: &#x8868;&#x793A;&#x53C2;&#x6570;&#x53EF;&#x9009;
** &#x5728;&#x5FAA;&#x73AF;&#x91CC;&#x8C03;&#x7528;
*/
int getopt (int argc, char *const *argv, const char *options)
</code></pre>
<p>&#x4E3E;&#x4F8B;:</p>
<pre><code class="lang-c">#include &lt;ctype.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
int
main(int argc, char **argv)
{
    int aflag = 0;
    int bflag = 0;
    char *cvalue = NULL;
    int index;
    int c;
    opterr = 0;

    while ((c = getopt(argc, argv, &quot;abc:&quot;)) != -1)
        switch (c) {
        case &#x2019;a&#x2019;:
            aflag = 1;
            break;

        case &#x2019;b&#x2019;:
            bflag = 1;
            break;

        case &#x2019;c&#x2019;:
            cvalue = optarg;
            break;

        case &#x2019;?&#x2019; :
                if (optopt == &#x2019;c&#x2019;)
                    fprintf(stderr, &quot;Option -%c requires an argument.\n&quot;, optopt);
                else if (isprint(optopt))
                    fprintf(stderr, &quot;Unknown option &#x2018;-%c&#x2019;.\n&quot;, optopt);
                else
                    fprintf(stderr,
                            &quot;Unknown option character &#x2018;\x%x&#x2019;.\n&quot;,
                            optopt);

            return 1;

        default:
            abort();
        }

    printf(&quot;aflag = %d, bflag = %d, cvalue = %s\n&quot;,
           aflag, bflag, cvalue);

    for (index = optind; index &lt; argc; index++)
        printf(&quot;Non-option argument %s\n&quot;, argv[index]);

    return 0;
}
</code></pre>
<p>&#x7ED3;&#x679C;:</p>
<pre><code class="lang-c">% testopt
aflag = 0, bflag = 0, cvalue = (null)
% testopt -a -b
aflag = 1, bflag = 1, cvalue = (null)
% testopt -ab
aflag = 1, bflag = 1, cvalue = (null)
% testopt -c foo
aflag = 0, bflag = 0, cvalue = foo
% testopt -cfoo
aflag = 0, bflag = 0, cvalue = foo
% testopt arg1
aflag = 0, bflag = 0, cvalue = (null)
Non-option argument arg1
% testopt -a arg1
aflag = 1, bflag = 0, cvalue = (null)
Non-option argument arg1
% testopt -c foo arg1
aflag = 0, bflag = 0, cvalue = foo
Non-option argument arg1
% testopt -a -- -b
aflag = 1, bflag = 0, cvalue = (null)
Non-option argument -b
% testopt -a -aflag = 1, bflag = 0, cvalue = (null)
Non-option argument -
</code></pre>
<h2 id="&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getoptlong"><a name="&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getoptlong" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getoptlong"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. &#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;getopt_long</h2>
<pre><code class="lang-c">#include &lt;getopt.h&gt;
int getopt_long (int argc, char *const *argv, const char *shortopts, const struct option *longopts, int *indexptr)
struct option
    const char *name
    int has_arg
    int *flag
    int val
</code></pre>
<p>&#x4E3E;&#x4F8B;:</p>
<pre><code class="lang-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;getopt.h&gt;
/* Flag set by &#x2018;--verbose&#x2019;. */
static int verbose_flag;
int
main(int argc, char **argv)
{
    int c;

    while (1) {
        static struct option long_options[] = {
            /* These options set a flag. */
            {&quot;verbose&quot;, no_argument, &amp;verbose_flag, 1},
            {&quot;brief&quot;, no_argument, &amp;verbose_flag, 0},
            /* These options don&#x2019;t set a flag.
            We distinguish them by their indices. */
            {&quot;add&quot;, no_argument, 0, &#x2019;a&#x2019;},
            {&quot;append&quot;, no_argument, 0, &#x2019;b&#x2019;},
            {&quot;delete&quot;, required_argument, 0, &#x2019;d&#x2019;},
            {&quot;create&quot;, required_argument, 0, &#x2019;c&#x2019;},
            {&quot;file&quot;, required_argument, 0, &#x2019;f&#x2019;},
            {0, 0, 0, 0}
        };
        /* getopt_long stores the option index here. */
        int option_index = 0;
        c = getopt_long(argc, argv, &quot;abc:d:f:&quot;,
                        long_options, &amp;option_index);

        /* Detect the end of the options. */
        if (c == -1)
            break;

        switch (c) {
        case 0:

            /* If this option set a flag, do nothing else now. */
            if (long_options[option_index].flag != 0)
                break;

            printf(&quot;option %s&quot;, long_options[option_index].name);

            if (optarg)
                printf(&quot; with arg %s&quot;, optarg);

            printf(&quot;\n&quot;);
            break;

        case &#x2019;a&#x2019;:
            puts(&quot;option -a\n&quot;);
            break;

        case &#x2019;b&#x2019;:
            puts(&quot;option -b\n&quot;);
            break;

        case &#x2019;c&#x2019;:
            printf(&quot;option -c with value &#x2018;%s&#x2019;\n&quot;, optarg);
            break;

        case &#x2019;d&#x2019;:
            printf(&quot;option -d with value &#x2018;%s&#x2019;\n&quot;, optarg);
            break;

        case &#x2019;f&#x2019;:
            printf(&quot;option -f with value &#x2018;%s&#x2019;\n&quot;, optarg);
            break;

        case &#x2019;?&#x2019; :
                /* getopt_long already printed an error message. */
                break;

        default:
            abort();
        }
    }

    /* Instead of reporting &#x2018;--verbose&#x2019;
    and &#x2018;--brief&#x2019; as they are encountered,
    we report the final status resulting from them. */
    if (verbose_flag)
        puts(&quot;verbose flag is set&quot;);

    /* Print any remaining command line arguments (not options). */
    if (optind &lt; argc) {
        printf(&quot;non-option ARGV-elements: &quot;);

        while (optind &lt; argc)
            printf(&quot;%s &quot;, argv[optind++]);

        putchar(&#x2019;\n&#x2019;);
    }

    exit(0);
}
</code></pre>
<h2 id="&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argpparse"><a name="&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argpparse" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argpparse"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. &#x53C2;&#x6570;&#x89E3;&#x6790;&#x4E4B;argp_parse</h2>
<pre><code class="lang-c">//&#x597D;&#x50CF;&#x5F88;&#x590D;&#x6742;
error_t argp_parse (const struct argp *argp, int argc, char **argv, unsigned flags, int *arg_index, void *input)
</code></pre>
<p>&#x4E3E;&#x4F8B;:&#x6700;&#x7B80;&#x5355;</p>
<pre><code class="lang-c">/* This is (probably) the smallest possible program that
uses argp. It won&#x2019;t do much except give an error
messages and exit when there are any arguments, and print
a (rather pointless) messages for &#x2013;help. */
#include &lt;stdlib.h&gt;
#include &lt;argp.h&gt;
int
main(int argc, char **argv)
{
    argp_parse(0, argc, argv, 0, 0, 0);
    exit(0);
}
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x9009;&#x9879;&#x7684;&#x4F8B;&#x5B50;</p>
<pre><code class="lang-c">/* This program doesn&#x2019;t use any options or arguments, but uses
argp to be compliant with the GNU standard command line
format.
In addition to making sure no arguments are given, and
implementing a &#x2013;help option, this example will have a
&#x2013;version option, and will put the given documentation string
and bug address in the &#x2013;help output, as per GNU standards.
The variable ARGP contains the argument parser specification;
adding fields to this structure is the way most parameters are
passed to argp parse (the first three fields are usually used,
but not in this small program). There are also two global
variables that argp knows about defined here,
ARGP PROGRAM VERSION and ARGP PROGRAM BUG ADDRESS (they are
global variables because they will almost always be constant
for a given program, even if it uses different argument
parsers for various tasks). */
#include &lt;stdlib.h&gt;
#include &lt;argp.h&gt;
const char *argp_program_version =
    &quot;argp-ex2 1.0&quot;;
const char *argp_program_bug_address =
    &quot;&lt;bug-gnu-utils@gnu.org&gt;&quot;;
/* Program documentation. */
static char doc[] =
    &quot;Argp example #2 -- a pretty minimal program using argp&quot;;
/* Our argument parser. The options, parser, and
args_doc fields are zero because we have neither options or
arguments; doc and argp_program_bug_address will be
used in the output for &#x2018;--help&#x2019;, and the &#x2018;--version&#x2019;
option will print out argp_program_version. */
static struct argp argp = { 0, 0, 0, doc };
int
main(int argc, char **argv)
{
    argp_parse(&amp;argp, argc, argv, 0, 0, 0);
    exit(0);
}
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x589E;&#x52A0;&#x4E00;&#x4E9B;option</p>
<pre><code class="lang-c">/* This program uses the same features as example 2, and uses options and
arguments.
We now use the first four fields in ARGP, so here&#x2019;s a description of them:
OPTIONS &#x2013; A pointer to a vector of struct argp option (see below)
PARSER &#x2013; A function to parse a single option, called by argp
ARGS DOC &#x2013; A string describing how the non-option arguments should look
DOC &#x2013; A descriptive string about this program; if it contains a
vertical tab character (\v), the part after it will be
printed *following* the options
The function PARSER takes the following arguments:
KEY &#x2013; An integer specifying which option this is (taken
from the KEY field in each struct argp option), or
a special key specifying something else; the only
special keys we use here are ARGP KEY ARG, meaning
a non-option argument, and ARGP KEY END, meaning
that all arguments have been parsed
ARG &#x2013; For an option KEY, the string value of its
argument, or NULL if it has none
STATE&#x2013; A pointer to a struct argp state, containing
various useful information about the parsing state; used here
are the INPUT field, which reflects the INPUT argument to
argp parse, and the ARG NUM field, which is the number of the
current non-option argument being parsed
It should return either 0, meaning success, ARGP ERR UNKNOWN, meaning the
given KEY wasn&#x2019;t recognized, or an errno value indicating some other
error.
Note that in this example, main uses a structure to communicate with the
parse opt function, a pointer to which it passes in the INPUT argument to
argp parse. Of course, it&#x2019;s also possible to use global variables
instead, but this is somewhat more flexible.
The OPTIONS field contains a pointer to a vector of struct argp option&#x2019;s;
that structure has the following fields (if you assign your option
structures using array initialization like this example, unspecified
fields will be defaulted to 0, and need not be specified):
NAME &#x2013; The name of this option&#x2019;s long option (may be zero)
KEY &#x2013; The KEY to pass to the PARSER function when parsing this option,
*and* the name of this option&#x2019;s short option, if it is a
printable ascii character
ARG &#x2013; The name of this option&#x2019;s argument, if any
FLAGS &#x2013; Flags describing this option; some of them are:
OPTION ARG OPTIONAL &#x2013; The argument to this option is optional
OPTION ALIAS &#x2013; This option is an alias for the
previous option
OPTION HIDDEN &#x2013; Don&#x2019;t show this option in &#x2013;help output
DOC &#x2013; A documentation string for this option, shown in &#x2013;help output
An options vector should be terminated by an option with all fields zero. */
#include &lt;stdlib.h&gt;
#include &lt;argp.h&gt;
const char *argp_program_version =
    &quot;argp-ex3 1.0&quot;;
const char *argp_program_bug_address =
    &quot;&lt;bug-gnu-utils@gnu.org&gt;&quot;;
/* Program documentation. */
static char doc[] =
    &quot;Argp example #3 -- a program with options and arguments using argp&quot;;
/* A description of the arguments we accept. */
static char args_doc[] = &quot;ARG1 ARG2&quot;;
/* The options we understand. */
static struct argp_option options[] = {
    {&quot;verbose&quot;, &#x2019;v&#x2019;, 0, 0, &quot;Produce verbose output&quot; },
    {&quot;quiet&quot;, &#x2019;q&#x2019;, 0, 0, &quot;Don&#x2019;t produce any output&quot; },
    {&quot;silent&quot;, &#x2019;s&#x2019;, 0, OPTION_ALIAS },
    {
        &quot;output&quot;, &#x2019;o&#x2019;, &quot;FILE&quot;, 0,
        &quot;Output to FILE instead of standard output&quot;
    },
    { 0 }
};
/* Used by main to communicate with parse_opt. */
struct arguments {
    char *args[2]; /* arg1 &amp; arg2 */
    int silent, verbose;
    char *output_file;
};
/* Parse a single option. */
static error_t
parse_opt(int key, char *arg, struct argp_state *state)
{
    /* Get the input argument from argp_parse, which we
    know is a pointer to our arguments structure. */
    struct arguments *arguments = state-&gt;input;

    switch (key) {
    case &#x2019;q&#x2019;:
    case &#x2019;s&#x2019;:
        arguments-&gt;silent = 1;
        break;

    case &#x2019;v&#x2019;:
        arguments-&gt;verbose = 1;
        break;

    case &#x2019;o&#x2019;:
        arguments-&gt;output_file = arg;
        break;

    case ARGP_KEY_ARG:
        if (state-&gt;arg_num &gt;= 2)
            /* Too many arguments. */
            argp_usage(state);

        arguments-&gt;args[state-&gt;arg_num] = arg;
        break;

    case ARGP_KEY_END:
        if (state-&gt;arg_num &lt; 2)
            /* Not enough arguments. */
            argp_usage(state);

        break;

    default:
        return ARGP_ERR_UNKNOWN;
    }

    return 0;
}
/* Our argp parser. */
static struct argp argp = { options, parse_opt, args_doc, doc };
int
main(int argc, char **argv)
{
    struct arguments arguments;
    /* Default values. */
    arguments.silent = 0;
    arguments.verbose = 0;
    arguments.output_file = &quot;-&quot;;
    /* Parse our arguments; every option seen by parse_opt will
    be reflected in arguments. */
    argp_parse(&amp;argp, argc, argv, 0, 0, &amp;arguments);
    printf(&quot;ARG1 = %s\nARG2 = %s\nOUTPUT_FILE = %s\n&quot;
           &quot;VERBOSE = %s\nSILENT = %s\n&quot;,
           arguments.args[0], arguments.args[1],
           arguments.output_file,
           arguments.verbose ? &quot;yes&quot; : &quot;no&quot;,
           arguments.silent ? &quot;yes&quot; : &quot;no&quot;);
    exit(0);
}
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x66F4;&#x590D;&#x6742;&#x7684;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;</p>
<pre><code class="lang-c">/* This program uses the same features as example 3, but has more
options, and somewhat more structure in the -help output. It
also shows how you can &#x2018;steal&#x2019; the remainder of the input
arguments past a certain point, for programs that accept a
list of items. It also shows the special argp KEY value
ARGP KEY NO ARGS, which is only given if no non-option
arguments were supplied to the program.
For structuring the help output, two features are used,
*headers* which are entries in the options vector with the
first four fields being zero, and a two part documentation
string (in the variable DOC), which allows documentation both
before and after the options; the two parts of DOC are
separated by a vertical-tab character (&#x2019;\v&#x2019;, or &#x2019;\013&#x2019;). By
convention, the documentation before the options is just a
short string saying what the program does, and that afterwards
is longer, describing the behavior in more detail. All
documentation strings are automatically filled for output,
although newlines may be included to force a line break at a
particular point. All documentation strings are also passed to
the &#x2018;gettext&#x2019; function, for possible translation into the
current locale. */
#include &lt;stdlib.h&gt;
#include &lt;error.h&gt;
#include &lt;argp.h&gt;
const char *argp_program_version =
    &quot;argp-ex4 1.0&quot;;
const char *argp_program_bug_address =
    &quot;&lt;bug-gnu-utils@prep.ai.mit.edu&gt;&quot;;
/* Program documentation. */
static char doc[] =
    &quot;Argp example #4 -- a program with somewhat more complicatedoptions\vThis part of the documentation comes *after* the options;note that the text is automatically filled, but it&#x2019;s possibleto force a line-break, e.g.\n&lt;-- here.&quot;;
/* A description of the arguments we accept. */
static char args_doc[] = &quot;ARG1 [STRING...]&quot;;
/* Keys for options without short-options. */
#define OPT_ABORT 1 /* &#x2013;abort */
/* The options we understand. */
static struct argp_option options[] = {
    {&quot;verbose&quot;, &#x2019;v&#x2019;, 0, 0, &quot;Produce verbose output&quot; },
    {&quot;quiet&quot;, &#x2019;q&#x2019;, 0, 0, &quot;Don&#x2019;t produce any output&quot; },
    {&quot;silent&quot;, &#x2019;s&#x2019;, 0, OPTION_ALIAS },
    {
        &quot;output&quot;, &#x2019;o&#x2019;, &quot;FILE&quot;, 0,
        &quot;Output to FILE instead of standard output&quot;
    },
    {0, 0, 0, 0, &quot;The following options should be grouped together:&quot; },
    {
        &quot;repeat&quot;, &#x2019;r&#x2019;, &quot;COUNT&quot;, OPTION_ARG_OPTIONAL,
        &quot;Repeat the output COUNT (default 10) times&quot;
    },
    {&quot;abort&quot;, OPT_ABORT, 0, 0, &quot;Abort before showing any output&quot;},
    { 0 }
};
/* Used by main to communicate with parse_opt. */
struct arguments {
    char *arg1; /* arg1 */
    char **strings; /* [string . . .] */
    int silent, verbose, abort; /* &#x2018;-s&#x2019;, &#x2018;-v&#x2019;, &#x2018;--abort&#x2019; */
    char *output_file; /* file arg to &#x2018;--output&#x2019; */
    int repeat_count; /* count arg to &#x2018;--repeat&#x2019; */
};
/* Parse a single option. */
static error_t
parse_opt(int key, char *arg, struct argp_state *state)
{
    /* Get the input argument from argp_parse, which we
    know is a pointer to our arguments structure. */
    struct arguments *arguments = state-&gt;input;

    switch (key) {
    case &#x2019;q&#x2019;:
    case &#x2019;s&#x2019;:
        arguments-&gt;silent = 1;
        break;

    case &#x2019;v&#x2019;:
        arguments-&gt;verbose = 1;
        break;

    case &#x2019;o&#x2019;:
        arguments-&gt;output_file = arg;
        break;

    case &#x2019;r&#x2019;:
        arguments-&gt;repeat_count = arg ? atoi(arg) : 10;
        break;

    case OPT_ABORT:
        arguments-&gt;abort = 1;
        break;

    case ARGP_KEY_NO_ARGS:
        argp_usage(state);

    case ARGP_KEY_ARG:
        /* Here we know that state-&gt;arg_num == 0, since we
        force argument parsing to end before any more arguments can
        get here. */
        arguments-&gt;arg1 = arg;
        /* Now we consume all the rest of the arguments.
        state-&gt;next is the index in state-&gt;argv of the
        next argument to be parsed, which is the first string
        we&#x2019;re interested in, so we can just use
        &amp;state-&gt;argv[state-&gt;next] as the value for
        arguments-&gt;strings.
        In addition, by setting state-&gt;next to the end
        of the arguments, we can force argp to stop parsing here and
        return. */
        arguments-&gt;strings = &amp;state-&gt;argv[state-&gt;next];
        state-&gt;next = state-&gt;argc;
        break;

    default:
        return ARGP_ERR_UNKNOWN;
    }

    return 0;
}
/* Our argp parser. */
static struct argp argp = { options, parse_opt, args_doc, doc };
int
main(int argc, char **argv)
{
    int i, j;
    struct arguments arguments;
    /* Default values. */
    arguments.silent = 0;
    arguments.verbose = 0;
    arguments.output_file = &quot;-&quot;;
    arguments.repeat_count = 1;
    arguments.abort = 0;
    /* Parse our arguments; every option seen by parse_opt will be
    reflected in arguments. */
    argp_parse(&amp;argp, argc, argv, 0, 0, &amp;arguments);

    if (arguments.abort)
        error(10, 0, &quot;ABORTED&quot;);

    for (i = 0; i &lt; arguments.repeat_count; i++) {
        printf(&quot;ARG1 = %s\n&quot;, arguments.arg1);
        printf(&quot;STRINGS = &quot;);

        for (j = 0; arguments.strings[j]; j++)
            printf(j == 0 ? &quot;%s&quot; : &quot;, %s&quot;, arguments.strings[j]);

        printf(&quot;\n&quot;);
        printf(&quot;OUTPUT_FILE = %s\nVERBOSE = %s\nSILENT = %s\n&quot;,
               arguments.output_file,
               arguments.verbose ? &quot;yes&quot; : &quot;no&quot;,
               arguments.silent ? &quot;yes&quot; : &quot;no&quot;);
    }

    exit(0);
}
</code></pre>
<h2 id="&#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;"><a name="&#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;" class="anchor-navigation-ex-anchor" href="#&#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;"><i class="fa fa-link" aria-hidden="true"></i></a>3.3. &#x5B50;&#x9009;&#x9879;&#x652F;&#x6301;</h2>
<pre><code class="lang-c">int getsubopt (char **optionp, char *const *tokens, char **valuep)
</code></pre>
<p>&#x4E3E;&#x4F8B;:</p>
<pre><code class="lang-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
int do_all;
const char *type;
int read_size;
int write_size;
int read_only;
enum {
    RO_OPTION = 0,
    RW_OPTION,
    READ_SIZE_OPTION,
    WRITE_SIZE_OPTION,
    THE_END
};
const char *mount_opts[] = {
    [RO_OPTION] = &quot;ro&quot;,
    [RW_OPTION] = &quot;rw&quot;,
    [READ_SIZE_OPTION] = &quot;rsize&quot;,
    [WRITE_SIZE_OPTION] = &quot;wsize&quot;,
    [THE_END] = NULL
};
int
main(int argc, char **argv)
{
    char *subopts, *value;
    int opt;

    while ((opt = getopt(argc, argv, &quot;at:o:&quot;)) != -1)
        switch (opt) {
        case &#x2019;a&#x2019;:
            do_all = 1;
            break;

        case &#x2019;t&#x2019;:
            type = optarg;
            break;

        case &#x2019;o&#x2019;:
            subopts = optarg;

            while (*subopts != &#x2019;\0&#x2019;)
                switch (getsubopt(&amp;subopts, mount_opts, &amp;value)) {
                case RO_OPTION:
                    read_only = 1;
                    break;

                case RW_OPTION:
                    read_only = 0;
                    break;

                case READ_SIZE_OPTION:
                    if (value == NULL)
                        abort();

                    read_size = atoi(value);
                    break;

                case WRITE_SIZE_OPTION:
                    if (value == NULL)
                        abort();

                    write_size = atoi(value);
                    break;

                default:
                    /* Unknown suboption. */
                    printf(&quot;Unknown suboption &#x2018;%s&#x2019;\n&quot;, value);
                    break;
                }

            break;

        default:
            abort();
        }

    /* Do the real work. */
    return 0;
}
</code></pre>
<h2 id="&#x73AF;&#x5883;&#x53D8;&#x91CF;"><a name="&#x73AF;&#x5883;&#x53D8;&#x91CF;" class="anchor-navigation-ex-anchor" href="#&#x73AF;&#x5883;&#x53D8;&#x91CF;"><i class="fa fa-link" aria-hidden="true"></i></a>3.4. &#x73AF;&#x5883;&#x53D8;&#x91CF;</h2>
<pre><code class="lang-c">#include &lt;stdlib.h&gt;
char * getenv (const char *name)
char * secure_getenv (const char *name)
//name=value, &#x5982;&#x679C;&#x6CA1;&#x6709;=, &#x76F8;&#x5F53;&#x4E8E;&#x5B9A;&#x4E49;xxxx&#x4E3A;&#x7A7A;
int putenv (char *string)
int setenv (const char *name, const char *value, int replace)
int unsetenv (const char *name)
int clearenv (void)
//env&#x7684;&#x5168;&#x5C40;&#x6570;&#x7EC4;, &#x6BCF;&#x4E00;&#x9879;&#x90FD;&#x662F;name=value
#include &lt;unistd.h&gt;
char ** environ
</code></pre>
<h2 id="syscall"><a name="syscall" class="anchor-navigation-ex-anchor" href="#syscall"><i class="fa fa-link" aria-hidden="true"></i></a>3.5. syscall</h2>
<pre><code class="lang-c">#include &lt;unistd.h&gt;
#include &lt;sys/syscall.h&gt;
</code></pre>
<p>&#x4F8B;&#x5982;:</p>
<pre><code class="lang-c">#include &lt;unistd.h&gt;
#include &lt;sys/syscall.h&gt;
#include &lt;errno.h&gt;
...
int rc;
rc = syscall(SYS_chmod, &quot;/etc/passwd&quot;, 0444);
if (rc == -1)
fprintf(stderr, &quot;chmod failed, errno = %d\n&quot;, errno);
</code></pre>
<p>&#x53C8;&#x5982;:</p>
<pre><code class="lang-c">#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;errno.h&gt;
...
int rc;
rc = chmod(&quot;/etc/passwd&quot;, 0444);
if (rc == -1)
fprintf(stderr, &quot;chmod failed, errno = %d\n&quot;, errno);
</code></pre>
<h2 id="&#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;"><a name="&#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;" class="anchor-navigation-ex-anchor" href="#&#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;"><i class="fa fa-link" aria-hidden="true"></i></a>3.6. &#x7EC8;&#x7ED3;&#x7A0B;&#x5E8F;</h2>
<ul>
<li>main&#x7684;return</li>
<li>abort&#x4F1A;&#x89E6;&#x53D1;SIGABRT</li>
<li>exit<pre><code class="lang-c">/*&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;, &#x4E0D;&#x8FD4;&#x56DE;; main&#x7684;return&#x503C;&#x968F;&#x540E;&#x88AB;&#x4F20;&#x5165;status
**status&#x8303;&#x56F4;&#x662F;0-255, &#x901A;&#x5E38;0(EXIT_SUCCESS)&#x8868;&#x793A;&#x6210;&#x529F;, 1(EXIT_FAILURE)&#x8868;&#x793A;&#x5931;&#x8D25;
**&#x7528;atexit&#x6216;on_exit&#x6CE8;&#x518C;&#x7684;&#x51FD;&#x6570;&#x4F1A;&#x88AB;&#x8C03;&#x7528;
**&#x5173;&#x95ED;&#x6240;&#x6709;stream, flush buffers, remove tmpfile
**&#x6700;&#x540E;&#x8C03;&#x7528;_exit&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;
*/
#include &lt;stdlib.h&gt;
void exit (int status)
```c
//exit&#x94A9;&#x5B50;&#x51FD;&#x6570;
int atexit (void (*function) (void))
int on_exit (void (*function)(int status, void *arg), void *arg)
//abort&#x51FD;&#x6570;, &#x4F1A;&#x89E6;&#x53D1;SIGABRT. &#x4E0D;&#x4F1A;&#x56DE;&#x8C03;exit&#x94A9;&#x5B50;. &#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;
void abort (void)
/*&#x771F;&#x6B63;&#x7684;&#x7EC8;&#x6B62;&#x51FD;&#x6570;, &#x4E0D;&#x7BA1;&#x662F;&#x54EA;&#x79CD;&#x7EC8;&#x6B62;, &#x6700;&#x7EC8;&#x90FD;&#x4F1A;&#x8C03;&#x7528;&#x5B83;:
** 1. &#x5173;&#x95ED;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;, &#x6CE8;&#x610F;&#x5B83;&#x4E0D;&#x4F1A;&#x628A;&#x6D41;&#x6587;&#x4EF6;flush buffer(exit&#x4F1A;).
** 2. &#x62A5;&#x544A;&#x8FDB;&#x7A0B;&#x7684;exit status&#x5230;&#x7236;&#x8FDB;&#x7A0B;&#x7684;wait
** 3. &#x4E0B;&#x9762;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x88AB;init&#x8FDB;&#x7A0B;&#x63A5;&#x7BA1;
** 4. &#x5411;&#x7236;&#x8FDB;&#x7A0B;&#x53D1;&#x9001;SIGCHLD
** 5. &#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#x662F;&#x4E2A;&#x7EC8;&#x7AEF;&#x4F1A;&#x8BDD;&#x4E3B;&#x8FDB;&#x7A0B;(&#x6BD4;&#x5982;ssh), &#x90A3;&#x4E48;&#x5B83;&#x4F1A;&#x53D1;&#x9001;SIGHUP&#x5230;&#x6240;&#x6709;&#x524D;&#x53F0;&#x5B50;&#x8FDB;&#x7A0B;, &#x5E76;&#x91CA;&#x653E;&#x8FD9;&#x4E2A;&#x7EC8;&#x7AEF;.
** 6. &#x5982;&#x679C;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;&#x5BFC;&#x81F4;&#x8FDB;&#x7A0B;&#x7EC4;&#x53D8;&#x4E3A;&#x5B64;&#x513F;, &#x5219;&#x8FD9;&#x4E2A;&#x5B64;&#x513F;&#x8FDB;&#x7A0B;&#x7EC4;&#x4F1A;&#x53D8;&#x4E3A;stop&#x72B6;&#x6001;, &#x7136;&#x540E;&#x7EC4;&#x91CC;&#x7684;&#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;&#x90FD;&#x4F1A;&#x6536;&#x5230;SIGHUP&#x548C;SIGCONT
*/
void _exit (int status)
</code></pre>
</li>
</ul>
<h1 id="&#x8FDB;&#x7A0B;"><a name="&#x8FDB;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#&#x8FDB;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>4. &#x8FDB;&#x7A0B;</h1>
<pre><code class="lang-c">//&#x4EE5;&#x963B;&#x585E;&#x65B9;&#x5F0F;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x5B50;&#x7A0B;&#x5E8F;
#include &lt;stdlib.h&gt;
int system (const char *command)
//&#x8FDB;&#x7A0B;id&#x548C;&#x7236;&#x8FDB;&#x7A0B;id
#include &lt;sys/types.h&gt;
pid_t getpid (void)
pid_t getppid (void)
</code></pre>
<h2 id="fork"><a name="fork" class="anchor-navigation-ex-anchor" href="#fork"><i class="fa fa-link" aria-hidden="true"></i></a>4.1. fork</h2>
<pre><code class="lang-c">/* &#x65B0;&#x8FDB;&#x7A0B;
** pid&#x4E0D;&#x540C;
** &#x7236;&#x5B50;&#x5171;&#x4EAB;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x7684;posion?
** &#x5B50;&#x8FDB;&#x7A0B;&#x4E0D;&#x7EE7;&#x627F;&#x6587;&#x4EF6;&#x9501;
** &#x4E0D;&#x7EE7;&#x627F;alarm
** &#x7EE7;&#x627F;signal, &#x4EE5;&#x53CA;block mask, &#x4F46;&#x6E05;&#x9664;pending&#x7684;signal
*/
#include &lt;unistd.h&gt;
pid_t fork (void)
//&#x5171;&#x4EAB;&#x7236;&#x8FDB;&#x7A0B;&#x5730;&#x5740;&#x7A7A;&#x95F4;
pid_t vfork (void)
</code></pre>
<h2 id="exec"><a name="exec" class="anchor-navigation-ex-anchor" href="#exec"><i class="fa fa-link" aria-hidden="true"></i></a>4.2. exec</h2>
<pre><code class="lang-c">/*exec
** pid ppid group session user pwd&#x4E0D;&#x53D8;
** alarm&#x4E0D;&#x53D8;
** fd&#x4E0D;&#x53D8;, &#x4F46;stream&#x90FD;&#x6CA1;&#x4E86;(&#x56E0;&#x4E3A;stream&#x5C5E;&#x4E8E;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;, &#x800C;fd&#x662F;&#x5185;&#x6838;&#x7BA1;&#x7406;?)
** signal&#x53D8;&#x6210;default, &#x4F46;ignore&#x7684;signal&#x7EE7;&#x627F;
** &#x65F6;&#x95F4;&#x7247;&#x4E0D;&#x53D8;
*/
int execv (const char *filename, char *const argv[])
int execl (const char *filename, const char *arg0, . . . )
int execve (const char *filename, char *const argv[], char *const env[])
int execle (const char *filename, const char *arg0, . . ., char *const env[])
int execvp (const char *filename, char *const argv[])
int execlp (const char *filename, const char *arg0, . . . )
</code></pre>
<h2 id="&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;"><a name="&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;" class="anchor-navigation-ex-anchor" href="#&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3. &#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;</h2>
<pre><code class="lang-c">pid_t waitpid (pid t pid, int *status-ptr, int options)
//&#x76F8;&#x5F53;&#x4E8E;waitpid (-1, &amp;status, 0)
pid_t wait (int *status-ptr)
//&#x591A;&#x4E86;&#x4E00;&#x4E2A;&#x53C2;&#x6570;usage, &#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x8D44;&#x6E90;
pid_t wait4 (pid t pid, int *status-ptr, int options, struct rusage *usage)
</code></pre>
<p>&#x4E3E;&#x4F8B;: &#x4F7F;&#x7528;signal&#x6765;&#x5904;&#x7406;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;</p>
<pre><code class="lang-c">void
sigchld_handler(int signum)
{
    int pid, status, serrno;
    serrno = errno;

    while (1) {
        pid = waitpid(WAIT_ANY, &amp;status, WNOHANG);

        if (pid &lt; 0) {
            perror(&quot;waitpid&quot;);
            break;
        }

        if (pid == 0)
            break;

        notice_termination(pid, status);
    }

    errno = serrno;
}
</code></pre>
<h2 id="&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;"><a name="&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;" class="anchor-navigation-ex-anchor" href="#&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;"><i class="fa fa-link" aria-hidden="true"></i></a>4.4. &#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x72B6;&#x6001;</h2>
<pre><code class="lang-c">//&#x5B50;&#x8FDB;&#x7A0B;&#x7528;exit&#x6216;_exit&#x9000;&#x51FA;
int WIFEXITED (int status)
//&#x4E0A;&#x9762;&#x4E3A;&#x771F;, &#x5219;&#x8FD9;&#x4E2A;&#x8FD4;&#x56DE;main&#x7684;&#x8FD4;&#x56DE;&#x503C;, &#x6216;&#x8C03;&#x7528;exit()&#x4F20;&#x5165;&#x7684;&#x8FD4;&#x56DE;&#x503C;
int WEXITSTATUS (int status)
//signal&#x5BFC;&#x81F4;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;
int WIFSIGNALED (int status)
//&#x4E0A;&#x9762;&#x4E3A;&#x771F;&#x65F6;&#x8FD4;&#x56DE;signal&#x53F7;
int WTERMSIG (int status)
//&#x662F;&#x5426;&#x4EA7;&#x751F;&#x4E86;core dump
int WCOREDUMP (int status)
//&#x5B50;&#x8FDB;&#x7A0B;stop
int WIFSTOPPED (int status)
//signal&#x5BFC;&#x81F4;&#x5B50;&#x8FDB;&#x7A0B;stop
int WSTOPSIG (int status)
&#x4E3E;&#x4F8B;:
```c
#include &lt;stddef.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/wait.h&gt;
/* Execute the command using this shell program. */
#define SHELL &quot;/bin/sh&quot;
int
my_system(const char *command)
{
    int status;
    pid_t pid;
    pid = fork();

    if (pid == 0) {
        /* This is the child process. Execute the shell command. */
        execl(SHELL, SHELL, &quot;-c&quot;, command, NULL);
        /*exec&#x5931;&#x8D25;, &#x76F4;&#x63A5;&#x7EC8;&#x6B62;&#x5B50;&#x8FDB;&#x7A0B;; &#x4E0D;&#x8981;&#x8C03;&#x7528;exit(), &#x56E0;&#x4E3A;&#x5B83;&#x4F1A;flush&#x4ECE;&#x7236;&#x8FDB;&#x7A0B;&#x7EE7;&#x627F;&#x8FC7;&#x6765;&#x7684;stream
        **&#x800C;&#x8FD9;&#x4E9B;stream&#x4F1A;&#x88AB;&#x7236;&#x8FDB;&#x7A0B;flush, &#x5BFC;&#x81F4;output&#x4E24;&#x6B21;
        */
        _exit(EXIT_FAILURE);
    } else if (pid &lt; 0)
        /* The fork failed. Report failure. */
        status = -1;
    else

        /* This is the parent process. Wait for the child to complete. */
        if (waitpid(pid, &amp;status, 0) != pid)
            status = -1;

    return status;
}
</code></pre>
<h1 id="job&#x63A7;&#x5236;"><a name="job&#x63A7;&#x5236;" class="anchor-navigation-ex-anchor" href="#job&#x63A7;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>5. job&#x63A7;&#x5236;</h1>
<ul>
<li>signal&#x7684;&#x5206;&#x53D1;&#x662F;&#x7531;&#x8FDB;&#x7A0B;&#x7EC4;&#x51B3;&#x5B9A;&#x7684;. &#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;&#x7684;&#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;&#x90FD;&#x4F1A;&#x6536;&#x5230;&#x7531;&#x7528;&#x6237;&#x89E6;&#x53D1;&#x7684;SIGTSTP, SIGQUIT, SIGINT &#x4FE1;&#x53F7;
&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;&#x4E0D;&#x5141;&#x8BB8;&#x8BFB;&#x63A7;&#x5236;&#x53F0;, &#x5426;&#x5219;&#x4F1A;&#x89E6;&#x53D1; SIGTTIN and SIGTTOU&#x4FE1;&#x53F7;&#x5230;&#x7EC4;&#x5185;&#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;(&#x9ED8;&#x8BA4;stop), &#x4F46;&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;&#x4E00;&#x822C;&#x53EF;&#x4EE5;&#x5199;&#x63A7;&#x5236;&#x53F0;</li>
<li>shell&#x4F1A;&#x628A;&#x547D;&#x4EE4;&#x7BA1;&#x9053;&#x5206;&#x6210;&#x82E5;&#x5E72;&#x8FDB;&#x7A0B;&#x7EC4;, &#x5E76;&#x9009;&#x5B9A;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7EC4;&#x4E3A;&#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;, &#x8BE5;&#x8FDB;&#x7A0B;&#x7EC4;&#x4EAB;&#x6709;&#x63A7;&#x5236;&#x53F0;. &#x5269;&#x4E0B;&#x7684;&#x8FDB;&#x7A0B;&#x7EC4;&#x4E3A;&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;.</li>
<li>&#x4E00;&#x822C;&#x4E00;&#x6B21;&#x767B;&#x5F55;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;, &#x91CC;&#x9762;&#x5305;&#x542B;&#x82E5;&#x4E2A;&#x8FDB;&#x7A0B;&#x7EC4;. </li>
<li>&#x4F1A;&#x8BDD;leader&#x8FDB;&#x7A0B;&#x4E5F;&#x79F0;&#x4E3A;&#x7EC8;&#x7AEF;&#x7684;&#x63A7;&#x5236;&#x8FDB;&#x7A0B;, &#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#x6302;&#x4E86;, &#x5219;&#x8FD9;&#x4E2A;&#x4F1A;&#x8BDD;&#x7684;&#x8FDB;&#x7A0B;&#x7EC4;&#x5C31;&#x6210;&#x4E86;&#x5B64;&#x513F;&#x8FDB;&#x7A0B;&#x7EC4;, &#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;(&#x8FD8;&#x662F;&#x524D;&#x5929;&#x8FDB;&#x7A0B;?)&#x90FD;&#x4F1A;&#x6536;&#x5230;SIGHUP&#x4FE1;&#x53F7;</li>
<li>tcsetpgrp&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7EC8;&#x7AEF;&#x63A7;&#x5236;&#x6743;, shell&#x8D77;&#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x65F6;&#x9700;&#x8981;&#x8C03;&#x7528;, &#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x8FD4;&#x56DE;&#x540E;, shell&#x4E5F;&#x8981;&#x8C03;&#x7528;tcsetpgrp&#x4E00;&#x6B21;&#x4EE5;&#x91CD;&#x65B0;&#x83B7;&#x5F97;&#x7EC8;&#x7AEF;&#x63A7;&#x5236;&#x6743;.</li>
<li><p>&#x7EC8;&#x7AEF;&#x63A7;&#x5236;&#x6743;&#x5207;&#x6362;&#x65F6;, &#x9700;&#x8981;&#x7528;tcgetattr()&#x548C;tcsetattr()&#x6765;&#x6062;&#x590D;&#x7EC8;&#x7AEF;&#x5C5E;&#x6027;.
&#x9ED8;&#x8BA4;&#x7EC8;&#x6B62;&#x8BE5;&#x8FDB;&#x7A0B;</p>
<h2 id="&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;"><a name="&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;" class="anchor-navigation-ex-anchor" href="#&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;"><i class="fa fa-link" aria-hidden="true"></i></a>5.1. &#x83B7;&#x5F97;&#x63A7;&#x5236;&#x7EC8;&#x7AEF;&#x540D;&#x5B57;(&#x548C;ttyname&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;?)</h2>
<pre><code class="lang-c">char * ctermid (char *string)
</code></pre>
<h2 id="&#x8FDB;&#x7A0B;&#x7EC4;api"><a name="&#x8FDB;&#x7A0B;&#x7EC4;api" class="anchor-navigation-ex-anchor" href="#&#x8FDB;&#x7A0B;&#x7EC4;api"><i class="fa fa-link" aria-hidden="true"></i></a>5.2. &#x8FDB;&#x7A0B;&#x7EC4;api</h2>
<pre><code class="lang-c">//&#x8C03;&#x7528;&#x8FDB;&#x7A0B;&#x4F1A;&#x65B0;&#x5EFA;&#x4F1A;&#x8BDD;, &#x5E76;&#x6210;&#x4E3A;leader, &#x5176;pid==&#x8FDB;&#x7A0B;&#x7EC4;id
pid_t setsid (void)
//&#x83B7;&#x5F97;session leader&#x7684;&#x8FDB;&#x7A0B;&#x7EC4;id
pid_t getsid (pid t pid)
//&#x83B7;&#x5F97;&#x8C03;&#x7528;&#x8FDB;&#x7A0B;&#x7684;&#x8FDB;&#x7A0B;&#x7EC4;id
pid_t getpgrp (void)
//&#x83B7;&#x5F97;pid&#x7684;&#x8FDB;&#x7A0B;&#x7EC4;id
int getpgid (pid t pid)
//&#x5C06;pid&#x52A0;&#x5165;pgid&#x7EC4;
int setpgid (pid t pid, pid t pgid)
//&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;
pid_t tcgetpgrp (int filedes)
//&#x8BBE;&#x7F6E;&#x63A7;&#x5236;&#x53F0;&#x8FDB;&#x7A0B;&#x7EC4;
int tcsetpgrp (int filedes, pid t pgid)
</code></pre>
<h2 id="&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell"><a name="&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell" class="anchor-navigation-ex-anchor" href="#&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell"><i class="fa fa-link" aria-hidden="true"></i></a>5.3. &#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;shell</h2>
<p>```c
/<em> A process is a single process. </em>/
typedef struct process {
 struct process <em>next; /</em> next process in pipeline <em>/
 char **argv; /</em> for exec <em>/
 pid_t pid; /</em> process ID <em>/
 char completed; /</em> true if process has completed <em>/
 char stopped; /</em> true if process has stopped <em>/
 int status; /</em> reported status value <em>/
} process;
/</em> A job is a pipeline of processes. <em>/
typedef struct job {
 struct job </em>next; /<em> next active job </em>/
 char <em>command; /</em> command line, used for messages <em>/
 process </em>first_process; /<em> list of processes in this job </em>/
 pid_t pgid; /<em> process group ID </em>/
 char notified; /<em> true if user told about stopped job </em>/
 struct termios tmodes; /<em> saved terminal modes </em>/
 int stdin, stdout, stderr; /<em> standard i/o channels </em>/
} job;
/<em> The active jobs are linked into a list. This is its head. </em>/
job <em>first_job = NULL;
/</em> Find the active job with the indicated pgid. <em>/
job </em>
find_job(pid_t pgid)
{
 job *j;</p>
<p> for (j = first_job; j; j = j-&gt;next)</p>
<pre><code> if (j-&gt;pgid == pgid)
     return j;
</code></pre><p> return NULL;
}
/<em> Return true if all processes in the job have stopped or completed. </em>/
int
job_is_stopped(job <em>j)
{
 process </em>p;</p>
<p> for (p = j-&gt;first_process; p; p = p-&gt;next)</p>
<pre><code> if (ps &gt; completed &amp;&amp; !p-&gt;stopped)
     return 0;
</code></pre><p> return 1;
}
/<em> Return true if all processes in the job have completed. </em>/
int
job_is_completed(job <em>j)
{
 process </em>p;</p>
<p> for (p = j-&gt;first_process; p; p = p-&gt;next)</p>
<pre><code> if (!p-&gt;completed)
     return 0;
</code></pre><p> return 1;
}</p>
</li>
</ul>
<p>/<em> Keep track of attributes of the shell. </em>/</p>
<h1 id="include-"><a name="include-" class="anchor-navigation-ex-anchor" href="#include-"><i class="fa fa-link" aria-hidden="true"></i></a>6. include </h1>
<h1 id="include-_1"><a name="include-_1" class="anchor-navigation-ex-anchor" href="#include-_1"><i class="fa fa-link" aria-hidden="true"></i></a>7. include </h1>
<h1 id="include-_2"><a name="include-_2" class="anchor-navigation-ex-anchor" href="#include-_2"><i class="fa fa-link" aria-hidden="true"></i></a>8. include </h1>
<p>pid_t shell_pgid;
struct termios shell_tmodes;
int shell_terminal;
int shell_is_interactive;
/<em> Make sure the shell is running interactively as the foreground job
before proceeding. </em>/
void
init_shell()
{
    /<em> See if we are running interactively. </em>/
    shell_terminal = STDIN_FILENO;
    shell_is_interactive = isatty(shell_terminal);</p>
<pre><code>if (shell_is_interactive) {
    /* Loop until we are in the foreground. */
    while (tcgetpgrp(shell_terminal) != (shell_pgid = getpgrp()))
        kill(- shell_pgid, SIGTTIN);

    /* Ignore interactive and job-control signals. */
    signal(SIGINT, SIG_IGN);
    signal(SIGQUIT, SIG_IGN);
    signal(SIGTSTP, SIG_IGN);
    signal(SIGTTIN, SIG_IGN);
    signal(SIGTTOU, SIG_IGN);
    signal(SIGCHLD, SIG_IGN);
    /* Put ourselves in our own process group. */
    shell_pgid = getpid();

    if (setpgid(shell_pgid, shell_pgid) &lt; 0) {
        perror(&quot;Couldn&#x2019;t put the shell in its own process group&quot;);
        exit(1);
    }

    /* Grab control of the terminal. */
    tcsetpgrp(shell_terminal, shell_pgid);
    /* Save default terminal attributes for shell. */
    tcgetattr(shell_terminal, &amp;shell_tmodes);
}
</code></pre><p>}</p>
<p>void
launch_process(process *p, pid_t pgid,
               int infile, int outfile, int errfile,
               int foreground)
{
    pid_t pid;</p>
<pre><code>if (shell_is_interactive) {
    /* Put the process into the process group and give the process group
    the terminal, if appropriate.
    This has to be done both by the shell and in the individual
    child processes because of potential race conditions. */
    pid = getpid();

    if (pgid == 0) pgid = pid;

    setpgid(pid, pgid);

    if (foreground)
        tcsetpgrp(shell_terminal, pgid);

    /* Set the handling for job control signals back to the default. */
    signal(SIGINT, SIG_DFL);
    signal(SIGQUIT, SIG_DFL);
    signal(SIGTSTP, SIG_DFL);
    signal(SIGTTIN, SIG_DFL);
    signal(SIGTTOU, SIG_DFL);
    signal(SIGCHLD, SIG_DFL);
}

/* Set the standard input/output channels of the new process. */
if (infile != STDIN_FILENO) {
    dup2(infile, STDIN_FILENO);
    close(infile);
}

if (outfile != STDOUT_FILENO) {
    dup2(outfile, STDOUT_FILENO);
    close(outfile);
}

if (errfile != STDERR_FILENO) {
    dup2(errfile, STDERR_FILENO);
    close(errfile);
}

/* Exec the new process. Make sure we exit. */
execvp(p-&gt;argv[0], p-&gt;argv);
perror(&quot;execvp&quot;);
exit(1);
</code></pre><p>}</p>
<p>void
launch_job(job <em>j, int foreground)
{
    process </em>p;
    pid_t pid;
    int mypipe[2], infile, outfile;
    infile = j-&gt;stdin;</p>
<pre><code>for (p = j-&gt;first_process; p; p = p-&gt;next) {
    /* Set up pipes, if necessary. */
    if (p-&gt;next) {
        if (pipe(mypipe) &lt; 0) {
            perror(&quot;pipe&quot;);
            exit(1);
        }

        outfile = mypipe[1];
    } else
        outfile = j-&gt;stdout;

    /* Fork the child processes. */
    pid = fork();

    if (pid == 0)
        /* This is the child process. */
        launch_process(p, j-&gt;pgid, infile,
                       outfile, j-&gt;stderr, foreground);
    else if (pid &lt; 0) {
        /* The fork failed. */
        perror(&quot;fork&quot;);
        exit(1);
    } else {
        /* This is the parent process. */
        p-&gt;pid = pid;

        if (shell_is_interactive) {
            if (!j-&gt;pgid)
                j-&gt;pgid = pid;

            setpgid(pid, j-&gt;pgid);
        }
    }

    /* Clean up after pipes. */
    if (infile != j-&gt;stdin)
        close(infile);

    if (outfile != j-&gt;stdout)
        close(outfile);

    infile = mypipe[0];
}

format_job_info(j, &quot;launched&quot;);

if (!shell_is_interactive)
    wait_for_job(j);
else if (foreground)
    put_job_in_foreground(j, 0);
else
    put_job_in_background(j, 0);
</code></pre><p>}</p>
<p>/<em> Put job j in the foreground. If cont is nonzero,
restore the saved terminal modes and send the process group a
SIGCONT signal to wake it up before we block. </em>/
void
put_job_in_foreground(job <em>j, int cont)
{
    /</em> Put the job into the foreground. */
    tcsetpgrp(shell_terminal, j-&gt;pgid);</p>
<pre><code>/* Send the job a continue signal, if necessary. */
if (cont) {
    tcsetattr(shell_terminal, TCSADRAIN, &amp;j-&gt;tmodes);

    if (kill(- j-&gt;pgid, SIGCONT) &lt; 0)
        perror(&quot;kill (SIGCONT)&quot;);
}

/* Wait for it to report. */
wait_for_job(j);
/* Put the shell back in the foreground. */
tcsetpgrp(shell_terminal, shell_pgid);
/* Restore the shell&#x2019;s terminal modes. */
tcgetattr(shell_terminal, &amp;j-&gt;tmodes);
tcsetattr(shell_terminal, TCSADRAIN, &amp;shell_tmodes);
</code></pre><p>}</p>
<p>/<em> Put a job in the background. If the cont argument is true, send
the process group a SIGCONT signal to wake it up. </em>/
void
put_job_in_background(job <em>j, int cont)
{
    /</em> Send the job a continue signal, if necessary. */
    if (cont)
        if (kill(-j-&gt;pgid, SIGCONT) &lt; 0)
            perror(&quot;kill (SIGCONT)&quot;);
}</p>
<p>/<em> Store the status of the process pid that was returned by waitpid.
Return 0 if all went well, nonzero otherwise. </em>/
int
mark_process_status(pid_t pid, int status)
{
    job <em>j;
    process </em>p;</p>
<pre><code>if (pid &gt; 0) {
    /* Update the record for the process. */
    for (j = first_job; j; j = j-&gt;next)
        for (p = j-&gt;first_process; p; p = p-&gt;next)
            if (p-&gt;pid == pid) {
                p-&gt;status = status;

                if (WIFSTOPPED(status))
                    p-&gt;stopped = 1;
                else {
                    p-&gt;completed = 1;

                    if (WIFSIGNALED(status))
                        fprintf(stderr, &quot;%d: Terminated by signal %d.\n&quot;,
                                (int) pid, WTERMSIG(p-&gt;status));
                }

                return 0;
            }

    fprintf(stderr, &quot;No child process %d.\n&quot;, pid);
    return -1;
} else if (pid == 0 || errno == ECHILD)
    /* No processes ready to report. */
    return -1;
else {
    /* Other weird errors. */
    perror(&quot;waitpid&quot;);
    return -1;
}
</code></pre><p>}
/<em> Check for processes that have status information available,
without blocking. </em>/
void
update_status(void)
{
    int status;
    pid_t pid;</p>
<pre><code>do
    pid = waitpid(WAIT_ANY, &amp;status, WUNTRACED | WNOHANG);

while (!mark_process_status(pid, status));
</code></pre><p>}
/<em> Check for processes that have status information available,
blocking until all processes in the given job have reported. </em>/
void
wait_for_job(job *j)
{
    int status;
    pid_t pid;</p>
<pre><code>do
    pid = waitpid(WAIT_ANY, &amp;status, WUNTRACED);

while (!mark_process_status(pid, status)
       &amp;&amp; !job_is_stopped(j)
       &amp;&amp; !job_is_completed(j));
</code></pre><p>}
/<em> Format information about job status for the user to look at. </em>/
void
format_job_info(job <em>j, const char </em>status)
{
    fprintf(stderr, &quot;%ld (%s): %s\n&quot;, (long)j-&gt;pgid, status, j-&gt;command);
}
/<em> Notify the user about stopped or terminated jobs.
Delete terminated jobs from the active job list. </em>/
void
do_job_notification(void)
{
    job <em>j, </em>jlast, <em>jnext;
    process </em>p;
    /<em> Update status information for child processes. </em>/
    update_status();
    jlast = NULL;</p>
<pre><code>for (j = first_job; j; j = jnext) {
    jnext = j-&gt;next;

    /* If all processes have completed, tell the user the job has
    completed and delete it from the list of active jobs. */
    if (job_is_completed(j)) {
        format_job_info(j, &quot;completed&quot;);

        if (jlast)
            jlast-&gt;next = jnext;
        else
            first_job = jnext;

        free_job(j);
    }
    /* Notify the user about stopped jobs,
    marking them so that we won&#x2019;t do this more than once. */
    else if (job_is_stopped(j) &amp;&amp; j &gt; notified) {
        format_job_info(j, &quot;stopped&quot;);
        j-&gt;notified = 1;
        jlast = j;
    }
    /* Don&#x2019;t say anything about jobs that are still running. */
    else
        jlast = j;
}
</code></pre><p>}
/<em> Mark a stopped job J as being running again. </em>/
void
mark_job_as_running(job <em>j)
{
    Process </em>p;</p>
<pre><code>for (p = j-&gt;first_process; p; p = p-&gt;next)
    p-&gt;stopped = 0;

j-&gt;notified = 0;
</code></pre><p>}
/<em> Continue the job J. </em>/
void
continue_job(job *j, int foreground)
{
    mark_job_as_running(j);</p>
<pre><code>if (foreground)
    put_job_in_foreground(j, 1);
else
    put_job_in_background(j, 1);
</code></pre><p>}</p>
<pre><code>
# &#x7528;&#x6237;&#x548C;&#x7EC4;
*  &#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x6709;effective&#x7528;&#x6237;ID(&#x6743;&#x9650;&#x63A7;&#x5236;)&#x548C;real&#x7528;&#x6237;ID(who&#x521B;&#x5EFA;&#x4E86;&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;)
## api
```c
uid_t getuid (void)
gid_t getgid (void)
uid_t geteuid (void)
gid_t getegid (void)
int getgroups (int count, gid t *groups)
int seteuid (uid t neweuid)
int setuid (uid t newuid)
int setreuid (uid t ruid, uid t euid)
int setegid (gid t newgid)
int setgid (gid t newgid)
int setregid (gid t rgid, gid t egid)
int setgroups (size t count, const gid t *groups)
int initgroups (const char *user, gid t group)
int getgrouplist (const char *user, gid t group, gid t *groups, int *ngroups)
char * getlogin (void)
char * cuserid (char *string)
int login_tty (int filedes)
void login (const struct utmp *entry)
int logout (const char *ut_line)
void logwtmp (const char *ut_line, const char *ut_name, const char *ut_host)
</code></pre><h1 id="&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;"><a name="&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;" class="anchor-navigation-ex-anchor" href="#&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>9. &#x7CFB;&#x7EDF;&#x7BA1;&#x7406;</h1>
<pre><code class="lang-c">int gethostname (char *name, size t size)
int sethostname (const char *name, size t length)
int getdomainnname (char *name, size t length)
int setdomainname (const char *name, size t length)
long int gethostid (void)
int sethostid (long int id)
int uname (struct utsname *info)
int mount (const char *special_file, const char *dir, const char *fstype, unsigned long int options, const void *data)
int umount (const char *file)
</code></pre>
<p>&#x4F8B;&#x5982;:</p>
<pre><code class="lang-c">#include &lt;sys/mount.h&gt;
mount(&quot;/dev/hdb&quot;, &quot;/cdrom&quot;, MS_MGC_VAL | MS_RDONLY | MS_NOSUID, &quot;&quot;);
mount(&quot;/dev/hda2&quot;, &quot;/mnt&quot;, MS_MGC_VAL | MS_REMOUNT, &quot;&quot;);
</code></pre>
<pre><code class="lang-c">//&#x7CFB;&#x7EDF;&#x53C2;&#x6570;
#include &lt;sys/sysctl.h&gt;
int sysctl (int *names, int nlen, void *oldval, size t *oldlenp, void *newval, size t newlen)
```c
//&#x83B7;&#x53D6;&#x7CFB;&#x7EDF;&#x8FD0;&#x884C;&#x65F6;&#x914D;&#x7F6E;&#x53C2;&#x6570;
long int sysconf (int parameter)

int
have_job_control (void)
{
    #ifdef _POSIX_JOB_CONTROL
        return 1;
    #else
    int value = sysconf (_SC_JOB_CONTROL);
    if (value &lt; 0)
        /* If the system is that badly wedged,
        there&#x2019;s no use trying to go on. */
        fatal (strerror (errno));
    return value;
    #endif
}
int
get_child_max ()
{
    #ifdef CHILD_MAX
    return CHILD_MAX;
    #else
    int value = sysconf (_SC_CHILD_MAX);
    if (value &lt; 0)
        fatal (strerror (errno));
    return value;
    #endif
}
</code></pre>
<h1 id="&#x8C03;&#x8BD5;"><a name="&#x8C03;&#x8BD5;" class="anchor-navigation-ex-anchor" href="#&#x8C03;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a>10. &#x8C03;&#x8BD5;</h1>
<h2 id="&#x8C03;&#x7528;&#x6808;"><a name="&#x8C03;&#x7528;&#x6808;" class="anchor-navigation-ex-anchor" href="#&#x8C03;&#x7528;&#x6808;"><i class="fa fa-link" aria-hidden="true"></i></a>10.1. &#x8C03;&#x7528;&#x6808;</h2>
<pre><code class="lang-c">/*&#x8C03;&#x7528;&#x6808;
**buffer&#x91CC;&#x4E00;&#x4E2A;frame&#x6307;&#x9488;&#x5BF9;&#x5E94;&#x4E00;&#x9879;
**&#x8FD4;&#x56DE;&#x5B9E;&#x9645;&#x7684;&#x6808;&#x5E27;&#x6570;
**&#x4F18;&#x5316;&#x9009;&#x9879;&#x4F1A;&#x5F71;&#x54CD;&#x6808;&#x56DE;&#x6EAF;, &#x6BD4;&#x5982;inline&#x548C;frame pointer elimination
*/
#include &lt;execinfo.h&gt;
int backtrace (void **buffer, int size)
//&#x89E3;&#x6790;&#x8C03;&#x7528;&#x6808;&#x7B26;&#x53F7;&#x8868;, &#x524D;&#x63D0;&#x662F;&#x8FD0;&#x884C;&#x7684;elf&#x4E0D;&#x662F;strip&#x8FC7;&#x7684;?
char ** backtrace_symbols (void *const *buffer, int size)
&#x4E3E;&#x4F8B;:
```c
#include &lt;execinfo.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
/* Obtain a backtrace and print it to stdout. */
void
print_trace(void)
{
    void *array[10];
    size_t size;
    char **strings;
    size_t i;
    size = backtrace(array, 10);
    strings = backtrace_symbols(array, size);
    printf(&quot;Obtained %zd stack frames.\n&quot;, size);

    for (i = 0; i &lt; size; i++)
        printf(&quot;%s\n&quot;, strings[i]);

    free(strings);
}
/* A dummy function to make the backtrace more interesting. */
void
dummy_function(void)
{
    print_trace();
}
int
main(void)
{
    dummy_function();
    return 0;
}
</code></pre>
<h1 id="pthread"><a name="pthread" class="anchor-navigation-ex-anchor" href="#pthread"><i class="fa fa-link" aria-hidden="true"></i></a>11. pthread</h1>
<p>&#x8BE6;&#x89C1;POSIX Threads Programming(&#x975E;&#x5E38;&#x5F3A;&#x5927;)</p>
<h2 id="gnu&#x6269;&#x5C55;"><a name="gnu&#x6269;&#x5C55;" class="anchor-navigation-ex-anchor" href="#gnu&#x6269;&#x5C55;"><i class="fa fa-link" aria-hidden="true"></i></a>11.1. gnu&#x6269;&#x5C55;</h2>
<pre><code class="lang-c">//&#x7EBF;&#x7A0B;&#x72EC;&#x7ACB;&#x7684;data
int pthread_key_create (pthread key t *key, void (*destructor)(void*))
int pthread_key_delete (pthread key t key)
void *pthread_getspecific (pthread key t key)
int pthread_setspecific (pthread key t key, const void *value)
</code></pre>
<h1 id="libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;&#x7565;"><a name="libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;&#x7565;" class="anchor-navigation-ex-anchor" href="#libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;&#x7565;"><i class="fa fa-link" aria-hidden="true"></i></a>12. libc&#x7684;&#x7CFB;&#x7EDF;&#x6869;&#x51FD;&#x6570;(&#x7565;)</h1>
<h1 id="libc&#x57FA;&#x7840;&#x51FD;&#x6570;"><a name="libc&#x57FA;&#x7840;&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#libc&#x57FA;&#x7840;&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>13. libc&#x57FA;&#x7840;&#x51FD;&#x6570;</h1>
<pre><code class="lang-c">//&#x65AD;&#x8A00;, false&#x5219;&#x6253;&#x5370;__FILE__ __LINE__&#x5E76;abort(). &#x65AD;&#x8A00;&#x53EF;&#x4EE5;&#x7528;&#x5B8F;NDEBUG&#x7981;&#x6B62;&#x65AD;&#x8A00;&#x68C0;&#x67E5;
#include &lt;assert.h&gt;
void assert (int expression)
void assert_perror (int errnum)

//&#x53EF;&#x53D8;&#x53C2;&#x6570;
#include &lt;stdarg.h&gt;
</code></pre>
<p>&#x4E3E;&#x4F8B;:</p>
<pre><code class="lang-c">#include &lt;stdarg.h&gt;
#include &lt;stdio.h&gt;
int
add_em_up(int count, ...)
{
    va_list ap;
    int i, sum;
    va_start(ap, count);  /* Initialize the argument list. */
    sum = 0;

    for (i = 0; i &lt; count; i++)
        sum += va_arg(ap, int);  /* Get the next argument value. */

    va_end(ap);  /* Clean up. */
    return sum;
}
int
main(void)
{
    /* This call prints 16. */
    printf(&quot;%d\n&quot;, add_em_up(3, 5, 5, 6));
    /* This call prints 55. */
    printf(&quot;%d\n&quot;, add_em_up(10, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10));
    return 0;
}

//&#x7ED3;&#x6784;&#x4F53;&#x504F;&#x79FB;&#x91CF;
size_t offsetof (type, member)
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="system_libc_part2.html" class="navigation navigation-prev " aria-label="Previous page: libc概览2">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="system_原理杂记.html" class="navigation navigation-next " aria-label="Next page: 系统原理杂记">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"libc概览3","level":"1.12.3","depth":2,"next":{"title":"系统原理杂记","level":"1.12.4","depth":2,"path":"notes/system_原理杂记.md","ref":"notes/system_原理杂记.md","articles":[]},"previous":{"title":"libc概览2","level":"1.12.2","depth":2,"path":"notes/system_libc_part2.md","ref":"notes/system_libc_part2.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","-lunr","-search","search-plus","-highlight","theme-code","expandable-chapters-small","github","disqus","splitter","wide-page","hide-navigation-buttons","anchor-navigation-ex","sequence"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"disqus":{"useIdentifier":false,"shortName":"bai-yingjie-notes"},"sequence":{"theme":"simple"},"github":{"url":"https://github.com/Bai-Yingjie/Bai-Yingjie.github.io"},"splitter":{},"wide-page":{},"theme-code":{"showLevel":false,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}},"fontsettings":{"theme":"white","family":"sans","size":2},"hide-navigation-buttons":{},"anchor-navigation-ex":{"mode":"float","pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"isRewritePageTitle":true,"showLevel":true,"tocLevel1Icon":"fa fa-hand-o-right","tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right","showGoTop":true,"isShowTocTitleIcon":true,"printLog":false,"multipleH1":true,"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false}},"expandable-chapters-small":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"search-plus":{}},"theme":"default","author":"Bai Yingjie","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"My Notes","language":"zh-hans","gitbook":"*"},"file":{"path":"notes/system_libc_part3.md","mtime":"2022-10-11T15:10:43.018Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-10-11T15:11:40.551Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>


        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

        
    </body>
</html>

