
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>shell命令和脚本记录-高级篇 · My Notes</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Bai Yingjie">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-wide-page/wide.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hide-navigation-buttons/index.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="shell_脚本片段.html" />
    
    
    <link rel="prev" href="shell_基础篇.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="as_title_kaiyuan.html">
            
                <a href="as_title_kaiyuan.html">
            
                    
                    开源
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="my_opensource.html">
            
                <a href="my_opensource.html">
            
                    
                    我的开源项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="my_upstream.html">
            
                <a href="my_upstream.html">
            
                    
                    我的upstream commit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="as_title_system.html">
            
                <a href="as_title_system.html">
            
                    
                    系统分析和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="as_title_perf_misc.html">
            
                <a href="as_title_perf_misc.html">
            
                    
                    调试和分析记录杂记系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="profiling_调试和分析记录4.html">
            
                <a href="profiling_调试和分析记录4.html">
            
                    
                    调试和分析记录4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="profiling_调试和分析记录3.html">
            
                <a href="profiling_调试和分析记录3.html">
            
                    
                    调试和分析记录3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="profiling_调试和分析记录2.html">
            
                <a href="profiling_调试和分析记录2.html">
            
                    
                    调试和分析记录2
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="as_title_perf_tools.html">
            
                <a href="as_title_perf_tools.html">
            
                    
                    profiling工具相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="profiling_perf命令备忘录.html">
            
                <a href="profiling_perf命令备忘录.html">
            
                    
                    perf命令备忘录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="profiling_ftrace和trace-cmd记录.html">
            
                <a href="profiling_ftrace和trace-cmd记录.html">
            
                    
                    ftrace和trace-cmd记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="profiling_ftrace使用实例.html">
            
                <a href="profiling_ftrace使用实例.html">
            
                    
                    ftrace使用实例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="system_analysis_bcc和ebpf.html">
            
                <a href="system_analysis_bcc和ebpf.html">
            
                    
                    bcc和ebpf(starting)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="as_title_app_perf.html">
            
                <a href="as_title_app_perf.html">
            
                    
                    应用profiling和优化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="performance_ovs进程调查.html">
            
                <a href="performance_ovs进程调查.html">
            
                    
                    OVS进程调查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="performance_ping流程和函数调用解析.html">
            
                <a href="performance_ping流程和函数调用解析.html">
            
                    
                    ping流程和函数调用解析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="as_title_os_perf.html">
            
                <a href="as_title_os_perf.html">
            
                    
                    系统profiling和优化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="CentOS_系统性能优化配置.html">
            
                <a href="CentOS_系统性能优化配置.html">
            
                    
                    CentOS 性能优化系统配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="as_title_arch_perf.html">
            
                <a href="as_title_arch_perf.html">
            
                    
                    CPU ARCH相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1" data-path="performance_CPU_microarchiteture_pmu.html">
            
                <a href="performance_CPU_microarchiteture_pmu.html">
            
                    
                    Top-down Microarchitecture Analysis Method(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="as_title_cloud.html">
            
                <a href="as_title_cloud.html">
            
                    
                    Cloud和容器相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="cloud_杂记.html">
            
                <a href="cloud_杂记.html">
            
                    
                    云杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="container_当代容器读书笔记.html">
            
                <a href="container_当代容器读书笔记.html">
            
                    
                    当代容器读书笔记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="as_title_vdevice.html">
            
                <a href="as_title_vdevice.html">
            
                    
                    CPU和device虚拟化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="as_title_gvisor.html">
            
                <a href="as_title_gvisor.html">
            
                    
                    gvisor
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="golang_gvisor代码_KVM.html">
            
                <a href="golang_gvisor代码_KVM.html">
            
                    
                    gvisor KVM模式代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="golang_gvisor调试.html">
            
                <a href="golang_gvisor调试.html">
            
                    
                    gvisor调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="golang_gvisor_ptrace.html">
            
                <a href="golang_gvisor_ptrace.html">
            
                    
                    gvisor ptrace模式介绍(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="rust_vmm_brief.html">
            
                <a href="rust_vmm_brief.html">
            
                    
                    rust VMM(virtual machine monitor)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="rust_vmm_简介.html">
            
                <a href="rust_vmm_简介.html">
            
                    
                    rust-vmm简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="rust_firecracker_代码.html">
            
                <a href="rust_firecracker_代码.html">
            
                    
                    firecracker代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="rust_firecracker_使用.html">
            
                <a href="rust_firecracker_使用.html">
            
                    
                    firecracker使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="rust_cloud-hypervisor_代码.html">
            
                <a href="rust_cloud-hypervisor_代码.html">
            
                    
                    cloud hypervisor代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.5" data-path="rust_cloud-hypervisor_使用.html">
            
                <a href="rust_cloud-hypervisor_使用.html">
            
                    
                    cloud hypervisor使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.6" data-path="rust_cloud-hypervisor_问题与解决.html">
            
                <a href="rust_cloud-hypervisor_问题与解决.html">
            
                    
                    cloud hypervisor问题与解决
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="virtualization_virtio规范阅读笔记.html">
            
                <a href="virtualization_virtio规范阅读笔记.html">
            
                    
                    virtio规范阅读笔记.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="qemu_ovs_虚拟化环境.html">
            
                <a href="qemu_ovs_虚拟化环境.html">
            
                    
                    qemu OVS 虚拟化环境准备
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="qemu使用.html">
            
                <a href="qemu使用.html">
            
                    
                    Qemu使用(old)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="as_title_networking.html">
            
                <a href="as_title_networking.html">
            
                    
                    计算机网络相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="networking_杂记1.html">
            
                <a href="networking_杂记1.html">
            
                    
                    networking杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="as_title_qemu_ovs.html">
            
                <a href="as_title_qemu_ovs.html">
            
                    
                    Qemu OVS和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="OVS_DPDK_编译运行.html">
            
                <a href="OVS_DPDK_编译运行.html">
            
                    
                    OVS-DPDK编译运行
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.2" data-path="OVS_架构和代码.html">
            
                <a href="OVS_架构和代码.html">
            
                    
                    OVS架构和代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.3" data-path="OVS_DPDK_performance_HXT_ARM_server.html">
            
                <a href="OVS_DPDK_performance_HXT_ARM_server.html">
            
                    
                    OVS-DPDK for ARM server 性能测试环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.4" data-path="DPDK_Mellanox.html">
            
                <a href="DPDK_Mellanox.html">
            
                    
                    DPDK Mellanox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.5" data-path="OVS_phy-vm-phy.html">
            
                <a href="OVS_phy-vm-phy.html">
            
                    
                    OVS PHY-VM-PHY
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.6" data-path="networking_网络虚拟化用例记录.html">
            
                <a href="networking_网络虚拟化用例记录.html">
            
                    
                    网络虚拟化用例记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.7" data-path="networking_网络虚拟化操作记录.html">
            
                <a href="networking_网络虚拟化操作记录.html">
            
                    
                    网络虚拟化操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="as_title_virtnet.html">
            
                <a href="as_title_virtnet.html">
            
                    
                    虚拟化网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.3.1" data-path="networking_tc_filter_连接veth和tap.html">
            
                <a href="networking_tc_filter_连接veth和tap.html">
            
                    
                    Connecting a veth device to tap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.2" data-path="networking_multicast_vxlan_flannel.html">
            
                <a href="networking_multicast_vxlan_flannel.html">
            
                    
                    multicast vxlan和flannel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.3" data-path="networking_virtio网络介绍.html">
            
                <a href="networking_virtio网络介绍.html">
            
                    
                    virtio网络介绍(网摘): vhost-net virtio-net vhost-user SRIOV
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.4" data-path="networking_virtualization_杂记.html">
            
                <a href="networking_virtualization_杂记.html">
            
                    
                    虚拟化网络杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.5" data-path="networking_linux虚拟网络接口.html">
            
                <a href="networking_linux虚拟网络接口.html">
            
                    
                    linux虚拟网络接口(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="as_title_arm_server.html">
            
                <a href="as_title_arm_server.html">
            
                    
                    ARM server
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="arm_server_杂记.html">
            
                <a href="arm_server_杂记.html">
            
                    
                    Arm server 杂记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="as_title_embedded.html">
            
                <a href="as_title_embedded.html">
            
                    
                    嵌入式系统开发调试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="embedded_debugging.html">
            
                <a href="embedded_debugging.html">
            
                    
                    嵌入式调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="uboot_杂记.html">
            
                <a href="uboot_杂记.html">
            
                    
                    uboot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="buildroot_杂记.html">
            
                <a href="buildroot_杂记.html">
            
                    
                    buildroot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="toolchain_升级gcc问题解决.html">
            
                <a href="toolchain_升级gcc问题解决.html">
            
                    
                    升级GCC7.3问题解决
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="as_title_linuxdaily.html">
            
                <a href="as_title_linuxdaily.html">
            
                    
                    Linux工程实践
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="linux_日常使用.html">
            
                <a href="linux_日常使用.html">
            
                    
                    日常linux使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="git_日常使用.html">
            
                <a href="git_日常使用.html">
            
                    
                    日常git使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="向kernel提交补丁.html">
            
                <a href="向kernel提交补丁.html">
            
                    
                    向kernel提交补丁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="linux_ssh_relay.html">
            
                <a href="linux_ssh_relay.html">
            
                    
                    ssh relay
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="gitlab_ci.html">
            
                <a href="gitlab_ci.html">
            
                    
                    gitlab CI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="docker_操作记录.html">
            
                <a href="docker_操作记录.html">
            
                    
                    docker操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="centos_操作记录.html">
            
                <a href="centos_操作记录.html">
            
                    
                    centos操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="as_title_golang.html">
            
                <a href="as_title_golang.html">
            
                    
                    Golang
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="as_title_golang1.html">
            
                <a href="as_title_golang1.html">
            
                    
                    入门
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1.1" data-path="golang_语法基础.html">
            
                <a href="golang_语法基础.html">
            
                    
                    Golang 语法基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.2" data-path="golang_json性能.html">
            
                <a href="golang_json性能.html">
            
                    
                    Golang json性能比较
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="golang_原理.html">
            
                <a href="golang_原理.html">
            
                    
                    Golang 原理相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.1" data-path="golang_interface原理.html">
            
                <a href="golang_interface原理.html">
            
                    
                    Golang interface原理(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.2" data-path="golang_内存分配.html">
            
                <a href="golang_内存分配.html">
            
                    
                    Golang 内存分配(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="golang_标准库.html">
            
                <a href="golang_标准库.html">
            
                    
                    Golang 标准库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="golang_我的反射代码.html">
            
                <a href="golang_我的反射代码.html">
            
                    
                    Golang 我的反射代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="golang_问答.html">
            
                <a href="golang_问答.html">
            
                    
                    Golang 问答
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="golang_高效go.html">
            
                <a href="golang_高效go.html">
            
                    
                    Golang 高效go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="golang_进阶.html">
            
                <a href="golang_进阶.html">
            
                    
                    Golang 进阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="as_title_golang2.html">
            
                <a href="as_title_golang2.html">
            
                    
                    Golang 杂记
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.8.1" data-path="golang_杂记1.html">
            
                <a href="golang_杂记1.html">
            
                    
                    Golang 杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.2" data-path="golang_杂记2.html">
            
                <a href="golang_杂记2.html">
            
                    
                    Golang 杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.3" data-path="golang_杂记3.html">
            
                <a href="golang_杂记3.html">
            
                    
                    Golang 杂记3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.4" data-path="golang_lib选型.html">
            
                <a href="golang_lib选型.html">
            
                    
                    Golang lib选型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.5" data-path="golang_mod_proxy.html">
            
                <a href="golang_mod_proxy.html">
            
                    
                    go mod和go proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.6" data-path="golang_汇编_arm64.html">
            
                <a href="golang_汇编_arm64.html">
            
                    
                    Golang 汇编语法和arm64小知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.7" data-path="golang_cgo_swig.html">
            
                <a href="golang_cgo_swig.html">
            
                    
                    go调用c可以用swig
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="as_title_golang3.html">
            
                <a href="as_title_golang3.html">
            
                    
                    Golang 环境和工具链生成
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.9.1" data-path="golang_toolchain_ppc.html">
            
                <a href="golang_toolchain_ppc.html">
            
                    
                    go tools增加ppc32支持.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.2" data-path="golang_toolchain_compile_gccgo.html">
            
                <a href="golang_toolchain_compile_gccgo.html">
            
                    
                    编译gccgo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3" data-path="golang_go_on_mips.html">
            
                <a href="golang_go_on_mips.html">
            
                    
                    go on mips boards(not so updated)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.9.3.1" data-path="golang_go_on_mips_part1.html">
            
                <a href="golang_go_on_mips_part1.html">
            
                    
                    part 1: cross compile go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.2" data-path="golang_go_on_mips_part2.html">
            
                <a href="golang_go_on_mips_part2.html">
            
                    
                    part 2: build native go compiler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.3" data-path="golang_go_on_mips_part3.html">
            
                <a href="golang_go_on_mips_part3.html">
            
                    
                    part 3: gccgo experiments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.4" data-path="golang_go_on_mips_part4.html">
            
                <a href="golang_go_on_mips_part4.html">
            
                    
                    part 4: Golang json performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.5" data-path="golang_gentoo_on_mips_board_and_build_go.html">
            
                <a href="golang_gentoo_on_mips_board_and_build_go.html">
            
                    
                    Gentoo on mips board and build go
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.10" data-path="as_title_golang4.html">
            
                <a href="as_title_golang4.html">
            
                    
                    微服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.10.1" data-path="golang_micro.html">
            
                <a href="golang_micro.html">
            
                    
                    go-micro和micro
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.2" data-path="golang_微服务概念.html">
            
                <a href="golang_微服务概念.html">
            
                    
                    微服务概念
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.11" data-path="as_title_golang5.html">
            
                <a href="as_title_golang5.html">
            
                    
                    解释器和编解码
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.11.1" data-path="golang_yeagi.html">
            
                <a href="golang_yeagi.html">
            
                    
                    解释器yeagi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.2" data-path="golang_tengo.html">
            
                <a href="golang_tengo.html">
            
                    
                    解释器tengo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.3" data-path="golang_govaluate.html">
            
                <a href="golang_govaluate.html">
            
                    
                    解释器govaluate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.4" data-path="golang_encoding_gotiny.html">
            
                <a href="golang_encoding_gotiny.html">
            
                    
                    gotiny编解码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.5" data-path="golang_abs.html">
            
                <a href="golang_abs.html">
            
                    
                    解释器abs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.12" data-path="as_title_golang6.html">
            
                <a href="as_title_golang6.html">
            
                    
                    调试和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.12.1" data-path="golang_调试记录.html">
            
                <a href="golang_调试记录.html">
            
                    
                    Golang 调试记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12.2" data-path="golang_topid性能优化.html">
            
                <a href="golang_topid性能优化.html">
            
                    
                    Golang topid性能优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12.3" data-path="golang_gshell性能调试.html">
            
                <a href="golang_gshell性能调试.html">
            
                    
                    Golang gshell性能调试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.13" data-path="as_title_golang7.html">
            
                <a href="as_title_golang7.html">
            
                    
                    网络和消息中间件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.13.1" data-path="golang_zmq.html">
            
                <a href="golang_zmq.html">
            
                    
                    消息中间件基本概念和zero mq
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.2" data-path="golang_mango.html">
            
                <a href="golang_mango.html">
            
                    
                    消息中间件mango
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.3" data-path="golang_libp2p.html">
            
                <a href="golang_libp2p.html">
            
                    
                    Golang p2p网络
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="as_title_rust.html">
            
                <a href="as_title_rust.html">
            
                    
                    Rust
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="rust_入门_brief.html">
            
                <a href="rust_入门_brief.html">
            
                    
                    Rust 入门系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1.1" data-path="rust_books.html">
            
                <a href="rust_books.html">
            
                    
                    Rust reference books
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.2" data-path="rust_入门1.html">
            
                <a href="rust_入门1.html">
            
                    
                    Rust 安装和基础语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.3" data-path="rust_入门2.html">
            
                <a href="rust_入门2.html">
            
                    
                    Rust 泛型和内存所有权
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.4" data-path="rust_入门3.html">
            
                <a href="rust_入门3.html">
            
                    
                    Rust 闭包 容器 迭代器 生成器 线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.5" data-path="rust_工程构建.html">
            
                <a href="rust_工程构建.html">
            
                    
                    Rust 工程构建
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="rust_coding_brief.html">
            
                <a href="rust_coding_brief.html">
            
                    
                    Rust 代码积累
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.2.1" data-path="rust_序列化.html">
            
                <a href="rust_序列化.html">
            
                    
                    Rust 序列化原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.2" data-path="rust_知识点积累.html">
            
                <a href="rust_知识点积累.html">
            
                    
                    Rust 知识点更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.3" data-path="rust_adaptiveservice.html">
            
                <a href="rust_adaptiveservice.html">
            
                    
                    rust版本的adaptiveservice探索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.4" data-path="rust_常用设施.html">
            
                <a href="rust_常用设施.html">
            
                    
                    Rust 常用设施
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.5" data-path="rust_代码小段.html">
            
                <a href="rust_代码小段.html">
            
                    
                    Rust 代码小段
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="others.html">
            
                <a href="others.html">
            
                    
                    其他
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.3.1" data-path="rust_mdbook_使用.html">
            
                <a href="rust_mdbook_使用.html">
            
                    
                    Rust 使用mdbook
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="as_title_scripts.html">
            
                <a href="as_title_scripts.html">
            
                    
                    脚本
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="shell_变量.html">
            
                <a href="shell_变量.html">
            
                    
                    shell变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="shell_基础篇.html">
            
                <a href="shell_基础篇.html">
            
                    
                    shell命令和脚本记录-基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.12.3" data-path="shell_高级篇.html">
            
                <a href="shell_高级篇.html">
            
                    
                    shell命令和脚本记录-高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="shell_脚本片段.html">
            
                <a href="shell_脚本片段.html">
            
                    
                    shell脚本片段
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="python_记录.html">
            
                <a href="python_记录.html">
            
                    
                    python记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="lua_记录.html">
            
                <a href="lua_记录.html">
            
                    
                    lua记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="shell_rds脚本阅读.html">
            
                <a href="shell_rds脚本阅读.html">
            
                    
                    RDS脚本阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="Project_Euler.html">
            
                <a href="Project_Euler.html">
            
                    
                    Project Euler
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="as_title_app.html">
            
                <a href="as_title_app.html">
            
                    
                    应用相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="app_sysbench代码分析.html">
            
                <a href="app_sysbench代码分析.html">
            
                    
                    sysbench代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="as_title_cos.html">
            
                <a href="as_title_cos.html">
            
                    
                    C和Operating System
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="system_libc_part1.html">
            
                <a href="system_libc_part1.html">
            
                    
                    libc概览1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="system_libc_part2.html">
            
                <a href="system_libc_part2.html">
            
                    
                    libc概览2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3" data-path="system_libc_part3.html">
            
                <a href="system_libc_part3.html">
            
                    
                    libc概览3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.4" data-path="system_原理杂记.html">
            
                <a href="system_原理杂记.html">
            
                    
                    系统原理杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5" data-path="system_alpine.html">
            
                <a href="system_alpine.html">
            
                    
                    Alpine Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.6" data-path="system_进程间通信.html">
            
                <a href="system_进程间通信.html">
            
                    
                    进程间通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.7" data-path="system_特殊功能fd.html">
            
                <a href="system_特殊功能fd.html">
            
                    
                    eventfd timerfd signalfd和fd共享
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.8" data-path="c_automake_autoconf.html">
            
                <a href="c_automake_autoconf.html">
            
                    
                    automake autoconf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.9" data-path="makefile_原理和实践.html">
            
                <a href="makefile_原理和实践.html">
            
                    
                    makefile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.10" data-path="c_编程杂记高级篇.html">
            
                <a href="c_编程杂记高级篇.html">
            
                    
                    C编程杂记高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.11" data-path="c_编程杂记基础篇.html">
            
                <a href="c_编程杂记基础篇.html">
            
                    
                    C编程杂记基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.12" data-path="c_networking_socket高阶用法.html">
            
                <a href="c_networking_socket高阶用法.html">
            
                    
                    网络编程: Advanced Socket Topics(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.13" data-path="c_protobuf介绍.html">
            
                <a href="c_protobuf介绍.html">
            
                    
                    序列化: protobuf介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.14" data-path="c_进程间通信_共享文件和共享内存.html">
            
                <a href="c_进程间通信_共享文件和共享内存.html">
            
                    
                    进程间通信: 共享文件和共享内存(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.15" data-path="c_pthread_condition和mutex.html">
            
                <a href="c_pthread_condition和mutex.html">
            
                    
                    并发 任务 事件 和锁.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.16" data-path="kernel_user_space_howto.html">
            
                <a href="kernel_user_space_howto.html">
            
                    
                    kernel space和user space交互(网摘, linux2.6)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="as_title_driver.html">
            
                <a href="as_title_driver.html">
            
                    
                    内核 设备和驱动相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="platform_device_driver.html">
            
                <a href="platform_device_driver.html">
            
                    
                    平台驱动杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="device_driver_杂记.html">
            
                <a href="device_driver_杂记.html">
            
                    
                    驱动调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="device_localbus_16bit读写.html">
            
                <a href="device_localbus_16bit读写.html">
            
                    
                    CPLD做8bit到16bit转换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4" data-path="as_title_driver1.html">
            
                <a href="as_title_driver1.html">
            
                    
                    nand
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.4.1" data-path="device_driver_octeon_nand.html">
            
                <a href="device_driver_octeon_nand.html">
            
                    
                    octeon nand flash驱动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4.2" data-path="device_driver_nand概率写失败问题分析.html">
            
                <a href="device_driver_nand概率写失败问题分析.html">
            
                    
                    Nand flash概率写失败问题分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.5" data-path="octeon_remote_pci.html">
            
                <a href="octeon_remote_pci.html">
            
                    
                    octeon remote-pci.c阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.6" data-path="Device_VFIO_notes.html">
            
                <a href="Device_VFIO_notes.html">
            
                    
                    VFIO简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7" data-path="as_title_driver2.html">
            
                <a href="as_title_driver2.html">
            
                    
                    智能网卡和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.7.1" data-path="smartNIC_智能网卡对比.html">
            
                <a href="smartNIC_智能网卡对比.html">
            
                    
                    智能网卡对比
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.2" data-path="octeon_pci_NIC.html">
            
                <a href="octeon_pci_NIC.html">
            
                    
                    octeon PCI NIC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.3" data-path="as_title_driver3.html">
            
                <a href="as_title_driver3.html">
            
                    
                    octeon liquidIO
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.7.3.1" data-path="smartNIC_liquidIO_代码阅读app篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读app篇.html">
            
                    
                    PCI-NIC 代码阅读 --app篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.3.2" data-path="smartNIC_liquidIO_代码阅读api篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读api篇.html">
            
                    
                    PCI-NIC 代码阅读 --api篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.3.3" data-path="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇之结构体
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.3.4" data-path="smartNIC_liquidIO_代码阅读driver篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.3.5" data-path="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                    
                    PCI-NIC 代码阅读 --真NIC篇
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.7.4" data-path="networking_dpdk使用_2014.html">
            
                <a href="networking_dpdk使用_2014.html">
            
                    
                    DPDK使用(2014)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.8" data-path="device_nvme要点介绍.html">
            
                <a href="device_nvme要点介绍.html">
            
                    
                    nvme要点介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="as_title_cpu.html">
            
                <a href="as_title_cpu.html">
            
                    
                    CPU Arch相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="cache_CPU和cache一致性原理.html">
            
                <a href="cache_CPU和cache一致性原理.html">
            
                    
                    CPU和cache一致性原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="as_title_cpu1.html">
            
                <a href="as_title_cpu1.html">
            
                    
                    ARM64
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.2.1" data-path="CPU_ARM64_thunder_overview.html">
            
                <a href="CPU_ARM64_thunder_overview.html">
            
                    
                    thunder 概览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.2" data-path="CPU_ARM64_thunder_开发板操作记录.html">
            
                <a href="CPU_ARM64_thunder_开发板操作记录.html">
            
                    
                    thunder 开发板操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.3" data-path="CPU_ARM64_thunder_bdk.html">
            
                <a href="CPU_ARM64_thunder_bdk.html">
            
                    
                    thunder BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.4" data-path="CPU_ARM64_thunder_efi_rtc.html">
            
                <a href="CPU_ARM64_thunder_efi_rtc.html">
            
                    
                    thunder RTC时间和efi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.5" data-path="CPU_ARM64_thunder_uefi_fdt.html">
            
                <a href="CPU_ARM64_thunder_uefi_fdt.html">
            
                    
                    thunder uefi和fdt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.6" data-path="CPU_ARM64_thunder_atf.html">
            
                <a href="CPU_ARM64_thunder_atf.html">
            
                    
                    thunder atf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.7" data-path="CPU_ARM64_thunder_kernel_boot.html">
            
                <a href="CPU_ARM64_thunder_kernel_boot.html">
            
                    
                    thunder kernel启动打印流程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="as_title_cpu2.html">
            
                <a href="as_title_cpu2.html">
            
                    
                    PPC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.3.1" data-path="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                <a href="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                    
                    PPC启动多核linux: 流程和内存映射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3.2" data-path="CPU_PPC_kernel升级记录.html">
            
                <a href="CPU_PPC_kernel升级记录.html">
            
                    
                    PPC kernel升级记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.4" data-path="as_title_cpu3.html">
            
                <a href="as_title_cpu3.html">
            
                    
                    MIPS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.4.1" data-path="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                <a href="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                    
                    octeon 地址空间和寄存器访问
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.2" data-path="CPU_MIPS_octeon操作记录.html">
            
                <a href="CPU_MIPS_octeon操作记录.html">
            
                    
                    octeon 操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.3" data-path="CPU_MIPS_octeon_包处理性能.html">
            
                <a href="CPU_MIPS_octeon_包处理性能.html">
            
                    
                    octeon 系列处理器包处理性能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.4" data-path="CPU_MIPS_octeon_ddr调试记录.html">
            
                <a href="CPU_MIPS_octeon_ddr调试记录.html">
            
                    
                    octeon DDR调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.5" data-path="CPU_MIPS_octeon_BDK.html">
            
                <a href="CPU_MIPS_octeon_BDK.html">
            
                    
                    octeon CN78xx BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.6" data-path="kernel_增加ECC中断.html">
            
                <a href="kernel_增加ECC中断.html">
            
                    
                    octeon 增加ECC中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.7" data-path="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                <a href="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                    
                    octeon hw-ddr2代码走读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.8" data-path="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                <a href="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                    
                    octeon reboot调试和DDR中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.9" data-path="CPU_MIPS_octeon中断.html">
            
                <a href="CPU_MIPS_octeon中断.html">
            
                    
                    octeon 中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.10" data-path="CPU_MIPS_octeon原子操作.html">
            
                <a href="CPU_MIPS_octeon原子操作.html">
            
                    
                    octeon 原子操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.11" data-path="CPU_MIPS_octeon网口代码分析.html">
            
                <a href="CPU_MIPS_octeon网口代码分析.html">
            
                    
                    octeon 网口代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >shell命令和脚本记录-高级篇</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#&#x7528;socat&#x8FDE;&#x63A5;pty"><b>1. </b>&#x7528;socat&#x8FDE;&#x63A5;pty</a></li><ul><li><span class="title-icon "></span><a href="#&#x4EC0;&#x4E48;&#x662F;tty-pty"><b>1.1. </b>&#x4EC0;&#x4E48;&#x662F;tty pty</a></li><li><span class="title-icon "></span><a href="#&#x8BFB;&#x5199;pts"><b>1.2. </b>&#x8BFB;&#x5199;pts</a></li></ul><li><span class="title-icon "></span><a href="#socat&#x6982;&#x89C8;"><b>2. </b>socat&#x6982;&#x89C8;</a></li><ul><li><span class="title-icon "></span><a href="#&#x5E38;&#x7528;&#x9009;&#x9879;"><b>2.1. </b>&#x5E38;&#x7528;&#x9009;&#x9879;</a></li><li><span class="title-icon "></span><a href="#&#x5730;&#x5740;&#x683C;&#x5F0F;"><b>2.2. </b>&#x5730;&#x5740;&#x683C;&#x5F0F;</a></li><li><span class="title-icon "></span><a href="#&#x5730;&#x5740;&#x7C7B;&#x578B;"><b>2.3. </b>&#x5730;&#x5740;&#x7C7B;&#x578B;</a></li><ul><li><span class="title-icon "></span><a href="#&#x9009;&#x9879;"><b>2.3.1. </b>&#x9009;&#x9879;</a></li></ul><li><span class="title-icon "></span><a href="#&#x4F8B;&#x5B50;"><b>2.4. </b>&#x4F8B;&#x5B50;</a></li></ul><li><span class="title-icon "></span><a href="#&#x811A;&#x672C;&#x547D;&#x4EE4;&#x884C;&#x89E3;&#x6790;&#x4E4B;declare--f"><b>3. </b>&#x811A;&#x672C;&#x547D;&#x4EE4;&#x884C;&#x89E3;&#x6790;&#x4E4B;declare -f</a></li><li><span class="title-icon "></span><a href="#shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x548C;&#x5F15;&#x53F7;&#x4FDD;&#x7559;"><b>4. </b>shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x548C;&#x5F15;&#x53F7;&#x4FDD;&#x7559;</a></li><ul><li><span class="title-icon "></span><a href="#&#x80CC;&#x666F;"><b>4.1. </b>&#x80CC;&#x666F;:</a></li><li><span class="title-icon "></span><a href="#&#x7B80;&#x5355;wrapper"><b>4.2. </b>&#x7B80;&#x5355;wrapper</a></li><li><span class="title-icon "></span><a href="#&#x53C2;&#x6570;&#x91CD;&#x8F7D;"><b>4.3. </b>&#x53C2;&#x6570;&#x91CD;&#x8F7D;</a></li><li><span class="title-icon "></span><a href="#&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#x5BFC;&#x81F4;&#x5B57;&#x7B26;&#x4E32;&#x591A;&#x53D8;&#x4E00;"><b>4.4. </b>&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#x5BFC;&#x81F4;&#x5B57;&#x7B26;&#x4E32;&#x591A;&#x53D8;&#x4E00;</a></li><li><span class="title-icon "></span><a href="#shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x65B9;&#x5F0F;"><b>4.5. </b>shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x65B9;&#x5F0F;</a></li><li><span class="title-icon "></span><a href="#printf"><b>4.6. </b>printf</a></li><li><span class="title-icon "></span><a href="#&#x6700;&#x7EC8;&#x7248;-&#x7528;eval"><b>4.7. </b>&#x6700;&#x7EC8;&#x7248;, &#x7528;eval</a></li><li><span class="title-icon "></span><a href="#&#x8865;&#x5145;-shell&#x7684;&#x53D8;&#x91CF;&#x6269;&#x5C55;"><b>4.8. </b>&#x8865;&#x5145;: shell&#x7684;&#x53D8;&#x91CF;&#x6269;&#x5C55;</a></li></ul><li><span class="title-icon "></span><a href="#curl&#x4F7F;&#x7528;&#x8BF4;&#x660E;&#x548C;&#x4E3E;&#x4F8B;"><b>5. </b>curl&#x4F7F;&#x7528;&#x8BF4;&#x660E;&#x548C;&#x4E3E;&#x4F8B;</a></li><ul><li><span class="title-icon "></span><a href="#&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;1"><b>5.1. </b>&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;1</a></li><li><span class="title-icon "></span><a href="#&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;2"><b>5.2. </b>&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;2</a></li><li><span class="title-icon "></span><a href="#&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;3"><b>5.3. </b>&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;3</a></li><li><span class="title-icon "></span><a href="#url&#x683C;&#x5F0F;"><b>5.4. </b>URL&#x683C;&#x5F0F;</a></li></ul><li><span class="title-icon "></span><a href="#curl&#x548C;restful-gitlab-api&#x4E3E;&#x4F8B;"><b>6. </b>curl&#x548C;RESTful gitlab API&#x4E3E;&#x4F8B;</a></li><ul><li><span class="title-icon "></span><a href="#&#x7B80;&#x4ECB;"><b>6.1. </b>&#x7B80;&#x4ECB;</a></li><li><span class="title-icon "></span><a href="#&#x4E3E;&#x4F8B;"><b>6.2. </b>&#x4E3E;&#x4F8B;</a></li><ul><li><span class="title-icon "></span><a href="#&#x521B;&#x5EFA;&#x65B0;project"><b>6.2.1. </b>&#x521B;&#x5EFA;&#x65B0;project</a></li><li><span class="title-icon "></span><a href="#&#x83B7;&#x53D6;gitignore&#x6A21;&#x677F;"><b>6.2.2. </b>&#x83B7;&#x53D6;gitignore&#x6A21;&#x677F;</a></li><li><span class="title-icon "></span><a href="#&#x5206;&#x652F;&#x7EF4;&#x62A4;"><b>6.2.3. </b>&#x5206;&#x652F;&#x7EF4;&#x62A4;</a></li></ul></ul><li><span class="title-icon "></span><a href="#sed&#x89E3;&#x6790;log"><b>7. </b>sed&#x89E3;&#x6790;log</a></li><li><span class="title-icon "></span><a href="#cpu&#x5229;&#x7528;&#x7387;&#x6761;&#x4EF6;&#x89E6;&#x53D1;perf-record"><b>8. </b>CPU&#x5229;&#x7528;&#x7387;&#x6761;&#x4EF6;&#x89E6;&#x53D1;perf record</a></li><li><span class="title-icon "></span><a href="#top&#x7684;&#x8BB0;&#x5F55;&#x5BFC;&#x5165;&#x5230;excel"><b>9. </b>top&#x7684;&#x8BB0;&#x5F55;&#x5BFC;&#x5165;&#x5230;excel</a></li><ul><li><span class="title-icon "></span><a href="#&#x6BD4;&#x8F83;&#x7C97;&#x7CD9;&#x7684;&#x7248;&#x672C;"><b>9.1. </b>&#x6BD4;&#x8F83;&#x7C97;&#x7CD9;&#x7684;&#x7248;&#x672C;</a></li><ul><li><span class="title-icon "></span><a href="#cpu"><b>9.1.1. </b>CPU</a></li><li><span class="title-icon "></span><a href="#mem"><b>9.1.2. </b>mem</a></li></ul><li><span class="title-icon "></span><a href="#&#x540C;&#x65F6;&#x5BFC;&#x51FA;cpu&#x5229;&#x7528;&#x7387;&#x548C;mem"><b>9.2. </b>&#x540C;&#x65F6;&#x5BFC;&#x51FA;CPU&#x5229;&#x7528;&#x7387;&#x548C;mem</a></li><li><span class="title-icon "></span><a href="#&#x53EA;&#x5BFC;&#x51FA;cpu&#x5229;&#x7528;&#x7387;"><b>9.3. </b>&#x53EA;&#x5BFC;&#x51FA;cpu&#x5229;&#x7528;&#x7387;</a></li><ul><li><span class="title-icon "></span><a href="#&#x6539;&#x8FDB;&#x7248;"><b>9.3.1. </b>&#x6539;&#x8FDB;&#x7248;</a></li></ul></ul><li><span class="title-icon "></span><a href="#&#x7528;tr&#x5904;&#x7406;&#x591A;&#x4F59;&#x5B57;&#x7B26;"><b>10. </b>&#x7528;tr&#x5904;&#x7406;&#x591A;&#x4F59;&#x5B57;&#x7B26;</a></li><li><span class="title-icon "></span><a href="#&#x4E00;&#x6B21;shell&#x91CD;&#x5B9A;&#x5411;&#x8FC7;&#x7A0B;"><b>11. </b>&#x4E00;&#x6B21;shell&#x91CD;&#x5B9A;&#x5411;&#x8FC7;&#x7A0B;</a></li><ul><li><span class="title-icon "></span><a href="#shell&#x91CD;&#x5B9A;&#x5411;&#x548C;exec"><b>11.1. </b>shell&#x91CD;&#x5B9A;&#x5411;&#x548C;exec</a></li></ul><li><span class="title-icon "></span><a href="#&#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;&#x53CA;&#x5176;&#x5F15;&#x7528;-eval&#x7684;&#x4F7F;&#x7528;"><b>12. </b>&#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;&#x53CA;&#x5176;&#x5F15;&#x7528;: eval&#x7684;&#x4F7F;&#x7528;</a></li><ul><li><span class="title-icon "></span><a href="#&#x7528;eval&#x751F;&#x6210;&#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;"><b>12.1. </b>&#x7528;eval&#x751F;&#x6210;&#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;</a></li><li><span class="title-icon "></span><a href="#&#x95F4;&#x63A5;&#x5F15;&#x7528;&#x53D8;&#x91CF;"><b>12.2. </b>&#x95F4;&#x63A5;&#x5F15;&#x7528;&#x53D8;&#x91CF;</a></li><li><span class="title-icon "></span><a href="#&#x4E3E;&#x4F8B;-&#x8BFB;&#x51FA;conf&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5230;&#x52A8;&#x6001;&#x6587;&#x4EF6;&#x540D;&#x53D8;&#x91CF;"><b>12.3. </b>&#x4E3E;&#x4F8B;: &#x8BFB;&#x51FA;*.conf&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5230;&#x52A8;&#x6001;&#x6587;&#x4EF6;&#x540D;&#x53D8;&#x91CF;</a></li><li><span class="title-icon "></span><a href="#uaes&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;-&#x5173;&#x7CFB;&#x6570;&#x7EC4;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;"><b>12.4. </b>uaes&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;, &#x5173;&#x7CFB;&#x6570;&#x7EC4;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5224;&#x65AD;&#x5B57;&#x4E32;&#x662F;&#x5426;&#x5305;&#x542B;&#x5B57;&#x4E32;"><b>13. </b>&#x5224;&#x65AD;&#x5B57;&#x4E32;&#x662F;&#x5426;&#x5305;&#x542B;&#x5B57;&#x4E32;</a></li><li><span class="title-icon "></span><a href="#exec&#x91CD;&#x5B9A;&#x5411;"><b>14. </b>exec&#x91CD;&#x5B9A;&#x5411;</a></li><ul><li><span class="title-icon "></span><a href="#&#x5728;shell&#x91CC;&#x76F4;&#x63A5;&#x91CD;&#x5B9A;&#x5411;stdin"><b>14.1. </b>&#x5728;shell&#x91CC;&#x76F4;&#x63A5;&#x91CD;&#x5B9A;&#x5411;stdin</a></li><li><span class="title-icon "></span><a href="#&#x91CD;&#x5B9A;&#x5411;&#x6574;&#x4E2A;shell&#x7684;stdout"><b>14.2. </b>&#x91CD;&#x5B9A;&#x5411;&#x6574;&#x4E2A;shell&#x7684;stdout</a></li><li><span class="title-icon "></span><a href="#&#x8F93;&#x5165;&#x548C;&#x8F93;&#x51FA;&#x7684;&#x4F8B;&#x5B50;"><b>14.3. </b>&#x8F93;&#x5165;&#x548C;&#x8F93;&#x51FA;&#x7684;&#x4F8B;&#x5B50;</a></li><li><span class="title-icon "></span><a href="#crosstool-ng&#x7684;&#x4F8B;&#x5B50;"><b>14.4. </b>crosstool ng&#x7684;&#x4F8B;&#x5B50;</a></li><li><span class="title-icon "></span><a href="#&#x8865;&#x5145;-test&#x53EF;&#x4EE5;&#x68C0;&#x6D4B;fd&#x662F;&#x5426;&#x662F;terminal"><b>14.5. </b>&#x8865;&#x5145;: test&#x53EF;&#x4EE5;&#x68C0;&#x6D4B;FD&#x662F;&#x5426;&#x662F;terminal</a></li></ul><li><span class="title-icon "></span><a href="#shell&#x8BFB;&#x5199;socket"><b>15. </b>shell&#x8BFB;&#x5199;socket</a></li><ul><li><span class="title-icon "></span><a href="#&#x66F4;&#x7B80;&#x5355;&#x7684;&#x5199;&#x6CD5;"><b>15.1. </b>&#x66F4;&#x7B80;&#x5355;&#x7684;&#x5199;&#x6CD5;</a></li><li><span class="title-icon "></span><a href="#devtcp&#x662F;shell&#x5185;&#x5EFA;&#x7684;&#x8BBE;&#x5907;&#x8282;&#x70B9;"><b>15.2. </b>/dev/tcp&#x662F;shell&#x5185;&#x5EFA;&#x7684;&#x8BBE;&#x5907;&#x8282;&#x70B9;</a></li></ul><li><span class="title-icon "></span><a href="#shell&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;"><b>16. </b>shell&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;</a></li><ul><li><span class="title-icon "></span><a href="#&#x6709;&#x540D;&#x7BA1;&#x9053;&#x548C;nc"><b>16.1. </b>&#x6709;&#x540D;&#x7BA1;&#x9053;&#x548C;nc</a></li></ul><li><span class="title-icon "></span><a href="#shell&#x68C0;&#x67E5;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;include&#x4E86;"><b>17. </b>shell&#x68C0;&#x67E5;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;include&#x4E86;</a></li><li><span class="title-icon "></span><a href="#sed"><b>18. </b>sed</a></li><ul><li><span class="title-icon "></span><a href="#&#x5411;sed&#x4F20;&#x9012;&#x53D8;&#x91CF;"><b>18.1. </b>&#x5411;sed&#x4F20;&#x9012;&#x53D8;&#x91CF;</a></li><li><span class="title-icon "></span><a href="#sed&#x4F7F;&#x7528;&#x8BB0;&#x5F55;"><b>18.2. </b>sed&#x4F7F;&#x7528;&#x8BB0;&#x5F55;</a></li><li><span class="title-icon "></span><a href="#sed&#x547D;&#x4EE4;"><b>18.3. </b>sed&#x547D;&#x4EE4;</a></li><li><span class="title-icon "></span><a href="#sed&#x5339;&#x914D;2&#x884C;&#x4E4B;&#x95F4;&#x7684;&#x5185;&#x5BB9;"><b>18.4. </b>sed&#x5339;&#x914D;2&#x884C;&#x4E4B;&#x95F4;&#x7684;&#x5185;&#x5BB9;</a></li><li><span class="title-icon "></span><a href="#&#x63D0;&#x53D6;&#x6587;&#x4EF6;&#x7279;&#x5B9A;&#x884C;"><b>18.5. </b>&#x63D0;&#x53D6;&#x6587;&#x4EF6;&#x7279;&#x5B9A;&#x884C;</a></li><li><span class="title-icon "></span><a href="#sed&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;"><b>18.6. </b>sed&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;</a></li><li><span class="title-icon "></span><a href="#sed&#x5B9A;&#x5740;&#x66FF;&#x6362;"><b>18.7. </b>sed&#x5B9A;&#x5740;&#x66FF;&#x6362;</a></li><li><span class="title-icon "></span><a href="#sed&#x5220;&#x9664;"><b>18.8. </b>sed&#x5220;&#x9664;</a></li><li><span class="title-icon "></span><a href="#sed&#x66FF;&#x6362;&#x5F15;&#x7528;"><b>18.9. </b>sed&#x66FF;&#x6362;&#x5F15;&#x7528;</a></li><li><span class="title-icon "></span><a href="#sed&#x7684;&#x5206;&#x7EC4;&#x5339;&#x914D;-&#x7528;&#x5206;&#x7EC4;-&#x7528;1&#x5F15;&#x7528;"><b>18.10. </b>sed&#x7684;&#x5206;&#x7EC4;&#x5339;&#x914D;, &#x7528;()&#x5206;&#x7EC4;, &#x7528;\1&#x5F15;&#x7528;</a></li></ul><li><span class="title-icon "></span><a href="#awk"><b>19. </b>awk</a></li><ul><li><span class="title-icon "></span><a href="#shell&#x53D8;&#x91CF;&#x4F20;&#x7ED9;awk"><b>19.1. </b>shell&#x53D8;&#x91CF;&#x4F20;&#x7ED9;awk</a></li><li><span class="title-icon "></span><a href="#&#x518D;&#x8BF4;patten"><b>19.2. </b>&#x518D;&#x8BF4;patten</a></li><li><span class="title-icon "></span><a href="#awk&#x5728;if&#x91CC;&#x5339;&#x914D;"><b>19.3. </b>awk&#x5728;if&#x91CC;&#x5339;&#x914D;</a></li><li><span class="title-icon "></span><a href="#awk&#x652F;&#x6301;&#x6D6E;&#x70B9;"><b>19.4. </b>awk&#x652F;&#x6301;&#x6D6E;&#x70B9;</a></li><li><span class="title-icon "></span><a href="#awk&#x903B;&#x8F91;&#x4E0E;"><b>19.5. </b>awk&#x903B;&#x8F91;&#x4E0E;</a></li><li><span class="title-icon "></span><a href="#awk&#x591A;&#x884C;&#x89E3;&#x6790;"><b>19.6. </b>awk&#x591A;&#x884C;&#x89E3;&#x6790;</a></li><li><span class="title-icon "></span><a href="#awk&#x5206;&#x7EC4;&#x63D0;&#x53D6;"><b>19.7. </b>awk&#x5206;&#x7EC4;&#x63D0;&#x53D6;</a></li><li><span class="title-icon "></span><a href="#awk&#x53D8;&#x91CF;"><b>19.8. </b>awk&#x53D8;&#x91CF;</a></li><li><span class="title-icon "></span><a href="#awk&#x6570;&#x7EC4;"><b>19.9. </b>awk&#x6570;&#x7EC4;</a></li><li><span class="title-icon "></span><a href="#awk&#x5B57;&#x7B26;&#x4E32;&#x66FF;&#x6362;"><b>19.10. </b>awk&#x5B57;&#x7B26;&#x4E32;&#x66FF;&#x6362;</a></li><li><span class="title-icon "></span><a href="#awk&#x7684;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#x548C;&#x6570;&#x5B57;&#x8FD0;&#x7B97;"><b>19.11. </b>awk&#x7684;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#x548C;&#x6570;&#x5B57;&#x8FD0;&#x7B97;</a></li><li><span class="title-icon "></span><a href="#awk&#x6267;&#x884C;&#x5176;&#x4ED6;&#x7A0B;&#x5E8F;"><b>19.12. </b>awk&#x6267;&#x884C;&#x5176;&#x4ED6;&#x7A0B;&#x5E8F;</a></li><li><span class="title-icon "></span><a href="#awk&#x66FF;&#x6362;&#x547D;&#x4EE4;"><b>19.13. </b>awk&#x66FF;&#x6362;&#x547D;&#x4EE4;</a></li></ul><li><span class="title-icon "></span><a href="#shell&#x7BA1;&#x9053;&#x548C;&#x5FAA;&#x73AF;"><b>20. </b>shell&#x7BA1;&#x9053;&#x548C;&#x5FAA;&#x73AF;</a></li><li><span class="title-icon "></span><a href="#&#x770B;&#x4E00;&#x4E2A;interface&#x662F;&#x5426;&#x5B58;&#x5728;"><b>21. </b>&#x770B;&#x4E00;&#x4E2A;interface&#x662F;&#x5426;&#x5B58;&#x5728;</a></li><ul><li><span class="title-icon "></span><a href="#&#x7528;procnetdev"><b>21.1. </b>&#x7528;/proc/net/dev</a></li><li><span class="title-icon "></span><a href="#&#x7528;ifconfig-intf&#x8FD4;&#x56DE;&#x503C;"><b>21.2. </b>&#x7528;ifconfig intf&#x8FD4;&#x56DE;&#x503C;</a></li></ul><li><span class="title-icon "></span><a href="#awk&#x8BA1;&#x7B97;&#x65F6;&#x95F4;&#x5DEE;"><b>22. </b>awk&#x8BA1;&#x7B97;&#x65F6;&#x95F4;&#x5DEE;</a></li><li><span class="title-icon "></span><a href="#ping&#x5EF6;&#x8FDF;&#x5927;&#x4E8E;05ms&#x89E6;&#x53D1;&#x52A8;&#x4F5C;"><b>23. </b>ping&#x5EF6;&#x8FDF;&#x5927;&#x4E8E;0.5ms&#x89E6;&#x53D1;&#x52A8;&#x4F5C;</a></li><li><span class="title-icon "></span><a href="#&#x8BA1;&#x7B97;cpu&#x63A9;&#x7801;-mask"><b>24. </b>&#x8BA1;&#x7B97;cpu&#x63A9;&#x7801;, mask</a></li><li><span class="title-icon "></span><a href="#shell&#x7684;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;"><b>25. </b>shell&#x7684;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;</a></li><li><span class="title-icon "></span><a href="#&#x7C98;&#x8D34;&#x591A;&#x884C;&#x6587;&#x672C;&#x7BA1;&#x9053;&#x540E;&#x518D;&#x7528;&#x540E;&#x7EED;&#x547D;&#x4EE4;&#x5904;&#x7406;"><b>26. </b>&#x7C98;&#x8D34;&#x591A;&#x884C;&#x6587;&#x672C;&#x7BA1;&#x9053;&#x540E;&#x518D;&#x7528;&#x540E;&#x7EED;&#x547D;&#x4EE4;&#x5904;&#x7406;</a></li><li><span class="title-icon "></span><a href="#&#x5173;&#x7CFB;&#x6570;&#x7EC4;-sed-&#x548C;-awk"><b>27. </b>&#x5173;&#x7CFB;&#x6570;&#x7EC4; sed &#x548C; awk</a></li><ul><li><span class="title-icon "></span><a href="#&#x6539;&#x8FDB;&#x7248;-awk&#x591A;&#x7EF4;&#x6570;&#x7EC4;"><b>27.1. </b>&#x6539;&#x8FDB;&#x7248; awk&#x591A;&#x7EF4;&#x6570;&#x7EC4;</a></li><li><span class="title-icon "></span><a href="#&#x539F;&#x59CB;&#x7248;"><b>27.2. </b>&#x539F;&#x59CB;&#x7248;</a></li></ul><li><span class="title-icon "></span><a href="#shell&#x5173;&#x7CFB;&#x6570;&#x7EC4;----&#x6216;&#x8005;&#x8BF4;&#x662F;list"><b>28. </b>shell&#x5173;&#x7CFB;&#x6570;&#x7EC4; -- &#x6216;&#x8005;&#x8BF4;&#x662F;list</a></li><li><span class="title-icon "></span><a href="#shell&#x6570;&#x7EC4;"><b>29. </b>shell&#x6570;&#x7EC4;</a></li><li><span class="title-icon "></span><a href="#shell&#x811A;&#x672C;&#x89E3;&#x6790;&#x6587;&#x4EF6;-&#x8F93;&#x51FA;&#x53EF;&#x4EE5;&#x5BFC;&#x5165;&#x5230;excel&#x7684;&#x6587;&#x672C;"><b>30. </b>shell&#x811A;&#x672C;&#x89E3;&#x6790;&#x6587;&#x4EF6;, &#x8F93;&#x51FA;&#x53EF;&#x4EE5;&#x5BFC;&#x5165;&#x5230;excel&#x7684;&#x6587;&#x672C;</a></li><li><span class="title-icon "></span><a href="#shell&#x5904;&#x7406;&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;"><b>31. </b>shell&#x5904;&#x7406;&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;</a></li><li><span class="title-icon "></span><a href="#shell&#x4E5F;&#x53EF;&#x4EE5;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x51FD;&#x6570;"><b>32. </b>shell&#x4E5F;&#x53EF;&#x4EE5;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x51FD;&#x6570;</a></li><ul><li><span class="title-icon "></span><a href="#&#x6539;&#x8FDB;&#x7248;&#x672C;"><b>32.1. </b>&#x6539;&#x8FDB;&#x7248;&#x672C;</a></li></ul><li><span class="title-icon "></span><a href="#local-system-monitor"><b>33. </b>local system monitor</a></li><li><span class="title-icon "></span><a href="#system-monitor-for-pangu"><b>34. </b>system monitor for pangu</a></li><li><span class="title-icon "></span><a href="#&#x589E;&#x52A0;fedora&#x5206;&#x533A;&#x7684;&#x811A;&#x672C;"><b>35. </b>&#x589E;&#x52A0;fedora&#x5206;&#x533A;&#x7684;&#x811A;&#x672C;</a></li></ul></div><a href="#&#x7528;socat&#x8FDE;&#x63A5;pty" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><ul>
<li><a href="#&#x7528;socat&#x8FDE;&#x63A5;pty">&#x7528;socat&#x8FDE;&#x63A5;pty</a><ul>
<li><a href="#&#x4EC0;&#x4E48;&#x662F;tty-pty">&#x4EC0;&#x4E48;&#x662F;tty pty</a></li>
<li><a href="#&#x8BFB;&#x5199;pts">&#x8BFB;&#x5199;pts</a></li>
</ul>
</li>
<li><a href="#socat&#x6982;&#x89C8;">socat&#x6982;&#x89C8;</a><ul>
<li><a href="#&#x5E38;&#x7528;&#x9009;&#x9879;">&#x5E38;&#x7528;&#x9009;&#x9879;</a></li>
<li><a href="#&#x5730;&#x5740;&#x683C;&#x5F0F;">&#x5730;&#x5740;&#x683C;&#x5F0F;</a></li>
<li><a href="#&#x5730;&#x5740;&#x7C7B;&#x578B;">&#x5730;&#x5740;&#x7C7B;&#x578B;</a><ul>
<li><a href="#&#x9009;&#x9879;">&#x9009;&#x9879;</a><ul>
<li><a href="#fd&#x7EC4;">FD&#x7EC4;</a></li>
<li><a href="#named-option-group">NAMED option group</a></li>
<li><a href="#open-option-group">OPEN option group</a></li>
<li><a href="#reg-and-blk-option-group">REG and BLK option group</a></li>
<li><a href="#process-option-group">PROCESS option group</a></li>
<li><a href="#application-option-group">APPLICATION option group</a></li>
<li><a href="#socket-option-group">SOCKET option group</a></li>
<li><a href="#ip4-and-ip6-option-groups">IP4 and IP6 option groups</a></li>
<li><a href="#termios-option-group">TERMIOS option group</a></li>
<li><a href="#fork-option-group">FORK option group</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#&#x4F8B;&#x5B50;">&#x4F8B;&#x5B50;</a></li>
</ul>
</li>
<li><a href="#&#x811A;&#x672C;&#x547D;&#x4EE4;&#x884C;&#x89E3;&#x6790;&#x4E4B;declare--f">&#x811A;&#x672C;&#x547D;&#x4EE4;&#x884C;&#x89E3;&#x6790;&#x4E4B;declare -f</a></li>
<li><a href="#shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x548C;&#x5F15;&#x53F7;&#x4FDD;&#x7559;">shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x548C;&#x5F15;&#x53F7;&#x4FDD;&#x7559;</a><ul>
<li><a href="#&#x80CC;&#x666F;">&#x80CC;&#x666F;:</a></li>
<li><a href="#&#x7B80;&#x5355;wrapper">&#x7B80;&#x5355;wrapper</a></li>
<li><a href="#&#x53C2;&#x6570;&#x91CD;&#x8F7D;">&#x53C2;&#x6570;&#x91CD;&#x8F7D;</a></li>
<li><a href="#&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#x5BFC;&#x81F4;&#x5B57;&#x7B26;&#x4E32;&#x591A;&#x53D8;&#x4E00;">&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#x5BFC;&#x81F4;&#x5B57;&#x7B26;&#x4E32;&#x591A;&#x53D8;&#x4E00;</a></li>
<li><a href="#shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x65B9;&#x5F0F;">shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x65B9;&#x5F0F;</a></li>
<li><a href="#printf">printf</a></li>
<li><a href="#&#x6700;&#x7EC8;&#x7248;-&#x7528;eval">&#x6700;&#x7EC8;&#x7248;, &#x7528;eval</a></li>
<li><a href="#&#x8865;&#x5145;-shell&#x7684;&#x53D8;&#x91CF;&#x6269;&#x5C55;">&#x8865;&#x5145;: shell&#x7684;&#x53D8;&#x91CF;&#x6269;&#x5C55;</a></li>
</ul>
</li>
<li><a href="#curl&#x4F7F;&#x7528;&#x8BF4;&#x660E;&#x548C;&#x4E3E;&#x4F8B;">curl&#x4F7F;&#x7528;&#x8BF4;&#x660E;&#x548C;&#x4E3E;&#x4F8B;</a><ul>
<li><a href="#&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;1">&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;1</a></li>
<li><a href="#&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;2">&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;2</a></li>
<li><a href="#&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;3">&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;3</a></li>
<li><a href="#url&#x683C;&#x5F0F;">URL&#x683C;&#x5F0F;</a></li>
</ul>
</li>
<li><a href="#curl&#x548C;restful-gitlab-api&#x4E3E;&#x4F8B;">curl&#x548C;RESTful gitlab API&#x4E3E;&#x4F8B;</a><ul>
<li><a href="#&#x7B80;&#x4ECB;">&#x7B80;&#x4ECB;</a></li>
<li><a href="#&#x4E3E;&#x4F8B;">&#x4E3E;&#x4F8B;</a><ul>
<li><a href="#&#x521B;&#x5EFA;&#x65B0;project">&#x521B;&#x5EFA;&#x65B0;project</a></li>
<li><a href="#&#x83B7;&#x53D6;gitignore&#x6A21;&#x677F;">&#x83B7;&#x53D6;gitignore&#x6A21;&#x677F;</a></li>
<li><a href="#&#x5206;&#x652F;&#x7EF4;&#x62A4;">&#x5206;&#x652F;&#x7EF4;&#x62A4;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sed&#x89E3;&#x6790;log">sed&#x89E3;&#x6790;log</a></li>
<li><a href="#cpu&#x5229;&#x7528;&#x7387;&#x6761;&#x4EF6;&#x89E6;&#x53D1;perf-record">CPU&#x5229;&#x7528;&#x7387;&#x6761;&#x4EF6;&#x89E6;&#x53D1;perf record</a></li>
<li><a href="#top&#x7684;&#x8BB0;&#x5F55;&#x5BFC;&#x5165;&#x5230;excel">top&#x7684;&#x8BB0;&#x5F55;&#x5BFC;&#x5165;&#x5230;excel</a><ul>
<li><a href="#&#x6BD4;&#x8F83;&#x7C97;&#x7CD9;&#x7684;&#x7248;&#x672C;">&#x6BD4;&#x8F83;&#x7C97;&#x7CD9;&#x7684;&#x7248;&#x672C;</a><ul>
<li><a href="#cpu">CPU</a></li>
<li><a href="#mem">mem</a></li>
</ul>
</li>
<li><a href="#&#x540C;&#x65F6;&#x5BFC;&#x51FA;cpu&#x5229;&#x7528;&#x7387;&#x548C;mem">&#x540C;&#x65F6;&#x5BFC;&#x51FA;CPU&#x5229;&#x7528;&#x7387;&#x548C;mem</a></li>
<li><a href="#&#x53EA;&#x5BFC;&#x51FA;cpu&#x5229;&#x7528;&#x7387;">&#x53EA;&#x5BFC;&#x51FA;cpu&#x5229;&#x7528;&#x7387;</a><ul>
<li><a href="#&#x6539;&#x8FDB;&#x7248;">&#x6539;&#x8FDB;&#x7248;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#&#x7528;tr&#x5904;&#x7406;&#x591A;&#x4F59;&#x5B57;&#x7B26;">&#x7528;tr&#x5904;&#x7406;&#x591A;&#x4F59;&#x5B57;&#x7B26;</a></li>
<li><a href="#&#x4E00;&#x6B21;shell&#x91CD;&#x5B9A;&#x5411;&#x8FC7;&#x7A0B;">&#x4E00;&#x6B21;shell&#x91CD;&#x5B9A;&#x5411;&#x8FC7;&#x7A0B;</a><ul>
<li><a href="#shell&#x91CD;&#x5B9A;&#x5411;&#x548C;exec">shell&#x91CD;&#x5B9A;&#x5411;&#x548C;exec</a></li>
</ul>
</li>
<li><a href="#&#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;&#x53CA;&#x5176;&#x5F15;&#x7528;-eval&#x7684;&#x4F7F;&#x7528;">&#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;&#x53CA;&#x5176;&#x5F15;&#x7528;: eval&#x7684;&#x4F7F;&#x7528;</a><ul>
<li><a href="#&#x7528;eval&#x751F;&#x6210;&#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;">&#x7528;eval&#x751F;&#x6210;&#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;</a></li>
<li><a href="#&#x95F4;&#x63A5;&#x5F15;&#x7528;&#x53D8;&#x91CF;">&#x95F4;&#x63A5;&#x5F15;&#x7528;&#x53D8;&#x91CF;</a></li>
<li><a href="#&#x4E3E;&#x4F8B;-&#x8BFB;&#x51FA;conf&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5230;&#x52A8;&#x6001;&#x6587;&#x4EF6;&#x540D;&#x53D8;&#x91CF;">&#x4E3E;&#x4F8B;: &#x8BFB;&#x51FA;*.conf&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5230;&#x52A8;&#x6001;&#x6587;&#x4EF6;&#x540D;&#x53D8;&#x91CF;</a></li>
<li><a href="#uaes&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;-&#x5173;&#x7CFB;&#x6570;&#x7EC4;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;">uaes&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;, &#x5173;&#x7CFB;&#x6570;&#x7EC4;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;</a></li>
</ul>
</li>
<li><a href="#&#x5224;&#x65AD;&#x5B57;&#x4E32;&#x662F;&#x5426;&#x5305;&#x542B;&#x5B57;&#x4E32;">&#x5224;&#x65AD;&#x5B57;&#x4E32;&#x662F;&#x5426;&#x5305;&#x542B;&#x5B57;&#x4E32;</a></li>
<li><a href="#exec&#x91CD;&#x5B9A;&#x5411;">exec&#x91CD;&#x5B9A;&#x5411;</a><ul>
<li><a href="#&#x5728;shell&#x91CC;&#x76F4;&#x63A5;&#x91CD;&#x5B9A;&#x5411;stdin">&#x5728;shell&#x91CC;&#x76F4;&#x63A5;&#x91CD;&#x5B9A;&#x5411;stdin</a></li>
<li><a href="#&#x91CD;&#x5B9A;&#x5411;&#x6574;&#x4E2A;shell&#x7684;stdout">&#x91CD;&#x5B9A;&#x5411;&#x6574;&#x4E2A;shell&#x7684;stdout</a></li>
<li><a href="#&#x8F93;&#x5165;&#x548C;&#x8F93;&#x51FA;&#x7684;&#x4F8B;&#x5B50;">&#x8F93;&#x5165;&#x548C;&#x8F93;&#x51FA;&#x7684;&#x4F8B;&#x5B50;</a></li>
<li><a href="#crosstool-ng&#x7684;&#x4F8B;&#x5B50;">crosstool ng&#x7684;&#x4F8B;&#x5B50;</a></li>
<li><a href="#&#x8865;&#x5145;-test&#x53EF;&#x4EE5;&#x68C0;&#x6D4B;fd&#x662F;&#x5426;&#x662F;terminal">&#x8865;&#x5145;: test&#x53EF;&#x4EE5;&#x68C0;&#x6D4B;FD&#x662F;&#x5426;&#x662F;terminal</a></li>
</ul>
</li>
<li><a href="#shell&#x8BFB;&#x5199;socket">shell&#x8BFB;&#x5199;socket</a><ul>
<li><a href="#&#x66F4;&#x7B80;&#x5355;&#x7684;&#x5199;&#x6CD5;">&#x66F4;&#x7B80;&#x5355;&#x7684;&#x5199;&#x6CD5;</a></li>
<li><a href="#devtcp&#x662F;shell&#x5185;&#x5EFA;&#x7684;&#x8BBE;&#x5907;&#x8282;&#x70B9;">/dev/tcp&#x662F;shell&#x5185;&#x5EFA;&#x7684;&#x8BBE;&#x5907;&#x8282;&#x70B9;</a></li>
</ul>
</li>
<li><a href="#shell&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;">shell&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;</a><ul>
<li><a href="#&#x6709;&#x540D;&#x7BA1;&#x9053;&#x548C;nc">&#x6709;&#x540D;&#x7BA1;&#x9053;&#x548C;nc</a></li>
</ul>
</li>
<li><a href="#shell&#x68C0;&#x67E5;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;include&#x4E86;">shell&#x68C0;&#x67E5;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;include&#x4E86;</a></li>
<li><a href="#sed">sed</a><ul>
<li><a href="#&#x5411;sed&#x4F20;&#x9012;&#x53D8;&#x91CF;">&#x5411;sed&#x4F20;&#x9012;&#x53D8;&#x91CF;</a></li>
<li><a href="#sed&#x4F7F;&#x7528;&#x8BB0;&#x5F55;">sed&#x4F7F;&#x7528;&#x8BB0;&#x5F55;</a></li>
<li><a href="#sed&#x547D;&#x4EE4;">sed&#x547D;&#x4EE4;</a></li>
<li><a href="#sed&#x5339;&#x914D;2&#x884C;&#x4E4B;&#x95F4;&#x7684;&#x5185;&#x5BB9;">sed&#x5339;&#x914D;2&#x884C;&#x4E4B;&#x95F4;&#x7684;&#x5185;&#x5BB9;</a></li>
<li><a href="#&#x63D0;&#x53D6;&#x6587;&#x4EF6;&#x7279;&#x5B9A;&#x884C;">&#x63D0;&#x53D6;&#x6587;&#x4EF6;&#x7279;&#x5B9A;&#x884C;</a></li>
<li><a href="#sed&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;">sed&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;</a></li>
<li><a href="#sed&#x5B9A;&#x5740;&#x66FF;&#x6362;">sed&#x5B9A;&#x5740;&#x66FF;&#x6362;</a></li>
<li><a href="#sed&#x5220;&#x9664;">sed&#x5220;&#x9664;</a></li>
<li><a href="#sed&#x66FF;&#x6362;&#x5F15;&#x7528;">sed&#x66FF;&#x6362;&#x5F15;&#x7528;</a></li>
<li><a href="#sed&#x7684;&#x5206;&#x7EC4;&#x5339;&#x914D;-&#x7528;&#x5206;&#x7EC4;-&#x7528;1&#x5F15;&#x7528;">sed&#x7684;&#x5206;&#x7EC4;&#x5339;&#x914D;, &#x7528;()&#x5206;&#x7EC4;, &#x7528;\1&#x5F15;&#x7528;</a></li>
</ul>
</li>
<li><a href="#awk">awk</a><ul>
<li><a href="#shell&#x53D8;&#x91CF;&#x4F20;&#x7ED9;awk">shell&#x53D8;&#x91CF;&#x4F20;&#x7ED9;awk</a></li>
<li><a href="#&#x518D;&#x8BF4;patten">&#x518D;&#x8BF4;patten</a></li>
<li><a href="#awk&#x5728;if&#x91CC;&#x5339;&#x914D;">awk&#x5728;if&#x91CC;&#x5339;&#x914D;</a></li>
<li><a href="#awk&#x652F;&#x6301;&#x6D6E;&#x70B9;">awk&#x652F;&#x6301;&#x6D6E;&#x70B9;</a></li>
<li><a href="#awk&#x903B;&#x8F91;&#x4E0E;">awk&#x903B;&#x8F91;&#x4E0E;</a></li>
<li><a href="#awk&#x591A;&#x884C;&#x89E3;&#x6790;">awk&#x591A;&#x884C;&#x89E3;&#x6790;</a></li>
<li><a href="#awk&#x5206;&#x7EC4;&#x63D0;&#x53D6;">awk&#x5206;&#x7EC4;&#x63D0;&#x53D6;</a></li>
<li><a href="#awk&#x53D8;&#x91CF;">awk&#x53D8;&#x91CF;</a></li>
<li><a href="#awk&#x6570;&#x7EC4;">awk&#x6570;&#x7EC4;</a></li>
<li><a href="#awk&#x5B57;&#x7B26;&#x4E32;&#x66FF;&#x6362;">awk&#x5B57;&#x7B26;&#x4E32;&#x66FF;&#x6362;</a></li>
<li><a href="#awk&#x7684;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#x548C;&#x6570;&#x5B57;&#x8FD0;&#x7B97;">awk&#x7684;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#x548C;&#x6570;&#x5B57;&#x8FD0;&#x7B97;</a></li>
<li><a href="#awk&#x6267;&#x884C;&#x5176;&#x4ED6;&#x7A0B;&#x5E8F;">awk&#x6267;&#x884C;&#x5176;&#x4ED6;&#x7A0B;&#x5E8F;</a></li>
<li><a href="#awk&#x66FF;&#x6362;&#x547D;&#x4EE4;">awk&#x66FF;&#x6362;&#x547D;&#x4EE4;</a></li>
</ul>
</li>
<li><a href="#shell&#x7BA1;&#x9053;&#x548C;&#x5FAA;&#x73AF;">shell&#x7BA1;&#x9053;&#x548C;&#x5FAA;&#x73AF;</a></li>
<li><a href="#&#x770B;&#x4E00;&#x4E2A;interface&#x662F;&#x5426;&#x5B58;&#x5728;">&#x770B;&#x4E00;&#x4E2A;interface&#x662F;&#x5426;&#x5B58;&#x5728;</a><ul>
<li><a href="#&#x7528;procnetdev">&#x7528;/proc/net/dev</a></li>
<li><a href="#&#x7528;ifconfig-intf&#x8FD4;&#x56DE;&#x503C;">&#x7528;ifconfig intf&#x8FD4;&#x56DE;&#x503C;</a></li>
</ul>
</li>
<li><a href="#awk&#x8BA1;&#x7B97;&#x65F6;&#x95F4;&#x5DEE;">awk&#x8BA1;&#x7B97;&#x65F6;&#x95F4;&#x5DEE;</a></li>
<li><a href="#ping&#x5EF6;&#x8FDF;&#x5927;&#x4E8E;05ms&#x89E6;&#x53D1;&#x52A8;&#x4F5C;">ping&#x5EF6;&#x8FDF;&#x5927;&#x4E8E;0.5ms&#x89E6;&#x53D1;&#x52A8;&#x4F5C;</a></li>
<li><a href="#&#x8BA1;&#x7B97;cpu&#x63A9;&#x7801;-mask">&#x8BA1;&#x7B97;cpu&#x63A9;&#x7801;, mask</a></li>
<li><a href="#shell&#x7684;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;">shell&#x7684;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;</a></li>
<li><a href="#&#x7C98;&#x8D34;&#x591A;&#x884C;&#x6587;&#x672C;&#x7BA1;&#x9053;&#x540E;&#x518D;&#x7528;&#x540E;&#x7EED;&#x547D;&#x4EE4;&#x5904;&#x7406;">&#x7C98;&#x8D34;&#x591A;&#x884C;&#x6587;&#x672C;&#x7BA1;&#x9053;&#x540E;&#x518D;&#x7528;&#x540E;&#x7EED;&#x547D;&#x4EE4;&#x5904;&#x7406;</a></li>
<li><a href="#&#x5173;&#x7CFB;&#x6570;&#x7EC4;-sed-&#x548C;-awk">&#x5173;&#x7CFB;&#x6570;&#x7EC4; sed &#x548C; awk</a><ul>
<li><a href="#&#x6539;&#x8FDB;&#x7248;-awk&#x591A;&#x7EF4;&#x6570;&#x7EC4;">&#x6539;&#x8FDB;&#x7248; awk&#x591A;&#x7EF4;&#x6570;&#x7EC4;</a></li>
<li><a href="#&#x539F;&#x59CB;&#x7248;">&#x539F;&#x59CB;&#x7248;</a></li>
</ul>
</li>
<li><a href="#shell&#x5173;&#x7CFB;&#x6570;&#x7EC4;----&#x6216;&#x8005;&#x8BF4;&#x662F;list">shell&#x5173;&#x7CFB;&#x6570;&#x7EC4; -- &#x6216;&#x8005;&#x8BF4;&#x662F;list</a></li>
<li><a href="#shell&#x6570;&#x7EC4;">shell&#x6570;&#x7EC4;</a></li>
<li><a href="#shell&#x811A;&#x672C;&#x89E3;&#x6790;&#x6587;&#x4EF6;-&#x8F93;&#x51FA;&#x53EF;&#x4EE5;&#x5BFC;&#x5165;&#x5230;excel&#x7684;&#x6587;&#x672C;">shell&#x811A;&#x672C;&#x89E3;&#x6790;&#x6587;&#x4EF6;, &#x8F93;&#x51FA;&#x53EF;&#x4EE5;&#x5BFC;&#x5165;&#x5230;excel&#x7684;&#x6587;&#x672C;</a></li>
<li><a href="#shell&#x5904;&#x7406;&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;">shell&#x5904;&#x7406;&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;</a></li>
<li><a href="#shell&#x4E5F;&#x53EF;&#x4EE5;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x51FD;&#x6570;">shell&#x4E5F;&#x53EF;&#x4EE5;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x51FD;&#x6570;</a><ul>
<li><a href="#&#x6539;&#x8FDB;&#x7248;&#x672C;">&#x6539;&#x8FDB;&#x7248;&#x672C;</a></li>
</ul>
</li>
<li><a href="#local-system-monitor">local system monitor</a></li>
<li><a href="#system-monitor-for-pangu">system monitor for pangu</a></li>
<li><a href="#&#x589E;&#x52A0;fedora&#x5206;&#x533A;&#x7684;&#x811A;&#x672C;">&#x589E;&#x52A0;fedora&#x5206;&#x533A;&#x7684;&#x811A;&#x672C;</a></li>
</ul>
<h1 id="&#x7528;socat&#x8FDE;&#x63A5;pty"><a name="&#x7528;socat&#x8FDE;&#x63A5;pty" class="anchor-navigation-ex-anchor" href="#&#x7528;socat&#x8FDE;&#x63A5;pty"><i class="fa fa-link" aria-hidden="true"></i></a>1. &#x7528;socat&#x8FDE;&#x63A5;pty</h1>
<h2 id="&#x4EC0;&#x4E48;&#x662F;tty-pty"><a name="&#x4EC0;&#x4E48;&#x662F;tty-pty" class="anchor-navigation-ex-anchor" href="#&#x4EC0;&#x4E48;&#x662F;tty-pty"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. &#x4EC0;&#x4E48;&#x662F;tty pty</h2>
<p>linux&#x7EC8;&#x7AEF;(Terminals)&#x6709;&#x4E09;&#x79CD;:</p>
<ul>
<li>&#x4E32;&#x53E3;: &#x6BD4;&#x5982;ttyS0, ttyUSB0</li>
<li>pty: /dev/pts/xx</li>
<li>&#x5C4F;&#x5E55;&#x547D;&#x4EE4;&#x884C;&#x7EC8;&#x7AEF;: tty1, tty2...</li>
</ul>
<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F7F;&#x7528;pty, pty&#x662F;master slave&#x6A21;&#x5F0F;&#x7684;, master&#x7528;&#x4E8E;&#x521B;&#x5EFA;slave, &#x5411;slave&#x8BFB;&#x5199;&#x5185;&#x5BB9;; slave&#x5C31;&#x662F;&#x6A21;&#x62DF;&#x7684;&#x7EC8;&#x7AEF;</p>
<ul>
<li>master: <code>/dev/ptmx</code></li>
<li>slave: <code>/dev/pts/*</code></li>
</ul>
<h2 id="&#x8BFB;&#x5199;pts"><a name="&#x8BFB;&#x5199;pts" class="anchor-navigation-ex-anchor" href="#&#x8BFB;&#x5199;pts"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. &#x8BFB;&#x5199;pts</h2>
<p>&#x6BD4;&#x5982;cloud-hypervisor&#x4F7F;&#x7528;pty&#x6587;&#x4EF6;<code>/dev/pts/2</code>&#x505A;&#x4E3A;VM&#x7684;&#x63A7;&#x5236;&#x53F0;, <code>cat /dev/pts/2</code>&#x80FD;&#x591F;&#x5728;host&#x4E0A;&#x67E5;&#x770B;VM&#x7684;&#x8F93;&#x51FA;, <code>echo xxxx &gt; /dev/pts/2</code>&#x53EF;&#x4EE5;&#x5411;VM&#x8F93;&#x5165;. 
&#x4F46;&#x600E;&#x4E48;&#x540C;&#x65F6;&#x8F93;&#x5165;&#x8F93;&#x51FA;? &#x5C31;&#x50CF;&#x8FDB;&#x5165;VM&#x7684;&#x63A7;&#x5236;&#x53F0;&#x4E00;&#x6837;?
&#x5148;&#x7ED9;&#x51FA;&#x7ED3;&#x679C;, &#x7528;socat:</p>
<pre class="language-"><code class="lang-sh">socat -,rawer,escape<span class="token operator">=</span><span class="token number">29</span> /dev/pts/2
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x7684;&#x610F;&#x601D;&#x662F;, &#x5EFA;&#x7ACB;&#x4ECE;raw&#x6A21;&#x5F0F;&#x7684;<code>stdio</code>&#x5230;<code>/dev/pts/2</code>&#x7684;&#x53CC;&#x5411;stream&#x8FDE;&#x63A5;</p>
<ul>
<li><code>-</code>: &#x8868;&#x793A;stdin&#x548C;stdout</li>
<li>rawer&#x662F;raw&#x6A21;&#x5F0F;, &#x4E0D;echo; &#x5728;raw&#x6A21;&#x5F0F;&#x4E0B;, &#x6BD4;&#x5982;ctrl+c&#x4F1A;&#x53D1;&#x9001;&#x7ED9;VM, &#x4E0D;&#x518D;&#x7528;&#x6765;&#x9000;&#x51FA;socat</li>
<li><code>escape=29</code>: &#x4F7F;&#x7528;<code>ctrl+]</code>&#x6765;&#x9000;&#x51FA;socat</li>
<li><code>/dev/pts/2</code>: &#x662F;pty&#x6587;&#x4EF6;</li>
</ul>
<h1 id="socat&#x6982;&#x89C8;"><a name="socat&#x6982;&#x89C8;" class="anchor-navigation-ex-anchor" href="#socat&#x6982;&#x89C8;"><i class="fa fa-link" aria-hidden="true"></i></a>2. socat&#x6982;&#x89C8;</h1>
<p>socat&#x662F;&#x5F3A;&#x5927;&#x7684;&#x53CC;&#x5411;stream&#x5BF9;&#x63A5;&#x5DE5;&#x5177;, &#x57FA;&#x672C;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x5EFA;&#x7ACB;address1&#x5230;address2&#x7684;&#x53CC;&#x5411;byte stream&#x8FDE;&#x63A5;.
<code>socat [options] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>address1</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>address2</span><span class="token punctuation">&gt;</span></span></code></p>
<h2 id="&#x5E38;&#x7528;&#x9009;&#x9879;"><a name="&#x5E38;&#x7528;&#x9009;&#x9879;" class="anchor-navigation-ex-anchor" href="#&#x5E38;&#x7528;&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. &#x5E38;&#x7528;&#x9009;&#x9879;</h2>
<ul>
<li><code>-d -d</code>: &#x6253;&#x5370;verbose debug&#x4FE1;&#x606F;, &#x53EF;&#x591A;&#x4E2A;-d</li>
<li><code>-T<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeout</span><span class="token punctuation">&gt;</span></span></code>: &#x7A7A;&#x95F2;timeout&#x65F6;&#x95F4;&#x81EA;&#x52A8;&#x9000;&#x51FA;</li>
<li><code>-u</code>/<code>-U</code>: &#x5355;&#x5411;&#x6570;&#x636E;&#x4F20;&#x8F93;</li>
<li><code>-L</code>: lock&#x6587;&#x4EF6;</li>
</ul>
<h2 id="&#x5730;&#x5740;&#x683C;&#x5F0F;"><a name="&#x5730;&#x5740;&#x683C;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#&#x5730;&#x5740;&#x683C;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. &#x5730;&#x5740;&#x683C;&#x5F0F;</h2>
<p>socat&#x652F;&#x6301;&#x591A;&#x79CD;&#x5730;&#x5740;&#x7C7B;&#x578B;, &#x683C;&#x5F0F;&#x4E3A;<code>&#x5730;&#x5740;&#x7C7B;&#x578B;:&#x5730;&#x5740;,&#x9009;&#x9879;1,&#x9009;&#x9879;2</code>
&#x67D0;&#x4E9B;&#x5E38;&#x7528;&#x5730;&#x5740;&#x7C7B;&#x578B;&#x53EF;&#x4EE5;&#x7528;&#x7B80;&#x5316;&#x5199;&#x6CD5;:</p>
<ul>
<li><code>-</code>: stdio</li>
<li>TCP: TCP4</li>
<li>&#x6570;&#x5B57;: FD</li>
</ul>
<h2 id="&#x5730;&#x5740;&#x7C7B;&#x578B;"><a name="&#x5730;&#x5740;&#x7C7B;&#x578B;" class="anchor-navigation-ex-anchor" href="#&#x5730;&#x5740;&#x7C7B;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. &#x5730;&#x5740;&#x7C7B;&#x578B;</h2>
<ul>
<li><code>CREATE:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filename</span><span class="token punctuation">&gt;</span></span></code>
&#x521B;&#x5EFA;&#x6587;&#x4EF6;&#x5199;&#x5165;</li>
<li><code>EXEC:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>command-line</span><span class="token punctuation">&gt;</span></span></code>
&#x4F7F;&#x7528;command&#x505A;&#x4E3A;input/output</li>
<li><code>FD:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fdnum</span><span class="token punctuation">&gt;</span></span></code>
&#x4F7F;&#x7528;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;fd</li>
<li><code>GOPEN:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filename</span><span class="token punctuation">&gt;</span></span></code>
&#x6253;&#x5F00;&#x6587;&#x4EF6;&#x8BFB;&#x5199;. &#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x662F;unix socket, &#x4F1A;&#x81EA;&#x52A8;connect, connect&#x5931;&#x8D25;&#x5219;&#x5047;&#x5B9A;&#x7528;sendto. &#x53EF;&#x4EE5;&#x7701;&#x7565;GOPEN.</li>
<li><code>INTERFACE:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>interface</span><span class="token punctuation">&gt;</span></span></code>
&#x5E26;L2&#x7684;raw packet</li>
<li><code>IP-DATAGRAM:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>address</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>protocol</span><span class="token punctuation">&gt;</span></span></code>
<code>IP4-DATAGRAM:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>protocol</span><span class="token punctuation">&gt;</span></span></code>
<code>IP6-DATAGRAM:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>protocol</span><span class="token punctuation">&gt;</span></span></code>
<code>IP-RECVFROM:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>protocol</span><span class="token punctuation">&gt;</span></span></code>
<code>IP4-RECVFROM:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>protocol</span><span class="token punctuation">&gt;</span></span></code>
<code>IP6-RECVFROM:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>protocol</span><span class="token punctuation">&gt;</span></span></code>
<code>IP-RECV:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>protocol</span><span class="token punctuation">&gt;</span></span></code>
<code>IP-SENDTO:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>protocol</span><span class="token punctuation">&gt;</span></span></code>
<code>IP4-SENDTO:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>protocol</span><span class="token punctuation">&gt;</span></span></code>
<code>IP6-SENDTO:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>protocol</span><span class="token punctuation">&gt;</span></span></code>
raw/datagram socket</li>
<li><code>PIPE:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filename</span><span class="token punctuation">&gt;</span></span></code>
<code>PIPE</code>
&#x6709;&#x540D;&#x548C;&#x65E0;&#x540D;&#x7BA1;&#x9053;</li>
<li><code>PROXY:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>proxy</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hostname</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">&gt;</span></span></code>
proxy</li>
<li><code>PTY</code>
&#x521B;&#x5EFA;&#x65B0;&#x7684;pty slave</li>
<li><code>SCTP-CONNECT:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">&gt;</span></span></code>
SCTP&#x534F;&#x8BAE;</li>
<li><code>SOCKET-CONNECT:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>domain</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>protocol</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remote-address</span><span class="token punctuation">&gt;</span></span></code>
<code>SOCKET-DATAGRAM:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>domain</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>protocol</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remote-address</span><span class="token punctuation">&gt;</span></span></code>
<code>SOCKET-RECV:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>domain</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>protocol</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>local-address</span><span class="token punctuation">&gt;</span></span></code>
<code>SOCKS4:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>socks-server</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">&gt;</span></span></code>
socket</li>
<li><code>STDIN</code>
<code>STDIO</code>
<code>STDOUT</code></li>
<li><code>SYSTEM:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>shell-command</span><span class="token punctuation">&gt;</span></span></code>
&#x611F;&#x89C9;&#x548C;exec&#x5DEE;&#x4E0D;&#x591A;</li>
<li><code>TCP:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">&gt;</span></span></code>
<code>TCP-LISTEN:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">&gt;</span></span></code></li>
<li><code>TUN[:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if-addr</span><span class="token punctuation">&gt;</span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bits</span><span class="token punctuation">&gt;</span></span>]</code>
&#x65B0;&#x5EFA;tun&#x8BBE;&#x5907;&#x505A;&#x4E3A;&#x5199;&#x4FA7;</li>
<li><code>UDP:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span><span class="token punctuation">&gt;</span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">&gt;</span></span></code>
<code>UDP-LISTEN:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">&gt;</span></span></code>
udp&#x8FD8;&#x6709;listen?</li>
<li><code>UNIX-CONNECT:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filename</span><span class="token punctuation">&gt;</span></span></code>
<code>UNIX-LISTEN:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filename</span><span class="token punctuation">&gt;</span></span></code>
<code>UNIX-SENDTO:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filename</span><span class="token punctuation">&gt;</span></span></code>
<code>UNIX-RECVFROM:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filename</span><span class="token punctuation">&gt;</span></span></code>
<code>UNIX-RECV:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filename</span><span class="token punctuation">&gt;</span></span></code>
<code>UNIX-CLIENT:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filename</span><span class="token punctuation">&gt;</span></span></code>
<code>ABSTRACT-CONNECT:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span></code>
unix socket</li>
</ul>
<h3 id="&#x9009;&#x9879;"><a name="&#x9009;&#x9879;" class="anchor-navigation-ex-anchor" href="#&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.1. &#x9009;&#x9879;</h3>
<p>socat&#x652F;&#x6301;&#x5F88;&#x591A;&#x9009;&#x9879;, &#x6BD4;&#x5982;&#x4E0A;&#x9762;&#x4F8B;&#x5B50;&#x4E2D;&#x7684;<code>raw</code>
&#x4E0D;&#x540C;&#x7684;group&#x652F;&#x6301;&#x4E0D;&#x540C;&#x7684;option</p>
<h4 id="fd&#x7EC4;"><a name="fd&#x7EC4;" class="anchor-navigation-ex-anchor" href="#fd&#x7EC4;"><i class="fa fa-link" aria-hidden="true"></i></a>FD&#x7EC4;</h4>
<p>&#x8FD9;&#x4E2A;&#x7EC4;&#x91CC;&#x7684;option&#x652F;&#x6301;&#x5BF9;fd&#x914D;&#x7F6E;&#x67D0;&#x79CD;&#x53C2;&#x6570;.</p>
<pre class="language-"><code>cloexec
setlk
flock-ex
lock
user
mode
append
nonblock
null-eof
...
&#x5F88;&#x591A;
</code></pre><h4 id="named-option-group"><a name="named-option-group" class="anchor-navigation-ex-anchor" href="#named-option-group"><i class="fa fa-link" aria-hidden="true"></i></a>NAMED option group</h4>
<p>&#x4F5C;&#x7528;&#x4E8E;&#x6587;&#x4EF6;&#x540D;</p>
<pre class="language-"><code>umask
unlink-close
</code></pre><h4 id="open-option-group"><a name="open-option-group" class="anchor-navigation-ex-anchor" href="#open-option-group"><i class="fa fa-link" aria-hidden="true"></i></a>OPEN option group</h4>
<pre class="language-"><code>creat
noatime
rdonly
rsync
...
</code></pre><h4 id="reg-and-blk-option-group"><a name="reg-and-blk-option-group" class="anchor-navigation-ex-anchor" href="#reg-and-blk-option-group"><i class="fa fa-link" aria-hidden="true"></i></a>REG and BLK option group</h4>
<pre class="language-"><code>seek
...
</code></pre><h4 id="process-option-group"><a name="process-option-group" class="anchor-navigation-ex-anchor" href="#process-option-group"><i class="fa fa-link" aria-hidden="true"></i></a>PROCESS option group</h4>
<pre class="language-"><code>chroot
setgid
su
...
</code></pre><h4 id="application-option-group"><a name="application-option-group" class="anchor-navigation-ex-anchor" href="#application-option-group"><i class="fa fa-link" aria-hidden="true"></i></a>APPLICATION option group</h4>
<p>&#x4F5C;&#x7528;&#x4E8E;&#x6570;&#x636E;</p>
<pre class="language-"><code>cr     Converts the default line termination character NL (&#x2019;\n&#x2019;, 0x0a) to/from CR (&#x2019;\r&#x2019;, 0x0d) when writing/reading on this channel.
escape
</code></pre><h4 id="socket-option-group"><a name="socket-option-group" class="anchor-navigation-ex-anchor" href="#socket-option-group"><i class="fa fa-link" aria-hidden="true"></i></a>SOCKET option group</h4>
<pre class="language-"><code>bind=
broadcast
rcvbuf
sndbuf
</code></pre><h4 id="ip4-and-ip6-option-groups"><a name="ip4-and-ip6-option-groups" class="anchor-navigation-ex-anchor" href="#ip4-and-ip6-option-groups"><i class="fa fa-link" aria-hidden="true"></i></a>IP4 and IP6 option groups</h4>
<pre class="language-"><code>tos
ip-pktinfo
</code></pre><h4 id="termios-option-group"><a name="termios-option-group" class="anchor-navigation-ex-anchor" href="#termios-option-group"><i class="fa fa-link" aria-hidden="true"></i></a>TERMIOS option group</h4>
<pre class="language-"><code>b0 &#x6CE2;&#x7279;&#x7387;0, &#x5373;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;
b19200
echo=
rawer
ignbrk
brkint
... &#x5F88;&#x591A;&#x5173;&#x4E8E;&#x7279;&#x6B8A;&#x5B57;&#x7B26;&#x63A7;&#x5236;&#x7684;
</code></pre><h4 id="fork-option-group"><a name="fork-option-group" class="anchor-navigation-ex-anchor" href="#fork-option-group"><i class="fa fa-link" aria-hidden="true"></i></a>FORK option group</h4>
<pre class="language-"><code>pipes
sighup, sigint, sigquit
</code></pre><h2 id="&#x4F8B;&#x5B50;"><a name="&#x4F8B;&#x5B50;" class="anchor-navigation-ex-anchor" href="#&#x4F8B;&#x5B50;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4. &#x4F8B;&#x5B50;</h2>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x628A;stdio&#x8F6C;&#x5230;tcp</span>
socat - TCP4:www.domain.org:80
<span class="token comment">#&#x548C;&#x4E0A;&#x9762;&#x5DEE;&#x4E0D;&#x591A;, &#x4F46;&#x652F;&#x6301;line edit</span>
socat <span class="token parameter variable">-d</span> <span class="token parameter variable">-d</span> READLINE,history<span class="token operator">=</span><span class="token environment constant">$HOME</span>/.http_history TCP4:www.domain.org:www,crnl
<span class="token comment">#&#x8F6C;&#x53D1;listen, &#x4F46;&#x53EA;accept&#x4E00;&#x4E2A;connection</span>
socat TCP4-LISTEN:www TCP4:www.domain.org:www
<span class="token comment">#&#x52A0;&#x4E86;fork&#x5C31;&#x80FD;&#x5141;&#x8BB8;&#x591A;&#x4E2A;connection</span>
socat TCP4-LISTEN:5555,fork,tcpwrap<span class="token operator">=</span>script EXEC:/bin/myscript,chroot<span class="token operator">=</span>/home/sandbox,su-d<span class="token operator">=</span>sandbox,pty,stderr
<span class="token comment">#stdion&#x8F6C;&#x5230;ttyS0, &#x7528;control-O&#x9000;&#x51FA;socat</span>
socat -,escape<span class="token operator">=</span>0x0f /dev/ttyS0,rawer,crnl
</code></pre>
<h1 id="&#x811A;&#x672C;&#x547D;&#x4EE4;&#x884C;&#x89E3;&#x6790;&#x4E4B;declare--f"><a name="&#x811A;&#x672C;&#x547D;&#x4EE4;&#x884C;&#x89E3;&#x6790;&#x4E4B;declare--f" class="anchor-navigation-ex-anchor" href="#&#x811A;&#x672C;&#x547D;&#x4EE4;&#x884C;&#x89E3;&#x6790;&#x4E4B;declare--f"><i class="fa fa-link" aria-hidden="true"></i></a>3. &#x811A;&#x672C;&#x547D;&#x4EE4;&#x884C;&#x89E3;&#x6790;&#x4E4B;declare -f</h1>
<p>&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;, &#x811A;&#x672C;main&#x91CC;&#x9762;&#x89E3;&#x6790;&#x547D;&#x4EE4;&#x884C;, &#x53EA;&#x770B;&#x4E86;&#x901A;&#x7528;&#x7684;--help&#x7B49;, &#x800C;&#x5176;&#x4ED6;&#x7684;&#x547D;&#x4EE4;&#x90FD;&#x901A;&#x8FC7;<code>declare -f &quot;cmd_$1&quot;  &gt; /dev/null</code>&#x5148;&quot;&#x58F0;&#x660E;&quot;&#x51FD;&#x6570;, &#x518D;&#x8C03;&#x7528;:<code>$cmd &quot;$@&quot;</code></p>
<pre class="language-"><code class="lang-sh"><span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">then</span>
    die <span class="token string">&quot;No command provided. Please use \<span class="token variable"><span class="token variable">`</span>$0 help<span class="token punctuation">\</span><span class="token variable">`</span></span> for help.&quot;</span>
    <span class="token keyword">fi</span>

    <span class="token comment"># Parse main command line args.</span>
    <span class="token comment">#</span>
    <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">do</span>
        <span class="token keyword">case</span>  <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span>  <span class="token keyword">in</span>
            -h<span class="token operator">|</span>--help<span class="token punctuation">)</span>              <span class="token punctuation">{</span> cmd_help<span class="token punctuation">;</span>  <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
            -y<span class="token operator">|</span>--unattended<span class="token punctuation">)</span>        <span class="token punctuation">{</span> <span class="token assign-left variable">OPT_UNATTENDED</span><span class="token operator">=</span>true<span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
            -*<span class="token punctuation">)</span>
                die <span class="token string">&quot;Unknown arg: <span class="token variable">$1</span>. Please use \<span class="token variable"><span class="token variable">`</span>$0 help<span class="token punctuation">\</span><span class="token variable">`</span></span> for help.&quot;</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
            *<span class="token punctuation">)</span>
                <span class="token builtin class-name">break</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token keyword">esac</span>
        <span class="token builtin class-name">shift</span>
    <span class="token keyword">done</span>

    <span class="token comment"># $1 is now a command name. Check if it is a valid command and, if so,</span>
    <span class="token comment"># run it.</span>
    <span class="token comment">#</span>
    <span class="token builtin class-name">declare</span> <span class="token parameter variable">-f</span> <span class="token string">&quot;cmd_<span class="token variable">$1</span>&quot;</span>  <span class="token operator">&gt;</span> /dev/null
    ok_or_die <span class="token string">&quot;Unknown command: <span class="token variable">$1</span>. Please use \<span class="token variable"><span class="token variable">`</span>$0 help<span class="token punctuation">\</span><span class="token variable">`</span></span> for help.&quot;</span>

    <span class="token assign-left variable">cmd</span><span class="token operator">=</span>cmd_<span class="token variable">$1</span>
    <span class="token builtin class-name">shift</span>

    <span class="token comment"># $@ is now a list of command-specific args</span>
    <span class="token comment">#</span>
    <span class="token variable">$cmd</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
<span class="token punctuation">}</span>

main <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
</code></pre>
<p>&#x6BD4;&#x5982;&#x60F3;&#x5B9E;&#x73B0;<code>$0 build_rootfs</code>&#x547D;&#x4EE4;, &#x7528;&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x6CD5;, &#x53EA;&#x9700;&#x8981;&#x589E;&#x52A0;<code>cmd_build_rootfs()</code>&#x51FD;&#x6570;:
&#x4F46;&#x9700;&#x8981;&#x6BCF;&#x4E2A;&quot;&#x5B50;&#x547D;&#x4EE4;&quot;&#x51FD;&#x6570;&#x90FD;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x547D;&#x4EE4;&#x89E3;&#x6790;</p>
<pre class="language-"><code class="lang-sh"><span class="token comment"># `./devtool build_rootfs -s 500MB`</span>
<span class="token comment"># Build a rootfs of custom size.</span>
<span class="token comment">#</span>
<span class="token function-name function">cmd_build_rootfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># Default size for the resulting rootfs image is 300MB.</span>
    <span class="token assign-left variable">SIZE</span><span class="token operator">=</span><span class="token string">&quot;300MB&quot;</span>
    <span class="token assign-left variable">FROM_CTR</span><span class="token operator">=</span>ubuntu:18.04
    <span class="token assign-left variable">flavour</span><span class="token operator">=</span><span class="token string">&quot;bionic&quot;</span>

    <span class="token comment"># Parse the command line args.</span>
    <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">do</span>
        <span class="token keyword">case</span>  <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span>  <span class="token keyword">in</span>
            <span class="token string">&quot;-h&quot;</span><span class="token operator">|</span><span class="token string">&quot;--help&quot;</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span> cmd_help<span class="token punctuation">;</span>  <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
            <span class="token string">&quot;-s&quot;</span><span class="token operator">|</span><span class="token string">&quot;--size&quot;</span><span class="token punctuation">)</span>
                <span class="token builtin class-name">shift</span>
                <span class="token assign-left variable">SIZE</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$1</span>&quot;</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
            <span class="token string">&quot;-p&quot;</span><span class="token operator">|</span><span class="token string">&quot;--partuuid&quot;</span><span class="token punctuation">)</span>
                <span class="token builtin class-name">shift</span>
                <span class="token assign-left variable">PARTUUID</span><span class="token operator">=</span><span class="token number">1</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
            *<span class="token punctuation">)</span>
                die <span class="token string">&quot;Unknown argument: <span class="token variable">$1</span>. Please use --help for help.&quot;</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token keyword">esac</span>
        <span class="token builtin class-name">shift</span>
    <span class="token keyword">done</span>
    <span class="token punctuation">..</span>.
<span class="token punctuation">}</span>
</code></pre>
<h1 id="shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x548C;&#x5F15;&#x53F7;&#x4FDD;&#x7559;"><a name="shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x548C;&#x5F15;&#x53F7;&#x4FDD;&#x7559;" class="anchor-navigation-ex-anchor" href="#shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x548C;&#x5F15;&#x53F7;&#x4FDD;&#x7559;"><i class="fa fa-link" aria-hidden="true"></i></a>4. shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x548C;&#x5F15;&#x53F7;&#x4FDD;&#x7559;</h1>
<p><a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html" target="_blank">shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x8BED;&#x6CD5;</a></p>
<h2 id="&#x80CC;&#x666F;"><a name="&#x80CC;&#x666F;" class="anchor-navigation-ex-anchor" href="#&#x80CC;&#x666F;"><i class="fa fa-link" aria-hidden="true"></i></a>4.1. &#x80CC;&#x666F;:</h2>
<p>&#x8FD9;&#x91CC;&#x7684;&#x6D4B;&#x8BD5;&#x547D;&#x4EE4;&#x662F;:</p>
<pre class="language-"><code class="lang-sh">go list <span class="token parameter variable">-f</span> <span class="token string">&quot;{{context.GOARCH}} {{context.Compiler}}&quot;</span> -- unsafe

<span class="token comment">#&#x6B63;&#x5E38;&#x7684;&#x7ED3;&#x679C;&#x662F;</span>
amd64 gc
<span class="token comment">#&#x8BF4;&#x660E;go&#x547D;&#x4EE4;&#x80FD;&#x6B63;&#x786E;&#x7406;&#x89E3;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;</span>
</code></pre>
<p>&#x4F46;&#x6211;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x7528;&#x4E00;&#x4E2A;bash wrapper&#x5C01;&#x88C5;&#x539F;&#x59CB;&#x7684;go&#x547D;&#x4EE4;(&#x91CD;&#x547D;&#x540D;&#x4E3A;<code>_go</code>), &#x628A;&#x539F;&#x59CB;&#x53C2;&#x6570;&#x4FEE;&#x6539;&#x540E;&#x518D;&#x4F20;&#x5165;<code>_go</code></p>
<h2 id="&#x7B80;&#x5355;wrapper"><a name="&#x7B80;&#x5355;wrapper" class="anchor-navigation-ex-anchor" href="#&#x7B80;&#x5355;wrapper"><i class="fa fa-link" aria-hidden="true"></i></a>4.2. &#x7B80;&#x5355;wrapper</h2>
<p>&#x8FD9;&#x6837;&#x662F;&#x53EF;&#x4EE5;&#x7684;</p>
<pre class="language-"><code class="lang-sh"><span class="token shebang important">#!/bin/bash</span>

<span class="token builtin class-name">exec</span> _go <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
</code></pre>
<p>&#x8FD9;&#x91CC;</p>
<ul>
<li><code>&quot;$@&quot;</code>&#x4F1A;&#x628A;&#x6240;&#x6709;&#x7684;&#x53C2;&#x6570;&quot;&#x539F;&#x5C01;&#x4E0D;&#x52A8;&quot;&#x7684;&#x4F20;&#x5165;&#x5E95;&#x5C42;&#x547D;&#x4EE4;
&#x8865;&#x5145;&#x4E00;&#x4E0B;:</li>
<li><code>$#</code>&#x662F;&#x53C2;&#x6570;&#x4E2A;&#x6570;, &#x8FD9;&#x91CC;&#x4E3A;5, &#x7528;<code>for a in &quot;$@&quot;</code>&#x6765;&#x904D;&#x5386;&#x53C2;&#x6570;, &#x8FD9;5&#x4E2A;&#x53C2;&#x6570;&#x5206;&#x522B;&#x662F;<ul>
<li><code>list</code></li>
<li><code>-f</code></li>
<li><code>` : &#x8FD9;&#x91CC;&#x8BF4;&#x660E; for in&#x5BF9;&#x4F4D;&#x7F6E;&#x53C2;&#x6570;&#x7684;&#x904D;&#x5386;, &#x4E0D;&#x662F;&#x4EE5;&#x7A7A;&#x767D;&#x7B26;&#x4E3A;&#x5206;&#x9694;&#x7684;. &#x56E0;&#x4E3A;&#x8FD9;&#x91CC;&#x867D;&#x7136;&#x6709;&#x7A7A;&#x683C;, &#x4F46;&#x5B83;&#x4EEC;&#x4F1A;&#x505A;&#x4E3A;&#x4E00;&#x4E2A;&#x6574;&#x4F53;&#x88AB;&#x8D4B;&#x503C;&#x5230;&#x53D8;&#x91CF;</code>a`</li>
<li><code>--</code></li>
<li><code>unsafe</code></li>
</ul>
</li>
</ul>
<h2 id="&#x53C2;&#x6570;&#x91CD;&#x8F7D;"><a name="&#x53C2;&#x6570;&#x91CD;&#x8F7D;" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#x91CD;&#x8F7D;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3. &#x53C2;&#x6570;&#x91CD;&#x8F7D;</h2>
<p>&#x4F46;&#x6211;&#x7684;&#x9700;&#x6C42;&#x662F;&#x66F4;&#x6539;&#x53C2;&#x6570;, &#x6709;&#x5982;&#x4E0B;&#x5C1D;&#x8BD5;:</p>
<pre class="language-"><code class="lang-sh"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">cmd</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token builtin class-name">shift</span>
<span class="token builtin class-name">exec</span> _go <span class="token variable">$cmd</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x53EF;&#x4EE5;.</p>
<ul>
<li>&#x8BF4;&#x660E;<code>shift</code>&#x5BF9;&#x53C2;&#x6570;&#x79FB;&#x4F4D;&#x4E86;, &#x4F46;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;<code>&quot;$@&quot;</code>&#x5BF9;&#x539F;&#x59CB;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x64CD;&#x4F5C;</li>
</ul>
<h2 id="&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#x5BFC;&#x81F4;&#x5B57;&#x7B26;&#x4E32;&#x591A;&#x53D8;&#x4E00;"><a name="&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#x5BFC;&#x81F4;&#x5B57;&#x7B26;&#x4E32;&#x591A;&#x53D8;&#x4E00;" class="anchor-navigation-ex-anchor" href="#&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#x5BFC;&#x81F4;&#x5B57;&#x7B26;&#x4E32;&#x591A;&#x53D8;&#x4E00;"><i class="fa fa-link" aria-hidden="true"></i></a>4.4. &#x53D8;&#x91CF;&#x8D4B;&#x503C;&#x5BFC;&#x81F4;&#x5B57;&#x7B26;&#x4E32;&#x591A;&#x53D8;&#x4E00;</h2>
<p>&#x4F46;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E0D;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;:</p>
<pre class="language-"><code class="lang-sh"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">cmd</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token builtin class-name">shift</span>
<span class="token assign-left variable">args</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>

<span class="token builtin class-name">exec</span> _go <span class="token variable">$cmd</span> <span class="token string">&quot;<span class="token variable">$args</span>&quot;</span>
<span class="token comment">#&#x6216;&#x8005;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;</span>
<span class="token builtin class-name">exec</span> _go <span class="token variable">$cmd</span> <span class="token variable">$args</span>
</code></pre>
<p>&#x7684;&#x7ED3;&#x679C;&#x662F;<code>flag provided but not defined: -f {{context.GOARCH}} {{context.Compiler}} -- unsafe</code>
&#x7ECF;&#x8FC7;&#x68C0;&#x67E5;, &#x548C;&#x8FD9;&#x6837;&#x6267;&#x884C;&#x539F;&#x59CB;&#x547D;&#x4EE4;&#x662F;&#x4E00;&#x6837;&#x7684;:
<code>_go list &quot;-f {{context.GOARCH}} {{context.Compiler}} -- unsafe&quot;</code>
&#x8BF4;&#x660E;:</p>
<ul>
<li><code>args=&quot;$@&quot;</code>&#x7684;&#x7ED3;&#x679C;&#x662F;, <code>args</code>&#x628A;<code>-f   -- unsafe</code>&#x4F1A;&#x53D8;&#x6210;&#x4E00;&#x4E2A;&#x6574;&#x4F53;&#x7684;string</li>
</ul>
<h2 id="shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x65B9;&#x5F0F;"><a name="shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x65B9;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x65B9;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>4.5. shell&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x65B9;&#x5F0F;</h2>
<p>&#x4E0B;&#x9762;&#x7684;&#x90FD;&#x4E0D;&#x884C;</p>
<pre class="language-"><code class="lang-sh"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">cmd</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token builtin class-name">shift</span>

<span class="token builtin class-name">exec</span> _go <span class="token variable">$cmd</span> <span class="token variable">${*@Q}</span>
<span class="token comment">#&#x7ED3;&#x679C;</span>
can<span class="token string">&apos;t load package: package &apos;</span>-f<span class="token string">&apos;: malformed module path &quot;&apos;</span>-f<span class="token string">&apos;&quot;: invalid char &apos;</span><span class="token punctuation">\</span>&apos;<span class="token string">&apos;

exec _go $cmd &quot;${*@Q}&quot;
#&#x7ED3;&#x679C;
can&apos;</span>t load package: package <span class="token string">&apos;-f&apos;</span> <span class="token string">&apos;{{context.GOARCH}} {{context.Compiler}}&apos;</span> <span class="token string">&apos;--&apos;</span> <span class="token string">&apos;unsafe&apos;</span><span class="token builtin class-name">:</span> malformed module path <span class="token string">&quot;&apos;-f&apos; &apos;{{context.GOARCH}} {{context.Compiler}}&apos; &apos;--&apos; &apos;unsafe&apos;&quot;</span><span class="token builtin class-name">:</span> invalid char <span class="token string">&apos;\&apos;</span>&apos;
</code></pre>
<p>&#x8FD9;&#x91CC;&#x7528;&#x5230;&#x4E86;shell&#x7684;<a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html" target="_blank">&#x53D8;&#x91CF;&#x6269;&#x5C55;</a>:</p>
<pre class="language-"><code class="lang-sh"><span class="token variable">${parameter@operator}</span>
The expansion is either a transformation of the value of parameter or information about parameter itself, depending on the value of operator. Each operator is a single letter:
Q
    The expansion is a string that is the value of parameter quoted <span class="token keyword">in</span> a <span class="token function">format</span> that can be reused as input.

If parameter is &#x2018;@&#x2019; or &#x2018;*&#x2019;, the operation is applied to each positional parameter <span class="token keyword">in</span> turn, and the expansion is the resultant list. If parameter is an array variable subscripted with &#x2018;@&#x2019; or &#x2018;*&#x2019;, the operation is applied to each member of the array <span class="token keyword">in</span> turn, and the expansion is the resultant list.
</code></pre>
<p>&#x610F;&#x601D;&#x662F;&#x628A;<code>$*</code>&#x5F53;&#x4F5C;&#x4E00;&#x4E2A;list, &#x5BF9;&#x5176;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x6210;&#x5458;&#x505A;<code>Q</code>&#x64CD;&#x4F5C;. &#x4ECE;&#x7ED3;&#x679C;&#x6765;&#x770B;<code>Q</code>&#x64CD;&#x4F5C;&#x5B9E;&#x9645;&#x4E0A;&#x628A;&#x6210;&#x5458;&#x505A;&#x4E86;&#x8F6C;&#x4E49;-&#x5F15;&#x53F7;:<br>&#x6BD4;&#x5982;<code>-f</code>&#x53D8;&#x6210;&#x4E86;<code>\&apos;-f\&apos;</code>, <code>{{context.GOARCH}} {{context.Compiler}}</code>&#x53D8;&#x6210;&#x4E86;<code>\&apos;{{context.GOARCH}} {{context.Compiler}}\&apos;</code><br>&#x4F20;&#x9012;&#x7ED9;<code>_go</code>&#x547D;&#x4EE4;&#x65F6;, &#x8FD9;&#x4E9B;&#x8F6C;&#x4E49;&#x88AB;&#x5F53;&#x4F5C;&#x539F;&#x59CB;&#x8F93;&#x5165;, &#x4E0D;&#x80FD;&#x88AB;&#x6B63;&#x786E;&#x89E3;&#x6790;.<br><code>${*@Q}</code>&#x548C;<code>&quot;${*@Q}&quot;</code>&#x7684;&#x533A;&#x522B;&#x662F;, &#x540E;&#x8005;&#x88AB;&#x5F53;&#x4F5C;&#x4E00;&#x4E2A;&#x6574;&#x4F53;&#x7684;string&#x88AB;&#x4F20;&#x5165;.</p>
<h2 id="printf"><a name="printf" class="anchor-navigation-ex-anchor" href="#printf"><i class="fa fa-link" aria-hidden="true"></i></a>4.6. printf</h2>
<p>printf&#x4E5F;&#x652F;&#x6301;</p>
<pre class="language-"><code class="lang-sh">printf: <span class="token builtin class-name">printf</span> <span class="token punctuation">[</span>-v var<span class="token punctuation">]</span> <span class="token function">format</span> <span class="token punctuation">[</span>arguments<span class="token punctuation">]</span>
 %b        <span class="token function">expand</span> backslash escape sequences <span class="token keyword">in</span> the corresponding argument
 %q        quote the argument <span class="token keyword">in</span> a way that can be reused as shell input
The <span class="token function">format</span> is re-used as necessary to consume all of the arguments.
</code></pre>
<p>&#x6BD4;&#x5982;</p>
<pre class="language-"><code class="lang-sh"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">args</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${args@Q}</span>&quot;</span>
<span class="token comment">#&#x8F93;&#x51FA;</span>
<span class="token string">&apos;list -f {{context.GOARCH}} {{context.Compiler}} -- unsafe&apos;</span>

<span class="token builtin class-name">printf</span> <span class="token string">&quot;====%s<span class="token entity" title="\n">\n</span>&quot;</span> <span class="token variable">${args@Q}</span>
<span class="token comment">#&#x8F93;&#x51FA;</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token string">&apos;list
====-f
===={{context.GOARCH}}
===={{context.Compiler}}
====--
====unsafe&apos;</span>
</code></pre>
<p><code>${args@Q}</code>&#x4E2D;, <code>${args}</code>&#x88AB;&#x5F53;&#x4F5C;&#x4E00;&#x4E2A;&#x6574;&#x4F53;, &#x52A0;&#x4E0A;&#x4E86;&#x5F15;&#x53F7;. &#x8FD9;&#x4E2A;&#x6574;&#x4F53;&#x4F20;&#x5165;printf&#x7684;&#x65F6;&#x5019;, printf&#x6309;&#x7A7A;&#x767D;&#x7B26;&#x5206;&#x5272;, &#x88AB;&#x5F53;&#x4F5C;6&#x4E2A;argument, &#x5E76;&#x5206;&#x522B;&#x7528;<code>&quot;====%s\n&quot;</code>&#x6765;&#x683C;&#x5F0F;&#x5316;.</p>
<h2 id="&#x6700;&#x7EC8;&#x7248;-&#x7528;eval"><a name="&#x6700;&#x7EC8;&#x7248;-&#x7528;eval" class="anchor-navigation-ex-anchor" href="#&#x6700;&#x7EC8;&#x7248;-&#x7528;eval"><i class="fa fa-link" aria-hidden="true"></i></a>4.7. &#x6700;&#x7EC8;&#x7248;, &#x7528;eval</h2>
<pre class="language-"><code class="lang-sh"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">cmd</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token builtin class-name">shift</span>
<span class="token assign-left variable">args</span><span class="token operator">=</span><span class="token variable">${*@Q}</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$cmd</span> <span class="token variable">$args</span>

<span class="token builtin class-name">eval</span> <span class="token builtin class-name">exec</span> _go <span class="token variable">$cmd</span> <span class="token variable">$args</span>
<span class="token comment">#&#x4E0D;&#x7528;exec&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x7684;</span>
<span class="token builtin class-name">eval</span> _go <span class="token variable">$cmd</span> <span class="token variable">$args</span>
</code></pre>
<p>&#x89E3;&#x91CA;: &#x65E2;&#x7136;<code>${*@Q}</code>&#x80FD;&#x591F;&#x628A;&#x6BCF;&#x4E2A;&#x6210;&#x5458;&#x90FD;&#x52A0;&#x8F6C;&#x4E49;-&#x5F15;&#x53F7;, &#x90A3;&#x4E48;&#x7528;shell&#x7684;eval&#x547D;&#x4EE4;, &#x91CD;&#x65B0;&#x89E3;&#x6790;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;, &#x5C31;&#x80FD;&#x6B63;&#x5E38;&#x8FD0;&#x4F5C;&#x4E86;.</p>
<h2 id="&#x8865;&#x5145;-shell&#x7684;&#x53D8;&#x91CF;&#x6269;&#x5C55;"><a name="&#x8865;&#x5145;-shell&#x7684;&#x53D8;&#x91CF;&#x6269;&#x5C55;" class="anchor-navigation-ex-anchor" href="#&#x8865;&#x5145;-shell&#x7684;&#x53D8;&#x91CF;&#x6269;&#x5C55;"><i class="fa fa-link" aria-hidden="true"></i></a>4.8. &#x8865;&#x5145;: shell&#x7684;&#x53D8;&#x91CF;&#x6269;&#x5C55;</h2>
<p>&#x8FD8;&#x662F;<a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html" target="_blank">&#x8FD9;&#x4E2A;&#x94FE;&#x63A5;</a>
&#x53D8;&#x91CF;&#x6269;&#x5C55;&#x80FD;&#x591F;:</p>
<ul>
<li>&#x53D8;&#x91CF;&#x91CD;&#x5B9A;&#x5411;: <code>${!var}</code><blockquote>
<p>If the first character of parameter is an exclamation point (!), and parameter is not a nameref, it introduces a level of indirection. Bash uses the value formed by expanding the rest of parameter as the new parameter; this is then expanded and that value is used in the rest of the expansion, rather than the expansion of the original parameter. This is known as indirect expansion.</p>
</blockquote>
</li>
<li>&#x53D8;&#x91CF;&#x66FF;&#x6362;: <code>${parameter/pattern/string}</code> &#x6839;&#x636E;<a href="https://www.gnu.org/software/bash/manual/html_node/Pattern-Matching.html#Pattern-Matching" target="_blank">&#x5339;&#x914D;&#x89C4;&#x5219;</a>, &#x7528;<code>string</code>&#x66FF;&#x6362;&#x53D8;&#x91CF;<code>$parameter</code>&#x4E2D;&#x7684;<code>pattern</code>&#x4E32;.
&#x53EF;&#x4EE5;&#x5168;&#x90E8;&#x66FF;&#x6362;, &#x53EF;&#x4EE5;&#x53EA;&#x66FF;&#x6362;&#x7B2C;&#x4E00;&#x4E2A;
<code>parameter</code>&#x652F;&#x6301;list&#x6A21;&#x5F0F;, &#x6BD4;&#x5982;<code>array[@]</code></li>
<li>&#x5927;&#x5C0F;&#x5199;&#x8F6C;&#x6362;: <code>${parameter^pattern} ${parameter,pattern}</code> </li>
<li>&#x5339;&#x914D;&#x548C;&#x5220;&#x9664;: <code>${parameter#word} ${parameter##word} ${parameter%word} ${parameter%%word}</code> </li>
<li>&#x5B57;&#x7B26;&#x4E2A;&#x6570;: <code>${#parameter}</code> &#x5982;&#x679C;&#x662F;<code>array[@]</code>&#x7684;&#x5F62;&#x5F0F;, &#x8FD4;&#x56DE;&#x6210;&#x5458;&#x4E2A;&#x6570;</li>
<li>&#x53D8;&#x91CF;&#x9ED8;&#x8BA4;&#x503C;: <code>${parameter:-word} ${parameter:=word} ${parameter:?word} ${parameter:+word}</code></li>
<li><code>${!prefix*} ${!prefix@} ${!name[@]} ${!name[*]}</code> &#x6CA1;&#x770B;&#x61C2;&#x6709;&#x5565;&#x7528;<blockquote>
<p>Expands to the names of variables whose names begin with prefix, separated by the first character of the IFS special variable.</p>
</blockquote>
</li>
<li>&#x5B50;&#x4E32;&#x6269;&#x5C55;: <code>${parameter:offset} ${parameter:offset:length}</code>
&#x652F;&#x6301;&#x8D1F;&#x6570;</li>
</ul>
<pre class="language-"><code class="lang-sh">$ <span class="token assign-left variable">string</span><span class="token operator">=</span>01234567890abcdefgh
$ <span class="token builtin class-name">echo</span> <span class="token variable">${string<span class="token operator">:</span>7}</span>
7890abcdefgh
$ <span class="token builtin class-name">echo</span> <span class="token variable">${string<span class="token operator">:</span>7<span class="token operator">:</span>0}</span>

$ <span class="token builtin class-name">echo</span> <span class="token variable">${string<span class="token operator">:</span>7<span class="token operator">:</span>2}</span>
<span class="token number">78</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">${string<span class="token operator">:</span>7<span class="token operator">:-</span>2}</span>
7890abcdef
$ <span class="token builtin class-name">echo</span> <span class="token variable">${string<span class="token operator">:</span> -7}</span>
bcdefgh
$ <span class="token builtin class-name">echo</span> <span class="token variable">${string<span class="token operator">:</span> -7<span class="token operator">:</span>0}</span>

$ <span class="token builtin class-name">echo</span> <span class="token variable">${string<span class="token operator">:</span> -7<span class="token operator">:</span>2}</span>
<span class="token function">bc</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">${string<span class="token operator">:</span> -7<span class="token operator">:-</span>2}</span>
bcdef
$ <span class="token builtin class-name">set</span> -- 01234567890abcdefgh
$ <span class="token builtin class-name">echo</span> <span class="token variable">${1<span class="token operator">:</span>7}</span>
7890abcdefgh
$ <span class="token builtin class-name">echo</span> <span class="token variable">${1<span class="token operator">:</span>7<span class="token operator">:</span>0}</span>

$ <span class="token builtin class-name">echo</span> <span class="token variable">${1<span class="token operator">:</span>7<span class="token operator">:</span>2}</span>
<span class="token number">78</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">${1<span class="token operator">:</span>7<span class="token operator">:-</span>2}</span>
7890abcdef
$ <span class="token builtin class-name">echo</span> <span class="token variable">${1<span class="token operator">:</span> -7}</span>
bcdefgh
$ <span class="token builtin class-name">echo</span> <span class="token variable">${1<span class="token operator">:</span> -7<span class="token operator">:</span>0}</span>

$ <span class="token builtin class-name">echo</span> <span class="token variable">${1<span class="token operator">:</span> -7<span class="token operator">:</span>2}</span>
<span class="token function">bc</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">${1<span class="token operator">:</span> -7<span class="token operator">:-</span>2}</span>
bcdef
$ array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>01234567890abcdefgh
$ <span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token operator">:</span>7}</span>
7890abcdefgh
$ <span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token operator">:</span>7<span class="token operator">:</span>0}</span>

$ <span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token operator">:</span>7<span class="token operator">:</span>2}</span>
<span class="token number">78</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token operator">:</span>7<span class="token operator">:-</span>2}</span>
7890abcdef
$ <span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token operator">:</span> -7}</span>
bcdefgh
$ <span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token operator">:</span> -7<span class="token operator">:</span>0}</span>

$ <span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token operator">:</span> -7<span class="token operator">:</span>2}</span>
<span class="token function">bc</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token operator">:</span> -7<span class="token operator">:-</span>2}</span>
bcdef
</code></pre>
<p>&#x652F;&#x6301;list&#x6A21;&#x5F0F;(array&#x6A21;&#x5F0F;).</p>
<pre class="language-"><code class="lang-sh">$ <span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span> <span class="token number">8</span> <span class="token number">9</span> <span class="token number">0</span> a b c d e f g h<span class="token punctuation">)</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>@<span class="token punctuation">]</span><span class="token operator">:</span>7}</span>
<span class="token number">7</span> <span class="token number">8</span> <span class="token number">9</span> <span class="token number">0</span> a b c d e f g h
$ <span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>@<span class="token punctuation">]</span><span class="token operator">:</span>7<span class="token operator">:</span>2}</span>
<span class="token number">7</span> <span class="token number">8</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>@<span class="token punctuation">]</span><span class="token operator">:</span> -7<span class="token operator">:</span>2}</span>
b c
$ <span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>@<span class="token punctuation">]</span><span class="token operator">:</span> -7<span class="token operator">:-</span>2}</span>
bash: -2: substring expression <span class="token operator">&lt;</span> <span class="token number">0</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>@<span class="token punctuation">]</span><span class="token operator">:</span>0}</span>
<span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span> <span class="token number">8</span> <span class="token number">9</span> <span class="token number">0</span> a b c d e f g h
$ <span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>@<span class="token punctuation">]</span><span class="token operator">:</span>0<span class="token operator">:</span>2}</span>
<span class="token number">0</span> <span class="token number">1</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>@<span class="token punctuation">]</span><span class="token operator">:</span> -7<span class="token operator">:</span>0}</span>
</code></pre>
<h1 id="curl&#x4F7F;&#x7528;&#x8BF4;&#x660E;&#x548C;&#x4E3E;&#x4F8B;"><a name="curl&#x4F7F;&#x7528;&#x8BF4;&#x660E;&#x548C;&#x4E3E;&#x4F8B;" class="anchor-navigation-ex-anchor" href="#curl&#x4F7F;&#x7528;&#x8BF4;&#x660E;&#x548C;&#x4E3E;&#x4F8B;"><i class="fa fa-link" aria-hidden="true"></i></a>5. curl&#x4F7F;&#x7528;&#x8BF4;&#x660E;&#x548C;&#x4E3E;&#x4F8B;</h1>
<p>curl&#x4E0D;&#x4EC5;&#x53EF;&#x4EE5;&#x4F20;&#x8F93;http, &#x8FD8;&#x652F;&#x6301;&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x7684;&#x4F20;&#x8F93;&#x534F;&#x8BAE;:&#x6BD4;&#x5982;tftp telnet smbs imap &#x7B49;&#x7B49;&#x7B49;&#x7B49;
curl&#x6709;&#x975E;&#x5E38;&#x591A;&#x7684;&#x9009;&#x9879;</p>
<h2 id="&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;1"><a name="&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;1" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;1"><i class="fa fa-link" aria-hidden="true"></i></a>5.1. &#x4F7F;&#x7528;&#x4E3E;&#x4F8B;1</h2>
<pre class="language-"><code class="lang-sh"><span class="token comment"># https://www.jfrog.com/confluence/display/JFROG/Artifactory+REST+API#ArtifactoryRESTAPI-WorkingwithArtifactoryCloud</span>
<span class="token function">curl</span> <span class="token parameter variable">-X</span> PUT <span class="token variable">$ARTIFACTORY_URL</span>/<span class="token variable">$RELEASE_BASE</span>/<span class="token variable">$versiondir</span>/<span class="token variable">$subdir</span>/<span class="token variable">$arch</span>/<span class="token variable">$remote_package_name</span> <span class="token parameter variable">-T</span> <span class="token variable">$package</span>

<span class="token comment"># https://www.jfrog.com/confluence/display/JFROG/Artifactory+REST+API#ArtifactoryRESTAPI-FileInfo</span>
<span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-X</span> GET <span class="token variable">$ARTIFACTORY_URL</span>/api/storage/<span class="token variable">$RELEASE_BASE</span>/<span class="token variable">$versiondir</span>/<span class="token variable">$subdir</span>/<span class="token variable">$arch</span>

<span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-X</span> GET <span class="token variable">$ARTIFACTORY_URL</span>/api/storage/<span class="token variable">$RELEASE_BASE</span>/<span class="token variable">$versiondir</span>/<span class="token variable">$subdir</span>/<span class="token variable">$arch</span>/<span class="token variable">$package_name</span>
<span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-X</span> GET <span class="token variable">$ARTIFACTORY_URL</span>/<span class="token variable">$RELEASE_BASE</span>/<span class="token variable">$versiondir</span>/<span class="token variable">$subdir</span>/<span class="token variable">$arch</span>/<span class="token variable">$package_name</span> <span class="token parameter variable">-o</span> <span class="token variable">$local_package</span>
</code></pre>
<p>&#x8BF4;&#x660E;:</p>
<pre class="language-"><code class="lang-sh">       -X, <span class="token parameter variable">--request</span> <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span>
              <span class="token punctuation">(</span>HTTP<span class="token punctuation">)</span> Specifies a custom request method to use when communicating with the HTTP server.  The specified request method will be used instead of the method otherwise used
              <span class="token punctuation">(</span>which defaults to GET<span class="token punctuation">)</span>. Read the HTTP <span class="token number">1.1</span> specification <span class="token keyword">for</span> details and explanations. Common additional HTTP requests include PUT and DELETE, but related  technologies
              like WebDAV offers PROPFIND, COPY, MOVE and more.

              Normally you don<span class="token string">&apos;t need this option. All sorts of GET, HEAD, POST and PUT requests are rather invoked by using dedicated command line options.

              This  option  only  changes  the actual word used in the HTTP request, it does not alter the way curl behaves. So for example if you want to make a proper HEAD request,
              using -X HEAD will not suffice. You need to use the -I, --head option.

              The method string you set with -X, --request will be used for all requests, which if you for example use -L, --location may  cause  unintended  side-effects  when  curl
              doesn&apos;</span>t change request method according to the HTTP 30x response codes - and similar.


       -T, --upload-file <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span>
              This transfers the specified <span class="token builtin class-name">local</span> <span class="token function">file</span> to the remote URL. If there is no <span class="token function">file</span> part <span class="token keyword">in</span> the specified URL, <span class="token function">curl</span> will append the <span class="token builtin class-name">local</span> <span class="token function">file</span> name. NOTE that you must use a
              trailing  /  on  the  last directory to really prove to Curl that there is no <span class="token function">file</span> name or <span class="token function">curl</span> will think that your last directory name is the remote <span class="token function">file</span> name to use.
              That will <span class="token function">most</span> likely cause the upload operation to fail. If this is used on an HTTP<span class="token punctuation">(</span>S<span class="token punctuation">)</span> server, the PUT <span class="token builtin class-name">command</span> will be used.

              Use the <span class="token function">file</span> name <span class="token string">&quot;-&quot;</span> <span class="token punctuation">(</span>a single dash<span class="token punctuation">)</span> to use stdin instead of a given file.  Alternately, the <span class="token function">file</span> name <span class="token string">&quot;.&quot;</span> <span class="token punctuation">(</span>a single period<span class="token punctuation">)</span> may be specified instead  of  <span class="token string">&quot;-&quot;</span>  to  use
              stdin <span class="token keyword">in</span> non-blocking mode to allow reading server output <span class="token keyword">while</span> stdin is being uploaded.

              You  can  specify  one  -T,  --upload-file <span class="token keyword">for</span> each URL on the <span class="token builtin class-name">command</span> line. Each -T, --upload-file + URL pair specifies what to upload and to where. <span class="token function">curl</span> also supports
              <span class="token string">&quot;globbing&quot;</span> of the -T, --upload-file argument, meaning that you can upload multiple files to a single URL by using the same URL globbing style supported <span class="token keyword">in</span> the URL, like
              this:

               <span class="token function">curl</span> --upload-file <span class="token string">&quot;{file1,file2}&quot;</span> http://www.example.com

              or even

               <span class="token function">curl</span> <span class="token parameter variable">-T</span> <span class="token string">&quot;img[1-1000].png&quot;</span> ftp://ftp.example.com/upload/
</code></pre>
<h2 id="&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;2"><a name="&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;2" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;2"><i class="fa fa-link" aria-hidden="true"></i></a>5.2. &#x4F7F;&#x7528;&#x4E3E;&#x4F8B;2</h2>
<pre class="language-"><code class="lang-sh"><span class="token comment">#For example, the following cURL and build-info-permission.json define a new permission target called &#x201C;java-developers&#x201D;, for a build called &#x201C;test-maven&#x201D;:</span>
<span class="token function">curl</span> <span class="token parameter variable">-uadmin:password</span> <span class="token parameter variable">-XPUT</span> <span class="token string">&quot;http://localhost:8081/artifactory/api/v2/security/permissions/java-developers&quot;</span>  <span class="token parameter variable">-H</span> <span class="token string">&quot;Content-type: application/json&quot;</span>  <span class="token parameter variable">-T</span> build-info-permission.json
</code></pre>
<p>&#x8BF4;&#x660E;:</p>
<pre class="language-"><code class="lang-sh">       -u, <span class="token parameter variable">--user</span> <span class="token operator">&lt;</span>user:password<span class="token operator">&gt;</span>
              Specify the user name and password to use <span class="token keyword">for</span> server authentication. Overrides -n, <span class="token parameter variable">--netrc</span> and --netrc-optional.

              If you just give the user name <span class="token punctuation">(</span>without entering a colon<span class="token punctuation">)</span> <span class="token function">curl</span> will prompt <span class="token keyword">for</span> a password.

              If you use an SSPI-enabled <span class="token function">curl</span> binary and <span class="token keyword">do</span> NTLM authentication, you can force <span class="token function">curl</span> to pick up the user name and password from your environment by simply specifying a
              single colon with this option: <span class="token string">&quot;-u :&quot;</span><span class="token builtin class-name">.</span>

              If this option is used several times, the last one will be used.

       -H, <span class="token parameter variable">--header</span> <span class="token operator">&lt;</span>header<span class="token operator">&gt;</span>
              <span class="token punctuation">(</span>HTTP<span class="token punctuation">)</span>  Extra  header to use when getting a web page. You may specify any number of extra headers. Note that <span class="token keyword">if</span> you should <span class="token function">add</span> a custom header that has the same name as
              one of the internal ones <span class="token function">curl</span> would use, your externally <span class="token builtin class-name">set</span> header will be used instead of the internal one. This allows you to <span class="token function">make</span>  even  trickier  stuff  than  <span class="token function">curl</span>
              would  normally  do.  You  should not replace internally <span class="token builtin class-name">set</span> headers without knowing perfectly well what you&apos;re doing. Remove an internal header by giving a replacement
              without content on the right side of the colon, as in: <span class="token parameter variable">-H</span> <span class="token string">&quot;Host:&quot;</span><span class="token builtin class-name">.</span> If you send the custom header with no-value <span class="token keyword">then</span> its header must be terminated with a semicolon, such
              as <span class="token parameter variable">-H</span> <span class="token string">&quot;X-Custom-Header;&quot;</span> to send <span class="token string">&quot;X-Custom-Header:&quot;</span><span class="token builtin class-name">.</span>

              <span class="token function">curl</span>  will  <span class="token function">make</span>  sure that each header you add/replace is sent with the proper end-of-line marker, you should thus not <span class="token function">add</span> that as a part of the header content: <span class="token keyword">do</span> not
              <span class="token function">add</span> newlines or carriage returns, they will only mess things up <span class="token keyword">for</span> you.

              See also the -A, --user-agent and -e, <span class="token parameter variable">--referer</span> options.

              This option can be used multiple <span class="token builtin class-name">times</span> to add/replace/remove multiple headers.
</code></pre>
<h2 id="&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;3"><a name="&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;3" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;&#x4E3E;&#x4F8B;3"><i class="fa fa-link" aria-hidden="true"></i></a>5.3. &#x4F7F;&#x7528;&#x4E3E;&#x4F8B;3</h2>
<p>&#x4E0B;&#x8F7D;vscode server</p>
<pre class="language-"><code class="lang-sh"><span class="token function">curl</span> -<span class="token comment">#fL -o ~/.cache/code-server/code-server-3.6.0-linux-amd64.tar.gz.incomplete -C - https://github.com/cdr/code-server/releases/download/v3.6.0/code-server-3.6.0-linux-amd64.tar.gz</span>
</code></pre>
<ul>
<li><code>-#</code> &#x4F7F;&#x7528;&#x7B80;&#x5316;&#x7684;&#x8FDB;&#x5EA6;&#x6761;</li>
<li><code>-f</code> Fail silently (no output at all) on server  errors. &#x4E3B;&#x8981;&#x7684;&#x76EE;&#x7684;&#x662F;&#x7ED9;&#x8FDC;&#x7A0B;&#x6267;&#x884C;&#x811A;&#x672C;&#x7528;&#x7684;</li>
<li><code>-L</code> &#x4E4B;&#x524D;&#x9047;&#x5230;&#x8FC7;, follow redirection</li>
<li><code>-C -</code> &#x8FD9;&#x4E24;&#x4E2A;&#x8FDE;&#x8D77;&#x6765;&#x662F;&#x8BF4;curl&#x4F1A; continue/Resume a previous file transfer</li>
</ul>
<h2 id="url&#x683C;&#x5F0F;"><a name="url&#x683C;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#url&#x683C;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>5.4. URL&#x683C;&#x5F0F;</h2>
<p>curl&#x652F;&#x6301;&#x591A;&#x4E2A;url&#x5730;&#x5740;, &#x6BD4;&#x5982;</p>
<pre class="language-"><code class="lang-sh">http://site.<span class="token punctuation">{</span>one,two,three<span class="token punctuation">}</span>.com
ftp://ftp.example.com/file<span class="token punctuation">[</span><span class="token number">1</span>-100<span class="token punctuation">]</span>.txt
ftp://ftp.example.com/file<span class="token punctuation">[</span>a-z<span class="token punctuation">]</span>.txt

<span class="token comment">#&#x5728;&#x4E00;&#x4E2A;url&#x91CC;&#x9762;&#x5305;&#x542B;&#x591A;&#x4E2A;&#x53EF;&#x53D8;&#x90E8;&#x5206;</span>
http://example.com/archive<span class="token punctuation">[</span><span class="token number">1996</span>-1999<span class="token punctuation">]</span>/vol<span class="token punctuation">[</span><span class="token number">1</span>-4<span class="token punctuation">]</span>/part<span class="token punctuation">{</span>a,b,c<span class="token punctuation">}</span>.html

<span class="token comment">#&#x5E26;&#x6B65;&#x8FDB;&#x7684;</span>
http://example.com/file<span class="token punctuation">[</span><span class="token number">1</span>-100:10<span class="token punctuation">]</span>.txt
http://example.com/file<span class="token punctuation">[</span>a-z:2<span class="token punctuation">]</span>.txt
</code></pre>
<h1 id="curl&#x548C;restful-gitlab-api&#x4E3E;&#x4F8B;"><a name="curl&#x548C;restful-gitlab-api&#x4E3E;&#x4F8B;" class="anchor-navigation-ex-anchor" href="#curl&#x548C;restful-gitlab-api&#x4E3E;&#x4F8B;"><i class="fa fa-link" aria-hidden="true"></i></a>6. curl&#x548C;RESTful gitlab API&#x4E3E;&#x4F8B;</h1>
<h2 id="&#x7B80;&#x4ECB;"><a name="&#x7B80;&#x4ECB;" class="anchor-navigation-ex-anchor" href="#&#x7B80;&#x4ECB;"><i class="fa fa-link" aria-hidden="true"></i></a>6.1. &#x7B80;&#x4ECB;</h2>
<p>gitlab API&#x7684;&#x6839;&#x76EE;&#x5F55;&#x662F;<code>https://gitlab.example.com/api/v4</code>
&#x6BD4;&#x5982;</p>
<pre class="language-"><code class="lang-sh"><span class="token comment"># &#x83B7;&#x53D6;gitlabe1.ext.net.nokia.com&#x4E0B;&#x6240;&#x6709;&#x7684;projects, &#x8FD4;&#x56DE;&#x503C;&#x662F;json&#x683C;&#x5F0F;&#x7684;</span>
<span class="token function">curl</span> <span class="token string">&quot;https://gitlabe1.ext.net.nokia.com/api/v4/projects&quot;</span>
</code></pre>
<p>POST&#x662F;&#x65B0;&#x5EFA;, PUT&#x662F;&#x66F4;&#x65B0;: &#x4F7F;&#x7528;curl&#x7684;<code>-X, --request</code>&#x9009;&#x9879;&#x6307;&#x5B9A;. &#x9ED8;&#x8BA4;&#x662F;GET</p>
<table>
<thead>
<tr>
<th>Methods</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--header &quot;PRIVATE-TOKEN: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>your_access_token</span><span class="token punctuation">&gt;</span></span>&quot;</code></td>
<td>Use this method as is, whenever authentication needed</td>
</tr>
<tr>
<td><code>--request POST</code></td>
<td>Use this method when creating new objects</td>
</tr>
<tr>
<td><code>--request PUT</code></td>
<td>Use this method when updating existing objects</td>
</tr>
<tr>
<td><code>--request DELETE</code></td>
<td>Use this method when removing existing objects</td>
</tr>
</tbody>
</table>
<p>&#x6709;&#x4E9B;API&#x662F;&#x9700;&#x8981;&#x6743;&#x9650;&#x7684;, &#x6CA1;&#x6709;&#x6743;&#x9650;&#x53EF;&#x80FD;&#x8FD4;&#x56DE;public data&#x6216;&#x8005;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;.
&#x6709;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;&#x63D0;&#x4F9B;&#x6743;&#x9650;, &#x6BD4;&#x5982;</p>
<pre class="language-"><code class="lang-sh"><span class="token comment"># &#x5728;&#x53C2;&#x6570;&#x91CC;</span>
<span class="token function">curl</span> https://gitlab.example.com/api/v4/projects?private_token<span class="token operator">=</span><span class="token operator">&lt;</span>your_access_token<span class="token operator">&gt;</span>

<span class="token comment"># &#x5728;header&#x91CC;</span>
<span class="token function">curl</span> <span class="token parameter variable">--header</span>  <span class="token string">&quot;Private-Token: &lt;your_access_token&gt;&quot;</span> https://gitlab.example.com/api/v4/projects
</code></pre>
<p>&#x6BD4;&#x5982;&#x83B7;&#x53D6;group&#x4FE1;&#x606F;</p>
<pre class="language-"><code class="lang-sh"><span class="token function">curl</span> <span class="token parameter variable">--header</span>  <span class="token string">&quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot;</span>  <span class="token string">&quot;https://gitlab.example.com/api/v4/groups/gitlab-org&quot;</span>
</code></pre>
<h2 id="&#x4E3E;&#x4F8B;"><a name="&#x4E3E;&#x4F8B;" class="anchor-navigation-ex-anchor" href="#&#x4E3E;&#x4F8B;"><i class="fa fa-link" aria-hidden="true"></i></a>6.2. &#x4E3E;&#x4F8B;</h2>
<h3 id="&#x521B;&#x5EFA;&#x65B0;project"><a name="&#x521B;&#x5EFA;&#x65B0;project" class="anchor-navigation-ex-anchor" href="#&#x521B;&#x5EFA;&#x65B0;project"><i class="fa fa-link" aria-hidden="true"></i></a>6.2.1. &#x521B;&#x5EFA;&#x65B0;project</h3>
<p>&#x4F7F;&#x7528;POST</p>
<pre class="language-"><code class="lang-sh"><span class="token function">curl</span> <span class="token parameter variable">--request</span> POST <span class="token parameter variable">--header</span>  <span class="token string">&quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot;</span>  <span class="token string">&quot;https://gitlab.example.com/api/v4/projects?name=foo&quot;</span>
</code></pre>
<p>&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;curl&#x7684;--data</p>
<pre class="language-"><code class="lang-sh"><span class="token function">curl</span> <span class="token parameter variable">--data</span>  <span class="token string">&quot;name=foo&quot;</span>  <span class="token parameter variable">--header</span>  <span class="token string">&quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot;</span>  <span class="token string">&quot;https://gitlab.example.com/api/v4/projects&quot;</span>
</code></pre>
<p>&#x518D;&#x4E3E;&#x4E2A;&#x521B;&#x5EFA;&#x65B0;group&#x7684;&#x4F8B;&#x5B50;: &#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4F7F;&#x7528;json&#x683C;&#x5F0F;&#x7684;&#x6570;&#x636E;&#x505A;&#x4E3A;&#x8F93;&#x5165;</p>
<pre class="language-"><code class="lang-sh"><span class="token function">curl</span> <span class="token parameter variable">--request</span> POST <span class="token parameter variable">--header</span>  <span class="token string">&quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot;</span>  <span class="token parameter variable">--header</span>  <span class="token string">&quot;Content-Type: application/json&quot;</span>  <span class="token parameter variable">--data</span>  <span class="token string">&apos;{&quot;path&quot;: &quot;my-group&quot;, &quot;name&quot;: &quot;My group&quot;}&apos;</span>  <span class="token string">&quot;https://gitlab.example.com/api/v4/groups&quot;</span>
</code></pre>
<h3 id="&#x83B7;&#x53D6;gitignore&#x6A21;&#x677F;"><a name="&#x83B7;&#x53D6;gitignore&#x6A21;&#x677F;" class="anchor-navigation-ex-anchor" href="#&#x83B7;&#x53D6;gitignore&#x6A21;&#x677F;"><i class="fa fa-link" aria-hidden="true"></i></a>6.2.2. &#x83B7;&#x53D6;gitignore&#x6A21;&#x677F;</h3>
<p>&#x5BF9;&#x6BCF;&#x4E2A;&#x8BED;&#x8A00;, gitlab&#x90FD;&#x6709;gitignore&#x6A21;&#x677F;, &#x5BF9;&#x5E94;<code>GET /templates/gitignores</code>&#x8BF7;&#x6C42;</p>
<pre class="language-"><code class="lang-sh"><span class="token comment"># &#x83B7;&#x53D6;&#x6240;&#x6709;&#x6A21;&#x677F;, &#x8FD4;&#x56DE;json&#x683C;&#x5F0F;&#x7684;&#x5217;&#x8868;</span>
<span class="token function">curl</span> https://gitlab.example.com/api/v4/templates/gitignores
<span class="token comment"># &#x5B9E;&#x4F8B;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</span>
<span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Autotools&quot;</span>,
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Autotools&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token punctuation">{</span>
    <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;C&quot;</span>,
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;C&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token punctuation">{</span>
    <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;C++&quot;</span>,
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;C++&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token punctuation">{</span>
    <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CFWheels&quot;</span>,
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CFWheels&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token punctuation">{</span>
    <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CMake&quot;</span>,
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CMake&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token punctuation">{</span>
    <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CUDA&quot;</span>,
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CUDA&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre>
<p>&#x6BD4;&#x5982;&#x770B;Ruby&#x7684;gitignore&#x6A21;&#x677F;, &#x9700;&#x8981;&#x7528;&#x8FD9;&#x6837;&#x7684;&#x8BED;&#x6CD5;:<code>GET /templates/gitignores/:key</code></p>
<pre class="language-"><code class="lang-sh"><span class="token function">curl</span> https://gitlab.example.com/api/v4/templates/gitignores/Ruby
<span class="token comment">#&#x7ED3;&#x679C;</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Ruby&quot;</span>,
  <span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;*.gem<span class="token entity" title="\n">\n</span>*.rbc<span class="token entity" title="\n">\n</span>/.config<span class="token entity" title="\n">\n</span>/coverage/<span class="token entity" title="\n">\n</span>/InstalledFiles<span class="token entity" title="\n">\n</span>/pkg/<span class="token entity" title="\n">\n</span>/spec/reports/<span class="token entity" title="\n">\n</span>/spec/examples.txt<span class="token entity" title="\n">\n</span>/test/tmp/<span class="token entity" title="\n">\n</span>/test/version_tmp/<span class="token entity" title="\n">\n</span>/tmp/<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span># Used by dotenv library to load environment variables.<span class="token entity" title="\n">\n</span># .env<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>## Specific to RubyMotion:<span class="token entity" title="\n">\n</span>.dat*<span class="token entity" title="\n">\n</span>.repl_history<span class="token entity" title="\n">\n</span>build/<span class="token entity" title="\n">\n</span>*.bridgesupport<span class="token entity" title="\n">\n</span>build-iPhoneOS/<span class="token entity" title="\n">\n</span>build-iPhoneSimulator/<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>## Specific to RubyMotion (use of CocoaPods):<span class="token entity" title="\n">\n</span>#<span class="token entity" title="\n">\n</span># We recommend against adding the Pods directory to your .gitignore. However<span class="token entity" title="\n">\n</span># you should judge for yourself, the pros and cons are mentioned at:<span class="token entity" title="\n">\n</span># https://guides.cocoapods.org/using/using-cocoapods.html#should-i-check-the-pods-directory-into-source-control<span class="token entity" title="\n">\n</span>#<span class="token entity" title="\n">\n</span># vendor/Pods/<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>## Documentation cache and generated files:<span class="token entity" title="\n">\n</span>/.yardoc/<span class="token entity" title="\n">\n</span>/_yardoc/<span class="token entity" title="\n">\n</span>/doc/<span class="token entity" title="\n">\n</span>/rdoc/<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>## Environment normalization:<span class="token entity" title="\n">\n</span>/.bundle/<span class="token entity" title="\n">\n</span>/vendor/bundle<span class="token entity" title="\n">\n</span>/lib/bundler/man/<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span># for a library or gem, you might want to ignore these files since the code is<span class="token entity" title="\n">\n</span># intended to run in multiple environments; otherwise, check them in:<span class="token entity" title="\n">\n</span># Gemfile.lock<span class="token entity" title="\n">\n</span># .ruby-version<span class="token entity" title="\n">\n</span># .ruby-gemset<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span># unless supporting rvm &lt; 1.11.0 or doing something fancy, ignore this:<span class="token entity" title="\n">\n</span>.rvmrc<span class="token entity" title="\n">\n</span>&quot;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x5206;&#x652F;&#x7EF4;&#x62A4;"><a name="&#x5206;&#x652F;&#x7EF4;&#x62A4;" class="anchor-navigation-ex-anchor" href="#&#x5206;&#x652F;&#x7EF4;&#x62A4;"><i class="fa fa-link" aria-hidden="true"></i></a>6.2.3. &#x5206;&#x652F;&#x7EF4;&#x62A4;</h3>
<p>&#x83B7;&#x53D6;&#x5206;&#x652F;&#x683C;&#x5F0F;
<code>GET /projects/:id/repository/branches</code>
&#x6216;&#x8005;
<code>GET /projects/:id/repository/branches/:branch</code>
&#x6BD4;&#x5982;:</p>
<pre class="language-"><code class="lang-sh"><span class="token function">curl</span> https://gitlabe1.ext.net.nokia.com/api/v4/projects/57103/repository/branches
<span class="token function">curl</span> https://gitlabe1.ext.net.nokia.com/api/v4/projects/57103/repository/branches/master
</code></pre>
<p>&#x521B;&#x5EFA;&#x5206;&#x652F;&#x683C;&#x5F0F;
<code>POST /projects/:id/repository/branches</code>
&#x9700;&#x8981;&#x4E0B;&#x9762;&#x7684;&#x53C2;&#x6570;:</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>yes</td>
<td>ID or <a href="https://docs.gitlab.com/12.10/ee/api/README.html#namespaced-path-encoding" target="_blank">URL-encoded path of the project</a> owned by the authenticated user.</td>
</tr>
<tr>
<td><code>branch</code></td>
<td>string</td>
<td>yes</td>
<td>Name of the branch.</td>
</tr>
<tr>
<td><code>ref</code></td>
<td>string</td>
<td>yes</td>
<td>Branch name or commit SHA to create branch from.</td>
</tr>
</tbody>
</table>
<p>&#x4E3E;&#x4F8B;:</p>
<pre class="language-"><code class="lang-sh"><span class="token function">curl</span> <span class="token parameter variable">--request</span> POST <span class="token parameter variable">--header</span>  <span class="token string">&quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot;</span> https://gitlab.example.com/api/v4/projects/5/repository/branches?branch<span class="token operator">=</span>newbranch<span class="token operator">&amp;</span><span class="token assign-left variable">ref</span><span class="token operator">=</span>master

<span class="token comment"># &#x8FD4;&#x56DE;</span>
<span class="token punctuation">{</span>  <span class="token string">&quot;commit&quot;</span><span class="token builtin class-name">:</span>  <span class="token punctuation">{</span>  <span class="token string">&quot;author_email&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;john@example.com&quot;</span>,  <span class="token string">&quot;author_name&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;John Smith&quot;</span>,  <span class="token string">&quot;authored_date&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;2012-06-27T05:51:39-07:00&quot;</span>,  <span class="token string">&quot;committed_date&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;2012-06-28T03:44:20-07:00&quot;</span>,  <span class="token string">&quot;committer_email&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;john@example.com&quot;</span>,  <span class="token string">&quot;committer_name&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;John Smith&quot;</span>,  <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;7b5c3cc8be40ee161ae89a06bba6229da1032a0c&quot;</span>,  <span class="token string">&quot;short_id&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;7b5c3cc&quot;</span>,  <span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;add projects API&quot;</span>,  <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;add projects API&quot;</span>,  <span class="token string">&quot;parent_ids&quot;</span><span class="token builtin class-name">:</span>  <span class="token punctuation">[</span>  <span class="token string">&quot;4ad91d3c1144c406e50c7b33bae684bd6837faf8&quot;</span>  <span class="token punctuation">]</span>  <span class="token punctuation">}</span>,  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;newbranch&quot;</span>,  <span class="token string">&quot;merged&quot;</span><span class="token builtin class-name">:</span>  false,  <span class="token string">&quot;protected&quot;</span><span class="token builtin class-name">:</span>  false,  <span class="token string">&quot;default&quot;</span><span class="token builtin class-name">:</span>  false,  <span class="token string">&quot;developers_can_push&quot;</span><span class="token builtin class-name">:</span>  false,  <span class="token string">&quot;developers_can_merge&quot;</span><span class="token builtin class-name">:</span>  false,  <span class="token string">&quot;can_push&quot;</span><span class="token builtin class-name">:</span>  <span class="token boolean">true</span>  <span class="token punctuation">}</span>
</code></pre>
<p>&#x5220;&#x9664;&#x5206;&#x652F;:<code>DELETE /projects/:id/repository/branches/:branch</code>
&#x4E3E;&#x4F8B;:</p>
<pre class="language-"><code class="lang-sh"><span class="token function">curl</span> <span class="token parameter variable">--request</span> DELETE <span class="token parameter variable">--header</span>  <span class="token string">&quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot;</span> https://gitlab.example.com/api/v4/projects/5/repository/branches/newbranch
</code></pre>
<h1 id="sed&#x89E3;&#x6790;log"><a name="sed&#x89E3;&#x6790;log" class="anchor-navigation-ex-anchor" href="#sed&#x89E3;&#x6790;log"><i class="fa fa-link" aria-hidden="true"></i></a>7. sed&#x89E3;&#x6790;log</h1>
<p>&#x8981;&#x5728;&#x4E00;&#x4E2A;&#x5F88;&#x5927;&#x7684;log&#x91CC;&#x9762;&#x63D0;&#x53D6;OMCI&#x7684;&#x6D88;&#x606F;:
&#x683C;&#x5F0F;1</p>
<pre class="language-"><code class="lang-sh"><span class="token punctuation">[</span>trace<span class="token punctuation">]</span> 08:36:48.888471 Dir: Tx --<span class="token operator">&gt;</span> Onu: ont1-fwlt-b Retry: <span class="token number">0</span> 
00000000  1c ee <span class="token number">49</span> 0a 00 02 00 00  <span class="token number">80</span> 00 00 00 00 00 00 00  <span class="token operator">|</span><span class="token punctuation">..</span>I<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.<span class="token operator">|</span>
00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">|</span>
00000020  00 00 00 00 00 00 00 00  00 00 00 <span class="token number">28</span>              <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.<span class="token punctuation">(</span><span class="token operator">|</span>
</code></pre>
<p>&#x683C;&#x5F0F;2</p>
<pre class="language-"><code class="lang-sh"><span class="token punctuation">[</span><span class="token number">2018</span>/04/28 07:54:20.393226<span class="token punctuation">]</span><span class="token punctuation">[</span>omci<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>Dir: Rx <span class="token operator">&lt;</span>-- Onu: ont1-fwlt-b 
00000000  1c ee <span class="token number">29</span> 0a 00 02 00 00  00 <span class="token number">80</span> 00 3d 00 00 00 00  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">=</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">|</span>
00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">|</span>
00000020  00 00 00 00 00 00 00 00  00 00 00 <span class="token number">28</span> <span class="token number">62</span> <span class="token number">68</span> 9f 0c  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.<span class="token punctuation">(</span>bh<span class="token punctuation">..</span><span class="token operator">|</span>
</code></pre>
<p>&#x683C;&#x5F0F;1&#x548C;&#x683C;&#x5F0F;2&#x5C31;&#x662F;&#x6253;&#x5370;&#x7684;header&#x4E0D;&#x4E00;&#x6837;</p>
<p>&#x7528;&#x4E0B;&#x9762;&#x7684;sed&#x547D;&#x4EE4;&#x63D0;&#x53D6;</p>
<pre class="language-"><code class="lang-sh"><span class="token function">sed</span> <span class="token parameter variable">-rn</span> <span class="token parameter variable">-e</span> <span class="token string">&apos;/.*Dir: .*--.*/,+4{s/.* (..:..:..\.......).*(Dir.*)/\1 \2/g;p}&apos;</span> stdout_824128194_ok.log
</code></pre>
<p>&#x5176;&#x4E2D;</p>
<pre class="language-"><code class="lang-sh"><span class="token parameter variable">-r</span> &#x4F7F;&#x7528;&#x6269;&#x5C55;&#x6B63;&#x5219;
<span class="token parameter variable">-n</span> &#x4E0D;&#x81EA;&#x52A8;&#x6253;&#x5370;pattern&#x7A7A;&#x95F4;. &#x4E0D;&#x52A0;-n&#x4F1A;&#x6253;&#x5370;&#x6240;&#x6709;&#x539F;&#x59CB;&#x884C;&#x548C;&#x4FEE;&#x6539;&#x884C;
<span class="token parameter variable">-e</span> &#x540E;&#x9762;&#x8DDF;&#x5B9A;&#x5740; /.*Dir: .*--.*/,+4 &#x610F;&#x601D;&#x662F;&#x6240;&#x6709;&#x5339;&#x914D;&#x5230;Dir: Tx --<span class="token operator">&gt;</span> Onu&#x548C;Dir: Rx <span class="token operator">&lt;</span>-- Onu&#x7684;&#x884C;,&#x4EE5;&#x53CA;&#x63A5;&#x4E0B;&#x6765;&#x7684;4&#x884C;
&#x5B9A;&#x5740;&#x540E;&#x9762;&#x662F;&#x547D;&#x4EE4;, &#x7528;<span class="token punctuation">{</span><span class="token punctuation">}</span>&#x62EC;&#x8D77;&#x6765;, &#x4E0D;&#x7528;&#x5E94;&#x8BE5;&#x4E5F;&#x884C;
s/.* <span class="token punctuation">(</span><span class="token punctuation">..</span>:<span class="token punctuation">..</span>:<span class="token punctuation">..</span><span class="token punctuation">\</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>.*<span class="token punctuation">(</span>Dir.*<span class="token punctuation">)</span>/<span class="token punctuation">\</span><span class="token number">1</span> <span class="token punctuation">\</span><span class="token number">2</span>/g&#x662F;&#x7B2C;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;: &#x53BB;&#x6389;&#x9664;&#x4E86;&#x65F6;&#x95F4;&#x6233;&#x548C;OMCI Dir&#x63D0;&#x793A;&#x5916;&#x7684;&#x6253;&#x5370;<span class="token punctuation">;</span> &#x8FD9;&#x91CC;&#x7528;&#x4E86;&#x6269;&#x5C55;&#x6B63;&#x5219;&#x548C;&#x53CD;&#x5411;&#x5F15;&#x7528;.
<span class="token punctuation">;</span>p&#x662F;&#x7B2C;&#x4E8C;&#x547D;&#x4EE4;, &#x6253;&#x5370;pattern&#x7A7A;&#x95F4;, &#x5373;&#x6253;&#x5370;&#x5904;&#x7406;&#x540E;&#x7684;&#x884C;. &#x6CA1;&#x6709;p&#x547D;&#x4EE4;&#x5C06;&#x6CA1;&#x6709;&#x8F93;&#x51FA;
</code></pre>
<h1 id="cpu&#x5229;&#x7528;&#x7387;&#x6761;&#x4EF6;&#x89E6;&#x53D1;perf-record"><a name="cpu&#x5229;&#x7528;&#x7387;&#x6761;&#x4EF6;&#x89E6;&#x53D1;perf-record" class="anchor-navigation-ex-anchor" href="#cpu&#x5229;&#x7528;&#x7387;&#x6761;&#x4EF6;&#x89E6;&#x53D1;perf-record"><i class="fa fa-link" aria-hidden="true"></i></a>8. CPU&#x5229;&#x7528;&#x7387;&#x6761;&#x4EF6;&#x89E6;&#x53D1;perf record</h1>
<p>&#x6761;&#x4EF6;&#x662F;&#x4E24;&#x4E2A;&#x8FDB;&#x7A0B;<code>pidof onumgnt_hypervisor_app</code>&#x548C;<code>pidof onu_engine</code>&#x7684;CPU&#x5229;&#x7528;&#x7387;&#x540C;&#x65F6;&#x5230;10%&#x4EE5;&#x4E0A;.</p>
<p>&#x6CE8;&#x610F;&#x7528;&#x6574;&#x4E2A;<code>while</code>&#x5757;&#x4F7F;&#x7528;&#x5C0F;&#x62EC;&#x53F7;&#x62EC;&#x8D77;&#x6765;&#x7684;, &#x5C0F;&#x62EC;&#x53F7;&#x4F1A;&#x4EA7;&#x751F;&#x5B50;&#x8FDB;&#x7A0B;, &#x76EE;&#x7684;&#x662F;&#x8BA9;&#x5757;&#x5185;&#x7684;<code>exit</code>&#x9000;&#x51FA;&#x8FD9;&#x4E2A;&#x5B50;&#x8FDB;&#x7A0B;.
&#x4E0D;&#x7528;&#x5C0F;&#x62EC;&#x53F7;&#x7684;&#x8BDD;, &#x8FD9;&#x4E2A;&#x4EE3;&#x7801;&#x5757;&#x662F;&#x5728;&#x5F53;&#x524D;shell&#x8FDB;&#x7A0B;&#x6267;&#x884C;, &#x90A3;<code>exit</code>&#x4F1A;&#x9000;&#x51FA;&#x5F53;&#x524D;shell.</p>
<pre class="language-"><code class="lang-sh">./topid <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">`</span>pidof onumgnt_hypervisor_app<span class="token variable">`</span></span> <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">`</span>pidof onu_engine<span class="token variable">`</span></span> <span class="token operator">&gt;</span> pid.log <span class="token operator">&amp;</span>

<span class="token punctuation">(</span>
<span class="token keyword">while</span> <span class="token boolean">true</span>
<span class="token keyword">do</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">tail</span> <span class="token parameter variable">-n</span> <span class="token number">2</span> pid.log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;{if ($3&gt;10) print $5}&apos;</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> doing profiling
        <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span> ./perf record <span class="token parameter variable">-F</span> <span class="token number">500</span> <span class="token parameter variable">-e</span> cycles <span class="token parameter variable">-g</span> --call-graph dwarf <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">`</span>pidof onumgnt_hypervisor_app<span class="token variable">`</span></span> -- <span class="token function">sleep</span> <span class="token number">60</span>
        <span class="token builtin class-name">exit</span>
    <span class="token keyword">fi</span>
    <span class="token function">sleep</span> <span class="token number">3</span>
<span class="token keyword">done</span>
<span class="token punctuation">)</span>
</code></pre>
<p>&#x53E6;&#x5916;, &#x8FD9;&#x4E2A;&#x8FD9;&#x4E2A;&#x4EE3;&#x7801;&#x5757;&#x4E0D;&#x8981;&#x7528;<code>tab</code>&#x6765;&#x7F29;&#x8FDB;, &#x5426;&#x5219;&#x4F1A;&#x88AB;shell&#x89E3;&#x6790;&#x6210;auto completion&#x6765;&#x81EA;&#x52A8;&#x8054;&#x60F3;&#x547D;&#x4EE4;.</p>
<h1 id="top&#x7684;&#x8BB0;&#x5F55;&#x5BFC;&#x5165;&#x5230;excel"><a name="top&#x7684;&#x8BB0;&#x5F55;&#x5BFC;&#x5165;&#x5230;excel" class="anchor-navigation-ex-anchor" href="#top&#x7684;&#x8BB0;&#x5F55;&#x5BFC;&#x5165;&#x5230;excel"><i class="fa fa-link" aria-hidden="true"></i></a>9. top&#x7684;&#x8BB0;&#x5F55;&#x5BFC;&#x5165;&#x5230;excel</h1>
<h2 id="&#x6BD4;&#x8F83;&#x7C97;&#x7CD9;&#x7684;&#x7248;&#x672C;"><a name="&#x6BD4;&#x8F83;&#x7C97;&#x7CD9;&#x7684;&#x7248;&#x672C;" class="anchor-navigation-ex-anchor" href="#&#x6BD4;&#x8F83;&#x7C97;&#x7CD9;&#x7684;&#x7248;&#x672C;"><i class="fa fa-link" aria-hidden="true"></i></a>9.1. &#x6BD4;&#x8F83;&#x7C97;&#x7CD9;&#x7684;&#x7248;&#x672C;</h2>
<h3 id="cpu"><a name="cpu" class="anchor-navigation-ex-anchor" href="#cpu"><i class="fa fa-link" aria-hidden="true"></i></a>9.1.1. CPU</h3>
<pre class="language-"><code class="lang-sh"><span class="token punctuation">(</span>echo <span class="token function">time</span> switch_hwa_app vonu xpon_hwa_app xponhwadp <span class="token operator">&amp;&amp;</span> <span class="token function">cat</span> top.log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;/GMT/{printf &quot;\n&quot;$4} /run\/switch_hwa_app/{printf(&quot; switch_hwa_app&gt;%s&quot;,$8)} /run\/xpon_hwa_app/{printf(&quot; xpon_hwa_app&gt;%s&quot;,$8)} /run\/xponhwadp/{printf(&quot; xponhwadp&gt;%s&quot;,$8)} /vONU-PoC-1 -skipav yes/{printf(&quot; vonu&gt;%s&quot;,$8)}&apos;</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> line<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token variable">$line</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-n1</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">xargs</span><span class="token punctuation">;</span> <span class="token keyword">done</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">&quot;&gt;&quot;</span> <span class="token string">&quot; &quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;{printf(&quot;%s %s %s %s %s\n&quot;, $1, $3, $5, $7, $9)}&apos;</span> <span class="token punctuation">)</span> <span class="token operator">&gt;</span> ~/sf_work/tmp/<span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> `pwd`<span class="token variable">)</span></span>.csv
</code></pre>
<h3 id="mem"><a name="mem" class="anchor-navigation-ex-anchor" href="#mem"><i class="fa fa-link" aria-hidden="true"></i></a>9.1.2. mem</h3>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x8FD9;&#x91CC;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x7EDF;&#x8BA1;&#x7684;VSS, &#x662F;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x5360;&#x7528;</span>
<span class="token function">cat</span> top.log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;/GMT/{printf &quot;\n&quot;$4&quot;\t&quot;} /vONU-PoC-1 -skipav yes/ {if($5 ~ /.*m/) printf $5; else printf $5/1024}&apos;</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">&apos;m&apos;</span> <span class="token operator">&gt;</span> ~/sf_work/tmp/<span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> `pwd`<span class="token variable">)</span></span>.csv
</code></pre>
<h2 id="&#x540C;&#x65F6;&#x5BFC;&#x51FA;cpu&#x5229;&#x7528;&#x7387;&#x548C;mem"><a name="&#x540C;&#x65F6;&#x5BFC;&#x51FA;cpu&#x5229;&#x7528;&#x7387;&#x548C;mem" class="anchor-navigation-ex-anchor" href="#&#x540C;&#x65F6;&#x5BFC;&#x51FA;cpu&#x5229;&#x7528;&#x7387;&#x548C;mem"><i class="fa fa-link" aria-hidden="true"></i></a>9.2. &#x540C;&#x65F6;&#x5BFC;&#x51FA;CPU&#x5229;&#x7528;&#x7387;&#x548C;mem</h2>
<p>&#x8FD9;&#x4E2A;top.log&#x662F;&#x7528;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x8BB0;&#x5F55;&#x7684;, &#x6BCF;&#x79D2;&#x4E00;&#x6B21;.</p>
<pre class="language-"><code class="lang-sh"><span class="token comment">#grep -E&#x8BB0;&#x5F55;&#x7684;&#x662F;RSS, &#x7269;&#x7406;&#x5185;&#x5B58;.</span>
<span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token function">date</span>
    <span class="token function">top</span> <span class="token parameter variable">-bn1</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">&quot;<span class="token variable">$patten</span>|CPU|Mem|COMMAND&quot;</span>
    <span class="token function">top</span> <span class="token parameter variable">-bn1</span> <span class="token parameter variable">-m</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">&quot;<span class="token variable">$patten</span>|COMMAND&quot;</span>
    <span class="token function">sleep</span> <span class="token number">1</span>
<span class="token keyword">done</span> <span class="token operator">&gt;&gt;</span> log/top.log
</code></pre>
<p>&#x539F;&#x59CB;&#x7684;log&#x5982;&#x4E0B;:</p>
<pre class="language-"><code class="lang-sh">Tue Jan  <span class="token number">6</span> <span class="token number">13</span>:05:29 GMT <span class="token number">1970</span>
Mem: 884920K used, 1072956K free, 152152K shrd, 42636K buff, 356908K cached
CPU:  <span class="token number">54</span>% usr  <span class="token number">16</span>% sys   <span class="token number">0</span>% nic  <span class="token number">29</span>% idle   <span class="token number">0</span>% io   <span class="token number">0</span>% irq   <span class="token number">0</span>% sirq
  PID  <span class="token environment constant">PPID</span> <span class="token environment constant">USER</span>     STAT   VSZ %VSZ CPU %CPU COMMAND
<span class="token number">24514</span>     <span class="token number">1</span> root     S     110m   <span class="token number">6</span>%   <span class="token number">1</span>  <span class="token number">50</span>% ./vONU-PoC-1 <span class="token parameter variable">-profilingperiod</span> <span class="token number">5</span>
<span class="token number">18455</span>   <span class="token number">165</span> root     S     204m  <span class="token number">11</span>%   <span class="token number">1</span>   <span class="token number">0</span>% /isam/slot_default/xpon_hwa_app/run/xpon_hwa_app <span class="token parameter variable">--json</span><span class="token operator">=</span>/isam/slot_default/xpon_hwa_app/config/app_config <span class="token parameter variable">--pty</span><span class="token operator">=</span>/isam/slot_default/xpon_hwa_app/run/tty1_ext --tnd-client
<span class="token number">18047</span>   <span class="token number">131</span> root     S     184m  <span class="token number">10</span>%   <span class="token number">0</span>   <span class="token number">0</span>% /isam/slot_default/switch_hwa_app/run/switch_hwa_app <span class="token parameter variable">--json</span><span class="token operator">=</span>/isam/slot_default/switch_hwa_app/config/app_config <span class="token parameter variable">--pty</span><span class="token operator">=</span>/isam/slot_default/switch_hwa_app/run/tty1_ext --tnd-client <span class="token parameter variable">--json</span><span class="token operator">=</span>/isam/slot_default/switch_hwa_app/config/app_config <span class="token parameter variable">--pty</span><span class="token operator">=</span>/isam/slot_default/switch_hwa_app/run/tty1_ext --tnd-client
<span class="token number">22037</span>     <span class="token number">1</span> root     S    <span class="token number">51844</span>   <span class="token number">3</span>%   <span class="token number">1</span>   <span class="token number">0</span>% //lib/confd/erts/bin/confd <span class="token parameter variable">-K</span> <span class="token boolean">false</span> <span class="token parameter variable">-MHe</span> <span class="token boolean">true</span> -- <span class="token parameter variable">-root</span> //lib/confd <span class="token parameter variable">-progname</span> confd -- <span class="token parameter variable">-home</span> / -- <span class="token parameter variable">-smp</span> disable <span class="token parameter variable">-boot</span> confd -delayed-detach <span class="token parameter variable">-noshell</span> <span class="token parameter variable">-noinput</span> <span class="token parameter variable">-yaws</span> embedded <span class="token boolean">true</span> <span class="token parameter variable">-stacktrace_depth</span> <span class="token number">24</span> <span class="token parameter variable">-shutdown_time</span> <span class="token number">30000</span> <span class="token parameter variable">-conffile</span> //etc/confd/confd.conf <span class="token parameter variable">-start_phase0</span> <span class="token parameter variable">-max_fds</span> <span class="token number">1024</span> -detached-fd <span class="token number">4</span>
<span class="token number">18067</span>   <span class="token number">166</span> root     S    <span class="token number">36168</span>   <span class="token number">2</span>%   <span class="token number">1</span>   <span class="token number">0</span>% /isam/slot_default/xponhwadp/run/xponhwadp <span class="token parameter variable">--json</span><span class="token operator">=</span>/isam/slot_default/xponhwadp/config/app_config <span class="token parameter variable">--pty</span><span class="token operator">=</span>/isam/slot_default/xponhwadp/run/tty1_ext --tnd-client
<span class="token number">18601</span>   <span class="token number">124</span> root     S    <span class="token number">34260</span>   <span class="token number">2</span>%   <span class="token number">1</span>   <span class="token number">0</span>% /isam/slot_default/dmsp_app/run/dmsp_app <span class="token parameter variable">--json</span><span class="token operator">=</span>/isam/slot_default/dmsp_app/config/app_config <span class="token parameter variable">--pty</span><span class="token operator">=</span>/isam/slot_default/dmsp_app/run/tty1_ext --tnd-client
<span class="token number">24522</span> <span class="token number">24515</span> root     S     <span class="token number">2952</span>   <span class="token number">0</span>%   <span class="token number">1</span>   <span class="token number">0</span>% <span class="token function">grep</span> <span class="token parameter variable">-E</span> vONU-PoC-1<span class="token operator">|</span>xponhwadp<span class="token operator">|</span>switch_hwa_app<span class="token operator">|</span>xpon_hwa_app<span class="token operator">|</span>confd<span class="token operator">|</span>dmsp_app<span class="token operator">|</span>CPU<span class="token operator">|</span>Mem<span class="token operator">|</span>COMMAND
  <span class="token number">124</span>     <span class="token number">1</span> root     S     <span class="token number">2788</span>   <span class="token number">0</span>%   <span class="token number">0</span>   <span class="token number">0</span>% s6-supervise dmsp_app
  <span class="token number">131</span>     <span class="token number">1</span> root     S     <span class="token number">2788</span>   <span class="token number">0</span>%   <span class="token number">0</span>   <span class="token number">0</span>% s6-supervise switch_hwa_app
  <span class="token number">165</span>     <span class="token number">1</span> root     S     <span class="token number">2788</span>   <span class="token number">0</span>%   <span class="token number">0</span>   <span class="token number">0</span>% s6-supervise xpon_hwa_app
  <span class="token number">166</span>     <span class="token number">1</span> root     S     <span class="token number">2788</span>   <span class="token number">0</span>%   <span class="token number">0</span>   <span class="token number">0</span>% s6-supervise xponhwadp
  PID^^^VSZ^VSZRW   RSS <span class="token punctuation">(</span>SHR<span class="token punctuation">)</span> DIRTY <span class="token punctuation">(</span>SHR<span class="token punctuation">)</span> STACK COMMAND
<span class="token number">18047</span>  176m  148m  123m  <span class="token number">6948</span> <span class="token number">95676</span>  <span class="token number">5896</span>   <span class="token number">132</span> /isam/slot_default/switch_hwa_app/run/switch_hwa_app <span class="token parameter variable">--json</span><span class="token operator">=</span>/isam/slot_default/switch_hwa_app/config/app_config <span class="token parameter variable">--pty</span><span class="token operator">=</span>/isam/slot_default/switch_hwa_app/run/tty1_ext --tnd-client <span class="token parameter variable">--json</span><span class="token operator">=</span>/isam/slot_default/switch_hwa_app/config/app_config <span class="token parameter variable">--pty</span><span class="token operator">=</span>/isam/slot_default/switch_hwa_app/run/tty1_ext --tnd-client
<span class="token number">24514</span>  110m  100m <span class="token number">11020</span>     <span class="token number">0</span> <span class="token number">11020</span>     <span class="token number">0</span>   <span class="token number">132</span> ./vONU-PoC-1 <span class="token parameter variable">-profilingperiod</span> <span class="token number">5</span>
<span class="token number">22037</span> <span class="token number">51844</span> <span class="token number">39868</span> <span class="token number">38424</span>  <span class="token number">2608</span> <span class="token number">38420</span>  <span class="token number">2604</span>   <span class="token number">132</span> //lib/confd/erts/bin/confd <span class="token parameter variable">-K</span> <span class="token boolean">false</span> <span class="token parameter variable">-MHe</span> <span class="token boolean">true</span> -- <span class="token parameter variable">-root</span> //lib/confd <span class="token parameter variable">-progname</span> confd -- <span class="token parameter variable">-home</span> / -- <span class="token parameter variable">-smp</span> disable <span class="token parameter variable">-boot</span> confd -delayed-detach <span class="token parameter variable">-noshell</span> <span class="token parameter variable">-noinput</span> <span class="token parameter variable">-yaws</span> embedded <span class="token boolean">true</span> <span class="token parameter variable">-stacktrace_depth</span> <span class="token number">24</span> <span class="token parameter variable">-shutdown_time</span> <span class="token number">30000</span> <span class="token parameter variable">-conffile</span> //etc/confd/confd.conf <span class="token parameter variable">-start_phase0</span> <span class="token parameter variable">-max_fds</span> <span class="token number">1024</span> -detached-fd <span class="token number">4</span>
<span class="token number">18067</span> <span class="token number">36168</span>  <span class="token number">7624</span> <span class="token number">20760</span> <span class="token number">11224</span> <span class="token number">11272</span>  <span class="token number">6816</span>   <span class="token number">128</span> /isam/slot_default/xponhwadp/run/xponhwadp <span class="token parameter variable">--json</span><span class="token operator">=</span>/isam/slot_default/xponhwadp/config/app_config <span class="token parameter variable">--pty</span><span class="token operator">=</span>/isam/slot_default/xponhwadp/run/tty1_ext --tnd-client
<span class="token number">18601</span> <span class="token number">34260</span> <span class="token number">14452</span> <span class="token number">22652</span> <span class="token number">11304</span> <span class="token number">17688</span>  <span class="token number">6916</span>   <span class="token number">132</span> /isam/slot_default/dmsp_app/run/dmsp_app <span class="token parameter variable">--json</span><span class="token operator">=</span>/isam/slot_default/dmsp_app/config/app_config <span class="token parameter variable">--pty</span><span class="token operator">=</span>/isam/slot_default/dmsp_app/run/tty1_ext --tnd-client
<span class="token number">18455</span> <span class="token number">29104</span>  <span class="token number">8324</span> <span class="token number">14208</span>  <span class="token number">7192</span>  <span class="token number">8392</span>  <span class="token number">5540</span>   <span class="token number">132</span> /isam/slot_default/xpon_hwa_app/run/xpon_hwa_app <span class="token parameter variable">--json</span><span class="token operator">=</span>/isam/slot_default/xpon_hwa_app/config/app_config <span class="token parameter variable">--pty</span><span class="token operator">=</span>/isam/slot_default/xpon_hwa_app/run/tty1_ext --tnd-client
<span class="token number">24527</span>  <span class="token number">2952</span>   <span class="token number">384</span>  <span class="token number">1532</span>  <span class="token number">1464</span>  <span class="token number">1528</span>  <span class="token number">1460</span>   <span class="token number">132</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> vONU-PoC-1<span class="token operator">|</span>xponhwadp<span class="token operator">|</span>switch_hwa_app<span class="token operator">|</span>xpon_hwa_app<span class="token operator">|</span>confd<span class="token operator">|</span>dmsp_app<span class="token operator">|</span>COMMAND
  <span class="token number">124</span>  <span class="token number">2788</span>   <span class="token number">400</span>  <span class="token number">1464</span>  <span class="token number">1348</span>  <span class="token number">1460</span>  <span class="token number">1344</span>   <span class="token number">132</span> s6-supervise dmsp_app
  <span class="token number">166</span>  <span class="token number">2788</span>   <span class="token number">400</span>  <span class="token number">1424</span>  <span class="token number">1312</span>  <span class="token number">1420</span>  <span class="token number">1308</span>   <span class="token number">132</span> s6-supervise xponhwadp
  <span class="token number">131</span>  <span class="token number">2788</span>   <span class="token number">400</span>  <span class="token number">1396</span>  <span class="token number">1284</span>  <span class="token number">1392</span>  <span class="token number">1280</span>   <span class="token number">132</span> s6-supervise switch_hwa_app
  <span class="token number">165</span>  <span class="token number">2788</span>   <span class="token number">400</span>  <span class="token number">1396</span>  <span class="token number">1284</span>  <span class="token number">1392</span>  <span class="token number">1280</span>   <span class="token number">132</span> s6-supervise xpon_hwa_app
</code></pre>
<p>&#x7528;&#x4E0B;&#x9762;&#x7684;&#x811A;&#x672C;&#x89E3;&#x6790;</p>
<pre class="language-"><code class="lang-sh"><span class="token function">cat</span> top.log <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-E</span> <span class="token string">&quot;s6-supervise|grep|COMMAND|confd -B| tar| cat&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;/GMT/{printf &quot;\ntime=&quot;$4} /Mem:/{sub(&quot;K&quot;,&quot;&quot;,$4);printf &quot; free=&quot; $4/1024} /CPU:/{printf(&quot; usr=%s sys=%s idle=%s sirq=%s&quot;,$2,$4,$8,$14)} $1 ~ /[0-9]+/{sub(&quot;.*/&quot;,&quot;&quot;,$9);printf(&quot; %s&quot;,$9);if($8 ~ /.*%/) printf &quot;:cpu=&quot;$8;else {printf &quot;:rss=&quot;;if($4 ~ /.*m/) {sub(&quot;m&quot;,&quot;&quot;,$4);printf $4} else printf $4/1024}}&apos;</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> line<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token variable">$line</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-n1</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">xargs</span><span class="token punctuation">;</span> <span class="token keyword">done</span>
</code></pre>
<ul>
<li>awk&#x7684;&#x884C;&#x5339;&#x914D;&#x652F;&#x6301;&#x8868;&#x8FBE;&#x5F0F;, &#x8FD9;&#x91CC;&#x7684;<code>$1 ~ /[0-9]+/</code>&#x5C31;&#x662F;, &#x610F;&#x601D;&#x662F;&#x7B2C;&#x4E00;&#x4E2A;field&#x5339;&#x914D;&#x4E00;&#x4E2A;number</li>
<li>sub&#x662F;&#x539F;&#x5730;&#x66FF;&#x6362;, &#x4E0D;&#x8FD4;&#x56DE;&#x5B57;&#x7B26;&#x4E32;</li>
</ul>
<p>&#x8F93;&#x51FA;&#x5982;&#x4E0B;:</p>
<pre class="language-"><code class="lang-sh">confd:cpu<span class="token operator">=</span><span class="token number">0</span>% confd:rss<span class="token operator">=</span><span class="token number">37.5234</span> dmsp_app:cpu<span class="token operator">=</span><span class="token number">0</span>% dmsp_app:rss<span class="token operator">=</span><span class="token number">22.1211</span> <span class="token assign-left variable">free</span><span class="token operator">=</span><span class="token number">1047.81</span> <span class="token assign-left variable">idle</span><span class="token operator">=</span><span class="token number">29</span>% <span class="token assign-left variable">sirq</span><span class="token operator">=</span><span class="token number">0</span>% switch_hwa_app:cpu<span class="token operator">=</span><span class="token number">0</span>% switch_hwa_app:rss<span class="token operator">=</span><span class="token number">123</span> <span class="token assign-left variable">sys</span><span class="token operator">=</span><span class="token number">16</span>% <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">13</span>:05:29 <span class="token assign-left variable">usr</span><span class="token operator">=</span><span class="token number">54</span>% vONU-PoC-1:cpu<span class="token operator">=</span><span class="token number">50</span>% vONU-PoC-1:rss<span class="token operator">=</span><span class="token number">10.7617</span> xpon_hwa_app:cpu<span class="token operator">=</span><span class="token number">0</span>% xpon_hwa_app:rss<span class="token operator">=</span><span class="token number">13.875</span> xponhwadp:cpu<span class="token operator">=</span><span class="token number">0</span>% xponhwadp:rss<span class="token operator">=</span><span class="token number">20.2734</span>
confd:cpu<span class="token operator">=</span><span class="token number">0</span>% confd:rss<span class="token operator">=</span><span class="token number">37.5234</span> dmsp_app:cpu<span class="token operator">=</span><span class="token number">0</span>% dmsp_app:rss<span class="token operator">=</span><span class="token number">22.1211</span> <span class="token assign-left variable">free</span><span class="token operator">=</span><span class="token number">1047.55</span> <span class="token assign-left variable">idle</span><span class="token operator">=</span><span class="token number">75</span>% <span class="token assign-left variable">sirq</span><span class="token operator">=</span><span class="token number">0</span>% switch_hwa_app:cpu<span class="token operator">=</span><span class="token number">4</span>% switch_hwa_app:rss<span class="token operator">=</span><span class="token number">123</span> <span class="token assign-left variable">sys</span><span class="token operator">=</span><span class="token number">16</span>% <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">13</span>:05:30 <span class="token assign-left variable">usr</span><span class="token operator">=</span><span class="token number">8</span>% vONU-PoC-1:cpu<span class="token operator">=</span><span class="token number">0</span>% vONU-PoC-1:rss<span class="token operator">=</span><span class="token number">10.7617</span> xpon_hwa_app:cpu<span class="token operator">=</span><span class="token number">0</span>% xpon_hwa_app:rss<span class="token operator">=</span><span class="token number">13.875</span> xponhwadp:cpu<span class="token operator">=</span><span class="token number">0</span>% xponhwadp:rss<span class="token operator">=</span><span class="token number">20.2734</span>
confd:cpu<span class="token operator">=</span><span class="token number">0</span>% confd:rss<span class="token operator">=</span><span class="token number">37.5234</span> dmsp_app:cpu<span class="token operator">=</span><span class="token number">0</span>% dmsp_app:rss<span class="token operator">=</span><span class="token number">22.1211</span> <span class="token assign-left variable">free</span><span class="token operator">=</span><span class="token number">1047.42</span> <span class="token assign-left variable">idle</span><span class="token operator">=</span><span class="token number">83</span>% <span class="token assign-left variable">sirq</span><span class="token operator">=</span><span class="token number">4</span>% switch_hwa_app:cpu<span class="token operator">=</span><span class="token number">4</span>% switch_hwa_app:rss<span class="token operator">=</span><span class="token number">123</span> <span class="token assign-left variable">sys</span><span class="token operator">=</span><span class="token number">4</span>% <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">13</span>:05:32 <span class="token assign-left variable">usr</span><span class="token operator">=</span><span class="token number">8</span>% vONU-PoC-1:cpu<span class="token operator">=</span><span class="token number">0</span>% vONU-PoC-1:rss<span class="token operator">=</span><span class="token number">10.7617</span> xpon_hwa_app:cpu<span class="token operator">=</span><span class="token number">0</span>% xpon_hwa_app:rss<span class="token operator">=</span><span class="token number">13.875</span> xponhwadp:cpu<span class="token operator">=</span><span class="token number">0</span>% xponhwadp:rss<span class="token operator">=</span><span class="token number">20.2734</span>
confd:cpu<span class="token operator">=</span><span class="token number">0</span>% confd:rss<span class="token operator">=</span><span class="token number">37.5234</span> dmsp_app:cpu<span class="token operator">=</span><span class="token number">0</span>% dmsp_app:rss<span class="token operator">=</span><span class="token number">22.1211</span> <span class="token assign-left variable">free</span><span class="token operator">=</span><span class="token number">1047.24</span> <span class="token assign-left variable">idle</span><span class="token operator">=</span><span class="token number">90</span>% <span class="token assign-left variable">sirq</span><span class="token operator">=</span><span class="token number">0</span>% switch_hwa_app:cpu<span class="token operator">=</span><span class="token number">2</span>% switch_hwa_app:rss<span class="token operator">=</span><span class="token number">123</span> <span class="token assign-left variable">sys</span><span class="token operator">=</span><span class="token number">4</span>% <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">13</span>:05:33 <span class="token assign-left variable">usr</span><span class="token operator">=</span><span class="token number">4</span>% vONU-PoC-1:cpu<span class="token operator">=</span><span class="token number">0</span>% vONU-PoC-1:rss<span class="token operator">=</span><span class="token number">10.7617</span> xpon_hwa_app:cpu<span class="token operator">=</span><span class="token number">0</span>% xpon_hwa_app:rss<span class="token operator">=</span><span class="token number">13.875</span> xponhwadp:cpu<span class="token operator">=</span><span class="token number">0</span>% xponhwadp:rss<span class="token operator">=</span><span class="token number">20.2734</span>
confd:cpu<span class="token operator">=</span><span class="token number">0</span>% confd:rss<span class="token operator">=</span><span class="token number">37.5234</span> dmsp_app:cpu<span class="token operator">=</span><span class="token number">0</span>% dmsp_app:rss<span class="token operator">=</span><span class="token number">22.1211</span> <span class="token assign-left variable">free</span><span class="token operator">=</span><span class="token number">1047.22</span> <span class="token assign-left variable">idle</span><span class="token operator">=</span><span class="token number">81</span>% <span class="token assign-left variable">sirq</span><span class="token operator">=</span><span class="token number">0</span>% switch_hwa_app:cpu<span class="token operator">=</span><span class="token number">4</span>% switch_hwa_app:rss<span class="token operator">=</span><span class="token number">123</span> <span class="token assign-left variable">sys</span><span class="token operator">=</span><span class="token number">13</span>% <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">13</span>:05:35 <span class="token assign-left variable">usr</span><span class="token operator">=</span><span class="token number">4</span>% vONU-PoC-1:cpu<span class="token operator">=</span><span class="token number">0</span>% vONU-PoC-1:rss<span class="token operator">=</span><span class="token number">10.7852</span> xpon_hwa_app:cpu<span class="token operator">=</span><span class="token number">0</span>% xpon_hwa_app:rss<span class="token operator">=</span><span class="token number">13.875</span> xponhwadp:cpu<span class="token operator">=</span><span class="token number">0</span>% xponhwadp:rss<span class="token operator">=</span><span class="token number">20.2734</span>
</code></pre>
<p>&#x6700;&#x540E;&#x7528;<code>tr &quot;=&quot; &quot; &quot;</code>&#x4F11;&#x6574;&#x4E00;&#x4E0B;.</p>
<p>&#x6700;&#x7EC8;&#x7248;:</p>
<pre class="language-"><code class="lang-sh"><span class="token number">1</span>         <span class="token number">2</span>  <span class="token number">3</span>         <span class="token number">4</span>       <span class="token number">5</span>            <span class="token number">6</span>  <span class="token number">7</span>            <span class="token number">8</span>       <span class="token number">9</span>    <span class="token number">10</span>      <span class="token number">11</span>   <span class="token number">12</span>  <span class="token number">13</span>   <span class="token number">14</span> <span class="token number">15</span>                 <span class="token number">16</span> <span class="token number">17</span>                 <span class="token number">18</span>  <span class="token number">19</span>  <span class="token number">20</span>  <span class="token number">21</span>   <span class="token number">22</span>       <span class="token number">23</span>  <span class="token number">24</span>
confd:cpu <span class="token number">0</span>% confd:rss <span class="token number">37.5234</span> dmsp_app:cpu <span class="token number">0</span>% dmsp_app:rss <span class="token number">22.1211</span> <span class="token function">free</span> <span class="token number">1047.81</span> idle <span class="token number">29</span>% sirq <span class="token number">0</span>% switch_hwa_app:cpu <span class="token number">0</span>% switch_hwa_app:rss <span class="token number">123</span> sys <span class="token number">16</span>% <span class="token function">time</span> <span class="token number">13</span>:05:29 usr <span class="token number">54</span>% 
<span class="token number">25</span>             <span class="token number">26</span>  <span class="token number">27</span>             <span class="token number">28</span>      <span class="token number">29</span>               <span class="token number">30</span> <span class="token number">31</span>               <span class="token number">32</span>     <span class="token number">33</span>            <span class="token number">34</span> <span class="token number">35</span>            <span class="token number">36</span>
vONU-PoC-1:cpu <span class="token number">50</span>% vONU-PoC-1:rss <span class="token number">10.7617</span> xpon_hwa_app:cpu <span class="token number">0</span>% xpon_hwa_app:rss <span class="token number">13.875</span> xponhwadp:cpu <span class="token number">0</span>% xponhwadp:rss <span class="token number">20.2734</span>

<span class="token punctuation">(</span>echo <span class="token function">time</span> <span class="token function">free</span> usr sys idle sirq confd:cpu confd:rss dmsp:cpu dmsp:rss switch_hwa:cpu switch_hwa:rss vONU:cpu vONU:rss xpon_hwa:cpu xpon_hwa:rss xponhwadp:cpu xponhwadp:rss <span class="token operator">&amp;&amp;</span> <span class="token function">cat</span> top.log <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-E</span> <span class="token string">&quot;s6-supervise|grep|COMMAND|confd -B| tar| cat&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;/GMT/{printf &quot;\ntime=&quot;$4} /Mem:/{sub(&quot;K&quot;,&quot;&quot;,$4);printf &quot; free=&quot; $4/1024} /CPU:/{printf(&quot; usr=%s sys=%s idle=%s sirq=%s&quot;,$2,$4,$8,$14)} $1 ~ /[0-9]+/{sub(&quot;.*/&quot;,&quot;&quot;,$9);printf(&quot; %s&quot;,$9);if($8 ~ /.*%/) printf &quot;:cpu=&quot;$8;else {printf &quot;:rss=&quot;;if($4 ~ /.*m/) {sub(&quot;m&quot;,&quot;&quot;,$4);printf $4} else printf $4/1024}}&apos;</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> line<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token variable">$line</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-n1</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">xargs</span><span class="token punctuation">;</span> <span class="token keyword">done</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">&quot;=&quot;</span> <span class="token string">&quot; &quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;NF == 36 {printf(&quot;%s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s\n&quot;, $22,$10,$24,$20,$12,$14,$2,$4,$6,$8,$16,$18,$26,$28,$30,$32,$34,$36)}&apos;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> top.csv
</code></pre>
<h2 id="&#x53EA;&#x5BFC;&#x51FA;cpu&#x5229;&#x7528;&#x7387;"><a name="&#x53EA;&#x5BFC;&#x51FA;cpu&#x5229;&#x7528;&#x7387;" class="anchor-navigation-ex-anchor" href="#&#x53EA;&#x5BFC;&#x51FA;cpu&#x5229;&#x7528;&#x7387;"><i class="fa fa-link" aria-hidden="true"></i></a>9.3. &#x53EA;&#x5BFC;&#x51FA;cpu&#x5229;&#x7528;&#x7387;</h2>
<p>top&#x7684;&#x8F93;&#x51FA;, &#x6BCF;&#x79D2;&#x8BB0;&#x5F55;&#x4E00;&#x6B21;, &#x8FD9;&#x91CC;&#x7684;patten&#x662F;<code>xponhwadp switch_hwa_app xpon_hwa_app vONU-PoC-1</code>&#x8FD9;&#x51E0;&#x4E2A;app&#x7684;&#x540D;&#x5B57;<br>&#x524D;&#x9762;&#x6253;&#x4E2A;&#x65F6;&#x95F4;&#x6233;<br><code>date &amp;&amp; top -bn1 | grep -E $patten</code>
&#x8F93;&#x51FA;&#x662F;&#x8FD9;&#x6837;&#x7684;:<br><img src="img/shell_&#x9AD8;&#x7EA7;&#x7BC7;_20220915234144.png" alt="">  </p>
<p>&#x600E;&#x4E48;&#x628A;&#x8FD9;&#x4E2A;&#x8F93;&#x51FA;, &#x5BFC;&#x5165;&#x5230;excel&#x91CC;&#x9762;, &#x7136;&#x540E;&#x5BF9;&#x6BCF;&#x4E2A;app&#x505A;cpu&#x5360;&#x7528;&#x7684;&#x56FE;&#x5462;?
&#x8981;&#x7528;&#x5230;awk, xargs, sort</p>
<pre class="language-"><code class="lang-sh"><span class="token function">cat</span> top.log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;/GMT/{printf &quot;\n&quot;$4} /run\/switch_hwa_app/{printf(&quot; switch_hwa_app:%s&quot;,$8)} /run\/xpon_hwa_app/{printf(&quot; xpon_hwa_app:%s&quot;,$8)} /run\/xponhwadp/{printf(&quot; xponhwadp:%s&quot;,$8)} /vONU-PoC-1 -skipav yes/{printf(&quot; vonu:%s&quot;,$8)}&apos;</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> line<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token variable">$line</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-n1</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">xargs</span><span class="token punctuation">;</span> <span class="token keyword">done</span>
</code></pre>
<ul>
<li>awk&#x8D1F;&#x8D23;&#x8FC7;&#x6EE4;&#x5173;&#x952E;&#x8BCD;, &#x7528;/patten/{action}&#x7684;&#x5F62;&#x5F0F;</li>
<li>awk&#x8FC7;&#x6EE4;&#x540E;, &#x6BCF;&#x4E2A;&#x65F6;&#x95F4;&#x6233;&#x4E0B;, &#x8FD9;&#x56DB;&#x4E2A;app&#x90FD;&#x5217;&#x51FA;&#x6765;&#x4E86;, &#x4F46;&#x987A;&#x4E0D;&#x4E00;&#x5B9A;&#x4E00;&#x6837;, &#x56E0;&#x4E3A;top&#x8F93;&#x51FA;&#x4F1A;&#x6309;&#x7167;CPU&#x6392;&#x5E8F;<br><img src="img/shell_&#x9AD8;&#x7EA7;&#x7BC7;_20220915234243.png" alt="">  </li>
<li>&#x6B64;&#x65F6;&#x8981;&#x7528;read, &#x4ECE;stdin&#x8BFB;&#x6BCF;&#x4E00;&#x884C;, &#x7136;&#x540E;&#x5BF9;&#x8BE5;&#x884C;&#x6392;&#x5E8F;</li>
<li>xargs -n1&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5BF9;&#x6BCF;&#x4E2A;&#x5B57;&#x6BB5;&#x52A0;&#x56DE;&#x8F66;, &#x56E0;&#x4E3A;&#x9ED8;&#x8BA4;&#x7684;xargs&#x4F1A;&#x5BF9;&#x6BCF;&#x4E2A;&#x8F93;&#x5165;&#x505A;echo</li>
<li>sort&#x662F;&#x6309;&#x884C;&#x5DE5;&#x4F5C;&#x7684;, &#x524D;&#x9762;&#x7684;xargs&#x7684;&#x8F93;&#x51FA;&#x5C31;&#x662F;&#x591A;&#x884C;</li>
<li>&#x6700;&#x540E;&#x7684;xargs&#x628A;&#x6392;&#x597D;&#x5E8F;&#x7684;&#x591A;&#x884C;&#x8F93;&#x51FA;&#x8FD8;&#x539F;&#x6210;&#x4E00;&#x884C;</li>
</ul>
<p>&#x6700;&#x540E;&#x7684;&#x8F93;&#x51FA;:<br><img src="img/shell_&#x9AD8;&#x7EA7;&#x7BC7;_20220915234300.png" alt="">  </p>
<h3 id="&#x6539;&#x8FDB;&#x7248;"><a name="&#x6539;&#x8FDB;&#x7248;" class="anchor-navigation-ex-anchor" href="#&#x6539;&#x8FDB;&#x7248;"><i class="fa fa-link" aria-hidden="true"></i></a>9.3.1. &#x6539;&#x8FDB;&#x7248;</h3>
<pre class="language-"><code class="lang-sh"><span class="token punctuation">(</span>echo <span class="token function">time</span> switch_hwa_app vonu xpon_hwa_app xponhwadp <span class="token operator">&amp;&amp;</span> <span class="token function">cat</span> top.log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;/GMT/{printf &quot;\n&quot;$4} /run\/switch_hwa_app/{printf(&quot; switch_hwa_app&gt;%s&quot;,$8)} /run\/xpon_hwa_app/{printf(&quot; xpon_hwa_app&gt;%s&quot;,$8)} /run\/xponhwadp/{printf(&quot; xponhwadp&gt;%s&quot;,$8)} /vONU-PoC-1 -skipav yes/{printf(&quot; vonu&gt;%s&quot;,$8)}&apos;</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> line<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token variable">$line</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-n1</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">xargs</span><span class="token punctuation">;</span> <span class="token keyword">done</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">&quot;&gt;&quot;</span> <span class="token string">&quot; &quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;{printf(&quot;%s %s %s %s %s\n&quot;, $1, $3, $5, $7, $9)}&apos;</span> <span class="token punctuation">)</span> <span class="token operator">&gt;</span> top.csv
</code></pre>
<ul>
<li>&#x7528;()&#x62EC;&#x8D77;&#x6765;echo&#x548C;&#x540E;&#x9762;&#x7684;&#x5904;&#x7406;, &#x5426;&#x5219;echo&#x4E0D;&#x4F1A;&#x91CD;&#x5B9A;&#x5411;&#x5230;top.csv</li>
</ul>
<h1 id="&#x7528;tr&#x5904;&#x7406;&#x591A;&#x4F59;&#x5B57;&#x7B26;"><a name="&#x7528;tr&#x5904;&#x7406;&#x591A;&#x4F59;&#x5B57;&#x7B26;" class="anchor-navigation-ex-anchor" href="#&#x7528;tr&#x5904;&#x7406;&#x591A;&#x4F59;&#x5B57;&#x7B26;"><i class="fa fa-link" aria-hidden="true"></i></a>10. &#x7528;tr&#x5904;&#x7406;&#x591A;&#x4F59;&#x5B57;&#x7B26;</h1>
<p><img src="img/shell_&#x9AD8;&#x7EA7;&#x7BC7;_20220915234334.png" alt=""><br>&#x539F;&#x59CB;&#x6587;&#x4EF6;&#x662F;&#x5E26;^M&#x5B57;&#x7B26;&#x7684;, &#x5B83;&#x5B9E;&#x9645;&#x4E0A;&#x662F;windows&#x7684;<code>\r</code></p>
<blockquote>
<p><code>(to get ^M type CTRL+V followed by CTRL+M i.e. don&#x2019;t just type the carat symbol and a capital M. It will not work)</code></p>
</blockquote>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x91CD;&#x70B9;&#x662F;tr -d, &#x628A;&#x4E24;&#x8FB9;&#x7684;&#x65B9;&#x62EC;&#x53F7;&#x5220;&#x6389;, &#x628A;\r&#x5220;&#x6389;</span>
<span class="token function">cat</span> onustatus.log <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">&apos;[]\r&apos;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;/onustatus/{printf $6 &quot; &quot;} /ONUs done/{print $3}&apos;</span>
</code></pre>
<h1 id="&#x4E00;&#x6B21;shell&#x91CD;&#x5B9A;&#x5411;&#x8FC7;&#x7A0B;"><a name="&#x4E00;&#x6B21;shell&#x91CD;&#x5B9A;&#x5411;&#x8FC7;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#&#x4E00;&#x6B21;shell&#x91CD;&#x5B9A;&#x5411;&#x8FC7;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>11. &#x4E00;&#x6B21;shell&#x91CD;&#x5B9A;&#x5411;&#x8FC7;&#x7A0B;</h1>
<p>&#x7528;strace&#x89C2;&#x5BDF;&#x4E00;&#x4E2A;&#x91CD;&#x5B9A;&#x5411;&#x7684;&#x8FC7;&#x7A0B;:
<code>strace bash -c &quot;echo 5555 &gt; testpipe&quot;</code>
&#x8FD9;&#x91CC;&#x7684;testpipe&#x662F;&#x4E2A;&#x6709;&#x540D;&#x7BA1;&#x9053;, &#x7528;<code>mkfifo testpipe&#x751F;&#x6210;&#x7684;</code>
&#x6CE8;&#x610F;, &#x6211;&#x7528;&#x4E86;&apos;bash -c&apos;&#x547D;&#x4EE4;, &#x610F;&#x601D;&#x662F;&#x65B0;&#x8D77;&#x4E00;&#x4E2A;bash&#x8FDB;&#x7A0B;&#x6765;&#x6267;&#x884C;<code>-c</code>&#x540E;&#x9762;&#x7684;&#x547D;&#x4EE4;, &#x76EE;&#x7684;&#x662F;&#x89C2;&#x5BDF;bash&#x600E;&#x4E48;&#x5904;&#x7406;&#x91CD;&#x5B9A;&#x5411;&#x7684;.
&#x4E0D;&#x52A0;&apos;bash -c&apos;&#x662F;&#x770B;&#x4E0D;&#x5230;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x7684;.</p>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x672C;bash&#x6267;&#x884C;&#x53E6;&#x5916;&#x4E00;&#x4E2A;bash, &#x4ECE;&#x8FD9;&#x91CC;&#x5230;&#x7ED3;&#x675F;&#x90FD;&#x6CA1;&#x6709;&#x518D;&#x6B21;exec bash</span>
execve<span class="token punctuation">(</span><span class="token string">&quot;/bin/bash&quot;</span>, <span class="token punctuation">[</span><span class="token string">&quot;bash&quot;</span>, <span class="token string">&quot;-c&quot;</span>, <span class="token string">&quot;echo 5555 &gt; testpipe&quot;</span><span class="token punctuation">]</span>
<span class="token comment">#&#x7701;&#x7565;&#x52A8;&#x6001;&#x5E93;&#x52A0;&#x8F7D;&#x8FC7;&#x7A0B;, &#x7701;&#x7565;brk &#x548C;mmap&#x8FC7;&#x7A0B;, &#x7701;&#x7565;&#x6302;&#x8F7D;sighandler&#x8FC7;&#x7A0B;</span>
<span class="token punctuation">..</span>.

<span class="token comment">#&#x8FDB;&#x5165;&#x4E3B;&#x9898;</span>
<span class="token comment"># &#x6253;&#x5F00;testpipe, fd&#x662F;3</span>
openat<span class="token punctuation">(</span>AT_FDCWD, <span class="token string">&quot;testpipe&quot;</span>, O_WRONLY<span class="token operator">|</span>O_CREAT<span class="token operator">|</span>O_TRUNC, 0666<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span>
fcntl<span class="token punctuation">(</span><span class="token number">1</span>, F_GETFD<span class="token punctuation">)</span>                       <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">#&#x4FDD;&#x5B58;&#x73B0;&#x5728;&#x7684;fd1, &#x5230;fd10</span>
fcntl<span class="token punctuation">(</span><span class="token number">1</span>, F_DUPFD, <span class="token number">10</span><span class="token punctuation">)</span>                   <span class="token operator">=</span> <span class="token number">10</span>
fcntl<span class="token punctuation">(</span><span class="token number">1</span>, F_GETFD<span class="token punctuation">)</span>                       <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">#&#x5982;&#x679C;&#x540E;&#x9762;&#x8C03;&#x7528;&#x4E86;exec, &#x5219;exec&#x51FA;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x4E0D;&#x7EE7;&#x627F;fd10; &#x6362;&#x53E5;&#x8BDD;&#x8BF4;, exec&#x6210;&#x529F;&#x540E;, fd10&#x4F1A;&#x88AB;close</span>
<span class="token comment">#&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x91CC;, &#x90FD;&#x6CA1;&#x6709;&#x518D;&#x6B21;exec&#x5B50;&#x8FDB;&#x7A0B;, &#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x8BED;&#x53E5;&#x5B9E;&#x9645;&#x6CA1;&#x8D77;&#x5230;&#x4F5C;&#x7528;.</span>
fcntl<span class="token punctuation">(</span><span class="token number">10</span>, F_SETFD, FD_CLOEXEC<span class="token punctuation">)</span>          <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">#int dup2(int oldfd, int newfd);</span>
<span class="token comment">#&#x628A;fd3&#x590D;&#x5236;&#x5230;fd1, &#x5373;&#x73B0;&#x5728;fd1&#x5C31;&#x662F;fd3</span>
dup2<span class="token punctuation">(</span><span class="token number">3</span>, <span class="token number">1</span><span class="token punctuation">)</span>                              <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment">#&#x5173;&#x95ED;fd3</span>
close<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
write<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token string">&quot;5555<span class="token entity" title="\n">\n</span>&quot;</span>, <span class="token number">5</span><span class="token punctuation">)</span>                   <span class="token operator">=</span> <span class="token number">5</span>
<span class="token comment">#&#x4ECE;fd10&#x8FD8;&#x539F;fd1</span>
dup2<span class="token punctuation">(</span><span class="token number">10</span>, <span class="token number">1</span><span class="token punctuation">)</span>                             <span class="token operator">=</span> <span class="token number">1</span>
fcntl<span class="token punctuation">(</span><span class="token number">10</span>, F_GETFD<span class="token punctuation">)</span>                      <span class="token operator">=</span> 0x1 <span class="token punctuation">(</span>flags FD_CLOEXEC<span class="token punctuation">)</span>
close<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>                               <span class="token operator">=</span> <span class="token number">0</span>
</code></pre>
<h2 id="shell&#x91CD;&#x5B9A;&#x5411;&#x548C;exec"><a name="shell&#x91CD;&#x5B9A;&#x5411;&#x548C;exec" class="anchor-navigation-ex-anchor" href="#shell&#x91CD;&#x5B9A;&#x5411;&#x548C;exec"><i class="fa fa-link" aria-hidden="true"></i></a>11.1. shell&#x91CD;&#x5B9A;&#x5411;&#x548C;exec</h2>
<p>&#x628A;&#x4E0A;&#x9762;&#x4F8B;&#x5B50;&#x7684;&#x547D;&#x4EE4;&#x4FEE;&#x6539;&#x4E00;&#x4E0B;, &#x628A;echo&#x6539;&#x6210;&#x5916;&#x90E8;&#x7A0B;&#x5E8F;cat, &#x7528;strace&#x7684;-f&#x9009;&#x9879;&#x8DDF;&#x8E2A;&#x5168;&#x90E8;&#x8FDB;&#x7A0B;.
<code>strace -f -o s.log bash -c &quot;cat testpipe &gt; testpipe2&quot;</code>
&#x8FC7;&#x7A0B;&#x7B80;&#x6790;&#x5982;&#x4E0B;:</p>
<pre class="language-"><code class="lang-sh"><span class="token comment">#8123&#x8FDB;&#x7A0B;&#x6267;&#x884C;bash</span>
<span class="token number">8123</span>  execve<span class="token punctuation">(</span><span class="token string">&quot;/bin/bash&quot;</span>, <span class="token punctuation">[</span><span class="token string">&quot;bash&quot;</span>, <span class="token string">&quot;-c&quot;</span>, <span class="token string">&quot;cat testpipe &gt; testpipe2&quot;</span><span class="token punctuation">]</span>
<span class="token comment">#&#x7701;&#x7565;&#x52A8;&#x6001;&#x5E93;&#x52A0;&#x8F7D;&#x8FC7;&#x7A0B;, &#x7701;&#x7565;brk &#x548C;mmap&#x8FC7;&#x7A0B;, &#x7701;&#x7565;&#x6302;&#x8F7D;sighandler&#x8FC7;&#x7A0B;</span>
<span class="token comment">#&#x627E;&#x5230;cat&#x547D;&#x4EE4;</span>
<span class="token number">8123</span>  access<span class="token punctuation">(</span><span class="token string">&quot;/bin/cat&quot;</span>, R_OK<span class="token punctuation">)</span>          <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">8123</span>  rt_sigprocmask<span class="token punctuation">(</span>SIG_BLOCK, <span class="token punctuation">[</span>INT CHLD<span class="token punctuation">]</span>, <span class="token punctuation">[</span><span class="token punctuation">]</span>, <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">#clone&#x7236;&#x8FDB;&#x7A0B;</span>
<span class="token number">8123</span>  clone<span class="token punctuation">(</span>child_stack<span class="token operator">=</span>NULL, <span class="token assign-left variable">flags</span><span class="token operator">=</span>CLONE_CHILD_CLEARTID<span class="token operator">|</span>CLONE_CHILD_SETTID<span class="token operator">|</span>SIGCHLD, <span class="token assign-left variable">child_tidptr</span><span class="token operator">=</span>0x7fefa27eda10<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">8124</span>
<span class="token comment">#8123&#x8FDB;&#x5165;wait</span>
<span class="token number">8123</span>  wait4<span class="token punctuation">(</span>-1,  <span class="token operator">&lt;</span>unfinished <span class="token punctuation">..</span>.<span class="token operator">&gt;</span>
<span class="token comment">#&#x7701;&#x7565;&#x5B50;&#x8FDB;&#x7A0B;&#x6302;&#x8F7D;sighandler</span>
<span class="token punctuation">..</span>.
<span class="token comment">#&#x5904;&#x7406;&#x91CD;&#x5B9A;&#x5411;, &#x6253;&#x5F00;testpipe2&#x4E3A;fd3, fd3&#x590D;&#x5236;&#x5230;fd1, &#x968F;&#x5373;close fd3</span>
<span class="token number">8124</span>  openat<span class="token punctuation">(</span>AT_FDCWD, <span class="token string">&quot;testpipe2&quot;</span>, O_WRONLY<span class="token operator">|</span>O_CREAT<span class="token operator">|</span>O_TRUNC, 0666<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span>
<span class="token number">8124</span>  dup2<span class="token punctuation">(</span><span class="token number">3</span>, <span class="token number">1</span><span class="token punctuation">)</span>                        <span class="token operator">=</span> <span class="token number">1</span>
<span class="token number">8124</span>  close<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                          <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">#&#x91CD;&#x5B9A;&#x5411;&#x53D1;&#x751F;&#x5728;exec cat&#x4E4B;&#x524D;, &#x662F;bash&#x505A;&#x7684;&#x5DE5;&#x4F5C;</span>
<span class="token comment">#exec&#x6267;&#x884C;cat, &#x66FF;&#x6362;&#x539F;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;</span>
<span class="token number">8124</span>  execve<span class="token punctuation">(</span><span class="token string">&quot;/bin/cat&quot;</span>, <span class="token punctuation">[</span><span class="token string">&quot;cat&quot;</span>, <span class="token string">&quot;testpipe&quot;</span><span class="token punctuation">]</span>, 0x5600ee4a38f0 /* <span class="token number">26</span> vars */<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">#&#x4EE5;&#x6B64;&#x8C03;&#x7528;brk&#x6269;&#x5C55;&#x5185;&#x5B58;&#x7A7A;&#x95F4;, mmap&#x7B49;, &#x88C5;&#x8F7D;so</span>
<span class="token comment">#&#x6253;&#x5F00;&#x8981;cat&#x7684;&#x6587;&#x4EF6;</span>
<span class="token number">8124</span>  openat<span class="token punctuation">(</span>AT_FDCWD, <span class="token string">&quot;testpipe&quot;</span>, O_RDONLY<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span>
<span class="token comment">#&#x4ECE;fd3(&#x5373;testpipe)&#x8BFB;, &#x5199;&#x5230;fd1</span>
<span class="token number">8124</span>  read<span class="token punctuation">(</span><span class="token number">3</span>, <span class="token string">&quot;5555<span class="token entity" title="\n">\n</span>&quot;</span>, <span class="token number">131072</span><span class="token punctuation">)</span>         <span class="token operator">=</span> <span class="token number">5</span>
<span class="token number">8124</span>  write<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token string">&quot;5555<span class="token entity" title="\n">\n</span>&quot;</span>, <span class="token number">5</span><span class="token punctuation">)</span>             <span class="token operator">=</span> <span class="token number">5</span>
<span class="token comment">#&#x5173;&#x95ED;&#x76F8;&#x5173;fd</span>
<span class="token punctuation">..</span>.
<span class="token number">8124</span>  +++ exited with <span class="token number">0</span> +++
<span class="token comment">#&#x7236;&#x8FDB;&#x7A0B;bash&#x7684;wait4&#x8FD4;&#x56DE;</span>
<span class="token number">8123</span>  <span class="token operator">&lt;</span><span class="token punctuation">..</span>. wait4 resumed<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>WIFEXITED<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> WEXITSTATUS<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">]</span>, <span class="token number">0</span>, NULL<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">8124</span>
<span class="token comment">#&#x7236;&#x8FDB;&#x7A0B;&#x5904;&#x7406;SIGCHLD&#x4FE1;&#x53F7;</span>
<span class="token comment">#&#x518D;&#x6B21;wait4&#x53D1;&#x73B0;&#x6CA1;&#x6709;&#x5B50;&#x8FDB;&#x7A0B;&#x4E86;, &#x7236;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;</span>
<span class="token number">8123</span>  rt_sigaction<span class="token punctuation">(</span>SIGINT, <span class="token punctuation">{</span>sa_handler<span class="token operator">=</span>SIG_DFL, <span class="token assign-left variable">sa_mask</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>, <span class="token assign-left variable">sa_flags</span><span class="token operator">=</span>SA_RESTORER, <span class="token assign-left variable">sa_restorer</span><span class="token operator">=</span>0x7fefa1df5f20<span class="token punctuation">}</span>, <span class="token punctuation">{</span>sa_handler<span class="token operator">=</span>0x5600edd40160, <span class="token assign-left variable">sa_mask</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>, <span class="token assign-left variable">sa_flags</span><span class="token operator">=</span>SA_RESTORER, <span class="token assign-left variable">sa_restorer</span><span class="token operator">=</span>0x7fefa1df5f20<span class="token punctuation">}</span>, <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">8123</span>  rt_sigprocmask<span class="token punctuation">(</span>SIG_SETMASK, <span class="token punctuation">[</span><span class="token punctuation">]</span>, NULL, <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">8123</span>  --- SIGCHLD <span class="token punctuation">{</span>si_signo<span class="token operator">=</span>SIGCHLD, <span class="token assign-left variable">si_code</span><span class="token operator">=</span>CLD_EXITED, <span class="token assign-left variable">si_pid</span><span class="token operator">=</span><span class="token number">8124</span>, <span class="token assign-left variable">si_uid</span><span class="token operator">=</span><span class="token number">1003</span>, <span class="token assign-left variable">si_status</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">si_utime</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">si_stime</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">}</span> ---
<span class="token number">8123</span>  wait4<span class="token punctuation">(</span>-1, 0x7ffd543dca50, WNOHANG, NULL<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token parameter variable">-1</span> ECHILD <span class="token punctuation">(</span>No child processes<span class="token punctuation">)</span>
<span class="token number">8123</span>  +++ exited with <span class="token number">0</span> +++
</code></pre>
<h1 id="&#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;&#x53CA;&#x5176;&#x5F15;&#x7528;-eval&#x7684;&#x4F7F;&#x7528;"><a name="&#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;&#x53CA;&#x5176;&#x5F15;&#x7528;-eval&#x7684;&#x4F7F;&#x7528;" class="anchor-navigation-ex-anchor" href="#&#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;&#x53CA;&#x5176;&#x5F15;&#x7528;-eval&#x7684;&#x4F7F;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>12. &#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;&#x53CA;&#x5176;&#x5F15;&#x7528;: eval&#x7684;&#x4F7F;&#x7528;</h1>
<p>&#x6709;&#x65F6;&#x5019;, &#x6211;&#x4EEC;&#x60F3;&#x6839;&#x636E;&#x67D0;&#x4E9B;&#x6761;&#x4EF6;, &#x6765;&#x751F;&#x6210;&#x4E00;&#x4E2A;shell&#x53D8;&#x91CF;, &#x5176;&#x540D;&#x5B57;&#x53EF;&#x4EE5;&#x662F;&#x7528;&#x6237;&#x8F93;&#x5165;, &#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x4ECE;&#x6587;&#x4EF6;&#x91CC;&#x8BFB;&#x51FA;&#x6765;&#x7684;&#x67D0;&#x4E2A;&#x5B57;&#x6BB5;.
&#x7528;eval&#x53EF;&#x4EE5;&#x505A;&#x5230;</p>
<h2 id="&#x7528;eval&#x751F;&#x6210;&#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;"><a name="&#x7528;eval&#x751F;&#x6210;&#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;" class="anchor-navigation-ex-anchor" href="#&#x7528;eval&#x751F;&#x6210;&#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;"><i class="fa fa-link" aria-hidden="true"></i></a>12.1. &#x7528;eval&#x751F;&#x6210;&#x52A8;&#x6001;&#x53D8;&#x91CF;&#x540D;</h2>
<pre class="language-"><code class="lang-sh"><span class="token comment">#option&#x7684;&#x503C;&#x53EF;&#x4EE5;&#x4ECE;&#x4EFB;&#x4F55;&#x5730;&#x65B9;, &#x6BD4;&#x5982;&#x53D6;&#x81EA;&#x6587;&#x4EF6;&#x540D;</span>
<span class="token assign-left variable">option</span><span class="token operator">=</span>vendor_name
<span class="token comment">#&#x8FD9;&#x4E2A;&#x503C;&#x88AB;eval&#x540E;, &#x6210;&#x4E3A;&#x4E86;&#x65B0;&#x7684;&#x53D8;&#x91CF;&#x540D;. &#x5728;&#x5F53;&#x524D;shell&#x5C31;&#x6709;&#x6548;.</span>
<span class="token builtin class-name">eval</span> <span class="token variable">$option</span><span class="token operator">=</span>my_vendor
<span class="token builtin class-name">echo</span> <span class="token variable">$vendor_name</span>
<span class="token comment">#&#x8F93;&#x51FA;</span>
my_vendor
</code></pre>
<p>&#x6CE8;&#x610F;:</p>
<ul>
<li>&#x4E0D;&#x52A0;eval&#x662F;&#x4E0D;&#x884C;&#x7684;:</li>
</ul>
<pre class="language-"><code class="lang-sh">$ <span class="token variable">$option</span><span class="token operator">=</span>my_vendor
<span class="token assign-left variable">vendor_name</span><span class="token operator">=</span>my_vendor: <span class="token builtin class-name">command</span> not found
</code></pre>
<ul>
<li>eval&#x540E;&#x9762;&#x6709;&#x7A7A;&#x683C;&#x4E0D;&#x884C;, &#x9664;&#x975E;&#x52A0;&#x4E24;&#x5C42;&#x5F15;&#x53F7;, &#x5148;&#x5355;&#x540E;&#x53CC;</li>
</ul>
<pre class="language-"><code class="lang-sh">$ <span class="token builtin class-name">eval</span> <span class="token variable">$option</span><span class="token operator">=</span>my vendor
vendor: <span class="token builtin class-name">command</span> not found

$ <span class="token builtin class-name">eval</span> <span class="token variable">$option</span><span class="token operator">=</span><span class="token string">&apos;my vendor&apos;</span>
vendor: <span class="token builtin class-name">command</span> not found

$ <span class="token builtin class-name">eval</span> <span class="token variable">$option</span><span class="token operator">=</span><span class="token string">&quot;&apos;my vendor&apos;&quot;</span>
byj@byj-envy-notebook ~/tmp/uaes
$ <span class="token builtin class-name">echo</span> <span class="token variable">$vendor_name</span>
my vendor
</code></pre>
<h2 id="&#x95F4;&#x63A5;&#x5F15;&#x7528;&#x53D8;&#x91CF;"><a name="&#x95F4;&#x63A5;&#x5F15;&#x7528;&#x53D8;&#x91CF;" class="anchor-navigation-ex-anchor" href="#&#x95F4;&#x63A5;&#x5F15;&#x7528;&#x53D8;&#x91CF;"><i class="fa fa-link" aria-hidden="true"></i></a>12.2. &#x95F4;&#x63A5;&#x5F15;&#x7528;&#x53D8;&#x91CF;</h2>
<p>&#x53D8;&#x91CF;&#x662F;&#x52A8;&#x6001;&#x751F;&#x6210;&#x7684;&#x65F6;&#x5019;, &#x6211;&#x4EEC;&#x5728;&#x5199;&#x811A;&#x672C;&#x7684;&#x5F53;&#x4E0B;, &#x662F;&#x4E0D;&#x77E5;&#x9053;&#x5177;&#x4F53;&#x7684;&#x53D8;&#x91CF;&#x540D;&#x7684;, &#x5C31;&#x6CA1;&#x529E;&#x6CD5;&#x76F4;&#x63A5;&#x5F15;&#x7528;.
&#x8981;&#x95F4;&#x63A5;&#x5F15;&#x7528;, &#x7528;<code>${!var}</code>&#x7684;&#x683C;&#x5F0F;</p>
<pre class="language-"><code class="lang-sh"><span class="token assign-left variable">dvar</span><span class="token operator">=</span>hello
<span class="token assign-left variable">var</span><span class="token operator">=</span>dvar
<span class="token builtin class-name">echo</span> <span class="token variable">${<span class="token operator">!</span>var}</span>
<span class="token comment">#&#x8F93;&#x51FA;</span>
hello

<span class="token comment">#&#x7528;eval&#x4E5F;&#x884C;, $var&#x5148;&#x88AB;&#x66FF;&#x6362;&#x4E3A;dvar, &#x8F6C;&#x4E49;$&#x518D;&#x4F20;&#x5165;eval</span>
<span class="token builtin class-name">eval</span> <span class="token string">&quot;echo \<span class="token variable">${$var}</span>&quot;</span>
<span class="token comment">#&#x8FD9;&#x6837;&#x5199;&#x4E0D;&#x884C;</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">${$var}</span>
bash: <span class="token variable">${$var}</span><span class="token builtin class-name">:</span> bad substitution
</code></pre>
<h2 id="&#x4E3E;&#x4F8B;-&#x8BFB;&#x51FA;conf&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5230;&#x52A8;&#x6001;&#x6587;&#x4EF6;&#x540D;&#x53D8;&#x91CF;"><a name="&#x4E3E;&#x4F8B;-&#x8BFB;&#x51FA;conf&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5230;&#x52A8;&#x6001;&#x6587;&#x4EF6;&#x540D;&#x53D8;&#x91CF;" class="anchor-navigation-ex-anchor" href="#&#x4E3E;&#x4F8B;-&#x8BFB;&#x51FA;conf&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5230;&#x52A8;&#x6001;&#x6587;&#x4EF6;&#x540D;&#x53D8;&#x91CF;"><i class="fa fa-link" aria-hidden="true"></i></a>12.3. &#x4E3E;&#x4F8B;: &#x8BFB;&#x51FA;*.conf&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5230;&#x52A8;&#x6001;&#x6587;&#x4EF6;&#x540D;&#x53D8;&#x91CF;</h2>
<pre class="language-"><code class="lang-sh"><span class="token keyword">for</span> <span class="token for-or-select variable">f</span> <span class="token keyword">in</span> *.conf<span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token builtin class-name">eval</span> <span class="token variable">${f<span class="token operator">%</span>.conf}</span><span class="token operator">=</span><span class="token string">&apos;`cat $f`&apos;</span><span class="token punctuation">;</span><span class="token keyword">done</span>
</code></pre>
<h2 id="uaes&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;-&#x5173;&#x7CFB;&#x6570;&#x7EC4;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;"><a name="uaes&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;-&#x5173;&#x7CFB;&#x6570;&#x7EC4;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;" class="anchor-navigation-ex-anchor" href="#uaes&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;-&#x5173;&#x7CFB;&#x6570;&#x7EC4;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;"><i class="fa fa-link" aria-hidden="true"></i></a>12.4. uaes&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;, &#x5173;&#x7CFB;&#x6570;&#x7EC4;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;</h2>
<pre class="language-"><code class="lang-sh"><span class="token shebang important">#! /bin/bash</span>
<span class="token function-name function">StartProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> Starting process <span class="token punctuation">[</span><span class="token variable">$1</span><span class="token punctuation">]</span> <span class="token punctuation">..</span>.Done
<span class="token punctuation">}</span>
<span class="token function-name function">StopProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> Stoping process <span class="token punctuation">[</span><span class="token variable">$1</span><span class="token punctuation">]</span> <span class="token punctuation">..</span>.Done
<span class="token punctuation">}</span>
<span class="token function-name function">GetTargetState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">cat</span> msgfifo
<span class="token punctuation">}</span>
<span class="token function-name function">ReportState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token variable">$1</span> <span class="token operator">&gt;</span> rplfifo
<span class="token punctuation">}</span>
<span class="token assign-left variable">stopList</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
<span class="token function-name function">AddToStopList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token assign-left variable">stopList</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$1</span> <span class="token variable">$stopList</span>&quot;</span>
<span class="token punctuation">}</span>
<span class="token function-name function">DoStopList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">p</span> <span class="token keyword">in</span> <span class="token variable">$stopList</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        StopProcess <span class="token variable">$p</span>
    <span class="token keyword">done</span>
    <span class="token assign-left variable">stopList</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>
<span class="token builtin class-name">declare</span> <span class="token parameter variable">-A</span> processes
<span class="token function-name function">SwitchState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">from</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">to</span><span class="token operator">=</span><span class="token variable">$2</span>
    <span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$from</span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">from</span><span class="token operator">=</span>null
        processes<span class="token punctuation">[</span><span class="token variable">$from</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
    <span class="token keyword">elif</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">${processes<span class="token punctuation">[</span>$from<span class="token punctuation">]</span>}</span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        processes<span class="token punctuation">[</span><span class="token variable">$from</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> $<span class="token punctuation">{</span>from<span class="token punctuation">}</span>.conf<span class="token variable">)</span></span>
        <span class="token builtin class-name">echo</span> Loading <span class="token variable">${from}</span>.conf <span class="token punctuation">..</span>.Done
    <span class="token keyword">fi</span>
    <span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">${processes<span class="token punctuation">[</span>$to<span class="token punctuation">]</span>}</span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        processes<span class="token punctuation">[</span><span class="token variable">$to</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> $<span class="token punctuation">{</span>to<span class="token punctuation">}</span>.conf<span class="token variable">)</span></span>
        <span class="token builtin class-name">echo</span> Loading <span class="token variable">${to}</span>.conf <span class="token punctuation">..</span>.Done
    <span class="token keyword">fi</span>
    <span class="token assign-left variable">OLDIFS</span><span class="token operator">=</span><span class="token environment constant">$IFS</span>

    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">$&apos;<span class="token entity" title="\n">\n</span>&apos;</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">p</span> <span class="token keyword">in</span> <span class="token variable">${processes<span class="token punctuation">[</span>$from<span class="token punctuation">]</span>}</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${processes<span class="token punctuation">[</span>$to<span class="token punctuation">]</span>}</span>&quot;</span> <span class="token operator">!=</span> *<span class="token string">&quot;<span class="token variable">$p</span>&quot;</span>* <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token variable">$OLDIFS</span>
            <span class="token comment">#StopProcess $p</span>
            AddToStopList <span class="token variable">$p</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span>
    DoStopList
    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">$&apos;<span class="token entity" title="\n">\n</span>&apos;</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">p</span> <span class="token keyword">in</span> <span class="token variable">${processes<span class="token punctuation">[</span>$to<span class="token punctuation">]</span>}</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${processes<span class="token punctuation">[</span>$from<span class="token punctuation">]</span>}</span>&quot;</span> <span class="token operator">!=</span> *<span class="token string">&quot;<span class="token variable">$p</span>&quot;</span>* <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            StartProcess <span class="token string">&quot;<span class="token variable">$p</span>&quot;</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span>
    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token variable">$OLDIFS</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token operator">!</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-e</span> IDL.conf<span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> Please <span class="token function">add</span> IDL.conf first<span class="token operator">!</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>
SwitchState <span class="token string">&quot;&quot;</span> IDL
<span class="token assign-left variable">current</span><span class="token operator">=</span>IDL
<span class="token builtin class-name">echo</span> Initial state <span class="token variable">$current</span> running <span class="token punctuation">..</span>.
<span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token assign-left variable">target</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>GetTargetState<span class="token variable">)</span></span>
    <span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token string">&quot;<span class="token variable">$target</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;<span class="token variable">$current</span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> Keep state <span class="token variable">$current</span> unchanged
        <span class="token builtin class-name">continue</span>
    <span class="token keyword">fi</span>
    <span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-e</span> <span class="token variable">${target}</span>.conf<span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> Switching state from <span class="token variable">$current</span> to <span class="token variable">$target</span> <span class="token punctuation">..</span>.
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span>
        SwitchState <span class="token variable">$current</span> <span class="token variable">$target</span>
    <span class="token keyword">else</span>
        <span class="token builtin class-name">echo</span> File <span class="token variable">${target}</span>.conf not found<span class="token operator">!</span>
        <span class="token builtin class-name">continue</span>
    <span class="token keyword">fi</span>
    <span class="token assign-left variable">current</span><span class="token operator">=</span><span class="token variable">$target</span>
    ReportState <span class="token variable">$current</span>
    <span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token string">&quot;<span class="token variable">$current</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;DOWN&quot;</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>Shutdown. 
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
    <span class="token builtin class-name">echo</span> Running <span class="token keyword">in</span> state <span class="token variable">$current</span> <span class="token punctuation">..</span>
<span class="token keyword">done</span>
</code></pre>
<h1 id="&#x5224;&#x65AD;&#x5B57;&#x4E32;&#x662F;&#x5426;&#x5305;&#x542B;&#x5B57;&#x4E32;"><a name="&#x5224;&#x65AD;&#x5B57;&#x4E32;&#x662F;&#x5426;&#x5305;&#x542B;&#x5B57;&#x4E32;" class="anchor-navigation-ex-anchor" href="#&#x5224;&#x65AD;&#x5B57;&#x4E32;&#x662F;&#x5426;&#x5305;&#x542B;&#x5B57;&#x4E32;"><i class="fa fa-link" aria-hidden="true"></i></a>13. &#x5224;&#x65AD;&#x5B57;&#x4E32;&#x662F;&#x5426;&#x5305;&#x542B;&#x5B57;&#x4E32;</h1>
<p>&#x5224;&#x65AD;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x5426;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x5B57;&#x4E32;
&#x6CE8;&#x610F;, <strong>&#x4E0D;&#x5E26;&#x901A;&#x914D;&#x7B26;&#x7684;&#x5FC5;&#x987B;&#x5728;&#x5224;&#x65AD;&#x7684;&#x5DE6;&#x8FB9;</strong>; &#x5426;&#x5219;&#x6C38;&#x8FDC;&#x4E3A;false</p>
<pre class="language-"><code class="lang-sh"><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$str</span>&quot;</span> <span class="token operator">==</span> *<span class="token string">&quot;<span class="token variable">$substr</span>&quot;</span>* <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</code></pre>
<h1 id="exec&#x91CD;&#x5B9A;&#x5411;"><a name="exec&#x91CD;&#x5B9A;&#x5411;" class="anchor-navigation-ex-anchor" href="#exec&#x91CD;&#x5B9A;&#x5411;"><i class="fa fa-link" aria-hidden="true"></i></a>14. exec&#x91CD;&#x5B9A;&#x5411;</h1>
<p>&#x5BF9;&#x67D0;&#x4E2A;&#x547D;&#x4EE4;&#x7684;&#x91CD;&#x5B9A;&#x5411;&#x5F88;&#x5E38;&#x89C1;, &#x6BD4;&#x5982;
<code>cat &lt; README</code> : cat&#x4ECE;stdin&#x8BFB;&#x53D6;&#x5B57;&#x7B26;, &#x5E76;&#x663E;&#x793A;&#x5230;stdou&#x4E0A;. &#x8FD9;&#x91CC;&#x7528;README&#x6587;&#x4EF6;&#x91CD;&#x5B9A;&#x5411;&#x5230;stdin
&#x5F53;&#x7136;&#x76F4;&#x63A5;<code>cat README</code>&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x7684;, &#x56E0;&#x4E3A;cat&#x547D;&#x4EE4;&#x540E;&#x9762;&#x5E26;&#x6587;&#x4EF6;&#x540D;, &#x5B83;&#x4F1A;&#x6253;&#x5F00;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4F5C;&#x4E3A;&#x8F93;&#x5165;.&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x5B83;&#x4E0D;&#x4ECE;stdin&#x8BFB;&#x53D6;&#x4E1C;&#x897F;, &#x548C;&#x91CD;&#x5B9A;&#x5411;&#x6CA1;&#x5173;&#x7CFB;.</p>
<p>&#x90A3;&#x8FD9;&#x91CC;&#x8BF4;&#x7684;&#x662F;&#x5BF9;&#x6574;&#x4E2A;&#x811A;&#x672C;&#x91CD;&#x5B9A;&#x5411;. &#x8981;&#x7528;&#x5230;shell&#x7684;&#x5185;&#x7F6E;&#x547D;&#x4EE4;<code>exec</code></p>
<h2 id="&#x5728;shell&#x91CC;&#x76F4;&#x63A5;&#x91CD;&#x5B9A;&#x5411;stdin"><a name="&#x5728;shell&#x91CC;&#x76F4;&#x63A5;&#x91CD;&#x5B9A;&#x5411;stdin" class="anchor-navigation-ex-anchor" href="#&#x5728;shell&#x91CC;&#x76F4;&#x63A5;&#x91CD;&#x5B9A;&#x5411;stdin"><i class="fa fa-link" aria-hidden="true"></i></a>14.1. &#x5728;shell&#x91CC;&#x76F4;&#x63A5;&#x91CD;&#x5B9A;&#x5411;stdin</h2>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x65B0;&#x5EFA;fd6(&#x6216;&#x91CD;&#x65B0;&#x6253;&#x5F00;), &#x590D;&#x5236;fd0&#x7ED9;fd6, &#x7BAD;&#x5934;&#x8868;&#x793A;fd&#x662F;&#x53EA;&#x8BFB;&#x7684;</span>
<span class="token comment">#&#x4E5F;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x6210;Link file descriptor #6 with stdin</span>
<span class="token comment">#&#x8FD9;&#x91CC;&#x7684;&#x610F;&#x601D;&#x662F;, &#x628A;fd0&#x4FDD;&#x5B58;&#x5230;&#x65B0;&#x5EFA;&#x7684;fd6&#x4E2D;. &#x5355;&#x72EC;&#x7528;&#x8FD9;&#x4E2A;&#x6CA1;&#x4EC0;&#x4E48;&#x610F;&#x601D;</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">6</span>&lt;</span><span class="token file-descriptor important">&amp;0</span>

<span class="token comment">#&#x4ECE;&#x8FD9;&#x91CC;&#x5F00;&#x59CB;, stdin&#x5C31;&#x662F;data-file&#x4E86;</span>
<span class="token builtin class-name">exec</span> <span class="token operator">&lt;</span> data-file

<span class="token comment">#&#x4ECE;data-file&#x91CC;&#x8BFB;&#x4E24;&#x884C;, &#x8D4B;&#x503C;&#x7ED9;a1 a2</span>
<span class="token builtin class-name">read</span> a1
<span class="token builtin class-name">read</span> a2

<span class="token comment">#&#x628A;fd6&#x8D4B;&#x503C;&#x7ED9;fd0. &#x5373;&#x8FD8;&#x539F;fd0, &#x8BA9;&#x5B83;&#x8FD8;&#x539F;&#x4E3A;stdin</span>
<span class="token comment">#6&lt;&amp;-&#x7684;&#x610F;&#x601D;&#x662F;&#x628A;&#x7A7A;fd&#x8D4B;&#x503C;&#x7ED9;fd6, &#x5373;&#x5173;&#x95ED;fd6</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span><span class="token file-descriptor important">&amp;6</span> <span class="token operator"><span class="token file-descriptor important">6</span>&lt;&amp;</span>-&#x7684;&#x610F;&#x601D;&#x662F;&#x628A;&#x7A7A;fd&#x8D4B;&#x503C;&#x7ED9;fd6, &#x5373;&#x5173;&#x95ED;fd6
</code></pre>
<p>&#x5B8C;&#x6574;&#x4F8B;&#x5B50;</p>
<pre class="language-"><code class="lang-sh"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># Redirecting stdin using &apos;exec&apos;.</span>

<span class="token comment">#&#x65B0;&#x5EFA;fd6(&#x6216;&#x91CD;&#x65B0;&#x6253;&#x5F00;), &#x590D;&#x5236;fd0&#x7ED9;fd6, &#x7BAD;&#x5934;&#x8868;&#x793A;fd&#x662F;&#x53EA;&#x8BFB;&#x7684;</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">6</span>&lt;</span><span class="token file-descriptor important">&amp;0</span>          <span class="token comment"># Link file descriptor #6 with stdin.</span>
                   <span class="token comment"># Saves stdin.</span>

<span class="token builtin class-name">exec</span> <span class="token operator">&lt;</span> data-file   <span class="token comment"># stdin replaced by file &quot;data-file&quot;</span>

<span class="token builtin class-name">read</span> a1            <span class="token comment"># Reads first line of file &quot;data-file&quot;.</span>
<span class="token builtin class-name">read</span> a2            <span class="token comment"># Reads second line of file &quot;data-file.&quot;</span>

<span class="token builtin class-name">echo</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Following lines read from file.&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;-------------------------------&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$a1</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$a2</span>

<span class="token builtin class-name">echo</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span>

<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span><span class="token file-descriptor important">&amp;6</span> <span class="token operator"><span class="token file-descriptor important">6</span>&lt;&amp;</span>-
<span class="token comment">#  Now restore stdin from fd #6, where it had been saved,</span>
<span class="token comment">#+ and close fd #6 ( 6&lt;&amp;- ) to free it for other processes to use.</span>
<span class="token comment">#</span>
<span class="token comment"># &lt;&amp;6 6&lt;&amp;-    also works.</span>

<span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;Enter data  &quot;</span>
<span class="token builtin class-name">read</span> b1  <span class="token comment"># Now &quot;read&quot; functions as expected, reading from normal stdin.</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Input read from stdin.&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;----------------------&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;b1 = <span class="token variable">$b1</span>&quot;</span>

<span class="token builtin class-name">echo</span>

<span class="token builtin class-name">exit</span> <span class="token number">0</span>
</code></pre>
<h2 id="&#x91CD;&#x5B9A;&#x5411;&#x6574;&#x4E2A;shell&#x7684;stdout"><a name="&#x91CD;&#x5B9A;&#x5411;&#x6574;&#x4E2A;shell&#x7684;stdout" class="anchor-navigation-ex-anchor" href="#&#x91CD;&#x5B9A;&#x5411;&#x6574;&#x4E2A;shell&#x7684;stdout"><i class="fa fa-link" aria-hidden="true"></i></a>14.2. &#x91CD;&#x5B9A;&#x5411;&#x6574;&#x4E2A;shell&#x7684;stdout</h2>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x65B0;&#x5EFA;fd6(&#x6216;&#x91CD;&#x65B0;&#x6253;&#x5F00;), &#x590D;&#x5236;fd1&#x7ED9;fd6, &#x7BAD;&#x5934;&#x8868;&#x793A;fd&#x662F;&#x53EA;&#x5199;. &#x5E76;&#x4E0D;&#x662F;&#x628A;6&#x8D4B;&#x503C;&#x7ED9;1</span>
<span class="token comment">#&#x8FD9;&#x91CC;&#x7684;&#x610F;&#x601D;&#x662F;&#x4FDD;&#x5B58;fd1&#x5230;fd6, &#x5373;&#x4FDD;&#x5B58;&#x539F;&#x59CB;&#x7684;stdout</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>

<span class="token comment">#&#x4ECE;&#x8FD9;&#x91CC;&#x5F00;&#x59CB;, &#x8F93;&#x51FA;&#x53D8;&#x4E3A;logfile.txt</span>
<span class="token builtin class-name">exec</span> <span class="token operator">&gt;</span> logfile.txt
<span class="token comment">#&#x8F93;&#x51FA;</span>
<span class="token builtin class-name">echo</span> xxx
<span class="token punctuation">..</span>.

<span class="token comment">#&#x4ECE;fd6&#x8FD8;&#x539F;fd1, &#x5373;&#x8FD8;&#x539F;&#x539F;&#x59CB;&#x7684;stdout.</span>
<span class="token comment">#&#x5E76;&#x5173;&#x95ED;fd6</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token file-descriptor important">&amp;6</span> <span class="token operator"><span class="token file-descriptor important">6</span>&gt;&amp;</span>-
</code></pre>
<p>&#x5B8C;&#x6574;&#x4F8B;&#x5B50;</p>
<pre class="language-"><code class="lang-sh"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># reassign-stdout.sh</span>

<span class="token assign-left variable">LOGFILE</span><span class="token operator">=</span>logfile.txt

<span class="token comment"># &#x65B0;&#x5EFA;fd6(&#x6216;&#x91CD;&#x65B0;&#x6253;&#x5F00;), &#x590D;&#x5236;fd1&#x7ED9;fd6, &#x7BAD;&#x5934;&#x8868;&#x793A;fd&#x662F;&#x53EA;&#x5199;. &#x5E76;&#x4E0D;&#x662F;&#x628A;6&#x8D4B;&#x503C;&#x7ED9;1</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>           <span class="token comment"># Link file descriptor #6 with stdout.</span>
                    <span class="token comment"># Saves stdout.</span>

<span class="token builtin class-name">exec</span> <span class="token operator">&gt;</span> <span class="token variable">$LOGFILE</span>     <span class="token comment"># stdout replaced with file &quot;logfile.txt&quot;.</span>

<span class="token comment"># ----------------------------------------------------------- #</span>
<span class="token comment"># All output from commands in this block sent to file $LOGFILE.</span>

<span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;Logfile: &quot;</span>
<span class="token function">date</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;-------------------------------------&quot;</span>
<span class="token builtin class-name">echo</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;Output of <span class="token entity" title="\&quot;">\&quot;</span>ls -al<span class="token entity" title="\&quot;">\&quot;</span> command&quot;</span>
<span class="token builtin class-name">echo</span>
<span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token builtin class-name">echo</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Output of <span class="token entity" title="\&quot;">\&quot;</span>df<span class="token entity" title="\&quot;">\&quot;</span> command&quot;</span>
<span class="token builtin class-name">echo</span>
<span class="token function">df</span>

<span class="token comment"># ----------------------------------------------------------- #</span>

<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token file-descriptor important">&amp;6</span> <span class="token operator"><span class="token file-descriptor important">6</span>&gt;&amp;</span>-      <span class="token comment"># Restore stdout and close file descriptor #6.</span>

<span class="token builtin class-name">echo</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;== stdout now restored to default == &quot;</span>
<span class="token builtin class-name">echo</span>
<span class="token function">ls</span> <span class="token parameter variable">-al</span>
<span class="token builtin class-name">echo</span>

<span class="token builtin class-name">exit</span> <span class="token number">0</span>
</code></pre>
<h2 id="&#x8F93;&#x5165;&#x548C;&#x8F93;&#x51FA;&#x7684;&#x4F8B;&#x5B50;"><a name="&#x8F93;&#x5165;&#x548C;&#x8F93;&#x51FA;&#x7684;&#x4F8B;&#x5B50;" class="anchor-navigation-ex-anchor" href="#&#x8F93;&#x5165;&#x548C;&#x8F93;&#x51FA;&#x7684;&#x4F8B;&#x5B50;"><i class="fa fa-link" aria-hidden="true"></i></a>14.3. &#x8F93;&#x5165;&#x548C;&#x8F93;&#x51FA;&#x7684;&#x4F8B;&#x5B50;</h2>
<pre class="language-"><code class="lang-sh"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># upperconv.sh</span>
<span class="token comment"># Converts a specified input file to uppercase.</span>

<span class="token assign-left variable">E_FILE_ACCESS</span><span class="token operator">=</span><span class="token number">70</span>
<span class="token assign-left variable">E_WRONG_ARGS</span><span class="token operator">=</span><span class="token number">71</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-r</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token punctuation">]</span>     <span class="token comment"># Is specified input file readable?</span>
<span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Can&apos;t read from input file!&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Usage: <span class="token variable">$0</span> input-file output-file&quot;</span>
  <span class="token builtin class-name">exit</span> <span class="token variable">$E_FILE_ACCESS</span>
<span class="token keyword">fi</span>                   <span class="token comment">#  Will exit with same error</span>
                     <span class="token comment">#+ even if input file ($1) not specified (why?).</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$2</span>&quot;</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Need to specify output file.&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Usage: <span class="token variable">$0</span> input-file output-file&quot;</span>
  <span class="token builtin class-name">exit</span> <span class="token variable">$E_WRONG_ARGS</span>
<span class="token keyword">fi</span>


<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">4</span>&lt;</span><span class="token file-descriptor important">&amp;0</span>
<span class="token builtin class-name">exec</span> <span class="token operator">&lt;</span> <span class="token variable">$1</span>            <span class="token comment"># Will read from input file.</span>

<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">7</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
<span class="token builtin class-name">exec</span> <span class="token operator">&gt;</span> <span class="token variable">$2</span>            <span class="token comment"># Will write to output file.</span>
                     <span class="token comment"># Assumes output file writable (add check?).</span>

<span class="token comment"># -----------------------------------------------</span>
    <span class="token function">cat</span> - <span class="token operator">|</span> <span class="token function">tr</span> a-z A-Z   <span class="token comment"># Uppercase conversion.</span>
<span class="token comment">#   ^^^^^                # Reads from stdin.</span>
<span class="token comment">#           ^^^^^^^^^^   # Writes to stdout.</span>
<span class="token comment"># However, both stdin and stdout were redirected.</span>
<span class="token comment"># Note that the &apos;cat&apos; can be omitted.</span>
<span class="token comment"># -----------------------------------------------</span>

<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token file-descriptor important">&amp;7</span> <span class="token operator"><span class="token file-descriptor important">7</span>&gt;&amp;</span>-       <span class="token comment"># Restore stout.</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span><span class="token file-descriptor important">&amp;4</span> <span class="token operator"><span class="token file-descriptor important">4</span>&lt;&amp;</span>-       <span class="token comment"># Restore stdin.</span>

<span class="token comment"># After restoration, the following line prints to stdout as expected.</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;File <span class="token entity" title="\&quot;">\&quot;</span><span class="token variable">$1</span><span class="token entity" title="\&quot;">\&quot;</span> written to <span class="token entity" title="\&quot;">\&quot;</span><span class="token variable">$2</span><span class="token entity" title="\&quot;">\&quot;</span> as uppercase conversion.&quot;</span>

<span class="token builtin class-name">exit</span> <span class="token number">0</span>
</code></pre>
<h2 id="crosstool-ng&#x7684;&#x4F8B;&#x5B50;"><a name="crosstool-ng&#x7684;&#x4F8B;&#x5B50;" class="anchor-navigation-ex-anchor" href="#crosstool-ng&#x7684;&#x4F8B;&#x5B50;"><i class="fa fa-link" aria-hidden="true"></i></a>14.4. crosstool ng&#x7684;&#x4F8B;&#x5B50;</h2>
<pre class="language-"><code class="lang-sh"><span class="token comment"># Log policy:</span>
<span class="token comment">#  - first of all, save stdout so we can see the live logs: fd #6</span>
<span class="token comment">#    (also save stdin and stderr for use by CT_DEBUG_INTERACTIVE)</span>
<span class="token comment">#    FIXME: it doesn&apos;t look like anyone is overriding stdin/stderr. Do we need</span>
<span class="token comment">#    to save/restore them?</span>
<span class="token function-name function">CT_LogEnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">local</span> <span class="token assign-left variable">clean</span><span class="token operator">=</span>no
        <span class="token builtin class-name">local</span> arg

        <span class="token keyword">for</span> <span class="token for-or-select variable">arg</span> <span class="token keyword">in</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">eval</span> <span class="token string">&quot;<span class="token variable">$arg</span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">done</span>
        <span class="token comment">#&#x590D;&#x5236;1&#x5230;6, 2&#x5230;7, 0&#x5230;8&#xFF1B;&#x7BAD;&#x5934;&#x53EA;&#x8868;&#x793A;&#x8F93;&#x5165;&#x8FD8;&#x662F;&#x8F93;&#x51FA;</span>
        <span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator"><span class="token file-descriptor important">7</span>&gt;</span><span class="token file-descriptor important">&amp;2</span> <span class="token operator"><span class="token file-descriptor important">8</span>&lt;</span><span class="token file-descriptor important">&amp;0</span>
        <span class="token assign-left variable">CT_BUILD_LOG</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${CT_TOP_DIR}</span>/build.log&quot;</span>
        <span class="token assign-left variable">CT_LOG_ENABLED</span><span class="token operator">=</span>y
     <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$clean</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;yes&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token string">&quot;<span class="token variable">${CT_BUILD_LOG}</span>&quot;</span>
        <span class="token keyword">fi</span>
        <span class="token builtin class-name">exec</span> <span class="token operator">&gt;&gt;</span><span class="token string">&quot;<span class="token variable">${CT_BUILD_LOG}</span>&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># Restore original stdout, stderr and stdin</span>
<span class="token function-name function">CT_LogDisable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">exec</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;6</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;7</span> <span class="token operator">&lt;</span><span class="token file-descriptor important">&amp;8</span>
        <span class="token assign-left variable">CT_LOG_ENABLED</span><span class="token operator">=</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x8865;&#x5145;-test&#x53EF;&#x4EE5;&#x68C0;&#x6D4B;fd&#x662F;&#x5426;&#x662F;terminal"><a name="&#x8865;&#x5145;-test&#x53EF;&#x4EE5;&#x68C0;&#x6D4B;fd&#x662F;&#x5426;&#x662F;terminal" class="anchor-navigation-ex-anchor" href="#&#x8865;&#x5145;-test&#x53EF;&#x4EE5;&#x68C0;&#x6D4B;fd&#x662F;&#x5426;&#x662F;terminal"><i class="fa fa-link" aria-hidden="true"></i></a>14.5. &#x8865;&#x5145;: test&#x53EF;&#x4EE5;&#x68C0;&#x6D4B;FD&#x662F;&#x5426;&#x662F;terminal</h2>
<pre class="language-"><code>test -t FD 
-t FD          True if FD is opened on a terminal.
</code></pre><h1 id="shell&#x8BFB;&#x5199;socket"><a name="shell&#x8BFB;&#x5199;socket" class="anchor-navigation-ex-anchor" href="#shell&#x8BFB;&#x5199;socket"><i class="fa fa-link" aria-hidden="true"></i></a>15. shell&#x8BFB;&#x5199;socket</h1>
<p>&#x7528;nc&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x7684;&#x8BFB;&#x5199;socket
&#x5176;&#x5B9E;shell&#x8FD8;&#x6709;&#x66F4;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x6CD5;:
&#x5728;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;&#x91CC;, &#x7528;nc&#x76D1;&#x542C;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;
<code>nc -l 1985</code></p>
<p>&#x5728;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;&#x91CC;</p>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x7528;socket&#x505A;&#x6587;&#x4EF6;fd 3</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">3</span>&lt;&gt;</span>/dev/tcp/localhost/1985
<span class="token comment">#&#x8BFB;</span>
<span class="token builtin class-name">echo</span> <span class="token number">111</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;3</span>
<span class="token comment">#&#x5199;</span>
<span class="token function">cat</span> <span class="token operator">&lt;</span><span class="token file-descriptor important">&amp;3</span>
</code></pre>
<p><img src="img/shell_&#x9AD8;&#x7EA7;&#x7BC7;_20220915234532.png" alt="">  </p>
<h2 id="&#x66F4;&#x7B80;&#x5355;&#x7684;&#x5199;&#x6CD5;"><a name="&#x66F4;&#x7B80;&#x5355;&#x7684;&#x5199;&#x6CD5;" class="anchor-navigation-ex-anchor" href="#&#x66F4;&#x7B80;&#x5355;&#x7684;&#x5199;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a>15.1. &#x66F4;&#x7B80;&#x5355;&#x7684;&#x5199;&#x6CD5;</h2>
<p>&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;&#x91CC;
<code>echo 111 &gt; /dev/tcp/localhost/1985</code>
&#x76F4;&#x63A5;&#x5C31;&#x53EF;&#x4EE5;&#x53D1;&#x9001;. &#x4F46;&#x524D;&#x63D0;&#x662F;1985&#x7AEF;&#x53E3;&#x6709;&#x4EBA;&#x76D1;&#x542C;.
&#x5982;&#x679C;&#x5BF9;&#x7AEF;&#x6CA1;&#x6709;&#x76D1;&#x542C;, &#x4F1A;&#x51FA;&#x73B0;<code>Connection refused</code></p>
<h2 id="devtcp&#x662F;shell&#x5185;&#x5EFA;&#x7684;&#x8BBE;&#x5907;&#x8282;&#x70B9;"><a name="devtcp&#x662F;shell&#x5185;&#x5EFA;&#x7684;&#x8BBE;&#x5907;&#x8282;&#x70B9;" class="anchor-navigation-ex-anchor" href="#devtcp&#x662F;shell&#x5185;&#x5EFA;&#x7684;&#x8BBE;&#x5907;&#x8282;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>15.2. /dev/tcp&#x662F;shell&#x5185;&#x5EFA;&#x7684;&#x8BBE;&#x5907;&#x8282;&#x70B9;</h2>
<p>&#x8FD9;&#x4E2A;&#x8282;&#x70B9;&#x5728;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x91CC;&#x662F;&#x6CA1;&#x6709;&#x7684;. &#x8FD9;&#x662F;shell&#x63D0;&#x4F9B;&#x7684;&#x8BBF;&#x95EE;socket&#x7684;&#x65B9;&#x6CD5;.</p>
<h1 id="shell&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;"><a name="shell&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;" class="anchor-navigation-ex-anchor" href="#shell&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;"><i class="fa fa-link" aria-hidden="true"></i></a>16. shell&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;</h1>
<p>&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x7528;&#x7684;&#x7BA1;&#x9053;&#x5C31;&#x662F;shell&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;&#x7684;&#x4E00;&#x79CD;:
&#x6BD4;&#x5982;<code>ls | grep txt</code>
&#x8FD9;&#x662F;&#x533F;&#x540D;&#x7BA1;&#x9053;.</p>
<p>&#x8FD8;&#x6709;&#x6709;&#x540D;&#x7BA1;&#x9053;, shell&#x7684;mkfifo&#x547D;&#x4EE4;&#x5C31;&#x80FD;&#x521B;&#x5EFA;&#x4E2A;&#x6709;&#x540D;&#x7BA1;&#x9053;
<code>mkfifo pipe2</code>
&#x4F1A;&#x5728;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7BA1;&#x9053;&#x6587;&#x4EF6;</p>
<pre class="language-"><code class="lang-sh">Linux Mint <span class="token number">19.1</span> Tessa $ ll pipe2
<span class="token comment">#&#x7BA1;&#x9053;&#x6587;&#x4EF6;&#x4EE5;p&#x5F00;&#x5934;</span>
prw-rw-r-- <span class="token number">1</span> yingjieb yingjieb <span class="token number">0</span> Oct <span class="token number">12</span> <span class="token number">14</span>:31 pipe2
</code></pre>
<p>&#x4EE5;&#x540E;&#x4E24;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x8FDB;&#x7A0B;&#x5C31;&#x53EF;&#x4EE5;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x901A;&#x4FE1;&#x4E86;.
<code>ls &gt; pipe2</code></p>
<p>&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;&#x91CC;
<code>cat &lt; pipe2</code></p>
<p>&#x6CE8;: &#x5355;&#x72EC;&#x8BFB;&#x5199;&#x8FD9;&#x4E2A;&#x7BA1;&#x9053;&#x4F1A;&#x963B;&#x585E;&#x8FDB;&#x7A0B;. &#x6BD4;&#x5982;<code>echo abcd &gt; pipe2</code>&#x5982;&#x679C;&#x6CA1;&#x4EBA;&#x8BFB;&#x7684;&#x8BDD;, &#x4F1A;&#x963B;&#x585E;. &#x8BFB;&#x4E00;&#x4E2A;&#x7A7A;&#x7684;pipe&#x4E5F;&#x4F1A;&#x963B;&#x585E;.</p>
<h2 id="&#x6709;&#x540D;&#x7BA1;&#x9053;&#x548C;nc"><a name="&#x6709;&#x540D;&#x7BA1;&#x9053;&#x548C;nc" class="anchor-navigation-ex-anchor" href="#&#x6709;&#x540D;&#x7BA1;&#x9053;&#x548C;nc"><i class="fa fa-link" aria-hidden="true"></i></a>16.1. &#x6709;&#x540D;&#x7BA1;&#x9053;&#x548C;nc</h2>
<p><img src="img/shell_&#x9AD8;&#x7EA7;&#x7BC7;_20220915234625.png" alt=""><br>&#x4E0A;&#x9762;&#x7684;&#x56FE;&#x7247;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x8FDC;&#x7A0B;&#x767B;&#x9646;shell&#x7684;&#x670D;&#x52A1;<br>&#x5728;&#x670D;&#x52A1;&#x7AEF;:<br><code>cat pipe2 | /bin/sh -i 2&gt;&amp;1 | nc -l 1985 &gt; pipe2</code></p>
<p>&#x5728;client&#x7AEF;:<br><code>nc localhost 1985</code></p>
<p>&#x89E3;&#x91CA;:</p>
<ul>
<li><p>&#x670D;&#x52A1;&#x7AEF;&#x8D77;&#x4E86;&#x4E09;&#x4E2A;&#x8FDB;&#x7A0B;, &#x8FD9;&#x4E09;&#x4E2A;&#x8FDB;&#x7A0B;&#x662F;&#x72EC;&#x7ACB;&#x7684;, &#x5E76;&#x4E0D;&#x5B58;&#x5728;&#x5148;&#x540E;&#x987A;&#x5E8F;.
<code>cat pipe2</code>&#x7684;&#x4F5C;&#x7528;&#x662F;, &#x5982;&#x679C;&#x6709;&#x540D;&#x7BA1;&#x9053;pipe2&#x6709;&#x4E1C;&#x897F;, &#x5219;&#x8F93;&#x51FA;&#x5230;stdout; &#x5982;&#x679C;&#x6CA1;&#x6709;&#x5219;&#x963B;&#x585E;&#x5728;read
<code>/bin/sh -i 2&gt;&amp;1</code>&#x4ECE;stdin&#x8BFB;&#x6570;&#x636E;, &#x4E5F;&#x5C31;&#x662F;&#x524D;&#x9762;<code>cat pipe2</code>&#x7684;&#x8F93;&#x51FA;, &#x7136;&#x540E;&#x505A;shell&#x4EA4;&#x4E92;, &#x8F93;&#x51FA;&#x5230;stdout
<code>nc -l 1985 &gt; pipe2</code>&#x4ECE;stdin&#x8BFB;&#x6570;&#x636E;, &#x4E5F;&#x5C31;&#x662F;&#x524D;&#x9762;sh&#x7684;&#x8F93;&#x51FA;, &#x518D;&#x91CD;&#x5B9A;&#x5411;&#x5230;pipe2; &#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x4E0D;&#x662F;&#x7BA1;&#x9053;&#x5230;pipe2
&#x91CD;&#x5B9A;&#x5411;&#x5230;pipe2&#x662F;&#x5199;, &#x5199;&#x4E86;pipe&#x5C31;&#x6709;&#x4E1C;&#x897F;&#x4E86;, <code>cat pipe2</code>&#x5C31;&#x80FD;&#x8BFB;&#x5230;&#x6570;&#x636E;&#x4E86;. &#x8FD9;&#x662F;&#x4E2A;&quot;&#x4E4C;&#x6D1B;&#x6CE2;&#x6D1B;&#x65AF;&quot;&#x86C7;, &#x5934;&#x5C3E;&#x76F8;&#x8FDE;, &#x65E0;&#x9650;&#x5FAA;&#x73AF;.</p>
</li>
<li><p><code>nc -l 1985</code>&#x5EFA;&#x7ACB;&#x4E86;&#x53CC;&#x5411;&#x7684;tcp&#x8FDE;&#x63A5;, client&#x7684;&#x8F93;&#x5165;, &#x4F1A;&#x88AB;nc&#x63A5;&#x6536;&#x91CD;&#x5B9A;&#x5411;&#x5230;pipe2.
<code>/bin/sh</code>&#x7684;&#x8F93;&#x51FA;, &#x4F1A;&#x88AB;nc&#x901A;&#x8FC7;tcp&#x8FDE;&#x63A5;, &#x5728;client&#x7AEF;&#x663E;&#x793A;.</p>
</li>
<li><p>nc&#x9ED8;&#x8BA4;&#x7528;tcp, &#x7528;&#x9009;&#x9879;<code>-u</code>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;udp. <code>-u</code>&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x91CC;&#x6548;&#x679C;&#x662F;&#x4E00;&#x6837;&#x7684;.</p>
</li>
</ul>
<h1 id="shell&#x68C0;&#x67E5;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;include&#x4E86;"><a name="shell&#x68C0;&#x67E5;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;include&#x4E86;" class="anchor-navigation-ex-anchor" href="#shell&#x68C0;&#x67E5;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;include&#x4E86;"><i class="fa fa-link" aria-hidden="true"></i></a>17. shell&#x68C0;&#x67E5;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;include&#x4E86;</h1>
<p>&#x7528;type&#x547D;&#x4EE4;</p>
<pre class="language-"><code class="lang-sh">$ <span class="token builtin class-name">type</span> <span class="token builtin class-name">echo</span>
<span class="token builtin class-name">echo</span> is a shell <span class="token builtin class-name">builtin</span>
$ <span class="token builtin class-name">type</span> <span class="token function">find</span>
<span class="token function">find</span> is /usr/bin/find

<span class="token comment"># -t&#x8F93;&#x51FA;&#x7C7B;&#x578B;, &#x53EF;&#x4EE5;&#x662F;`alias&apos;, `keyword&apos;,`function&apos;, `builtin&apos;, `file&apos; or `&apos;</span>
$ <span class="token builtin class-name">type</span> <span class="token parameter variable">-t</span> <span class="token function">find</span>
<span class="token function">file</span>
$ <span class="token builtin class-name">type</span> <span class="token parameter variable">-t</span> <span class="token builtin class-name">echo</span>
<span class="token builtin class-name">builtin</span>
</code></pre>
<p>&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x7528;type&#x547D;&#x4EE4;&#x6765;&#x770B;, &#x6BD4;&#x5982;&#x4E00;&#x4E2A;shell&#x51FD;&#x6570;&#x5728;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x91CC;&#x5B9A;&#x4E49;, &#x60F3;&#x770B;&#x770B;&#x662F;&#x5426;&#x5B83;&#x5DF2;&#x7ECF;&#x88AB;&#x5305;&#x542B;&#x4E86;.</p>
<pre class="language-"><code class="lang-sh"><span class="token builtin class-name">type</span> <span class="token parameter variable">-t</span> source_once <span class="token operator">&gt;</span>/dev/null <span class="token operator">||</span> <span class="token builtin class-name">.</span> /isam/scripts/prepare_script_env.sh
</code></pre>
<h1 id="sed"><a name="sed" class="anchor-navigation-ex-anchor" href="#sed"><i class="fa fa-link" aria-hidden="true"></i></a>18. sed</h1>
<p>sed&#x7684;&#x903B;&#x8F91;&#x548C;awk&#x4E00;&#x6837;, &#x4E5F;&#x662F;&#x6309;&#x884C;&#x5904;&#x7406;&#x7684;, &#x88AB;&#x5904;&#x7406;&#x7684;&#x90A3;&#x4E00;&#x884C;&#x53EB;&#x505A;pattern&#x7A7A;&#x95F4;; &#x800C;&#x4E14;, sed&#x4E5F;&#x6709;&#x884C;&#x5339;&#x914D;&#x529F;&#x80FD;.
&#x57FA;&#x672C;&#x7684;&#x547D;&#x4EE4;&#x683C;&#x5F0F;&#x662F;:
<code>sed -r -n -e &apos;&#x884C;&#x5B9A;&#x5740;/{&#x547D;&#x4EE4;1;&#x547D;&#x4EE4;2}&apos; file</code>
&#x5176;&#x4E2D;:</p>
<pre class="language-"><code class="lang-sh">-E, -r, --regexp-extended &#x4F7F;&#x7528;&#x6269;&#x5C55;&#x6B63;&#x5219;
-n, --quiet, <span class="token parameter variable">--silent</span> &#x4E0D;&#x81EA;&#x52A8;&#x6253;&#x5370;pattern&#x7A7A;&#x95F4;. &#x9ED8;&#x8BA4;&#x6BCF;&#x884C;&#x90FD;&#x6253;&#x5370;, &#x5373;&#x4F7F;&#x4E0D;&#x5339;&#x914D;&#x7684;&#x884C;&#x4E5F;&#x6253;&#x5370;<span class="token punctuation">;</span> &#x533A;&#x522B;&#x662F;&#x5339;&#x914D;&#x5230;&#x7684;&#x884C;, &#x6267;&#x884C;&#x4E86;&#x547D;&#x4EE4;&#x624D;&#x6253;&#x5370;.
</code></pre>
<p>&#x884C;&#x5B9A;&#x5740;&#x89C1;&#x4E0B;&#x6587;.
&#x547D;&#x4EE4;&#x4E24;&#x4FA7;&#x7684;&#x5927;&#x62EC;&#x53F7;<code>{}</code>&#x53EF;&#x4EE5;&#x7701;&#x7565;</p>
<h2 id="&#x5411;sed&#x4F20;&#x9012;&#x53D8;&#x91CF;"><a name="&#x5411;sed&#x4F20;&#x9012;&#x53D8;&#x91CF;" class="anchor-navigation-ex-anchor" href="#&#x5411;sed&#x4F20;&#x9012;&#x53D8;&#x91CF;"><i class="fa fa-link" aria-hidden="true"></i></a>18.1. &#x5411;sed&#x4F20;&#x9012;&#x53D8;&#x91CF;</h2>
<p>&#x7528;&#x53CC;&#x62EC;&#x53F7;&#x5C31;&#x884C;:</p>
<pre class="language-"><code class="lang-sh"><span class="token assign-left variable">instacne</span><span class="token operator">=</span>yingjieb_devtool_vscode
<span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;/<span class="token variable">$instacne</span> /d&quot;</span> <span class="token builtin class-name">test</span>
</code></pre>
<h2 id="sed&#x4F7F;&#x7528;&#x8BB0;&#x5F55;"><a name="sed&#x4F7F;&#x7528;&#x8BB0;&#x5F55;" class="anchor-navigation-ex-anchor" href="#sed&#x4F7F;&#x7528;&#x8BB0;&#x5F55;"><i class="fa fa-link" aria-hidden="true"></i></a>18.2. sed&#x4F7F;&#x7528;&#x8BB0;&#x5F55;</h2>
<pre class="language-"><code class="lang-sh"><span class="token comment"># &#x4F7F;&#x7528;grep&#x5148;&#x6B63;&#x5219;&#x5339;&#x914D;, &#x7136;&#x540E;&#x7528;sed&#x5220;&#x9664;&#x5339;&#x914D;&#x5230;&#x7684;&#x5B57;&#x7B26;&#x4E32;(&#x5373;&#x7528;&#x7A7A;&#x4E32;&#x66FF;&#x6362;)</span>
bzcat build.log.bz2 <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">&apos;\[DEBUG\][[:space:]]*(# )?CT_&apos;</span> <span class="token operator">|</span> <span class="token function">sed</span> s<span class="token string">&apos;/\[DEBUG\]    //&apos;</span>
</code></pre>
<h2 id="sed&#x547D;&#x4EE4;"><a name="sed&#x547D;&#x4EE4;" class="anchor-navigation-ex-anchor" href="#sed&#x547D;&#x4EE4;"><i class="fa fa-link" aria-hidden="true"></i></a>18.3. sed&#x547D;&#x4EE4;</h2>
<p>sed&#x547D;&#x4EE4;&#x7684;&#x5BF9;&#x8C61;&#x662F;&#x5F53;&#x524D;&#x7684;pattern&#x7A7A;&#x95F4;, &#x5927;&#x90E8;&#x5206;&#x60C5;&#x51B5;&#x662F;&#x6B63;&#x5728;&#x5904;&#x7406;&#x7684;&#x90A3;&#x884C;.
sed&#x547D;&#x4EE4;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6307;&#x5B9A;address, &#x5C31;&#x4F1A;&#x5BF9;&#x6240;&#x6709;&#x884C;&#x64CD;&#x4F5C;.
&#x5982;&#x679C;&#x6709;&#x6307;&#x5B9A;address&#x533A;&#x95F4;, &#x5BF9;&#x533A;&#x95F4;&#x5185;&#x7684;&#x6240;&#x6709;&#x884C;&#x64CD;&#x4F5C;.</p>
<pre class="language-"><code class="lang-sh">       Sed commands can be given with no addresses, <span class="token keyword">in</span> <span class="token function">which</span> <span class="token keyword">case</span> the <span class="token builtin class-name">command</span> will be executed <span class="token keyword">for</span> all input lines<span class="token punctuation">;</span> with one address, <span class="token keyword">in</span> <span class="token function">which</span> <span class="token keyword">case</span> the <span class="token builtin class-name">command</span> will only be  executed
       <span class="token keyword">for</span> input lines <span class="token function">which</span> match that address<span class="token punctuation">;</span> or with two addresses, <span class="token keyword">in</span> <span class="token function">which</span> <span class="token keyword">case</span> the <span class="token builtin class-name">command</span> will be executed <span class="token keyword">for</span> all input lines <span class="token function">which</span> match the inclusive range of lines start&#x2010;
       ing from the first address and continuing to the second address.
</code></pre>
<pre class="language-"><code class="lang-sh"><span class="token number">0</span>&#x5730;&#x5740;&#x547D;&#x4EE4;
<span class="token builtin class-name">:</span> label &#x7528;&#x4E8E;&#x540E;&#x7EED;&#x7684;&#x8DF3;&#x8F6C;label&#x547D;&#x4EE4;, &#x6BD4;&#x5982;b&#x6216;t&#x547D;&#x4EE4;

<span class="token number">0</span>&#x5730;&#x5740;&#x6216;1&#x4E2A;&#x5730;&#x5740;&#x547D;&#x4EE4;
<span class="token operator">=</span> &#x6253;&#x5370;&#x884C;&#x53F7;
a <span class="token punctuation">\</span>text append text
i <span class="token punctuation">\</span>text &#x63D2;&#x5165;text
q <span class="token punctuation">[</span>exit-code<span class="token punctuation">]</span> &#x9000;&#x51FA;
r filename &#x8FFD;&#x52A0;filename&#x7684;&#x5185;&#x5BB9;

&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B9A;&#x5740;&#x7684;&#x547D;&#x4EE4;:
b label &#x8DF3;&#x8F6C;&#x5230;label
c <span class="token punctuation">\</span>text &#x4F7F;&#x7528;text&#x66FF;&#x6362;pattern space, text&#x7684;&#x6362;&#x884C;&#x524D;&#x9762;&#x52A0;<span class="token punctuation">\</span>
d &#x5220;&#x9664;pattern space
h H    Copy/append pattern space to hold space.
g G    Copy/append hold space to pattern space.
l      List out the current line <span class="token keyword">in</span> a ``visually unambiguous<span class="token string">&apos;&apos;</span> form.
n N    Read/append the next line of input into the pattern space.
p      Print the current pattern space.
P      Print up to the first embedded newline of the current pattern space. &#x53EA;&#x6253;&#x5370;&#x4E00;&#x884C;
s/regexp/replacement/ &#x66FF;&#x6362;
w filename
              Write the current pattern space to filename.
x      Exchange the contents of the hold and pattern spaces.
y/source/dest/
              Transliterate the characters <span class="token keyword">in</span> the pattern space <span class="token function">which</span> appear <span class="token keyword">in</span> <span class="token builtin class-name">source</span> to the corresponding character <span class="token keyword">in</span> dest.
</code></pre>
<h2 id="sed&#x5339;&#x914D;2&#x884C;&#x4E4B;&#x95F4;&#x7684;&#x5185;&#x5BB9;"><a name="sed&#x5339;&#x914D;2&#x884C;&#x4E4B;&#x95F4;&#x7684;&#x5185;&#x5BB9;" class="anchor-navigation-ex-anchor" href="#sed&#x5339;&#x914D;2&#x884C;&#x4E4B;&#x95F4;&#x7684;&#x5185;&#x5BB9;"><i class="fa fa-link" aria-hidden="true"></i></a>18.4. sed&#x5339;&#x914D;2&#x884C;&#x4E4B;&#x95F4;&#x7684;&#x5185;&#x5BB9;</h2>
<p>some.log&#x91CC;&#x9762;, &#x4FDD;&#x7559;abc&#x548C;efg&#x4E4B;&#x95F4;&#x7684;&#x884C;, &#x5220;&#x6389;&#x5176;&#x4ED6;&#x884C;
<code>sed -e &apos;/abc/,/efg/!d&apos; some.log</code></p>
<p>&#x8FD9;&#x91CC;<code>!</code>&#x8868;&#x793A;&#x903B;&#x8F91;&#x53CD;, &#x5426;&#x5219;&#x4F1A;&#x5220;&#x6389;&#x4E4B;&#x95F4;&#x7684;&#x884C;.</p>
<h2 id="&#x63D0;&#x53D6;&#x6587;&#x4EF6;&#x7279;&#x5B9A;&#x884C;"><a name="&#x63D0;&#x53D6;&#x6587;&#x4EF6;&#x7279;&#x5B9A;&#x884C;" class="anchor-navigation-ex-anchor" href="#&#x63D0;&#x53D6;&#x6587;&#x4EF6;&#x7279;&#x5B9A;&#x884C;"><i class="fa fa-link" aria-hidden="true"></i></a>18.5. &#x63D0;&#x53D6;&#x6587;&#x4EF6;&#x7279;&#x5B9A;&#x884C;</h2>
<p>grep&#x65B9;&#x5F0F;</p>
<pre class="language-"><code class="lang-sh"><span class="token function">cat</span> ddr_test.log <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token string">&quot;Evaluating Read-Leveling Scoreboard|Initializing cgroup subsys|EDAC MC.:.. [UC]E DIMM&quot;</span> <span class="token operator">&gt;</span> ddr_test.log.analysis
</code></pre>
<p>&#x4F46;&#x662F;&#x6709;&#x4E2A;&#x7F3A;&#x9677;, &#x4E0D;&#x80FD;&#x63D0;&#x53D6;&#x8FDE;&#x7EED;&#x7684;&#x591A;&#x884C;&#x4FE1;&#x606F;. &#x53EF;&#x80FD;grep&#x662F;&#x6309;&#x884C;&#x5904;&#x7406;&#x7684;.
sed&#x65B9;&#x5F0F;</p>
<pre class="language-"><code class="lang-sh">$ <span class="token function">sed</span> <span class="token parameter variable">-rn</span> <span class="token parameter variable">-e</span> <span class="token string">&apos;/Evaluating Read-Leveling Scoreboard/,/Rlevel Rank/p&apos;</span> <span class="token parameter variable">-e</span> <span class="token string">&apos;/Initializing cgroup subsys/p&apos;</span> <span class="token parameter variable">-e</span> <span class="token string">&apos;/EDAC MC.:.. [UC]E DIMM/p&apos;</span> ddr_test.log <span class="token operator">|</span> <span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-e</span> <span class="token string">&apos;/Evaluating Read-Leveling Scoreboard/i ==============&apos;</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">&apos;s/^M//&apos;</span> <span class="token operator">&gt;</span> ddr_test.log.analysis
</code></pre>
<pre class="language-"><code class="lang-sh">$ <span class="token function">sed</span> <span class="token parameter variable">-rn</span> <span class="token parameter variable">-e</span> <span class="token string">&apos;/Cavium Inc. OCTEON SDK version/,/DRAM: 2 GiB/p&apos;</span> <span class="token parameter variable">-e</span> <span class="token string">&apos;/Initializing cgroup subsys/p&apos;</span> <span class="token parameter variable">-e</span> <span class="token string">&apos;/EDAC MC.:.. [UC]E DIMM/p&apos;</span> ddr_test.log <span class="token operator">|</span> <span class="token function">cut</span> -d<span class="token string">&apos; &apos;</span> <span class="token parameter variable">-f</span> <span class="token number">4</span>- <span class="token operator">|</span> <span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-e</span> <span class="token string">&apos;/Cavium Inc. OCTEON SDK version/i \\n==============&apos;</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">&apos;s/^M//&apos;</span> <span class="token operator">&gt;</span> ddr_test.log.analysis
</code></pre>
<p>sed&#x7684;&#x5B9A;&#x5740;&#x53EF;&#x4EE5;&#x8FBE;&#x5230;&#x6B64;&#x76EE;&#x7684;
&#x89E3;&#x91CA;&#x5982;&#x4E0B;:</p>
<pre class="language-"><code class="lang-sh"><span class="token parameter variable">-r</span> &#x4F7F;&#x7528;&#x6269;&#x5C55;&#x6B63;&#x5219;
<span class="token parameter variable">-n</span> &#x4E0D;&#x6253;&#x5370;pattern&#x7A7A;&#x95F4;
<span class="token parameter variable">-e</span> &#x591A;&#x91CD;&#x64CD;&#x4F5C;. &#x6CE8;&#x610F;, sed&#x4F1A;&#x628A;&#x5339;&#x914D;&#x5230;&#x7684;&#x884C;&#x5168;&#x90E8;&#x8FDB;&#x884C;-e&#x540E;&#x9762;&#x7684;command, &#x6240;&#x4EE5;&#x591A;&#x4E2A;-e&#x7684;&#x64CD;&#x4F5C;&#x5E94;&#x8BE5;&#x662F;&#x4E92;&#x4E0D;&#x5F71;&#x54CD;&#x7684;
/pattern1/,/pattern2/ &#x5339;&#x914D;&#x8303;&#x56F4;
p &#x6253;&#x5370;&#x6A21;&#x5F0F;&#x7A7A;&#x95F4;
/pattern/i <span class="token punctuation">\</span>text &#x5728;pattern&#x4E4B;&#x524D;&#x63D2;&#x5165;text, a&#x662F;&#x5728;&#x4E4B;&#x540E;&#x63D2;&#x5165;
<span class="token function">sed</span> <span class="token string">&apos;s/^M//&apos;</span> &#x662F;&#x5220;&#x9664;^M, &#x8F93;&#x5165;^M&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x5148;ctrl+v, &#x5728;ctrl+m
</code></pre>
<h2 id="sed&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;"><a name="sed&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#sed&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>18.6. sed&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;</h2>
<p>&#x6CE8;&#x610F;: sed -r &#x9009;&#x9879;&#x76F4;&#x63A5;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6269;&#x5C55;&#x6B63;&#x5219;
&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;basic regexp, &#x4F46;&#x4E5F;&#x80FD;&#x89E3;&#x91CA;<code>\|&apos;,</code>+&apos;, <code>\?&apos;,</code>`&apos;, <code>\&apos;&apos;,</code>\&lt;&apos;, <code>\&gt;&apos;,</code>\b&apos;, <code>\B&apos;,</code>\w&apos;, and `\W&apos;
&#x6BD4;&#x5982;</p>
<pre class="language-"><code class="lang-sh"><span class="token variable"><span class="token variable">`</span>x<span class="token punctuation">\</span>+&apos; matches one or <span class="token function">more</span> occurrences of <span class="token variable">`</span></span>x<span class="token string">&apos;.  
`abc\|def&apos;</span> matches either <span class="token variable"><span class="token variable">`</span>abc&apos; or <span class="token variable">`</span></span>def&apos;.
</code></pre>
<p>&#x5728;/regexp/&#x540E;&#x9762;&#x52A0;I&#x53EF;&#x4EE5;&#x5927;&#x5C0F;&#x5199;&#x4E0D;&#x654F;&#x611F;, &#x6BD4;&#x5982;
<code>/regexp/Ip</code>, &#x6253;&#x5370;&#x5339;&#x914D;regexp&#x7684;&#x884C;, &#x5927;&#x5C0F;&#x5199;&#x4E0D;&#x654F;&#x611F;
&#x6BD4;&#x5982;&#x67E5;&#x627E;&#x6240;&#x6709;&#x6E90;&#x6587;&#x4EF6;,</p>
<pre class="language-"><code class="lang-sh">$ <span class="token function">find</span> <span class="token parameter variable">-type</span> f <span class="token operator">|</span> <span class="token function">sed</span> <span class="token parameter variable">-n</span> <span class="token string">&apos;/\.\([chs]\)\1\{0,1\}\(pp\)\?$/Ip&apos;</span>
./test.c
./test.h
./test.cc
./test.hh
./test.cpp
./test.hpp
./test.s
./test.S
./test.C
./test.H
</code></pre>
<h2 id="sed&#x5B9A;&#x5740;&#x66FF;&#x6362;"><a name="sed&#x5B9A;&#x5740;&#x66FF;&#x6362;" class="anchor-navigation-ex-anchor" href="#sed&#x5B9A;&#x5740;&#x66FF;&#x6362;"><i class="fa fa-link" aria-hidden="true"></i></a>18.7. sed&#x5B9A;&#x5740;&#x66FF;&#x6362;</h2>
<p><code>sed -i -e &apos;/# GENERIC_SERIAL$/s%^\(.*\)::.*#%\1::respawn:/usr/bin/chrt -r 30 /bin/sh -l #%&apos; $targetdir/etc/inittab</code>
sed &#x4E2D;&#x7684;&#x64CD;&#x4F5C;&#x7B26;&#x6BD4;&#x5982;s&#x6216;&#x8005;d, &#x90FD;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x8303;&#x56F4;, &#x5373;&#x5B9A;&#x5740;. &#x4E0D;&#x5B9A;&#x5740;&#x7684;&#x64CD;&#x4F5C;&#x9ED8;&#x8BA4;&#x662F;&#x5BF9;&#x5168;&#x90E8;&#x884C;.
&#x5B9A;&#x5740;&#x6709;&#x4E00;&#x4E0B;&#x51E0;&#x79CD;:</p>
<ul>
<li><code>addr1 addr1</code>&#x6240;&#x5728;&#x884C;</li>
<li><code>addr1,addr2</code> &#x6240;&#x6709;addr1&#x548C;addr2&#x4E4B;&#x95F4;&#x7684;&#x884C;. &#x7279;&#x522B;&#x7684;, $&#x4EE3;&#x8868;&#x6700;&#x540E;&#x4E00;&#x884C;</li>
<li><code>first~step</code> &#x6BD4;&#x5982;1~2p&#x4F1A;&#x6253;&#x5370;&#x6240;&#x6709;&#x5947;&#x6570;&#x884C;</li>
<li><code>addr1,~N</code> &#x548C;&#x4E0A;&#x9762;&#x5DEE;&#x4E0D;&#x591A;&#x610F;&#x601D;</li>
<li><code>/regexp/</code> &#x6240;&#x6709;&#x5339;&#x914D;&#x5230;regexp&#x7684;&#x884C;</li>
<li><code>\cregexpc</code> &#x548C;&#x4E0A;&#x9762;&#x5DEE;&#x4E0D;&#x591A;, &#x4F46;c&#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x610F;&#x5B57;&#x7B26;, &#x7528;&#x4E8E;&#x5206;&#x9694;</li>
<li><code>addr1,+N addr1</code> &#x6240;&#x5728;&#x884C;&#x4EE5;&#x53CA;&#x4E0B;&#x9762;&#x8FDE;&#x7EED;N&#x884C;</li>
</ul>
<h2 id="sed&#x5220;&#x9664;"><a name="sed&#x5220;&#x9664;" class="anchor-navigation-ex-anchor" href="#sed&#x5220;&#x9664;"><i class="fa fa-link" aria-hidden="true"></i></a>18.8. sed&#x5220;&#x9664;</h2>
<pre class="language-"><code class="lang-sh"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-n</span> <span class="token parameter variable">-e</span> <span class="token string">&apos;/^#OUTPUT-MARKER-BEGIN/,/^#OUTPUT-MARKER-END/d; p&apos;</span> <span class="token variable">$targetdir</span>/etc/init.d/rcS
</code></pre>
<h2 id="sed&#x66FF;&#x6362;&#x5F15;&#x7528;"><a name="sed&#x66FF;&#x6362;&#x5F15;&#x7528;" class="anchor-navigation-ex-anchor" href="#sed&#x66FF;&#x6362;&#x5F15;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>18.9. sed&#x66FF;&#x6362;&#x5F15;&#x7528;</h2>
<p><code>sed -i -e &quot;s%#!/bin/sh%&amp;${output_redirection}%&quot; $targetdir/etc/init.d/rcS</code></p>
<h2 id="sed&#x7684;&#x5206;&#x7EC4;&#x5339;&#x914D;-&#x7528;&#x5206;&#x7EC4;-&#x7528;1&#x5F15;&#x7528;"><a name="sed&#x7684;&#x5206;&#x7EC4;&#x5339;&#x914D;-&#x7528;&#x5206;&#x7EC4;-&#x7528;1&#x5F15;&#x7528;" class="anchor-navigation-ex-anchor" href="#sed&#x7684;&#x5206;&#x7EC4;&#x5339;&#x914D;-&#x7528;&#x5206;&#x7EC4;-&#x7528;1&#x5F15;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>18.10. sed&#x7684;&#x5206;&#x7EC4;&#x5339;&#x914D;, &#x7528;()&#x5206;&#x7EC4;, &#x7528;\1&#x5F15;&#x7528;</h2>
<pre class="language-"><code class="lang-sh"><span class="token builtin class-name">echo</span> /repo/yingjieb/fdt063/sw/vobs/dsl/sw/flat/fpxt-b_OFLT_MAIN/src/bcm_commands.c <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">&apos;s!\(.*/flat/[^/]*\).*!\1!g&apos;</span>
</code></pre>
<h1 id="awk"><a name="awk" class="anchor-navigation-ex-anchor" href="#awk"><i class="fa fa-link" aria-hidden="true"></i></a>19. awk</h1>
<h2 id="shell&#x53D8;&#x91CF;&#x4F20;&#x7ED9;awk"><a name="shell&#x53D8;&#x91CF;&#x4F20;&#x7ED9;awk" class="anchor-navigation-ex-anchor" href="#shell&#x53D8;&#x91CF;&#x4F20;&#x7ED9;awk"><i class="fa fa-link" aria-hidden="true"></i></a>19.1. shell&#x53D8;&#x91CF;&#x4F20;&#x7ED9;awk</h2>
<p>&#x5411;awk&#x4F20;&#x5165;&#x53D8;&#x91CF;, &#x7528;-v, shell&#x53D8;&#x91CF;&#x7528;&#x53CC;&#x5F15;&#x53F7;&#x62EC;&#x8D77;&#x6765;:<code>-v td=&quot;$TimeDiff&quot;</code></p>
<h2 id="&#x518D;&#x8BF4;patten"><a name="&#x518D;&#x8BF4;patten" class="anchor-navigation-ex-anchor" href="#&#x518D;&#x8BF4;patten"><i class="fa fa-link" aria-hidden="true"></i></a>19.2. &#x518D;&#x8BF4;patten</h2>
<p>&#x4E00;&#x822C;&#x7684;pattern&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>
<pre class="language-"><code class="lang-sh"><span class="token function">awk</span> <span class="token string">&apos;/search regex pattern1/ {Actions}        
     /search regex pattern2/ {Actions}&apos;</span> <span class="token function">file</span>
</code></pre>
<ul>
<li>//&#x4E2D;&#x95F4;&#x7684;&#x662F;regex</li>
<li>pattern &#x4E5F;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;//, &#x5176;&#x5B9E;{}&#x524D;&#x9762;&#x7684;&#x90FD;&#x662F;pattern</li>
<li>&#x6BD4;&#x8F83;&#x8868;&#x8FBE;&#x5F0F;&#x4E5F;&#x53EF;&#x4EE5;&#x505A;pattern<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5B57;&#x6BB5;&#x4E0D;&#x662F;A&#x5219;&#x6267;&#x884C;</span>
<span class="token function">awk</span> <span class="token string">&apos;$NF != &quot;A&quot; { print $0 }&apos;</span>
</code></pre>
</li>
<li>BEGIN&#x6838;END&#x4E5F;&#x662F;&#x7279;&#x6B8A;&#x7684;pattern<pre class="language-"><code class="lang-sh"><span class="token function">awk</span> <span class="token string">&apos;BEGIN { n=5 } NR==n { print $0 } END { print $0 }&apos;</span>
</code></pre>
</li>
<li>pattern&#x53EF;&#x4EE5;&#x662F;&#x4E2A;&#x8303;&#x56F4;, pattern1, pattern2: pattern1&#x5339;&#x914D;&#x5230;&#x5219;&#x5F00;&#x95F8;&#x653E;&#x6C34;, pattern2&#x5339;&#x914D;&#x5230;&#x5219;&#x5173;&#x95F8;. &#x5728;&#x5F00;&#x5173;&#x95F8;&#x4E4B;&#x95F4;&#x505A;action</li>
</ul>
<h2 id="awk&#x5728;if&#x91CC;&#x5339;&#x914D;"><a name="awk&#x5728;if&#x91CC;&#x5339;&#x914D;" class="anchor-navigation-ex-anchor" href="#awk&#x5728;if&#x91CC;&#x5339;&#x914D;"><i class="fa fa-link" aria-hidden="true"></i></a>19.3. awk&#x5728;if&#x91CC;&#x5339;&#x914D;</h2>
<pre class="language-"><code class="lang-sh"><span class="token function">cat</span> log/top.log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;{printf NR&quot; &quot;; {if($5 ~ /.*m/) printf $5; else printf $5/1024} printf &quot; &quot; $8 &quot;\n&quot;}&apos;</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">&apos;m&apos;</span>
</code></pre>
<p>&#x8FD9;&#x91CC;&#x7684;<code>if($5 ~ /.*m/)</code>&#x5C31;&#x662F;&#x6B63;&#x5219;&#x5339;&#x914D;, &#x7528;<code>~</code>&#x548C;<code>/patten/</code>&#x7684;&#x5F62;&#x5F0F;</p>
<h2 id="awk&#x652F;&#x6301;&#x6D6E;&#x70B9;"><a name="awk&#x652F;&#x6301;&#x6D6E;&#x70B9;" class="anchor-navigation-ex-anchor" href="#awk&#x652F;&#x6301;&#x6D6E;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>19.4. awk&#x652F;&#x6301;&#x6D6E;&#x70B9;</h2>
<p>bash&#x53EA;&#x652F;&#x6301;&#x6574;&#x6570;&#x8FD0;&#x7B97;, &#x800C;awk&#x652F;&#x6301;&#x6D6E;&#x70B9;</p>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x6BD4;&#x5982;ping.log&#x6700;&#x540E;&#x4E00;&#x884C;</span>
<span class="token number">64</span> bytes from <span class="token number">5.5</span>.5.12: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">11</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.187</span> ms
<span class="token comment">#&#x6211;&#x60F3;&#x6BD4;&#x8F83;time&#x662F;&#x5426;&#x5927;&#x4E8E;&#x67D0;&#x4E2A;&#x503C;, &#x56E0;&#x4E3A;time&#x662F;&#x4E2A;&#x6D6E;&#x70B9;, &#x7528;bash&#x76F4;&#x63A5;&#x6BD4;&#x8F83;&#x4F1A;&#x51FA;&#x9519;</span>
$ <span class="token function">tail</span> ping.log <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">&quot; *|=&quot;</span> <span class="token string">&apos;{if ($10&gt;0.1) print $10}&apos;</span>
<span class="token number">0.187</span>
<span class="token comment">#&#x6539;&#x6210;0.2&#x5219;&#x65E0;&#x8F93;&#x51FA;</span>
$ <span class="token function">tail</span> ping.log <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">&quot; *|=&quot;</span> <span class="token string">&apos;{if ($10&gt;0.2) print $10}&apos;</span>
</code></pre>
<h2 id="awk&#x903B;&#x8F91;&#x4E0E;"><a name="awk&#x903B;&#x8F91;&#x4E0E;" class="anchor-navigation-ex-anchor" href="#awk&#x903B;&#x8F91;&#x4E0E;"><i class="fa fa-link" aria-hidden="true"></i></a>19.5. awk&#x903B;&#x8F91;&#x4E0E;</h2>
<p>&#x8FD9;&#x6837;&#x5199;&#x6BD4;&#x4E0B;&#x6587;&#x7684;<code>ss -ant |awk &apos;{if(NR&gt;1)++s[$1]} END {for(k in s) print k,s[k]}&apos;</code>&#x66F4;&#x7B80;&#x6D01;&#x4E00;&#x4E9B;</p>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x6253;&#x5370;&#x4E94;&#x5230;&#x5341;&#x884C;&#xFF0C;&#x5E76;&#x5728;&#x524D;&#x9762;&#x52A0;&#x4E0A;&#x884C;&#x53F7;</span>
<span class="token function">awk</span> -F: <span class="token string">&apos;NR&gt;=5 &amp;&amp; NR&lt;=10 {print NR,$0}&apos;</span> /etc/passwd
<span class="token comment">#&#x6253;&#x5370;&#x5947;&#x6570;&#x884C; (&#x5220;&#x9664;&#x5076;&#x6570;&#x884C;&#xFF09;</span>
<span class="token function">awk</span> -F: <span class="token string">&apos;NR%2==1 {print NR,$0}&apos;</span> /etc/passwd
<span class="token comment">#&#x6253;&#x5370;&#x5076;&#x6570;&#x884C; (&#x5220;&#x9664;&#x5947;&#x6570;&#x884C;)</span>
<span class="token function">awk</span> -F: <span class="token string">&apos;NR%2==0 {print NR,$0}&apos;</span> /etc/passwd
</code></pre>
<h2 id="awk&#x591A;&#x884C;&#x89E3;&#x6790;"><a name="awk&#x591A;&#x884C;&#x89E3;&#x6790;" class="anchor-navigation-ex-anchor" href="#awk&#x591A;&#x884C;&#x89E3;&#x6790;"><i class="fa fa-link" aria-hidden="true"></i></a>19.6. awk&#x591A;&#x884C;&#x89E3;&#x6790;</h2>
<p>&#x6BD4;&#x5982;nmap&#x7684;&#x8F93;&#x51FA;&#x5982;&#x4E0B;, &#x60F3;&#x89E3;&#x6790;ip&#x548C;mac&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;</p>
<pre class="language-"><code class="lang-sh">Nmap scan report <span class="token keyword">for</span> <span class="token number">10.239</span>.120.208
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00049s latency<span class="token punctuation">)</span>.
MAC Address: EC:B1:D7:2F:90:67 <span class="token punctuation">(</span>Unknown<span class="token punctuation">)</span>
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.239</span>.120.209
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00019s latency<span class="token punctuation">)</span>.
MAC Address: <span class="token number">34</span>:64:A9:CF:8E:62 <span class="token punctuation">(</span>Unknown<span class="token punctuation">)</span>
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.239</span>.120.212
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00020s latency<span class="token punctuation">)</span>.
MAC Address: 8C:FD:F0:06:8B:A1 <span class="token punctuation">(</span>Qualcomm Incorporated<span class="token punctuation">)</span>
</code></pre>
<p><code>sudo nmap -n -sP 10.239.120.1/24 | awk &apos;/Nmap scan report/{printf $5;printf &quot; &quot;;getline;getline;print $3;}&apos;</code>
&#x91CD;&#x70B9;&#x662F;getline
&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x5199;&#x6CD5;&#x6211;&#x8BA4;&#x4E3A;&#x66F4;&#x597D;:
<code>sudo nmap -n -sP 10.239.120.1/24 | awk &apos;/Nmap scan report for/{printf $5;}/MAC Address:/{print &quot; =&gt; &quot;$3;}&apos; | sort</code></p>
<h2 id="awk&#x5206;&#x7EC4;&#x63D0;&#x53D6;"><a name="awk&#x5206;&#x7EC4;&#x63D0;&#x53D6;" class="anchor-navigation-ex-anchor" href="#awk&#x5206;&#x7EC4;&#x63D0;&#x53D6;"><i class="fa fa-link" aria-hidden="true"></i></a>19.7. awk&#x5206;&#x7EC4;&#x63D0;&#x53D6;</h2>
<pre class="language-"><code class="lang-sh">CentOS <span class="token number">7.3</span> $ <span class="token function">cat</span> log/test_report.csv <span class="token operator">|</span> <span class="token function">grep</span> ^<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span>
<span class="token number">1,127</span>.0.0.1,50,500000,10,1,1,set, <span class="token number">81024</span>
<span class="token number">1,127</span>.0.0.1,50,500000,10,1,1,get, <span class="token number">89078</span>
<span class="token number">1,127</span>.0.0.1,50,25000000,10,1,100,get, <span class="token number">315923</span>
<span class="token number">2,127</span>.0.0.1,50,500000,10,1,1,set, <span class="token number">160236</span>
<span class="token number">2,127</span>.0.0.1,50,500000,10,1,1,get, <span class="token number">174584</span>
<span class="token number">2,127</span>.0.0.1,50,25000000,10,1,100,get, <span class="token number">616733</span>
<span class="token number">4,127</span>.0.0.1,50,500000,10,1,1,set, <span class="token number">310916</span>
<span class="token number">4,127</span>.0.0.1,50,500000,10,1,1,get, <span class="token number">333704</span>
<span class="token number">4,127</span>.0.0.1,50,25000000,10,1,100,get, <span class="token number">1155443</span>
<span class="token number">8,127</span>.0.0.1,50,500000,10,1,1,set, <span class="token number">617204</span>
<span class="token number">8,127</span>.0.0.1,50,500000,10,1,1,get, <span class="token number">640997</span>
<span class="token number">8,127</span>.0.0.1,50,25000000,10,1,100,get, <span class="token number">2244430</span>
<span class="token number">16,127</span>.0.0.1,50,500000,10,1,1,set, <span class="token number">433805</span>
<span class="token number">16,127</span>.0.0.1,50,500000,10,1,1,get, <span class="token number">435868</span>
<span class="token number">16,127</span>.0.0.1,50,25000000,10,1,100,get, <span class="token number">4253953</span>
<span class="token comment">#&#x73B0;&#x5728;&#x60F3;&#x5BF9;&#x4E0A;&#x9762;&#x7684;&#x8F93;&#x51FA;, &#x6309;&#x7167;&#x7B2C;&#x4E00;&#x5217;&#x7684;&#x4FE1;&#x606F;&#x6574;&#x7406;</span>
<span class="token comment">#tmp[$1]=tmp[$1]&quot;,&quot;$9&#x662F;&#x8BF4;&#x628A;tmp[$1]&#x62FC;&#x63A5;&#x4E0A;&#x7B2C;&#x4E5D;&#x4E2A;&#x5B57;&#x6BB5;, &#x8FD8;&#x8D4B;&#x503C;&#x56DE;tmp[$1], &#x8FD9;&#x5C31;&#x6709;&#x70B9;&#x50CF;PATH=xxxxx:$PATH</span>
<span class="token function">awk</span> -F, <span class="token string">&apos;{tmp[$1]=tmp[$1]&quot;,&quot;$9}; END{ for(i in tmp) {print i tmp[i]}}&apos;</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-h</span>
<span class="token number">1</span>, <span class="token number">81024</span>, <span class="token number">89078</span>, <span class="token number">315923</span>
<span class="token number">2</span>, <span class="token number">160236</span>, <span class="token number">174584</span>, <span class="token number">616733</span>
<span class="token number">4</span>, <span class="token number">310916</span>, <span class="token number">333704</span>, <span class="token number">1155443</span>
<span class="token number">8</span>, <span class="token number">617204</span>, <span class="token number">640997</span>, <span class="token number">2244430</span>
<span class="token number">16</span>, <span class="token number">433805</span>, <span class="token number">435868</span>, <span class="token number">4253953</span>
</code></pre>
<h2 id="awk&#x53D8;&#x91CF;"><a name="awk&#x53D8;&#x91CF;" class="anchor-navigation-ex-anchor" href="#awk&#x53D8;&#x91CF;"><i class="fa fa-link" aria-hidden="true"></i></a>19.8. awk&#x53D8;&#x91CF;</h2>
<pre class="language-"><code class="lang-sh">CentOS <span class="token number">7.3</span> $ <span class="token function">awk</span> <span class="token string">&apos;{s+=$1} END {print s}&apos;</span> log/*.csv
<span class="token number">1</span>.18365e+07
CentOS <span class="token number">7.3</span> $ <span class="token function">awk</span> <span class="token string">&apos;{s+=$1} END {printf(&quot;%d\n&quot;, s)}&apos;</span> log/*.csv
<span class="token number">11836539</span>
</code></pre>
<ul>
<li>s&#x662F;&#x4E2A;&#x53D8;&#x91CF;, &#x76F4;&#x63A5;&#x7528;, &#x4E0D;&#x52A0;$, &#x90A3;&#x4E48;&#x548C;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;&#x5B57;&#x7B26;&#x4E32;&#x9700;&#x8981;&#x52A0;&#x53CC;&#x5F15;&#x53F7;</li>
<li>print&#x9ED8;&#x8BA4;&#x7528;&#x79D1;&#x5B66;&#x8BA1;&#x6570;&#x6CD5;</li>
</ul>
<h2 id="awk&#x6570;&#x7EC4;"><a name="awk&#x6570;&#x7EC4;" class="anchor-navigation-ex-anchor" href="#awk&#x6570;&#x7EC4;"><i class="fa fa-link" aria-hidden="true"></i></a>19.9. awk&#x6570;&#x7EC4;</h2>
<pre class="language-"><code class="lang-sh">$ ss <span class="token parameter variable">-ant</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&apos;{if(NR&gt;1)++s[$1]} END {for(k in s) print k,s[k]}&apos;</span>
LISTEN <span class="token number">15</span>
ESTAB <span class="token number">10</span>
</code></pre>
<p>&#x6CE8;: &#x6570;&#x7EC4;&#x7684;&#x4E0B;&#x6807;&#x53EF;&#x4EE5;&#x662F;&#x6570;&#x5B57;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x5B57;&#x7B26;&#x4E32;, ++s[$1]&#x662F;&#x7EDF;&#x8BA1;&#x4E2A;&#x6570;</p>
<h2 id="awk&#x5B57;&#x7B26;&#x4E32;&#x66FF;&#x6362;"><a name="awk&#x5B57;&#x7B26;&#x4E32;&#x66FF;&#x6362;" class="anchor-navigation-ex-anchor" href="#awk&#x5B57;&#x7B26;&#x4E32;&#x66FF;&#x6362;"><i class="fa fa-link" aria-hidden="true"></i></a>19.10. awk&#x5B57;&#x7B26;&#x4E32;&#x66FF;&#x6362;</h2>
<pre class="language-"><code class="lang-sh"><span class="token keyword">for</span> <span class="token for-or-select variable">f</span> <span class="token keyword">in</span> log.fio*<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$f</span> &quot;</span><span class="token punctuation">;</span> <span class="token function">awk</span> <span class="token string">&apos;/IOPS/ {sub(&quot;,&quot;,&quot;&quot;,$2);match($4,&quot;[0-9]*MB/s&quot;,arr);printf &quot;BW=%s %s &quot;,arr[0],$2} /95.00th/ {print $2 $3, $8 $9}&apos;</span> <span class="token variable">$f</span><span class="token punctuation">;</span> <span class="token keyword">done</span> <span class="token operator">|</span> <span class="token function">column</span> <span class="token parameter variable">-t</span>
</code></pre>
<p>&#x89E3;&#x91CA;:</p>
<ul>
<li>awk &#x540E;&#x9762;&#x659C;&#x6760;&#x4E2D;&#x95F4;&#x7684;&#x90E8;&#x5206;&#x662F;&#x5339;&#x914D;&#x5B57;&#x7B26;&#x4E32;, &#x5339;&#x914D;&#x5230;&#x7684;&#x884C;&#x624D;&#x505A;&#x540E;&#x9762;&#x7684;&#x4E8B;&#x60C5;</li>
<li>match&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x4F20;&#x5165;arr, arr[0]&#x8868;&#x793A;&#x5339;&#x914D;&#x5230;&#x7684;&#x5B57;&#x7B26;&#x4E32;, &#x5982;&#x679C;&#x6B63;&#x5219;&#x91CC;&#x9762;&#x6709;&#x5206;&#x7EC4;&#x6807;&#x8BB0;(), &#x5219;arr[1], arr[2]&#x4F9D;&#x6B21;&#x662F;&#x5B50;&#x5206;&#x7EC4;<pre class="language-"><code class="lang-sh"><span class="token function">awk</span> <span class="token string">&apos;/search pattern1/ {Actions}        
   /search pattern2/ {Actions}&apos;</span> <span class="token function">file</span>
</code></pre>
</li>
<li>awk &apos;{pattern + action}&apos; {filenames}, &#x6309;&#x884C;&#x5904;&#x7406;, &#x5BF9;&#x5339;&#x914D;patten&#x7684;&#x884C;, &#x987A;&#x5E8F;&#x6267;&#x884C;{}&#x91CC;&#x9762;&#x7684;&#x64CD;&#x4F5C;, - patten&#x5C31;&#x662F;//&#x91CC;&#x9762;&#x7684;&#x4E1C;&#x897F; - $0&#x4EE3;&#x8868;&#x6574;&#x884C;,$1&#x662F;&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x6BB5;</li>
<li>sub(match, replace, string)&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x66FF;&#x6362;, &#x4E0A;&#x9762;&#x7684;<code>sub(/,/,&quot;&quot;,$2)</code>&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x7684;, &#x6548;&#x679C;&#x4E00;&#x6837;.</li>
<li>BEGIN&#x662F;&#x8BF4;&#x5728;&#x626B;&#x63CF;&#x4E4B;&#x524D;&#x6267;&#x884C;&#x7684;, &#x76F8;&#x5BF9;&#x7684;END&#x662F;&#x5728;&#x6700;&#x540E;&#x90FD;&#x626B;&#x63CF;&#x5B8C;&#x4E86;&#x518D;&#x6267;&#x884C;&#x7684; </li>
<li>OFS&#x662F;&#x8F93;&#x51FA;&#x7684;&#x5206;&#x9694;&#x7B26;, FS&#x662F;&#x8F93;&#x5165;&#x7684;&#x5206;&#x9694;&#x7B26;, &#x9ED8;&#x8BA4;&#x90FD;&#x662F;space </li>
<li>print&#x8F93;&#x51FA;&#x5B57;&#x7B26;&#x4E32;&#x8981;&#x52A0;&quot;&quot;, &#x6BD4;&#x5982;print &quot;hello&quot;</li>
<li>echo -n &#x4E0D;&#x6362;&#x884C;</li>
<li>printf&#x4E0D;&#x6362;&#x884C;, &#x800C;print&#x6362;&#x884C;</li>
</ul>
<h2 id="awk&#x7684;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#x548C;&#x6570;&#x5B57;&#x8FD0;&#x7B97;"><a name="awk&#x7684;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#x548C;&#x6570;&#x5B57;&#x8FD0;&#x7B97;" class="anchor-navigation-ex-anchor" href="#awk&#x7684;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#x548C;&#x6570;&#x5B57;&#x8FD0;&#x7B97;"><i class="fa fa-link" aria-hidden="true"></i></a>19.11. awk&#x7684;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#x548C;&#x6570;&#x5B57;&#x8FD0;&#x7B97;</h2>
<pre class="language-"><code class="lang-sh"><span class="token function">cat</span> iperf3_client_x710.log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;{if($8==&quot;Mbits/sec&quot;) printf $7&quot; &quot;;if ($8==&quot;Gbits/sec&quot;) printf $7*1024&quot; &quot;}&apos;</span>
</code></pre>
<h2 id="awk&#x6267;&#x884C;&#x5176;&#x4ED6;&#x7A0B;&#x5E8F;"><a name="awk&#x6267;&#x884C;&#x5176;&#x4ED6;&#x7A0B;&#x5E8F;" class="anchor-navigation-ex-anchor" href="#awk&#x6267;&#x884C;&#x5176;&#x4ED6;&#x7A0B;&#x5E8F;"><i class="fa fa-link" aria-hidden="true"></i></a>19.12. awk&#x6267;&#x884C;&#x5176;&#x4ED6;&#x7A0B;&#x5E8F;</h2>
<pre class="language-"><code class="lang-sh">$ <span class="token function">awk</span> <span class="token string">&apos;{system(&quot;echo &quot;$1 &quot; and &quot;$2)}&apos;</span> <span class="token punctuation">..</span>/linklist
</code></pre>
<h2 id="awk&#x66FF;&#x6362;&#x547D;&#x4EE4;"><a name="awk&#x66FF;&#x6362;&#x547D;&#x4EE4;" class="anchor-navigation-ex-anchor" href="#awk&#x66FF;&#x6362;&#x547D;&#x4EE4;"><i class="fa fa-link" aria-hidden="true"></i></a>19.13. awk&#x66FF;&#x6362;&#x547D;&#x4EE4;</h2>
<pre class="language-"><code class="lang-sh">$ <span class="token builtin class-name">echo</span> <span class="token variable">$var</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;{sub(&quot; &quot;, &quot;_&quot;, $0); printf(&quot;%s\n&quot;, $0);}&apos;</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">$var</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;{gsub(&quot; &quot;, &quot;_&quot;, $0); printf(&quot;%s\n&quot;, $0);}&apos;</span>
</code></pre>
<h1 id="shell&#x7BA1;&#x9053;&#x548C;&#x5FAA;&#x73AF;"><a name="shell&#x7BA1;&#x9053;&#x548C;&#x5FAA;&#x73AF;" class="anchor-navigation-ex-anchor" href="#shell&#x7BA1;&#x9053;&#x548C;&#x5FAA;&#x73AF;"><i class="fa fa-link" aria-hidden="true"></i></a>20. shell&#x7BA1;&#x9053;&#x548C;&#x5FAA;&#x73AF;</h1>
<pre class="language-"><code class="lang-sh"><span class="token keyword">for</span> <span class="token for-or-select variable">f</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">find</span> <span class="token parameter variable">-name</span> *.so<span class="token variable">`</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token variable">$f</span><span class="token punctuation">;</span> readelf <span class="token parameter variable">-h</span> <span class="token variable">$f</span> <span class="token operator">|</span> <span class="token function">grep</span> Flag <span class="token operator">|</span> <span class="token function">grep</span> fp64<span class="token punctuation">;</span> <span class="token keyword">done</span> <span class="token operator">&gt;</span> so.log
</code></pre>
<ul>
<li>for&#x91CC;&#x9762;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7528;pipe</li>
<li>done&#x540E;&#x9762;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8DDF;&#x91CD;&#x5B9A;&#x5411;</li>
</ul>
<h1 id="&#x770B;&#x4E00;&#x4E2A;interface&#x662F;&#x5426;&#x5B58;&#x5728;"><a name="&#x770B;&#x4E00;&#x4E2A;interface&#x662F;&#x5426;&#x5B58;&#x5728;" class="anchor-navigation-ex-anchor" href="#&#x770B;&#x4E00;&#x4E2A;interface&#x662F;&#x5426;&#x5B58;&#x5728;"><i class="fa fa-link" aria-hidden="true"></i></a>21. &#x770B;&#x4E00;&#x4E2A;interface&#x662F;&#x5426;&#x5B58;&#x5728;</h1>
<h2 id="&#x7528;procnetdev"><a name="&#x7528;procnetdev" class="anchor-navigation-ex-anchor" href="#&#x7528;procnetdev"><i class="fa fa-link" aria-hidden="true"></i></a>21.1. &#x7528;/proc/net/dev</h2>
<pre class="language-"><code class="lang-sh">~ <span class="token comment"># cat /proc/net/dev</span>
Inter-<span class="token operator">|</span> Receive <span class="token operator">|</span> Transmit
 face <span class="token operator">|</span>bytes packets errs drop fifo frame compressed multicast<span class="token operator">|</span>bytes packets errs drop fifo colls carrier compressed
dummy0: <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
  npi1: <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
 loop1: <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
    lo: <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
  npi2: <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
 loop2: <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
 bond0: <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
  eth0: <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
  agl0: <span class="token number">123857375</span> <span class="token number">91502</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">6</span> <span class="token number">4491714</span> <span class="token number">52744</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
  npi3: <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
 loop3: <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
  npi0: <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
 loop0: <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
  eth1: <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
</code></pre>
<h2 id="&#x7528;ifconfig-intf&#x8FD4;&#x56DE;&#x503C;"><a name="&#x7528;ifconfig-intf&#x8FD4;&#x56DE;&#x503C;" class="anchor-navigation-ex-anchor" href="#&#x7528;ifconfig-intf&#x8FD4;&#x56DE;&#x503C;"><i class="fa fa-link" aria-hidden="true"></i></a>21.2. &#x7528;ifconfig intf&#x8FD4;&#x56DE;&#x503C;</h2>
<pre class="language-"><code class="lang-sh">~ <span class="token comment"># ifconfig itefwd</span>
ifconfig: itefwd: error fetching interface information: Device not found
~ <span class="token comment"># echo $?</span>
<span class="token number">1</span>
~ <span class="token comment"># ifconfig eth0</span>
eth0 Link encap:Ethernet HWaddr 00:BA:0B:AB:00:0A  
          BROADCAST MULTICAST MTU:1500 Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:0 <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span> TX bytes:0 <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>

~ <span class="token comment"># echo $?</span>
<span class="token number">0</span>
</code></pre>
<h1 id="awk&#x8BA1;&#x7B97;&#x65F6;&#x95F4;&#x5DEE;"><a name="awk&#x8BA1;&#x7B97;&#x65F6;&#x95F4;&#x5DEE;" class="anchor-navigation-ex-anchor" href="#awk&#x8BA1;&#x7B97;&#x65F6;&#x95F4;&#x5DEE;"><i class="fa fa-link" aria-hidden="true"></i></a>22. awk&#x8BA1;&#x7B97;&#x65F6;&#x95F4;&#x5DEE;</h1>
<pre class="language-"><code class="lang-sh"><span class="token comment"># sudo perf script | grep -n1 netdev_send</span>
<span class="token number">207567</span>- pmd8 <span class="token number">6965</span> <span class="token punctuation">[</span>013<span class="token punctuation">]</span> <span class="token number">111673.977146</span>: probe_ovs:netdev_rxq_recv: <span class="token punctuation">(</span>698e80<span class="token punctuation">)</span>
<span class="token number">207568</span>: pmd8 <span class="token number">6965</span> <span class="token punctuation">[</span>013<span class="token punctuation">]</span> <span class="token number">111673.977193</span>: probe_ovs:netdev_send: <span class="token punctuation">(</span>698fd8 <span class="token operator">&lt;</span>- 6764cc<span class="token punctuation">)</span>
<span class="token number">207569</span>- pmd8 <span class="token number">6965</span> <span class="token punctuation">[</span>013<span class="token punctuation">]</span> <span class="token number">111673.977195</span>: probe_ovs:netdev_rxq_recv: <span class="token punctuation">(</span>698e80<span class="token punctuation">)</span>
--
<span class="token number">207711</span>- pmd8 <span class="token number">6965</span> <span class="token punctuation">[</span>013<span class="token punctuation">]</span> <span class="token number">111673.977673</span>: probe_ovs:netdev_rxq_recv: <span class="token punctuation">(</span>698e80<span class="token punctuation">)</span>
<span class="token number">207712</span>: pmd8 <span class="token number">6965</span> <span class="token punctuation">[</span>013<span class="token punctuation">]</span> <span class="token number">111673.977692</span>: probe_ovs:netdev_send: <span class="token punctuation">(</span>698fd8 <span class="token operator">&lt;</span>- 6764cc<span class="token punctuation">)</span>
<span class="token number">207713</span>- pmd8 <span class="token number">6965</span> <span class="token punctuation">[</span>013<span class="token punctuation">]</span> <span class="token number">111673.977694</span>: probe_ovs:netdev_rxq_recv: <span class="token punctuation">(</span>698e80<span class="token punctuation">)</span>
--
<span class="token number">504452</span>- pmd8 <span class="token number">6965</span> <span class="token punctuation">[</span>013<span class="token punctuation">]</span> <span class="token number">111674.978342</span>: probe_ovs:netdev_rxq_recv: <span class="token punctuation">(</span>698e80<span class="token punctuation">)</span>
<span class="token number">504453</span>: pmd8 <span class="token number">6965</span> <span class="token punctuation">[</span>013<span class="token punctuation">]</span> <span class="token number">111674.978385</span>: probe_ovs:netdev_send: <span class="token punctuation">(</span>698fd8 <span class="token operator">&lt;</span>- 6764cc<span class="token punctuation">)</span>
<span class="token number">504454</span>- pmd8 <span class="token number">6965</span> <span class="token punctuation">[</span>013<span class="token punctuation">]</span> <span class="token number">111674.978388</span>: probe_ovs:netdev_rxq_recv: <span class="token punctuation">(</span>698e80<span class="token punctuation">)</span>
--
<span class="token number">504602</span>- pmd8 <span class="token number">6965</span> <span class="token punctuation">[</span>013<span class="token punctuation">]</span> <span class="token number">111674.978889</span>: probe_ovs:netdev_rxq_recv: <span class="token punctuation">(</span>698e80<span class="token punctuation">)</span>
<span class="token number">504603</span>: pmd8 <span class="token number">6965</span> <span class="token punctuation">[</span>013<span class="token punctuation">]</span> <span class="token number">111674.978908</span>: probe_ovs:netdev_send: <span class="token punctuation">(</span>698fd8 <span class="token operator">&lt;</span>- 6764cc<span class="token punctuation">)</span>
<span class="token number">504604</span>- pmd8 <span class="token number">6965</span> <span class="token punctuation">[</span>013<span class="token punctuation">]</span> <span class="token number">111674.978911</span>: probe_ovs:netdev_rxq_recv: <span class="token punctuation">(</span>698e80<span class="token punctuation">)</span>
</code></pre>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x7B2C;&#x4E00;&#x4E2A;awk&#x5F97;&#x51FA;&#x65F6;&#x95F4;&#x5B57;&#x6BB5;, &#x6BD4;&#x5982;111673.977146: &#x7B2C;&#x4E8C;awk&#x7528;&#x5206;&#x9694;&#x7B26;&#x96C6;&#x5408;.&#x6216;:&#x5728;NR&#x9664;4&#x4F59;2&#x7684;&#x65F6;&#x5019;, &#x6253;&#x5370;$2-t; &#x800C;t&#x6BCF;&#x884C;&#x90FD;&#x4FDD;&#x5B58;</span>
<span class="token function">sudo</span> perf script <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-n1</span> netdev_send <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;{print $5}&apos;</span> <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">&quot;[.:]&quot;</span> <span class="token string">&apos;NR%4==2 {print $2-t} {t=$2}&apos;</span>
<span class="token comment"># &#x7ED3;&#x679C;</span>
<span class="token number">47</span>
<span class="token number">19</span>
<span class="token number">43</span>
<span class="token number">19</span>
<span class="token number">42</span>
<span class="token number">19</span>
<span class="token number">42</span>
</code></pre>
<h1 id="ping&#x5EF6;&#x8FDF;&#x5927;&#x4E8E;05ms&#x89E6;&#x53D1;&#x52A8;&#x4F5C;"><a name="ping&#x5EF6;&#x8FDF;&#x5927;&#x4E8E;05ms&#x89E6;&#x53D1;&#x52A8;&#x4F5C;" class="anchor-navigation-ex-anchor" href="#ping&#x5EF6;&#x8FDF;&#x5927;&#x4E8E;05ms&#x89E6;&#x53D1;&#x52A8;&#x4F5C;"><i class="fa fa-link" aria-hidden="true"></i></a>23. ping&#x5EF6;&#x8FDF;&#x5927;&#x4E8E;0.5ms&#x89E6;&#x53D1;&#x52A8;&#x4F5C;</h1>
<pre class="language-"><code class="lang-sh"><span class="token function">ping</span> <span class="token number">5.5</span>.5.11 <span class="token operator">|</span> <span class="token function">tee</span> ping.log
<span class="token function">tail</span> ping.log <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">&quot; *|=&quot;</span> <span class="token string">&apos;{if ($10&gt;0.5) {printf &quot;ping latency %s ms\n&quot;, $10; system(&quot;sudo perf sched record -a&quot;)}}&apos;</span>
</code></pre>
<p>&#x6CE8;: awk&#x4E5F;&#x652F;&#x6301;-F&quot;[.:]&quot;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x6307;&#x5B9A;&#x5206;&#x9694;&#x7B26;, &#x8FD9;&#x91CC;&#x6307;&#x7528;.&#x548C;:&#x5206;&#x5272;.</p>
<pre class="language-"><code class="lang-sh"><span class="token keyword">while</span> <span class="token boolean">true</span>
<span class="token keyword">do</span>
    <span class="token comment">#&#x7528;[[ $(command) ]]&#x6765;&#x5224;&#x65AD;command&#x662F;&#x5426;&#x6709;&#x8F93;&#x51FA;</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">tail</span> ping.log <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">&quot; *|=&quot;</span> <span class="token string">&apos;{if ($10&gt;0.1) print $10}&apos;</span><span class="token variable">)</span></span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
        <span class="token function">sudo</span> perf sched record <span class="token parameter variable">-a</span>
        <span class="token builtin class-name">exit</span>
    <span class="token keyword">fi</span>
    <span class="token function">sleep</span> <span class="token number">10</span>
<span class="token keyword">done</span>
</code></pre>
<h1 id="&#x8BA1;&#x7B97;cpu&#x63A9;&#x7801;-mask"><a name="&#x8BA1;&#x7B97;cpu&#x63A9;&#x7801;-mask" class="anchor-navigation-ex-anchor" href="#&#x8BA1;&#x7B97;cpu&#x63A9;&#x7801;-mask"><i class="fa fa-link" aria-hidden="true"></i></a>24. &#x8BA1;&#x7B97;cpu&#x63A9;&#x7801;, mask</h1>
<pre class="language-"><code class="lang-sh"><span class="token function-name function">bitmask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">#eg. 0,5,8-11 17,26-30 return 7c020f21</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">bm</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">arg</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $* <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">&apos;,&apos;</span> <span class="token string">&apos; &apos;</span><span class="token variable">)</span></span><span class="token punctuation">;</span><span class="token keyword">do</span>
        <span class="token comment">#[ expression ] &amp;&amp; statement1 || statement2 is equal to if expression then statement1 else statement2</span>
        <span class="token comment">#for i in $([ $(echo &quot;$arg&quot; | cut -d&apos;-&apos; -f1) == $arg ] &amp;&amp; echo $arg || echo $arg | tr &apos;-&apos; &apos; &apos; | xargs seq);do</span>
        <span class="token comment">#for i in $(seq ${arg%-*} ${arg#*-});do</span>
        <span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span>${arg<span class="token operator">%</span><span class="token operator">-</span><span class="token operator">*</span>}<span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>${arg#<span class="token operator">*</span><span class="token operator">-</span>}<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span><span class="token keyword">do</span>
            <span class="token variable"><span class="token punctuation">((</span>bm <span class="token operator">|=</span> <span class="token number">1</span><span class="token operator">&lt;&lt;</span>$i<span class="token punctuation">))</span></span>
        <span class="token keyword">done</span>
    <span class="token keyword">done</span>
    <span class="token builtin class-name">printf</span> <span class="token string">&quot;%x<span class="token entity" title="\n">\n</span>&quot;</span> <span class="token variable">$bm</span>
<span class="token punctuation">}</span>

<span class="token function-name function">bitumask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">#input hex: 7c020f21 or 0x7c020f21</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span><span class="token number">16</span>#${<span class="token number">1</span>#<span class="token number">0</span>x}<span class="token variable">))</span></span>

    <span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> x<span class="token punctuation">;</span> x <span class="token operator">=</span> x<span class="token operator">&gt;&gt;</span><span class="token number">1</span><span class="token punctuation">,</span>i<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span><span class="token keyword">do</span>
        <span class="token comment">#&#x8FD9;&#x91CC;&#x7684;for&#x7684;&#x5FAA;&#x73AF;&#x4F53;&#x4E3A;&#x7A7A;, &#x7528;:&#x8868;&#x793A;&#x7A7A;&#x64CD;&#x4F5C;. for&#x4E0D;&#x80FD;&#x6CA1;&#x6709;do ... done</span>
        <span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span>h<span class="token operator">=</span>l<span class="token operator">=</span>i<span class="token punctuation">;</span> x<span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">;</span> x <span class="token operator">=</span> x<span class="token operator">&gt;&gt;</span><span class="token number">1</span><span class="token punctuation">,</span>i<span class="token operator">++</span><span class="token punctuation">,</span>h<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token builtin class-name">:</span><span class="token punctuation">;</span><span class="token keyword">done</span>
        <span class="token comment">#&#x53CC;&#x5C0F;&#x62EC;&#x53F7;&#x91CC;&#x9762;&#x662F;C&#x683C;&#x5F0F;&#x7684;&#x8FD0;&#x7B97;, &#x53D8;&#x91CF;&#x524D;&#x53EF;&#x4EE5;&#x4E0D;&#x8981;$; &#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4F5C;&#x903B;&#x8F91;&#x5224;&#x65AD;</span>
        <span class="token variable"><span class="token punctuation">((</span>h <span class="token operator">-</span> l <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">))</span></span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$l</span> &quot;</span>
        <span class="token variable"><span class="token punctuation">((</span>h <span class="token operator">-</span> l <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">))</span></span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$l</span>-<span class="token variable"><span class="token variable">$((</span>h<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> &quot;</span>
    <span class="token keyword">done</span>
    <span class="token builtin class-name">echo</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="shell&#x7684;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;"><a name="shell&#x7684;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;" class="anchor-navigation-ex-anchor" href="#shell&#x7684;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;"><i class="fa fa-link" aria-hidden="true"></i></a>25. shell&#x7684;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;</h1>
<p><code>ls -l /proc/self</code>&#x662F;&#x5F53;&#x524D;&#x7684;&#x8FDB;&#x7A0B;&#x53F7;
<code>echo $$</code>&#x663E;&#x793A;&#x5F53;&#x524D;&#x8FDB;&#x7A0B;&#x53F7;
&#x8FD9;&#x4E24;&#x4E2A;&#x4E0D;&#x662F;&#x4E00;&#x56DE;&#x4E8B;, <code>echo</code>&#x662F;shell&#x5185;&#x5EFA;&#x547D;&#x4EE4;, &#x4E0D;&#x4F1A;&#x8D77;&#x5B50;&#x8FDB;&#x7A0B;; &#x800C;<code>ls</code>&#x662F;&#x5916;&#x90E8;&#x547D;&#x4EE4;, shell&#x4F1A;folk&#x5B50;&#x8FDB;&#x7A0B;&#x6765;&#x8DD1;&#x5916;&#x90E8;&#x547D;&#x4EE4;;
&#x6240;&#x4EE5;&#x8FD9;&#x4FE9;&#x7684;&#x8FDB;&#x7A0B;&#x53F7;&#x4E0D;&#x4E00;&#x6837;, &#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x4E00;&#x4E2A;&#x662F;41427, &#x4E00;&#x4E2A;&#x662F;4141</p>
<pre class="language-"><code class="lang-sh"><span class="token punctuation">[</span>root@rep2-130 debug<span class="token punctuation">]</span><span class="token comment"># echo $$</span>
<span class="token number">41427</span>
<span class="token punctuation">[</span>root@rep2-130 debug<span class="token punctuation">]</span><span class="token comment"># ls -l /proc/self</span>
lrwxrwxrwx <span class="token number">1</span> root root <span class="token number">0</span> Jan <span class="token number">1</span> <span class="token number">1970</span> /proc/self -<span class="token operator">&gt;</span> <span class="token number">4141</span>
</code></pre>
<p>&#x5176;&#x6B21;, <code>&amp;&amp;</code>&#x903B;&#x8F91;&#x4E0E;&#x7684;&#x64CD;&#x4F5C;, &#x4E5F;&#x4E0D;&#x5F71;&#x54CD;shell&#x521B;&#x5EFA;&#x65B0;&#x8FDB;&#x7A0B;&#x7684;&#x903B;&#x8F91;. &#x76EE;&#x524D;&#x6211;&#x7684;&#x7406;&#x89E3;&#x662F;, &#x5916;&#x90E8;&#x547D;&#x4EE4;&#x4F1A;&#x521B;&#x5EFA;&#x65B0;&#x8FDB;&#x7A0B;. </p>
<pre class="language-"><code class="lang-sh"><span class="token punctuation">[</span>root@rep2-130 debug<span class="token punctuation">]</span><span class="token comment"># ls -l /proc/self &amp;&amp; ls -l /proc/self &amp;&amp; ls -l /proc/self</span>
lrwxrwxrwx <span class="token number">1</span> root root <span class="token number">0</span> Jan <span class="token number">1</span> <span class="token number">1970</span> /proc/self -<span class="token operator">&gt;</span> <span class="token number">3926</span>
lrwxrwxrwx <span class="token number">1</span> root root <span class="token number">0</span> Jan <span class="token number">1</span> <span class="token number">1970</span> /proc/self -<span class="token operator">&gt;</span> <span class="token number">3927</span>
lrwxrwxrwx <span class="token number">1</span> root root <span class="token number">0</span> Jan <span class="token number">1</span> <span class="token number">1970</span> /proc/self -<span class="token operator">&gt;</span> <span class="token number">3928</span>
</code></pre>
<p>&#x5982;&#x679C;&#x60F3;&#x5728;&#x5F53;&#x524D;&#x8FDB;&#x7A0B;&#x4E0B;&#x6267;&#x884C;&#x547D;&#x4EE4;, &#x7528;<code>exec</code>, &#x4F1A;&#x7528;&#x540E;&#x9762;&#x4F20;&#x7684;&#x547D;&#x4EE4;&#x66FF;&#x6362;&#x5F53;&#x524D;shell&#x8FDB;&#x7A0B;. &#x6CE8;&#x610F;&#x5982;&#x679C;<code>exec</code>&#x5199;&#x5728;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x91CC;, &#x90A3;&#x4E48;&#x4E0B;&#x9762;&#x7684;&#x884C;<strong>&#x6CA1;&#x6709;&#x673A;&#x4F1A;&#x6267;&#x884C;</strong>, &#x56E0;&#x4E3A;&#x5F53;&#x524D;shell&#x88AB;&#x66FF;&#x6362;&#x6389;&#x4E86;
<code>eval</code>&#x6267;&#x884C;&#x547D;&#x4EE4;&#x7684;&#x6548;&#x679C;&#x548C;shell&#x76F4;&#x63A5;&#x6267;&#x884C;&#x4E00;&#x6837;, &#x53EA;&#x662F;&#x591A;&#x4E86;<code>&#x8F93;&#x5165;&#x89E3;&#x6790;</code>&#x8FD9;&#x4E00;&#x6B65;.</p>
<h1 id="&#x7C98;&#x8D34;&#x591A;&#x884C;&#x6587;&#x672C;&#x7BA1;&#x9053;&#x540E;&#x518D;&#x7528;&#x540E;&#x7EED;&#x547D;&#x4EE4;&#x5904;&#x7406;"><a name="&#x7C98;&#x8D34;&#x591A;&#x884C;&#x6587;&#x672C;&#x7BA1;&#x9053;&#x540E;&#x518D;&#x7528;&#x540E;&#x7EED;&#x547D;&#x4EE4;&#x5904;&#x7406;" class="anchor-navigation-ex-anchor" href="#&#x7C98;&#x8D34;&#x591A;&#x884C;&#x6587;&#x672C;&#x7BA1;&#x9053;&#x540E;&#x518D;&#x7528;&#x540E;&#x7EED;&#x547D;&#x4EE4;&#x5904;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>26. &#x7C98;&#x8D34;&#x591A;&#x884C;&#x6587;&#x672C;&#x7BA1;&#x9053;&#x540E;&#x518D;&#x7528;&#x540E;&#x7EED;&#x547D;&#x4EE4;&#x5904;&#x7406;</h1>
<pre class="language-"><code class="lang-sh"><span class="token comment"># &#x8FD9;&#x91CC;&lt;&lt; EOF&#x662F;here document</span>
<span class="token comment"># awk -F&#x8868;&#x793A;&#x7528;&quot;-&gt;&quot;&#x548C;&quot;&#x7A7A;&#x683C;*&quot;&#x6765;&#x5206;&#x5272;, strtonum&#x628A;16&#x8FDB;&#x5236;&#x8F6C;&#x6210;10&#x8FDB;&#x5236;&#x8BA1;&#x7B97;, awk&#x4E0D;&#x8BA4;16&#x8FDB;&#x5236;&#x8BA1;&#x7B97;</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">&quot;-&gt;| *&quot;</span> <span class="token string">&apos;{printf &quot;%s %s %dK\n&quot;,$2,$3,(strtonum($3)-strtonum($2))/1024}&apos;</span></span>
    0xffff9d070000-&gt;0xffff9d080000 at 0x03630000: load100 ALLOC LOAD READONLY HAS_CONTENTS
    0xffff9d080000-&gt;0xffff9d880000 at 0x03640000: load101 ALLOC LOAD HAS_CONTENTS
    0xffff9d880000-&gt;0xffff9d890000 at 0x03e40000: load102 ALLOC LOAD READONLY HAS_CONTENTS
    0xffff9d890000-&gt;0xffff9e090000 at 0x03e50000: load103 ALLOC LOAD HAS_CONTENTS
    0xffff9e090000-&gt;0xffff9e0a0000 at 0x04650000: load104 ALLOC LOAD READONLY HAS_CONTENTS
    0xffff9e0a0000-&gt;0xffff9e8a0000 at 0x04660000: load105 ALLOC LOAD HAS_CONTENTS
    0xffff9e8a0000-&gt;0xffff9e8b0000 at 0x04e60000: load106 ALLOC LOAD READONLY HAS_CONTENTS
    0xffff9e8b0000-&gt;0xffff9f0b0000 at 0x04e70000: load107 ALLOC LOAD HAS_CONTENTS
    0xffff9f0b0000-&gt;0xffff9f0c0000 at 0x05670000: load108 ALLOC LOAD READONLY HAS_CONTENTS
    0xffff9f0c0000-&gt;0xffff9f8d0000 at 0x05680000: load109 ALLOC LOAD HAS_CONTENTS
    0xffff9f8d0000-&gt;0xffff9f8d0000 at 0x05e90000: load110 ALLOC
    0xffff9f910000-&gt;0xffff9f920000 at 0x05e90000: load111a ALLOC LOAD READONLY CODE HAS_CONTENTS
EOF</span>
</code></pre>
<h1 id="&#x5173;&#x7CFB;&#x6570;&#x7EC4;-sed-&#x548C;-awk"><a name="&#x5173;&#x7CFB;&#x6570;&#x7EC4;-sed-&#x548C;-awk" class="anchor-navigation-ex-anchor" href="#&#x5173;&#x7CFB;&#x6570;&#x7EC4;-sed-&#x548C;-awk"><i class="fa fa-link" aria-hidden="true"></i></a>27. &#x5173;&#x7CFB;&#x6570;&#x7EC4; sed &#x548C; awk</h1>
<h2 id="&#x6539;&#x8FDB;&#x7248;-awk&#x591A;&#x7EF4;&#x6570;&#x7EC4;"><a name="&#x6539;&#x8FDB;&#x7248;-awk&#x591A;&#x7EF4;&#x6570;&#x7EC4;" class="anchor-navigation-ex-anchor" href="#&#x6539;&#x8FDB;&#x7248;-awk&#x591A;&#x7EF4;&#x6570;&#x7EC4;"><i class="fa fa-link" aria-hidden="true"></i></a>27.1. &#x6539;&#x8FDB;&#x7248; awk&#x591A;&#x7EF4;&#x6570;&#x7EC4;</h2>
<p>&#x8981;&#x89E3;&#x6790;&#x7684;&#x6587;&#x672C;&#x6837;&#x5F0F;:</p>
<pre class="language-"><code class="lang-sh">$ <span class="token function">sudo</span> ovs-appctl dpctl/show <span class="token parameter variable">--statistics</span>
netdev@ovs-netdev:
  lookups: hit:0 missed:0 lost:0
  flows: <span class="token number">0</span>
  port <span class="token number">0</span>: ovs-netdev <span class="token punctuation">(</span>tap<span class="token punctuation">)</span>
    RX packets:0 errors:0 dropped:0 overruns:0 frame:0
    TX packets:0 errors:0 dropped:0 aborted:0 carrier:0
    collisions:0
    RX bytes:0 TX bytes:0
  port <span class="token number">1</span>: dpdkp0 <span class="token punctuation">(</span>dpdk: <span class="token assign-left variable">configured_rx_queues</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">configured_rxq_descriptors</span><span class="token operator">=</span><span class="token number">2048</span>, <span class="token assign-left variable">configured_tx_queues</span><span class="token operator">=</span><span class="token number">9</span>, <span class="token assign-left variable">configured_txq_descriptors</span><span class="token operator">=</span><span class="token number">2048</span>, <span class="token assign-left variable">lsc_interrupt_mode</span><span class="token operator">=</span>false, <span class="token assign-left variable">mtu</span><span class="token operator">=</span><span class="token number">1500</span>, <span class="token assign-left variable">requested_rx_queues</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">requested_rxq_descriptors</span><span class="token operator">=</span><span class="token number">2048</span>, <span class="token assign-left variable">requested_tx_queues</span><span class="token operator">=</span><span class="token number">9</span>, <span class="token assign-left variable">requested_txq_descriptors</span><span class="token operator">=</span><span class="token number">2048</span>, <span class="token assign-left variable">rx_csum_offload</span><span class="token operator">=</span>true<span class="token punctuation">)</span>
    RX packets:0 errors:0 dropped:0 overruns:? frame:?
    TX packets:0 errors:0 dropped:0 aborted:? carrier:?
    collisions:?
    RX bytes:0 TX bytes:0
  port <span class="token number">2</span>: dpdkvhostuser1 <span class="token punctuation">(</span>dpdkvhostuserclient: <span class="token assign-left variable">configured_rx_queues</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">configured_tx_queues</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">mtu</span><span class="token operator">=</span><span class="token number">1500</span>, <span class="token assign-left variable">requested_rx_queues</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">requested_tx_queues</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
    RX packets:0 errors:0 dropped:0 overruns:? frame:?
    TX packets:0 errors:? dropped:0 aborted:? carrier:?
    collisions:?
    RX bytes:0 TX bytes:0
  port <span class="token number">3</span>: dpdkvhostuser0 <span class="token punctuation">(</span>dpdkvhostuserclient: <span class="token assign-left variable">configured_rx_queues</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">configured_tx_queues</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">mtu</span><span class="token operator">=</span><span class="token number">1500</span>, <span class="token assign-left variable">requested_rx_queues</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">requested_tx_queues</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
    RX packets:0 errors:0 dropped:0 overruns:? frame:?
    TX packets:0 errors:? dropped:0 aborted:? carrier:?
    collisions:?
    RX bytes:0 TX bytes:0
  port <span class="token number">4</span>: ovsbr0 <span class="token punctuation">(</span>tap<span class="token punctuation">)</span>
    RX packets:0 errors:0 dropped:0 overruns:0 frame:0
    TX packets:0 errors:0 dropped:0 aborted:0 carrier:0
    collisions:0
    RX bytes:0 TX bytes:0
</code></pre>
<p>&#x6362;&#x4E86;&#x547D;&#x4EE4;, &#x91CD;&#x65B0;&#x6539;&#x4E86;&#x601D;&#x8DEF;; &#x8FD9;&#x6B21;&#x4E0D;&#x7528;shell&#x5173;&#x7CFB;&#x6570;&#x7EC4;, &#x4F46;&#x4F1A;&#x7528;&#x5230;awk&#x591A;&#x7EF4;&#x6570;&#x7EC4;</p>
<pre class="language-"><code class="lang-sh">ovs-appctl dpctl/show <span class="token operator">&gt;</span> /dev/null
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-ne</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
 <span class="token builtin class-name">printf</span> <span class="token string">&quot;execution failed, you may need sudo?<span class="token entity" title="\n">\n</span>&quot;</span>
 <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token function-name function">prep</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">#string</span>
 <span class="token comment">#grep -o&#x662F;&#x8BF4;&#x53EA;&#x8F93;&#x51FA;&#x6B63;&#x5219;&#x5339;&#x914D;&#x7684;&#x90E8;&#x5206;; &#x800C;&#x4E14;&#x5339;&#x914D;&#x5230;&#x7684;&#x8F93;&#x51FA;&#x90FD;&#x662F;&#x5355;&#x72EC;&#x4E00;&#x884C;, &#x4FBF;&#x4E8E;&#x540E;&#x7EED;&#x5904;&#x7406;</span>
 <span class="token comment"># awk&#x7684; -F [ :]&#x662F;&#x8BF4;&#x7528;&#x7A7A;&#x683C;&#x548C;:&#x505A;&#x5206;&#x9694;&#x7B26;;&#x540E;&#x9762;&#x7684;NR&#x8868;&#x793A;&#x884C;&#x53F7;, &#x4ECE;1&#x5F00;&#x59CB;; NF&#x662F;&#x5F53;&#x524D;&#x884C;&#x7684;field&#x4E2A;&#x6570;</span>
 <span class="token comment">#a[port,$1,$i]=$(i+1), &#x8FD9;&#x662F;&#x4E2A;&#x4E09;&#x7EF4;&#x6570;&#x7EC4;, &#x4F46;awk&#x5185;&#x90E8;&#x4F1A;&#x628A;&#x4E0B;&#x6807;&#x90FD;&#x8FDE;&#x8D77;&#x6765;, &#x6BD4;&#x5982;foo[5,12] = &quot;value&quot;, &#x5185;&#x90E8;&#x53D8;&#x6210;foo[&quot;5@12&quot;]=&quot;value&quot;, &#x8FD9;&#x91CC;&#x7684;@&#x662F;&#x4E2A;&#x4E0D;&#x53EF;&#x89C1;&#x7684;&#x7B26;&#x53F7;(SUBSEP)</span>
 <span class="token comment">###grep&#x540E;&#x7684;&#x6587;&#x672C;:</span>
 <span class="token comment">#port 0: ovs</span>
 <span class="token comment">#RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span>
 <span class="token comment">#TX packets:0 errors:0 dropped:0 aborted:0 carrier:0</span>
 <span class="token comment">###</span>
 <span class="token comment">#&#x4E09;&#x7EF4;&#x6570;&#x7EC4;&#x662F;&#x8981;&#x628A;&#x62A5;&#x6587;&#x7EDF;&#x8BA1;&#x7684;&#x6570;&#x503C;&#x7528;&#x4E09;&#x5143;(port&#x540D;, &#x65B9;&#x5411;, &#x7EDF;&#x8BA1;&#x9879;&#x540D;&#x79F0;)&#x6765;&#x6807;&#x8BB0;, &#x6BD4;&#x5982;a[&quot;ovs&quot;,&quot;RX&quot;, &quot;packets&quot;]=0</span>
 <span class="token comment">###&#x6700;&#x540E;&#x6253;&#x5370;&#x51FA;&#x6765;&#x6BCF;&#x884C;&#x90FD;&#x662F;&#x5982;&#x4E0B;&#x5F62;&#x5F0F;&#x7684;&#x7EDF;&#x8BA1;</span>
 <span class="token comment">#ovs TX aborted:0</span>
 <span class="token comment">#dpdkp1 RX dropped:0</span>
 <span class="token comment">#dpdkp1 RX packets:170</span>
 <span class="token comment">#dpdkvhostuser0 RX dropped:0</span>
 <span class="token comment">###</span>
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-Eo</span> <span class="token string">&quot;port [0-9]*: [[:alnum:]]*|RX packets.*|TX packets.*&quot;</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">&quot;?&quot;</span> <span class="token string">&quot;0&quot;</span> <span class="token punctuation">\</span>
  <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">&apos;[ :]&apos;</span> <span class="token string">&apos;{if(NR%3==1) port=$4; else{for(i=2;i&lt;=NF;i+=2){a[port,$1,$i]=$(i+1)}}} END {for(k in a) {split(k,se,SUBSEP);printf &quot;%s %s %s:%s\n&quot;,se[1],se[2],se[3],a[k]}}&apos;</span>
<span class="token punctuation">}</span>

<span class="token assign-left variable">cmd</span><span class="token operator">=</span><span class="token string">&apos;ovs-appctl dpctl/show --statistics&apos;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Calculating pps for &apos;ovs-appctl dpctl/show --statistics&apos; ...&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Note: 0 pps will be ignored, that said statistics not showed below are 0 pps&quot;</span>
<span class="token builtin class-name">echo</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">t</span> <span class="token keyword">in</span> t1 t2 t3<span class="token punctuation">;</span> <span class="token keyword">do</span>
 <span class="token builtin class-name">test</span> <span class="token variable">$t</span> <span class="token operator">=</span> t1 <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">v1</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">eval</span> $cmd<span class="token variable">)</span></span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">d1</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s%6N<span class="token variable">)</span></span>
 <span class="token builtin class-name">test</span> <span class="token variable">$t</span> <span class="token operator">=</span> t2 <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">v2</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">eval</span> $cmd<span class="token variable">)</span></span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">d2</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s%6N<span class="token variable">)</span></span>
 <span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token variable">$t</span> <span class="token operator">=</span> t3<span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token variable"><span class="token punctuation">((</span>td<span class="token operator">=</span>$d2 <span class="token operator">-</span> $d1<span class="token punctuation">))</span></span>
  <span class="token comment">#echo $td</span>

  <span class="token assign-left variable">v1</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>prep <span class="token string">&quot;<span class="token variable">$v1</span>&quot;</span><span class="token variable">)</span></span>
  <span class="token assign-left variable">v2</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>prep <span class="token string">&quot;<span class="token variable">$v2</span>&quot;</span><span class="token variable">)</span></span>
  <span class="token assign-left variable">o</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">$v1</span> <span class="token entity" title="\n">\n</span><span class="token variable">$v2</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">&apos;:&apos;</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">td</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$td</span>&quot;</span> <span class="token string">&apos;{a[$1]=$2-a[$1]} END {for(k in a) printf &quot;%s %d pps\n&quot;,k,a[k]*1000000/td}&apos;</span><span class="token variable">)</span></span>
  <span class="token comment">#awk&#x683C;&#x5F0F;&#x5316;&#x8F93;&#x51FA;&#x548C;c&#x4E00;&#x6837;, %12s&#x662F;&#x8BF4;12&#x4E2A;&#x5B57;&#x7B26;&#x5BBD;&#x5EA6;, &#x53F3;&#x5BF9;&#x9F50;; &#x5DE6;&#x5BF9;&#x9F50;&#x662F;%-12s</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$o</span>&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">&quot; 0&quot;</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;{printf &quot;%s:\n\t%s %s:\t%12s %s\n&quot;,$1,$2,$3,$4,$5}&apos;</span>
 <span class="token keyword">fi</span>
<span class="token keyword">done</span> 

<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>&quot;</span>
</code></pre>
<h2 id="&#x539F;&#x59CB;&#x7248;"><a name="&#x539F;&#x59CB;&#x7248;" class="anchor-navigation-ex-anchor" href="#&#x539F;&#x59CB;&#x7248;"><i class="fa fa-link" aria-hidden="true"></i></a>27.2. &#x539F;&#x59CB;&#x7248;</h2>
<pre class="language-"><code class="lang-sh">ovs-vsctl list interface <span class="token operator">&gt;</span> /dev/null
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-ne</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
 <span class="token builtin class-name">printf</span> <span class="token string">&quot;ovs-vsctl execution failed, you may need sudo?<span class="token entity" title="\n">\n</span>&quot;</span>
 <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token comment">#&#x6CE8;&#x610F;cmd&#x8981;&#x7528;&#x5355;&#x5F15;&#x53F7;, &#x5355;&#x5F15;&#x53F7;&#x4E0D;&#x4F1A;&#x5C55;&#x5F00;&#x53D8;&#x91CF;</span>
<span class="token comment">#sed -r&#x662F;&#x7528;&#x6269;&#x5C55;&#x6B63;&#x5219;, &#x8FD9;&#x91CC;&#x7528;&#x5230;&#x4E86;&#x66FF;&#x6362;, &#x53CD;&#x5411;&#x5F15;&#x7528;&#x7B49;, sed&#x4F1A;&#x5BF9;&#x884C;&#x4F9D;&#x6B21;&#x8FDB;&#x884C;-e&#x540E;&#x9762;&#x7684;&#x5904;&#x7406;, &#x5904;&#x7406;&#x7684;&#x90A3;&#x884C;&#x53EB;&#x505A;patten&#x7A7A;&#x95F4;</span>
<span class="token assign-left variable">cmd</span><span class="token operator">=</span><span class="token string">&apos;(ovs-vsctl list interface &amp;&amp; echo date: $(date +%s%6N)) | grep -E &quot;^name|^statistics|^date&quot; | sed -r -e &quot;s/,|\{|\}//g&quot; -e &quot;s/name *: (.*)/\1:/g&quot; -e &quot;s/statistics *://g&quot;&apos;</span>

<span class="token comment">#t1 t2 t3&#x4E0D;&#x52A0;&#x5F15;&#x53F7;, &#x89C6;&#x4E3A;&#x5355;&#x72EC;&#x5143;&#x7D20;, &#x7528;for&#x53EF;&#x4EE5;&#x904D;&#x5386;; &#x52A0;&#x4E86;&quot;&quot;&#x5C31;&#x53D8;&#x6210;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x4E86;</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">t</span> <span class="token keyword">in</span> t1 t2 t3<span class="token punctuation">;</span> <span class="token keyword">do</span>
 <span class="token builtin class-name">test</span> <span class="token variable">$t</span> <span class="token operator">=</span> t1 <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">v1</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">eval</span> $cmd<span class="token variable">)</span></span>
 <span class="token comment">#&#x672C;&#x6765;&#x8BE5;&#x7528;if, &#x8FD9;&#x91CC;&#x7528;test&#x548C;&amp;&amp;&#x505A;&#x7B80;&#x5316;&#x5904;&#x7406;; &#x4E3B;&#x8FDB;&#x7A0B;&#x4F1A;&#x7B49;&#x7740;sleep&#x6267;&#x884C;&#x5B8C;&#x624D;&#x5F80;&#x540E;&#x6267;&#x884C;</span>
 <span class="token builtin class-name">test</span> <span class="token variable">$t</span> <span class="token operator">=</span> t2 <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">10</span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">v2</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">eval</span> $cmd<span class="token variable">)</span></span>
 <span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token variable">$t</span> <span class="token operator">=</span> t3<span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">0</span>
  <span class="token comment">#&#x58F0;&#x660E;&#x5173;&#x7CFB;&#x6570;&#x7EC4;, &#x5173;&#x7CFB;&#x6570;&#x7EC4;&#x5C31;&#x662F;&#x53EF;&#x4EE5;&#x7528;string&#x505A;&#x4E0B;&#x6807;&#x7684;&#x6570;&#x7EC4;</span>
  <span class="token builtin class-name">declare</span> <span class="token parameter variable">-A</span> map1 map2

  <span class="token comment">#NF&#x662F;awk&#x89E3;&#x6790;&#x7684;feild&#x4E2A;&#x6570;, &#x6BCF;&#x884C;</span>
  <span class="token assign-left variable">v1</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$v1</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">&apos;{printf $0; if(NF==1 || $1==&quot;date&quot;) print &quot;&quot;}&apos;</span><span class="token variable">)</span></span>
  <span class="token comment">#&#x6BCF;&#x884C;&#x7C7B;&#x4F3C;&#x4E8E;&quot;dpdkp1&quot;: rx_bytes=865352722 rx_dropped=0 rx_errors=0 rx_packets=14419925 tx_bytes=0 tx_dropped=0 tx_errors=0 tx_packets=0</span>
  <span class="token comment">#&#x5148;&#x628A;&#x5B83;&#x4EE5;&#x7B2C;&#x4E00;&#x4E2A;&#x7A7A;&#x683C;&#x4E3A;&#x754C;&#x5206;&#x5272;&#x4E3A;&#x4E24;&#x90E8;&#x5206;:k&#x548C;v, &#x5176;&#x5B9E;v&#x662F;&#x7B2C;&#x4E00;&#x4E2A;&#x7A7A;&#x683C;&#x540E;&#x9762;&#x6240;&#x6709;&#x7684;&#x90E8;&#x5206;</span>
  <span class="token keyword">while</span> <span class="token builtin class-name">read</span> k <span class="token function">v</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
   <span class="token comment">#&#x5173;&#x7CFB;&#x6570;&#x7EC4;&#x8D4B;&#x503C;</span>
   map1<span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$v</span>
  <span class="token comment">#&#x8FD9;&#x91CC;&#x7528;&lt;&lt;&lt;&#x6765;&#x628A;&#x53D8;&#x91CF;&#x4F20;&#x5165;while&#x5757;&#x4E2D;, &#x4E4B;&#x524D;&#x8BD5;&#x8FC7;&#x7BA1;&#x9053;, &#x4F46;map&#x7684;&#x8D4B;&#x503C;&#x53EA;&#x5728;while&#x5757;&#x91CC;&#x9762;&#x6709;&#x6548;, &#x51FA;&#x6765;&#x5C31;&#x6CA1;&#x6709;&#x4E86;</span>
  <span class="token comment">#&lt;&lt;&lt;&#x7684;&#x5B66;&#x540D;&#x662F;Here Strings, &#x662F;Here Documents&#x7684;&#x53D8;&#x79CD;; &#x53D8;&#x91CF;&#x4F1A;&#x5C55;&#x5F00;&#x5E76;&#x4F5C;&#x4E3A;&#x8F93;&#x5165;</span>
  <span class="token keyword">done</span> <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">&quot;<span class="token variable">$v1</span>&quot;</span>

  <span class="token assign-left variable">v2</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$v2</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">&apos;{printf $0; if(NF==1 || $1==&quot;date&quot;) print &quot;&quot;}&apos;</span><span class="token variable">)</span></span>
  <span class="token keyword">while</span> <span class="token builtin class-name">read</span> k <span class="token function">v</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
   map2<span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$v</span>
  <span class="token keyword">done</span> <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">&quot;<span class="token variable">$v2</span>&quot;</span>

  <span class="token comment">#&#x53CC;&#x62EC;&#x53F7;&#x8868;&#x793A;&#x7B97;&#x6570;&#x8BA1;&#x7B97;</span>
  <span class="token variable"><span class="token punctuation">((</span>TimeDiff<span class="token operator">=</span>${map2[date<span class="token operator">:</span>]} <span class="token operator">-</span> ${map1[date<span class="token operator">:</span>]}<span class="token punctuation">))</span></span>

  <span class="token comment">#&#x5173;&#x7CFB;&#x6570;&#x7EC4;&#x904D;&#x5386; &quot;${!map2[@]}&quot;&#x662F;&#x6240;&#x6709;&#x7684;key, &#x800C;&quot;${map2[@]}&quot;&#x662F;&#x6240;&#x6709;value(&#x8FD9;&#x4E2A;&#x548C;&#x666E;&#x901A;&#x6570;&#x7EC4;&#x662F;&#x4E00;&#x81F4;&#x7684;)</span>
  <span class="token keyword">for</span> <span class="token for-or-select variable">k</span> <span class="token keyword">in</span> <span class="token string">&quot;<span class="token variable">${<span class="token operator">!</span>map2<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
   <span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token variable">$k</span> <span class="token operator">!=</span> <span class="token string">&quot;date:&quot;</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token operator">==</span><span class="token operator">==</span> pps <span class="token keyword">for</span> <span class="token variable">$k</span> <span class="token operator">==</span><span class="token operator">==</span>
    <span class="token comment">#awk -F&#x6307;&#x5B9A;&#x5206;&#x9694;&#x7B26;, &#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x4E2A;&#x96C6;&#x5408;&#x6BD4;&#x5982;&apos;[=:\n]&apos;, &#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x4E2A;string, &#x6216;&#x8005;&#x6B63;&#x5219;, &#x6BD4;&#x5982;awk -F&quot;TX|RX&quot;, &#x5C31;&#x662F;&#x628A;&#x6BCF;&#x884C;&#x6309;TX&#x6216;&#x8005;RX&#x5206;&#x5272;</span>
    <span class="token comment">#&#x5411;awk&#x4F20;&#x5165;&#x53D8;&#x91CF;, &#x7528;-v, shell&#x53D8;&#x91CF;&#x7528;&#x53CC;&#x5F15;&#x53F7;&#x62EC;&#x8D77;&#x6765;:-v td=&quot;$TimeDiff&quot;</span>
    <span class="token comment">#awk&#x6570;&#x7EC4;, &#x8FD9;&#x91CC;&#x5BF9;&#x6BCF;&#x884C;&#x505A;a[$1]=$2-a[$1], &#x7528;$1&#x505A;key, &#x7528;$2&#x505A;value, &#x76F8;&#x51CF;&#x5F97;&#x51FA;&#x5DEE;&#x503C;; &#x6700;&#x540E;&#x5728;END&#x5757;&#x91CC;&#x6253;&#x5370;</span>
    <span class="token comment">#&#x8981;&#x6C42;&#x6BCF;&#x884C;&#x662F;k=v&#x7684;&#x5F62;&#x5F0F;, &#x5728;&#x6570;&#x7EC4;&#x91CC;&#x5C31;&#x662F;a[k]=v</span>
    <span class="token comment">#&#x8FD9;&#x91CC;&#x7684;&#x51CF;&#x6CD5;&#x5F88;&#x7CBE;&#x9AD3;, a[$1]=$2-a[$1], &#x76F8;&#x540C;&#x7684;key&#x51FA;&#x73B0;&#x4E24;&#x6B21;, &#x5BF9;&#x5E94;&#x7684;value&#x662F;&#x62A5;&#x6587;&#x6570;, &#x76F8;&#x51CF;&#x5C31;&#x662F;&#x62A5;&#x6587;&#x7EDF;&#x8BA1;&#x5DEE;&#x503C;</span>
    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">${map1<span class="token punctuation">[</span>$k<span class="token punctuation">]</span>}</span> <span class="token entity" title="\n">\n</span><span class="token variable">${map2<span class="token punctuation">[</span>$k<span class="token punctuation">]</span>}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">&apos; &apos;</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">&quot;bytes&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">&apos;=&apos;</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">td</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$TimeDiff</span>&quot;</span> <span class="token string">&apos;{a[$1]=$2-a[$1]} END {for(k in a) printf &quot;%s %d pps\n&quot;,k,a[k]*1000000/td}&apos;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">&quot; 0 &quot;</span> <span class="token operator">|</span> <span class="token function">sort</span>
   <span class="token keyword">fi</span>
  <span class="token keyword">done</span>
 <span class="token keyword">fi</span>
<span class="token keyword">done</span>
</code></pre>
<h1 id="shell&#x5173;&#x7CFB;&#x6570;&#x7EC4;----&#x6216;&#x8005;&#x8BF4;&#x662F;list"><a name="shell&#x5173;&#x7CFB;&#x6570;&#x7EC4;----&#x6216;&#x8005;&#x8BF4;&#x662F;list" class="anchor-navigation-ex-anchor" href="#shell&#x5173;&#x7CFB;&#x6570;&#x7EC4;----&#x6216;&#x8005;&#x8BF4;&#x662F;list"><i class="fa fa-link" aria-hidden="true"></i></a>28. shell&#x5173;&#x7CFB;&#x6570;&#x7EC4; -- &#x6216;&#x8005;&#x8BF4;&#x662F;list</h1>
<p>&#x53C2;&#x8003;: <a href="https://www.artificialworlds.net/blog/2012/10/17/bash-associative-array-examples/" target="_blank">https://www.artificialworlds.net/blog/2012/10/17/bash-associative-array-examples/</a>
&#x9700;&#x8981;bash&#x7248;&#x672C;&#x9AD8;&#x4E8E;4</p>
<pre class="language-"><code class="lang-sh"><span class="token builtin class-name">declare</span> <span class="token parameter variable">-A</span> map
$ map<span class="token punctuation">[</span>foo<span class="token punctuation">]</span><span class="token operator">=</span>bar
$ <span class="token builtin class-name">echo</span> <span class="token variable">${map<span class="token punctuation">[</span>foo<span class="token punctuation">]</span>}</span>
bar
$ <span class="token assign-left variable">K</span><span class="token operator">=</span>baz
bai@CentOS-43 ~/repo/save
$ map<span class="token punctuation">[</span><span class="token variable">$K</span><span class="token punctuation">]</span><span class="token operator">=</span>quux
bai@CentOS-43 ~/repo/save
$ <span class="token builtin class-name">echo</span> <span class="token variable">${map<span class="token punctuation">[</span>$K<span class="token punctuation">]</span>}</span>
quux
</code></pre>
<p>&#x904D;&#x5386;</p>
<pre class="language-"><code class="lang-sh">$ <span class="token builtin class-name">declare</span> <span class="token parameter variable">-A</span> <span class="token assign-left variable">MYMAP</span><span class="token operator">=</span><span class="token punctuation">(</span> <span class="token punctuation">[</span>foo a<span class="token punctuation">]</span><span class="token operator">=</span>bar <span class="token punctuation">[</span>baz b<span class="token punctuation">]</span><span class="token operator">=</span>quux <span class="token punctuation">)</span>
$ <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${<span class="token operator">!</span>MYMAP<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span> <span class="token comment"># Print all keys - quoted, but quotes removed by echo</span>
foo a baz b
$ <span class="token comment"># Loop through all keys in an associative array</span>
$ <span class="token keyword">for</span> <span class="token for-or-select variable">K</span> <span class="token keyword">in</span> <span class="token string">&quot;<span class="token variable">${<span class="token operator">!</span>MYMAP<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token variable">$K</span><span class="token punctuation">;</span> <span class="token keyword">done</span>
foo a
baz b
$ <span class="token comment"># Loop through all values in an associative array</span>
$ <span class="token keyword">for</span> <span class="token for-or-select variable">V</span> <span class="token keyword">in</span> <span class="token string">&quot;<span class="token variable">${MYMAP<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token variable">$V</span><span class="token punctuation">;</span> <span class="token keyword">done</span>
bar
quux
</code></pre>
<h1 id="shell&#x6570;&#x7EC4;"><a name="shell&#x6570;&#x7EC4;" class="anchor-navigation-ex-anchor" href="#shell&#x6570;&#x7EC4;"><i class="fa fa-link" aria-hidden="true"></i></a>29. shell&#x6570;&#x7EC4;</h1>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x62EC;&#x53F7;&#x62EC;&#x8D77;&#x6765;&#x5B9A;&#x4E49;&#x6570;&#x7EC4;</span>
<span class="token assign-left variable">my_array</span><span class="token operator">=</span><span class="token punctuation">(</span>A B <span class="token string">&quot;C&quot;</span> D<span class="token punctuation">)</span>
<span class="token comment">#&#x6216;&#x8005;</span>
array_name<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>value0
array_name<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>value1
array_name<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span>value2
<span class="token comment">#&#x6570;&#x7EC4;&#x5143;&#x7D20;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x4E3A;: <span class="token variable">${my_array<span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span>&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;&#x7B2C;&#x4E8C;&#x4E2A;&#x5143;&#x7D20;&#x4E3A;: <span class="token variable">${my_array<span class="token punctuation">[</span>1<span class="token punctuation">]</span>}</span>&quot;</span>
<span class="token comment">#&#x6240;&#x6709;&#x5143;&#x7D20;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;&#x6570;&#x7EC4;&#x7684;&#x5143;&#x7D20;&#x4E3A;: <span class="token variable">${my_array<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;&#x6570;&#x7EC4;&#x7684;&#x5143;&#x7D20;&#x4E3A;: <span class="token variable">${my_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span>
<span class="token comment">#&#x6570;&#x7EC4;&#x957F;&#x5EA6;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x4E2A;&#x6570;&#x4E3A;: <span class="token variable">${<span class="token operator">#</span>my_array<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x4E2A;&#x6570;&#x4E3A;: <span class="token variable">${<span class="token operator">#</span>my_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span>
<span class="token comment">#&#x6570;&#x7EC4;&#x904D;&#x5386;</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">data</span> <span class="token keyword">in</span> <span class="token variable">${array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>  
<span class="token keyword">do</span>  
    <span class="token builtin class-name">echo</span> <span class="token variable">${data}</span>  
<span class="token keyword">done</span>
</code></pre>
<p>&#x53C8;&#x6BD4;&#x5982;:</p>
<pre class="language-"><code class="lang-sh"><span class="token comment">#&#x8FD9;&#x91CC;ETHTOOL&#x662F;&#x4E2A;&#x6570;&#x7EC4;, &#x800C;T_PKT&#x4E5F;&#x662F;&#x6570;&#x7EC4;, &#x7531;&#x5165;&#x53C2;index&#x6765;&#x63A7;&#x5236;</span>
<span class="token function-name function">update_stats</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment"># $name $index</span>
    TS_LAST<span class="token punctuation">[</span><span class="token variable">$2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">${TS<span class="token punctuation">[</span>$2<span class="token punctuation">]</span>}</span>
    R_PKT_LAST<span class="token punctuation">[</span><span class="token variable">$2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">${R_PKT<span class="token punctuation">[</span>$2<span class="token punctuation">]</span>}</span>
    R_BYTE_LAST<span class="token punctuation">[</span><span class="token variable">$2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">${R_BYTE<span class="token punctuation">[</span>$2<span class="token punctuation">]</span>}</span>
    T_PKT_LAST<span class="token punctuation">[</span><span class="token variable">$2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">${T_PKT<span class="token punctuation">[</span>$2<span class="token punctuation">]</span>}</span>
    T_BYTE_LAST<span class="token punctuation">[</span><span class="token variable">$2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">${T_BYTE<span class="token punctuation">[</span>$2<span class="token punctuation">]</span>}</span>

    <span class="token assign-left variable">ETHTOOL</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ethtool</span> <span class="token parameter variable">-S</span> $1 <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;/tx_packets_phy/{print $2} /rx_packets_phy/{print $2} /tx_bytes_phy/{print $2} /rx_bytes_phy/{print$2}&apos;</span><span class="token variable">)</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$ETHTOOL</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">ETHTOOL</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ethtool</span> <span class="token parameter variable">-S</span> $1 <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;/tx_packets/{print $2} /rx_packets/{print $2} /tx_bytes/{print $2} /rx_bytes/{print$2}&apos;</span><span class="token variable">)</span></span><span class="token punctuation">)</span>
    <span class="token keyword">fi</span>

    TS<span class="token punctuation">[</span><span class="token variable">$2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s%6N<span class="token variable">)</span></span> <span class="token comment"># in usec</span>
    T_PKT<span class="token punctuation">[</span><span class="token variable">$2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">${ETHTOOL<span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span>
    R_PKT<span class="token punctuation">[</span><span class="token variable">$2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">${ETHTOOL<span class="token punctuation">[</span>1<span class="token punctuation">]</span>}</span>
    T_BYTE<span class="token punctuation">[</span><span class="token variable">$2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">${ETHTOOL<span class="token punctuation">[</span>2<span class="token punctuation">]</span>}</span>
    R_BYTE<span class="token punctuation">[</span><span class="token variable">$2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">${ETHTOOL<span class="token punctuation">[</span>3<span class="token punctuation">]</span>}</span>
<span class="token punctuation">}</span>

<span class="token comment"># set initial value</span>
<span class="token assign-left variable">index</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">name</span> <span class="token keyword">in</span> <span class="token variable">$NETIF</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    update_stats <span class="token variable">$name</span> <span class="token variable">$index</span>
    <span class="token variable"><span class="token punctuation">((</span>index<span class="token operator">++</span><span class="token punctuation">))</span></span>
<span class="token keyword">done</span>
</code></pre>
<h1 id="shell&#x811A;&#x672C;&#x89E3;&#x6790;&#x6587;&#x4EF6;-&#x8F93;&#x51FA;&#x53EF;&#x4EE5;&#x5BFC;&#x5165;&#x5230;excel&#x7684;&#x6587;&#x672C;"><a name="shell&#x811A;&#x672C;&#x89E3;&#x6790;&#x6587;&#x4EF6;-&#x8F93;&#x51FA;&#x53EF;&#x4EE5;&#x5BFC;&#x5165;&#x5230;excel&#x7684;&#x6587;&#x672C;" class="anchor-navigation-ex-anchor" href="#shell&#x811A;&#x672C;&#x89E3;&#x6790;&#x6587;&#x4EF6;-&#x8F93;&#x51FA;&#x53EF;&#x4EE5;&#x5BFC;&#x5165;&#x5230;excel&#x7684;&#x6587;&#x672C;"><i class="fa fa-link" aria-hidden="true"></i></a>30. shell&#x811A;&#x672C;&#x89E3;&#x6790;&#x6587;&#x4EF6;, &#x8F93;&#x51FA;&#x53EF;&#x4EE5;&#x5BFC;&#x5165;&#x5230;excel&#x7684;&#x6587;&#x672C;</h1>
<p>&#x6D4B;&#x4E86;&#x5927;&#x7EA6;500&#x6B21;&#x7684;stream, &#x60F3;&#x5728;excel&#x4E0A;&#x7ED8;&#x56FE;.
&#x539F;&#x59CB;&#x6570;&#x636E;&#x683C;&#x5F0F;</p>
<pre class="language-"><code class="lang-sh">STREAM2 fill latency: <span class="token number">0.92</span> nanoseconds
STREAM2 fill bandwidth: <span class="token number">121083.29</span> MB/sec
STREAM2 copy latency: <span class="token number">2.12</span> nanoseconds
STREAM2 copy bandwidth: <span class="token number">105697.16</span> MB/sec
STREAM2 daxpy latency: <span class="token number">3.24</span> nanoseconds
STREAM2 daxpy bandwidth: <span class="token number">103654.31</span> MB/sec
STREAM2 <span class="token function">sum</span> latency: <span class="token number">1.57</span> nanoseconds
STREAM2 <span class="token function">sum</span> bandwidth: <span class="token number">71472.48</span> MB/sec
STREAM2 fill latency: <span class="token number">1.68</span> nanoseconds
STREAM2 fill bandwidth: <span class="token number">66475.08</span> MB/sec
STREAM2 copy latency: <span class="token number">2.11</span> nanoseconds
STREAM2 copy bandwidth: <span class="token number">105921.94</span> MB/sec
STREAM2 daxpy latency: <span class="token number">3.24</span> nanoseconds
STREAM2 daxpy bandwidth: <span class="token number">103562.46</span> MB/sec
STREAM2 <span class="token function">sum</span> latency: <span class="token number">1.57</span> nanoseconds
STREAM2 <span class="token function">sum</span> bandwidth: <span class="token number">71506.36</span> MB/sec
</code></pre>
<p>&#x7528;&#x4E0B;&#x9762;&#x7684;&#x811A;&#x672C;&#x53EF;&#x4EE5;&#x8F93;&#x51FA;&#x4E00;&#x4E2A;excel&#x8BA4;&#x8BC6;&#x7684;&#x6587;&#x672C;</p>
<pre class="language-"><code class="lang-sh"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token string">&quot;fill latency&quot;</span> <span class="token string">&quot;copy latency&quot;</span> <span class="token string">&quot;daxpy latency&quot;</span> <span class="token string">&quot;sum latency&quot;</span> <span class="token string">&quot;fill bandwidth&quot;</span> <span class="token string">&quot;copy bandwidth&quot;</span> <span class="token string">&quot;daxpy bandwidth&quot;</span> <span class="token string">&quot;sum bandwidth&quot;</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token punctuation">(</span>printf <span class="token string">&quot;<span class="token variable">$i</span> <span class="token entity" title="\t">\t</span>&quot;</span> <span class="token operator">&amp;&amp;</span>  <span class="token function">cat</span> stream*.log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&quot;/<span class="token variable">$i</span>/&quot;</span><span class="token string">&apos;{printf $4 &quot;\t&quot;}&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> test.txt<span class="token punctuation">;</span> <span class="token keyword">done</span>
</code></pre>
<ul>
<li>for&#x540E;&#x9762;&#x7684;&#x4E1C;&#x897F;&#x7528;&#x7A7A;&#x683C;&#x5206;&#x5272;</li>
<li>awk&#x662F;&#x6309;&#x884C;&#x64CD;&#x4F5C;&#x7684;, &#x6BD4;&#x5982;&#x7B2C;&#x4E00;&#x884C;&#x4F1A;&#x4E00;&#x6B21;&#x6267;&#x884C;&#x591A;&#x4E2A;{ }&#x64CD;&#x4F5C;</li>
<li>awk&#x91CC;&#x9762;&#x7528;printf&#x8F93;&#x51FA;&#x6CA1;&#x6709;&#x6362;&#x884C;</li>
<li>shell&#x53D8;&#x91CF;&#x8981;&#x4F20;&#x5165;awk, &#x7528;&#x53CC;&#x5F15;&#x53F7;, &#x4E0A;&#x9762;&#x662F;&#x7528;&#x53CC;&#x5F15;&#x53F7;&#x62EC;&#x7684;/pattern/, <code>awk &quot;/$i/&quot;&apos;{printf $4 &quot;\t&quot;}&apos;</code>&#x6CE8;&#x610F;&#x540E;&#x9762;&#x4E0D;&#x52A0;&#x7A7A;&#x683C;. &#x53C2;&#x8003;<a href="https://www.gnu.org/software/gawk/manual/html_node/Using-Shell-Variables.html" target="_blank">https://www.gnu.org/software/gawk/manual/html_node/Using-Shell-Variables.html</a></li>
<li>shell&#x7684;&#x5C0F;&#x62EC;&#x53F7;&#x53EF;&#x4EE5;&#x4E00;&#x8D77;&#x91CD;&#x5B9A;&#x5411;</li>
</ul>
<p>&#x811A;&#x672C;&#x8F93;&#x51FA;&#x6570;&#x636E;&#x793A;&#x4F8B;: &#x4E00;&#x5171;&#x516B;&#x884C;</p>
<pre class="language-"><code class="lang-sh">fill latency     <span class="token number">0.92</span>    <span class="token number">1.68</span>    <span class="token number">1.70</span>    <span class="token number">1.67</span>    <span class="token number">1.69</span>    <span class="token number">1.69</span>    <span class="token number">0.92</span>    <span class="token number">1.67</span>    <span class="token number">1.65</span>
copy latency     <span class="token number">2.12</span>    <span class="token number">2.11</span>    <span class="token number">2.12</span>    <span class="token number">2.27</span>    <span class="token number">2.25</span>    <span class="token number">2.23</span>    <span class="token number">2.22</span>    <span class="token number">2.27</span>    <span class="token number">2.11</span>
daxpy latency     <span class="token number">3.24</span>    <span class="token number">3.24</span>    <span class="token number">3.24</span>    <span class="token number">3.24</span>    <span class="token number">3.11</span>    <span class="token number">3.24</span>    <span class="token number">3.24</span>    <span class="token number">3.24</span>    <span class="token number">3.25</span>
<span class="token function">sum</span> latency     <span class="token number">1.57</span>    <span class="token number">1.57</span>    <span class="token number">1.55</span>    <span class="token number">1.57</span>    <span class="token number">1.56</span>    <span class="token number">1.57</span>    <span class="token number">1.57</span>    <span class="token number">1.57</span>    <span class="token number">1.57</span>
fill bandwidth     <span class="token number">121083.29</span>    <span class="token number">66475.08</span>    <span class="token number">66018.47</span>    <span class="token number">67102.43</span>    <span class="token number">66170.01</span>    <span class="token number">66209.27</span>
copy bandwidth     <span class="token number">105697.16</span>    <span class="token number">105921.94</span>    <span class="token number">105900.48</span>    <span class="token number">98852.60</span>    <span class="token number">99648.56</span>    <span class="token number">100382.3</span>
daxpy bandwidth     <span class="token number">103654.31</span>    <span class="token number">103562.46</span>    <span class="token number">103639.09</span>    <span class="token number">103740.30</span>    <span class="token number">108061.48</span>    <span class="token number">1036</span>
<span class="token function">sum</span> bandwidth     <span class="token number">71472.48</span>    <span class="token number">71506.36</span>    <span class="token number">72182.22</span>    <span class="token number">71490.27</span>    <span class="token number">71900.50</span>    <span class="token number">71472.48</span>
</code></pre>
<h1 id="shell&#x5904;&#x7406;&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;"><a name="shell&#x5904;&#x7406;&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;" class="anchor-navigation-ex-anchor" href="#shell&#x5904;&#x7406;&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>31. shell&#x5904;&#x7406;&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;</h1>
<p>&#x6CE8;&#x610F;shell&#x53D8;&#x91CF;&#x7684;&#x5220;&#x9664; &#x63D2;&#x5165;&#x64CD;&#x4F5C;
&#x6BD4;&#x5982;</p>
<pre class="language-"><code class="lang-sh">     <span class="token assign-left variable">var</span><span class="token operator">=</span><span class="token variable">${arg<span class="token operator">/</span><span class="token operator">#</span>--no-}</span>
    <span class="token comment"># remove all dashes for variable names:</span>
    <span class="token builtin class-name">eval</span> <span class="token variable">${var<span class="token operator">/</span><span class="token operator">/</span>-}</span><span class="token operator">=</span><span class="token number">0</span>
</code></pre>
<pre class="language-"><code class="lang-sh"><span class="token keyword">while</span> <span class="token variable"><span class="token punctuation">((</span>$#<span class="token punctuation">))</span></span>
<span class="token keyword">do</span>
    <span class="token assign-left variable">arg</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token builtin class-name">shift</span>
    <span class="token keyword">case</span> <span class="token string">&quot;<span class="token variable">${arg<span class="token operator">:-</span>}</span>&quot;</span> <span class="token keyword">in</span>
 --verbose<span class="token operator">|</span>-v<span class="token punctuation">)</span>
     <span class="token builtin class-name">set</span> <span class="token parameter variable">-x</span>
     <span class="token punctuation">;</span><span class="token punctuation">;</span>
 --help<span class="token operator">|</span>-h<span class="token operator">|</span><span class="token string">&apos;&apos;</span><span class="token punctuation">)</span>
     <span class="token builtin class-name">help</span>
     <span class="token builtin class-name">exit</span> <span class="token number">0</span>
     <span class="token punctuation">;</span><span class="token punctuation">;</span>
 --*<span class="token punctuation">\</span><span class="token operator">=</span>*<span class="token punctuation">)</span>
     <span class="token comment"># make variables from options</span>
     <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">&apos;=&apos;</span> <span class="token builtin class-name">read</span> var value <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">&quot;<span class="token variable">$arg</span>&quot;</span>
     <span class="token comment"># remove all dashes for variable names, avoid tilde</span>
     <span class="token comment"># expansion with quoting:</span>
     <span class="token builtin class-name">eval</span> <span class="token variable">${var<span class="token operator">/</span><span class="token operator">/</span>-}</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$value</span>&quot;</span>
     <span class="token punctuation">;</span><span class="token punctuation">;</span>
 --no-*<span class="token punctuation">)</span>
     <span class="token assign-left variable">var</span><span class="token operator">=</span><span class="token variable">${arg<span class="token operator">/</span><span class="token operator">#</span>--no-}</span>
     <span class="token comment"># remove all dashes for variable names:</span>
     <span class="token builtin class-name">eval</span> <span class="token variable">${var<span class="token operator">/</span><span class="token operator">/</span>-}</span><span class="token operator">=</span><span class="token number">0</span>
     <span class="token punctuation">;</span><span class="token punctuation">;</span>
 --*<span class="token punctuation">)</span>
     <span class="token comment"># remove all dashes for variable names:</span>
     <span class="token builtin class-name">eval</span> <span class="token variable">${arg<span class="token operator">/</span><span class="token operator">/</span>-}</span><span class="token operator">=</span><span class="token number">1</span>
     <span class="token punctuation">;</span><span class="token punctuation">;</span>
 -*<span class="token punctuation">)</span>
     <span class="token builtin class-name">echo</span> <span class="token string">&quot;Invalid option: <span class="token variable">$arg</span>&quot;</span>
     <span class="token builtin class-name">exit</span> <span class="token number">1</span>
     <span class="token punctuation">;</span><span class="token punctuation">;</span>
 *<span class="token punctuation">)</span>
     <span class="token assign-left variable">stage</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>get_stage $arg<span class="token variable">)</span></span>
     <span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$stage</span>&quot;</span>
     <span class="token keyword">then</span>
  <span class="token builtin class-name">eval</span> <span class="token variable">$stage</span>
     <span class="token keyword">elif</span> is_target <span class="token variable">$arg</span>
     <span class="token keyword">then</span>
  <span class="token assign-left variable">target</span><span class="token operator">=</span><span class="token variable">$arg</span>
     <span class="token keyword">else</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Invalid command: <span class="token variable">$arg</span>&quot;</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
     <span class="token keyword">fi</span>
     <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token keyword">esac</span>
<span class="token keyword">done</span>
</code></pre>
<h1 id="shell&#x4E5F;&#x53EF;&#x4EE5;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x51FD;&#x6570;"><a name="shell&#x4E5F;&#x53EF;&#x4EE5;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#shell&#x4E5F;&#x53EF;&#x4EE5;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>32. shell&#x4E5F;&#x53EF;&#x4EE5;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x51FD;&#x6570;</h1>
<p>&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x6DF1;&#x5EA6;&#x6E05;&#x9664;git&#x5E93;&#x4E0B;&#x9762;&#x7684;&#x672A;&#x88AB;&#x8DDF;&#x8E2A;&#x7684;&#x6587;&#x4EF6;, &#x5305;&#x62EC;&#x5176;&#x4E0B;&#x9762;&#x7684;&#x5B50;git&#x5E93;</p>
<pre class="language-"><code class="lang-sh"><span class="token shebang important">#!/bin/sh</span>

<span class="token function-name function">gitpurge_r</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token builtin class-name">local</span> <span class="token assign-left variable">cwd</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>
 <span class="token builtin class-name">local</span> <span class="token assign-left variable">subgit</span><span class="token operator">=</span><span class="token variable">$1</span>
 <span class="token builtin class-name">cd</span> <span class="token variable">$subgit</span>
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;deep cleaning <span class="token variable">$subgit</span>&quot;</span>
 <span class="token builtin class-name">local</span> <span class="token assign-left variable">subgits</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">`</span><span class="token function">git</span> clean <span class="token parameter variable">-fdx</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&apos;Skipping repository&apos;</span> <span class="token operator">|</span> <span class="token function">cut</span> -d<span class="token string">&apos; &apos;</span> <span class="token parameter variable">-f3</span><span class="token variable">`</span></span>&quot;</span>
 <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$subgits</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token keyword">for</span> <span class="token for-or-select variable">g</span> <span class="token keyword">in</span> <span class="token variable">$subgits</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
   gitpurge_r <span class="token variable">$g</span>
  <span class="token keyword">done</span>
 <span class="token keyword">fi</span>
 <span class="token builtin class-name">cd</span> <span class="token variable">$cwd</span>
<span class="token punctuation">}</span>

gitpurge_r <span class="token builtin class-name">.</span>
</code></pre>
<h2 id="&#x6539;&#x8FDB;&#x7248;&#x672C;"><a name="&#x6539;&#x8FDB;&#x7248;&#x672C;" class="anchor-navigation-ex-anchor" href="#&#x6539;&#x8FDB;&#x7248;&#x672C;"><i class="fa fa-link" aria-hidden="true"></i></a>32.1. &#x6539;&#x8FDB;&#x7248;&#x672C;</h2>
<pre class="language-"><code class="lang-sh"><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">B</span><span class="token operator">=</span><span class="token string">&quot;<span class="token entity" title="\033">\033</span>[1;37;40m&quot;</span>
<span class="token assign-left variable">N</span><span class="token operator">=</span><span class="token string">&quot;<span class="token entity" title="\033">\033</span>[0m&quot;</span>

<span class="token assign-left variable">top_dir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>
<span class="token assign-left variable">remote</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">git</span> remote <span class="token parameter variable">-v</span> <span class="token operator">|</span> <span class="token function">grep</span> fetch <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&apos;{print $2}&apos;</span><span class="token variable">`</span></span>
<span class="token assign-left variable">repos_branch</span><span class="token operator">=</span><span class="token string">&apos;./master bootloader/edk2/thunder-stable bootloader/grub2/grub/master bootloader/trusted-firmware/atf/thunder-stable bootloader/u-boot/thunder-stable linux/kernel/linux-aarch64/thunder-stable&apos;</span>

<span class="token keyword">function</span> <span class="token function-name function">reset_current</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token assign-left variable">remote_branch</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">git</span> branch <span class="token parameter variable">-vv</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;\*&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">&apos;s/.*\[(.*)\].*/\1/g&apos;</span> <span class="token operator">|</span> <span class="token function">cut</span> -d: <span class="token parameter variable">-f1</span><span class="token variable">`</span></span>
 <span class="token builtin class-name">echo</span> <span class="token operator">==</span><span class="token operator">=</span>reseting with <span class="token variable">$remote_branch</span>
 <span class="token function">git</span> reset <span class="token parameter variable">--hard</span> <span class="token variable">$remote_branch</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">repo_branch</span> <span class="token keyword">in</span> <span class="token variable">$repos_branch</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
 <span class="token assign-left variable">repo</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">dirname</span> $repo_branch<span class="token variable">`</span></span>
 <span class="token assign-left variable">branch</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">basename</span> $repo_branch<span class="token variable">`</span></span>
 <span class="token builtin class-name">cd</span> <span class="token variable">$top_dir</span>

 <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token variable">$repo</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> 
  <span class="token builtin class-name">echo</span> cloning <span class="token variable">$repo</span> 
  <span class="token builtin class-name">cd</span> <span class="token variable"><span class="token variable">`</span><span class="token function">dirname</span> $repo<span class="token variable">`</span></span>
  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$repo</span> <span class="token operator">==</span> bdk <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
   <span class="token function">git</span> clone <span class="token variable">$remote</span>/<span class="token variable">$repo</span>
  <span class="token keyword">else</span>
   <span class="token function">git</span> clone <span class="token parameter variable">-b</span> fae <span class="token variable">$remote</span>/<span class="token variable">$repo</span>
  <span class="token keyword">fi</span>
 <span class="token keyword">fi</span>

 <span class="token builtin class-name">cd</span> <span class="token variable">$top_dir</span>/<span class="token variable">$repo</span>

 <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">$B</span><span class="token string">&quot;&gt;&gt;&gt;<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>&quot;</span><span class="token variable">$N</span>
 <span class="token keyword">case</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token keyword">in</span>
  purge<span class="token punctuation">)</span>
   <span class="token builtin class-name">echo</span> <span class="token operator">==</span>deep cleaning<span class="token punctuation">..</span>.
   <span class="token function">git</span> clean <span class="token parameter variable">-fdx</span>
   <span class="token punctuation">;</span><span class="token punctuation">;</span>
  fetch<span class="token punctuation">)</span>
   <span class="token builtin class-name">echo</span> <span class="token operator">==</span>fetching from remote<span class="token punctuation">..</span>.
   <span class="token function">git</span> fetch <span class="token parameter variable">--all</span>
   <span class="token punctuation">;</span><span class="token punctuation">;</span>
  merge<span class="token punctuation">)</span>
   <span class="token builtin class-name">echo</span> <span class="token operator">==</span>merging workspace with <span class="token variable">$branch</span><span class="token punctuation">..</span>.
   <span class="token function">git</span> merge origin/<span class="token variable">$branch</span> --no-commit
   <span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token comment">#upsync MUST be only used on my mint mechine</span>
  upsync<span class="token punctuation">)</span>
   <span class="token builtin class-name">echo</span> <span class="token operator">==</span>fetching all
   <span class="token function">git</span> fetch <span class="token parameter variable">--all</span>
   <span class="token builtin class-name">echo</span> <span class="token operator">==</span>reseting with remote master
   reset_current
   <span class="token builtin class-name">echo</span> <span class="token operator">==</span>chekouting <span class="token variable">$branch</span>
   <span class="token function">git</span> checkout <span class="token variable">$branch</span>
   <span class="token builtin class-name">echo</span> <span class="token operator">==</span>reseting with remote stable 
   reset_current
   <span class="token builtin class-name">echo</span> <span class="token operator">==</span>going back to master
   <span class="token function">git</span> checkout -
   <span class="token punctuation">;</span><span class="token punctuation">;</span>
  *<span class="token punctuation">)</span>
   <span class="token builtin class-name">echo</span> <span class="token operator">==</span>doing <span class="token punctuation">[</span><span class="token string">&quot;<span class="token variable">$@</span>&quot;</span><span class="token punctuation">]</span>
   <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
   <span class="token punctuation">;</span><span class="token punctuation">;</span>
 <span class="token keyword">esac</span>
 <span class="token builtin class-name">echo</span>
<span class="token keyword">done</span>
</code></pre>
<h1 id="local-system-monitor"><a name="local-system-monitor" class="anchor-navigation-ex-anchor" href="#local-system-monitor"><i class="fa fa-link" aria-hidden="true"></i></a>33. local system monitor</h1>
<pre class="language-"><code class="lang-sh">./sysmonitor.sh <span class="token parameter variable">-f</span> test.f <span class="token parameter variable">-t</span> <span class="token string">&quot;just want to test it&quot;</span>
</code></pre>
<pre class="language-"><code class="lang-sh"><span class="token shebang important">#! /bin/bash</span>

<span class="token assign-left variable">B</span><span class="token operator">=</span><span class="token string">&quot;<span class="token entity" title="\033">\033</span>[1;37;40m&quot;</span>
<span class="token assign-left variable">N</span><span class="token operator">=</span><span class="token string">&quot;<span class="token entity" title="\033">\033</span>[0m&quot;</span>

<span class="token assign-left variable">file</span><span class="token operator">=</span>
<span class="token assign-left variable">interval</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">sleepsec</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token assign-left variable">title</span><span class="token operator">=</span>

<span class="token keyword">while</span> <span class="token builtin class-name">getopts</span> <span class="token string">&quot;f:i:s:t:&quot;</span> arg <span class="token comment">#: needs para </span>
<span class="token keyword">do</span>
    <span class="token keyword">case</span> <span class="token variable">$arg</span> <span class="token keyword">in</span>
        f<span class="token punctuation">)</span>
            <span class="token assign-left variable">file</span><span class="token operator">=</span><span class="token variable">$OPTARG</span> <span class="token comment">#$OPTARG is the para</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
        i<span class="token punctuation">)</span>
            <span class="token assign-left variable">interval</span><span class="token operator">=</span><span class="token variable">$OPTARG</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
        s<span class="token punctuation">)</span>
            <span class="token assign-left variable">sleepsec</span><span class="token operator">=</span><span class="token variable">$OPTARG</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
        t<span class="token punctuation">)</span>
            <span class="token assign-left variable">title</span><span class="token operator">=</span><span class="token variable">$OPTARG</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
        ?<span class="token punctuation">)</span> 
            <span class="token builtin class-name">echo</span> <span class="token string">&quot;unkonw argument&quot;</span>
            <span class="token builtin class-name">exit</span> <span class="token number">1</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token keyword">esac</span>
<span class="token keyword">done</span>

<span class="token comment">#exec &amp;&gt; $output #output to file</span>

<span class="token keyword">function</span> <span class="token function-name function">do_syscollect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token variable">$title</span>
    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">$B</span><span class="token string">&quot;start system statistics collecting&quot;</span><span class="token variable">$N</span>
    <span class="token function">dmesg</span> <span class="token parameter variable">-c</span>

    <span class="token keyword">while</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-f</span> <span class="token string">&quot;<span class="token variable">$file</span>&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">do</span>
        <span class="token builtin class-name">echo</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">$B</span><span class="token string">&quot;========================collecting system status===========================&quot;</span><span class="token variable">$N</span>
        <span class="token builtin class-name">echo</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">$B</span><span class="token string">&quot;===date&quot;</span><span class="token variable">$N</span>
        <span class="token function">date</span>
        <span class="token builtin class-name">echo</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">$B</span><span class="token string">&quot;===dmesg&quot;</span><span class="token variable">$N</span>
        <span class="token function">dmesg</span> <span class="token parameter variable">-c</span>
        <span class="token builtin class-name">echo</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">$B</span><span class="token string">&quot;===top&quot;</span><span class="token variable">$N</span>
        <span class="token function">top</span> <span class="token parameter variable">-bn1</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-15</span>
        <span class="token builtin class-name">echo</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">$B</span><span class="token string">&quot;===sar&quot;</span><span class="token variable">$N</span>
        sar <span class="token parameter variable">-n</span> DEV <span class="token parameter variable">-u</span> <span class="token parameter variable">-dp</span> <span class="token parameter variable">-r</span> <span class="token variable">$interval</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">grep</span> Average
        <span class="token function">sleep</span> <span class="token variable">$sleepsec</span>
    <span class="token keyword">done</span>
<span class="token punctuation">}</span>

do_syscollect <span class="token operator">|</span> ts
</code></pre>
<h1 id="system-monitor-for-pangu"><a name="system-monitor-for-pangu" class="anchor-navigation-ex-anchor" href="#system-monitor-for-pangu"><i class="fa fa-link" aria-hidden="true"></i></a>34. system monitor for pangu</h1>
<pre class="language-"><code class="lang-sh">$ <span class="token function">cat</span> statistics.sh 
<span class="token comment">#! /bin/bash</span>

<span class="token assign-left variable">B</span><span class="token operator">=</span><span class="token string">&quot;<span class="token entity" title="\033">\033</span>[1;37;40m&quot;</span>
<span class="token assign-left variable">N</span><span class="token operator">=</span><span class="token string">&quot;<span class="token entity" title="\033">\033</span>[0m&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">$B</span><span class="token string">&quot;start system statistics collecting&quot;</span><span class="token variable">$N</span>

./alldo.sh <span class="token function">dmesg</span> <span class="token parameter variable">-c</span>
<span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">do</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">$B</span><span class="token string">&quot;========================collecting system status===========================&quot;</span><span class="token variable">$N</span>
        <span class="token builtin class-name">echo</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">$B</span><span class="token string">&quot;===date&quot;</span><span class="token variable">$N</span>
        ./alldo.sh <span class="token string">&apos;date&apos;</span>
        <span class="token builtin class-name">echo</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">$B</span><span class="token string">&quot;===dmesg&quot;</span><span class="token variable">$N</span>
        ./alldo.sh <span class="token string">&apos;dmesg&apos;</span>
        <span class="token builtin class-name">echo</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">$B</span><span class="token string">&quot;===top&quot;</span><span class="token variable">$N</span>
        ./alldo.sh <span class="token string">&apos;top -bn1 | head -15&apos;</span>
        <span class="token builtin class-name">echo</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">$B</span><span class="token string">&quot;===pangu&quot;</span><span class="token variable">$N</span>
        ./alldo.sh <span class="token string">&quot;ps -ef | egrep &apos;pangu|tubo|nuwa_agent|deploy_agent|chunkserver&apos;&quot;</span>
        <span class="token builtin class-name">echo</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">$B</span><span class="token string">&quot;===sar&quot;</span><span class="token variable">$N</span>
        ./alldo.sh <span class="token string">&apos;sar -n DEV -u -dp -r 5 1 | grep Average&apos;</span>
        <span class="token function">sleep</span> <span class="token variable"><span class="token variable">$((</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">1</span><span class="token variable">))</span></span>
<span class="token keyword">done</span>
</code></pre>
<pre class="language-"><code class="lang-sh">$ <span class="token function">cat</span> logstat.sh 
<span class="token comment">#! /bin/bash</span>

<span class="token assign-left variable">B</span><span class="token operator">=</span><span class="token string">&quot;<span class="token entity" title="\033">\033</span>[1;37;40m&quot;</span>
<span class="token assign-left variable">N</span><span class="token operator">=</span><span class="token string">&quot;<span class="token entity" title="\033">\033</span>[0m&quot;</span>

<span class="token assign-left variable">logfile</span><span class="token operator">=</span><span class="token variable">${1<span class="token operator">:-</span>log}</span>

./statistics.sh <span class="token operator">|</span> ts <span class="token operator">|</span> <span class="token function">tee</span> <span class="token variable">$logfile</span>
</code></pre>
<pre class="language-"><code>$ cat alldo.sh 
#! /bin/bash

B=&quot;\033[1;37;40m&quot;
N=&quot;\033[0m&quot;

atlocal=F

servers=&quot;
yingjie@192.168.85.10
byj@localhost
&quot;

cvmservers=&quot;
root@10.97.219.6
root@10.97.219.55
root@10.97.219.21
root@10.97.219.44
root@10.97.219.53
root@10.97.219.50
root@10.97.219.214
root@10.97.219.13
root@10.97.219.47
root@10.97.219.69
&quot;

if [ &quot;$1&quot; = &quot;-l&quot; ]; then
        atlocal=T
        shift
fi

for i in $cvmservers; do
        ip=${i#*@}
        echo
        echo -e $B&quot;&gt;&gt;&gt;$i&quot;$N
        if [ &quot;$atlocal&quot; = &quot;T&quot; ]; then
                eval &quot;$*&quot;
        else
                ssh $i &quot;$*&quot;
        fi
done
</code></pre><h1 id="&#x589E;&#x52A0;fedora&#x5206;&#x533A;&#x7684;&#x811A;&#x672C;"><a name="&#x589E;&#x52A0;fedora&#x5206;&#x533A;&#x7684;&#x811A;&#x672C;" class="anchor-navigation-ex-anchor" href="#&#x589E;&#x52A0;fedora&#x5206;&#x533A;&#x7684;&#x811A;&#x672C;"><i class="fa fa-link" aria-hidden="true"></i></a>35. &#x589E;&#x52A0;fedora&#x5206;&#x533A;&#x7684;&#x811A;&#x672C;</h1>
<p>&#x8FD9;&#x91CC;&#x9762;&#x6709;shrink&#x539F;&#x5206;&#x533A;(ubuntu), &#x589E;&#x52A0;fedora&#x5206;&#x533A;&#x5E76;&#x62F7;&#x8D1D;fedora&#x7684;fs</p>
<pre class="language-"><code class="lang-sh"><span class="token assign-left variable">work_dir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>
<span class="token assign-left variable">dev</span><span class="token operator">=</span><span class="token variable">${1<span class="token operator">:-</span><span class="token operator">/</span>dev<span class="token operator">/</span>sdc}</span>
<span class="token assign-left variable">ubuntu_size</span><span class="token operator">=</span><span class="token variable">${2<span class="token operator">:-</span>500G}</span>
<span class="token assign-left variable">tar_fedora</span><span class="token operator">=</span><span class="token variable">${3<span class="token operator">:-</span>fedora-with-native-kernel-repo-gcc-update-to-20150423.tar.bz2}</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-b</span> <span class="token variable">$dev</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$dev</span> not found&quot;</span>
 <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-b</span> <span class="token variable">${dev}</span><span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;fedora already exists, nothing to do&quot;</span>
 <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> <span class="token variable">$tar_fedora</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;file <span class="token variable">$tar_fedora</span> not found&quot;</span>
 <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;resizing ubuntu fs&quot;</span>
e2fsck <span class="token parameter variable">-f</span> <span class="token variable">${dev}</span><span class="token number">2</span> <span class="token parameter variable">-y</span>
resize2fs <span class="token variable">${dev}</span><span class="token number">2</span> <span class="token variable">$ubuntu_size</span> 

<span class="token builtin class-name">echo</span> <span class="token string">&quot;resizing ubuntu partition&quot;</span>
gdisk <span class="token variable">$dev</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF
d
2

n


+<span class="token variable">$ubuntu_size</span>


n





w
y
EOF</span>

<span class="token function">sleep</span> <span class="token number">2</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;making file system for fedora&quot;</span>
mkfs.ext4 <span class="token variable">${dev}</span><span class="token number">3</span>

<span class="token builtin class-name">cd</span> <span class="token variable">$work_dir</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;installing grub into defora partition&quot;</span>
<span class="token builtin class-name">cd</span> sdk-master
<span class="token builtin class-name">source</span> env-setup <span class="token assign-left variable">BOARD_TYPE</span><span class="token operator">=</span>crb-2s
<span class="token builtin class-name">cd</span> host/bin
<span class="token comment">#reinstall grub on fedora partition, as well as kernel Image...</span>
./create_disk.sh --install-grub2 <span class="token variable">${dev}</span><span class="token number">1</span> <span class="token variable">${dev}</span><span class="token number">3</span> /boot


<span class="token comment">#cd $work_dir</span>
<span class="token comment">#echo &quot;untaring fedora&quot;</span>
<span class="token comment">#mount ${dev}3 mnt</span>
<span class="token comment">#cd mnt</span>
<span class="token comment">#tar xvf ../$tar_fedora</span>
<span class="token comment">#cd ..</span>
<span class="token comment">#umount mnt</span>


<span class="token comment">#cd $work_dir</span>
<span class="token comment">#echo &quot;installing modules on fedora&quot;</span>
<span class="token comment">#./create_disk.sh --install-modules ${dev}3</span>


<span class="token comment">#cd $work_dir</span>
<span class="token comment">#echo &quot;some tuning&quot;</span>
<span class="token comment">#mount ${dev}3 mnt</span>
<span class="token comment">#cd mnt</span>
<span class="token comment">##clear fstab</span>
<span class="token comment">#echo &gt; etc/fstab</span>
<span class="token comment">##grub</span>
<span class="token comment">#sed -i &quot;/set timeout/a\\\nmenuentry &apos;Thunder Fedora Boot&apos; {\n\tlinux /boot/vmlinuz root=/dev/sda3 console=ttyAMA0,115200n8 earlycon=pl011,0x87e024000000 coherent_pool=16M rootwait rw transparent_hugepage=never\n\tboot\n}\n&quot; boot/grub/grub.cfg</span>
<span class="token comment">#find lib/modules -name rtc-efi.ko | xargs -i mv {} {}.bak</span>
<span class="token comment">#cd ..</span>
<span class="token comment">#umount mnt</span>

<span class="token function">sync</span>
<span class="token builtin class-name">cd</span> <span class="token variable">$work_dir</span>
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="shell_基础篇.html" class="navigation navigation-prev " aria-label="Previous page: shell命令和脚本记录-基础篇">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="shell_脚本片段.html" class="navigation navigation-next " aria-label="Next page: shell脚本片段">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"shell命令和脚本记录-高级篇","level":"1.12.3","depth":2,"next":{"title":"shell脚本片段","level":"1.12.4","depth":2,"path":"notes/shell_脚本片段.md","ref":"notes/shell_脚本片段.md","articles":[]},"previous":{"title":"shell命令和脚本记录-基础篇","level":"1.12.2","depth":2,"path":"notes/shell_基础篇.md","ref":"notes/shell_基础篇.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-livereload","-sharing","-lunr","-search","search-plus","-highlight","theme-comscore","prism","code","chapter-fold","github","splitter","wide-page","hide-navigation-buttons","anchor-navigation-ex","sequence"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"chapter-fold":{},"prism":{"css":["prismjs/themes/prism.css"]},"sequence":{"theme":"simple"},"github":{"url":"https://github.com/Bai-Yingjie/Bai-Yingjie.github.io"},"splitter":{},"wide-page":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"hide-navigation-buttons":{},"anchor-navigation-ex":{"mode":"float","pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"isRewritePageTitle":true,"showLevel":true,"tocLevel1Icon":"fa fa-hand-o-right","tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right","showGoTop":true,"isShowTocTitleIcon":true,"printLog":false,"multipleH1":true,"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false}},"theme-comscore":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"search-plus":{}},"theme":"default","author":"Bai Yingjie","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"My Notes","language":"zh-hans","gitbook":"*"},"file":{"path":"notes/shell_高级篇.md","mtime":"2022-10-18T02:49:37.686Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-10-18T02:50:48.055Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

