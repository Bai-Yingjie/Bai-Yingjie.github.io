
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>网络虚拟化用例记录 · My Notes</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Bai Yingjie">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-wide-page/wide.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hide-navigation-buttons/index.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="networking_网络虚拟化操作记录.html" />
    
    
    <link rel="prev" href="OVS_phy-vm-phy.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="as_title_kaiyuan.html">
            
                <a href="as_title_kaiyuan.html">
            
                    
                    开源
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="my_opensource.html">
            
                <a href="my_opensource.html">
            
                    
                    我的开源项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="my_upstream.html">
            
                <a href="my_upstream.html">
            
                    
                    我的upstream commit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="as_title_system.html">
            
                <a href="as_title_system.html">
            
                    
                    系统分析和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="as_title_perf_misc.html">
            
                <a href="as_title_perf_misc.html">
            
                    
                    调试和分析记录杂记系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="profiling_调试和分析记录4.html">
            
                <a href="profiling_调试和分析记录4.html">
            
                    
                    调试和分析记录4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="profiling_调试和分析记录3.html">
            
                <a href="profiling_调试和分析记录3.html">
            
                    
                    调试和分析记录3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="profiling_调试和分析记录2.html">
            
                <a href="profiling_调试和分析记录2.html">
            
                    
                    调试和分析记录2
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="as_title_perf_tools.html">
            
                <a href="as_title_perf_tools.html">
            
                    
                    profiling工具相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="profiling_perf命令备忘录.html">
            
                <a href="profiling_perf命令备忘录.html">
            
                    
                    perf命令备忘录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="profiling_ftrace和trace-cmd记录.html">
            
                <a href="profiling_ftrace和trace-cmd记录.html">
            
                    
                    ftrace和trace-cmd记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="profiling_ftrace使用实例.html">
            
                <a href="profiling_ftrace使用实例.html">
            
                    
                    ftrace使用实例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="system_analysis_bcc和ebpf.html">
            
                <a href="system_analysis_bcc和ebpf.html">
            
                    
                    bcc和ebpf(starting)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="as_title_app_perf.html">
            
                <a href="as_title_app_perf.html">
            
                    
                    应用profiling和优化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="performance_ovs进程调查.html">
            
                <a href="performance_ovs进程调查.html">
            
                    
                    OVS进程调查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="performance_ping流程和函数调用解析.html">
            
                <a href="performance_ping流程和函数调用解析.html">
            
                    
                    ping流程和函数调用解析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="as_title_os_perf.html">
            
                <a href="as_title_os_perf.html">
            
                    
                    系统profiling和优化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="CentOS_系统性能优化配置.html">
            
                <a href="CentOS_系统性能优化配置.html">
            
                    
                    CentOS 性能优化系统配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="as_title_arch_perf.html">
            
                <a href="as_title_arch_perf.html">
            
                    
                    CPU ARCH相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1" data-path="performance_CPU_microarchiteture_pmu.html">
            
                <a href="performance_CPU_microarchiteture_pmu.html">
            
                    
                    Top-down Microarchitecture Analysis Method(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="as_title_cloud.html">
            
                <a href="as_title_cloud.html">
            
                    
                    Cloud和容器相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="cloud_杂记.html">
            
                <a href="cloud_杂记.html">
            
                    
                    云杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="container_当代容器读书笔记.html">
            
                <a href="container_当代容器读书笔记.html">
            
                    
                    当代容器读书笔记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="as_title_vdevice.html">
            
                <a href="as_title_vdevice.html">
            
                    
                    CPU和device虚拟化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="as_title_gvisor.html">
            
                <a href="as_title_gvisor.html">
            
                    
                    gvisor
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="golang_gvisor代码_KVM.html">
            
                <a href="golang_gvisor代码_KVM.html">
            
                    
                    gvisor KVM模式代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="golang_gvisor调试.html">
            
                <a href="golang_gvisor调试.html">
            
                    
                    gvisor调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="golang_gvisor_ptrace.html">
            
                <a href="golang_gvisor_ptrace.html">
            
                    
                    gvisor ptrace模式介绍(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="rust_vmm_brief.html">
            
                <a href="rust_vmm_brief.html">
            
                    
                    rust VMM(virtual machine monitor)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="rust_vmm_简介.html">
            
                <a href="rust_vmm_简介.html">
            
                    
                    rust-vmm简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="rust_firecracker_代码.html">
            
                <a href="rust_firecracker_代码.html">
            
                    
                    firecracker代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="rust_firecracker_使用.html">
            
                <a href="rust_firecracker_使用.html">
            
                    
                    firecracker使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="rust_cloud-hypervisor_代码.html">
            
                <a href="rust_cloud-hypervisor_代码.html">
            
                    
                    cloud hypervisor代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.5" data-path="rust_cloud-hypervisor_使用.html">
            
                <a href="rust_cloud-hypervisor_使用.html">
            
                    
                    cloud hypervisor使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.6" data-path="rust_cloud-hypervisor_问题与解决.html">
            
                <a href="rust_cloud-hypervisor_问题与解决.html">
            
                    
                    cloud hypervisor问题与解决
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="virtualization_virtio规范阅读笔记.html">
            
                <a href="virtualization_virtio规范阅读笔记.html">
            
                    
                    virtio规范阅读笔记.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="qemu_ovs_虚拟化环境.html">
            
                <a href="qemu_ovs_虚拟化环境.html">
            
                    
                    qemu OVS 虚拟化环境准备
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="qemu使用.html">
            
                <a href="qemu使用.html">
            
                    
                    Qemu使用(old)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="as_title_networking.html">
            
                <a href="as_title_networking.html">
            
                    
                    计算机网络相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="networking_杂记1.html">
            
                <a href="networking_杂记1.html">
            
                    
                    networking杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="as_title_qemu_ovs.html">
            
                <a href="as_title_qemu_ovs.html">
            
                    
                    Qemu OVS和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="OVS_DPDK_编译运行.html">
            
                <a href="OVS_DPDK_编译运行.html">
            
                    
                    OVS-DPDK编译运行
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.2" data-path="OVS_架构和代码.html">
            
                <a href="OVS_架构和代码.html">
            
                    
                    OVS架构和代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.3" data-path="OVS_DPDK_performance_HXT_ARM_server.html">
            
                <a href="OVS_DPDK_performance_HXT_ARM_server.html">
            
                    
                    OVS-DPDK for ARM server 性能测试环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.4" data-path="DPDK_Mellanox.html">
            
                <a href="DPDK_Mellanox.html">
            
                    
                    DPDK Mellanox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.5" data-path="OVS_phy-vm-phy.html">
            
                <a href="OVS_phy-vm-phy.html">
            
                    
                    OVS PHY-VM-PHY
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.2.6" data-path="networking_网络虚拟化用例记录.html">
            
                <a href="networking_网络虚拟化用例记录.html">
            
                    
                    网络虚拟化用例记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.7" data-path="networking_网络虚拟化操作记录.html">
            
                <a href="networking_网络虚拟化操作记录.html">
            
                    
                    网络虚拟化操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="as_title_virtnet.html">
            
                <a href="as_title_virtnet.html">
            
                    
                    虚拟化网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.3.1" data-path="networking_tc_filter_连接veth和tap.html">
            
                <a href="networking_tc_filter_连接veth和tap.html">
            
                    
                    Connecting a veth device to tap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.2" data-path="networking_multicast_vxlan_flannel.html">
            
                <a href="networking_multicast_vxlan_flannel.html">
            
                    
                    multicast vxlan和flannel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.3" data-path="networking_virtio网络介绍.html">
            
                <a href="networking_virtio网络介绍.html">
            
                    
                    virtio网络介绍(网摘): vhost-net virtio-net vhost-user SRIOV
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.4" data-path="networking_virtualization_杂记.html">
            
                <a href="networking_virtualization_杂记.html">
            
                    
                    虚拟化网络杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.5" data-path="networking_linux虚拟网络接口.html">
            
                <a href="networking_linux虚拟网络接口.html">
            
                    
                    linux虚拟网络接口(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="as_title_arm_server.html">
            
                <a href="as_title_arm_server.html">
            
                    
                    ARM server
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="arm_server_杂记.html">
            
                <a href="arm_server_杂记.html">
            
                    
                    Arm server 杂记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="as_title_embedded.html">
            
                <a href="as_title_embedded.html">
            
                    
                    嵌入式系统开发调试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="embedded_debugging.html">
            
                <a href="embedded_debugging.html">
            
                    
                    嵌入式调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="uboot_杂记.html">
            
                <a href="uboot_杂记.html">
            
                    
                    uboot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="buildroot_杂记.html">
            
                <a href="buildroot_杂记.html">
            
                    
                    buildroot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="toolchain_升级gcc问题解决.html">
            
                <a href="toolchain_升级gcc问题解决.html">
            
                    
                    升级GCC7.3问题解决
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="as_title_linuxdaily.html">
            
                <a href="as_title_linuxdaily.html">
            
                    
                    Linux工程实践
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="linux_日常使用.html">
            
                <a href="linux_日常使用.html">
            
                    
                    日常linux使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="git_日常使用.html">
            
                <a href="git_日常使用.html">
            
                    
                    日常git使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="向kernel提交补丁.html">
            
                <a href="向kernel提交补丁.html">
            
                    
                    向kernel提交补丁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="linux_ssh_relay.html">
            
                <a href="linux_ssh_relay.html">
            
                    
                    ssh relay
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="gitlab_ci.html">
            
                <a href="gitlab_ci.html">
            
                    
                    gitlab CI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="docker_操作记录.html">
            
                <a href="docker_操作记录.html">
            
                    
                    docker操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="centos_操作记录.html">
            
                <a href="centos_操作记录.html">
            
                    
                    centos操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="as_title_golang.html">
            
                <a href="as_title_golang.html">
            
                    
                    Golang
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="as_title_golang1.html">
            
                <a href="as_title_golang1.html">
            
                    
                    入门
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1.1" data-path="golang_语法基础.html">
            
                <a href="golang_语法基础.html">
            
                    
                    Golang 语法基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.2" data-path="golang_json性能.html">
            
                <a href="golang_json性能.html">
            
                    
                    Golang json性能比较
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="golang_原理.html">
            
                <a href="golang_原理.html">
            
                    
                    Golang 原理相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.1" data-path="golang_interface原理.html">
            
                <a href="golang_interface原理.html">
            
                    
                    Golang interface原理(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.2" data-path="golang_内存分配.html">
            
                <a href="golang_内存分配.html">
            
                    
                    Golang 内存分配(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="golang_标准库.html">
            
                <a href="golang_标准库.html">
            
                    
                    Golang 标准库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="golang_我的反射代码.html">
            
                <a href="golang_我的反射代码.html">
            
                    
                    Golang 我的反射代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="golang_问答.html">
            
                <a href="golang_问答.html">
            
                    
                    Golang 问答
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="golang_高效go.html">
            
                <a href="golang_高效go.html">
            
                    
                    Golang 高效go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="golang_进阶.html">
            
                <a href="golang_进阶.html">
            
                    
                    Golang 进阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="as_title_golang2.html">
            
                <a href="as_title_golang2.html">
            
                    
                    Golang 杂记
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.8.1" data-path="golang_杂记1.html">
            
                <a href="golang_杂记1.html">
            
                    
                    Golang 杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.2" data-path="golang_杂记2.html">
            
                <a href="golang_杂记2.html">
            
                    
                    Golang 杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.3" data-path="golang_杂记3.html">
            
                <a href="golang_杂记3.html">
            
                    
                    Golang 杂记3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.4" data-path="golang_lib选型.html">
            
                <a href="golang_lib选型.html">
            
                    
                    Golang lib选型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.5" data-path="golang_mod_proxy.html">
            
                <a href="golang_mod_proxy.html">
            
                    
                    go mod和go proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.6" data-path="golang_汇编_arm64.html">
            
                <a href="golang_汇编_arm64.html">
            
                    
                    Golang 汇编语法和arm64小知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.7" data-path="golang_cgo_swig.html">
            
                <a href="golang_cgo_swig.html">
            
                    
                    go调用c可以用swig
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="as_title_golang3.html">
            
                <a href="as_title_golang3.html">
            
                    
                    Golang 环境和工具链生成
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.9.1" data-path="golang_toolchain_ppc.html">
            
                <a href="golang_toolchain_ppc.html">
            
                    
                    go tools增加ppc32支持.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.2" data-path="golang_toolchain_compile_gccgo.html">
            
                <a href="golang_toolchain_compile_gccgo.html">
            
                    
                    编译gccgo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3" data-path="golang_go_on_mips.html">
            
                <a href="golang_go_on_mips.html">
            
                    
                    go on mips boards(not so updated)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.9.3.1" data-path="golang_go_on_mips_part1.html">
            
                <a href="golang_go_on_mips_part1.html">
            
                    
                    part 1: cross compile go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.2" data-path="golang_go_on_mips_part2.html">
            
                <a href="golang_go_on_mips_part2.html">
            
                    
                    part 2: build native go compiler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.3" data-path="golang_go_on_mips_part3.html">
            
                <a href="golang_go_on_mips_part3.html">
            
                    
                    part 3: gccgo experiments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.4" data-path="golang_go_on_mips_part4.html">
            
                <a href="golang_go_on_mips_part4.html">
            
                    
                    part 4: Golang json performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.5" data-path="golang_gentoo_on_mips_board_and_build_go.html">
            
                <a href="golang_gentoo_on_mips_board_and_build_go.html">
            
                    
                    Gentoo on mips board and build go
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.10" data-path="as_title_golang4.html">
            
                <a href="as_title_golang4.html">
            
                    
                    微服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.10.1" data-path="golang_micro.html">
            
                <a href="golang_micro.html">
            
                    
                    go-micro和micro
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.2" data-path="golang_微服务概念.html">
            
                <a href="golang_微服务概念.html">
            
                    
                    微服务概念
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.11" data-path="as_title_golang5.html">
            
                <a href="as_title_golang5.html">
            
                    
                    解释器和编解码
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.11.1" data-path="golang_yeagi.html">
            
                <a href="golang_yeagi.html">
            
                    
                    解释器yeagi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.2" data-path="golang_tengo.html">
            
                <a href="golang_tengo.html">
            
                    
                    解释器tengo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.3" data-path="golang_govaluate.html">
            
                <a href="golang_govaluate.html">
            
                    
                    解释器govaluate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.4" data-path="golang_encoding_gotiny.html">
            
                <a href="golang_encoding_gotiny.html">
            
                    
                    gotiny编解码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.5" data-path="golang_abs.html">
            
                <a href="golang_abs.html">
            
                    
                    解释器abs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.12" data-path="as_title_golang6.html">
            
                <a href="as_title_golang6.html">
            
                    
                    调试和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.12.1" data-path="golang_调试记录.html">
            
                <a href="golang_调试记录.html">
            
                    
                    Golang 调试记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12.2" data-path="golang_topid性能优化.html">
            
                <a href="golang_topid性能优化.html">
            
                    
                    Golang topid性能优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12.3" data-path="golang_gshell性能调试.html">
            
                <a href="golang_gshell性能调试.html">
            
                    
                    Golang gshell性能调试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.13" data-path="as_title_golang7.html">
            
                <a href="as_title_golang7.html">
            
                    
                    网络和消息中间件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.13.1" data-path="golang_zmq.html">
            
                <a href="golang_zmq.html">
            
                    
                    消息中间件基本概念和zero mq
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.2" data-path="golang_mango.html">
            
                <a href="golang_mango.html">
            
                    
                    消息中间件mango
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.3" data-path="golang_libp2p.html">
            
                <a href="golang_libp2p.html">
            
                    
                    Golang p2p网络
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="as_title_rust.html">
            
                <a href="as_title_rust.html">
            
                    
                    Rust
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="rust_入门_brief.html">
            
                <a href="rust_入门_brief.html">
            
                    
                    Rust 入门系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1.1" data-path="rust_books.html">
            
                <a href="rust_books.html">
            
                    
                    Rust reference books
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.2" data-path="rust_入门1.html">
            
                <a href="rust_入门1.html">
            
                    
                    Rust 安装和基础语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.3" data-path="rust_入门2.html">
            
                <a href="rust_入门2.html">
            
                    
                    Rust 泛型和内存所有权
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.4" data-path="rust_入门3.html">
            
                <a href="rust_入门3.html">
            
                    
                    Rust 闭包 容器 迭代器 生成器 线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.5" data-path="rust_工程构建.html">
            
                <a href="rust_工程构建.html">
            
                    
                    Rust 工程构建
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="rust_coding_brief.html">
            
                <a href="rust_coding_brief.html">
            
                    
                    Rust 代码积累
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.2.1" data-path="rust_序列化.html">
            
                <a href="rust_序列化.html">
            
                    
                    Rust 序列化原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.2" data-path="rust_知识点积累.html">
            
                <a href="rust_知识点积累.html">
            
                    
                    Rust 知识点更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.3" data-path="rust_adaptiveservice.html">
            
                <a href="rust_adaptiveservice.html">
            
                    
                    rust版本的adaptiveservice探索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.4" data-path="rust_常用设施.html">
            
                <a href="rust_常用设施.html">
            
                    
                    Rust 常用设施
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.5" data-path="rust_代码小段.html">
            
                <a href="rust_代码小段.html">
            
                    
                    Rust 代码小段
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="others.html">
            
                <a href="others.html">
            
                    
                    其他
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.3.1" data-path="rust_mdbook_使用.html">
            
                <a href="rust_mdbook_使用.html">
            
                    
                    Rust 使用mdbook
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="as_title_scripts.html">
            
                <a href="as_title_scripts.html">
            
                    
                    脚本
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="shell_变量.html">
            
                <a href="shell_变量.html">
            
                    
                    shell变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="shell_基础篇.html">
            
                <a href="shell_基础篇.html">
            
                    
                    shell命令和脚本记录-基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="shell_高级篇.html">
            
                <a href="shell_高级篇.html">
            
                    
                    shell命令和脚本记录-高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="shell_脚本片段.html">
            
                <a href="shell_脚本片段.html">
            
                    
                    shell脚本片段
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="python_记录.html">
            
                <a href="python_记录.html">
            
                    
                    python记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="lua_记录.html">
            
                <a href="lua_记录.html">
            
                    
                    lua记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="shell_rds脚本阅读.html">
            
                <a href="shell_rds脚本阅读.html">
            
                    
                    RDS脚本阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="Project_Euler.html">
            
                <a href="Project_Euler.html">
            
                    
                    Project Euler
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="as_title_app.html">
            
                <a href="as_title_app.html">
            
                    
                    应用相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="app_sysbench代码分析.html">
            
                <a href="app_sysbench代码分析.html">
            
                    
                    sysbench代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="as_title_cos.html">
            
                <a href="as_title_cos.html">
            
                    
                    C和Operating System
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="system_libc_part1.html">
            
                <a href="system_libc_part1.html">
            
                    
                    libc概览1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="system_libc_part2.html">
            
                <a href="system_libc_part2.html">
            
                    
                    libc概览2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3" data-path="system_libc_part3.html">
            
                <a href="system_libc_part3.html">
            
                    
                    libc概览3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.4" data-path="system_原理杂记.html">
            
                <a href="system_原理杂记.html">
            
                    
                    系统原理杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5" data-path="system_alpine.html">
            
                <a href="system_alpine.html">
            
                    
                    Alpine Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.6" data-path="system_进程间通信.html">
            
                <a href="system_进程间通信.html">
            
                    
                    进程间通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.7" data-path="system_特殊功能fd.html">
            
                <a href="system_特殊功能fd.html">
            
                    
                    eventfd timerfd signalfd和fd共享
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.8" data-path="c_automake_autoconf.html">
            
                <a href="c_automake_autoconf.html">
            
                    
                    automake autoconf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.9" data-path="makefile_原理和实践.html">
            
                <a href="makefile_原理和实践.html">
            
                    
                    makefile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.10" data-path="c_编程杂记高级篇.html">
            
                <a href="c_编程杂记高级篇.html">
            
                    
                    C编程杂记高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.11" data-path="c_编程杂记基础篇.html">
            
                <a href="c_编程杂记基础篇.html">
            
                    
                    C编程杂记基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.12" data-path="c_networking_socket高阶用法.html">
            
                <a href="c_networking_socket高阶用法.html">
            
                    
                    网络编程: Advanced Socket Topics(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.13" data-path="c_protobuf介绍.html">
            
                <a href="c_protobuf介绍.html">
            
                    
                    序列化: protobuf介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.14" data-path="c_进程间通信_共享文件和共享内存.html">
            
                <a href="c_进程间通信_共享文件和共享内存.html">
            
                    
                    进程间通信: 共享文件和共享内存(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.15" data-path="c_pthread_condition和mutex.html">
            
                <a href="c_pthread_condition和mutex.html">
            
                    
                    并发 任务 事件 和锁.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.16" data-path="kernel_user_space_howto.html">
            
                <a href="kernel_user_space_howto.html">
            
                    
                    kernel space和user space交互(网摘, linux2.6)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="as_title_driver.html">
            
                <a href="as_title_driver.html">
            
                    
                    内核 设备和驱动相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="platform_device_driver.html">
            
                <a href="platform_device_driver.html">
            
                    
                    平台驱动杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="device_driver_杂记.html">
            
                <a href="device_driver_杂记.html">
            
                    
                    驱动调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="device_localbus_16bit读写.html">
            
                <a href="device_localbus_16bit读写.html">
            
                    
                    CPLD做8bit到16bit转换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4" data-path="as_title_driver1.html">
            
                <a href="as_title_driver1.html">
            
                    
                    nand
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.4.1" data-path="device_driver_octeon_nand.html">
            
                <a href="device_driver_octeon_nand.html">
            
                    
                    octeon nand flash驱动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4.2" data-path="device_driver_nand概率写失败问题分析.html">
            
                <a href="device_driver_nand概率写失败问题分析.html">
            
                    
                    Nand flash概率写失败问题分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.5" data-path="octeon_remote_pci.html">
            
                <a href="octeon_remote_pci.html">
            
                    
                    octeon remote-pci.c阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.6" data-path="Device_VFIO_notes.html">
            
                <a href="Device_VFIO_notes.html">
            
                    
                    VFIO简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7" data-path="as_title_driver2.html">
            
                <a href="as_title_driver2.html">
            
                    
                    智能网卡和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.7.1" data-path="smartNIC_智能网卡对比.html">
            
                <a href="smartNIC_智能网卡对比.html">
            
                    
                    智能网卡对比
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.2" data-path="octeon_pci_NIC.html">
            
                <a href="octeon_pci_NIC.html">
            
                    
                    octeon PCI NIC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.3" data-path="as_title_driver3.html">
            
                <a href="as_title_driver3.html">
            
                    
                    octeon liquidIO
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.7.3.1" data-path="smartNIC_liquidIO_代码阅读app篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读app篇.html">
            
                    
                    PCI-NIC 代码阅读 --app篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.3.2" data-path="smartNIC_liquidIO_代码阅读api篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读api篇.html">
            
                    
                    PCI-NIC 代码阅读 --api篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.3.3" data-path="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇之结构体
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.3.4" data-path="smartNIC_liquidIO_代码阅读driver篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7.3.5" data-path="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                    
                    PCI-NIC 代码阅读 --真NIC篇
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.7.4" data-path="networking_dpdk使用_2014.html">
            
                <a href="networking_dpdk使用_2014.html">
            
                    
                    DPDK使用(2014)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.8" data-path="device_nvme要点介绍.html">
            
                <a href="device_nvme要点介绍.html">
            
                    
                    nvme要点介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="as_title_cpu.html">
            
                <a href="as_title_cpu.html">
            
                    
                    CPU Arch相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="cache_CPU和cache一致性原理.html">
            
                <a href="cache_CPU和cache一致性原理.html">
            
                    
                    CPU和cache一致性原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="as_title_cpu1.html">
            
                <a href="as_title_cpu1.html">
            
                    
                    ARM64
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.2.1" data-path="CPU_ARM64_thunder_overview.html">
            
                <a href="CPU_ARM64_thunder_overview.html">
            
                    
                    thunder 概览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.2" data-path="CPU_ARM64_thunder_开发板操作记录.html">
            
                <a href="CPU_ARM64_thunder_开发板操作记录.html">
            
                    
                    thunder 开发板操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.3" data-path="CPU_ARM64_thunder_bdk.html">
            
                <a href="CPU_ARM64_thunder_bdk.html">
            
                    
                    thunder BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.4" data-path="CPU_ARM64_thunder_efi_rtc.html">
            
                <a href="CPU_ARM64_thunder_efi_rtc.html">
            
                    
                    thunder RTC时间和efi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.5" data-path="CPU_ARM64_thunder_uefi_fdt.html">
            
                <a href="CPU_ARM64_thunder_uefi_fdt.html">
            
                    
                    thunder uefi和fdt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.6" data-path="CPU_ARM64_thunder_atf.html">
            
                <a href="CPU_ARM64_thunder_atf.html">
            
                    
                    thunder atf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.7" data-path="CPU_ARM64_thunder_kernel_boot.html">
            
                <a href="CPU_ARM64_thunder_kernel_boot.html">
            
                    
                    thunder kernel启动打印流程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="as_title_cpu2.html">
            
                <a href="as_title_cpu2.html">
            
                    
                    PPC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.3.1" data-path="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                <a href="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                    
                    PPC启动多核linux: 流程和内存映射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3.2" data-path="CPU_PPC_kernel升级记录.html">
            
                <a href="CPU_PPC_kernel升级记录.html">
            
                    
                    PPC kernel升级记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.4" data-path="as_title_cpu3.html">
            
                <a href="as_title_cpu3.html">
            
                    
                    MIPS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.4.1" data-path="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                <a href="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                    
                    octeon 地址空间和寄存器访问
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.2" data-path="CPU_MIPS_octeon操作记录.html">
            
                <a href="CPU_MIPS_octeon操作记录.html">
            
                    
                    octeon 操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.3" data-path="CPU_MIPS_octeon_包处理性能.html">
            
                <a href="CPU_MIPS_octeon_包处理性能.html">
            
                    
                    octeon 系列处理器包处理性能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.4" data-path="CPU_MIPS_octeon_ddr调试记录.html">
            
                <a href="CPU_MIPS_octeon_ddr调试记录.html">
            
                    
                    octeon DDR调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.5" data-path="CPU_MIPS_octeon_BDK.html">
            
                <a href="CPU_MIPS_octeon_BDK.html">
            
                    
                    octeon CN78xx BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.6" data-path="kernel_增加ECC中断.html">
            
                <a href="kernel_增加ECC中断.html">
            
                    
                    octeon 增加ECC中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.7" data-path="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                <a href="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                    
                    octeon hw-ddr2代码走读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.8" data-path="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                <a href="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                    
                    octeon reboot调试和DDR中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.9" data-path="CPU_MIPS_octeon中断.html">
            
                <a href="CPU_MIPS_octeon中断.html">
            
                    
                    octeon 中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.10" data-path="CPU_MIPS_octeon原子操作.html">
            
                <a href="CPU_MIPS_octeon原子操作.html">
            
                    
                    octeon 原子操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.11" data-path="CPU_MIPS_octeon网口代码分析.html">
            
                <a href="CPU_MIPS_octeon网口代码分析.html">
            
                    
                    octeon 网口代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >网络虚拟化用例记录</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;"><b>1. </b>&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;</a></li><ul><li><span class="title-icon "></span><a href="#&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;"><b>1.1. </b>&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;&#x793A;&#x610F;&#x56FE;"><b>1.2. </b>&#x6D4B;&#x8BD5;&#x793A;&#x610F;&#x56FE;</a></li><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;_1"><b>1.3. </b>&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;</a></li><ul><li><span class="title-icon "></span><a href="#&#x542F;&#x52A8;&#x5E76;&#x914D;&#x7F6E;ovs"><b>1.3.1. </b>&#x542F;&#x52A8;&#x5E76;&#x914D;&#x7F6E;OVS</a></li><li><span class="title-icon "></span><a href="#&#x521B;&#x5EFA;&#x5E76;&#x914D;&#x7F6E;vm"><b>1.3.2. </b>&#x521B;&#x5EFA;&#x5E76;&#x914D;&#x7F6E;VM</a></li></ul></ul><li><span class="title-icon "></span><a href="#54----&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;"><b>2. </b>5.4    &#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;</a></li><ul><li><span class="title-icon "></span><a href="#5411----ovs&#x91C7;&#x7528;dpdk"><b>2.1. </b>5.4.1.1    OVS&#x91C7;&#x7528;DPDK</a></li><ul><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass"><b>2.1.1. </b>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li></ul><li><span class="title-icon "></span><a href="#5412----ovs&#x652F;&#x6301;numa&#x611F;&#x77E5;"><b>2.2. </b>5.4.1.2    OVS&#x652F;&#x6301;numa&#x611F;&#x77E5;</a></li><ul><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_1"><b>2.2.1. </b>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li></ul><li><span class="title-icon "></span><a href="#542----&#x652F;&#x6301;sr-iov&#x7F51;&#x5361;"><b>2.3. </b>5.4.2    &#x652F;&#x6301;SR-IOV&#x7F51;&#x5361;</a></li><ul><li><span class="title-icon "></span><a href="#5421-----sr-iov&#x94FE;&#x8DEF;&#x72B6;&#x6001;&#x611F;&#x77E5;&#x6D4B;&#x8BD5;"><b>2.3.1. </b>5.4.2.1     SR-IOV&#x94FE;&#x8DEF;&#x72B6;&#x6001;&#x611F;&#x77E5;&#x6D4B;&#x8BD5;</a></li><li><span class="title-icon "></span><a href="#5422----hypervisor&#x5141;&#x8BB8;&#x53EA;&#x4F7F;&#x7528;&#x4E00;&#x5BF9;&#x7269;&#x7406;&#x7F51;&#x53E3;"><b>2.3.2. </b>5.4.2.2    Hypervisor&#x5141;&#x8BB8;&#x53EA;&#x4F7F;&#x7528;&#x4E00;&#x5BF9;&#x7269;&#x7406;&#x7F51;&#x53E3;</a></li><li><span class="title-icon "></span><a href="#5423-----sr-iov&#x4E0E;&#x865A;&#x62DF;&#x4EA4;&#x6362;&#x673A;&#x4E92;&#x901A;"><b>2.3.3. </b>5.4.2.3     SR-IOV&#x4E0E;&#x865A;&#x62DF;&#x4EA4;&#x6362;&#x673A;&#x4E92;&#x901A;</a></li></ul><li><span class="title-icon "></span><a href="#543----sr-iov&#x7F51;&#x5361;&#x7684;&#x6865;&#x63A5;&#x529F;&#x80FD;"><b>2.4. </b>5.4.3    SR-IOV&#x7F51;&#x5361;&#x7684;&#x6865;&#x63A5;&#x529F;&#x80FD;</a></li><ul><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_3"><b>2.4.1. </b>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li></ul><li><span class="title-icon "></span><a href="#544----&#x652F;&#x6301;vnic&#x591A;&#x961F;&#x5217;"><b>2.5. </b>5.4.4    &#x652F;&#x6301;vNIC&#x591A;&#x961F;&#x5217;</a></li><ul><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_4"><b>2.5.1. </b>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li></ul><li><span class="title-icon "></span><a href="#545----&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;"><b>2.6. </b>5.4.5    &#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;</a></li><ul><li><span class="title-icon "></span><a href="#5451----ovs-&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;"><b>2.6.1. </b>5.4.5.1    OVS &#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;</a></li><li><span class="title-icon "></span><a href="#5452----sr-iov-&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;"><b>2.6.2. </b>5.4.5.2    SR-IOV &#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;</a></li></ul><li><span class="title-icon "></span><a href="#546----mtu&#x53EF;&#x8C03;&#x6574;"><b>2.7. </b>5.4.6    MTU&#x53EF;&#x8C03;&#x6574;</a></li><ul><li><span class="title-icon "></span><a href="#5461----ovs-mtu&#x53EF;&#x8C03;&#x6574;&#xFF08;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;sdn&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;&#xFF09;"><b>2.7.1. </b>5.4.6.1    OVS MTU&#x53EF;&#x8C03;&#x6574;&#xFF08;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;SDN&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;&#xFF09;</a></li><li><span class="title-icon "></span><a href="#5462----sr-iov-mtu&#x53EF;&#x8C03;&#x6574;&#xFF08;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;sdn&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;&#xFF09;"><b>2.7.2. </b>5.4.6.2    SR-IOV MTU&#x53EF;&#x8C03;&#x6574;&#xFF08;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;SDN&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;&#xFF09;</a></li></ul><li><span class="title-icon "></span><a href="#547----&#x652F;&#x6301;vlan&#x900F;&#x4F20;"><b>2.8. </b>5.4.7    &#x652F;&#x6301;VLAN&#x900F;&#x4F20;</a></li><ul><li><span class="title-icon "></span><a href="#5471----ovs-&#x652F;&#x6301;vlan&#x900F;&#x4F20;"><b>2.8.1. </b>5.4.7.1    OVS &#x652F;&#x6301;VLAN&#x900F;&#x4F20;</a></li><li><span class="title-icon "></span><a href="#5472----sr-iov-&#x652F;&#x6301;vlan&#x900F;&#x4F20;"><b>2.8.2. </b>5.4.7.2    SR-IOV &#x652F;&#x6301;VLAN&#x900F;&#x4F20;</a></li></ul><li><span class="title-icon "></span><a href="#548----&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;"><b>2.9. </b>5.4.8    &#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;</a></li><ul><li><span class="title-icon "></span><a href="#5481-----ovs-&#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;"><b>2.9.1. </b>5.4.8.1     OVS &#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;</a></li><li><span class="title-icon "></span><a href="#5482----sr-iov-&#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;"><b>2.9.2. </b>5.4.8.2    SR-IOV &#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;</a></li></ul><li><span class="title-icon "></span><a href="#549----&#x652F;&#x6301;&#x7EC4;&#x64AD;"><b>2.10. </b>5.4.9    &#x652F;&#x6301;&#x7EC4;&#x64AD;</a></li><ul><li><span class="title-icon "></span><a href="#5491----ovs&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;"><b>2.10.1. </b>5.4.9.1    OVS&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;</a></li><li><span class="title-icon "></span><a href="#5492----sr-iov&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;"><b>2.10.2. </b>5.4.9.2    SR-IOV&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;</a></li></ul></ul><li><span class="title-icon "></span><a href="#73----&#x865A;&#x62DF;&#x5C42;&#x6027;&#x80FD;"><b>3. </b>7.3    &#x865A;&#x62DF;&#x5C42;&#x6027;&#x80FD;</a></li><ul><li><span class="title-icon "></span><a href="#735----&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;"><b>3.1. </b>7.3.5    &#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;</a></li><ul><li><span class="title-icon "></span><a href="#7351----&#x57FA;&#x4E8E;10ge&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;"><b>3.1.1. </b>7.3.5.1    &#x57FA;&#x4E8E;10GE&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;</a></li></ul><li><span class="title-icon "></span><a href="#736----&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;"><b>3.2. </b>7.3.6    &#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;</a></li><ul><li><span class="title-icon "></span><a href="#7361----&#x57FA;&#x4E8E;10ge&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;"><b>3.2.1. </b>7.3.6.1    &#x57FA;&#x4E8E;10GE&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;</a></li></ul></ul><li><span class="title-icon "></span><a href="#troubleshooting"><b>4. </b>Troubleshooting</a></li><ul><li><span class="title-icon "></span><a href="#ovs&#x5F02;&#x5E38;&#x91CD;&#x542F;&#x5BFC;&#x81F4;vhostuser&#x4E0D;&#x901A;"><b>4.1. </b>OVS&#x5F02;&#x5E38;&#x91CD;&#x542F;&#x5BFC;&#x81F4;vhostuser&#x4E0D;&#x901A;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5F85;&#x89E3;&#x51B3;&#x95EE;&#x9898;"><b>5. </b>&#x5F85;&#x89E3;&#x51B3;&#x95EE;&#x9898;</a></li><ul><li><span class="title-icon "></span><a href="#netperf-over-ovs-dpdk&#x6027;&#x80FD;&#x5DEE;"><b>5.1. </b>netperf over OVS-DPDK&#x6027;&#x80FD;&#x5DEE;</a></li><li><span class="title-icon "></span><a href="#vm&#x540C;&#x65F6;&#x6DFB;&#x52A0;sriov&#x548C;vhost-user&#x5BFC;&#x81F4;ovs&#x5D29;&#x6E83;&#x91CD;&#x542F;"><b>5.2. </b>VM&#x540C;&#x65F6;&#x6DFB;&#x52A0;sriov&#x548C;vhost-user&#x5BFC;&#x81F4;OVS&#x5D29;&#x6E83;&#x91CD;&#x542F;</a></li></ul></ul></div><a href="#&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;">&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;</a><ul>
<li><a href="#&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;">&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;</a></li>
<li><a href="#&#x6D4B;&#x8BD5;&#x793A;&#x610F;&#x56FE;">&#x6D4B;&#x8BD5;&#x793A;&#x610F;&#x56FE;</a></li>
<li><a href="#&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;-1">&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;</a><ul>
<li><a href="#&#x542F;&#x52A8;&#x5E76;&#x914D;&#x7F6E;ovs">&#x542F;&#x52A8;&#x5E76;&#x914D;&#x7F6E;OVS</a></li>
<li><a href="#&#x521B;&#x5EFA;&#x5E76;&#x914D;&#x7F6E;vm">&#x521B;&#x5EFA;&#x5E76;&#x914D;&#x7F6E;VM</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#54&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;">5.4    &#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;</a><ul>
<li><a href="#5411ovs&#x91C7;&#x7528;dpdk">5.4.1.1    OVS&#x91C7;&#x7528;DPDK</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li>
</ul>
</li>
<li><a href="#5412ovs&#x652F;&#x6301;numa&#x611F;&#x77E5;">5.4.1.2    OVS&#x652F;&#x6301;numa&#x611F;&#x77E5;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass-1">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li>
</ul>
</li>
<li><a href="#542&#x652F;&#x6301;sr-iov&#x7F51;&#x5361;">5.4.2    &#x652F;&#x6301;SR-IOV&#x7F51;&#x5361;</a><ul>
<li><a href="#5421-sr-iov&#x94FE;&#x8DEF;&#x72B6;&#x6001;&#x611F;&#x77E5;&#x6D4B;&#x8BD5;">5.4.2.1     SR-IOV&#x94FE;&#x8DEF;&#x72B6;&#x6001;&#x611F;&#x77E5;&#x6D4B;&#x8BD5;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;link-up----pass">&#x6D4B;&#x8BD5;link up -- PASS</a></li>
<li><a href="#&#x6D4B;&#x8BD5;link-down----fail">&#x6D4B;&#x8BD5;link down -- FAIL</a></li>
<li><a href="#fail&#x5206;&#x6790;">Fail&#x5206;&#x6790;</a></li>
</ul>
</li>
<li><a href="#5422hypervisor&#x5141;&#x8BB8;&#x53EA;&#x4F7F;&#x7528;&#x4E00;&#x5BF9;&#x7269;&#x7406;&#x7F51;&#x53E3;">5.4.2.2    Hypervisor&#x5141;&#x8BB8;&#x53EA;&#x4F7F;&#x7528;&#x4E00;&#x5BF9;&#x7269;&#x7406;&#x7F51;&#x53E3;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass-2">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li>
<li><a href="#issue&#x8BA8;&#x8BBA;">issue&#x8BA8;&#x8BBA;</a></li>
</ul>
</li>
<li><a href="#5423-sr-iov&#x4E0E;&#x865A;&#x62DF;&#x4EA4;&#x6362;&#x673A;&#x4E92;&#x901A;">5.4.2.3     SR-IOV&#x4E0E;&#x865A;&#x62DF;&#x4EA4;&#x6362;&#x673A;&#x4E92;&#x901A;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----&#x5F85;&#x6F84;&#x6E05;&#x6D4B;&#x8BD5;&#x573A;&#x666F;&#x540E;&#x6D4B;&#x8BD5;">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- &#x5F85;&#x6F84;&#x6E05;&#x6D4B;&#x8BD5;&#x573A;&#x666F;&#x540E;&#x6D4B;&#x8BD5;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#543sr-iov&#x7F51;&#x5361;&#x7684;&#x6865;&#x63A5;&#x529F;&#x80FD;">5.4.3    SR-IOV&#x7F51;&#x5361;&#x7684;&#x6865;&#x63A5;&#x529F;&#x80FD;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass-3">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li>
</ul>
</li>
<li><a href="#544&#x652F;&#x6301;vnic&#x591A;&#x961F;&#x5217;">5.4.4    &#x652F;&#x6301;vNIC&#x591A;&#x961F;&#x5217;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass-4">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li>
</ul>
</li>
<li><a href="#545&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;">5.4.5    &#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;</a><ul>
<li><a href="#5451ovs-&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;">5.4.5.1    OVS &#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass-5">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li>
</ul>
</li>
<li><a href="#5452sr-iov-&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;">5.4.5.2    SR-IOV &#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass-6">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#546mtu&#x53EF;&#x8C03;&#x6574;">5.4.6    MTU&#x53EF;&#x8C03;&#x6574;</a><ul>
<li><a href="#5461ovs-mtu&#x53EF;&#x8C03;&#x6574;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;sdn&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;">5.4.6.1    OVS MTU&#x53EF;&#x8C03;&#x6574;&#xFF08;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;SDN&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;&#xFF09;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass-7">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li>
<li><a href="#&#x7591;&#x95EE;-dpdkp1&#x7684;txq&#x4E2A;&#x6570;">&#x7591;&#x95EE;: dpdkp1&#x7684;txq&#x4E2A;&#x6570;</a></li>
</ul>
</li>
<li><a href="#5462sr-iov-mtu&#x53EF;&#x8C03;&#x6574;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;sdn&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;">5.4.6.2    SR-IOV MTU&#x53EF;&#x8C03;&#x6574;&#xFF08;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;SDN&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;&#xFF09;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass-8">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#547&#x652F;&#x6301;vlan&#x900F;&#x4F20;">5.4.7    &#x652F;&#x6301;VLAN&#x900F;&#x4F20;</a><ul>
<li><a href="#5471ovs-&#x652F;&#x6301;vlan&#x900F;&#x4F20;">5.4.7.1    OVS &#x652F;&#x6301;VLAN&#x900F;&#x4F20;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass-9">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li>
</ul>
</li>
<li><a href="#5472sr-iov-&#x652F;&#x6301;vlan&#x900F;&#x4F20;">5.4.7.2    SR-IOV &#x652F;&#x6301;VLAN&#x900F;&#x4F20;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----fail">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- FAIL</a></li>
<li><a href="#todo-&#x5207;&#x6362;&#x81F3;ofed-44&#x7248;&#x672C;&#x91CD;&#x65B0;&#x6D4B;&#x8BD5;">ToDo: &#x5207;&#x6362;&#x81F3;OFED 4.4&#x7248;&#x672C;&#x91CD;&#x65B0;&#x6D4B;&#x8BD5;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#548&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;">5.4.8    &#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;</a><ul>
<li><a href="#5481-ovs-&#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;">5.4.8.1     OVS &#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass-10">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li>
<li><a href="#&#x95EE;&#x9898;-netperf-over-ovs-dpdk&#x6027;&#x80FD;&#x5DEE;">&#x95EE;&#x9898;: netperf over OVS-DPDK&#x6027;&#x80FD;&#x5DEE;</a></li>
</ul>
</li>
<li><a href="#5482sr-iov-&#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;">5.4.8.2    SR-IOV &#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----passto-be-clarified">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS(to be clarified)</a></li>
<li><a href="#&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x8C03;&#x6574;&#x5E26;&#x5BBD;&#x6BD4;&#x4F8B;&#x5230;150&#x6216;50">&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x8C03;&#x6574;&#x5E26;&#x5BBD;&#x6BD4;&#x4F8B;&#x5230;150%&#x6216;50%?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#549&#x652F;&#x6301;&#x7EC4;&#x64AD;">5.4.9    &#x652F;&#x6301;&#x7EC4;&#x64AD;</a><ul>
<li><a href="#5491ovs&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;">5.4.9.1    OVS&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass-11">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li>
</ul>
</li>
<li><a href="#5492sr-iov&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;">5.4.9.2    SR-IOV&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;</a><ul>
<li><a href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass-12">&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#73&#x865A;&#x62DF;&#x5C42;&#x6027;&#x80FD;">7.3    &#x865A;&#x62DF;&#x5C42;&#x6027;&#x80FD;</a><ul>
<li><a href="#735&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;">7.3.5    &#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;</a><ul>
<li><a href="#7351&#x57FA;&#x4E8E;10ge&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;">7.3.5.1    &#x57FA;&#x4E8E;10GE&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;</a></li>
</ul>
</li>
<li><a href="#736&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;">7.3.6    &#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;</a><ul>
<li><a href="#7361&#x57FA;&#x4E8E;10ge&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;">7.3.6.1    &#x57FA;&#x4E8E;10GE&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#troubleshooting">Troubleshooting</a><ul>
<li><a href="#ovs&#x5F02;&#x5E38;&#x91CD;&#x542F;&#x5BFC;&#x81F4;vhostuser&#x4E0D;&#x901A;">OVS&#x5F02;&#x5E38;&#x91CD;&#x542F;&#x5BFC;&#x81F4;vhostuser&#x4E0D;&#x901A;</a></li>
</ul>
</li>
<li><a href="#&#x5F85;&#x89E3;&#x51B3;&#x95EE;&#x9898;">&#x5F85;&#x89E3;&#x51B3;&#x95EE;&#x9898;</a><ul>
<li><a href="#netperf-over-ovs-dpdk&#x6027;&#x80FD;&#x5DEE;">netperf over OVS-DPDK&#x6027;&#x80FD;&#x5DEE;</a></li>
<li><a href="#vm&#x540C;&#x65F6;&#x6DFB;&#x52A0;sriov&#x548C;vhost-user&#x5BFC;&#x81F4;ovs&#x5D29;&#x6E83;&#x91CD;&#x542F;">VM&#x540C;&#x65F6;&#x6DFB;&#x52A0;sriov&#x548C;vhost-user&#x5BFC;&#x81F4;OVS&#x5D29;&#x6E83;&#x91CD;&#x542F;</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>&#x672C;&#x6587;&#x5728;HXT ARM&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x505A;&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7684;&#x6D4B;&#x8BD5;, &#x9996;&#x5148;&#x8003;&#x5BDF;&#x529F;&#x80FD;&#x662F;&#x5426;&#x5B8C;&#x5907;, &#x6709;&#x65E0;&#x529F;&#x80FD;&#x7F3A;&#x5931;&#x548C;&#x5F02;&#x5E38;; &#x5176;&#x6B21;&#x8003;&#x5BDF;&#x6027;&#x80FD;, &#x4F46;&#x4E0D;&#x5BF9;&#x6BD4;X86&#x6570;&#x636E;.</p>
</blockquote>
<h1 id="&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;"><a name="&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;"><i class="fa fa-link" aria-hidden="true"></i></a>1. &#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;</h1>
<h2 id="&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;"><a name="&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. &#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;</h2>
<p>&#x6587;&#x4E2D;&#x4F7F;&#x7528;&#x7684;HXT ARM&#x670D;&#x52A1;&#x5668;2&#x53F0;, &#x7B80;&#x79F0;<code>Host A, Host B</code>&#x4FE1;&#x606F;&#x5982;&#x4E0B;:</p>
<table>
<thead>
<tr>
<th>&#x670D;&#x52A1;&#x5668;</th>
<th>Host A</th>
<th>Host B</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>Socket</td>
<td>1</td>
<td>1</td>
<td>&#x5355;socket</td>
</tr>
<tr>
<td>CPU</td>
<td>46core@2.6G AW2542 v2.1</td>
<td>46core@2.6G AW2542 v2.1</td>
<td><code>sudo dmidecode -t processor</code></td>
</tr>
<tr>
<td>MEM</td>
<td>96G</td>
<td>96G</td>
<td><code>free -h</code></td>
</tr>
<tr>
<td>NIC</td>
<td>2 * Mellanox ConnectX-4</td>
<td>2 * Mellanox ConnectX-4</td>
<td><code>lspci</code></td>
</tr>
<tr>
<td>OS</td>
<td>CentOS 7.5.1804</td>
<td>CentOS 7.5.1804</td>
<td><code>cat /etc/redhat-release</code></td>
</tr>
<tr>
<td>kernel</td>
<td>4.14.36-4.hxt.aarch64</td>
<td>4.14.36-4.hxt.aarch64</td>
<td><code>uname -r</code></td>
</tr>
<tr>
<td>Mellanox OFED version</td>
<td>4.3-3.0.2</td>
<td>4.3-3.0.2</td>
<td><code>ethtool -i enP4p1s0</code></td>
</tr>
<tr>
<td>QEMU version</td>
<td>NA</td>
<td>2.12</td>
<td><code>qemu-system-aarch64 --version</code> &#x6E90;&#x7801;&#x7F16;&#x8BD1;</td>
</tr>
<tr>
<td>DPDK version</td>
<td>hxt-dev-v17.08</td>
<td>hxt-dev-v17.08</td>
<td>&#x6E90;&#x7801;&#x7F16;&#x8BD1;</td>
</tr>
<tr>
<td>OVS(with DPDK) version</td>
<td>NA</td>
<td>2.8.4</td>
<td><code>sudo ovs-vsctl show</code> &#x6E90;&#x7801;&#x7F16;&#x8BD1;</td>
</tr>
<tr>
<td>libvirt version</td>
<td>NA</td>
<td>4.6.0</td>
<td>&#x6E90;&#x7801;&#x7F16;&#x8BD1;</td>
</tr>
<tr>
<td>virt-manager version</td>
<td>NA</td>
<td>1.5.1</td>
<td>&#x6E90;&#x7801;&#x5B89;&#x88C5;</td>
</tr>
</tbody>
</table>
<blockquote>
<p>&#x5BF9;&#x5E94;&#x6D4B;&#x8BD5;&#x7F16;&#x53F7;<code>5.1.1 Hypervisor&#x7248;&#x672C;&#x8981;&#x6C42;</code>
&#x8981;&#x6C42;&#x5982;&#x4E0B;:</p>
<ol>
<li>Host OS&#x7684;&#x7248;&#x672C; &#x2265; 3.10.0</li>
<li>kvm-qemu&#x7684;&#x7248;&#x672C; &#x2265; 2.3.0</li>
<li>openvswitch &#x2265; 2.5.0</li>
<li>dpdk&#x7684;&#x7248;&#x672C; &#x2265; 16.11.0</li>
</ol>
</blockquote>
<p>&#x6CE8;: &#x5982;&#x679C;&#x6CA1;&#x6709;&#x7279;&#x522B;&#x8BF4;&#x660E;, &#x6D4B;&#x8BD5;&#x5747;&#x5728;Host B&#x4E0A;&#x6267;&#x884C;</p>
<h2 id="&#x6D4B;&#x8BD5;&#x793A;&#x610F;&#x56FE;"><a name="&#x6D4B;&#x8BD5;&#x793A;&#x610F;&#x56FE;" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x793A;&#x610F;&#x56FE;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. &#x6D4B;&#x8BD5;&#x793A;&#x610F;&#x56FE;</h2>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003130330.png" alt="">  </p>
<h2 id="&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;_1"><a name="&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;_1" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;_1"><i class="fa fa-link" aria-hidden="true"></i></a>1.3. &#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;</h2>
<p>&#x9884;&#x7F6E;&#x6761;&#x4EF6;: DPDK, OVS, Qemu, libvirt, virt-manager&#x5DF2;&#x7ECF;&#x6210;&#x529F;&#x7F16;&#x8BD1;&#x5B89;&#x88C5;</p>
<h3 id="&#x542F;&#x52A8;&#x5E76;&#x914D;&#x7F6E;ovs"><a name="&#x542F;&#x52A8;&#x5E76;&#x914D;&#x7F6E;ovs" class="anchor-navigation-ex-anchor" href="#&#x542F;&#x52A8;&#x5E76;&#x914D;&#x7F6E;ovs"><i class="fa fa-link" aria-hidden="true"></i></a>1.3.1. &#x542F;&#x52A8;&#x5E76;&#x914D;&#x7F6E;OVS</h3>
<table>
<thead>
<tr>
<th>OVS&#x9009;&#x9879;</th>
<th>&#x503C;</th>
<th>&#x8BF4;&#x660E;</th>
</tr>
</thead>
<tbody>
<tr>
<td>dpdk-init</td>
<td>true</td>
<td></td>
</tr>
<tr>
<td>bridge</td>
<td>ovsbr0</td>
<td></td>
</tr>
<tr>
<td>pmd-cpu-mask</td>
<td>FF00000000</td>
<td>8&#x4E2A;core 32 33 34 35 36 37 38 39</td>
</tr>
<tr>
<td>dpdk-socket-mem</td>
<td>4096</td>
<td>&#x5355;socket 4G</td>
</tr>
<tr>
<td>vhost-user port 0</td>
<td>dpdkvhostuser0</td>
<td>n_rxq=2</td>
</tr>
<tr>
<td>vhost-user port 1</td>
<td>dpdkvhostuser1</td>
<td>n_rxq=2</td>
</tr>
</tbody>
</table>
<pre class="language-"><code class="lang-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/usr/local/share/openvswitch/scripts
<span class="token function">sudo</span> ovs-ctl start
<span class="token comment">#&#x6253;&#x5F00;dpdk&#x521D;&#x59CB;&#x5316;</span>
<span class="token function">sudo</span> ovs-vsctl --no-wait <span class="token builtin class-name">set</span> Open_vSwitch <span class="token builtin class-name">.</span> other_config:dpdk-init<span class="token operator">=</span>true
<span class="token comment">#&#x65B0;&#x589E;&#x4E00;&#x4E2A;bridge, &#x4F7F;&#x7528;&#x7528;&#x6237;&#x6001;datapath&#x6A21;&#x5F0F;</span>
<span class="token function">sudo</span> ovs-vsctl add-br ovsbr0 -- <span class="token builtin class-name">set</span> bridge ovsbr0 <span class="token assign-left variable">datapath_type</span><span class="token operator">=</span>netdev
<span class="token comment">#&#x914D;&#x7F6E;pmd&#x8DD1;&#x5728;8&#x4E2A;&#x6838;&#x4E0A;, core 32 33 34 35 36 37 38 39</span>
<span class="token function">sudo</span> ovs-vsctl <span class="token builtin class-name">set</span> Open_vSwitch <span class="token builtin class-name">.</span> other_config:pmd-cpu-mask<span class="token operator">=</span>FF00000000
<span class="token comment">#&#x914D;&#x7F6E;&#x4F7F;&#x7528;node0&#x7684;4G&#x5185;&#x5B58;.</span>
<span class="token function">sudo</span> ovs-vsctl --no-wait <span class="token builtin class-name">set</span> Open_vSwitch <span class="token builtin class-name">.</span> other_config:dpdk-socket-mem<span class="token operator">=</span><span class="token string">&quot;4096&quot;</span>
<span class="token comment">#&#x589E;&#x52A0;&#x4E24;&#x4E2A;port, &#x7C7B;&#x578B;&#x662F;dpdkvhostuser</span>
<span class="token function">sudo</span> ovs-vsctl add-port ovsbr0 dpdkvhostuser0 -- <span class="token builtin class-name">set</span> Interface dpdkvhostuser0 <span class="token assign-left variable">type</span><span class="token operator">=</span>dpdkvhostuser
<span class="token function">sudo</span> ovs-vsctl add-port ovsbr0 dpdkvhostuser1 -- <span class="token builtin class-name">set</span> Interface dpdkvhostuser1 <span class="token assign-left variable">type</span><span class="token operator">=</span>dpdkvhostuser
<span class="token comment">#&#x914D;&#x7F6E;&#x591A;queue</span>
<span class="token function">sudo</span> ovs-vsctl <span class="token builtin class-name">set</span> Interface dpdkvhostuser0 options:n_rxq<span class="token operator">=</span><span class="token number">2</span>
<span class="token function">sudo</span> ovs-vsctl <span class="token builtin class-name">set</span> Interface dpdkvhostuser1 options:n_rxq<span class="token operator">=</span><span class="token number">2</span>
</code></pre>
<h3 id="&#x521B;&#x5EFA;&#x5E76;&#x914D;&#x7F6E;vm"><a name="&#x521B;&#x5EFA;&#x5E76;&#x914D;&#x7F6E;vm" class="anchor-navigation-ex-anchor" href="#&#x521B;&#x5EFA;&#x5E76;&#x914D;&#x7F6E;vm"><i class="fa fa-link" aria-hidden="true"></i></a>1.3.2. &#x521B;&#x5EFA;&#x5E76;&#x914D;&#x7F6E;VM</h3>
<p>&#x9884;&#x7F6E;&#x6761;&#x4EF6;: libvirtd&#x5DF2;&#x7ECF;&#x6210;&#x529F;&#x542F;&#x52A8;
&#x5148;&#x7528;virt-manager&#x521B;&#x5EFA;2&#x4E2A;VM, &#x914D;&#x7F6E;&#x5982;&#x4E0B;:
VM | VM01 | VM02
---|---|---|
CPUs | 4 | 4
Memory | 8192M | 8192M
Disk | hxt-centos7.5-01.qcow2 32G | hxt-centos7.5-02.qcow2 32G
NIC1(optional) | virtio(NAT to eth0) | virtio(NAT to eth0) </p>
<p>NIC1&#x662F;&#x7528;&#x6765;&#x8FDE;&#x63A5;&#x5916;&#x7F51;&#x7684;, &#x8FD8;&#x9700;&#x8981;&#x589E;&#x52A0;NIC2&#x7528;&#x6765;&#x8FDE;&#x63A5;OVS&#x7684;dpdkvhostuser port:
&#x624B;&#x5DE5;&#x4FEE;&#x6539;xml&#x6587;&#x4EF6;<code>virsh edit <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>VM</span><span class="token punctuation">&gt;</span></span></code>, &#x9002;&#x5F53;&#x589E;&#x52A0;&#x5982;&#x4E0B;&#x4FEE;&#x6539;:</p>
<pre class="language-"><code class="lang-xml">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>memoryBacking</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hugepages</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>page</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>512<span class="token punctuation">&apos;</span></span> <span class="token attr-name">unit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>M<span class="token punctuation">&apos;</span></span> <span class="token attr-name">nodeset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>0<span class="token punctuation">&apos;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hugepages</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpu</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>host-passthrough<span class="token punctuation">&apos;</span></span> <span class="token attr-name">check</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>none<span class="token punctuation">&apos;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>topology</span> <span class="token attr-name">sockets</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>1<span class="token punctuation">&apos;</span></span> <span class="token attr-name">cores</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>4<span class="token punctuation">&apos;</span></span> <span class="token attr-name">threads</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>1<span class="token punctuation">&apos;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>numa</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cell</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>0<span class="token punctuation">&apos;</span></span> <span class="token attr-name">cpus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>0-3<span class="token punctuation">&apos;</span></span> <span class="token attr-name">memory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>8388608<span class="token punctuation">&apos;</span></span> <span class="token attr-name">unit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>KiB<span class="token punctuation">&apos;</span></span> <span class="token attr-name">memAccess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>shared<span class="token punctuation">&apos;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>numa</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpu</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>os</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span> <span class="token attr-name">arch</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>aarch64<span class="token punctuation">&apos;</span></span> <span class="token attr-name">machine</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>virt<span class="token punctuation">&apos;</span></span><span class="token punctuation">&gt;</span></span>hvm<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>devices</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>emulator</span><span class="token punctuation">&gt;</span></span>/usr/local/bin/qemu-system-aarch64<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>emulator</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>interface</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>vhostuser<span class="token punctuation">&apos;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mac</span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>00:00:00:00:00:01<span class="token punctuation">&apos;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>unix<span class="token punctuation">&apos;</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>/usr/local/var/run/openvswitch/dpdkvhostuser0<span class="token punctuation">&apos;</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>client<span class="token punctuation">&apos;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>model</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>virtio<span class="token punctuation">&apos;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>driver</span> <span class="token attr-name">queues</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>2<span class="token punctuation">&apos;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span> <span class="token attr-name">mrg_rxbuf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&apos;</span>on<span class="token punctuation">&apos;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>driver</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>interface</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ul>
<li>&#x53E6;&#x5916;&#x4E00;&#x4E2A;VM&#x4E5F;&#x76F8;&#x5E94;&#x4FEE;&#x6539;</li>
<li>&#x9700;&#x8981;&#x63D0;&#x524D;&#x914D;&#x7F6E;hugetlbfs, CentOS&#x4E0A;<code>dev-hugepages.mount</code>&#x670D;&#x52A1;&#x4F1A;&#x9ED8;&#x8BA4;&#x5F00;&#x542F;, mount&#x5230;<code>/dev/hugepages</code>
&#x5982;&#x679C;&#x5927;&#x9875;&#x5185;&#x5B58;&#x4E0D;&#x8DB3;, &#x53EF;&#x4EE5;&#x9002;&#x5F53;&#x589E;&#x52A0;hugepage&#x6570;&#x76EE;: <code>sudo bash -c &quot;echo 64 &gt; /sys/kernel/mm/hugepages/hugepages-524288kB/nr_hugepages&quot;</code></li>
</ul>
<h1 id="54----&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;"><a name="54----&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;" class="anchor-navigation-ex-anchor" href="#54----&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;"><i class="fa fa-link" aria-hidden="true"></i></a>2. 5.4    &#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;</h1>
<h2 id="5411----ovs&#x91C7;&#x7528;dpdk"><a name="5411----ovs&#x91C7;&#x7528;dpdk" class="anchor-navigation-ex-anchor" href="#5411----ovs&#x91C7;&#x7528;dpdk"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. 5.4.1.1    OVS&#x91C7;&#x7528;DPDK</h2>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003130522.png" alt="">  </p>
<h3 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.1. &#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</h3>
<p>&#x542F;&#x52A8;VM, &#x9A8C;&#x8BC1;&#x8FDE;&#x901A;&#x6027;
&#x914D;&#x4E86;IP&#x540E;, &#x4E24;&#x4E2A;VM&#x53EF;&#x4EE5;&#x4E92;&#x76F8;ping&#x901A;
&#x7ED3;&#x679C;:</p>
<pre class="language-"><code class="lang-bash">$ <span class="token function">sudo</span> ovs-vsctl show
f81a1c52-91c1-40a2-b993-6dfeea09317e
    Bridge <span class="token string">&quot;ovsbr0&quot;</span>
        Port <span class="token string">&quot;dpdkvhostuser0&quot;</span>
            Interface <span class="token string">&quot;dpdkvhostuser0&quot;</span>
                type: dpdkvhostuser
        Port <span class="token string">&quot;ovsbr0&quot;</span>
            Interface <span class="token string">&quot;ovsbr0&quot;</span>
                type: internal
        Port <span class="token string">&quot;dpdkvhostuser1&quot;</span>
            Interface <span class="token string">&quot;dpdkvhostuser1&quot;</span>
                type: dpdkvhostuser
    ovs_version: <span class="token string">&quot;2.8.4&quot;</span>
</code></pre>
<h2 id="5412----ovs&#x652F;&#x6301;numa&#x611F;&#x77E5;"><a name="5412----ovs&#x652F;&#x6301;numa&#x611F;&#x77E5;" class="anchor-navigation-ex-anchor" href="#5412----ovs&#x652F;&#x6301;numa&#x611F;&#x77E5;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. 5.4.1.2    OVS&#x652F;&#x6301;numa&#x611F;&#x77E5;</h2>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003131341.png" alt="">  </p>
<h3 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_1"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_1" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_1"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.1. &#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</h3>
<pre class="language-"><code class="lang-bash">$ <span class="token function">sudo</span> ovs-vsctl list Open_vSwitch <span class="token operator">|</span> <span class="token function">grep</span> other_config
other_config        <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>dpdk-init<span class="token operator">=</span><span class="token string">&quot;true&quot;</span>, dpdk-socket-mem<span class="token operator">=</span><span class="token string">&quot;4096&quot;</span>, pmd-cpu-mask<span class="token operator">=</span><span class="token string">&quot;FF00000000&quot;</span><span class="token punctuation">}</span>
</code></pre>
<p>&#x6CE8;: &#x672C;&#x7CFB;&#x7EDF;&#x4E3A;&#x5355;socket, &#x6240;&#x4EE5;&#x5206;&#x914D;&#x7684;CPU&#x548C;Mem&#x5E76;&#x4E0D;&#x5B58;&#x5728;&#x8DE8;numa node&#x95EE;&#x9898;</p>
<h2 id="542----&#x652F;&#x6301;sr-iov&#x7F51;&#x5361;"><a name="542----&#x652F;&#x6301;sr-iov&#x7F51;&#x5361;" class="anchor-navigation-ex-anchor" href="#542----&#x652F;&#x6301;sr-iov&#x7F51;&#x5361;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. 5.4.2    &#x652F;&#x6301;SR-IOV&#x7F51;&#x5361;</h2>
<h3 id="5421-----sr-iov&#x94FE;&#x8DEF;&#x72B6;&#x6001;&#x611F;&#x77E5;&#x6D4B;&#x8BD5;"><a name="5421-----sr-iov&#x94FE;&#x8DEF;&#x72B6;&#x6001;&#x611F;&#x77E5;&#x6D4B;&#x8BD5;" class="anchor-navigation-ex-anchor" href="#5421-----sr-iov&#x94FE;&#x8DEF;&#x72B6;&#x6001;&#x611F;&#x77E5;&#x6D4B;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.1. 5.4.2.1     SR-IOV&#x94FE;&#x8DEF;&#x72B6;&#x6001;&#x611F;&#x77E5;&#x6D4B;&#x8BD5;</h3>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003131551.png" alt="">  </p>
<h4 id="&#x6D4B;&#x8BD5;link-up----pass"><a name="&#x6D4B;&#x8BD5;link-up----pass" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;link-up----pass"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;link up -- PASS</h4>
<p>&#x672C;&#x6587;&#x4F7F;&#x7528;PCI&#x5730;&#x5740;&#x4E3A;<code>0005:01:00.0</code>&#x7684;Mellanox&#x7269;&#x7406;&#x7F51;&#x5361;<code>enP5p1s0</code>&#x505A;&#x6D4B;&#x8BD5;</p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x521D;&#x59CB;&#x72B6;&#x6001;&#x5982;&#x4E0B;:</span>
$ <span class="token function">sudo</span> ibdev2netdev <span class="token parameter variable">-v</span>
0004:01:00.0 mlx5_0 <span class="token punctuation">(</span>MT4115 - MT1738K12272<span class="token punctuation">)</span> CX413A - ConnectX-4 QSFP28 fw <span class="token number">12.22</span>.1002 port <span class="token number">1</span> <span class="token punctuation">(</span>ACTIVE<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">&gt;</span> enP4p1s0 <span class="token punctuation">(</span>Up<span class="token punctuation">)</span>
0005:01:00.0 mlx5_1 <span class="token punctuation">(</span>MT4115 - MT1738K12253<span class="token punctuation">)</span> CX413A - ConnectX-4 QSFP28 fw <span class="token number">12.22</span>.1002 port <span class="token number">1</span> <span class="token punctuation">(</span>ACTIVE<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">&gt;</span> enP5p1s0 <span class="token punctuation">(</span>Up<span class="token punctuation">)</span>

<span class="token comment">#&#x65B0;&#x589E;2&#x4E2A;sriov&#x7684;VF, link&#x72B6;&#x6001;&#x4E3A;UP</span>
$ <span class="token function">sudo</span> <span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;echo 2 &gt; /sys/class/net/enP5p1s0/device/sriov_numvfs&quot;</span>
$ <span class="token function">sudo</span> ibdev2netdev <span class="token parameter variable">-v</span>
0004:01:00.0 mlx5_0 <span class="token punctuation">(</span>MT4115 - MT1738K12272<span class="token punctuation">)</span> CX413A - ConnectX-4 QSFP28 fw <span class="token number">12.22</span>.1002 port <span class="token number">1</span> <span class="token punctuation">(</span>ACTIVE<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">&gt;</span> enP4p1s0 <span class="token punctuation">(</span>Up<span class="token punctuation">)</span>
0005:01:00.0 mlx5_1 <span class="token punctuation">(</span>MT4115 - MT1738K12253<span class="token punctuation">)</span> CX413A - ConnectX-4 QSFP28 fw <span class="token number">12.22</span>.1002 port <span class="token number">1</span> <span class="token punctuation">(</span>ACTIVE<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">&gt;</span> enP5p1s0 <span class="token punctuation">(</span>Up<span class="token punctuation">)</span>
0005:01:00.1 mlx5_2 <span class="token punctuation">(</span>MT4116 - NA<span class="token punctuation">)</span>  fw <span class="token number">12.22</span>.1002 port <span class="token number">1</span> <span class="token punctuation">(</span>ACTIVE<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">&gt;</span> enP5p1s0f1 <span class="token punctuation">(</span>Up<span class="token punctuation">)</span>
0005:01:00.2 mlx5_3 <span class="token punctuation">(</span>MT4116 - NA<span class="token punctuation">)</span>  fw <span class="token number">12.22</span>.1002 port <span class="token number">1</span> <span class="token punctuation">(</span>ACTIVE<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">&gt;</span> enP5p1s0f2 <span class="token punctuation">(</span>Up<span class="token punctuation">)</span>
</code></pre>
<p>&#x4F7F;&#x7528;virt-manager&#x5728;vm01&#x4E0A;&#x6DFB;&#x52A0;PCI Host Device, &#x9009;&#x62E9;<code>0005:01:00:1</code>
&#x5728;vm01&#x4E0A;&#x67E5;&#x770B;link&#x72B6;&#x6001;&#x4E3A;UP:</p>
<pre class="language-"><code class="lang-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ip link show dev enp5s0</span>
<span class="token number">5</span>: enp5s0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq state UP mode DEFAULT group default qlen <span class="token number">1000</span>
    link/ether <span class="token number">26</span>:35:26:59:32:b9 brd ff:ff:ff:ff:ff:ff
</code></pre>
<p>&#x5728;host&#x4E0A;, vf&#x7684;link&#x4E3A;auto</p>
<pre class="language-"><code class="lang-bash">$ <span class="token function">ip</span> <span class="token function">link</span> show dev enP5p1s0
<span class="token number">10</span>: enP5p1s0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq state UP mode DEFAULT group default qlen <span class="token number">1000</span>
    link/ether ec:0d:9a:89:4a:e6 brd ff:ff:ff:ff:ff:ff
    vf <span class="token number">0</span> MAC 00:00:00:00:00:00, spoof checking off, link-state auto, trust off, query_rss off
    vf <span class="token number">1</span> MAC 00:00:00:00:00:00, spoof checking off, link-state auto, trust off, query_rss off
</code></pre>
<h4 id="&#x6D4B;&#x8BD5;link-down----fail"><a name="&#x6D4B;&#x8BD5;link-down----fail" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;link-down----fail"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;link down -- FAIL</h4>
<p>&#x5728;host&#x4E0A;link down PF:</p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#down&#x6389;PF</span>
$ <span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev enP5p1s0 down
<span class="token comment">#vf&#x7684;link&#x4E3A;auto</span>
$ <span class="token function">ip</span> <span class="token function">link</span> show dev enP5p1s0
<span class="token number">10</span>: enP5p1s0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq state DOWN mode DEFAULT group default qlen <span class="token number">1000</span>
    link/ether ec:0d:9a:89:4a:e6 brd ff:ff:ff:ff:ff:ff
    vf <span class="token number">0</span> MAC 00:00:00:00:00:00, spoof checking off, link-state auto, trust off, query_rss off
    vf <span class="token number">1</span> MAC 00:00:00:00:00:00, spoof checking off, link-state auto, trust off, query_rss off
</code></pre>
<p>&#x5728;vm01&#x4E0A;, link&#x8FD8;&#x662F;<strong>UP</strong></p>
<pre class="language-"><code class="lang-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ip link show dev enp5s0</span>
<span class="token number">5</span>: enp5s0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq state UP mode DEFAULT group default qlen <span class="token number">1000</span>
    link/ether <span class="token number">26</span>:35:26:59:32:b9 brd ff:ff:ff:ff:ff:ff
</code></pre>
<h4 id="fail&#x5206;&#x6790;"><a name="fail&#x5206;&#x6790;" class="anchor-navigation-ex-anchor" href="#fail&#x5206;&#x6790;"><i class="fa fa-link" aria-hidden="true"></i></a>Fail&#x5206;&#x6790;</h4>
<p>&#x7ED3;&#x8BBA;: vm&#x80FD;&#x591F;&#x611F;&#x77E5;host&#x4E0A;&#x5BF9;vf&#x7684;disable&#x548C;enable&#x64CD;&#x4F5C;, &#x4F46;link-state&#x4E3A;auto&#x65F6;, &#x4E0D;&#x80FD;&#x611F;&#x77E5;PF&#x7684;link&#x72B6;&#x6001;.
VF&#x7684;link-state&#x6709;&#x51E0;&#x79CD;&#x914D;&#x7F6E;:
&#x53C2;&#x8003;: <a href="https://docs.oracle.com/cd/E93554_01/E69348/html/uek4-net.html" target="_blank">https://docs.oracle.com/cd/E93554_01/E69348/html/uek4-net.html</a></p>
<blockquote>
<p>Support for SR-IOV VF link state control by using the ip command. Previously, VF links were always on, regardless of the physical link status, which allows VMs on the same virtual Ethernet bridge to communicate even if the physical function (PF) link state is down. However, if the VFs were bonded in active/standby mode, this configuration prevented failover when the physical link used by a VF went down. You can now use the ip link set command to configure the behavior of a VF link:
<code># ip link set device vf number state { auto | enable | disable }</code>
The possible settings are:</p>
<ul>
<li>auto
The VF link state is determined by the PF link state. This setting is suitable for VFs that are bonded in active/standby mode.</li>
<li>disable
The VF link state is permanently down.</li>
<li>enable
The VF link state is permanently up. This is the default setting.</li>
</ul>
</blockquote>
<p>&#x5982;&#x679C;&#x5728;host&#x4E0A;,&#x914D;&#x7F6E;vf&#x7684;state&#x4E3A;disable</p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x914D;&#x7F6E;vf0&#x7684;link-state&#x4E3A;disable</span>
$ <span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev enP5p1s0 vf <span class="token number">0</span> state disable
$ <span class="token function">ip</span> <span class="token function">link</span> show dev enP5p1s0
<span class="token number">10</span>: enP5p1s0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq state DOWN mode DEFAULT group default qlen <span class="token number">1000</span>
    link/ether ec:0d:9a:89:4a:e6 brd ff:ff:ff:ff:ff:ff
    vf <span class="token number">0</span> MAC 00:00:00:00:00:00, spoof checking off, link-state disable, trust off, query_rss off
    vf <span class="token number">1</span> MAC 00:00:00:00:00:00, spoof checking off, link-state auto, trust off, query_rss off
</code></pre>
<p>&#x6B64;&#x65F6;vm01&#x4E0A;, &#x6709;linkw down&#x7684;&#x63D0;&#x793A;, &#x5E76;&#x4E14;&#x663E;&#x793A;link&#x4E3A;DOWN</p>
<pre class="language-"><code class="lang-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># [ 2863.441859] mlx5_core 0000:05:00.0 enp5s0: Link down</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ip link show dev enp5s0</span>
<span class="token number">5</span>: enp5s0: <span class="token operator">&lt;</span>NO-CARRIER,BROADCAST,MULTICAST,UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq state DOWN mode DEFAULT group default qlen <span class="token number">1000</span>
    link/ether <span class="token number">26</span>:35:26:59:32:b9 brd ff:ff:ff:ff:ff:ff
</code></pre>
<p>&#x5728;host&#x4E0A;&#x628A;vf&#x7684;state&#x91CD;&#x65B0;&#x6539;&#x4E3A;enable, vm01&#x7684;&#x80FD;&#x591F;&#x611F;&#x77E5;&#x5E76;up.</p>
<h3 id="5422----hypervisor&#x5141;&#x8BB8;&#x53EA;&#x4F7F;&#x7528;&#x4E00;&#x5BF9;&#x7269;&#x7406;&#x7F51;&#x53E3;"><a name="5422----hypervisor&#x5141;&#x8BB8;&#x53EA;&#x4F7F;&#x7528;&#x4E00;&#x5BF9;&#x7269;&#x7406;&#x7F51;&#x53E3;" class="anchor-navigation-ex-anchor" href="#5422----hypervisor&#x5141;&#x8BB8;&#x53EA;&#x4F7F;&#x7528;&#x4E00;&#x5BF9;&#x7269;&#x7406;&#x7F51;&#x53E3;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.2. 5.4.2.2    Hypervisor&#x5141;&#x8BB8;&#x53EA;&#x4F7F;&#x7528;&#x4E00;&#x5BF9;&#x7269;&#x7406;&#x7F51;&#x53E3;</h3>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003131907.png" alt="">  </p>
<h4 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_2"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_2" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_2"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</h4>
<p>&#x5728;Host B&#x4E0A;, vm01&#x914D;&#x6210;vhost-user, vm02&#x914D;&#x6210;sriov&#x6A21;&#x5F0F;, &#x7136;&#x540E;</p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x5C06;enP5p1s0&#x6DFB;&#x52A0;&#x5230;ovsbr0</span>
<span class="token function">sudo</span> ovs-vsctl add-port ovsbr0 enP5p1s0
$ <span class="token function">sudo</span> ovs-vsctl show
f81a1c52-91c1-40a2-b993-6dfeea09317e
    Bridge <span class="token string">&quot;ovsbr0&quot;</span>
        Port <span class="token string">&quot;enP5p1s0&quot;</span>
            Interface <span class="token string">&quot;enP5p1s0&quot;</span>
        Port <span class="token string">&quot;dpdkvhostuser0&quot;</span>
            Interface <span class="token string">&quot;dpdkvhostuser0&quot;</span>
                type: dpdkvhostuser
                options: <span class="token punctuation">{</span>n_rxq<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">}</span>
        Port <span class="token string">&quot;ovsbr0&quot;</span>
            Interface <span class="token string">&quot;ovsbr0&quot;</span>
                type: internal
        Port <span class="token string">&quot;dpdkvhostuser1&quot;</span>
            Interface <span class="token string">&quot;dpdkvhostuser1&quot;</span>
                type: dpdkvhostuser
                options: <span class="token punctuation">{</span>n_rxq<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">}</span>
    ovs_version: <span class="token string">&quot;2.8.4&quot;</span>
</code></pre>
<p>&#x7269;&#x7406;&#x7F51;&#x5361;&#x4EE5;&#x666E;&#x901A;&#x65B9;&#x5F0F;&#x6DFB;&#x52A0;&#x5230;OVS&#x793A;&#x610F;&#x56FE;:<br><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003131928.png" alt="">  </p>
<p>&#x8FDE;&#x901A;&#x6027;:
ping to | 5.5.5.11(peer) | 5.5.5.22(host) | 5.5.5.33(VM02) | 5.5.5.44(VM01)
----| ----| ----| ----|----|
5.5.5.11(peer) | self | Y | Y | Y
5.5.5.22(host) | Y | self | Y | N
5.5.5.33(VM02) | Y | Y | self | N
5.5.5.44(VM01) | Y | N | N | self</p>
<p>&#x5373;&#x4ECE;&#x5916;&#x90E8;(5.5.5.11)ping vm01(5.5.5.44)&#x548C;vm02(5.5.5.33)&#x80FD;ping&#x901A;.</p>
<h4 id="issue&#x8BA8;&#x8BBA;"><a name="issue&#x8BA8;&#x8BBA;" class="anchor-navigation-ex-anchor" href="#issue&#x8BA8;&#x8BBA;"><i class="fa fa-link" aria-hidden="true"></i></a>issue&#x8BA8;&#x8BBA;</h4>
<ul>
<li>22&#x548C;44&#x4E92;&#x76F8;ping&#x4E0D;&#x901A;, &#x4E3A;&#x4EC0;&#x4E48;?
&#x7B54;: &#x8FD9;&#x662F;&#x6B63;&#x5E38;&#x7684;. &#x5728;userspace datapath(datapath_type=netdev)&#x6A21;&#x5F0F;&#x4E0B;, ovs&#x901A;&#x8FC7;<code>socket(AF_PACKET, SOCK_RAW, 0)</code>&#x53D1;&#x5305;, &#x4E0D;&#x8D70;ip&#x534F;&#x8BAE;&#x6808;. 
ToDo: &#x9A8C;&#x8BC1;&#x4E00;&#x4E0B;&#x5185;&#x6838;datapath&#x6A21;&#x5F0F;&#x4E0B;, &#x672C;&#x673A;&#x7269;&#x7406;&#x7F51;&#x53E3;&#x548C;vm&#x4E4B;&#x95F4;&#x7684;&#x8FDE;&#x901A;&#x6027;.</li>
<li>&#x5982;&#x4F55;&#x7406;&#x89E3;&#x7269;&#x7406;&#x7F51;&#x5361;&#x88AB;add&#x5230;OVS&#x4E0A;(&#x975E;DPDK&#x65B9;&#x5F0F;)? &#x5982;&#x679C;&#x662F;DPDK&#x65B9;&#x5F0F;&#x5462;?<ul>
<li>DPDK&#x65B9;&#x5F0F;<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x5220;&#x6389;&#x63A5;&#x53E3;enP5p1s0</span>
<span class="token function">sudo</span> ovs-vsctl del-port ovsbr0 enP5p1s0
<span class="token comment">#&#x4EE5;dpdk&#x65B9;&#x5F0F;&#x6DFB;&#x52A0;&#x5230;ovsvr0</span>
<span class="token function">sudo</span> ovs-vsctl add-port ovsbr0 dpdkp1 -- <span class="token builtin class-name">set</span> Interface dpdkp1 <span class="token assign-left variable">type</span><span class="token operator">=</span>dpdk options:dpdk-devargs<span class="token operator">=</span>0005:01:00.0
<span class="token function">sudo</span> ovs-vsctl <span class="token builtin class-name">set</span> Interface dpdkp1 options:n_rxq<span class="token operator">=</span><span class="token number">2</span>    
$ <span class="token function">sudo</span> ovs-vsctl show
f81a1c52-91c1-40a2-b993-6dfeea09317e
Bridge <span class="token string">&quot;ovsbr0&quot;</span>
  Port <span class="token string">&quot;dpdkvhostuser0&quot;</span>
      Interface <span class="token string">&quot;dpdkvhostuser0&quot;</span>
          type: dpdkvhostuser
          options: <span class="token punctuation">{</span>n_rxq<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">}</span>
  Port <span class="token string">&quot;ovsbr0&quot;</span>
      Interface <span class="token string">&quot;ovsbr0&quot;</span>
          type: internal
  Port <span class="token string">&quot;dpdkp1&quot;</span>
      Interface <span class="token string">&quot;dpdkp1&quot;</span>
          type: dpdk
          options: <span class="token punctuation">{</span>dpdk-devargs<span class="token operator">=</span><span class="token string">&quot;0005:01:00.0&quot;</span>, <span class="token assign-left variable">n_rxq</span><span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">}</span>
  Port <span class="token string">&quot;dpdkvhostuser1&quot;</span>
      Interface <span class="token string">&quot;dpdkvhostuser1&quot;</span>
          type: dpdkvhostuser
          options: <span class="token punctuation">{</span>n_rxq<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">}</span>
ovs_version: <span class="token string">&quot;2.8.4&quot;</span>
</code></pre>
&#x7269;&#x7406;&#x7F51;&#x5361;&#x4EE5;DPDK&#x65B9;&#x5F0F;&#x6DFB;&#x52A0;&#x5230;OVS
<img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133233.png" alt="">  </li>
</ul>
</li>
</ul>
<p>&#x8FDE;&#x901A;&#x6027;: &#x548C;&#x4E4B;&#x524D;&#x76F8;&#x6BD4;, &#x5230;5.5.5.22&#x7684;&#x62A5;&#x6587;&#x90FD;&#x4E0D;&#x901A;. &#x8BF4;&#x660E;OVS-DPDK&#x7684;PMD&#x5B8C;&#x5168;&#x628A;enP5p1s0&#x63A5;&#x7BA1;&#x4E86;.
ping to | 5.5.5.11 | 5.5.5.22 | 5.5.5.33 | 5.5.5.44
----| ----| ----| ----|----|
5.5.5.11 | self | <strong>N</strong> | Y | Y
5.5.5.22 | <strong>N</strong> | self | <strong>N</strong> | <strong>N</strong>
5.5.5.33 | Y | <strong>N</strong> | self | N
5.5.5.44 | Y | N | N | self</p>
<h3 id="5423-----sr-iov&#x4E0E;&#x865A;&#x62DF;&#x4EA4;&#x6362;&#x673A;&#x4E92;&#x901A;"><a name="5423-----sr-iov&#x4E0E;&#x865A;&#x62DF;&#x4EA4;&#x6362;&#x673A;&#x4E92;&#x901A;" class="anchor-navigation-ex-anchor" href="#5423-----sr-iov&#x4E0E;&#x865A;&#x62DF;&#x4EA4;&#x6362;&#x673A;&#x4E92;&#x901A;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.3. 5.4.2.3     SR-IOV&#x4E0E;&#x865A;&#x62DF;&#x4EA4;&#x6362;&#x673A;&#x4E92;&#x901A;</h3>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133314.png" alt=""><br>&#x6839;&#x636E;&#x4E0A;&#x4E2A;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;, vm02(sr-iov port)&#x548C;vm01(ovs port)&#x662F;&#x4E0D;&#x901A;&#x7684;.vm01&#x53D1;&#x51FA;&#x7684;ping&#x62A5;&#x6587;, &#x76F4;&#x63A5;&#x8D70;Host B&#x7F51;&#x5361;&#x7684;PF wire&#x5230;Host A; vm02&#x53D1;&#x51FA;&#x7684;ping&#x62A5;&#x6587;&#x4E5F;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x7F51;&#x5361;&#x7684;VF&#x5230;Host A.
&#x5982;&#x679C;&#x5C06;vm02&#x79FB;&#x81F3;Host A&#x4E0A;&#x8FD0;&#x884C;, &#x5219;&#x7406;&#x8BBA;&#x4E0A;&#x80FD;&#x591F;ping&#x901A;(&#x5F85;&#x6D4B;&#x8BD5;).</p>
<h4 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----&#x5F85;&#x6F84;&#x6E05;&#x6D4B;&#x8BD5;&#x573A;&#x666F;&#x540E;&#x6D4B;&#x8BD5;"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----&#x5F85;&#x6F84;&#x6E05;&#x6D4B;&#x8BD5;&#x573A;&#x666F;&#x540E;&#x6D4B;&#x8BD5;" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----&#x5F85;&#x6F84;&#x6E05;&#x6D4B;&#x8BD5;&#x573A;&#x666F;&#x540E;&#x6D4B;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- &#x5F85;&#x6F84;&#x6E05;&#x6D4B;&#x8BD5;&#x573A;&#x666F;&#x540E;&#x6D4B;&#x8BD5;</h4>
<h2 id="543----sr-iov&#x7F51;&#x5361;&#x7684;&#x6865;&#x63A5;&#x529F;&#x80FD;"><a name="543----sr-iov&#x7F51;&#x5361;&#x7684;&#x6865;&#x63A5;&#x529F;&#x80FD;" class="anchor-navigation-ex-anchor" href="#543----sr-iov&#x7F51;&#x5361;&#x7684;&#x6865;&#x63A5;&#x529F;&#x80FD;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4. 5.4.3    SR-IOV&#x7F51;&#x5361;&#x7684;&#x6865;&#x63A5;&#x529F;&#x80FD;</h2>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133333.png" alt=""><br>&#x914D;&#x7F6E;&#x4E24;&#x4E2A;vm&#x90FD;&#x4F7F;&#x7528;sriov, &#x5E76;&#x5206;&#x522B;&#x914D;&#x7F6E;&#x540C;&#x7F51;&#x6BB5;ip.
<img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133350.png" alt="">  </p>
<h3 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_3"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_3" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_3"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.1. &#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</h3>
<p>&#x7269;&#x7406;&#x7F51;&#x5361;(Mellanox ConnectX-4)&#x9ED8;&#x8BA4;&#x6865;&#x63A5;VF. &#x4E24;&#x4E2A;VM&#x80FD;&#x591F;&#x4E92;&#x76F8;ping&#x901A;. &#x5728;&#x5BF9;&#x7AEF;(Host A)&#x4E0A;&#x6293;&#x5305;, &#x6CA1;&#x6709;&#x76F8;&#x5173;&#x7684; ICMP&#x62A5;&#x6587;.</p>
<h2 id="544----&#x652F;&#x6301;vnic&#x591A;&#x961F;&#x5217;"><a name="544----&#x652F;&#x6301;vnic&#x591A;&#x961F;&#x5217;" class="anchor-navigation-ex-anchor" href="#544----&#x652F;&#x6301;vnic&#x591A;&#x961F;&#x5217;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5. 5.4.4    &#x652F;&#x6301;vNIC&#x591A;&#x961F;&#x5217;</h2>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133414.png" alt=""><br>&#x5728;&lt;&#x6D4B;&#x8BD5;&#x524D;&#x51C6;&#x5907;&gt;&#x5C0F;&#x8282;&#x4E2D;, OVS&#x548C;VM&#x7684;&#x63A5;&#x53E3;dpdkvhostuser&#x5DF2;&#x7ECF;&#x914D;&#x7F6E;&#x4E86;multi queue(2&#x4E2A;); VM&#x4E5F;&#x914D;&#x7F6E;&#x4E86;2&#x4E2A;queue
&#x5728;Host B&#x4E0A;&#x6709;:</p>
<pre class="language-"><code class="lang-bash">$ <span class="token function">sudo</span> ovs-appctl dpif/show
netdev@ovs-netdev: hit:458 missed:71
        ovsbr0:
                dpdkvhostuser0 <span class="token number">2</span>/3: <span class="token punctuation">(</span>dpdkvhostuser: <span class="token assign-left variable">configured_rx_queues</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">configured_tx_queues</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">mtu</span><span class="token operator">=</span><span class="token number">1500</span>, <span class="token assign-left variable">requested_rx_queues</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">requested_tx_queues</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
                dpdkvhostuser1 <span class="token number">1</span>/2: <span class="token punctuation">(</span>dpdkvhostuser: <span class="token assign-left variable">configured_rx_queues</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">configured_tx_queues</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">mtu</span><span class="token operator">=</span><span class="token number">1500</span>, <span class="token assign-left variable">requested_rx_queues</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">requested_tx_queues</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
                ovsbr0 <span class="token number">65534</span>/1: <span class="token punctuation">(</span>tap<span class="token punctuation">)</span>
</code></pre>
<p>&#x5728;VM&#x91CC;&#x9762;&#x6709;:</p>
<pre class="language-"><code class="lang-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ethtool -l eth1</span>
Channel parameters <span class="token keyword">for</span> eth1:
Pre-set maximums:
RX:        <span class="token number">0</span>
TX:        <span class="token number">0</span>
Other:        <span class="token number">0</span>
Combined:    <span class="token number">2</span>
Current hardware settings:
RX:        <span class="token number">0</span>
TX:        <span class="token number">0</span>
Other:        <span class="token number">0</span>
Combined:    <span class="token number">2</span>
</code></pre>
<p>&#x5728;VM&#x91CC;&#x9762;, &#x5206;&#x522B;&#x914D;&#x7F6E;2&#x5BF9;IP: vm01(5.5.5.51, 6.6.6.61), vm02(5.5.5.52, 6.6.6.62)<br><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133443.png" alt="">  </p>
<h3 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_4"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_4" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_4"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.1. &#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</h3>
<p>2&#x5BF9;IP&#x80FD;&#x591F;&#x5206;&#x522B;ping&#x901A;. <code>cat /proc/interrupts</code>&#x770B;&#x5230;virtio&#x4E2D;&#x65AD;&#x5728;4&#x4E2A;CPU&#x7684;2&#x4E2A;&#x4E0A;&#x6709;&#x4E2D;&#x65AD;; <code>tc</code>&#x770B;&#x5230;2&#x4E2A;&#x53D1;&#x9001;&#x961F;&#x5217;&#x90FD;&#x6709;&#x53D1;&#x5305;&#x7EDF;&#x8BA1;.</p>
<pre class="language-"><code class="lang-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># tc -s class show dev eth1</span>
class mq :1 root 
 Sent <span class="token number">7706</span> bytes <span class="token number">79</span> pkt <span class="token punctuation">(</span>dropped <span class="token number">0</span>, overlimits <span class="token number">0</span> requeues <span class="token number">0</span><span class="token punctuation">)</span> 
 backlog 0b 0p requeues <span class="token number">0</span> 
class mq :2 root 
 Sent <span class="token number">20222</span> bytes <span class="token number">183</span> pkt <span class="token punctuation">(</span>dropped <span class="token number">0</span>, overlimits <span class="token number">0</span> requeues <span class="token number">0</span><span class="token punctuation">)</span> 
 backlog 0b 0p requeues <span class="token number">0</span>
</code></pre>
<h2 id="545----&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;"><a name="545----&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;" class="anchor-navigation-ex-anchor" href="#545----&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>2.6. 5.4.5    &#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;</h2>
<h3 id="5451----ovs-&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;"><a name="5451----ovs-&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;" class="anchor-navigation-ex-anchor" href="#5451----ovs-&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>2.6.1. 5.4.5.1    OVS &#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;</h3>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133506.png" alt=""><br>&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x9A8C;&#x8BC1;&#x4E86;&#x8FDE;&#x901A;&#x6027;, &#x4E0B;&#x9762;&#x53EA;&#x9A8C;&#x8BC1;&#x9694;&#x79BB;&#x6027;.
&#x65B0;&#x589E;ovsbr1, &#x5E76;&#x5728;ovsbr1&#x4E0A;&#x589E;&#x52A0;dpdkvhostuser&#x7C7B;&#x578B;&#x7684;port:dpdkvhostuser2, &#x5E76;&#x628A;dpdkvhostuser2&#x6302;&#x5230;VM02&#x4E0A;</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> ovs-vsctl add-br ovsbr1 -- <span class="token builtin class-name">set</span> bridge ovsbr1 <span class="token assign-left variable">datapath_type</span><span class="token operator">=</span>netdev
<span class="token function">sudo</span> ovs-vsctl add-port ovsbr1 dpdkvhostuser2 -- <span class="token builtin class-name">set</span> Interface dpdkvhostuser2 <span class="token assign-left variable">type</span><span class="token operator">=</span>dpdkvhostuser
$ <span class="token function">sudo</span> ovs-appctl dpif/show
netdev@ovs-netdev: hit:481 missed:89
        ovsbr0:
                dpdkvhostuser0 <span class="token number">2</span>/3: <span class="token punctuation">(</span>dpdkvhostuser: <span class="token assign-left variable">configured_rx_queues</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">configured_tx_queues</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">mtu</span><span class="token operator">=</span><span class="token number">1500</span>, <span class="token assign-left variable">requested_rx_queues</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">requested_tx_queues</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
                dpdkvhostuser1 <span class="token number">1</span>/2: <span class="token punctuation">(</span>dpdkvhostuser: <span class="token assign-left variable">configured_rx_queues</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">configured_tx_queues</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">mtu</span><span class="token operator">=</span><span class="token number">1500</span>, <span class="token assign-left variable">requested_rx_queues</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">requested_tx_queues</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
                ovsbr0 <span class="token number">65534</span>/1: <span class="token punctuation">(</span>tap<span class="token punctuation">)</span>
        ovsbr1:
                dpdkvhostuser2 <span class="token number">1</span>/5: <span class="token punctuation">(</span>dpdkvhostuser: <span class="token assign-left variable">configured_rx_queues</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">configured_tx_queues</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">mtu</span><span class="token operator">=</span><span class="token number">1500</span>, <span class="token assign-left variable">requested_rx_queues</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">requested_tx_queues</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
                ovsbr1 <span class="token number">65534</span>/4: <span class="token punctuation">(</span>tap<span class="token punctuation">)</span>
</code></pre>
<p>&#x5728;VM02&#x4E0A;&#x914D;&#x7F6E;IP, &#x548C;VM01&#x540C;&#x7F51;&#x6BB5;, &#x4F46;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;ovs bridge.<br><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133531.png" alt="">  </p>
<h4 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_5"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_5" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_5"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</h4>
<p>VM02 ping&#x4E0D;&#x901A;VM01</p>
<h3 id="5452----sr-iov-&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;"><a name="5452----sr-iov-&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;" class="anchor-navigation-ex-anchor" href="#5452----sr-iov-&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>2.6.2. 5.4.5.2    SR-IOV &#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x4E0E;&#x5730;&#x5740;&#x590D;&#x7528;</h3>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133551.png" alt=""><br>&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x9A8C;&#x8BC1;&#x8FC7;, &#x4E24;&#x4E2A;VM&#x5206;&#x522B;&#x8FDE;&#x540C;&#x4E00;&#x4E2A;PF&#x7684;&#x4E24;&#x4E2A;VF, &#x9ED8;&#x8BA4;&#x80FD;&#x591F;ping&#x901A;.
&#x4E0B;&#x9762;&#x4FEE;&#x6539;VF&#x7684;vlan</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev enP5p1s0 vf <span class="token number">0</span> vlan <span class="token number">100</span>
<span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev enP5p1s0 vf <span class="token number">1</span> vlan <span class="token number">101</span>
</code></pre>
<h4 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_6"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_6" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_6"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</h4>
<p>&#x4FEE;&#x6539;&#x540E;, &#x4E24;&#x4E2A;VF&#x5206;&#x522B;&#x5C5E;&#x4E8E;vlan100&#x548C;vlan101, &#x4E92;&#x76F8;ping&#x4E0D;&#x901A;.</p>
<pre class="language-"><code class="lang-bash">$ <span class="token function">ip</span> <span class="token function">link</span> show dev enP5p1s0
<span class="token number">10</span>: enP5p1s0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq state UP mode DEFAULT group default qlen <span class="token number">1000</span>
    link/ether ec:0d:9a:89:4a:e6 brd ff:ff:ff:ff:ff:ff
    vf <span class="token number">0</span> MAC 00:00:00:00:00:00, vlan <span class="token number">100</span>, spoof checking off, link-state enable, trust off, query_rss off
    vf <span class="token number">1</span> MAC 00:00:00:00:00:00, vlan <span class="token number">101</span>, spoof checking off, link-state auto, trust off, query_rss off
</code></pre>
<h2 id="546----mtu&#x53EF;&#x8C03;&#x6574;"><a name="546----mtu&#x53EF;&#x8C03;&#x6574;" class="anchor-navigation-ex-anchor" href="#546----mtu&#x53EF;&#x8C03;&#x6574;"><i class="fa fa-link" aria-hidden="true"></i></a>2.7. 5.4.6    MTU&#x53EF;&#x8C03;&#x6574;</h2>
<h3 id="5461----ovs-mtu&#x53EF;&#x8C03;&#x6574;&#xFF08;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;sdn&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;&#xFF09;"><a name="5461----ovs-mtu&#x53EF;&#x8C03;&#x6574;&#xFF08;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;sdn&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;&#xFF09;" class="anchor-navigation-ex-anchor" href="#5461----ovs-mtu&#x53EF;&#x8C03;&#x6574;&#xFF08;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;sdn&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;&#xFF09;"><i class="fa fa-link" aria-hidden="true"></i></a>2.7.1. 5.4.6.1    OVS MTU&#x53EF;&#x8C03;&#x6574;&#xFF08;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;SDN&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;&#xFF09;</h3>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133620.png" alt=""><br>&#x5728;&lt;&#x542F;&#x52A8;&#x5E76;&#x914D;&#x7F6E;OVS&gt;&#x5C0F;&#x8282;&#x914D;&#x7F6E;&#x7684;&#x57FA;&#x7840;&#x4E0A;, &#x5728;OVS&#x4E0A;&#x6DFB;&#x52A0;&#x7269;&#x7406;&#x7F51;&#x5361;:</p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x6DFB;&#x52A0;&#x4E1A;&#x52A1;&#x7269;&#x7406;&#x53E3;, type=DPDK</span>
$ <span class="token function">sudo</span> ovs-vsctl add-port ovsbr0 dpdkp1 -- <span class="token builtin class-name">set</span> Interface dpdkp1 <span class="token assign-left variable">type</span><span class="token operator">=</span>dpdk options:dpdk-devargs<span class="token operator">=</span>0005:01:00.0
<span class="token comment">#&#x8BBE;&#x7F6E;&#x8BE5;&#x7269;&#x7406;&#x53E3;&#x7684;q&#x4E3A;2</span>
$ <span class="token function">sudo</span> ovs-vsctl <span class="token builtin class-name">set</span> Interface dpdkp1 options:n_rxq<span class="token operator">=</span><span class="token number">2</span>
<span class="token comment">#&#x6B64;&#x65F6;OVS&#x914D;&#x7F6E;&#x5982;&#x4E0B;:</span>
$ <span class="token function">sudo</span> ovs-vsctl show
f81a1c52-91c1-40a2-b993-6dfeea09317e
    Bridge <span class="token string">&quot;ovsbr0&quot;</span>
        Port <span class="token string">&quot;dpdkp1&quot;</span>
            Interface <span class="token string">&quot;dpdkp1&quot;</span>
                type: dpdk
                options: <span class="token punctuation">{</span>dpdk-devargs<span class="token operator">=</span><span class="token string">&quot;0005:01:00.0&quot;</span>, <span class="token assign-left variable">n_rxq</span><span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">}</span>
        Port <span class="token string">&quot;dpdkvhostuser0&quot;</span>
            Interface <span class="token string">&quot;dpdkvhostuser0&quot;</span>
                type: dpdkvhostuser
                options: <span class="token punctuation">{</span>n_rxq<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">}</span>
        Port <span class="token string">&quot;ovsbr0&quot;</span>
            Interface <span class="token string">&quot;ovsbr0&quot;</span>
                type: internal
        Port <span class="token string">&quot;dpdkvhostuser1&quot;</span>
            Interface <span class="token string">&quot;dpdkvhostuser1&quot;</span>
                type: dpdkvhostuser
                options: <span class="token punctuation">{</span>n_rxq<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">}</span>
    ovs_version: <span class="token string">&quot;2.8.4&quot;</span>
<span class="token comment">#&#x9ED8;&#x8BA4;&#x7684;mtu&#x4E3A;1500</span>
$ <span class="token function">sudo</span> ovs-appctl dpctl/show
netdev@ovs-netdev:
        lookups: hit:8 missed:17 lost:4
        flows: <span class="token number">0</span>
        port <span class="token number">0</span>: ovs-netdev <span class="token punctuation">(</span>tap<span class="token punctuation">)</span>
        port <span class="token number">1</span>: ovsbr0 <span class="token punctuation">(</span>tap<span class="token punctuation">)</span>
        port <span class="token number">2</span>: dpdkvhostuser1 <span class="token punctuation">(</span>dpdkvhostuser: <span class="token assign-left variable">configured_rx_queues</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">configured_tx_queues</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">mtu</span><span class="token operator">=</span><span class="token number">1500</span>, <span class="token assign-left variable">requested_rx_queues</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">requested_tx_queues</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        port <span class="token number">3</span>: dpdkvhostuser0 <span class="token punctuation">(</span>dpdkvhostuser: <span class="token assign-left variable">configured_rx_queues</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">configured_tx_queues</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">mtu</span><span class="token operator">=</span><span class="token number">1500</span>, <span class="token assign-left variable">requested_rx_queues</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">requested_tx_queues</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        port <span class="token number">4</span>: dpdkp1 <span class="token punctuation">(</span>dpdk: <span class="token assign-left variable">configured_rx_queues</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">configured_rxq_descriptors</span><span class="token operator">=</span><span class="token number">2048</span>, <span class="token assign-left variable">configured_tx_queues</span><span class="token operator">=</span><span class="token number">9</span>, <span class="token assign-left variable">configured_txq_descriptors</span><span class="token operator">=</span><span class="token number">2048</span>, <span class="token assign-left variable">lsc_interrupt_mode</span><span class="token operator">=</span>false, <span class="token assign-left variable">mtu</span><span class="token operator">=</span><span class="token number">1500</span>, <span class="token assign-left variable">requested_rx_queues</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">requested_rxq_descriptors</span><span class="token operator">=</span><span class="token number">2048</span>, <span class="token assign-left variable">requested_tx_queues</span><span class="token operator">=</span><span class="token number">9</span>, <span class="token assign-left variable">requested_txq_descriptors</span><span class="token operator">=</span><span class="token number">2048</span>, <span class="token assign-left variable">rx_csum_offload</span><span class="token operator">=</span>true<span class="token punctuation">)</span>
</code></pre>
<p>&#x6839;&#x636E;&#x7528;&#x4F8B;, &#x8FD9;&#x91CC;&#x9A8C;&#x8BC1;&#x4FEE;&#x6539;OVS&#x7684;mtu&#x662F;&#x5426;&#x6709;&#x6548;:
&#x4FEE;&#x6539;bridge&#x7684;MTU&#x5230;4000</p>
<pre class="language-"><code>sudo ovs-vsctl set Interface ovsbr0 mtu_request=4000
sudo ovs-vsctl set Interface dpdkp1 mtu_request=4000
sudo ovs-vsctl set Interface dpdkvhostuser0 mtu_request=4000
sudo ovs-vsctl set Interface dpdkvhostuser1 mtu_request=4000
</code></pre><p>&#x5206;&#x522B;&#x4FEE;&#x6539;VM01&#x548C;VM02&#x7684;MTU&#x5230;4000</p>
<pre class="language-"><code>ip link set dev eth1 mtu 4000
</code></pre><h4 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_7"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_7" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_7"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</h4>
<p>VM01&#x548C;VM02&#x4E92;&#x76F8;ping, &#x5C0F;&#x4E8E;4000&#x7684;&#x62A5;&#x6587;&#x80FD;ping&#x901A;, &#x5927;&#x4E8E;4000&#x7684;ping&#x4E0D;&#x901A;. &#x8BF4;&#x660E;&#x4FEE;&#x6539;OVS&#x7684;mtu&#x6709;&#x6548;.</p>
<h4 id="&#x7591;&#x95EE;-dpdkp1&#x7684;txq&#x4E2A;&#x6570;"><a name="&#x7591;&#x95EE;-dpdkp1&#x7684;txq&#x4E2A;&#x6570;" class="anchor-navigation-ex-anchor" href="#&#x7591;&#x95EE;-dpdkp1&#x7684;txq&#x4E2A;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7591;&#x95EE;: dpdkp1&#x7684;txq&#x4E2A;&#x6570;</h4>
<p>&#x4E0A;&#x9762;<code>sudo ovs-appctl dpctl/show</code>&#x663E;&#x793A;: <code>configured_rx_queues=2, configured_tx_queues=9</code>, &#x4E3A;&#x4EC0;&#x4E48;txq&#x7684;&#x4E2A;&#x6570;&#x662F;9?
&#x53C2;&#x8003;: <a href="http://docs.openvswitch.org/en/latest/topics/dpdk/pmd/" target="_blank">http://docs.openvswitch.org/en/latest/topics/dpdk/pmd/</a></p>
<h3 id="5462----sr-iov-mtu&#x53EF;&#x8C03;&#x6574;&#xFF08;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;sdn&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;&#xFF09;"><a name="5462----sr-iov-mtu&#x53EF;&#x8C03;&#x6574;&#xFF08;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;sdn&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;&#xFF09;" class="anchor-navigation-ex-anchor" href="#5462----sr-iov-mtu&#x53EF;&#x8C03;&#x6574;&#xFF08;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;sdn&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;&#xFF09;"><i class="fa fa-link" aria-hidden="true"></i></a>2.7.2. 5.4.6.2    SR-IOV MTU&#x53EF;&#x8C03;&#x6574;&#xFF08;vxlan&#x7F51;&#x7EDC;&#x53EA;&#x5728;SDN&#x573A;&#x666F;&#x4E0B;&#x6D4B;&#x8BD5;&#xFF09;</h3>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133649.png" alt=""><br>&#x6839;&#x636E;&#x8981;&#x6C42;, &#x5148;&#x8BBE;&#x7F6E;&#x7269;&#x7406;&#x7F51;&#x5361;&#x7684;mtu</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev enP5p1s0 mtu <span class="token number">4000</span>
</code></pre>
<h4 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_8"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_8" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_8"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</h4>
<p>VM&#x7684;mtu&#x9ED8;&#x8BA4;&#x503C;&#x8FD8;&#x662F;1500, ping&#x62A5;&#x6587;&#x5927;&#x5C0F;&#x4E3A;2048&#x65F6;ping&#x4E0D;&#x901A;.
&#x4FEE;&#x6539;vm&#x7684;mtu&#x4E3A;4000, <code>ping -s 2048 -M do 5.5.5.22</code>&#x53EF;&#x4EE5;ping&#x901A;.
&#x4FEE;&#x6539;host&#x548C;vm&#x7684;mtu&#x4E3A;9000, &#x5C0F;&#x4E8E;(9000-28)&#x5B57;&#x8282;&#x7684;&#x62A5;&#x6587;&#x53EF;&#x4EE5;ping&#x901A;.</p>
<h2 id="547----&#x652F;&#x6301;vlan&#x900F;&#x4F20;"><a name="547----&#x652F;&#x6301;vlan&#x900F;&#x4F20;" class="anchor-navigation-ex-anchor" href="#547----&#x652F;&#x6301;vlan&#x900F;&#x4F20;"><i class="fa fa-link" aria-hidden="true"></i></a>2.8. 5.4.7    &#x652F;&#x6301;VLAN&#x900F;&#x4F20;</h2>
<h3 id="5471----ovs-&#x652F;&#x6301;vlan&#x900F;&#x4F20;"><a name="5471----ovs-&#x652F;&#x6301;vlan&#x900F;&#x4F20;" class="anchor-navigation-ex-anchor" href="#5471----ovs-&#x652F;&#x6301;vlan&#x900F;&#x4F20;"><i class="fa fa-link" aria-hidden="true"></i></a>2.8.1. 5.4.7.1    OVS &#x652F;&#x6301;VLAN&#x900F;&#x4F20;</h3>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133708.png" alt=""><br>&#x6D4B;&#x8BD5;&#x793A;&#x610F;&#x56FE;:<br><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133728.png" alt=""><br>&#x5728;Host B&#x4E0A;:</p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x5C06;&#x4E24;&#x4E2A;VM&#x5BF9;&#x5E94;&#x7684;port&#x52A0;&#x5165;vlan 100(&#x5916;&#x5C42; vlan), &#x5E76;&#x914D;&#x7F6E;cvlan(&#x5185;&#x5C42; vlan)&#x4E3A;0&#x548C;10</span>
<span class="token function">sudo</span> ovs-vsctl <span class="token builtin class-name">set</span> port dpdkvhostuser0 <span class="token assign-left variable">vlan_mode</span><span class="token operator">=</span>dot1q-tunnel <span class="token assign-left variable">tag</span><span class="token operator">=</span><span class="token number">100</span> <span class="token assign-left variable">cvlans</span><span class="token operator">=</span><span class="token number">0,10</span> other-config:qinq-ethtype<span class="token operator">=</span><span class="token number">802</span>.1q
<span class="token function">sudo</span> ovs-vsctl <span class="token builtin class-name">set</span> port dpdkvhostuser1 <span class="token assign-left variable">vlan_mode</span><span class="token operator">=</span>dot1q-tunnel <span class="token assign-left variable">tag</span><span class="token operator">=</span><span class="token number">100</span> <span class="token assign-left variable">cvlans</span><span class="token operator">=</span><span class="token number">0,10</span> other-config:qinq-ethtype<span class="token operator">=</span><span class="token number">802</span>.1q
<span class="token comment">#&#x5C06;&#x7269;&#x7406;&#x7F51;&#x5361;&#x52A0;&#x5165;vlan 100, native-tagged&#x662F;&#x8BF4;&#x51FA;&#x7AEF;&#x53E3;&#x5E26;tag, &#x8BE6;&#x89C1;ofproto/ofproto.h</span>
<span class="token function">sudo</span> ovs-vsctl <span class="token builtin class-name">set</span> port dpdkp1 <span class="token assign-left variable">vlan_mode</span><span class="token operator">=</span>native-tagged <span class="token assign-left variable">tag</span><span class="token operator">=</span><span class="token number">100</span> other-config:qinq-ethtype<span class="token operator">=</span><span class="token number">802</span>.1q
</code></pre>
<p>&#x5728;VM01&#x4E0A;</p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x914D;&#x7F6E;vm01&#x7684;&#x63A5;&#x53E3;IP&#x4E3A;192.168.1.100</span>
<span class="token function">ip</span> addr <span class="token function">add</span> <span class="token number">192.168</span>.1.100/24 dev eth1
<span class="token comment">#&#x589E;&#x52A0;vlan 10</span>
<span class="token function">ip</span> <span class="token function">link</span> <span class="token function">add</span> <span class="token function">link</span> eth1 name eth1.10 <span class="token builtin class-name">type</span> vlan <span class="token function">id</span> <span class="token number">10</span>
<span class="token comment">#&#x7ED9;vlan 10&#x5B50;&#x63A5;&#x53E3;&#x914D;&#x7F6E;IP</span>
<span class="token function">ip</span> addr <span class="token function">add</span> <span class="token number">192.168</span>.10.100/24 dev eth1.10
<span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> up dev eth1.10
</code></pre>
<p>&#x5728;VM02&#x4E0A;</p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x914D;&#x7F6E;vm01&#x7684;&#x63A5;&#x53E3;IP&#x4E3A;192.168.1.200</span>
<span class="token function">ip</span> addr <span class="token function">add</span> <span class="token number">192.168</span>.1.200/24 dev eth1
<span class="token comment">#&#x589E;&#x52A0;vlan 10</span>
<span class="token function">ip</span> <span class="token function">link</span> <span class="token function">add</span> <span class="token function">link</span> eth1 name eth1.10 <span class="token builtin class-name">type</span> vlan <span class="token function">id</span> <span class="token number">10</span>
<span class="token comment">#&#x7ED9;vlan 10&#x5B50;&#x63A5;&#x53E3;&#x914D;&#x7F6E;IP</span>
<span class="token function">ip</span> addr <span class="token function">add</span> <span class="token number">192.168</span>.10.200/24 dev eth1.10
<span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> up dev eth1.10
</code></pre>
<h4 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_9"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_9" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_9"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</h4>
<ul>
<li>VM01&#x5728;192.168.1.0&#x548C;192.168.10.0&#x7F51;&#x6BB5;&#x5206;&#x522B;ping VM02, &#x53EF;&#x4EE5;ping&#x901A;.</li>
<li>&#x5728;&#x5BF9;&#x7AEF;(Host A)&#x4E0A;&#x6293;&#x5305;, ping 192.168.1.101&#x65F6;&#x6709;&#x5355;&#x5C42;vlan tag, id&#x4E3A;100<pre class="language-"><code>18:02:10.058754 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 192.168.1.101 tell 192.168.1.200, length 42
      0x0000:  ffff ffff ffff 5254 00f0 25e4 8100 0064  ......RT..%....d
      0x0010:  0806 0001 0800 0604 0001 5254 00f0 25e4  ..........RT..%.
      0x0020:  c0a8 01c8 0000 0000 0000 c0a8 0165 0000  .............e..
      0x0030:  0000 0000 0000 0000 0000 0000
</code></pre></li>
<li>&#x5728;&#x5BF9;&#x7AEF;(Host A)&#x4E0A;&#x6293;&#x5305;, ping 192.168.10.101&#x65F6;&#x6709;&#x53CC;&#x5C42;vlan tag, &#x5916;&#x5C42;&#x4E3A;100, &#x5185;&#x5C42;&#x4E3A;10<pre class="language-"><code>18:04:39.898836 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 192.168.10.101 tell 192.168.10.200, length 38
      0x0000:  ffff ffff ffff 5254 00f0 25e4 8100 0064  ......RT..%....d
      0x0010:  8100 000a 0806 0001 0800 0604 0001 5254  ..............RT
      0x0020:  00f0 25e4 c0a8 0ac8 0000 0000 0000 c0a8  ..%.............
      0x0030:  0a65 0000 0000 0000 0000 0000            .e..........
</code></pre></li>
</ul>
<h3 id="5472----sr-iov-&#x652F;&#x6301;vlan&#x900F;&#x4F20;"><a name="5472----sr-iov-&#x652F;&#x6301;vlan&#x900F;&#x4F20;" class="anchor-navigation-ex-anchor" href="#5472----sr-iov-&#x652F;&#x6301;vlan&#x900F;&#x4F20;"><i class="fa fa-link" aria-hidden="true"></i></a>2.8.2. 5.4.7.2    SR-IOV &#x652F;&#x6301;VLAN&#x900F;&#x4F20;</h3>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133751.png" alt="">  </p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x7ED9;&#x6BCF;&#x4E2A;VF&#x8BBE;&#x7F6E;vlan tag</span>
<span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev enP5p1s0 vf <span class="token number">0</span> vlan <span class="token number">100</span>
<span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev enP5p1s0 vf <span class="token number">1</span> vlan <span class="token number">100</span>
</code></pre>
<p>&#x5728;VM01&#x4E0A;</p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x914D;&#x7F6E;vm01&#x7684;&#x63A5;&#x53E3;IP&#x4E3A;5.5.5.100</span>
<span class="token function">ip</span> addr <span class="token function">add</span> <span class="token number">5.5</span>.5.100/24 dev enp4s0
<span class="token comment">#&#x589E;&#x52A0;vlan 10</span>
<span class="token function">ip</span> <span class="token function">link</span> <span class="token function">add</span> <span class="token function">link</span> enp4s0 name enp4s0.10 <span class="token builtin class-name">type</span> vlan <span class="token function">id</span> <span class="token number">10</span>
<span class="token comment">#&#x7ED9;vlan 10&#x5B50;&#x63A5;&#x53E3;&#x914D;&#x7F6E;IP</span>
<span class="token function">ip</span> addr <span class="token function">add</span> <span class="token number">5.5</span>.10.100/24 dev enp4s0.10
<span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> up dev enp4s0.10
</code></pre>
<p>&#x5728;VM02&#x4E0A;</p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x914D;&#x7F6E;vm01&#x7684;&#x63A5;&#x53E3;IP&#x4E3A;5.5.5.200</span>
<span class="token function">ip</span> addr <span class="token function">add</span> <span class="token number">5.5</span>.5.200/24 dev enp4s0
<span class="token comment">#&#x589E;&#x52A0;vlan 10</span>
<span class="token function">ip</span> <span class="token function">link</span> <span class="token function">add</span> <span class="token function">link</span> enp4s0 name enp4s0.10 <span class="token builtin class-name">type</span> vlan <span class="token function">id</span> <span class="token number">10</span>
<span class="token comment">#&#x7ED9;vlan 10&#x5B50;&#x63A5;&#x53E3;&#x914D;&#x7F6E;IP</span>
<span class="token function">ip</span> addr <span class="token function">add</span> <span class="token number">5.5</span>.10.200/24 dev enp4s0.10
<span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> up dev enp4s0.10
</code></pre>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133812.png" alt="">  </p>
<h4 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----fail"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----fail" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----fail"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- FAIL</h4>
<p>VM01&#x548C;VM02&#x7528;enp4s0.10&#x4E92;&#x76F8;ping, &#x4E0D;&#x901A;</p>
<p>&#x6CE8;: &#x672C;&#x6587;&#x4F7F;&#x7528;Mellanox ConnectX-4, &#x5728;OFED 4.3-3.0.2&#x7248;&#x672C;&#x4E2D;, &#x5176;&#x7528;&#x6237;&#x624B;&#x518C;&#x660E;&#x786E;&#x8BF4;&#x660E;ConnectX-4&#x4E0D;&#x652F;&#x6301;QinQ.
&#x5728;OFED 4.4&#x7248;&#x672C;&#x4E2D;, &#x65B0;&#x589E;&#x4E86;ConnectX-4&#x7684;QinQ&#x652F;&#x6301;.</p>
<h4 id="todo-&#x5207;&#x6362;&#x81F3;ofed-44&#x7248;&#x672C;&#x91CD;&#x65B0;&#x6D4B;&#x8BD5;"><a name="todo-&#x5207;&#x6362;&#x81F3;ofed-44&#x7248;&#x672C;&#x91CD;&#x65B0;&#x6D4B;&#x8BD5;" class="anchor-navigation-ex-anchor" href="#todo-&#x5207;&#x6362;&#x81F3;ofed-44&#x7248;&#x672C;&#x91CD;&#x65B0;&#x6D4B;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a>ToDo: &#x5207;&#x6362;&#x81F3;OFED 4.4&#x7248;&#x672C;&#x91CD;&#x65B0;&#x6D4B;&#x8BD5;</h4>
<h2 id="548----&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;"><a name="548----&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;" class="anchor-navigation-ex-anchor" href="#548----&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;"><i class="fa fa-link" aria-hidden="true"></i></a>2.9. 5.4.8    &#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;</h2>
<h3 id="5481-----ovs-&#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;"><a name="5481-----ovs-&#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;" class="anchor-navigation-ex-anchor" href="#5481-----ovs-&#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;"><i class="fa fa-link" aria-hidden="true"></i></a>2.9.1. 5.4.8.1     OVS &#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;</h3>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133833.png" alt=""><br>&#x4E3B;&#x8981;&#x8003;&#x5BDF;OVS&#x80FD;&#x5426;&#x5BF9;&#x7269;&#x7406;&#x7F51;&#x5361;&#x8FDB;&#x884C;&#x5E26;&#x5BBD;&#x9650;&#x5236;, &#x8FD9;&#x91CC;&#x505A;&#x4E00;&#x4E0B;&#x7B80;&#x5316;&#x5982;&#x4E0B;&#x56FE;:<br><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133852.png" alt=""><br>Host A&#x548C;Host B&#x4E0A;&#x7684;VM01&#x505A;iperf&#x6D4B;&#x8BD5;&#x5E26;&#x5BBD;, &#x4E0D;&#x8BBE;&#x7F6E;&#x5E26;&#x5BBD;&#x6BD4;&#x4F8B;&#x65F6;:
&#x6027;&#x80FD;&#x5728;<code>10.3 Gbits/sec</code>, &#x4E3B;&#x8981;&#x74F6;&#x9888;&#x70B9;&#x5728;Host A&#x4E0A;&#x7684;kernel&#x534F;&#x8BAE;&#x6808;, &#x4EE5;&#x53CA;VM01&#x4E0A;&#x7684;kernel&#x534F;&#x8BAE;&#x6808;.</p>
<pre class="language-"><code>[  4]  15.00-16.00  sec   718 MBytes  6.02 Gbits/sec  7267   1024 KBytes
[  6]  15.00-16.00  sec   366 MBytes  3.07 Gbits/sec  6713   76.4 KBytes
[  8]  15.00-16.00  sec  30.0 MBytes   252 Mbits/sec  1281   90.5 KBytes
[ 10]  15.00-16.00  sec   110 MBytes   923 Mbits/sec  2711    139 KBytes
[SUM]  15.00-16.00  sec  1.20 GBytes  10.3 Gbits/sec  17972
</code></pre><p>&#x5BF9;Host B&#x4E0A;&#x7684;OVS-DPDK&#x505A;&#x5E26;&#x5BBD;&#x9650;&#x5236;, &#x4E3B;&#x8981;&#x9650;&#x5236;&#x5BF9;&#x63A5;&#x7269;&#x7406;&#x7F51;&#x5361;<code>enP5p1s0</code>&#x5BF9;&#x5E94;&#x7684;port <code>dpdkp1</code></p>
<ul>
<li>Egress
&#x5728;Host B&#x4E0A;:<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x9650;&#x5236;dpdkp1&#x7684;&#x51FA;&#x53E3;&#x901F;&#x7387;&#x4E3A;5G bps, cir&#x7684;&#x5355;&#x4F4D;&#x4E3A;Bps</span>
<span class="token function">sudo</span> ovs-vsctl <span class="token builtin class-name">set</span> port dpdkp1 <span class="token assign-left variable">qos</span><span class="token operator">=</span>@newqos -- <span class="token parameter variable">--id</span><span class="token operator">=</span>@newqos create qos <span class="token assign-left variable">type</span><span class="token operator">=</span>egress-policer other-config:cir<span class="token operator">=</span><span class="token number">625000000</span> other-config:cbs<span class="token operator">=</span><span class="token number">2048</span>
</code></pre>
</li>
<li>Ingress<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x9650;&#x5236;&#x5165;&#x53E3;&#x901F;&#x7387;5G bps, ingress_policing_rate&#x5355;&#x4F4D;&#x4E3A;k bps</span>
$ <span class="token function">sudo</span> ovs-vsctl <span class="token builtin class-name">set</span> interface dpdkp1 <span class="token assign-left variable">ingress_policing_rate</span><span class="token operator">=</span><span class="token number">5000000</span>
$ <span class="token function">sudo</span> ovs-vsctl <span class="token builtin class-name">set</span> interface dpdkp1 <span class="token assign-left variable">ingress_policing_burst</span><span class="token operator">=</span><span class="token number">500000</span>
</code></pre>
</li>
</ul>
<h4 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_10"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_10" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_10"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</h4>
<p>&#x914D;&#x7F6E;&#x5E26;&#x5BBD;&#x9650;&#x5236;&#x540E;, &#x518D;&#x6B21;&#x7528;iperf&#x6D4B;&#x8BD5;, &#x7ED3;&#x679C;&#x4E3A;<code>4.85 Gbits/sec</code></p>
<pre class="language-"><code class="lang-bash"><span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>   <span class="token number">5.00</span>-6.00   sec   <span class="token number">259</span> MBytes  <span class="token number">2.17</span> Gbits/sec  <span class="token number">8313</span>    <span class="token number">264</span> KBytes
<span class="token punctuation">[</span>  <span class="token number">6</span><span class="token punctuation">]</span>   <span class="token number">5.00</span>-6.00   sec  <span class="token number">53.8</span> MBytes   <span class="token number">451</span> Mbits/sec  <span class="token number">2579</span>   <span class="token number">11.3</span> KBytes
<span class="token punctuation">[</span>  <span class="token number">8</span><span class="token punctuation">]</span>   <span class="token number">5.00</span>-6.00   sec   <span class="token number">154</span> MBytes  <span class="token number">1.29</span> Gbits/sec  <span class="token number">2293</span>   <span class="token number">91.9</span> KBytes
<span class="token punctuation">[</span> <span class="token number">10</span><span class="token punctuation">]</span>   <span class="token number">5.00</span>-6.00   sec   <span class="token number">112</span> MBytes   <span class="token number">944</span> Mbits/sec  <span class="token number">1467</span>    <span class="token number">591</span> KBytes
<span class="token punctuation">[</span>SUM<span class="token punctuation">]</span>   <span class="token number">5.00</span>-6.00   sec   <span class="token number">579</span> MBytes  <span class="token number">4.85</span> Gbits/sec  <span class="token number">14652</span>
</code></pre>
<h4 id="&#x95EE;&#x9898;-netperf-over-ovs-dpdk&#x6027;&#x80FD;&#x5DEE;"><a name="&#x95EE;&#x9898;-netperf-over-ovs-dpdk&#x6027;&#x80FD;&#x5DEE;" class="anchor-navigation-ex-anchor" href="#&#x95EE;&#x9898;-netperf-over-ovs-dpdk&#x6027;&#x80FD;&#x5DEE;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x95EE;&#x9898;: netperf over OVS-DPDK&#x6027;&#x80FD;&#x5DEE;</h4>
<p>netperf&#x662F;&#x5355;&#x8FDB;&#x7A0B;&#x5E94;&#x7528;, traffic&#x901A;&#x8FC7;OVS-DPDK&#x540E;, &#x76F8;&#x6BD4;&#x4E24;&#x4E2A;&#x7269;&#x7406;&#x673A;&#x76F4;&#x8FDE;, &#x6027;&#x80FD;&#x4E0B;&#x964D;&#x5F88;&#x591A;;
&#x4E0B;&#x9762;&#x662F;&#x5404;&#x79CD;&#x573A;&#x666F;&#x4E0B;&#x7684;&#x6027;&#x80FD;&#x6570;&#x636E;:
&#x6D4B;&#x8BD5;&#x7C7B;&#x578B; | Throughput(min) GBytes  /s | Throughput(max) GBytes  /s
-- | -- | -- |
&#x4E24;&#x4E2A;&#x7269;&#x7406;&#x7F51;&#x5361;&#x76F4;&#x8FDE; | 1.27 | 3.23
&#x7269;&#x7406;&#x7F51;&#x5361;&#x5230;VM | 0.37 | 0.71
VM02&#x5230;VM01&#x8FC7;OVS-DPDK | 0.26 | 0.33
VM02&#x5230;VM01&#x8FC7;OVS-DPDK with flow | 0.25 | 0.26
VM02&#x5230;VM01&#x8FC7;linux bridge | 2.17 | 2.84</p>
<p>&#x521D;&#x6B65;&#x7ED3;&#x8BBA;: <strong>OVS-DPDK&#x662F;&#x74F6;&#x9888;</strong>, rxq&#x4E2A;&#x6570;&#x4E0D;&#x591F;? descriptor&#x4E2A;&#x6570;&#x4E0D;&#x591F;? critical path&#x4EE3;&#x7801;&#x95EE;&#x9898;?
--&#x914D;flow, &#x914D;mac&#x5B66;&#x4E60; --&#x8C8C;&#x4F3C;&#x4E0D;&#x884C;</p>
<blockquote>
<p>&#x6211;&#x4EE5;&#x524D;&#x4E5F;&#x5BF9;&#x6BD4;&#x6D4B;&#x8FC7;&#xFF0C;&#x5927;&#x6982;&#x662F;&#x8FD9;&#x539F;&#x56E0;&#xFF0C;&#x5982;&#x679C;&#x628A;bridge&#x7684;tso/csum&#x5173;&#x95ED;&#xFF0C;&#x6D4B;&#x51FA;&#x7684;&#x6570;&#x636E;&#x548C;ovs-dpdk&#x662F;&#x5DEE;&#x4E0D;&#x591A;&#x7684;&#x3002;</p>
<ol>
<li>for bridge mode, the VM&apos;s virtio nic was enabled tso/csum defaultly             </li>
<li>for OVS-dpdk, the VM&apos;s virtio nic cannot enable tso/csum, although DPDK vhost lib can support tso etc.
Already has a Patch for OVS2.6.1 to support TSO, but this patch is not intended for upstreaming.<br>see :<a href="https://mail.openvswitch.org/pipermail/ovs-dev/2016-June/316414.html" target="_blank">https://mail.openvswitch.org/pipermail/ovs-dev/2016-June/316414.html</a>        <pre class="language-"><code> https://lists.linux-foundation.org/pipermail/ovs-dev/2017-April/330703.html
</code></pre></li>
</ol>
</blockquote>
<p>OVS&#x6A21;&#x5F0F;&#x4E0B;VM&#x7684;offload&#x529F;&#x80FD;</p>
<pre class="language-"><code>[root@localhost ~]# ethtool -k eth1
Features for eth1:
rx-checksumming: on [fixed]
tx-checksumming: off
    tx-checksum-ipv4: off [fixed]
    tx-checksum-ip-generic: off [fixed]
    tx-checksum-ipv6: off [fixed]
    tx-checksum-fcoe-crc: off [fixed]
    tx-checksum-sctp: off [fixed]
scatter-gather: off
    tx-scatter-gather: off [fixed]
    tx-scatter-gather-fraglist: off [fixed]
tcp-segmentation-offload: off
    tx-tcp-segmentation: off [fixed]
    tx-tcp-ecn-segmentation: off [fixed]
    tx-tcp-mangleid-segmentation: off [fixed]
    tx-tcp6-segmentation: off [fixed]
udp-fragmentation-offload: off
generic-segmentation-offload: off [requested on]
generic-receive-offload: on
large-receive-offload: off [fixed]
rx-vlan-offload: off [fixed]
tx-vlan-offload: off [fixed]
ntuple-filters: off [fixed]
receive-hashing: off [fixed]
highdma: on [fixed]
rx-vlan-filter: on [fixed]
vlan-challenged: off [fixed]
tx-lockless: off [fixed]
netns-local: off [fixed]
tx-gso-robust: off [fixed]
tx-fcoe-segmentation: off [fixed]
tx-gre-segmentation: off [fixed]
tx-gre-csum-segmentation: off [fixed]
tx-ipxip4-segmentation: off [fixed]
tx-ipxip6-segmentation: off [fixed]
tx-udp_tnl-segmentation: off [fixed]
tx-udp_tnl-csum-segmentation: off [fixed]
tx-gso-partial: off [fixed]
tx-sctp-segmentation: off [fixed]
tx-esp-segmentation: off [fixed]
fcoe-mtu: off [fixed]
tx-nocache-copy: off
loopback: off [fixed]
rx-fcs: off [fixed]
rx-all: off [fixed]
tx-vlan-stag-hw-insert: off [fixed]
rx-vlan-stag-hw-parse: off [fixed]
rx-vlan-stag-filter: off [fixed]
l2-fwd-offload: off [fixed]
hw-tc-offload: off [fixed]
esp-hw-offload: off [fixed]
esp-tx-csum-hw-offload: off [fixed]
rx-udp_tunnel-port-offload: off [fixed]
</code></pre><p>Linux bridge&#x6A21;&#x5F0F;&#x4E0B;&#x7684;offload&#x529F;&#x80FD;:</p>
<pre class="language-"><code>[root@localhost ~]# ethtool -k eth0
Features for eth0:
rx-checksumming: on [fixed]
tx-checksumming: on
    tx-checksum-ipv4: off [fixed]
    tx-checksum-ip-generic: on
    tx-checksum-ipv6: off [fixed]
    tx-checksum-fcoe-crc: off [fixed]
    tx-checksum-sctp: off [fixed]
scatter-gather: on
    tx-scatter-gather: on
    tx-scatter-gather-fraglist: off [fixed]
tcp-segmentation-offload: on
    tx-tcp-segmentation: on
    tx-tcp-ecn-segmentation: on
    tx-tcp-mangleid-segmentation: off
    tx-tcp6-segmentation: on
udp-fragmentation-offload: off
generic-segmentation-offload: on
generic-receive-offload: on
large-receive-offload: off [fixed]
rx-vlan-offload: off [fixed]
tx-vlan-offload: off [fixed]
ntuple-filters: off [fixed]
receive-hashing: off [fixed]
highdma: on [fixed]
rx-vlan-filter: on [fixed]
vlan-challenged: off [fixed]
tx-lockless: off [fixed]
netns-local: off [fixed]
tx-gso-robust: on [fixed]
tx-fcoe-segmentation: off [fixed]
tx-gre-segmentation: off [fixed]
tx-gre-csum-segmentation: off [fixed]
tx-ipxip4-segmentation: off [fixed]
tx-ipxip6-segmentation: off [fixed]
tx-udp_tnl-segmentation: off [fixed]
tx-udp_tnl-csum-segmentation: off [fixed]
tx-gso-partial: off [fixed]
tx-sctp-segmentation: off [fixed]
tx-esp-segmentation: off [fixed]
fcoe-mtu: off [fixed]
tx-nocache-copy: off
loopback: off [fixed]
rx-fcs: off [fixed]
rx-all: off [fixed]
tx-vlan-stag-hw-insert: off [fixed]
rx-vlan-stag-hw-parse: off [fixed]
rx-vlan-stag-filter: off [fixed]
l2-fwd-offload: off [fixed]
hw-tc-offload: off [fixed]
esp-hw-offload: off [fixed]
esp-tx-csum-hw-offload: off [fixed]
rx-udp_tunnel-port-offload: off [fixed]
</code></pre><p>&#x6D4B;&#x8BD5;&#x7C7B;&#x578B;:</p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x4E24;&#x4E2A;&#x7269;&#x7406;&#x7F51;&#x5361;&#x76F4;&#x8FDE;</span>
HostA<span class="token punctuation">(</span>enP4p1s0<span class="token punctuation">)</span> <span class="token operator">&lt;</span>--<span class="token operator">&gt;</span> HostB<span class="token punctuation">(</span>enP4p1s0<span class="token punctuation">)</span>

<span class="token comment">#&#x7269;&#x7406;&#x7F51;&#x5361;&#x5230;VM</span>
HostA         HostB                                                   VM01
enP5p1s0 <span class="token operator">&lt;</span>--<span class="token operator">&gt;</span> enP5p1s0 <span class="token operator">&lt;</span>--<span class="token operator">&gt;</span> <span class="token punctuation">(</span>dpdk@2rxq<span class="token punctuation">)</span>OVS-DPDK<span class="token punctuation">(</span>vhost-user@2rxq<span class="token punctuation">)</span> <span class="token operator">&lt;</span>--<span class="token operator">&gt;</span> eth1<span class="token punctuation">(</span>virtio<span class="token punctuation">)</span>

<span class="token comment">#VM02&#x5230;VM01&#x8FC7;OVS-DPDK</span>
VM02<span class="token punctuation">(</span>eth1-virtio<span class="token punctuation">)</span> <span class="token operator">&lt;</span>--<span class="token operator">&gt;</span> <span class="token punctuation">(</span>vhost-user@2rxq<span class="token punctuation">)</span>OVS-DPDK<span class="token punctuation">(</span>vhost-user@2rxq<span class="token punctuation">)</span> <span class="token operator">&lt;</span>--<span class="token operator">&gt;</span> VM01<span class="token punctuation">(</span>eth1-virtio<span class="token punctuation">)</span>

<span class="token comment">#VM02&#x5230;VM01&#x8FC7;OVS-DPDK with flow</span>
VM02<span class="token punctuation">(</span>eth1-virtio<span class="token punctuation">)</span> <span class="token operator">&lt;</span>--<span class="token operator">&gt;</span> <span class="token punctuation">(</span>vhost-user@2rxq<span class="token punctuation">)</span>OVS-DPDK<span class="token punctuation">(</span>vhost-user@2rxq<span class="token punctuation">)</span> <span class="token operator">&lt;</span>--<span class="token operator">&gt;</span> VM01<span class="token punctuation">(</span>eth1-virtio<span class="token punctuation">)</span>

<span class="token comment">#VM02&#x5230;VM01&#x8FC7;linux bridge</span>
VM02<span class="token punctuation">(</span>eth1-virtio<span class="token punctuation">)</span> <span class="token operator">&lt;</span>--<span class="token operator">&gt;</span> <span class="token punctuation">(</span>tap<span class="token punctuation">)</span>linux bridge<span class="token punctuation">(</span>tap<span class="token punctuation">)</span> <span class="token operator">&lt;</span>--<span class="token operator">&gt;</span> VM01<span class="token punctuation">(</span>eth1-virtio<span class="token punctuation">)</span>
</code></pre>
<p>&#x6CE8;: netperf&#x5E26;&#x5BBD;&#x6CE2;&#x52A8;&#x5F88;&#x5927;, &#x8FD9;&#x91CC;&#x53D6;5&#x6B21;&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;&#x7684;&#x6700;&#x5927;&#x6700;&#x5C0F;&#x503C;</p>
<p>&#x53C2;&#x8003;&#x547D;&#x4EE4;:
&#x5728;server&#x4E0A;:</p>
<pre class="language-"><code class="lang-bash"><span class="token builtin class-name">cd</span> netperf-master/src
./netserver
</code></pre>
<p>&#x5728;client&#x4E0A;:</p>
<pre class="language-"><code class="lang-bash"><span class="token builtin class-name">cd</span> netperf-master/src
./netperf <span class="token parameter variable">-H</span> <span class="token number">5.5</span>.5.51 <span class="token parameter variable">-l</span> <span class="token number">30</span> <span class="token parameter variable">-cC</span> <span class="token parameter variable">-fG</span>
</code></pre>
<p>&#x5728;HostB&#x4E0A;&#x914D;flow</p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x4ECE;vhostuser0&#x5230;vhostuser1</span>
<span class="token function">sudo</span> ovs-vsctl <span class="token builtin class-name">set</span> interface dpdkp1 <span class="token assign-left variable">ofport_request</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token function">sudo</span> ovs-vsctl <span class="token builtin class-name">set</span> interface <span class="token string">&quot;dpdkvhostuser0&quot;</span> <span class="token assign-left variable">ofport_request</span><span class="token operator">=</span><span class="token number">2</span>
<span class="token function">sudo</span> ovs-vsctl <span class="token builtin class-name">set</span> interface <span class="token string">&quot;dpdkvhostuser1&quot;</span> <span class="token assign-left variable">ofport_request</span><span class="token operator">=</span><span class="token number">3</span>
<span class="token function">sudo</span> ovs-ofctl add-flow ovsbr0 <span class="token assign-left variable">in_port</span><span class="token operator">=</span><span class="token number">2</span>,action<span class="token operator">=</span>output:3
<span class="token function">sudo</span> ovs-ofctl add-flow ovsbr0 <span class="token assign-left variable">in_port</span><span class="token operator">=</span><span class="token number">3</span>,action<span class="token operator">=</span>output:2
<span class="token comment">#&#x67E5;&#x73B0;&#x6709;flow</span>
$ <span class="token function">sudo</span> ovs-ofctl dump-flows ovsbr0
 <span class="token assign-left variable">cookie</span><span class="token operator">=</span>0x0, <span class="token assign-left variable">duration</span><span class="token operator">=</span><span class="token number">525</span>.681s, <span class="token assign-left variable">table</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">n_packets</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">n_bytes</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">in_port</span><span class="token operator">=</span>dpdkvhostuser0 <span class="token assign-left variable">actions</span><span class="token operator">=</span>output:dpdkvhostuser1
 <span class="token assign-left variable">cookie</span><span class="token operator">=</span>0x0, <span class="token assign-left variable">duration</span><span class="token operator">=</span><span class="token number">517</span>.418s, <span class="token assign-left variable">table</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">n_packets</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">n_bytes</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">in_port</span><span class="token operator">=</span>dpdkvhostuser1 <span class="token assign-left variable">actions</span><span class="token operator">=</span>output:dpdkvhostuser0
 <span class="token assign-left variable">cookie</span><span class="token operator">=</span>0x0, <span class="token assign-left variable">duration</span><span class="token operator">=</span><span class="token number">64912</span>.051s, <span class="token assign-left variable">table</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">n_packets</span><span class="token operator">=</span><span class="token number">262755553</span>, <span class="token assign-left variable">n_bytes</span><span class="token operator">=</span><span class="token number">364138797710</span>, <span class="token assign-left variable">priority</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">actions</span><span class="token operator">=</span>NORMAL
<span class="token comment">#&#x6E05;&#x9664;&#x6240;&#x6709;flow</span>
<span class="token function">sudo</span> ovs-ofctl del-flows ovsbr0
<span class="token comment">#&#x6E05;&#x9664;flow&#x540E;&#x52A0;&#x56DE;&#x9ED8;&#x8BA4;flow, &#x5426;&#x5219;&#x7AEF;&#x53E3;&#x90FD;&#x4E0D;&#x901A;</span>
<span class="token function">sudo</span> ovs-ofctl add-flow ovsbr0 <span class="token assign-left variable">actions</span><span class="token operator">=</span>NORMAL
</code></pre>
<h3 id="5482----sr-iov-&#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;"><a name="5482----sr-iov-&#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;" class="anchor-navigation-ex-anchor" href="#5482----sr-iov-&#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;"><i class="fa fa-link" aria-hidden="true"></i></a>2.9.2. 5.4.8.2    SR-IOV &#x652F;&#x6301;&#x5E26;&#x5BBD;&#x5206;&#x914D;&#x6BD4;&#x4F8B;&#x8BBE;&#x5B9A;</h3>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003133934.png" alt=""><br>&#x5C06;&#x7528;&#x4F8B;&#x63CF;&#x8FF0;&#x7684;&#x6D4B;&#x8BD5;&#x573A;&#x666F;&#x5206;&#x89E3;: &#x7528;&#x9650;&#x5236;SRIOV&#x7F51;&#x5361;&#x7684;VF <code>max_tx_rate</code>&#x6765;&#x6D4B;&#x8BD5;
&#x4F46;&#x53EA;&#x80FD;&#x914D;&#x7F6E;tx_rate, &#x5BF9;rx&#x5E76;&#x6CA1;&#x6709;&#x9650;&#x5236;
&#x53C2;&#x8003;: <a href="https://community.mellanox.com/docs/DOC-2565" target="_blank">https://community.mellanox.com/docs/DOC-2565</a></p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x5728;Host B&#x4E0A;&#x7684;&#x4E24;&#x4E2A;Mellanox Connect-4&#x7269;&#x7406;&#x7F51;&#x5361;&#x4E0A;, &#x6253;&#x5F00;SR-IOV, VF&#x6570;&#x76EE;&#x5206;&#x522B;&#x662F;2</span>
<span class="token function">sudo</span> <span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;echo 2 &gt; /sys/class/net/enP4p1s0/device/sriov_numvfs&quot;</span>
<span class="token function">sudo</span> <span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;echo 2 &gt; /sys/class/net/enP5p1s0/device/sriov_numvfs&quot;</span>
<span class="token comment">#&#x7269;&#x7406;&#x7F51;&#x5361;&#x5B9E;&#x9645;link&#x901F;&#x7387;&#x4E3A;56000Mb/s</span>
<span class="token comment">#&#x4F7F;vf 0&#x4E3A;30G, vf 1&#x4E3A;40G</span>
<span class="token comment">#&#x5BF9;&#x5E94;&#x7528;&#x4F8B;&#x8981;&#x6C42;&#x7684;port1, &#x5BF9;&#x5E94;VM01</span>
<span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev enP4p1s0 vf <span class="token number">0</span> max_tx_rate <span class="token number">30000</span> min_tx_rate <span class="token number">25000</span>
<span class="token comment">#&#x5BF9;&#x5E94;&#x7528;&#x4F8B;&#x8981;&#x6C42;&#x7684;port3, &#x5BF9;&#x5E94;VM02</span>
<span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev enP4p1s0 vf <span class="token number">1</span> max_tx_rate <span class="token number">40000</span> min_tx_rate <span class="token number">35000</span>
<span class="token comment">#&#x5BF9;&#x5E94;&#x7528;&#x4F8B;&#x8981;&#x6C42;&#x7684;port2, &#x5BF9;&#x5E94;VM01</span>
<span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev enP5p1s0 vf <span class="token number">0</span> max_tx_rate <span class="token number">30000</span> min_tx_rate <span class="token number">25000</span>
<span class="token comment">#&#x5BF9;&#x5E94;&#x7528;&#x4F8B;&#x8981;&#x6C42;&#x7684;port4, &#x5BF9;&#x5E94;VM02</span>
<span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev enP5p1s0 vf <span class="token number">1</span> max_tx_rate <span class="token number">40000</span> min_tx_rate <span class="token number">35000</span>
<span class="token comment">#&#x914D;&#x7F6E;&#x597D;&#x4EE5;&#x540E;&#x7684;&#x72B6;&#x6001;: </span>
$ <span class="token function">ip</span> <span class="token function">link</span> show dev enP4p1s0<span class="token punctuation">;</span> <span class="token function">ip</span> <span class="token function">link</span> show dev enP5p1s0
<span class="token number">9</span>: enP4p1s0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq state UP mode DEFAULT group default qlen <span class="token number">1000</span>
    link/ether ec:0d:9a:89:4c:36 brd ff:ff:ff:ff:ff:ff
    vf <span class="token number">0</span> MAC 00:00:00:00:00:00, tx rate <span class="token number">30000</span> <span class="token punctuation">(</span>Mbps<span class="token punctuation">)</span>, max_tx_rate 30000Mbps, min_tx_rate 25000Mbps, spoof checking off, link-state auto, trust off, query_rss off
    vf <span class="token number">1</span> MAC 00:00:00:00:00:00, tx rate <span class="token number">40000</span> <span class="token punctuation">(</span>Mbps<span class="token punctuation">)</span>, max_tx_rate 40000Mbps, min_tx_rate 35000Mbps, spoof checking off, link-state auto, trust off, query_rss off
<span class="token number">10</span>: enP5p1s0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq state UP mode DEFAULT group default qlen <span class="token number">1000</span>
    link/ether ec:0d:9a:89:4a:e6 brd ff:ff:ff:ff:ff:ff
    vf <span class="token number">0</span> MAC 00:00:00:00:00:00, tx rate <span class="token number">30000</span> <span class="token punctuation">(</span>Mbps<span class="token punctuation">)</span>, max_tx_rate 30000Mbps, min_tx_rate 25000Mbps, spoof checking off, link-state auto, trust off, query_rss off
    vf <span class="token number">1</span> MAC 00:00:00:00:00:00, tx rate <span class="token number">40000</span> <span class="token punctuation">(</span>Mbps<span class="token punctuation">)</span>, max_tx_rate 40000Mbps, min_tx_rate 35000Mbps, spoof checking off, link-state auto, trust off, query_rss off
</code></pre>
<table>
<thead>
<tr>
<th>VM</th>
<th>interface</th>
<th>VF@&#x8BBE;&#x5B9A;tx_rate</th>
<th>PF@&#x5B9E;&#x9645;rate</th>
</tr>
</thead>
<tbody>
<tr>
<td>VM01</td>
<td>enp4s0</td>
<td>0@tx30G</td>
<td>enP5p1s0@56G</td>
</tr>
<tr>
<td>VM01</td>
<td>enp5s0</td>
<td>0@tx30G</td>
<td>enP4p1s0@56G</td>
</tr>
<tr>
<td>VM02</td>
<td>enp4s0</td>
<td>1@tx40G</td>
<td>enP5p1s0@56G</td>
</tr>
<tr>
<td>VM02</td>
<td>enp5s0</td>
<td>1@tx40G</td>
<td>enP4p1s0@56G</td>
</tr>
</tbody>
</table>
<p>&#x914D;&#x7F6E;VM&#x5982;&#x4E0B;: &#x5206;&#x522B;&#x6DFB;&#x52A0;Host PCI&#x8BBE;&#x5907;&#x5230;VM<br><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003134002.png" alt="">  </p>
<h4 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----passto-be-clarified"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----passto-be-clarified" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----passto-be-clarified"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS(to be clarified)</h4>
<ul>
<li>&#x4E24;&#x4E2A;VM&#x6210;&#x529F;&#x542F;&#x52A8;</li>
<li>&#x6700;&#x5927;&#x5E26;&#x5BBD;&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;
&#x5728;mtu&#x4E3A;&#x9ED8;&#x8BA4;1500&#x65F6;, &#x6587;&#x4E2D;4&#x6838;VM&#x5E76;&#x4E0D;&#x80FD;&#x8FBE;&#x5230;40G&#x7EBF;&#x901F;; &#x6545;&#x8FD9;&#x91CC;&#x5728;&#x4E24;&#x4E2A;VM&#x4E0A;&#x5206;&#x522B;&#x4FEE;&#x6539;&#x63A5;&#x53E3;&#x7684;mtu&#x4E3A;9000
&#x5728;&#x4E24;&#x4E2A;VM&#x4E0A;:<pre class="language-"><code class="lang-bash"><span class="token comment">#MTU&#x589E;&#x5927;&#x5230;9000</span>
<span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev enp4s0 mtu <span class="token number">9000</span>
<span class="token comment">#server&#x7AEF;</span>
iperf <span class="token parameter variable">-s</span>
<span class="token comment">#client&#x7AEF;, &#x7528;4&#x4E2A;&#x7EBF;&#x7A0B;&#x6253;&#x6EE1;&#x5E26;&#x5BBD;</span>
iperf <span class="token parameter variable">-c</span> <span class="token number">2.2</span>.2.1 <span class="token parameter variable">-i</span> <span class="token number">1</span> <span class="token parameter variable">-t</span> <span class="token number">360</span> <span class="token parameter variable">-l</span> 128K <span class="token parameter variable">-P</span> <span class="token number">4</span>
</code></pre>
Server | Client | &#x7406;&#x8BBA;&#x5E26;&#x5BBD;(VF tx_rate) | &#x5B9E;&#x9645;&#x5E26;&#x5BBD; | &#x6240;&#x5C5E;PF
--- | --- | --- | --- | --- |
VM01 | VM02 | 40 G | 39.4 G | enp5s0
VM02 | VM01 | 30 G | 29.7 G | enp5s0</li>
</ul>
<h4 id="&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x8C03;&#x6574;&#x5E26;&#x5BBD;&#x6BD4;&#x4F8B;&#x5230;150&#x6216;50"><a name="&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x8C03;&#x6574;&#x5E26;&#x5BBD;&#x6BD4;&#x4F8B;&#x5230;150&#x6216;50" class="anchor-navigation-ex-anchor" href="#&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x8C03;&#x6574;&#x5E26;&#x5BBD;&#x6BD4;&#x4F8B;&#x5230;150&#x6216;50"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x8C03;&#x6574;&#x5E26;&#x5BBD;&#x6BD4;&#x4F8B;&#x5230;150%&#x6216;50%?</h4>
<h2 id="549----&#x652F;&#x6301;&#x7EC4;&#x64AD;"><a name="549----&#x652F;&#x6301;&#x7EC4;&#x64AD;" class="anchor-navigation-ex-anchor" href="#549----&#x652F;&#x6301;&#x7EC4;&#x64AD;"><i class="fa fa-link" aria-hidden="true"></i></a>2.10. 5.4.9    &#x652F;&#x6301;&#x7EC4;&#x64AD;</h2>
<h3 id="5491----ovs&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;"><a name="5491----ovs&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;" class="anchor-navigation-ex-anchor" href="#5491----ovs&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;"><i class="fa fa-link" aria-hidden="true"></i></a>2.10.1. 5.4.9.1    OVS&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;</h3>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003134024.png" alt=""><br>&#x53C2;&#x8003;&#x4E0B;&#x56FE;&#x914D;&#x7F6E;:<br><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003134041.png" alt=""><br>&#x5728;&#x4E24;&#x4E2A;VM&#x4E0A;</p>
<pre class="language-"><code class="lang-bash"><span class="token comment"># &#x67E5;&#x770B;&#x591A;&#x64AD;&#x5730;&#x5740;</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ip maddr show dev eth1</span>
<span class="token number">4</span>:    eth1
    <span class="token function">link</span>  01:00:5e:00:00:01
    <span class="token function">link</span>  <span class="token number">33</span>:33:00:00:00:01
    <span class="token function">link</span>  <span class="token number">33</span>:33:ff:c0:69:37
    inet  <span class="token number">224.0</span>.0.1
    inet6 ff02::1:ffc0:6937
    inet6 ff02::1
    inet6 ff01::1

<span class="token comment"># VF&#x6709;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x80FD;&#x591F;&#x6536;&#x5230;&#x672A;&#x77E5;&#x591A;&#x64AD;, promiscuous&#x548C;allmulticast, &#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x540E;&#x8005;</span>
<span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev eth1 allmulticast on
</code></pre>
<p>&#x5728;Host A&#x4E0A;, &#x8FD0;&#x884C;pktgen, &#x6784;&#x9020;ip&#x548C;mac</p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x542F;&#x52A8;pktgen, rx&#x7528;core42,tx&#x7528;core43, core41&#x4E3A;&#x663E;&#x793A;&#x548C;timer</span>
<span class="token function">sudo</span> app/arm64-armv8a-linuxapp-gcc/pktgen <span class="token parameter variable">-l</span> <span class="token number">41</span>-45 <span class="token parameter variable">-w</span> 0005:01:00.0 -- <span class="token parameter variable">-T</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">-m</span> <span class="token string">&quot;[42:43].0&quot;</span>
<span class="token comment">#&#x914D;&#x76EE;&#x7684;IP(&#x7EC4;&#x64AD;IP)</span>
Pktgen:/<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> <span class="token number">0</span> dst <span class="token function">ip</span> <span class="token number">224.0</span>.0.1
<span class="token comment">#&#x6539;&#x53D8;&#x76EE;&#x7684;&#x7EC4;&#x64AD;IP</span>
Pktgen:/<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> <span class="token number">0</span> dst <span class="token function">ip</span> <span class="token number">225.0</span>.0.1
<span class="token comment">#&#x914D;&#x76EE;&#x7684;mac(&#x7EC4;&#x64AD;MAC)</span>
Pktgen:/<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> <span class="token number">0</span> dst mac 01:00:5e:00:00:01
<span class="token comment">#&#x914D;&#x76EE;&#x7684;&#x7EC4;&#x64AD;mac</span>
Pktgen:/<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> <span class="token number">0</span> dst mac 01:00:5e:00:00:02
<span class="token comment">#&#x8BBE;&#x7F6E;&#x53D1;&#x5305;&#x901F;&#x7387;&#x4E3A;1%, &#x592A;&#x5927;&#x4F1A;&#x4E22;&#x5305;</span>
Pktgen:/<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> <span class="token number">0</span> rate <span class="token number">1</span>
<span class="token comment">#&#x5F00;&#x59CB;&#x53D1;&#x9001;</span>
Pktgen:/<span class="token operator">&gt;</span> start all
<span class="token comment">#&#x505C;&#x6B62;&#x53D1;&#x9001;</span>
Pktgen:/<span class="token operator">&gt;</span> stop all
</code></pre>
<p>&#x53D1;&#x9001;&#x4E2D;&#x5728;VM01&#x548C;VM02&#x4E0A;&#x6293;&#x5305;</p>
<pre class="language-"><code class="lang-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># tcpdump -i eth1 -vvnnXX</span>
<span class="token number">12</span>:45:39.316576 IP <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">4</span>, <span class="token function">id</span> <span class="token number">52062</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>none<span class="token punctuation">]</span>, proto TCP <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>, length <span class="token number">46</span><span class="token punctuation">)</span>
    <span class="token number">192.168</span>.0.1.1234 <span class="token operator">&gt;</span> <span class="token number">224.0</span>.0.1.5678: Flags <span class="token punctuation">[</span>.<span class="token punctuation">]</span>, <span class="token function">cksum</span> 0xe18e <span class="token punctuation">(</span>correct<span class="token punctuation">)</span>, <span class="token function">seq</span> <span class="token number">0</span>:6, ack <span class="token number">1</span>, win <span class="token number">8192</span>, length <span class="token number">6</span>
    0x0000:  0100 5e00 0001 248a 07b5 <span class="token number">7070</span> 0800 <span class="token number">4500</span>  <span class="token punctuation">..</span>^<span class="token punctuation">..</span>.$<span class="token punctuation">..</span>.pp<span class="token punctuation">..</span>E.
    0x0010:  002e cb5e 0000 0406 4ac1 c0a8 0001 e000  <span class="token punctuation">..</span>.^<span class="token punctuation">..</span><span class="token punctuation">..</span>J<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.
    0x0020:  0001 04d2 162e <span class="token number">1234</span> <span class="token number">5678</span> <span class="token number">1234</span> <span class="token number">5690</span> <span class="token number">5010</span>  <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.4Vx.4V.P.
    0x0030:  <span class="token number">2000</span> e18e 0000 <span class="token number">7778</span> 797a <span class="token number">3031</span>            <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>wxyz01
<span class="token number">12</span>:45:39.331109 IP <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">4</span>, <span class="token function">id</span> <span class="token number">49983</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>none<span class="token punctuation">]</span>, proto TCP <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>, length <span class="token number">46</span><span class="token punctuation">)</span>
    <span class="token number">192.168</span>.0.1.1234 <span class="token operator">&gt;</span> <span class="token number">224.0</span>.0.1.5678: Flags <span class="token punctuation">[</span>.<span class="token punctuation">]</span>, <span class="token function">cksum</span> 0xe18e <span class="token punctuation">(</span>correct<span class="token punctuation">)</span>, <span class="token function">seq</span> <span class="token number">0</span>:6, ack <span class="token number">1</span>, win <span class="token number">8192</span>, length <span class="token number">6</span>
    0x0000:  0100 5e00 0001 248a 07b5 <span class="token number">7070</span> 0800 <span class="token number">4500</span>  <span class="token punctuation">..</span>^<span class="token punctuation">..</span>.$<span class="token punctuation">..</span>.pp<span class="token punctuation">..</span>E.
    0x0010:  002e c33f 0000 0406 52e0 c0a8 0001 e000  <span class="token punctuation">..</span>.?<span class="token punctuation">..</span><span class="token punctuation">..</span>R<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.
    0x0020:  0001 04d2 162e <span class="token number">1234</span> <span class="token number">5678</span> <span class="token number">1234</span> <span class="token number">5690</span> <span class="token number">5010</span>  <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.4Vx.4V.P.
    0x0030:  <span class="token number">2000</span> e18e 0000 <span class="token number">7778</span> 797a <span class="token number">3031</span>            <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>wxyz01
</code></pre>
<h4 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_11"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_11" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_11"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</h4>
<table>
<thead>
<tr>
<th>&#x591A;&#x64AD;dst IP / MAC</th>
<th>VM01 &#x662F;&#x5426;&#x6536;&#x5230;</th>
<th>VM02 &#x662F;&#x5426;&#x6536;&#x5230;</th>
</tr>
</thead>
<tbody>
<tr>
<td>224.0.0.1 / 01:00:5e:00:00:01</td>
<td>&#x662F;</td>
<td>&#x662F;</td>
</tr>
<tr>
<td>225.0.0.2 / 01:00:5e:00:00:02</td>
<td>&#x662F;</td>
<td>&#x662F;</td>
</tr>
</tbody>
</table>
<h3 id="5492----sr-iov&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;"><a name="5492----sr-iov&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;" class="anchor-navigation-ex-anchor" href="#5492----sr-iov&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;"><i class="fa fa-link" aria-hidden="true"></i></a>2.10.2. 5.4.9.2    SR-IOV&#x652F;&#x6301;&#x6B63;&#x786E;&#x8F6C;&#x53D1;&#x7EC4;&#x64AD;&#x5305;</h3>
<p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003134106.png" alt=""><br>&#x914D;&#x7F6E;&#x8FDE;&#x4E2A;SR-IOV&#x6A21;&#x5F0F;&#x7684;VM01&#x548C;VM02.</p>
<p>&#x4E24;&#x4E2A;VM&#x90FD;&#x9ED8;&#x8BA4;&#x6709;&#x591A;&#x64AD;IP<code>224.0.0.1</code>&#x548C;MAC<code>01:00:5e:00:00:01</code></p>
<pre class="language-"><code>[root@localhost ~]# ip maddr show dev enp4s0
4:    enp4s0
    link  01:00:5e:00:00:01
    link  33:33:00:00:00:01
    inet  224.0.0.1
    inet6 ff02::1
    inet6 ff01::1
</code></pre><p><img src="img/networking_&#x7F51;&#x7EDC;&#x865A;&#x62DF;&#x5316;&#x7528;&#x4F8B;&#x8BB0;&#x5F55;_20221003134126.png" alt="">  </p>
<p>&#x53C2;&#x8003;: <a href="https://community.mellanox.com/docs/DOC-2473" target="_blank">https://community.mellanox.com/docs/DOC-2473</a>
&#x4E3A;&#x4E86;&#x80FD;&#x4F7F;VM&#x6536;&#x5230;&#x672A;&#x77E5;&#x7EC4;&#x64AD;, &#x5728;Host B&#x4E0A;:</p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x4F7F;&#x80FD;vf&#x7684;trust</span>
<span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> enP5p1s0 vf <span class="token number">0</span> trust on
<span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> enP5p1s0 vf <span class="token number">1</span> trust on
</code></pre>
<p>&#x5728;&#x4E24;&#x4E2A;VM&#x4E0A;:</p>
<pre class="language-"><code>#VF&#x6709;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x80FD;&#x591F;&#x6536;&#x5230;&#x672A;&#x77E5;&#x591A;&#x64AD;, promiscuous&#x548C;allmulticast, &#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x540E;&#x8005;
ip link set dev enp4s0 allmulticast on
</code></pre><p>&#x5728;Host A&#x4E0A;, &#x8FD0;&#x884C;pktgen, &#x6784;&#x9020;ip&#x548C;mac</p>
<pre class="language-"><code class="lang-bash"><span class="token comment">#&#x542F;&#x52A8;pktgen, rx&#x7528;core42,tx&#x7528;core43, core41&#x4E3A;&#x663E;&#x793A;&#x548C;timer</span>
<span class="token function">sudo</span> app/arm64-armv8a-linuxapp-gcc/pktgen <span class="token parameter variable">-l</span> <span class="token number">41</span>-45 <span class="token parameter variable">-w</span> 0005:01:00.0 -- <span class="token parameter variable">-T</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">-m</span> <span class="token string">&quot;[42:43].0&quot;</span>
<span class="token comment">#&#x914D;&#x76EE;&#x7684;IP(&#x7EC4;&#x64AD;IP)</span>
Pktgen:/<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> <span class="token number">0</span> dst <span class="token function">ip</span> <span class="token number">224.0</span>.0.1
<span class="token comment">#&#x914D;&#x76EE;&#x7684;mac(&#x7EC4;&#x64AD;MAC)</span>
Pktgen:/<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> <span class="token number">0</span> dst mac 01:00:5e:00:00:01
<span class="token comment">#&#x8BBE;&#x7F6E;&#x53D1;&#x5305;&#x901F;&#x7387;&#x4E3A;1%, &#x592A;&#x5927;&#x4F1A;&#x4E22;&#x5305;</span>
Pktgen:/<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> <span class="token number">0</span> rate <span class="token number">1</span>
<span class="token comment">#&#x5F00;&#x59CB;&#x53D1;&#x9001;</span>
Pktgen:/<span class="token operator">&gt;</span> start all
<span class="token comment">#&#x505C;&#x6B62;&#x53D1;&#x9001;</span>
Pktgen:/<span class="token operator">&gt;</span> stop all
</code></pre>
<p>&#x53D1;&#x9001;&#x7ED3;&#x675F;&#x540E;&#x5728;Host B&#x548C;VM01 VM02&#x4E0A;&#x5206;&#x522B;&#x7EDF;&#x8BA1;&#x591A;&#x64AD;&#x62A5;&#x6587;&#x4E2A;&#x6570;:</p>
<pre class="language-"><code class="lang-bash">$ <span class="token function">sudo</span> <span class="token function">ethtool</span> <span class="token parameter variable">-S</span> enP5p1s0 <span class="token operator">|</span> <span class="token function">grep</span> multicast_packets
     rx_vport_multicast_packets: <span class="token number">8981036150</span>
     tx_vport_multicast_packets: <span class="token number">112483059</span>
     rx_vport_rdma_multicast_packets: <span class="token number">0</span>
     tx_vport_rdma_multicast_packets: <span class="token number">0</span>
</code></pre>
<h4 id="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_12"><a name="&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_12" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;----pass_12"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C; -- PASS</h4>
<table>
<thead>
<tr>
<th>&#x591A;&#x64AD;dst IP / MAC</th>
<th>Host B &#x662F;&#x5426;&#x6536;&#x5230;</th>
<th>VM01 &#x662F;&#x5426;&#x6536;&#x5230;</th>
<th>VM02 &#x662F;&#x5426;&#x6536;&#x5230;</th>
</tr>
</thead>
<tbody>
<tr>
<td>224.0.0.1 / 01:00:5e:00:00:01</td>
<td>&#x662F;</td>
<td>&#x662F;</td>
<td>&#x662F;</td>
</tr>
<tr>
<td>225.0.0.2 / 01:00:5e:00:00:02</td>
<td>&#x662F;</td>
<td>&#x662F;</td>
<td>&#x662F;</td>
</tr>
</tbody>
</table>
<h1 id="73----&#x865A;&#x62DF;&#x5C42;&#x6027;&#x80FD;"><a name="73----&#x865A;&#x62DF;&#x5C42;&#x6027;&#x80FD;" class="anchor-navigation-ex-anchor" href="#73----&#x865A;&#x62DF;&#x5C42;&#x6027;&#x80FD;"><i class="fa fa-link" aria-hidden="true"></i></a>3. 7.3    &#x865A;&#x62DF;&#x5C42;&#x6027;&#x80FD;</h1>
<h2 id="735----&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;"><a name="735----&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;" class="anchor-navigation-ex-anchor" href="#735----&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. 7.3.5    &#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;</h2>
<h3 id="7351----&#x57FA;&#x4E8E;10ge&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;"><a name="7351----&#x57FA;&#x4E8E;10ge&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;" class="anchor-navigation-ex-anchor" href="#7351----&#x57FA;&#x4E8E;10ge&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.1. 7.3.5.1    &#x57FA;&#x4E8E;10GE&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x6027;&#x80FD;</h3>
<h2 id="736----&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;"><a name="736----&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;" class="anchor-navigation-ex-anchor" href="#736----&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. 7.3.6    &#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;</h2>
<h3 id="7361----&#x57FA;&#x4E8E;10ge&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;"><a name="7361----&#x57FA;&#x4E8E;10ge&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;" class="anchor-navigation-ex-anchor" href="#7361----&#x57FA;&#x4E8E;10ge&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.1. 7.3.6.1    &#x57FA;&#x4E8E;10GE&#x7F51;&#x5361;&#x7684;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x8D28;&#x91CF;</h3>
<h1 id="troubleshooting"><a name="troubleshooting" class="anchor-navigation-ex-anchor" href="#troubleshooting"><i class="fa fa-link" aria-hidden="true"></i></a>4. Troubleshooting</h1>
<h2 id="ovs&#x5F02;&#x5E38;&#x91CD;&#x542F;&#x5BFC;&#x81F4;vhostuser&#x4E0D;&#x901A;"><a name="ovs&#x5F02;&#x5E38;&#x91CD;&#x542F;&#x5BFC;&#x81F4;vhostuser&#x4E0D;&#x901A;" class="anchor-navigation-ex-anchor" href="#ovs&#x5F02;&#x5E38;&#x91CD;&#x542F;&#x5BFC;&#x81F4;vhostuser&#x4E0D;&#x901A;"><i class="fa fa-link" aria-hidden="true"></i></a>4.1. OVS&#x5F02;&#x5E38;&#x91CD;&#x542F;&#x5BFC;&#x81F4;vhostuser&#x4E0D;&#x901A;</h2>
<p>vhostuser&#x662F;c-s&#x6A21;&#x5F0F;, ovs&#x662F;server, qemu&#x662F;client. &#x5F53;OVS&#x7531;&#x4E8E;&#x67D0;&#x79CD;&#x5F02;&#x5E38;&#x81EA;&#x52A8;&#x91CD;&#x542F;&#x65F6;, &#x4F1A;&#x56E0;&#x4E3A;&#x65E0;&#x6CD5;&#x6253;&#x5F00;vhost&#x7AEF;&#x53E3;&#x7684;socket&#x5BFC;&#x81F4;vhost&#x4E0D;&#x901A;. &#x6B64;&#x65F6;&#x8981;&#x5148;&#x5173;&#x95ED;VM, &#x518D;&#x91CD;&#x542F;OVS.</p>
<h1 id="&#x5F85;&#x89E3;&#x51B3;&#x95EE;&#x9898;"><a name="&#x5F85;&#x89E3;&#x51B3;&#x95EE;&#x9898;" class="anchor-navigation-ex-anchor" href="#&#x5F85;&#x89E3;&#x51B3;&#x95EE;&#x9898;"><i class="fa fa-link" aria-hidden="true"></i></a>5. &#x5F85;&#x89E3;&#x51B3;&#x95EE;&#x9898;</h1>
<h2 id="netperf-over-ovs-dpdk&#x6027;&#x80FD;&#x5DEE;"><a name="netperf-over-ovs-dpdk&#x6027;&#x80FD;&#x5DEE;" class="anchor-navigation-ex-anchor" href="#netperf-over-ovs-dpdk&#x6027;&#x80FD;&#x5DEE;"><i class="fa fa-link" aria-hidden="true"></i></a>5.1. netperf over OVS-DPDK&#x6027;&#x80FD;&#x5DEE;</h2>
<p>&#x89C1;&#x4E0A;&#x9762;5.4.8.1</p>
<h2 id="vm&#x540C;&#x65F6;&#x6DFB;&#x52A0;sriov&#x548C;vhost-user&#x5BFC;&#x81F4;ovs&#x5D29;&#x6E83;&#x91CD;&#x542F;"><a name="vm&#x540C;&#x65F6;&#x6DFB;&#x52A0;sriov&#x548C;vhost-user&#x5BFC;&#x81F4;ovs&#x5D29;&#x6E83;&#x91CD;&#x542F;" class="anchor-navigation-ex-anchor" href="#vm&#x540C;&#x65F6;&#x6DFB;&#x52A0;sriov&#x548C;vhost-user&#x5BFC;&#x81F4;ovs&#x5D29;&#x6E83;&#x91CD;&#x542F;"><i class="fa fa-link" aria-hidden="true"></i></a>5.2. VM&#x540C;&#x65F6;&#x6DFB;&#x52A0;sriov&#x548C;vhost-user&#x5BFC;&#x81F4;OVS&#x5D29;&#x6E83;&#x91CD;&#x542F;</h2>
<p>&#x73B0;&#x8C61;&#x662F;&#x5355;&#x72EC;&#x6DFB;&#x52A0;sriov&#x6216;vhost-user&#x6B63;&#x5E38;, &#x540C;&#x65F6;&#x6DFB;&#x52A0;&#x5219;ovs-vswitchd&#x4F1A;&#x9A6C;&#x4E0A;&#x5D29;&#x6E83;&#x91CD;&#x542F;
error log</p>
<pre class="language-"><code class="lang-sh"><span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00074<span class="token operator">|</span>dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>VHOST_CONFIG: <span class="token builtin class-name">read</span> message VHOST_USER_SET_VRING_KICK
<span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00075<span class="token operator">|</span>dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>VHOST_CONFIG: vring kick idx:3 file:110
<span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00076<span class="token operator">|</span>dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>VHOST_CONFIG: virtio is now ready <span class="token keyword">for</span> processing.
<span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00077<span class="token operator">|</span>netdev_dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>vHost Device <span class="token string">&apos;/usr/local/var/run/openvswitch/dpdkvhostuser0&apos;</span> has been added on numa <span class="token function">node</span> <span class="token number">0</span>
<span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00078<span class="token operator">|</span>dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>VHOST_CONFIG: <span class="token builtin class-name">read</span> message VHOST_USER_SET_VRING_CALL
<span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00079<span class="token operator">|</span>dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>VHOST_CONFIG: vring call idx:3 file:118
<span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00080<span class="token operator">|</span>dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>VHOST_CONFIG: <span class="token builtin class-name">read</span> message VHOST_USER_SET_VRING_ENABLE
<span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00081<span class="token operator">|</span>dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>VHOST_CONFIG: <span class="token builtin class-name">set</span> queue enable: <span class="token number">1</span> to qp idx: <span class="token number">0</span>
<span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00082<span class="token operator">|</span>netdev_dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>State of queue <span class="token number">0</span> <span class="token punctuation">(</span> tx_qid <span class="token number">0</span> <span class="token punctuation">)</span> of vhost device <span class="token string">&apos;/usr/local/var/run/openvswitch/dpdkvhostuser0&apos;</span>changed to <span class="token string">&apos;enabled&apos;</span>
<span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00083<span class="token operator">|</span>dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>VHOST_CONFIG: <span class="token builtin class-name">read</span> message VHOST_USER_SET_VRING_ENABLE
<span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00084<span class="token operator">|</span>dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>VHOST_CONFIG: <span class="token builtin class-name">set</span> queue enable: <span class="token number">1</span> to qp idx: <span class="token number">1</span>
<span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00085<span class="token operator">|</span>dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>VHOST_CONFIG: <span class="token builtin class-name">read</span> message VHOST_USER_SET_VRING_ENABLE
<span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00086<span class="token operator">|</span>dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>VHOST_CONFIG: <span class="token builtin class-name">set</span> queue enable: <span class="token number">1</span> to qp idx: <span class="token number">2</span>
<span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00087<span class="token operator">|</span>netdev_dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>State of queue <span class="token number">2</span> <span class="token punctuation">(</span> tx_qid <span class="token number">1</span> <span class="token punctuation">)</span> of vhost device <span class="token string">&apos;/usr/local/var/run/openvswitch/dpdkvhostuser0&apos;</span>changed to <span class="token string">&apos;enabled&apos;</span>
<span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00088<span class="token operator">|</span>dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>VHOST_CONFIG: <span class="token builtin class-name">read</span> message VHOST_USER_SET_VRING_ENABLE
<span class="token number">2018</span>-09-07T05:20:01.091Z<span class="token operator">|</span>00089<span class="token operator">|</span>dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>VHOST_CONFIG: <span class="token builtin class-name">set</span> queue enable: <span class="token number">1</span> to qp idx: <span class="token number">3</span>
<span class="token number">2018</span>-09-07T05:20:03.356Z<span class="token operator">|</span>00090<span class="token operator">|</span>dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>VHOST_CONFIG: <span class="token builtin class-name">read</span> message VHOST_USER_SET_MEM_TABLE
<span class="token number">2018</span>-09-07T05:20:03.359Z<span class="token operator">|</span>00091<span class="token operator">|</span>dpdk<span class="token operator">|</span>INFO<span class="token operator">|</span>VHOST_CONFIG: guest memory region <span class="token number">0</span>, size: 0x200000000
         guest physical addr: 0x40000000
         guest virtual  addr: 0xfffd80000000
         <span class="token function">host</span>  virtual  addr: 0x400000000000
         mmap addr <span class="token builtin class-name">:</span> 0x400000000000
         mmap size <span class="token builtin class-name">:</span> 0x200000000
         mmap align: 0x20000000
         mmap off  <span class="token builtin class-name">:</span> 0x0
<span class="token number">2018</span>-09-07T05:20:08.275Z<span class="token operator">|</span>00002<span class="token operator">|</span>daemon_unix<span class="token punctuation">(</span>monitor<span class="token punctuation">)</span><span class="token operator">|</span>ERR<span class="token operator">|</span><span class="token number">1</span> crashes: pid <span class="token number">44572</span> died, killed <span class="token punctuation">(</span>Segmentation fault<span class="token punctuation">)</span>, core dumped, restarting
<span class="token number">2018</span>-09-07T05:20:08.282Z<span class="token operator">|</span>00003<span class="token operator">|</span>ovs_numa<span class="token operator">|</span>INFO<span class="token operator">|</span>Discovered <span class="token number">46</span> CPU cores on NUMA <span class="token function">node</span> <span class="token number">0</span>
<span class="token number">2018</span>-09-07T05:20:08.282Z<span class="token operator">|</span>00004<span class="token operator">|</span>ovs_numa<span class="token operator">|</span>INFO<span class="token operator">|</span>Discovered <span class="token number">1</span> NUMA nodes and <span class="token number">46</span> CPU cores
<span class="token number">2018</span>-09-07T05:20:08.282Z<span class="token operator">|</span>00005<span class="token operator">|</span>memory<span class="token operator">|</span>INFO<span class="token operator">|</span><span class="token number">18880</span> kB peak resident <span class="token builtin class-name">set</span> size after <span class="token number">224.0</span> seconds
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="OVS_phy-vm-phy.html" class="navigation navigation-prev " aria-label="Previous page: OVS PHY-VM-PHY">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="networking_网络虚拟化操作记录.html" class="navigation navigation-next " aria-label="Next page: 网络虚拟化操作记录">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"网络虚拟化用例记录","level":"1.6.2.6","depth":3,"next":{"title":"网络虚拟化操作记录","level":"1.6.2.7","depth":3,"path":"notes/networking_网络虚拟化操作记录.md","ref":"notes/networking_网络虚拟化操作记录.md","articles":[]},"previous":{"title":"OVS PHY-VM-PHY","level":"1.6.2.5","depth":3,"path":"notes/OVS_phy-vm-phy.md","ref":"notes/OVS_phy-vm-phy.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-livereload","-sharing","-lunr","-search","search-plus","-highlight","theme-comscore","prism","code","chapter-fold","github","splitter","wide-page","hide-navigation-buttons","anchor-navigation-ex","sequence"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"chapter-fold":{},"prism":{"css":["prismjs/themes/prism.css"]},"sequence":{"theme":"simple"},"github":{"url":"https://github.com/Bai-Yingjie/Bai-Yingjie.github.io"},"splitter":{},"wide-page":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"hide-navigation-buttons":{},"anchor-navigation-ex":{"mode":"float","pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"isRewritePageTitle":true,"showLevel":true,"tocLevel1Icon":"fa fa-hand-o-right","tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right","showGoTop":true,"isShowTocTitleIcon":true,"printLog":false,"multipleH1":true,"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false}},"theme-comscore":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"search-plus":{}},"theme":"default","author":"Bai Yingjie","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"My Notes","language":"zh-hans","gitbook":"*"},"file":{"path":"notes/networking_网络虚拟化用例记录.md","mtime":"2022-10-18T02:37:55.682Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-10-18T02:39:12.210Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

