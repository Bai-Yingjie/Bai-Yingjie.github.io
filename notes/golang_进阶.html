
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Golang 进阶 · My Notes</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Bai Yingjie">
        
        
    
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-wide-page/wide.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hide-navigation-buttons/index.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-mermaid-gb3/mermaid/mermaid.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    


    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="as_title_golang2.html" />
    
    
    <link rel="prev" href="golang_高效go.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="as_title_kaiyuan.html">
            
                <a href="as_title_kaiyuan.html">
            
                    
                    开源
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="my_opensource.html">
            
                <a href="my_opensource.html">
            
                    
                    我的开源项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="my_upstream.html">
            
                <a href="my_upstream.html">
            
                    
                    我的upstream commit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="as_title_system.html">
            
                <a href="as_title_system.html">
            
                    
                    系统分析和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="as_title_perf_misc.html">
            
                <a href="as_title_perf_misc.html">
            
                    
                    调试和分析记录系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="profiling_调试和分析记录5.html">
            
                <a href="profiling_调试和分析记录5.html">
            
                    
                    调试和分析记录5
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="profiling_调试和分析记录4.html">
            
                <a href="profiling_调试和分析记录4.html">
            
                    
                    调试和分析记录4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="profiling_调试和分析记录3.html">
            
                <a href="profiling_调试和分析记录3.html">
            
                    
                    调试和分析记录3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="profiling_调试和分析记录2.html">
            
                <a href="profiling_调试和分析记录2.html">
            
                    
                    调试和分析记录2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="profiling_调试和分析记录1.html">
            
                <a href="profiling_调试和分析记录1.html">
            
                    
                    调试和分析记录1
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="调试和分析工具概览.html">
            
                <a href="调试和分析工具概览.html">
            
                    
                    profiling和debugging工具相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="profiling_Linux内核调试的方式以及工具集锦.html">
            
                <a href="profiling_Linux内核调试的方式以及工具集锦.html">
            
                    
                    Linux内核调试的方式以及工具集锦(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="profiling_user_space_Ptrace_Utrace_Uprobes.html">
            
                <a href="profiling_user_space_Ptrace_Utrace_Uprobes.html">
            
                    
                    Ptrace, Utrace, Uprobes: Lightweight, Dynamic Tracing of User Apps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="debugging_gdb备忘录.html">
            
                <a href="debugging_gdb备忘录.html">
            
                    
                    gdb备忘录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="profiling_perf命令备忘录.html">
            
                <a href="profiling_perf命令备忘录.html">
            
                    
                    perf命令备忘录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5" data-path="profiling_perf命令备忘录2.html">
            
                <a href="profiling_perf命令备忘录2.html">
            
                    
                    perf命令备忘录2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.6" data-path="profiling_perf学习笔记之实战篇.html">
            
                <a href="profiling_perf学习笔记之实战篇.html">
            
                    
                    perf学习笔记之实战篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.7" data-path="profiling_perf学习笔记之入门篇.html">
            
                <a href="profiling_perf学习笔记之入门篇.html">
            
                    
                    perf学习笔记之入门篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.8" data-path="profiling_用kprobe和perf_记录函数参数.html">
            
                <a href="profiling_用kprobe和perf_记录函数参数.html">
            
                    
                    使用kprobe和perf结合记录函数参数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.9" data-path="profiling_ftrace和trace-cmd记录.html">
            
                <a href="profiling_ftrace和trace-cmd记录.html">
            
                    
                    ftrace和trace-cmd记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.10" data-path="profiling_ftrace使用实例.html">
            
                <a href="profiling_ftrace使用实例.html">
            
                    
                    ftrace使用实例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.11" data-path="profiling_systemtap实例.html">
            
                <a href="profiling_systemtap实例.html">
            
                    
                    systemtap实例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.12" data-path="profiling_systemtap基础.html">
            
                <a href="profiling_systemtap基础.html">
            
                    
                    systemtap基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.13" data-path="profiling_perf-tools_example.html">
            
                <a href="profiling_perf-tools_example.html">
            
                    
                    perf-tools 系统tracing工具集
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.14" data-path="profiling_Comparing_SystemTap_and_bpftrace.html">
            
                <a href="profiling_Comparing_SystemTap_and_bpftrace.html">
            
                    
                    Comparing SystemTap and bpftrace(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.15" data-path="system_analysis_bcc和ebpf.html">
            
                <a href="system_analysis_bcc和ebpf.html">
            
                    
                    bcc和ebpf(starting)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="as_title_os_perf.html">
            
                <a href="as_title_os_perf.html">
            
                    
                    profiling和debugging实例
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="profiling_调查ftrace显示调用栈全0问题.html">
            
                <a href="profiling_调查ftrace显示调用栈全0问题.html">
            
                    
                    调查ftrace显示调用栈全0问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="profiling_eoe_filter写tap设备失败问题.html">
            
                <a href="profiling_eoe_filter写tap设备失败问题.html">
            
                    
                    eoe_filter写tap设备失败问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="performance_ovs进程调查.html">
            
                <a href="performance_ovs进程调查.html">
            
                    
                    OVS进程调查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.4" data-path="performance_ping流程和函数调用解析.html">
            
                <a href="performance_ping流程和函数调用解析.html">
            
                    
                    ping流程和函数调用解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.5" data-path="profiling_VM互相ping场景下的延迟分析.html">
            
                <a href="profiling_VM互相ping场景下的延迟分析.html">
            
                    
                    VM互相ping场景下的延迟分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.6" data-path="debugging_ftrace_谁创建了bond0设备.html">
            
                <a href="debugging_ftrace_谁创建了bond0设备.html">
            
                    
                    谁创建了bond0设备: ftrace kprobe uprobe perf综合使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.7" data-path="profiling_unixbench之filecopy分析.html">
            
                <a href="profiling_unixbench之filecopy分析.html">
            
                    
                    unixbench之file copy分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.8" data-path="profiling_lmbench之lat_tcp分析.html">
            
                <a href="profiling_lmbench之lat_tcp分析.html">
            
                    
                    lmbench之lat_tcp分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="as_title_arch_perf.html">
            
                <a href="as_title_arch_perf.html">
            
                    
                    CPU ARCH相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="performance_CPU_microarchiteture_pmu.html">
            
                <a href="performance_CPU_microarchiteture_pmu.html">
            
                    
                    Top-down Microarchitecture Analysis Method(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="as_title_cloud.html">
            
                <a href="as_title_cloud.html">
            
                    
                    Cloud和容器相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="cloud_杂记.html">
            
                <a href="cloud_杂记.html">
            
                    
                    云杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="container_当代容器读书笔记.html">
            
                <a href="container_当代容器读书笔记.html">
            
                    
                    当代容器读书笔记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="as_title_vdevice.html">
            
                <a href="as_title_vdevice.html">
            
                    
                    CPU和device虚拟化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="as_title_gvisor.html">
            
                <a href="as_title_gvisor.html">
            
                    
                    gvisor
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="golang_gvisor代码_KVM.html">
            
                <a href="golang_gvisor代码_KVM.html">
            
                    
                    gvisor KVM模式代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="golang_gvisor调试.html">
            
                <a href="golang_gvisor调试.html">
            
                    
                    gvisor调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="golang_gvisor_ptrace.html">
            
                <a href="golang_gvisor_ptrace.html">
            
                    
                    gvisor ptrace模式介绍(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="rust_vmm_brief.html">
            
                <a href="rust_vmm_brief.html">
            
                    
                    rust VMM(virtual machine monitor)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="rust_vmm_简介.html">
            
                <a href="rust_vmm_简介.html">
            
                    
                    rust-vmm简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="rust_firecracker_代码.html">
            
                <a href="rust_firecracker_代码.html">
            
                    
                    firecracker代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="rust_firecracker_使用.html">
            
                <a href="rust_firecracker_使用.html">
            
                    
                    firecracker使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="rust_cloud-hypervisor_代码.html">
            
                <a href="rust_cloud-hypervisor_代码.html">
            
                    
                    cloud hypervisor代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.5" data-path="rust_cloud-hypervisor_使用.html">
            
                <a href="rust_cloud-hypervisor_使用.html">
            
                    
                    cloud hypervisor使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.6" data-path="rust_cloud-hypervisor_问题与解决.html">
            
                <a href="rust_cloud-hypervisor_问题与解决.html">
            
                    
                    cloud hypervisor问题与解决
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="virtualization_virtio规范阅读笔记.html">
            
                <a href="virtualization_virtio规范阅读笔记.html">
            
                    
                    virtio规范阅读笔记.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="qemu_ovs_虚拟化环境.html">
            
                <a href="qemu_ovs_虚拟化环境.html">
            
                    
                    qemu OVS 虚拟化环境准备
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="qemu使用.html">
            
                <a href="qemu使用.html">
            
                    
                    Qemu使用(old)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="as_title_networking.html">
            
                <a href="as_title_networking.html">
            
                    
                    计算机网络相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="networking_杂记2.html">
            
                <a href="networking_杂记2.html">
            
                    
                    networking杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="networking_杂记1.html">
            
                <a href="networking_杂记1.html">
            
                    
                    networking杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="networking_优化linux网络栈_接收路径.html">
            
                <a href="networking_优化linux网络栈_接收路径.html">
            
                    
                    优化linux网络栈: 接收路径(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="networking_优化linux网络栈_发送路径.html">
            
                <a href="networking_优化linux网络栈_发送路径.html">
            
                    
                    优化linux网络栈: 发送路径(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="networking_Potential_Performance_Bottleneck_in_Linux_TCP.html">
            
                <a href="networking_Potential_Performance_Bottleneck_in_Linux_TCP.html">
            
                    
                    Potential Performance Bottleneck in Linux TCP(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="networking_xdp入门.html">
            
                <a href="networking_xdp入门.html">
            
                    
                    Get started with XDP(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="networking_linux收包路径图解.html">
            
                <a href="networking_linux收包路径图解.html">
            
                    
                    linux收包路径图解(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="as_title_qemu_ovs.html">
            
                <a href="as_title_qemu_ovs.html">
            
                    
                    Qemu OVS和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.8.1" data-path="OVS_DPDK_编译运行.html">
            
                <a href="OVS_DPDK_编译运行.html">
            
                    
                    OVS-DPDK编译运行
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.2" data-path="OVS_架构和代码.html">
            
                <a href="OVS_架构和代码.html">
            
                    
                    OVS架构和代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.3" data-path="OVS_DPDK_performance_HXT_ARM_server.html">
            
                <a href="OVS_DPDK_performance_HXT_ARM_server.html">
            
                    
                    OVS-DPDK for ARM server 性能测试环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.4" data-path="DPDK_Mellanox.html">
            
                <a href="DPDK_Mellanox.html">
            
                    
                    DPDK Mellanox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.5" data-path="OVS_phy-vm-phy.html">
            
                <a href="OVS_phy-vm-phy.html">
            
                    
                    OVS PHY-VM-PHY
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.6" data-path="networking_网络虚拟化用例记录.html">
            
                <a href="networking_网络虚拟化用例记录.html">
            
                    
                    网络虚拟化用例记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.7" data-path="networking_网络虚拟化操作记录.html">
            
                <a href="networking_网络虚拟化操作记录.html">
            
                    
                    网络虚拟化操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="as_title_virtnet.html">
            
                <a href="as_title_virtnet.html">
            
                    
                    虚拟化网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.9.1" data-path="networking_tc_filter_连接veth和tap.html">
            
                <a href="networking_tc_filter_连接veth和tap.html">
            
                    
                    Connecting a veth device to tap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.2" data-path="networking_multicast_vxlan_flannel.html">
            
                <a href="networking_multicast_vxlan_flannel.html">
            
                    
                    multicast vxlan和flannel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.3" data-path="networking_virtio网络介绍.html">
            
                <a href="networking_virtio网络介绍.html">
            
                    
                    virtio网络介绍(网摘): vhost-net virtio-net vhost-user SRIOV
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.4" data-path="networking_virtualization_杂记.html">
            
                <a href="networking_virtualization_杂记.html">
            
                    
                    虚拟化网络杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.5" data-path="networking_linux虚拟网络接口.html">
            
                <a href="networking_linux虚拟网络接口.html">
            
                    
                    linux虚拟网络接口(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="as_title_arm_server.html">
            
                <a href="as_title_arm_server.html">
            
                    
                    ARM server
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="arm_server_杂记.html">
            
                <a href="arm_server_杂记.html">
            
                    
                    Arm server 杂记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="as_title_embedded.html">
            
                <a href="as_title_embedded.html">
            
                    
                    嵌入式系统开发调试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="embedded_debugging.html">
            
                <a href="embedded_debugging.html">
            
                    
                    嵌入式调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="uboot_杂记.html">
            
                <a href="uboot_杂记.html">
            
                    
                    uboot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="buildroot_杂记.html">
            
                <a href="buildroot_杂记.html">
            
                    
                    buildroot杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="toolchain_升级gcc问题解决.html">
            
                <a href="toolchain_升级gcc问题解决.html">
            
                    
                    升级GCC7.3问题解决
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="kernel_异常打印分析实例.html">
            
                <a href="kernel_异常打印分析实例.html">
            
                    
                    kernel bug异常打印分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="as_title_linuxdaily.html">
            
                <a href="as_title_linuxdaily.html">
            
                    
                    Linux工程实践
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="linux_日常使用.html">
            
                <a href="linux_日常使用.html">
            
                    
                    日常linux使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="git_日常使用.html">
            
                <a href="git_日常使用.html">
            
                    
                    日常git使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="向kernel提交补丁.html">
            
                <a href="向kernel提交补丁.html">
            
                    
                    向kernel提交补丁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="linux_ssh_relay.html">
            
                <a href="linux_ssh_relay.html">
            
                    
                    ssh relay
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="gitlab_ci.html">
            
                <a href="gitlab_ci.html">
            
                    
                    gitlab CI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="docker_操作记录.html">
            
                <a href="docker_操作记录.html">
            
                    
                    docker操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="centos_操作记录.html">
            
                <a href="centos_操作记录.html">
            
                    
                    centos操作记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="as_title_golang.html">
            
                <a href="as_title_golang.html">
            
                    
                    Golang
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="as_title_golang1.html">
            
                <a href="as_title_golang1.html">
            
                    
                    入门
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1.1" data-path="golang_语法基础.html">
            
                <a href="golang_语法基础.html">
            
                    
                    Golang 语法基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.2" data-path="golang_json性能.html">
            
                <a href="golang_json性能.html">
            
                    
                    Golang json性能比较
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="golang_原理.html">
            
                <a href="golang_原理.html">
            
                    
                    Golang 原理相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.1" data-path="golang_interface原理.html">
            
                <a href="golang_interface原理.html">
            
                    
                    Golang interface原理(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.2" data-path="golang_内存分配.html">
            
                <a href="golang_内存分配.html">
            
                    
                    Golang 内存分配(网摘)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="golang_标准库.html">
            
                <a href="golang_标准库.html">
            
                    
                    Golang 标准库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="golang_我的反射代码.html">
            
                <a href="golang_我的反射代码.html">
            
                    
                    Golang 我的反射代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="golang_问答.html">
            
                <a href="golang_问答.html">
            
                    
                    Golang 问答
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="golang_高效go.html">
            
                <a href="golang_高效go.html">
            
                    
                    Golang 高效go
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.10.7" data-path="golang_进阶.html">
            
                <a href="golang_进阶.html">
            
                    
                    Golang 进阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="as_title_golang2.html">
            
                <a href="as_title_golang2.html">
            
                    
                    Golang 杂记
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.8.1" data-path="golang_杂记1.html">
            
                <a href="golang_杂记1.html">
            
                    
                    Golang 杂记1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.2" data-path="golang_杂记2.html">
            
                <a href="golang_杂记2.html">
            
                    
                    Golang 杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.3" data-path="golang_杂记3.html">
            
                <a href="golang_杂记3.html">
            
                    
                    Golang 杂记3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.4" data-path="golang_lib选型.html">
            
                <a href="golang_lib选型.html">
            
                    
                    Golang lib选型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.5" data-path="golang_mod_proxy.html">
            
                <a href="golang_mod_proxy.html">
            
                    
                    go mod和go proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.6" data-path="golang_汇编_arm64.html">
            
                <a href="golang_汇编_arm64.html">
            
                    
                    Golang 汇编语法和arm64小知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8.7" data-path="golang_cgo_swig.html">
            
                <a href="golang_cgo_swig.html">
            
                    
                    go调用c可以用swig
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="as_title_golang3.html">
            
                <a href="as_title_golang3.html">
            
                    
                    Golang 环境和工具链生成
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.9.1" data-path="golang_toolchain_ppc.html">
            
                <a href="golang_toolchain_ppc.html">
            
                    
                    go tools增加ppc32支持.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.2" data-path="golang_toolchain_compile_gccgo.html">
            
                <a href="golang_toolchain_compile_gccgo.html">
            
                    
                    编译gccgo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3" data-path="golang_go_on_mips.html">
            
                <a href="golang_go_on_mips.html">
            
                    
                    go on mips boards(not so updated)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.9.3.1" data-path="golang_go_on_mips_part1.html">
            
                <a href="golang_go_on_mips_part1.html">
            
                    
                    part 1: cross compile go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.2" data-path="golang_go_on_mips_part2.html">
            
                <a href="golang_go_on_mips_part2.html">
            
                    
                    part 2: build native go compiler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.3" data-path="golang_go_on_mips_part3.html">
            
                <a href="golang_go_on_mips_part3.html">
            
                    
                    part 3: gccgo experiments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.4" data-path="golang_go_on_mips_part4.html">
            
                <a href="golang_go_on_mips_part4.html">
            
                    
                    part 4: Golang json performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9.3.5" data-path="golang_gentoo_on_mips_board_and_build_go.html">
            
                <a href="golang_gentoo_on_mips_board_and_build_go.html">
            
                    
                    Gentoo on mips board and build go
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.10" data-path="as_title_golang4.html">
            
                <a href="as_title_golang4.html">
            
                    
                    微服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.10.1" data-path="golang_micro.html">
            
                <a href="golang_micro.html">
            
                    
                    go-micro和micro
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10.2" data-path="golang_微服务概念.html">
            
                <a href="golang_微服务概念.html">
            
                    
                    微服务概念
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.11" data-path="as_title_golang5.html">
            
                <a href="as_title_golang5.html">
            
                    
                    解释器和编解码
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.11.1" data-path="golang_yeagi.html">
            
                <a href="golang_yeagi.html">
            
                    
                    解释器yeagi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.2" data-path="golang_tengo.html">
            
                <a href="golang_tengo.html">
            
                    
                    解释器tengo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.3" data-path="golang_govaluate.html">
            
                <a href="golang_govaluate.html">
            
                    
                    解释器govaluate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.4" data-path="golang_encoding_gotiny.html">
            
                <a href="golang_encoding_gotiny.html">
            
                    
                    gotiny编解码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11.5" data-path="golang_abs.html">
            
                <a href="golang_abs.html">
            
                    
                    解释器abs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.12" data-path="as_title_golang6.html">
            
                <a href="as_title_golang6.html">
            
                    
                    调试和性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.12.1" data-path="golang_调试记录.html">
            
                <a href="golang_调试记录.html">
            
                    
                    Golang 调试记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12.2" data-path="golang_topid性能优化.html">
            
                <a href="golang_topid性能优化.html">
            
                    
                    Golang topid性能优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12.3" data-path="golang_gshell性能调试.html">
            
                <a href="golang_gshell性能调试.html">
            
                    
                    Golang gshell性能调试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.13" data-path="as_title_golang7.html">
            
                <a href="as_title_golang7.html">
            
                    
                    网络和消息中间件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.13.1" data-path="golang_zmq.html">
            
                <a href="golang_zmq.html">
            
                    
                    消息中间件基本概念和zero mq
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.2" data-path="golang_mango.html">
            
                <a href="golang_mango.html">
            
                    
                    消息中间件mango
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13.3" data-path="golang_libp2p.html">
            
                <a href="golang_libp2p.html">
            
                    
                    Golang p2p网络
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="as_title_rust.html">
            
                <a href="as_title_rust.html">
            
                    
                    Rust
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="rust_入门_brief.html">
            
                <a href="rust_入门_brief.html">
            
                    
                    Rust 入门系列
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1.1" data-path="rust_books.html">
            
                <a href="rust_books.html">
            
                    
                    Rust reference books
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.2" data-path="rust_入门1.html">
            
                <a href="rust_入门1.html">
            
                    
                    Rust 安装和基础语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.3" data-path="rust_入门2.html">
            
                <a href="rust_入门2.html">
            
                    
                    Rust 泛型和内存所有权
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.4" data-path="rust_入门3.html">
            
                <a href="rust_入门3.html">
            
                    
                    Rust 闭包 容器 迭代器 生成器 线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.5" data-path="rust_工程构建.html">
            
                <a href="rust_工程构建.html">
            
                    
                    Rust 工程构建
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="rust_coding_brief.html">
            
                <a href="rust_coding_brief.html">
            
                    
                    Rust 代码积累
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.2.1" data-path="rust_序列化.html">
            
                <a href="rust_序列化.html">
            
                    
                    Rust 序列化原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.2" data-path="rust_知识点积累.html">
            
                <a href="rust_知识点积累.html">
            
                    
                    Rust 知识点更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.3" data-path="rust_adaptiveservice.html">
            
                <a href="rust_adaptiveservice.html">
            
                    
                    rust版本的adaptiveservice探索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.4" data-path="rust_常用设施.html">
            
                <a href="rust_常用设施.html">
            
                    
                    Rust 常用设施
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2.5" data-path="rust_代码小段.html">
            
                <a href="rust_代码小段.html">
            
                    
                    Rust 代码小段
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="others.html">
            
                <a href="others.html">
            
                    
                    其他
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.3.1" data-path="rust_mdbook_使用.html">
            
                <a href="rust_mdbook_使用.html">
            
                    
                    Rust 使用mdbook
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="as_title_scripts.html">
            
                <a href="as_title_scripts.html">
            
                    
                    脚本
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="shell_变量.html">
            
                <a href="shell_变量.html">
            
                    
                    shell变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="shell_基础篇.html">
            
                <a href="shell_基础篇.html">
            
                    
                    shell命令和脚本记录-基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="shell_高级篇.html">
            
                <a href="shell_高级篇.html">
            
                    
                    shell命令和脚本记录-高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="shell_脚本片段.html">
            
                <a href="shell_脚本片段.html">
            
                    
                    shell脚本片段
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="python_记录.html">
            
                <a href="python_记录.html">
            
                    
                    python记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="lua_记录.html">
            
                <a href="lua_记录.html">
            
                    
                    lua记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="shell_rds脚本阅读.html">
            
                <a href="shell_rds脚本阅读.html">
            
                    
                    RDS脚本阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="Project_Euler.html">
            
                <a href="Project_Euler.html">
            
                    
                    Project Euler
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="as_title_app.html">
            
                <a href="as_title_app.html">
            
                    
                    应用相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="app_sysbench代码分析.html">
            
                <a href="app_sysbench代码分析.html">
            
                    
                    sysbench代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="as_title_cos.html">
            
                <a href="as_title_cos.html">
            
                    
                    C和Operating System
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="system_libc_part1.html">
            
                <a href="system_libc_part1.html">
            
                    
                    libc概览1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="system_libc_part2.html">
            
                <a href="system_libc_part2.html">
            
                    
                    libc概览2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3" data-path="system_libc_part3.html">
            
                <a href="system_libc_part3.html">
            
                    
                    libc概览3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.4" data-path="system_原理杂记.html">
            
                <a href="system_原理杂记.html">
            
                    
                    系统原理杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5" data-path="system_alpine.html">
            
                <a href="system_alpine.html">
            
                    
                    Alpine Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.6" data-path="system_进程间通信.html">
            
                <a href="system_进程间通信.html">
            
                    
                    进程间通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.7" data-path="system_特殊功能fd.html">
            
                <a href="system_特殊功能fd.html">
            
                    
                    eventfd timerfd signalfd和fd共享
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.8" data-path="c_automake_autoconf.html">
            
                <a href="c_automake_autoconf.html">
            
                    
                    automake autoconf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.9" data-path="makefile_原理和实践.html">
            
                <a href="makefile_原理和实践.html">
            
                    
                    makefile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.10" data-path="c_编程杂记高级篇.html">
            
                <a href="c_编程杂记高级篇.html">
            
                    
                    C编程杂记高级篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.11" data-path="c_编程杂记基础篇.html">
            
                <a href="c_编程杂记基础篇.html">
            
                    
                    C编程杂记基础篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.12" data-path="c_networking_socket高阶用法.html">
            
                <a href="c_networking_socket高阶用法.html">
            
                    
                    网络编程: Advanced Socket Topics(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.13" data-path="c_protobuf介绍.html">
            
                <a href="c_protobuf介绍.html">
            
                    
                    序列化: protobuf介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.14" data-path="c_进程间通信_共享文件和共享内存.html">
            
                <a href="c_进程间通信_共享文件和共享内存.html">
            
                    
                    进程间通信: 共享文件和共享内存(网摘)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.15" data-path="c_pthread_condition和mutex.html">
            
                <a href="c_pthread_condition和mutex.html">
            
                    
                    并发 任务 事件 和锁.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.16" data-path="kernel_user_space_howto.html">
            
                <a href="kernel_user_space_howto.html">
            
                    
                    kernel space和user space交互(网摘, linux2.6)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.17" data-path="CentOS_系统性能优化配置.html">
            
                <a href="CentOS_系统性能优化配置.html">
            
                    
                    CentOS 性能优化系统配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="as_title_driver.html">
            
                <a href="as_title_driver.html">
            
                    
                    内核 设备和驱动相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="device_driver_地址空间类型和DMA.html">
            
                <a href="device_driver_地址空间类型和DMA.html">
            
                    
                    地址空间类型和DMA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="platform_device_driver.html">
            
                <a href="platform_device_driver.html">
            
                    
                    平台驱动杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="platform_device_driver2.html">
            
                <a href="platform_device_driver2.html">
            
                    
                    平台驱动杂记2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4" data-path="device_driver_pci驱动概述.html">
            
                <a href="device_driver_pci驱动概述.html">
            
                    
                    pci驱动概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.5" data-path="device_driver_内核中的时间和延迟操作.html">
            
                <a href="device_driver_内核中的时间和延迟操作.html">
            
                    
                    内核中的时间和延迟操作.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.6" data-path="device_driver_杂记.html">
            
                <a href="device_driver_杂记.html">
            
                    
                    驱动调试杂记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7" data-path="device_localbus_16bit读写.html">
            
                <a href="device_localbus_16bit读写.html">
            
                    
                    CPLD做8bit到16bit转换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.8" data-path="as_title_driver1.html">
            
                <a href="as_title_driver1.html">
            
                    
                    nand
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.8.1" data-path="device_driver_octeon_nand.html">
            
                <a href="device_driver_octeon_nand.html">
            
                    
                    octeon nand flash驱动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.8.2" data-path="device_driver_nand概率写失败问题分析.html">
            
                <a href="device_driver_nand概率写失败问题分析.html">
            
                    
                    Nand flash概率写失败问题分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.9" data-path="octeon_remote_pci.html">
            
                <a href="octeon_remote_pci.html">
            
                    
                    octeon remote-pci.c阅读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.10" data-path="Device_VFIO_notes.html">
            
                <a href="Device_VFIO_notes.html">
            
                    
                    VFIO简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.11" data-path="as_title_driver2.html">
            
                <a href="as_title_driver2.html">
            
                    
                    智能网卡和DPDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.11.1" data-path="smartNIC_智能网卡对比.html">
            
                <a href="smartNIC_智能网卡对比.html">
            
                    
                    智能网卡对比
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.11.2" data-path="octeon_pci_NIC.html">
            
                <a href="octeon_pci_NIC.html">
            
                    
                    octeon PCI NIC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.11.3" data-path="as_title_driver3.html">
            
                <a href="as_title_driver3.html">
            
                    
                    octeon liquidIO
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.11.3.1" data-path="smartNIC_liquidIO_代码阅读app篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读app篇.html">
            
                    
                    PCI-NIC 代码阅读 --app篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.11.3.2" data-path="smartNIC_liquidIO_代码阅读api篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读api篇.html">
            
                    
                    PCI-NIC 代码阅读 --api篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.11.3.3" data-path="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇之结构体.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇之结构体
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.11.3.4" data-path="smartNIC_liquidIO_代码阅读driver篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读driver篇.html">
            
                    
                    PCI-NIC 代码阅读 --driver篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.11.3.5" data-path="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                <a href="smartNIC_liquidIO_代码阅读真NIC篇.html">
            
                    
                    PCI-NIC 代码阅读 --真NIC篇
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.11.4" data-path="networking_dpdk使用_2014.html">
            
                <a href="networking_dpdk使用_2014.html">
            
                    
                    DPDK使用(2014)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15.12" data-path="device_nvme要点介绍.html">
            
                <a href="device_nvme要点介绍.html">
            
                    
                    nvme要点介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="as_title_cpu.html">
            
                <a href="as_title_cpu.html">
            
                    
                    CPU Arch相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="cache_CPU和cache一致性原理.html">
            
                <a href="cache_CPU和cache一致性原理.html">
            
                    
                    CPU和cache一致性原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="as_title_cpu1.html">
            
                <a href="as_title_cpu1.html">
            
                    
                    ARM64
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.2.1" data-path="CPU_ARM64_thunder_overview.html">
            
                <a href="CPU_ARM64_thunder_overview.html">
            
                    
                    thunder 概览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.2" data-path="CPU_ARM64_thunder_开发板操作记录.html">
            
                <a href="CPU_ARM64_thunder_开发板操作记录.html">
            
                    
                    thunder 开发板操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.3" data-path="CPU_ARM64_thunder_bdk.html">
            
                <a href="CPU_ARM64_thunder_bdk.html">
            
                    
                    thunder BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.4" data-path="CPU_ARM64_thunder_efi_rtc.html">
            
                <a href="CPU_ARM64_thunder_efi_rtc.html">
            
                    
                    thunder RTC时间和efi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.5" data-path="CPU_ARM64_thunder_uefi_fdt.html">
            
                <a href="CPU_ARM64_thunder_uefi_fdt.html">
            
                    
                    thunder uefi和fdt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.6" data-path="CPU_ARM64_thunder_atf.html">
            
                <a href="CPU_ARM64_thunder_atf.html">
            
                    
                    thunder atf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.7" data-path="CPU_ARM64_thunder_kernel_boot.html">
            
                <a href="CPU_ARM64_thunder_kernel_boot.html">
            
                    
                    thunder kernel启动打印流程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="as_title_cpu2.html">
            
                <a href="as_title_cpu2.html">
            
                    
                    PPC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.3.1" data-path="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                <a href="CPU_PPC启动多核Linux_流程和内存映射.html">
            
                    
                    PPC启动多核linux: 流程和内存映射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3.2" data-path="CPU_PPC_kernel升级记录.html">
            
                <a href="CPU_PPC_kernel升级记录.html">
            
                    
                    PPC kernel升级记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.4" data-path="as_title_cpu3.html">
            
                <a href="as_title_cpu3.html">
            
                    
                    MIPS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.4.1" data-path="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                <a href="CPU_MIPS_octeon地址空间和寄存器访问.html">
            
                    
                    octeon 地址空间和寄存器访问
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.2" data-path="CPU_MIPS_octeon操作记录.html">
            
                <a href="CPU_MIPS_octeon操作记录.html">
            
                    
                    octeon 操作记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.3" data-path="CPU_MIPS_octeon_包处理性能.html">
            
                <a href="CPU_MIPS_octeon_包处理性能.html">
            
                    
                    octeon 系列处理器包处理性能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.4" data-path="CPU_MIPS_octeon_ddr调试记录.html">
            
                <a href="CPU_MIPS_octeon_ddr调试记录.html">
            
                    
                    octeon DDR调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.5" data-path="CPU_MIPS_octeon_BDK.html">
            
                <a href="CPU_MIPS_octeon_BDK.html">
            
                    
                    octeon CN78xx BDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.6" data-path="kernel_增加ECC中断.html">
            
                <a href="kernel_增加ECC中断.html">
            
                    
                    octeon 增加ECC中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.7" data-path="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                <a href="CPU_MIPS_octeon_hw-ddr2代码走读.html">
            
                    
                    octeon hw-ddr2代码走读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.8" data-path="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                <a href="CPU_MIPS_octeon_reboot调试和ddr中断.html">
            
                    
                    octeon reboot调试和DDR中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.9" data-path="CPU_MIPS_octeon中断.html">
            
                <a href="CPU_MIPS_octeon中断.html">
            
                    
                    octeon 中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.10" data-path="CPU_MIPS_octeon原子操作.html">
            
                <a href="CPU_MIPS_octeon原子操作.html">
            
                    
                    octeon 原子操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4.11" data-path="CPU_MIPS_octeon网口代码分析.html">
            
                <a href="CPU_MIPS_octeon网口代码分析.html">
            
                    
                    octeon 网口代码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Golang 进阶</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#&#x7EE7;&#x627F;-&#x533F;&#x540D;&#x5305;&#x542B;2"><b>1. </b>&#x7EE7;&#x627F;, &#x533F;&#x540D;&#x5305;&#x542B;2</a></li><ul><li><span class="title-icon "></span><a href="#&#x5B9E;&#x4F8B;-statsconn"><b>1.1. </b>&#x5B9E;&#x4F8B; StatsConn</a></li><li><span class="title-icon "></span><a href="#&#x603B;&#x7ED3;"><b>1.2. </b>&#x603B;&#x7ED3;</a></li></ul><li><span class="title-icon "></span><a href="#&#x7EE7;&#x627F;-&#x533F;&#x540D;&#x5305;&#x542B;"><b>2. </b>&#x7EE7;&#x627F;, &#x533F;&#x540D;&#x5305;&#x542B;</a></li><ul><li><span class="title-icon "></span><a href="#&#x603B;&#x7ED3;_1"><b>2.1. </b>&#x603B;&#x7ED3;</a></li></ul><li><span class="title-icon "></span><a href="#interface&#x7684;&#x8D4B;&#x503C;"><b>3. </b>interface&#x7684;&#x8D4B;&#x503C;</a></li><ul><li><span class="title-icon "></span><a href="#&#x7B2C;&#x4E00;&#x79CD;&#x60C5;&#x51B5;-&#x5982;&#x679C;&#x65B9;&#x6CD5;&#x7684;receiver&#x7C7B;&#x578B;&#x4E0D;&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;"><b>3.1. </b>&#x7B2C;&#x4E00;&#x79CD;&#x60C5;&#x51B5;: &#x5982;&#x679C;&#x65B9;&#x6CD5;&#x7684;receiver&#x7C7B;&#x578B;&#x4E0D;&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;</a></li><li><span class="title-icon "></span><a href="#&#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;-&#x65B9;&#x6CD5;&#x7684;receiver&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x58F0;&#x660E;&#x7684;"><b>3.2. </b>&#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;: &#x65B9;&#x6CD5;&#x7684;receiver&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x58F0;&#x660E;&#x7684;</a></li><li><span class="title-icon "></span><a href="#&#x603B;&#x7ED3;_2"><b>3.3. </b>&#x603B;&#x7ED3;</a></li></ul><li><span class="title-icon "></span><a href="#go-faq"><b>4. </b>go FAQ</a></li><ul><li><span class="title-icon "></span><a href="#go13&#x662F;c&#x5199;&#x7684;-&#x540E;&#x9762;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x662F;go&#x5199;&#x7684;-&#x5DE5;&#x5177;&#x81EA;&#x52A8;&#x628A;c&#x8F6C;&#x6210;go&#x7684;"><b>4.1. </b>go1.3&#x662F;c&#x5199;&#x7684;, &#x540E;&#x9762;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x662F;go&#x5199;&#x7684; &#x5DE5;&#x5177;&#x81EA;&#x52A8;&#x628A;C&#x8F6C;&#x6210;go&#x7684;</a></li><li><span class="title-icon "></span><a href="#interface&#x7684;&#x7B7E;&#x540D;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x4E00;&#x6837;"><b>4.2. </b>interface&#x7684;&#x7B7E;&#x540D;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x4E00;&#x6837;</a></li><ul><li><span class="title-icon "></span><a href="#&#x4F8B;&#x5B50;1"><b>4.2.1. </b>&#x4F8B;&#x5B50;1</a></li><li><span class="title-icon "></span><a href="#&#x4F8B;&#x5B50;2"><b>4.2.2. </b>&#x4F8B;&#x5B50;2</a></li></ul><li><span class="title-icon "></span><a href="#nil-error&#x4E0D;&#x662F;nil"><b>4.3. </b>nil error&#x4E0D;&#x662F;nil</a></li></ul><li><span class="title-icon "></span><a href="#map&#x7684;&#x5143;&#x7D20;&#x4E0D;&#x80FD;&#x53D6;&#x5730;&#x5740;"><b>5. </b>map&#x7684;&#x5143;&#x7D20;&#x4E0D;&#x80FD;&#x53D6;&#x5730;&#x5740;</a></li><li><span class="title-icon "></span><a href="#&#x5185;&#x7F6E;println"><b>6. </b>&#x5185;&#x7F6E;println</a></li><li><span class="title-icon "></span><a href="#&#x7A7A;&#x7ED3;&#x6784;&#x4F53;"><b>7. </b>&#x7A7A;&#x7ED3;&#x6784;&#x4F53;</a></li><li><span class="title-icon "></span><a href="#&#x8FED;&#x4EE3;&#x5668;&#x6837;&#x677F;"><b>8. </b>&#x8FED;&#x4EE3;&#x5668;&#x6837;&#x677F;</a></li><ul><li><span class="title-icon "></span><a href="#scanner&#x6837;&#x677F;"><b>8.1. </b>scanner&#x6837;&#x677F;</a></li><li><span class="title-icon "></span><a href="#range&#x6837;&#x677F;"><b>8.2. </b>range&#x6837;&#x677F;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5173;&#x4E8E;copy"><b>9. </b>&#x5173;&#x4E8E;copy</a></li><li><span class="title-icon "></span><a href="#&#x51FD;&#x6570;&#x7EA7;&#x5E76;&#x53D1;"><b>10. </b>&#x51FD;&#x6570;&#x7EA7;&#x5E76;&#x53D1;</a></li><ul><li><span class="title-icon "></span><a href="#&#x987A;&#x5E8F;&#x7248;&#x672C;"><b>10.1. </b>&#x987A;&#x5E8F;&#x7248;&#x672C;</a></li><li><span class="title-icon "></span><a href="#goroutine&#x5E76;&#x53D1;&#x7248;&#x672C;"><b>10.2. </b>goroutine&#x5E76;&#x53D1;&#x7248;&#x672C;</a></li></ul><li><span class="title-icon "></span><a href="#channel&#x7684;&#x5E7F;&#x64AD;"><b>11. </b>channel&#x7684;&#x5E7F;&#x64AD;</a></li><ul><li><span class="title-icon "></span><a href="#close&#x5E7F;&#x64AD;"><b>11.1. </b>close&#x5E7F;&#x64AD;</a></li><li><span class="title-icon "></span><a href="#&#x4EA4;&#x6362;&#x673A;&#x590D;&#x5236;&#x5F0F;&#x5E7F;&#x64AD;"><b>11.2. </b>&#x4EA4;&#x6362;&#x673A;&#x590D;&#x5236;&#x5F0F;&#x5E7F;&#x64AD;</a></li><li><span class="title-icon "></span><a href="#&#x6539;&#x8FDB;"><b>11.3. </b>&#x6539;&#x8FDB;</a></li><li><span class="title-icon "></span><a href="#&#x4EE3;&#x7801;&#x5FC3;&#x5F97;"><b>11.4. </b>&#x4EE3;&#x7801;&#x5FC3;&#x5F97;</a></li></ul><li><span class="title-icon "></span><a href="#&#x518D;&#x770B;testing"><b>12. </b>&#x518D;&#x770B;testing</a></li><ul><li><span class="title-icon "></span><a href="#&#x4F8B;&#x5B50;"><b>12.1. </b>&#x4F8B;&#x5B50;</a></li></ul><li><span class="title-icon "></span><a href="#&#x518D;&#x8BAE;reflect"><b>13. </b>&#x518D;&#x8BAE;reflect</a></li><ul><li><span class="title-icon "></span><a href="#&#x6253;&#x5370;&#x53D8;&#x91CF;&#x4FE1;&#x606F;"><b>13.1. </b>&#x6253;&#x5370;&#x53D8;&#x91CF;&#x4FE1;&#x606F;</a></li><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;"><b>13.2. </b>&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5305;&#x521D;&#x59CB;&#x5316;"><b>14. </b>&#x5305;&#x521D;&#x59CB;&#x5316;</a></li><li><span class="title-icon "></span><a href="#&#x518D;&#x8BF4;&#x5207;&#x7247;&#x548C;&#x6570;&#x7EC4;"><b>15. </b>&#x518D;&#x8BF4;&#x5207;&#x7247;&#x548C;&#x6570;&#x7EC4;</a></li><ul><li><span class="title-icon "></span><a href="#&#x6570;&#x7EC4;&#x662F;&#x503C;"><b>15.1. </b>&#x6570;&#x7EC4;&#x662F;&#x503C;</a></li><li><span class="title-icon "></span><a href="#go&#x7684;&#x6570;&#x7EC4;&#x8868;&#x8FBE;&#x548C;c&#x4E00;&#x6837;"><b>15.2. </b>GO&#x7684;&#x6570;&#x7EC4;&#x8868;&#x8FBE;&#x548C;C&#x4E00;&#x6837;</a></li><li><span class="title-icon "></span><a href="#&#x5207;&#x7247;"><b>15.3. </b>&#x5207;&#x7247;</a></li></ul><li><span class="title-icon "></span><a href="#&#x52A8;&#x6001;&#x94FE;&#x63A5;"><b>16. </b>&#x52A8;&#x6001;&#x94FE;&#x63A5;</a></li><ul><li><span class="title-icon "></span><a href="#&#x652F;&#x6301;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x7684;&#x5E73;&#x53F0;"><b>16.1. </b>&#x652F;&#x6301;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x7684;&#x5E73;&#x53F0;</a></li><li><span class="title-icon "></span><a href="#&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x652F;&#x6301;&#x7684;&#x67B6;&#x6784;"><b>16.2. </b>&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x652F;&#x6301;&#x7684;&#x67B6;&#x6784;</a></li></ul><li><span class="title-icon "></span><a href="#&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;go"><b>17. </b>&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;go</a></li><ul><li><span class="title-icon "></span><a href="#&#x652F;&#x6301;&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x7684;&#x5E73;&#x53F0;"><b>17.1. </b>&#x652F;&#x6301;&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x7684;&#x5E73;&#x53F0;</a></li></ul><li><span class="title-icon "></span><a href="#&#x4E00;&#x6B21;&#x8FD0;&#x884C;&#x65F6;&#x5F02;&#x5E38;&#x6253;&#x5370;"><b>18. </b>&#x4E00;&#x6B21;&#x8FD0;&#x884C;&#x65F6;&#x5F02;&#x5E38;&#x6253;&#x5370;</a></li><li><span class="title-icon "></span><a href="#goroutine&#x548C;&#x5171;&#x4EAB;&#x53D8;&#x91CF;"><b>19. </b>goroutine&#x548C;&#x5171;&#x4EAB;&#x53D8;&#x91CF;</a></li><ul><li><span class="title-icon "></span><a href="#&#x7406;&#x8BBA;"><b>19.1. </b>&#x7406;&#x8BBA;</a></li><li><span class="title-icon "></span><a href="#&#x5B9E;&#x8DF5;"><b>19.2. </b>&#x5B9E;&#x8DF5;</a></li></ul><li><span class="title-icon "></span><a href="#&#x8C03;&#x8BD5;&#x73AF;&#x5883;&#x53D8;&#x91CF;"><b>20. </b>&#x8C03;&#x8BD5;&#x73AF;&#x5883;&#x53D8;&#x91CF;</a></li><ul><li><span class="title-icon "></span><a href="#&#x4E3E;&#x4F8B;"><b>20.1. </b>&#x4E3E;&#x4F8B;</a></li><li><span class="title-icon "></span><a href="#godebug"><b>20.2. </b>GODEBUG</a></li><li><span class="title-icon "></span><a href="#gotraceback"><b>20.3. </b>GOTRACEBACK</a></li><li><span class="title-icon "></span><a href="#&#x540D;&#x5B57;&#x51B2;&#x7A81;&#x548C;type&#x522B;&#x540D;"><b>20.4. </b>&#x540D;&#x5B57;&#x51B2;&#x7A81;&#x548C;type&#x522B;&#x540D;</a></li><ul><li><span class="title-icon "></span><a href="#type&#x5B9A;&#x4E49;&#x65B0;&#x7C7B;&#x578B;"><b>20.4.1. </b>type&#x5B9A;&#x4E49;&#x65B0;&#x7C7B;&#x578B;</a></li><li><span class="title-icon "></span><a href="#type&#x522B;&#x540D;"><b>20.4.2. </b>type&#x522B;&#x540D;</a></li></ul></ul><li><span class="title-icon "></span><a href="#goroutine-vs-thread"><b>21. </b>goroutine vs thread</a></li><ul><li><span class="title-icon "></span><a href="#&#x9ED8;&#x8BA4;&#x7684;thread&#x6570;"><b>21.1. </b>&#x9ED8;&#x8BA4;&#x7684;thread&#x6570;</a></li><li><span class="title-icon "></span><a href="#goroutine&#x4ECB;&#x7ECD;"><b>21.2. </b>goroutine&#x4ECB;&#x7ECD;</a></li></ul><li><span class="title-icon "></span><a href="#json&#x548C;&#x4E07;&#x80FD;interface"><b>22. </b>json&#x548C;&#x4E07;&#x80FD;interface{}</a></li><ul><li><span class="title-icon "></span><a href="#&#x5DF2;&#x77E5;&#x7ED3;&#x6784;&#x4F53;"><b>22.1. </b>&#x5DF2;&#x77E5;&#x7ED3;&#x6784;&#x4F53;</a></li><li><span class="title-icon "></span><a href="#&#x4E0D;&#x77E5;&#x9053;&#x7ED3;&#x6784;&#x4F53;&#x60C5;&#x51B5;&#x4E0B;"><b>22.2. </b>&#x4E0D;&#x77E5;&#x9053;&#x7ED3;&#x6784;&#x4F53;&#x60C5;&#x51B5;&#x4E0B;</a></li><li><span class="title-icon "></span><a href="#encoder&#x548C;decoder"><b>22.3. </b>encoder&#x548C;decoder</a></li></ul></ul></div><a href="#&#x7EE7;&#x627F;-&#x533F;&#x540D;&#x5305;&#x542B;2" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><ul>
<li><a href="#&#x7EE7;&#x627F;-&#x533F;&#x540D;&#x5305;&#x542B;2">&#x7EE7;&#x627F;, &#x533F;&#x540D;&#x5305;&#x542B;2</a><ul>
<li><a href="#&#x5B9E;&#x4F8B;-statsconn">&#x5B9E;&#x4F8B; StatsConn</a></li>
<li><a href="#&#x603B;&#x7ED3;">&#x603B;&#x7ED3;</a></li>
</ul>
</li>
<li><a href="#&#x7EE7;&#x627F;-&#x533F;&#x540D;&#x5305;&#x542B;">&#x7EE7;&#x627F;, &#x533F;&#x540D;&#x5305;&#x542B;</a><ul>
<li><a href="#&#x603B;&#x7ED3;-1">&#x603B;&#x7ED3;</a></li>
</ul>
</li>
<li><a href="#interface&#x7684;&#x8D4B;&#x503C;">interface&#x7684;&#x8D4B;&#x503C;</a><ul>
<li><a href="#&#x7B2C;&#x4E00;&#x79CD;&#x60C5;&#x51B5;-&#x5982;&#x679C;&#x65B9;&#x6CD5;&#x7684;receiver&#x7C7B;&#x578B;&#x4E0D;&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;">&#x7B2C;&#x4E00;&#x79CD;&#x60C5;&#x51B5;: &#x5982;&#x679C;&#x65B9;&#x6CD5;&#x7684;receiver&#x7C7B;&#x578B;&#x4E0D;&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;</a></li>
<li><a href="#&#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;-&#x65B9;&#x6CD5;&#x7684;receiver&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x58F0;&#x660E;&#x7684;">&#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;: &#x65B9;&#x6CD5;&#x7684;receiver&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x58F0;&#x660E;&#x7684;</a></li>
<li><a href="#&#x603B;&#x7ED3;-2">&#x603B;&#x7ED3;</a></li>
</ul>
</li>
<li><a href="#go-faq">go FAQ</a><ul>
<li><a href="#go13&#x662F;c&#x5199;&#x7684;-&#x540E;&#x9762;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x662F;go&#x5199;&#x7684;-&#x5DE5;&#x5177;&#x81EA;&#x52A8;&#x628A;c&#x8F6C;&#x6210;go&#x7684;">go1.3&#x662F;c&#x5199;&#x7684;, &#x540E;&#x9762;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x662F;go&#x5199;&#x7684; &#x5DE5;&#x5177;&#x81EA;&#x52A8;&#x628A;C&#x8F6C;&#x6210;go&#x7684;</a></li>
<li><a href="#interface&#x7684;&#x7B7E;&#x540D;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x4E00;&#x6837;">interface&#x7684;&#x7B7E;&#x540D;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x4E00;&#x6837;</a><ul>
<li><a href="#&#x4F8B;&#x5B50;1">&#x4F8B;&#x5B50;1</a></li>
<li><a href="#&#x4F8B;&#x5B50;2">&#x4F8B;&#x5B50;2</a></li>
</ul>
</li>
<li><a href="#nil-error&#x4E0D;&#x662F;nil">nil error&#x4E0D;&#x662F;nil</a></li>
</ul>
</li>
<li><a href="#map&#x7684;&#x5143;&#x7D20;&#x4E0D;&#x80FD;&#x53D6;&#x5730;&#x5740;">map&#x7684;&#x5143;&#x7D20;&#x4E0D;&#x80FD;&#x53D6;&#x5730;&#x5740;</a></li>
<li><a href="#&#x5185;&#x7F6E;println">&#x5185;&#x7F6E;println</a></li>
<li><a href="#&#x7A7A;&#x7ED3;&#x6784;&#x4F53;">&#x7A7A;&#x7ED3;&#x6784;&#x4F53;</a></li>
<li><a href="#&#x8FED;&#x4EE3;&#x5668;&#x6837;&#x677F;">&#x8FED;&#x4EE3;&#x5668;&#x6837;&#x677F;</a><ul>
<li><a href="#scanner&#x6837;&#x677F;">scanner&#x6837;&#x677F;</a></li>
<li><a href="#range&#x6837;&#x677F;">range&#x6837;&#x677F;</a></li>
</ul>
</li>
<li><a href="#&#x5173;&#x4E8E;copy">&#x5173;&#x4E8E;copy</a></li>
<li><a href="#&#x51FD;&#x6570;&#x7EA7;&#x5E76;&#x53D1;">&#x51FD;&#x6570;&#x7EA7;&#x5E76;&#x53D1;</a><ul>
<li><a href="#&#x987A;&#x5E8F;&#x7248;&#x672C;">&#x987A;&#x5E8F;&#x7248;&#x672C;</a></li>
<li><a href="#goroutine&#x5E76;&#x53D1;&#x7248;&#x672C;">goroutine&#x5E76;&#x53D1;&#x7248;&#x672C;</a></li>
</ul>
</li>
<li><a href="#channel&#x7684;&#x5E7F;&#x64AD;">channel&#x7684;&#x5E7F;&#x64AD;</a><ul>
<li><a href="#close&#x5E7F;&#x64AD;">close&#x5E7F;&#x64AD;</a></li>
<li><a href="#&#x4EA4;&#x6362;&#x673A;&#x590D;&#x5236;&#x5F0F;&#x5E7F;&#x64AD;">&#x4EA4;&#x6362;&#x673A;&#x590D;&#x5236;&#x5F0F;&#x5E7F;&#x64AD;</a></li>
<li><a href="#&#x6539;&#x8FDB;">&#x6539;&#x8FDB;</a></li>
<li><a href="#&#x4EE3;&#x7801;&#x5FC3;&#x5F97;">&#x4EE3;&#x7801;&#x5FC3;&#x5F97;</a></li>
</ul>
</li>
<li><a href="#&#x518D;&#x770B;testing">&#x518D;&#x770B;testing</a><ul>
<li><a href="#&#x4F8B;&#x5B50;">&#x4F8B;&#x5B50;</a></li>
</ul>
</li>
<li><a href="#&#x518D;&#x8BAE;reflect">&#x518D;&#x8BAE;reflect</a><ul>
<li><a href="#&#x6253;&#x5370;&#x53D8;&#x91CF;&#x4FE1;&#x606F;">&#x6253;&#x5370;&#x53D8;&#x91CF;&#x4FE1;&#x606F;</a></li>
<li><a href="#&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;">&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;</a></li>
</ul>
</li>
<li><a href="#&#x5305;&#x521D;&#x59CB;&#x5316;">&#x5305;&#x521D;&#x59CB;&#x5316;</a></li>
<li><a href="#&#x518D;&#x8BF4;&#x5207;&#x7247;&#x548C;&#x6570;&#x7EC4;">&#x518D;&#x8BF4;&#x5207;&#x7247;&#x548C;&#x6570;&#x7EC4;</a><ul>
<li><a href="#&#x6570;&#x7EC4;&#x662F;&#x503C;">&#x6570;&#x7EC4;&#x662F;&#x503C;</a></li>
<li><a href="#go&#x7684;&#x6570;&#x7EC4;&#x8868;&#x8FBE;&#x548C;c&#x4E00;&#x6837;">GO&#x7684;&#x6570;&#x7EC4;&#x8868;&#x8FBE;&#x548C;C&#x4E00;&#x6837;</a></li>
<li><a href="#&#x5207;&#x7247;">&#x5207;&#x7247;</a></li>
</ul>
</li>
<li><a href="#&#x52A8;&#x6001;&#x94FE;&#x63A5;">&#x52A8;&#x6001;&#x94FE;&#x63A5;</a><ul>
<li><a href="#&#x652F;&#x6301;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x7684;&#x5E73;&#x53F0;">&#x652F;&#x6301;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x7684;&#x5E73;&#x53F0;</a></li>
<li><a href="#&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x652F;&#x6301;&#x7684;&#x67B6;&#x6784;">&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x652F;&#x6301;&#x7684;&#x67B6;&#x6784;</a></li>
</ul>
</li>
<li><a href="#&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;go">&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;go</a><ul>
<li><a href="#&#x652F;&#x6301;&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x7684;&#x5E73;&#x53F0;">&#x652F;&#x6301;&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x7684;&#x5E73;&#x53F0;</a></li>
</ul>
</li>
<li><a href="#&#x4E00;&#x6B21;&#x8FD0;&#x884C;&#x65F6;&#x5F02;&#x5E38;&#x6253;&#x5370;">&#x4E00;&#x6B21;&#x8FD0;&#x884C;&#x65F6;&#x5F02;&#x5E38;&#x6253;&#x5370;</a></li>
<li><a href="#goroutine&#x548C;&#x5171;&#x4EAB;&#x53D8;&#x91CF;">goroutine&#x548C;&#x5171;&#x4EAB;&#x53D8;&#x91CF;</a><ul>
<li><a href="#&#x7406;&#x8BBA;">&#x7406;&#x8BBA;</a></li>
<li><a href="#&#x5B9E;&#x8DF5;">&#x5B9E;&#x8DF5;</a></li>
</ul>
</li>
<li><a href="#&#x8C03;&#x8BD5;&#x73AF;&#x5883;&#x53D8;&#x91CF;">&#x8C03;&#x8BD5;&#x73AF;&#x5883;&#x53D8;&#x91CF;</a><ul>
<li><a href="#&#x4E3E;&#x4F8B;">&#x4E3E;&#x4F8B;</a></li>
<li><a href="#godebug">GODEBUG</a></li>
<li><a href="#gotraceback">GOTRACEBACK</a></li>
<li><a href="#&#x540D;&#x5B57;&#x51B2;&#x7A81;&#x548C;type&#x522B;&#x540D;">&#x540D;&#x5B57;&#x51B2;&#x7A81;&#x548C;type&#x522B;&#x540D;</a><ul>
<li><a href="#type&#x5B9A;&#x4E49;&#x65B0;&#x7C7B;&#x578B;">type&#x5B9A;&#x4E49;&#x65B0;&#x7C7B;&#x578B;</a></li>
<li><a href="#type&#x522B;&#x540D;">type&#x522B;&#x540D;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#goroutine-vs-thread">goroutine vs thread</a><ul>
<li><a href="#&#x9ED8;&#x8BA4;&#x7684;thread&#x6570;">&#x9ED8;&#x8BA4;&#x7684;thread&#x6570;</a></li>
<li><a href="#goroutine&#x4ECB;&#x7ECD;">goroutine&#x4ECB;&#x7ECD;</a></li>
</ul>
</li>
<li><a href="#json&#x548C;&#x4E07;&#x80FD;interface">json&#x548C;&#x4E07;&#x80FD;interface{}</a><ul>
<li><a href="#&#x5DF2;&#x77E5;&#x7ED3;&#x6784;&#x4F53;">&#x5DF2;&#x77E5;&#x7ED3;&#x6784;&#x4F53;</a></li>
<li><a href="#&#x4E0D;&#x77E5;&#x9053;&#x7ED3;&#x6784;&#x4F53;&#x60C5;&#x51B5;&#x4E0B;">&#x4E0D;&#x77E5;&#x9053;&#x7ED3;&#x6784;&#x4F53;&#x60C5;&#x51B5;&#x4E0B;</a></li>
<li><a href="#encoder&#x548C;decoder">encoder&#x548C;decoder</a></li>
</ul>
</li>
</ul>
<h1 id="&#x7EE7;&#x627F;-&#x533F;&#x540D;&#x5305;&#x542B;2"><a name="&#x7EE7;&#x627F;-&#x533F;&#x540D;&#x5305;&#x542B;2" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;-&#x533F;&#x540D;&#x5305;&#x542B;2"><i class="fa fa-link" aria-hidden="true"></i></a>1. &#x7EE7;&#x627F;, &#x533F;&#x540D;&#x5305;&#x542B;2</h1>
<p>&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;, &#x4E00;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x533F;&#x540D;&#x5305;&#x542B;&#x53E6;&#x4E00;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;, &#x5C31;&#x80FD;&#x7EE7;&#x627F;&#x5176;&#x65B9;&#x6CD5;.
&#x5176;&#x5B9E;, &#x533F;&#x540D;&#x5305;&#x542B;&#x4E00;&#x4E2A;interface, &#x4E5F;&#x80FD;&#x7EE7;&#x627F;.</p>
<p>&#x6BD4;&#x5982;:</p>
<pre class="language-"><code class="lang-go"><span class="token comment">//Fooer&#x662F;&#x4E2A;interface</span>
<span class="token keyword">type</span> Fooer <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">//Container&#x533F;&#x540D;&#x5305;&#x542B;&#x4E86;Fooer</span>
<span class="token keyword">type</span> Container <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Fooer
<span class="token punctuation">}</span>

<span class="token comment">// TheRealFoo is a type that implements the Fooer interface.</span>
<span class="token keyword">type</span> TheRealFoo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token comment">// TheRealFoo&#x771F;&#x6B63;&#x5B9E;&#x73B0;&#x4E86;Fooer</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>trf TheRealFoo<span class="token punctuation">)</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;TheRealFoo Foo&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">// sink takes a value implementing the Fooer interface.</span>
<span class="token keyword">func</span> <span class="token function">sink</span><span class="token punctuation">(</span>f Fooer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;sink:&quot;</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//shilhuaContainer&#x7684;&#x65F6;&#x5019;, &#x521D;&#x59CB;&#x5316;Fooer&#x57DF;</span>
co <span class="token operator">:=</span> Container<span class="token punctuation">{</span>Fooer<span class="token punctuation">:</span> TheRealFoo<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token comment">//&#x4E0B;&#x9762;&#x7533;&#x8BF7;&#x7684;&#x4E00;&#x5E55;&#x6765;&#x4E86;, co&#x4E5F;&#x662F;Fooer</span>
<span class="token comment">//co&#x56E0;&#x4E3A;&#x662F;Container&#x7684;&#x5B9E;&#x4F8B;, &#x540E;&#x8005;&#x533F;&#x540D;&#x5305;&#x542B;&#x4E86;Fooer(&#x5E95;&#x5C42;&#x5B9E;&#x73B0;&#x662F;TheRealFoo{})</span>
<span class="token function">sink</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span>

<span class="token comment">//&#x8F93;&#x51FA;:</span>
sink<span class="token punctuation">:</span> TheRealFoo Foo
</code></pre>
<p>&#x7531;&#x4EE5;&#x4E0A;&#x5F97;&#x77E5;, &#x533F;&#x540D;&#x5305;&#x542B;interface&#x7684;&#x6548;&#x679C;&#x548C;&#x533F;&#x540D;&#x5305;&#x542B;&#x7ED3;&#x6784;&#x4F53;&#x7C7B;&#x4F3C;, &#x4F46;interface&#x53D8;&#x91CF;&#x8981;&#x6B63;&#x786E;&#x7684;&#x521D;&#x59CB;&#x5316;.
&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6B63;&#x786E;&#x521D;&#x59CB;&#x5316;, &#x7F16;&#x8BD1;&#x662F;&#x80FD;&#x901A;&#x8FC7;&#x7684;, &#x4F46;&#x4F1A;&#x8FD0;&#x884C;&#x65F6;&#x9519;&#x8BEF;, &#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x9519;&#x8BEF;&#x5B9E;&#x4F8B;:</p>
<pre class="language-"><code class="lang-go">co <span class="token operator">:=</span> Container<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token function">sink</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span>
</code></pre>
<p>&#x4F1A;&#x6253;&#x5370;<code>runtime error: invalid memory address or nil pointer dereference</code></p>
<h2 id="&#x5B9E;&#x4F8B;-statsconn"><a name="&#x5B9E;&#x4F8B;-statsconn" class="anchor-navigation-ex-anchor" href="#&#x5B9E;&#x4F8B;-statsconn"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. &#x5B9E;&#x4F8B; StatsConn</h2>
<p>&#x8FD9;&#x91CC;&#x4F8B;&#x5B50;&#x91CC;, StatsConn&#x533F;&#x540D;&#x5305;&#x542B;&#x4E86;net.Conn, &#x4ECE;&#x800C;&#x7EE7;&#x627F;&#x4E86;net.Conn&#x7684;&#x6240;&#x6709;&#x51FD;&#x6570;, &#x4F46;&#x5B83;&#x91CD;&#x8F7D;&#x4E86;Read&#x65B9;&#x6CD5;, &#x76EE;&#x7684;&#x662F;&#x589E;&#x52A0;&#x5B57;&#x8282;&#x6570;&#x7EDF;&#x8BA1;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> StatsConn <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    net<span class="token punctuation">.</span>Conn <span class="token comment">//&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684;net.Conn&#x662F;&#x4E2A;interface</span>

    BytesRead <span class="token builtin">uint64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>sc <span class="token operator">*</span>StatsConn<span class="token punctuation">)</span> <span class="token function">Read</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    n<span class="token punctuation">,</span> err <span class="token operator">:=</span> sc<span class="token punctuation">.</span>Conn<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    sc<span class="token punctuation">.</span>BytesRead <span class="token operator">+=</span> <span class="token function">uint64</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
    <span class="token keyword">return</span> n<span class="token punctuation">,</span> err
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5B9E;&#x4F8B;&#x5316;StatsConn&#x7684;&#x65F6;&#x5019;, &#x7528;tcp&#x7684;net.Conn&#x5B9E;&#x4F8B;&#x6765;&#x521D;&#x59CB;&#x5316;.</p>
<pre class="language-"><code class="lang-go">conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span> u<span class="token punctuation">.</span>Host<span class="token operator">+</span><span class="token string">&quot;:80&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
sconn <span class="token operator">:=</span> <span class="token operator">&amp;</span>StatsConn<span class="token punctuation">{</span>conn<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span>
</code></pre>
<p>&#x4ECE;&#x6B64;&#x4EE5;&#x540E;, sconn&#x62E5;&#x6709;net.Conn&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027;, &#x6240;&#x6709;net.Conn&#x80FD;&#x7528;&#x7684;&#x5730;&#x65B9;, &#x90FD;&#x53EF;&#x4EE5;&#x7528;sconn, &#x6BD4;&#x5982;:</p>
<pre class="language-"><code class="lang-go">resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>sconn<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x603B;&#x7ED3;"><a name="&#x603B;&#x7ED3;" class="anchor-navigation-ex-anchor" href="#&#x603B;&#x7ED3;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. &#x603B;&#x7ED3;</h2>
<ul>
<li>&#x533F;&#x540D;&#x5305;&#x542B;interface&#x548C;&#x533F;&#x540D;&#x5305;&#x542B;struct&#x90FD;&#x80FD;&#x7EE7;&#x627F;</li>
<li>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x88AB;&#x5305;&#x542B;&#x7684;interface&#x57DF;&#x5E94;&#x8BE5;&#x6B63;&#x786E;&#x7684;&#x5B9E;&#x4F8B;&#x5316;</li>
</ul>
<p>&#x53C2;&#x8003;: <a href="https://eli.thegreenplace.net/2020/embedding-in-go-part-3-interfaces-in-structs/" target="_blank">https://eli.thegreenplace.net/2020/embedding-in-go-part-3-interfaces-in-structs/</a></p>
<h1 id="&#x7EE7;&#x627F;-&#x533F;&#x540D;&#x5305;&#x542B;"><a name="&#x7EE7;&#x627F;-&#x533F;&#x540D;&#x5305;&#x542B;" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;-&#x533F;&#x540D;&#x5305;&#x542B;"><i class="fa fa-link" aria-hidden="true"></i></a>2. &#x7EE7;&#x627F;, &#x533F;&#x540D;&#x5305;&#x542B;</h1>
<pre class="language-"><code class="lang-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token comment">/*
&#x7EE7;&#x627F;
&#x4E00;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x5D4C;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x79F0;&#x4F5C;&#x7EC4;&#x5408;
&#x533F;&#x540D;&#x548C;&#x7EC4;&#x5408;&#x7684;&#x533A;&#x522B;
&#x5982;&#x679C;&#x4E00;&#x4E2A;struct&#x5D4C;&#x5957;&#x4E86;&#x53E6;&#x4E00;&#x4E2A;&#x533F;&#x540D;&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x533F;&#x540D;&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x7EE7;&#x627F;
&#x5982;&#x679C;&#x4E00;&#x4E2A;struct&#x5D4C;&#x5957;&#x4E86;&#x53E6;&#x4E00;&#x4E2A;&#x3010;&#x6709;&#x540D;&#x3011;&#x7684;&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x6A21;&#x5F0F;&#x53EB;&#x505A;&#x7EC4;&#x5408;
&#x5982;&#x679C;&#x4E00;&#x4E2A;struct&#x5D4C;&#x5957;&#x4E86;&#x591A;&#x4E2A;&#x533F;&#x540D;&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x591A;&#x4E2A;&#x533F;&#x540D;&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x591A;&#x91CD;&#x7EE7;&#x627F;
*/</span>

<span class="token keyword">type</span> Car <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    weight <span class="token builtin">int</span>
    name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Car<span class="token punctuation">)</span> <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;running&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Bike <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Car <span class="token comment">//&#x6CE8;&#x610F;&#x8FD9;&#x91CC;, &#x867D;&#x7136;Car&#x7684;receiver&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;, &#x800C;&#x8FD9;&#x91CC;Car&#x505A;&#x4E3A;&quot;&#x503C;&quot;&#x88AB;&#x5305;&#x542B;, &#x4F46;&#x662F;Bike&#x4F9D;&#x7136;&#x7EE7;&#x627F;&#x4E86;Car&#x7684;&#x65B9;&#x6CD5;.</span>
    lunzi <span class="token builtin">int</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> Train <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Car
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Train<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    str <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;name=[%s] weight=[%d]&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>name<span class="token punctuation">,</span> p<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>
    <span class="token keyword">return</span> str
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> a Bike
    a<span class="token punctuation">.</span>weight <span class="token operator">=</span> <span class="token number">100</span>
    a<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;bike&quot;</span>
    a<span class="token punctuation">.</span>lunzi <span class="token operator">=</span> <span class="token number">2</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    a<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> b Train
    b<span class="token punctuation">.</span>weight <span class="token operator">=</span> <span class="token number">100</span>
    b<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;train&quot;</span>
    b<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x603B;&#x7ED3;_1"><a name="&#x603B;&#x7ED3;_1" class="anchor-navigation-ex-anchor" href="#&#x603B;&#x7ED3;_1"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. &#x603B;&#x7ED3;</h2>
<ul>
<li>&#x4E0D;&#x7BA1;&#x4E00;&#x4E2A;type&#x662F;&#x7528;receiver&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x7684;&#x65B9;&#x6CD5;, &#x8FD8;&#x662F;&#x503C;&#x65B9;&#x5F0F;. &#x6211;&#x4EEC;&#x90FD;&#x8BF4;&#x8FD9;&#x4E2A;type&#x5B9E;&#x73B0;&#x4E86;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;, &#x4ECE;&#x800C;&#x6EE1;&#x8DB3;&#x4E86;&#x67D0;&#x7C7B;interface&#x7684;&#x8981;&#x6C42;</li>
<li>&#x5BF9;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x7684;receiver&#x6765;&#x8BF4;, &#x53EA;&#x8981;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x662F;addressable&#x7684;, &#x7F16;&#x8BD1;&#x5668;&#x5C31;&#x4F1A;&#x81EA;&#x52A8;&#x53D6;&#x5730;&#x5740;. &#x6362;&#x4E2A;&#x8BF4;&#x6CD5;&#x662F;, &#x53EA;&#x8981;&#x8FD9;&#x4E2A;&quot;&#x503C;&quot;&#x5BF9;&#x8C61;, &#x5728;&#x4F20;&#x9012;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;(&#x6BD4;&#x5982;&#x8D4B;&#x503C;)&#x4E0D;&#x88AB;&#x8D4B;&#x503C;, &#x5BF9;&#x5176;&#x53D6;&#x5730;&#x5740;&#x4E0D;&#x4F1A;&#x53D6;&#x5230;&#x5176;&quot;&#x62F7;&#x8D1D;&#x5BF9;&#x8C61;&quot;&#x4E0A;&#x53BB;, &#x5C31;&#x53EF;&#x4EE5;&#x641E;.</li>
</ul>
<h1 id="interface&#x7684;&#x8D4B;&#x503C;"><a name="interface&#x7684;&#x8D4B;&#x503C;" class="anchor-navigation-ex-anchor" href="#interface&#x7684;&#x8D4B;&#x503C;"><i class="fa fa-link" aria-hidden="true"></i></a>3. interface&#x7684;&#x8D4B;&#x503C;</h1>
<p>&#x6BD4;&#x5982;&#x6700;&#x7B80;&#x5355;&#x7684;interface</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> Phone <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x53EA;&#x8981;&#x5B9E;&#x73B0;&#x4E86;call()&#x65B9;&#x6CD5;&#x7684;&#x7C7B;&#x578B;, &#x90FD;&#x53EF;&#x4EE5;&#x662F;Phone
&#x58F0;&#x660E;&#x4E00;&#x4E2A;Phone&#x7C7B;&#x578B;&#x7684;&#x53D8;&#x91CF;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">//&#x8FD9;&#x662F;interface&#x7C7B;&#x578B;&#x7684;&#x53D8;&#x91CF;</span>
<span class="token keyword">var</span> phone Phone
</code></pre>
<p>&#x5BF9;interface&#x7C7B;&#x578B;&#x7684;&#x53D8;&#x91CF;&#x8D4B;&#x503C;, &#x8981;&#x770B;&#x65B9;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;&#x60C5;&#x51B5;</p>
<h2 id="&#x7B2C;&#x4E00;&#x79CD;&#x60C5;&#x51B5;-&#x5982;&#x679C;&#x65B9;&#x6CD5;&#x7684;receiver&#x7C7B;&#x578B;&#x4E0D;&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;"><a name="&#x7B2C;&#x4E00;&#x79CD;&#x60C5;&#x51B5;-&#x5982;&#x679C;&#x65B9;&#x6CD5;&#x7684;receiver&#x7C7B;&#x578B;&#x4E0D;&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#&#x7B2C;&#x4E00;&#x79CD;&#x60C5;&#x51B5;-&#x5982;&#x679C;&#x65B9;&#x6CD5;&#x7684;receiver&#x7C7B;&#x578B;&#x4E0D;&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. &#x7B2C;&#x4E00;&#x79CD;&#x60C5;&#x51B5;: &#x5982;&#x679C;&#x65B9;&#x6CD5;&#x7684;receiver&#x7C7B;&#x578B;&#x4E0D;&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;</h2>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> NokiaPhone <span class="token keyword">struct</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>nokiaPhone NokiaPhone<span class="token punctuation">)</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;I am Nokia, I can call you!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x90A3;&#x4E48;&#x5BF9;phone&#x53D8;&#x91CF;&#x7684;&#x8D4B;&#x503C;, &#x5730;&#x5740;&#x548C;&#x503C;&#x90FD;&#x53EF;&#x4EE5;</p>
<pre class="language-"><code>    //new&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x6307;&#x9488;, &#x5E76;&#x5BF9;&#x5176;&#x5185;&#x5B58;&#x6E05;&#x96F6;;
    //&#x4EE5;&#x4E0B;&#x90FD;&#x5BF9;
    phone = new(NokiaPhone)
    phone = &amp;NokiaPhone{}
    phone = NokiaPhone{}

    phone.call()
</code></pre><p>&#x66F4;&#x8FDB;&#x4E00;&#x6B65;, &#x5176;&#x5B9E;&#x53D6;&#x4E0D;&#x53D6;&#x5F15;&#x7528;, &#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;. &#x4F46;&#x90FD;&#x80FD;&#x76F4;&#x63A5;&#x7528;<code>phone.call()</code>, &#x56E0;&#x4E3A;go&#x5BF9;&#x6307;&#x9488;&#x4E5F;&#x662F;&#x7528;&#x70B9;&#x65B9;&#x5F0F;&#x8C03;&#x7528;&#x5176;&#x65B9;&#x6CD5;.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//&#x8FD9;&#x662F;interface&#x7C7B;&#x578B;&#x7684;&#x53D8;&#x91CF;</span>
    <span class="token keyword">var</span> phone Phone

    <span class="token keyword">var</span> nokiaPhone NokiaPhone
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;addr: %p, value: %v, type: %T \n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>nokiaPhone<span class="token punctuation">,</span> nokiaPhone<span class="token punctuation">,</span> nokiaPhone<span class="token punctuation">)</span>

    phone <span class="token operator">=</span> <span class="token operator">&amp;</span>nokiaPhone
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\naddr: %p, value: %v, type: %T \n&quot;</span><span class="token punctuation">,</span> phone<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> phone<span class="token punctuation">)</span>
    phone<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    phone <span class="token operator">=</span> nokiaPhone
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\naddr: %p, value: %v, type: %T \n&quot;</span><span class="token punctuation">,</span> phone<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> phone<span class="token punctuation">)</span>
    phone<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//&#x8F93;&#x51FA;</span>
addr<span class="token punctuation">:</span> <span class="token number">0x1e529c</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">type</span><span class="token punctuation">:</span> main<span class="token punctuation">.</span>NokiaPhone 

addr<span class="token punctuation">:</span> <span class="token number">0x1e529c</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token operator">*</span>main<span class="token punctuation">.</span>NokiaPhone 
I am Nokia<span class="token punctuation">,</span> I can call you<span class="token operator">!</span>

addr<span class="token punctuation">:</span> <span class="token operator">%</span><span class="token operator">!</span><span class="token function">p</span><span class="token punctuation">(</span>main<span class="token punctuation">.</span>NokiaPhone<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">type</span><span class="token punctuation">:</span> main<span class="token punctuation">.</span>NokiaPhone 
I am Nokia<span class="token punctuation">,</span> I can call you<span class="token operator">!</span>
</code></pre>
<h2 id="&#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;-&#x65B9;&#x6CD5;&#x7684;receiver&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x58F0;&#x660E;&#x7684;"><a name="&#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;-&#x65B9;&#x6CD5;&#x7684;receiver&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x58F0;&#x660E;&#x7684;" class="anchor-navigation-ex-anchor" href="#&#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;-&#x65B9;&#x6CD5;&#x7684;receiver&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x58F0;&#x660E;&#x7684;"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. &#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;: &#x65B9;&#x6CD5;&#x7684;receiver&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x58F0;&#x660E;&#x7684;</h2>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> NokiaPhone <span class="token keyword">struct</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>nokiaPhone <span class="token operator">*</span>NokiaPhone<span class="token punctuation">)</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;I am Nokia, I can call you!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;, <code>phone = &amp;nokiaPhone</code>&#x662F;&#x5408;&#x6CD5;&#x7684;.
&#x800C;<code>phone = nokiaPhone</code>&#x4E0D;&#x884C;
&#x9519;&#x8BEF;&#x662F;: NokiaPhone &#x6CA1;&#x6709;&#x5B9E;&#x73B0;Phone&#x65B9;&#x6CD5;.</p>
<pre class="language-"><code>./prog.go:30:8: cannot use nokiaPhone (type NokiaPhone) as type Phone in assignment:
 NokiaPhone does not implement Phone (call method has pointer receiver)
</code></pre><p>&#x6CE8;&#x610F;, &#x867D;&#x7136;&#x5F53;receiver&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x65F6;, &#x4E0D;&#x80FD;<code>phone = nokiaPhone</code>, &#x4F46;&#x662F;&#x53EF;&#x4EE5;<code>nokiaPhone</code>&#x53EF;&#x4EE5;&#x8C03;&#x7528;call()&#x51FD;&#x6570;, &#x5373;&#x8FD9;&#x6837;&#x5199;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x95EE;&#x9898;:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> NokiaPhone <span class="token keyword">struct</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>nokiaPhone <span class="token operator">*</span>NokiaPhone<span class="token punctuation">)</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;I am Nokia, I can call you!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> nokiaPhone NokiaPhone
    <span class="token comment">//&#x5373;&#x4F7F;receiver&#x662F;&#x5F15;&#x7528;&#x65B9;&#x5F0F;, &#x4E5F;&#x80FD;&#x76F4;&#x63A5;&#x7528;&quot;&#x503C;&quot;&#x6765;&#x8C03;&#x7528;</span>
    nokiaPhone<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x4E0D;&#x662F;&#x8BF4;<code>NokiaPhone does not implement Phone (call method has pointer receiver)</code>&#x5417;? &#x600E;&#x4E48;&#x77DB;&#x76FE;&#x4E86;?
-- &#x4E0D;&#x77DB;&#x76FE;. &#x7F16;&#x8BD1;&#x5668;&#x505A;&#x4E86;&#x8BED;&#x6CD5;&#x7CD6;, &#x5B9E;&#x9645;&#x8C03;&#x7528;&#x7684;&#x662F;:</p>
<pre class="language-"><code class="lang-go"><span class="token punctuation">(</span><span class="token operator">&amp;</span>nokiaPhone<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x5728;call()&#x51FD;&#x6570;&#x770B;&#x6765;, receiver&#x8FD8;&#x662F;&#x5730;&#x5740;.</p>
<p>&#x90A3;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0A;&#x9762;&#x7684;interface&#x8D4B;&#x503C;<code>phone = nokiaPhone</code>&#x4E0D;&#x884C;&#x5462;?
-- &#x56E0;&#x4E3A;interface&#x8D4B;&#x503C;&#x4E5F;&#x662F;&#x503C;&#x62F7;&#x8D1D;. &#x5982;&#x679C;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x7684;&#x8BDD;, &#x540E;&#x9762;&#x5BF9;<code>phone.call()</code>&#x7684;&#x8C03;&#x7528;, &#x5B9E;&#x9645;&#x4E0A;&#x6700;&#x7EC8;&#x662F;<code>(&amp;&#x62F7;&#x8D1D;&#x540E;&#x7684;nokiaPhone).call()</code>, &#x5BF9;&#x62F7;&#x8D1D;&#x540E;&#x7684;&#x5BF9;&#x8C61;&#x53D6;&#x5730;&#x5740;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x610F;&#x4E49;, &#x6240;&#x4EE5;&#x7F16;&#x8BD1;&#x5668;&#x7981;&#x6B62;&#x8FD9;&#x6837;&#x641E;.</p>
<h2 id="&#x603B;&#x7ED3;_2"><a name="&#x603B;&#x7ED3;_2" class="anchor-navigation-ex-anchor" href="#&#x603B;&#x7ED3;_2"><i class="fa fa-link" aria-hidden="true"></i></a>3.3. &#x603B;&#x7ED3;</h2>
<ul>
<li>&#x65B9;&#x6CD5;&#x7684;receiver&#x662F;<code>pointer receiver</code>&#x7C7B;&#x578B;&#x65F6;, interface&#x53D8;&#x91CF;&#x53EA;&#x63A5;&#x53D7;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x8D4B;&#x503C;.</li>
<li>&#x65B9;&#x6CD5;&#x7684;receiver&#x662F;&#x975E;&#x6307;&#x9488;&#x65B9;&#x5F0F;, interface&#x53D8;&#x91CF;&#x7684;&#x8D4B;&#x503C;&#x65E2;&#x53EF;&#x4EE5;&#x662F;&#x503C;, &#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x5F15;&#x7528;.</li>
<li>&#x5373;&#x4F7F;&#x662F;receiver&#x65B9;&#x5F0F;, &quot;&#x503C;&quot;&#x5BF9;&#x8C61;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x5176;&#x65B9;&#x6CD5;.</li>
</ul>
<h1 id="go-faq"><a name="go-faq" class="anchor-navigation-ex-anchor" href="#go-faq"><i class="fa fa-link" aria-hidden="true"></i></a>4. go FAQ</h1>
<p><a href="https://golang.org/doc/faq" target="_blank">&#x5B98;&#x65B9;faq</a>
<a href="https://go101.org/article/unofficial-faq.html" target="_blank">101FAQ</a></p>
<h2 id="go13&#x662F;c&#x5199;&#x7684;-&#x540E;&#x9762;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x662F;go&#x5199;&#x7684;-&#x5DE5;&#x5177;&#x81EA;&#x52A8;&#x628A;c&#x8F6C;&#x6210;go&#x7684;"><a name="go13&#x662F;c&#x5199;&#x7684;-&#x540E;&#x9762;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x662F;go&#x5199;&#x7684;-&#x5DE5;&#x5177;&#x81EA;&#x52A8;&#x628A;c&#x8F6C;&#x6210;go&#x7684;" class="anchor-navigation-ex-anchor" href="#go13&#x662F;c&#x5199;&#x7684;-&#x540E;&#x9762;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x662F;go&#x5199;&#x7684;-&#x5DE5;&#x5177;&#x81EA;&#x52A8;&#x628A;c&#x8F6C;&#x6210;go&#x7684;"><i class="fa fa-link" aria-hidden="true"></i></a>4.1. go1.3&#x662F;c&#x5199;&#x7684;, &#x540E;&#x9762;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x662F;go&#x5199;&#x7684; &#x5DE5;&#x5177;&#x81EA;&#x52A8;&#x628A;C&#x8F6C;&#x6210;go&#x7684;</h2>
<p><a href="https://golang.org/doc/faq#What_compiler_technology_is_used_to_build_the_compilers" target="_blank">go&#x7F16;&#x8BD1;&#x5668;&#x5B9E;&#x73B0;&#x80CC;&#x666F;</a>
<a href="https://docs.google.com/document/d/1P3BLR31VA8cvLJLfMibSuTdwTuF7WWLux71CYD0eeD8/edit" target="_blank">&#x5DE5;&#x5177;&#x628A;gc&#x7F16;&#x8BD1;&#x5668;&#x4ECE;C&#x8F6C;&#x6210;go</a></p>
<h2 id="interface&#x7684;&#x7B7E;&#x540D;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x4E00;&#x6837;"><a name="interface&#x7684;&#x7B7E;&#x540D;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x4E00;&#x6837;" class="anchor-navigation-ex-anchor" href="#interface&#x7684;&#x7B7E;&#x540D;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x4E00;&#x6837;"><i class="fa fa-link" aria-hidden="true"></i></a>4.2. interface&#x7684;&#x7B7E;&#x540D;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x4E00;&#x6837;</h2>
<h3 id="&#x4F8B;&#x5B50;1"><a name="&#x4F8B;&#x5B50;1" class="anchor-navigation-ex-anchor" href="#&#x4F8B;&#x5B50;1"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.1. &#x4F8B;&#x5B50;1</h3>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> Equaler <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Equal</span><span class="token punctuation">(</span>Equaler<span class="token punctuation">)</span> <span class="token builtin">bool</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> T <span class="token builtin">int</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>t T<span class="token punctuation">)</span> <span class="token function">Equal</span><span class="token punctuation">(</span>u T<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> t <span class="token operator">==</span> u <span class="token punctuation">}</span> <span class="token comment">// does not satisfy Equaler</span>

<span class="token keyword">type</span> T2 <span class="token builtin">int</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>t T2<span class="token punctuation">)</span> <span class="token function">Equal</span><span class="token punctuation">(</span>u Equaler<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> t <span class="token operator">==</span> u<span class="token punctuation">.</span><span class="token punctuation">(</span>T2<span class="token punctuation">)</span> <span class="token punctuation">}</span>  <span class="token comment">// satisfies Equaler</span>
</code></pre>
<h3 id="&#x4F8B;&#x5B50;2"><a name="&#x4F8B;&#x5B50;2" class="anchor-navigation-ex-anchor" href="#&#x4F8B;&#x5B50;2"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.2. &#x4F8B;&#x5B50;2</h3>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> Opener <span class="token keyword">interface</span> <span class="token punctuation">{</span>
   <span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Reader
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>t T3<span class="token punctuation">)</span> <span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>os<span class="token punctuation">.</span>File <span class="token comment">//T3 does not satisfy Opener</span>
</code></pre>
<h2 id="nil-error&#x4E0D;&#x662F;nil"><a name="nil-error&#x4E0D;&#x662F;nil" class="anchor-navigation-ex-anchor" href="#nil-error&#x4E0D;&#x662F;nil"><i class="fa fa-link" aria-hidden="true"></i></a>4.3. nil error&#x4E0D;&#x662F;nil</h2>
<p>error&#x662F;&#x4E2A;interface{}, &#x800C;interface{}&#x662F;{&#x7C7B;&#x578B; &#x503C;}&#x7684;&#x8868;&#x8FBE;, &#x4E24;&#x4E2A;&#x90FD;&#x662F;nil&#x7684;&#x65F6;&#x5019;, interface&#x624D;&#x662F;nil</p>
<pre class="language-"><code class="lang-go"><span class="token comment">//&#x8FD9;&#x91CC;return&#x7684;error&#x6C38;&#x8FDC;&#x4E0D;&#x662F;nil, &#x56E0;&#x4E3A;&#x5176;&#x7C7B;&#x578B;&#x662F;*MyError</span>
<span class="token keyword">func</span> <span class="token function">returnsError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> p <span class="token operator">*</span>MyError <span class="token operator">=</span> <span class="token boolean">nil</span>
    <span class="token keyword">if</span> <span class="token function">bad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        p <span class="token operator">=</span> ErrBad
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> p <span class="token comment">// Will always return a non-nil error.</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="map&#x7684;&#x5143;&#x7D20;&#x4E0D;&#x80FD;&#x53D6;&#x5730;&#x5740;"><a name="map&#x7684;&#x5143;&#x7D20;&#x4E0D;&#x80FD;&#x53D6;&#x5730;&#x5740;" class="anchor-navigation-ex-anchor" href="#map&#x7684;&#x5143;&#x7D20;&#x4E0D;&#x80FD;&#x53D6;&#x5730;&#x5740;"><i class="fa fa-link" aria-hidden="true"></i></a>5. map&#x7684;&#x5143;&#x7D20;&#x4E0D;&#x80FD;&#x53D6;&#x5730;&#x5740;</h1>
<p>&#x56E0;&#x4E3A;map&#x662F;hash&#x8868;, &#x968F;&#x7740;map&#x5927;&#x5C0F;&#x7684;&#x52A8;&#x6001;&#x589E;&#x51CF;, &#x91CC;&#x9762;&#x7684;&#x5143;&#x7D20;&#x53EF;&#x80FD;&#x4F1A;&#x91CD;&#x65B0;&#x7B97;hash, &#x6539;&#x53D8;&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;, &#x90A3;&#x5730;&#x5740;&#x5C31;&#x53D8;&#x4E86;.</p>
<blockquote>
<p>In Go, a map is designed as a container which can contain unlimited number of entries if memory is available. And, in the official Go runtime implementation, to ensure good map element indexing efficiency, each map value only maintains one continuous memory segment for the entire entries stored in that map. Therefor, Go runtime needs to allocate larger memory segments for a map from time to time when there are more and more entries being put into the map. In the process, the entries stored on older memory segments will be moved to newer memory segments. There might be also some other reasons caausing entry memory movements. In other words, the addresses of map elements will change from time to time on need. If map elements are allowed to be taken addresses, then when some map entries are moved, Go runtime must update all pointers which are storing the addresses of the moved elements, which brings many difficulties in implemnting Go compilers and runtimes and decreases Go program running performance much. So, currently, map elements are disallowed to be taken addresses.</p>
</blockquote>
<h1 id="&#x5185;&#x7F6E;println"><a name="&#x5185;&#x7F6E;println" class="anchor-navigation-ex-anchor" href="#&#x5185;&#x7F6E;println"><i class="fa fa-link" aria-hidden="true"></i></a>6. &#x5185;&#x7F6E;println</h1>
<p>&#x5185;&#x7F6E;&#x7684;println&#x662F;debug&#x65F6;&#x5019;&#x7528;&#x7684;, &#x8F93;&#x51FA;&#x5230;stderr
&#x53E6;&#x5916;, println&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;&#x53D8;&#x91CF;&#x9003;&#x9038;</p>
<blockquote>
<p>Currently (Go Toolchain 1.15), for the standard Go compiler, calls to the built-in <code>print</code>/<code>println</code> functions will not make the values referenced by the arguments of the calls escape to heap, whereas the print functions in the <code>fmt</code> and <code>log</code> standard packages will.</p>
</blockquote>
<p>&#x53C2;&#x8003;: <a href="https://go101.org/article/unofficial-faq.html#print-builtin-fmt-log" target="_blank">print-builtin-fmt-log</a></p>
<h1 id="&#x7A7A;&#x7ED3;&#x6784;&#x4F53;"><a name="&#x7A7A;&#x7ED3;&#x6784;&#x4F53;" class="anchor-navigation-ex-anchor" href="#&#x7A7A;&#x7ED3;&#x6784;&#x4F53;"><i class="fa fa-link" aria-hidden="true"></i></a>7. &#x7A7A;&#x7ED3;&#x6784;&#x4F53;</h1>
<p>&#x4E00;&#x822C;&#x6765;&#x8BF4;, &#x7A7A;&#x7ED3;&#x6784;&#x4F53;<code>struct{}</code>&#x662F;0&#x5B57;&#x8282;&#x5927;&#x5C0F;&#x7684;. &#x4F46;&#x653E;&#x5728;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x6700;&#x540E;, &#x7F16;&#x8BD1;&#x5668;&#x4F1A;pad&#x4E00;&#x4E9B;&#x5B57;&#x8282;.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> T1 <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        a <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
        x <span class="token builtin">int64</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>T1<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 8</span>

    <span class="token keyword">type</span> T2 <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        x <span class="token builtin">int64</span>
        a <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>T2<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 16</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x89E3;&#x91CA;&#x662F;: &#x4E00;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x5982;&#x679C;&#x53EF;&#x4EE5;&#x53D6;&#x5730;&#x5740;, &#x90A3;&#x91CC;&#x9762;&#x7684;&#x6BCF;&#x4E2A;field&#x90FD;&#x5E94;&#x8BE5;&#x80FD;&#x88AB;&#x53D6;&#x5730;&#x5740;. &#x800C;&#x5982;&#x679C;T2&#x4E0D;pad8&#x4E2A;&#x5B57;&#x8282;, &#x90A3;&#x5BF9;T2&#x7684;a&#x53D6;&#x5730;&#x5740;&#x5C31;&#x662F;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x7684;&#x5730;&#x5740;&#x4E86;, &#x5C31;&#x8D85;&#x8FC7;&#x4E86;T2&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x8303;&#x56F4;&#x4E86;.
&#x6240;&#x4EE5;&#x540E;&#x9762;&#x8981;&#x52A0;8&#x5B57;&#x8282;. &#x800C;T1&#x4E0D;&#x4F1A;&#x6709;&#x8FD9;&#x4E2A;&#x8D8A;&#x7ED3;&#x6784;&#x4F53;&#x95EE;&#x9898;.
&#x53C2;&#x8003;: <a href="https://go101.org/article/unofficial-faq.html#final-zero-size-field" target="_blank">&#x7A7A;&#x7ED3;&#x6784;&#x4F53;&#x5728;&#x6700;&#x540E;</a></p>
<h1 id="&#x8FED;&#x4EE3;&#x5668;&#x6837;&#x677F;"><a name="&#x8FED;&#x4EE3;&#x5668;&#x6837;&#x677F;" class="anchor-navigation-ex-anchor" href="#&#x8FED;&#x4EE3;&#x5668;&#x6837;&#x677F;"><i class="fa fa-link" aria-hidden="true"></i></a>8. &#x8FED;&#x4EE3;&#x5668;&#x6837;&#x677F;</h1>
<h2 id="scanner&#x6837;&#x677F;"><a name="scanner&#x6837;&#x677F;" class="anchor-navigation-ex-anchor" href="#scanner&#x6837;&#x677F;"><i class="fa fa-link" aria-hidden="true"></i></a>8.1. scanner&#x6837;&#x677F;</h2>
<p>bufio&#x7684;scanner&#x662F;&#x4E2A;&#x5F88;&#x597D;&#x7684;&#x8FED;&#x4EE3;&#x5668;&#x6837;&#x677F;. 
&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4F7F;&#x7528;scanner&#x626B;&#x63CF;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;, &#x6BD4;&#x5BF9;&#x6BCF;&#x4E00;&#x884C;, &#x5982;&#x679C;&#x4E0D;&#x662F;msg&#x5C31;&#x5224;&#x5B9A;&#x9519;&#x8BEF;.</p>
<pre class="language-"><code class="lang-go">    file <span class="token operator">:=</span> <span class="token string">&quot;test/testc.log&quot;</span>
    f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    scanner <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewScanner</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">var</span> i <span class="token builtin">int</span>
    pos <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span><span class="token string">&quot;[2020/08/09 14:47:41.769979][testfile][INFO] &quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> scanner<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> scanner<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>pos<span class="token punctuation">:</span>pos<span class="token operator">+</span><span class="token function">len</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">!=</span> msg <span class="token punctuation">{</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> err <span class="token operator">:=</span> scanner<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> i <span class="token operator">!=</span> routineNum<span class="token operator">*</span>lineNum <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Unexpected line number: got %d, expect %d&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> routineNum<span class="token operator">*</span>lineNum<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>&#x5173;&#x4E8E;scanner&#x8FED;&#x4EE3;&#x5668;:</p>
<ul>
<li>scanner.Scan()&#x8FD4;&#x56DE;bool, &#x5229;&#x4E8E;for&#x5224;&#x65AD;, &#x4E3A;true&#x7EE7;&#x7EED;, &#x4E3A;false&#x5219;&#x9000;&#x51FA;for</li>
<li>scanner&#x672C;&#x8EAB;&#x662F;&#x4E2A;NewScanner()&#x51FA;&#x6765;&#x7684;&#x5BF9;&#x8C61;, &#x5728;for&#x5FAA;&#x73AF;&#x91CC;scanner.xxx()&#x6765;&#x53CD;&#x5E94;&#x672C;&#x6B21;&#x8FED;&#x4EE3;&#x7684;&#x66F4;&#x65B0;&#x7684;&#x5185;&#x5BB9;</li>
<li>for&#x5FAA;&#x73AF;&#x9000;&#x51FA;, &#x5224;&#x65AD;scanner.Err()&#x5C31;&#x80FD;&#x77E5;&#x9053;&#x662F;&#x5F02;&#x5E38;&#x7EC8;&#x6B62;&#x8FD8;&#x662F;for&#x5FAA;&#x73AF;&#x81EA;&#x7136;&#x7ED3;&#x675F;.</li>
</ul>
<h2 id="range&#x6837;&#x677F;"><a name="range&#x6837;&#x677F;" class="anchor-navigation-ex-anchor" href="#range&#x6837;&#x677F;"><i class="fa fa-link" aria-hidden="true"></i></a>8.2. range&#x6837;&#x677F;</h2>
<p>&#x5BF9;&#x4E8E;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49;&#x7684;&#x7ED3;&#x6784;&#x4F53;, &#x4E0D;&#x80FD;&#x7528;&#x5185;&#x7F6E;&#x7684;range&#x5173;&#x952E;&#x8BCD;&#x6765;&#x8FED;&#x4EE3;; &#x4F46;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x6A21;&#x62DF;&#x4E00;&#x4E2A;, &#x6BD4;&#x5982;sync/map&#x5305;, &#x63D0;&#x4F9B;&#x4E86;&#x5BF9;map&#x7684;&#x540C;&#x6B65;&#x8BBF;&#x95EE;API</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> Map
    <span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Map<span class="token punctuation">)</span> <span class="token function">Delete</span><span class="token punctuation">(</span>key <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Map<span class="token punctuation">)</span> <span class="token function">Load</span><span class="token punctuation">(</span>key <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>value <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> ok <span class="token builtin">bool</span><span class="token punctuation">)</span>
    <span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Map<span class="token punctuation">)</span> <span class="token function">LoadAndDelete</span><span class="token punctuation">(</span>key <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>value <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> loaded <span class="token builtin">bool</span><span class="token punctuation">)</span>
    <span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Map<span class="token punctuation">)</span> <span class="token function">LoadOrStore</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>actual <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> loaded <span class="token builtin">bool</span><span class="token punctuation">)</span>
    <span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Map<span class="token punctuation">)</span> <span class="token function">Range</span><span class="token punctuation">(</span>f <span class="token keyword">func</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span>
    <span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Map<span class="token punctuation">)</span> <span class="token function">Store</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x8FD9;&#x91CC;&#x7684;Range()&#x51FD;&#x6570;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x8FED;&#x4EE3;&#x5668;. &#x5B83;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x51FD;&#x6570;f, f&#x8FD4;&#x56DE;false&#x5219;&#x505C;&#x6B62;&#x8FED;&#x4EE3;.</p>
<h1 id="&#x5173;&#x4E8E;copy"><a name="&#x5173;&#x4E8E;copy" class="anchor-navigation-ex-anchor" href="#&#x5173;&#x4E8E;copy"><i class="fa fa-link" aria-hidden="true"></i></a>9. &#x5173;&#x4E8E;copy</h1>
<p>&#x6BD4;&#x5982;&#x5BF9;&#x4E00;&#x4E2A;slice&#x505A;copy, &#x8FD9;&#x6837;&#x7684;&#x4EE3;&#x7801;&#x80FD;work</p>
<pre class="language-"><code class="lang-go"><span class="token function">copy</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> l<span class="token punctuation">[</span>i<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x4E3A;&#x4E86;&#x628A;&#x4F4D;&#x7F6E;<code>i</code>&#x540E;&#x9762;&#x7684;&#x5143;&#x7D20;&#x90FD;&#x632A;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;, &#x4EE3;&#x4EF7;&#x662F;&#x628A;&#x8FD9;&#x540E;&#x9762;&#x7684;&#x6240;&#x6709;&#x5143;&#x7D20;&#x90FD;copy&#x4E00;&#x904D;
&#x8FD9;&#x91CC;&#x7684;copy&#x5B9E;&#x9645;&#x4E0A;&#x662F;overlap&#x7684;, copy&#x7684;&#x65F6;&#x5019;, &#x6E90;&#x4E3A;<code>l[i:]</code>, &#x76EE;&#x7684;&#x662F;<code>l[i+1:]</code>, &#x76EE;&#x7684;&#x6BD4;&#x6E90;&#x5411;&#x540E;&#x79FB;&#x52A8;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;, &#x800C;&#x4E14;&#x76EE;&#x7684;&#x7684;&#x5143;&#x7D20;&#x4E2A;&#x6570;&#x4E5F;&#x5C11;&#x4E86;&#x4E00;&#x4E2A;.</p>
<p>golang&#x7684;copy&#x5141;&#x8BB8;overlap</p>
<pre class="language-"><code class="lang-go">$ <span class="token keyword">go</span> doc builtin<span class="token punctuation">.</span><span class="token builtin">copy</span>
<span class="token keyword">package</span> builtin <span class="token comment">// import &quot;builtin&quot;</span>

<span class="token keyword">func</span> <span class="token function">copy</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> src <span class="token punctuation">[</span><span class="token punctuation">]</span>Type<span class="token punctuation">)</span> <span class="token builtin">int</span>
    The <span class="token builtin">copy</span> built<span class="token operator">-</span>in function copies elements from a source slice into a
    destination slice<span class="token punctuation">.</span> <span class="token punctuation">(</span>As a special <span class="token keyword">case</span><span class="token punctuation">,</span> it also will <span class="token builtin">copy</span> bytes from a <span class="token builtin">string</span>
    to a slice of bytes<span class="token punctuation">.</span><span class="token punctuation">)</span> The source and destination may overlap<span class="token punctuation">.</span> Copy returns
    the number of elements copied<span class="token punctuation">,</span> which will be the minimum of <span class="token function">len</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span> and
    <span class="token function">len</span><span class="token punctuation">(</span>dst<span class="token punctuation">)</span><span class="token punctuation">.</span>
</code></pre>
<p>&#x6CE8;&#x610F;, &#x5982;&#x679C;&#x6309;&#x7167;&#x666E;&#x901A;&#x7684;for&#x5FAA;&#x73AF;&#x5F0F;&#x7684;copy&#x601D;&#x8DEF;, src&#x548C;dst&#x91CD;&#x53E0;&#x65F6;&#x4E0D;&#x80FD;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x7684;.
&#x6709;&#x4EBA;&#x8BA8;&#x8BBA;&#x8BF4;<a href="https://github.com/golang/go/issues/4142" target="_blank">golang&#x7684;copy&#x8BED;&#x4E49;&#x7C7B;&#x4F3C;memmove</a></p>
<ul>
<li>memcpy: &#x5F53;src&#x548C;dst&#x91CD;&#x53E0;&#x65F6;, &#x7ED3;&#x679C;&#x4E0D;&#x786E;&#x5B9A;</li>
<li>memmove: src&#x548C;dst&#x53EF;&#x4EE5;&#x91CD;&#x53E0;, &#x7ED3;&#x679C;&#x662F;&#x6B63;&#x786E;&#x7684;&#x62F7;&#x8D1D;; &#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x6210;&#x6709;&#x4E2A;&#x4E34;&#x65F6;&#x7F13;&#x51B2;&#x505A;&#x4E2D;&#x8F6C;. &#x5B9E;&#x9645;&#x4E0A;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x4E2D;&#x95F4;buffer, <a href="https://vgable.com/blog/2008/05/24/memcopy-memmove-and-speed-over-safety/#:~:text=The%20difference%20between%20memcpy%20and,It%20might%20work.&amp;text=memcpy%20can%20be%20faster%2C%20and%20usually%20is." target="_blank">&#x53EA;&#x9700;&#x8981;&#x5728;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#x5224;&#x65AD;&#x662F;&#x4ECE;&#x524D;&#x5F80;&#x540E;&#x62F7;&#x8D1D;&#x8FD8;&#x662F;&#x4ECE;&#x540E;&#x5F80;&#x524D;&#x62F7;&#x8D1D;&#x5C31;&#x884C;&#x4E86;.</a></li>
<li>&#x7ED3;&#x8BBA;: golang&#x7684;copy&#x652F;&#x6301;overlap, &#x53EF;&#x4EE5;&#x6B63;&#x786E;&#x7684;&#x62F7;&#x8D1D;</li>
</ul>
<p>&#x4E3E;&#x4F8B;:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    l <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">}</span>
    l <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token function">copy</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> l<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

&#x8F93;&#x51FA;<span class="token punctuation">:</span>
<span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span> <span class="token number">8</span> <span class="token number">9</span><span class="token punctuation">]</span>
&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4ECE;i<span class="token operator">=</span><span class="token number">4</span>&#x5F00;&#x59CB;<span class="token punctuation">,</span> &#x6574;&#x4E2A;slice&#x5411;&#x53F3;&#x5E73;&#x79FB;&#x4E86;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;<span class="token punctuation">,</span> &#x662F;&#x7B26;&#x5408;&#x9884;&#x671F;&#x7684;<span class="token punctuation">.</span>
</code></pre>
<h1 id="&#x51FD;&#x6570;&#x7EA7;&#x5E76;&#x53D1;"><a name="&#x51FD;&#x6570;&#x7EA7;&#x5E76;&#x53D1;" class="anchor-navigation-ex-anchor" href="#&#x51FD;&#x6570;&#x7EA7;&#x5E76;&#x53D1;"><i class="fa fa-link" aria-hidden="true"></i></a>10. &#x51FD;&#x6570;&#x7EA7;&#x5E76;&#x53D1;</h1>
<h2 id="&#x987A;&#x5E8F;&#x7248;&#x672C;"><a name="&#x987A;&#x5E8F;&#x7248;&#x672C;" class="anchor-navigation-ex-anchor" href="#&#x987A;&#x5E8F;&#x7248;&#x672C;"><i class="fa fa-link" aria-hidden="true"></i></a>10.1. &#x987A;&#x5E8F;&#x7248;&#x672C;</h2>
<pre class="language-"><code class="lang-go">piMap <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token operator">*</span>pidinfo<span class="token punctuation">.</span>PidInfo<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>tgtPids<span class="token punctuation">)</span><span class="token punctuation">)</span>
    collect <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> pid <span class="token operator">:=</span> <span class="token keyword">range</span> tgtPids <span class="token punctuation">{</span>
            pi <span class="token operator">:=</span> piMap<span class="token punctuation">[</span>pid<span class="token punctuation">]</span>
            <span class="token keyword">if</span> pi <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> err <span class="token operator">:=</span> pi<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                    <span class="token comment">//fmt.Printf(&quot;main: %v\n&quot;, err)</span>
                    piMap<span class="token punctuation">[</span>pid<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">nil</span>
                    <span class="token keyword">continue</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>piMap&#x662F;&#x4E2A;&#x5168;&#x5C40;&#x7684;map.
&#x73B0;&#x5728;&#x60F3;&#x628A;&#x7B2C;6&#x884C;<code>pi.Update()</code>routine&#x5316;&#x8C03;&#x7528;, &#x8FBE;&#x5230;&#x5E76;&#x53D1;&#x6267;&#x884C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x6548;&#x679C;.
&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;:</p>
<ol>
<li>piMap&#x5168;&#x5C40;map&#x7684;&#x4FEE;&#x6539;&#x4E0D;&#x662F;&#x5E76;&#x53D1;&#x5B89;&#x5168;&#x7684;</li>
<li>&#x4E3B;&#x7A0B;&#x5E8F;&#x600E;&#x4E48;&#x7B49;&#x5F85;&#x591A;&#x4E2A;pi.Update()&#x5B8C;&#x6210;</li>
</ol>
<p>&#x53C2;&#x8003;&#x4E0B;&#x9762;&#x7684;&#x5E76;&#x53D1;&#x5316;&#x5B9E;&#x73B0;</p>
<h2 id="goroutine&#x5E76;&#x53D1;&#x7248;&#x672C;"><a name="goroutine&#x5E76;&#x53D1;&#x7248;&#x672C;" class="anchor-navigation-ex-anchor" href="#goroutine&#x5E76;&#x53D1;&#x7248;&#x672C;"><i class="fa fa-link" aria-hidden="true"></i></a>10.2. goroutine&#x5E76;&#x53D1;&#x7248;&#x672C;</h2>
<ol>
<li>&#x4F7F;&#x7528;unbuffered channel&#x4F20;&#x9012;&#x7ED3;&#x679C;</li>
<li>&#x4F7F;&#x7528;&#x8BA1;&#x6570;&#x5668;&#x63A7;&#x5236;&#x7B49;&#x5F85;&#x6B21;&#x6570;</li>
<li>&#x7A0B;&#x5E8F;&#x7684;&#x6548;&#x679C;&#x662F;&#x7B2C;10&#x884C;&#x7684;for&#x4EE3;&#x7801;&#x5757;&#x53EF;&#x4EE5;&#x5E76;&#x53D1;&#x6267;&#x884C;, &#x7B2C;22&#x884C;&#x7684;for&#x4EE3;&#x7801;&#x5757;&#x7B49;&#x5F85;&#x4E0A;&#x9762;&#x7684;routine&#x6267;&#x884C;&#x5B8C;</li>
<li>&#x5E76;&#x53D1;&#x7684;&#x7248;&#x672C;&#x6BD4;&#x987A;&#x5E8F;&#x7248;&#x672C;&#x4EE3;&#x7801;&#x903B;&#x8F91;&#x66F4;&#x590D;&#x6742;&#x70B9;, goroutine&#x7684;&#x521B;&#x5EFA; &#x8C03;&#x5EA6;&#x548C;channel&#x7684;&#x540C;&#x6B65;&#x90FD;&#x6709;&#x5F00;&#x9500;, &#x4F46;&#x5982;&#x679C;&#x5E76;&#x53D1;&#x7684;&#x6536;&#x76CA;&#x5F88;&#x5927;&#x7684;&#x5316;&#x8FD8;&#x662F;&#x503C;&#x5F97;&#x7684;.</li>
</ol>
<pre class="language-"><code class="lang-go">piMap <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token operator">*</span>pidinfo<span class="token punctuation">.</span>PidInfo<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>tgtPids<span class="token punctuation">)</span><span class="token punctuation">)</span>
collect <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//&#x53EF;&#x4EE5;&#x5728;&#x51FD;&#x6570;&#x5185;&#x90E8;type&#x5B9A;&#x4E49;&#x7C7B;&#x578B;</span>
    <span class="token keyword">type</span> result <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        pid <span class="token builtin">int</span>
        err <span class="token builtin">error</span>
    <span class="token punctuation">}</span>

    resultCh <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> result<span class="token punctuation">)</span>
    <span class="token comment">//&#x8BA1;&#x6570;&#x5668;, &#x8BB0;&#x5F55;go&#x4E86;&#x591A;&#x5C11;&#x6B21;</span>
    cnt <span class="token operator">:=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> pid <span class="token operator">:=</span> <span class="token keyword">range</span> tgtPids <span class="token punctuation">{</span>
        pid <span class="token operator">:=</span> pid
        pi <span class="token operator">:=</span> piMap<span class="token punctuation">[</span>pid<span class="token punctuation">]</span>
        <span class="token keyword">if</span> pi <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            cnt<span class="token operator">++</span>
            <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                err <span class="token operator">:=</span> pi<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">//&#x7ED3;&#x679C;&#x5199;&#x56DE;channel</span>
                resultCh <span class="token operator">&lt;-</span> result<span class="token punctuation">{</span>pid<span class="token punctuation">,</span> err<span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x6BCF;go&#x4E00;&#x6B21;, &#x5C31;&#x4F1A;&#x6709;&#x4E00;&#x6B21;&#x7ED3;&#x679C;</span>
    <span class="token comment">//&#x963B;&#x585E;&#x7B49;&#x5F85;&#x6BCF;&#x6B21;&#x7ED3;&#x679C;</span>
    <span class="token keyword">for</span> cnt <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        <span class="token comment">//&#x963B;&#x585E;&#x8BFB;</span>
        r <span class="token operator">:=</span> <span class="token operator">&lt;-</span>resultCh
        <span class="token keyword">if</span> r<span class="token punctuation">.</span>err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            piMap<span class="token punctuation">[</span>r<span class="token punctuation">.</span>pid<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">nil</span>
        <span class="token punctuation">}</span>
        cnt<span class="token operator">--</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="channel&#x7684;&#x5E7F;&#x64AD;"><a name="channel&#x7684;&#x5E7F;&#x64AD;" class="anchor-navigation-ex-anchor" href="#channel&#x7684;&#x5E7F;&#x64AD;"><i class="fa fa-link" aria-hidden="true"></i></a>11. channel&#x7684;&#x5E7F;&#x64AD;</h1>
<h2 id="close&#x5E7F;&#x64AD;"><a name="close&#x5E7F;&#x64AD;" class="anchor-navigation-ex-anchor" href="#close&#x5E7F;&#x64AD;"><i class="fa fa-link" aria-hidden="true"></i></a>11.1. close&#x5E7F;&#x64AD;</h2>
<p>close()&#x4E00;&#x4E2A;channel, &#x6240;&#x6709;read&#x8FD9;&#x4E2A;channel&#x7684;routine&#x90FD;&#x4F1A;&#x88AB;&#x5524;&#x9192;. &#x6CE8;&#x610F;, &#x5BF9;&#x540C;&#x4E00;&#x4E2A;channel&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x4F1A;&#x6709;&#x52A0;&#x9501;&#x64CD;&#x4F5C;, &#x56E0;&#x800C;&#x5728;&#x591A;&#x6838;&#x73AF;&#x5883;&#x4E0B;, &#x9501;&#x7ADE;&#x4E89;&#x7684;&#x5F00;&#x9500;&#x4F1A;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x5927;.
&#x9664;&#x4E86;&#x8FD9;&#x4E2A;&#x9501;&#x7684;&#x7F3A;&#x70B9;, close()&#x5E7F;&#x64AD;&#x7684;&#x5B9E;&#x73B0;&#x7684;&#x597D;&#x5904;&#x662F;&#x6BD4;&#x8F83;&#x7B80;&#x6D01;.</p>
<pre class="language-"><code class="lang-go"><span class="token comment">//&#x4EE3;&#x7801;&#x7247;&#x6BB5;, &quot;&#x76D1;&#x542C;&quot;&#x7684;goroutine</span>
<span class="token comment">//&#x8FD9;&#x6837;&#x7684;goroutine&#x53EF;&#x4EE5;&#x6709;&#x5F88;&#x591A;</span>
<span class="token comment">//goroutine n</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        <span class="token comment">//update from rootCheck pointer</span>
        <span class="token comment">//ti.rootCheck&#x662F;&#x4E2A;&#x6307;&#x5411;channel&#x7684;&#x6307;&#x9488;</span>
        <span class="token comment">//&#x5173;&#x952E;&#x662F;&#x7528;&#x4E34;&#x65F6;&#x53D8;&#x91CF;&#x4FDD;&#x5B58;&#x8FD9;&#x4E2A;channel&#x7684;&#x4E00;&#x4E2A;&#x62F7;&#x8D1D;</span>
        check <span class="token operator">:=</span> <span class="token operator">*</span>ti<span class="token punctuation">.</span>rootCheck
        <span class="token keyword">select</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token operator">&lt;-</span>check<span class="token punctuation">:</span>
            err <span class="token operator">:=</span> <span class="token function">doWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            ti<span class="token punctuation">.</span>rootWg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x521D;&#x59CB;&#x5316;goroutine&#x65F6;</span>
    <span class="token comment">//ti.rootCheck&#x6765;&#x81EA;&#x540C;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x7684;&#x8D4B;&#x503C;: </span>
    ti<span class="token punctuation">.</span>rootCheck <span class="token operator">=</span> pi<span class="token punctuation">.</span>rootCheck

    <span class="token comment">//&#x800C;pi.rootCheck&#x6700;&#x5F00;&#x59CB;&#x6307;&#x5411;&#x4E00;&#x4E2A;channel</span>
    check <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
    pi<span class="token punctuation">.</span>rootCheck <span class="token operator">=</span> <span class="token operator">&amp;</span>check


<span class="token comment">//&#x4E0B;&#x9762;&#x662F;&#x5173;&#x952E;&#x7684;trigger</span>
<span class="token comment">//trigger&#x7684;&#x5173;&#x952E;&#x662F;&#x5148;&quot;&#x539F;&#x5730;&quot;&#x53E6;&#x5EFA;&#x4E00;&#x4E2A;channel</span>
<span class="token comment">//&#x7136;&#x540E;close()&#x539F;channel</span>
<span class="token comment">//&#x8FD9;&#x4E2A;close()&#x4F1A;&quot;&#x5E7F;&#x64AD;&quot;&#x5230;&#x4E0A;&#x9762;&#x7B2C;9&#x884C;</span>
<span class="token comment">//&#x8FD9;&#x4E2A;select&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;, &#x7B2C;8&#x884C;check&#x4F1A;&#x65B0;&#x5F97;&#x5230;&#x66F4;&#x65B0;&#x540E;&#x7684;channel&#x7684;&#x4E00;&#x4EFD;&#x62F7;&#x8D1D;</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>pi <span class="token operator">*</span>PidInfo<span class="token punctuation">)</span> <span class="token function">triggerStatUpdateAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pi<span class="token punctuation">.</span>rootWg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span><span class="token operator">*</span>pi<span class="token punctuation">.</span>rootCounter<span class="token punctuation">)</span><span class="token punctuation">)</span>
    check <span class="token operator">:=</span> <span class="token operator">*</span>pi<span class="token punctuation">.</span>rootCheck
    <span class="token comment">//must make a new channel first</span>
    <span class="token operator">*</span>pi<span class="token punctuation">.</span>rootCheck <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
    <span class="token comment">//then close the old one, broadcasting</span>
    <span class="token function">close</span><span class="token punctuation">(</span>check<span class="token punctuation">)</span>
    <span class="token comment">//will the above 2 code lines run out of order?</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x4EA4;&#x6362;&#x673A;&#x590D;&#x5236;&#x5F0F;&#x5E7F;&#x64AD;"><a name="&#x4EA4;&#x6362;&#x673A;&#x590D;&#x5236;&#x5F0F;&#x5E7F;&#x64AD;" class="anchor-navigation-ex-anchor" href="#&#x4EA4;&#x6362;&#x673A;&#x590D;&#x5236;&#x5F0F;&#x5E7F;&#x64AD;"><i class="fa fa-link" aria-hidden="true"></i></a>11.2. &#x4EA4;&#x6362;&#x673A;&#x590D;&#x5236;&#x5F0F;&#x5E7F;&#x64AD;</h2>
<p>&#x5982;&#x4F55;&#x8BA9;channel&#x505A;&#x5230;1&#x5BF9;&#x591A;&#x7684;&#x5E7F;&#x64AD;? &#x6211;&#x4EEC;&#x77E5;&#x9053;close&#x4E00;&#x4E2A;channel, &#x90A3;&#x4E48;&#x5B83;&#x7684;&#x6240;&#x6709;reader&#x90FD;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x96F6;&#x503C;, &#x8FD9;&#x5C31;&#x662F;&#x5E7F;&#x64AD;.</p>
<p>&#x8FD8;&#x6709;&#x522B;&#x7684;&#x65B9;&#x6CD5;&#x5417;? &#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4F7F;&#x7528;&#x8BA2;&#x9605;&#x6A21;&#x5F0F;&#x6A21;&#x4EFF;&#x4E86;&#x5E7F;&#x64AD;&#x7684;api.
&#x8BE6;&#x89C1;:<a href="https://stackoverflow.com/questions/36417199/how-to-broadcast-message-using-channel" target="_blank">stackoverflow</a>
<a href="https://github.com/go-x-pkg/hub/blob/master/hub.go" target="_blank">github</a></p>
<p>A more elegant solution is a &quot;broker&quot;, where clients may subscribe and unsubscibe to messages.</p>
<p>To also handle subscribing and unsubscribing elegantly, we may utilize channels for this, so the main loop of the broker which receives and distributes the messages can incorporate all these using a single <code>select</code> statement, and synchronization is given from the solution&apos;s nature.</p>
<p>Another trick is to store the subscribers in a map, mapping from the channel we use to distribute messages to them. So use the channel as the key in the map, and then adding and removing the clients is &quot;dead&quot; simple. This is made possible because channel values are <a href="https://golang.org/ref/spec#Comparison_operators" target="_blank">comparable</a>, and their comparison is very efficient as channel values are simple pointers to channel descriptors.</p>
<p>Without further ado, here&apos;s a simple broker implementation:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> Broker <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    stopCh    <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    publishCh <span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    subCh     <span class="token keyword">chan</span> <span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    unsubCh   <span class="token keyword">chan</span> <span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewBroker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Broker <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>Broker<span class="token punctuation">{</span>
        stopCh<span class="token punctuation">:</span>    <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        publishCh<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        subCh<span class="token punctuation">:</span>     <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        unsubCh<span class="token punctuation">:</span>   <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Broker<span class="token punctuation">)</span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    subs <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        <span class="token keyword">select</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token operator">&lt;-</span>b<span class="token punctuation">.</span>stopCh<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        <span class="token keyword">case</span> msgCh <span class="token operator">:=</span> <span class="token operator">&lt;-</span>b<span class="token punctuation">.</span>subCh<span class="token punctuation">:</span>
            subs<span class="token punctuation">[</span>msgCh<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">case</span> msgCh <span class="token operator">:=</span> <span class="token operator">&lt;-</span>b<span class="token punctuation">.</span>unsubCh<span class="token punctuation">:</span>
            <span class="token function">delete</span><span class="token punctuation">(</span>subs<span class="token punctuation">,</span> msgCh<span class="token punctuation">)</span>
        <span class="token keyword">case</span> msg <span class="token operator">:=</span> <span class="token operator">&lt;-</span>b<span class="token punctuation">.</span>publishCh<span class="token punctuation">:</span>
            <span class="token keyword">for</span> msgCh <span class="token operator">:=</span> <span class="token keyword">range</span> subs <span class="token punctuation">{</span>
                <span class="token comment">// msgCh is buffered, use non-blocking send to protect the broker:</span>
                <span class="token keyword">select</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> msgCh <span class="token operator">&lt;-</span> msg<span class="token punctuation">:</span>
                <span class="token keyword">default</span><span class="token punctuation">:</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Broker<span class="token punctuation">)</span> <span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">close</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>stopCh<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Broker<span class="token punctuation">)</span> <span class="token function">Subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
    msgCh <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
    b<span class="token punctuation">.</span>subCh <span class="token operator">&lt;-</span> msgCh
    <span class="token keyword">return</span> msgCh
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Broker<span class="token punctuation">)</span> <span class="token function">Unsubscribe</span><span class="token punctuation">(</span>msgCh <span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    b<span class="token punctuation">.</span>unsubCh <span class="token operator">&lt;-</span> msgCh
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Broker<span class="token punctuation">)</span> <span class="token function">Publish</span><span class="token punctuation">(</span>msg <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    b<span class="token punctuation">.</span>publishCh <span class="token operator">&lt;-</span> msg
<span class="token punctuation">}</span>
</code></pre>
<p>Example using it:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Create and start a broker:</span>
    b <span class="token operator">:=</span> <span class="token function">NewBroker</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">go</span> b<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Create and subscribe 3 clients:</span>
    clientFunc <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        msgCh <span class="token operator">:=</span> b<span class="token punctuation">.</span><span class="token function">Subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Client %d got message: %v\n&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token operator">&lt;-</span>msgCh<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        <span class="token keyword">go</span> <span class="token function">clientFunc</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Start publishing messages:</span>
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> msgId <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> msgId<span class="token operator">++</span> <span class="token punctuation">{</span>
            b<span class="token punctuation">.</span><span class="token function">Publish</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;msg#%d&quot;</span><span class="token punctuation">,</span> msgId<span class="token punctuation">)</span><span class="token punctuation">)</span>
            time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">300</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Millisecond<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Output of the above will be</p>
<pre class="language-"><code>Client 2 got message: msg#0
Client 0 got message: msg#0
Client 1 got message: msg#0
Client 2 got message: msg#1
Client 0 got message: msg#1
Client 1 got message: msg#1
Client 1 got message: msg#2
Client 2 got message: msg#2
Client 0 got message: msg#2
Client 2 got message: msg#3
Client 0 got message: msg#3
Client 1 got message: msg#3
</code></pre><h2 id="&#x6539;&#x8FDB;"><a name="&#x6539;&#x8FDB;" class="anchor-navigation-ex-anchor" href="#&#x6539;&#x8FDB;"><i class="fa fa-link" aria-hidden="true"></i></a>11.3. &#x6539;&#x8FDB;</h2>
<p>You may consider the following improvements. These may or may not be useful depending on how / to what you use the broker.</p>
<p><code>Broker.Unsubscribe()</code> may close the message channel, signalling that no more messages will be sent on it:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Broker<span class="token punctuation">)</span> <span class="token function">Unsubscribe</span><span class="token punctuation">(</span>msgCh <span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    b<span class="token punctuation">.</span>unsubCh <span class="token operator">&lt;-</span> msgCh
    <span class="token function">close</span><span class="token punctuation">(</span>msgCh<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This would allow clients to <code>range</code> over the message channel, like this:</p>
<pre class="language-"><code class="lang-go">msgCh <span class="token operator">:=</span> b<span class="token punctuation">.</span><span class="token function">Subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> msg <span class="token operator">:=</span> <span class="token keyword">range</span> msgCh <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Client %d got message: %v\n&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Then if someone unsubscribes this <code>msgCh</code> like this:</p>
<pre class="language-"><code class="lang-go">b<span class="token punctuation">.</span><span class="token function">Unsubscribe</span><span class="token punctuation">(</span>msgCh<span class="token punctuation">)</span>
</code></pre>
<p>The above range loop will terminate after processing all messages that were sent before the call to <code>Unsubscribe()</code>.</p>
<p>If you want your clients to rely on the message channel being closed, and the broker&apos;s lifetime is narrower than your app&apos;s lifetime, then you could also close all subscribed clients when the broker is stopped, in the <code>Start()</code> method like this:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">case</span> <span class="token operator">&lt;-</span>b<span class="token punctuation">.</span>stopCh<span class="token punctuation">:</span>
    <span class="token keyword">for</span> msgCh <span class="token operator">:=</span> <span class="token keyword">range</span> subs <span class="token punctuation">{</span>
        <span class="token function">close</span><span class="token punctuation">(</span>msgCh<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span>
</code></pre>
<h2 id="&#x4EE3;&#x7801;&#x5FC3;&#x5F97;"><a name="&#x4EE3;&#x7801;&#x5FC3;&#x5F97;" class="anchor-navigation-ex-anchor" href="#&#x4EE3;&#x7801;&#x5FC3;&#x5F97;"><i class="fa fa-link" aria-hidden="true"></i></a>11.4. &#x4EE3;&#x7801;&#x5FC3;&#x5F97;</h2>
<ul>
<li><code>go b.Start()</code>&#x8D77;&#x4E86;&#x5355;&#x72EC;&#x7684;routine&#x6765;&#x7EF4;&#x62A4;b(&#x5373;&#x4E2D;&#x8F6C;&#x7EBF;&#x7A0B;), &#x4E3B;&#x8981;&#x662F;subscribe&#x548C;unsubscribe&#x7684;map&#x7EF4;&#x62A4;, &#x548C;msg&#x7684;&#x5206;&#x53D1;; &#x7528;&#x5355;&#x72EC;&#x7684;goroutine&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x9501;.</li>
<li>&#x8BA2;&#x9605;&#x548C;&#x53D6;&#x6D88;&#x8BA2;&#x9605;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5BF9;&#x5185;&#x90E8;map&#x7684;&#x6DFB;&#x52A0;&#x548C;&#x5220;&#x9664;key, <code>subs[msgCh]  =  struct{}{}</code>&#x548C;<code>delete(subs, msgCh)</code>. &#x8FD9;&#x91CC;&#x628A;&#x65B0;make&#x7684;channel&#x5F53;&#x4F5C;map&#x7684;key, &#x56E0;&#x4E3A;channel&#x662F;&#x53EF;&#x6BD4;&#x8F83;&#x7684;, &#x800C;&#x4E14;&#x6BD4;&#x8F83;&#x6548;&#x7387;&#x9AD8;.&#x5173;&#x952E;&#x662F;&#x63D2;&#x5165;&#x548C;&#x5220;&#x9664;key&#x975E;&#x5E38;&#x7B80;&#x5355;.</li>
<li>&#x4E2D;&#x8F6C;&#x7EBF;&#x7A0B;&#x662F;&#x5173;&#x952E;, &#x7C7B;&#x4F3C;&#x4E2A;&#x4EA4;&#x6362;&#x673A;; &#x4E3A;&#x4E86;&#x907F;&#x514D;&#x5728;select&#x91CC;&#x9762;&#x7B49;&#x5F85;, msg&#x90FD;&#x662F;bufferred&#x6A21;&#x5F0F;.&#x800C;&#x4E14;&#x5199;&#x90FD;&#x5E26;default, &#x662F;&#x975E;&#x963B;&#x585E;&#x7684;.</li>
</ul>
<h1 id="&#x518D;&#x770B;testing"><a name="&#x518D;&#x770B;testing" class="anchor-navigation-ex-anchor" href="#&#x518D;&#x770B;testing"><i class="fa fa-link" aria-hidden="true"></i></a>12. &#x518D;&#x770B;testing</h1>
<p>&#x683C;&#x5F0F;<code>go test [build/test flags] [packages] [build/test flags &amp; test binary flags]</code></p>
<ul>
<li>&#x5E2E;&#x52A9;&#x6587;&#x6863;<code>go help test</code>&#x548C;<code>go doc testing</code></li>
<li>testdata&#x76EE;&#x5F55;&#x4F1A;&#x88AB;go tool&#x5FFD;&#x7565;, &#x7559;&#x7ED9;&#x6D4B;&#x8BD5;case&#x4F7F;&#x7528;</li>
<li>&#x6D4B;&#x8BD5;case&#x7684;&#x8F93;&#x51FA;&#x5168;&#x90E8;&#x8D70;stdout, &#x5373;&#x4F7F;case&#x91CC;&#x8F93;&#x51FA;&#x5230;stderr; stderr&#x662F;&#x7559;&#x7ED9;testing&#x6846;&#x67B6;&#x7528;&#x7684;</li>
<li>&#x9ED8;&#x8BA4;&#x8DD1;test, &#x4F46;&#x4E0D;&#x8DD1;benchamrk</li>
<li>go test&#x9664;&#x4E86;&#x652F;&#x6301;&#x5168;&#x90E8;go build&#x53C2;&#x6570;&#x5916;, &#x8FD8;&#x652F;&#x6301;</li>
</ul>
<pre class="language-"><code>#&#x57FA;&#x7840;&#x9009;&#x9879;
-args &#x4F20;&#x4E2A;&#x6D4B;&#x8BD5;case&#x7684;
-c &#x53EA;&#x7F16;&#x8BD1;&#x4E0D;&#x8FD0;&#x884C;, &#x751F;&#x6210;pkg.test
-exec xprog &#x7528;&#x5916;&#x90E8;&#x7A0B;&#x5E8F;xprog&#x6765;&#x8FD0;&#x884C;test&#x4E8C;&#x8FDB;&#x5236;
-i &#x53EA;&#x5B89;&#x88C5;&#x4E0D;&#x8FD0;&#x884C;
-o &#x8F93;&#x51FA;test&#x4E8C;&#x8FDB;&#x5236;

#&#x6D4B;&#x8BD5;&#x8FC7;&#x7A0B;&#x63A7;&#x5236;
-bench regexp &#x8FD0;&#x884C;&#x6B63;&#x5219;&#x5339;&#x914D;&#x5230;&#x7684;benchmark; -bench .&#x9664;&#x4E86;&#x4F1A;&#x8FD0;&#x884C;test&#x9879;, &#x8FD8;&#x4F1A;&#x8FD0;&#x884C;&#x6240;&#x6709;benchmark&#x9879;
-run regexp &#x53EA;&#x8FD0;&#x884C;&#x6B63;&#x5219;&#x7684;case, &#x53EA;&#x5339;&#x914D;test&#x9879;&#x548C;example&#x9879;: 
-benchtime t &#x9ED8;&#x8BA4;&#x662F;1s, &#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x5176;&#x4ED6;&#x7684;time.Duration&#x6BD4;&#x5982;1h30s
-count n &#x91CD;&#x590D;&#x6267;&#x884C;&#x6240;&#x6709;case n&#x6B21;
-cover &#x4F7F;&#x80FD;coverage &#x5206;&#x6790;
-cpu 1,2,4 &#x6307;&#x5B9A;CPU&#x5217;&#x8868;
-parallel n &#x5BF9;&#x8C03;&#x7528;t.Parallel&#x7684;case, &#x6307;&#x5B9A;&#x5E76;&#x53D1;&#x4E3A;n; &#x9ED8;&#x8BA4;&#x4E3A;GOMAXPROCS
-short &#x51CF;&#x5C0F;&#x6D4B;&#x8BD5;&#x65F6;&#x95F4;, &#x81EA;&#x5DF1;&#x5728;case&#x91CC;&#x5224;&#x65AD;&#x662F;&#x5426;if testing.Short()
-timeout d &#x9ED8;&#x8BA4;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x662F;10m, &#x53EF;&#x4EE5;&#x6539;
-list regexp &#x5217;&#x51FA;&#x6B63;&#x5219;&#x5339;&#x914D;&#x7684;&#x9879;

#profiling&#x76F8;&#x5173;
-benchmem: &#x6253;&#x5370;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x60C5;&#x51B5;
-blockprofile block.out: &#x6253;&#x5370;goroutine&#x7684;&#x963B;&#x585E;&#x60C5;&#x51B5;
-coverprofile cover.out: &#x6253;&#x5370;coverage 
-memprofile mem.out: mem profile
-cpuprofile cpu.out: cpu profile
-trace trace.out: &#x8F93;&#x51FA;trace profile

# &#x547D;&#x4EE4;&#x4E3E;&#x4F8B;
//&#x4E0D;&#x8DD1;test&#x9879;, &#x8DD1;&#x6240;&#x6709;&#x7684;benchmark&#x9879;:
go test -run &#x4EFB;&#x610F;&#x5339;&#x914D;&#x4E0D;&#x5230;&#x7684;&#x6B63;&#x5219; -bench . -benchtime 10s
</code></pre><h2 id="&#x4F8B;&#x5B50;"><a name="&#x4F8B;&#x5B50;" class="anchor-navigation-ex-anchor" href="#&#x4F8B;&#x5B50;"><i class="fa fa-link" aria-hidden="true"></i></a>12.1. &#x4F8B;&#x5B50;</h2>
<pre class="language-"><code class="lang-go">    <span class="token keyword">func</span> <span class="token function">TestAbs</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        got <span class="token operator">:=</span> <span class="token function">Abs</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> got <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">{</span>
            t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Abs(-1) = %d; want 1&quot;</span><span class="token punctuation">,</span> got<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">func</span> <span class="token function">BenchmarkHello</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x51C6;&#x5907;&#x65F6;&#x95F4;&#x592A;&#x957F;&#x65F6;, &#x53EF;&#x4EE5;&#x91CD;&#x7F6E;&#x65F6;&#x95F4;</span>
    <span class="token keyword">func</span> <span class="token function">BenchmarkBigLen</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        big <span class="token operator">:=</span> <span class="token function">NewBig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        b<span class="token punctuation">.</span><span class="token function">ResetTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
            big<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x9ED8;&#x8BA4;benchmakr&#x662F;&#x4E32;&#x884C;&#x6267;&#x884C;&#x7684;, b.RunParallel&#x53EF;&#x4EE5;&#x5E76;&#x53D1;</span>
    <span class="token keyword">func</span> <span class="token function">BenchmarkTemplateParallel</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        templ <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">Must</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, {{.}}!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        b<span class="token punctuation">.</span><span class="token function">RunParallel</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>pb <span class="token operator">*</span>testing<span class="token punctuation">.</span>PB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> buf bytes<span class="token punctuation">.</span>Buffer
            <span class="token keyword">for</span> pb<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                buf<span class="token punctuation">.</span><span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                templ<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//Example&#x6253;&#x5934;&#x7684;&#x51FD;&#x6570;, &#x7528;// Output&#x6765;&#x6307;&#x660E;&#x5E94;&#x8BE5;&#x6709;&#x7684;&#x8F93;&#x51FA;, &#x6846;&#x67B6;&#x4F1A;&#x81EA;&#x52A8;&#x6BD4;&#x8F83;</span>
    <span class="token keyword">func</span> <span class="token function">ExampleHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">// Output: hello</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">func</span> <span class="token function">ExampleSalutations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;hello, and&quot;</span><span class="token punctuation">)</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;goodbye&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">// Output:</span>
        <span class="token comment">// hello, and</span>
        <span class="token comment">// goodbye</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x8DF3;&#x8FC7;&#x65F6;&#x95F4;&#x592A;&#x4E45;&#x7684;</span>
    <span class="token keyword">func</span> <span class="token function">TestTimeConsuming</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> testing<span class="token punctuation">.</span><span class="token function">Short</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            t<span class="token punctuation">.</span><span class="token function">Skip</span><span class="token punctuation">(</span><span class="token string">&quot;skipping test in short mode.&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x5355;&#x72EC;run&#x5B50;&#x9879;</span>
    <span class="token keyword">func</span> <span class="token function">TestFoo</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// &lt;setup code&gt;</span>
        t<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">&quot;A=1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        t<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">&quot;A=2&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        t<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">&quot;B=1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// &lt;tear-down code&gt;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">go</span> test <span class="token operator">-</span>run <span class="token char">&apos;&apos;</span>      # Run all tests<span class="token punctuation">.</span>
    <span class="token keyword">go</span> test <span class="token operator">-</span>run Foo     # Run top<span class="token operator">-</span>level tests matching <span class="token string">&quot;Foo&quot;</span><span class="token punctuation">,</span> such as <span class="token string">&quot;TestFooBar&quot;</span><span class="token punctuation">.</span>
    <span class="token keyword">go</span> test <span class="token operator">-</span>run Foo<span class="token operator">/</span>A<span class="token operator">=</span>  # For top<span class="token operator">-</span>level tests matching <span class="token string">&quot;Foo&quot;</span><span class="token punctuation">,</span> run subtests matching <span class="token string">&quot;A=&quot;</span><span class="token punctuation">.</span>
    <span class="token keyword">go</span> test <span class="token operator">-</span>run <span class="token operator">/</span>A<span class="token operator">=</span><span class="token number">1</span>    # For all top<span class="token operator">-</span>level tests<span class="token punctuation">,</span> run subtests matching <span class="token string">&quot;A=1&quot;</span><span class="token punctuation">.</span>

    <span class="token comment">// &#x7528;TestMain&#x6765;&#x63A5;&#x7BA1;test&#x6267;&#x884C;, &#x5FC5;&#x987B;&#x5148;&#x505A;&#x4E00;&#x4E9B;&#x590D;&#x6742;&#x7684;&#x521D;&#x59CB;&#x5316;; &#x7136;&#x540E;&#x8C03;&#x7528;m.Run</span>
    <span class="token keyword">func</span> <span class="token function">TestMain</span><span class="token punctuation">(</span>m <span class="token operator">*</span>testing<span class="token punctuation">.</span>M<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// call flag.Parse() here if TestMain uses flags</span>
        os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre>
<h1 id="&#x518D;&#x8BAE;reflect"><a name="&#x518D;&#x8BAE;reflect" class="anchor-navigation-ex-anchor" href="#&#x518D;&#x8BAE;reflect"><i class="fa fa-link" aria-hidden="true"></i></a>13. &#x518D;&#x8BAE;reflect</h1>
<p>reflect.Type&#x662F;&#x4E2A;interface, &#x800C;reflect.Value&#x662F;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;.
Type&#x66F4;&#x62BD;&#x8C61;, &#x800C;Value&#x662F;&#x5B9E;&#x4F8B;.</p>
<h2 id="&#x6253;&#x5370;&#x53D8;&#x91CF;&#x4FE1;&#x606F;"><a name="&#x6253;&#x5370;&#x53D8;&#x91CF;&#x4FE1;&#x606F;" class="anchor-navigation-ex-anchor" href="#&#x6253;&#x5370;&#x53D8;&#x91CF;&#x4FE1;&#x606F;"><i class="fa fa-link" aria-hidden="true"></i></a>13.1. &#x6253;&#x5370;&#x53D8;&#x91CF;&#x4FE1;&#x606F;</h2>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">desc</span><span class="token punctuation">(</span>i <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>

    <span class="token keyword">if</span> t<span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> reflect<span class="token punctuation">.</span>Ptr <span class="token punctuation">{</span>
        <span class="token comment">//&#x52A0;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4F1A;panic, &#x63D0;&#x793A; panic: reflect.Value.Addr of unaddressable value</span>
        <span class="token comment">//&#x6211;&#x7406;&#x89E3;&#x662F;&#x8FD9;&#x6837;&#x7684;: &#x4F20;&#x53C2;&#x7684;&#x65F6;&#x5019;, &#x628A;&#x5BF9;&#x8C61;&#x8D4B;&#x503C;&#x7ED9;interface{}, &#x4E5F;&#x662F;&#x503C;&#x4F20;&#x9012;;</span>
        <span class="token comment">//reflect.ValueOf(i)&#x5176;&#x5B9E;&#x662F;&#x6709;&#x5730;&#x5740;&#x7684;, &#x4F46;&#x5B83;&#x662F;&#x4E2A;&quot;&#x4E34;&#x65F6;&#x7684;&#x62F7;&#x8D1D;&quot;, &#x5B83;&#x7684;&#x5730;&#x5740;&#x6CA1;&#x6709;&#x610F;&#x4E49;</span>
        <span class="token comment">//&#x6240;&#x4EE5;&#x4E0B;&#x9762;&#x7684;&#x8BED;&#x53E5;&#x4E0D;&#x8BA9;&#x83B7;&#x53D6;&#x8FD9;&#x4E2A;&#x4E34;&#x65F6;&#x62F7;&#x8D1D;&#x7684;&#x5730;&#x5740;; &#x8FD9;&#x4E2A;&#x4E34;&#x65F6;&#x7684;&#x62F7;&#x8D1D;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;unaddressable</span>
        <span class="token comment">//fmt.Println(reflect.ValueOf(i).Addr())</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;(%v, %T)@&lt;%d&gt;\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> i<span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//&#x8FD9;&#x4E2A;case&#x5BF9;&#x5E94;desc(&amp;a), &#x6B64;&#x65F6;i&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4E2A;&#x6307;&#x9488;.</span>
        <span class="token comment">//&#x90A3;&#x4E48;v.Elem()&#x548C;t.Elem()&#x5C31;&#x662F;&#x89E3;&#x5F15;&#x7528;</span>
        <span class="token comment">//&#x7528;v.Elem().UnsafeAddr()&#x4EE3;&#x66FF;i, &#x4E5F;&#x80FD;&#x6B63;&#x786E;&#x6253;&#x5370;&#x5730;&#x5740;(&#x9700;&#x6362;&#x6210;%x&#x6253;&#x5370;)</span>
        v <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;(%v, %v)@[%p]&lt;%d&gt;\n&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5176;&#x4E2D;</p>
<ul>
<li>t&#x662F;Type&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;, t&#x672C;&#x8EAB;&#x662F;interface&#x7C7B;&#x578B;</li>
<li>t.Kind()&#x662F;&#x5E95;&#x5C42;&#x5B9E;&#x4F8B;&#x7684;&#x7C7B;&#x578B;, &#x4E0E;reflect&#x5305;&#x91CC;&#x7684;&#x5E38;&#x91CF;&#x7C7B;&#x578B;&#x53EF;&#x6BD4;&#x8F83;</li>
<li>t.Size()&#x8FD4;&#x56DE;&#x7C7B;&#x578B;t&#x7684;&#x5927;&#x5C0F;</li>
<li>v&#x662F;Value&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;, &#x4EE3;&#x8868;&#x4E86;&#x5B9E;&#x9645;&#x7684;value</li>
<li>v.Elem()&#x6307;v&#x662F;&#x6307;&#x9488;&#x7684;&#x65F6;&#x5019;, &#x5176;&#x6307;&#x5411;&#x7684;&#x5BF9;&#x8C61;&#x7684;&#x503C;</li>
<li>t.Elem()&#x662F;t&#x662F;&#x6307;&#x9488;&#x7684;&#x65F6;&#x5019;, &#x5176;&#x6307;&#x5411;&#x5BF9;&#x8C61;&#x7684;&#x7C7B;&#x578B;</li>
<li>t.Elem().Size&#x662F;&#x5176;&#x6307;&#x5411;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x7684;&#x5927;&#x5C0F;</li>
</ul>
<h2 id="&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;"><a name="&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;"><i class="fa fa-link" aria-hidden="true"></i></a>13.2. &#x6D4B;&#x8BD5;&#x4EE3;&#x7801;</h2>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a <span class="token operator">:=</span> <span class="token number">55</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;(%v, %T)@(%p, %d)\n&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token function">desc</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token function">desc</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">)</span>

    m <span class="token operator">:=</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        <span class="token builtin">int</span>
        <span class="token builtin">string</span>
    <span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;(%v, %T)@[%p, %d]\n&quot;</span><span class="token punctuation">,</span> m<span class="token punctuation">,</span> m<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m<span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">desc</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
    <span class="token function">desc</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//&#x7ED3;&#x679C;:</span>
<span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span>@<span class="token punctuation">(</span><span class="token number">0xc0000c0020</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span>@<span class="token operator">&lt;</span><span class="token number">8</span><span class="token operator">&gt;</span>
<span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span>@<span class="token punctuation">[</span><span class="token number">0xc0000c0020</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">8</span><span class="token operator">&gt;</span>
<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">6</span> hello<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span> <span class="token builtin">int</span><span class="token punctuation">;</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>@<span class="token punctuation">[</span><span class="token number">0xc0000b8040</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">]</span>
<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">6</span> hello<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span> <span class="token builtin">int</span><span class="token punctuation">;</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>@<span class="token operator">&lt;</span><span class="token number">24</span><span class="token operator">&gt;</span>
<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">6</span> hello<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span> <span class="token builtin">int</span><span class="token punctuation">;</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>@<span class="token punctuation">[</span><span class="token number">0xc0000b8040</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">24</span><span class="token operator">&gt;</span>
</code></pre>
<h1 id="&#x5305;&#x521D;&#x59CB;&#x5316;"><a name="&#x5305;&#x521D;&#x59CB;&#x5316;" class="anchor-navigation-ex-anchor" href="#&#x5305;&#x521D;&#x59CB;&#x5316;"><i class="fa fa-link" aria-hidden="true"></i></a>14. &#x5305;&#x521D;&#x59CB;&#x5316;</h1>
<p>&#x518D;main&#x6267;&#x884C;&#x4E4B;&#x524D;, &#x88AB;&#x4F9D;&#x8D56;&#x7684;&#x5305;&#x4F1A;&#x9012;&#x5F52;&#x7684;&#x5305;&#x542B;, &#x5E76;&#x6267;&#x884C;&#x91CC;&#x9762;&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;, init()&#x51FD;&#x6570;&#x7B49;.<br><img src="img/golang_&#x8FDB;&#x9636;_20220905234036.png" alt="">  </p>
<h1 id="&#x518D;&#x8BF4;&#x5207;&#x7247;&#x548C;&#x6570;&#x7EC4;"><a name="&#x518D;&#x8BF4;&#x5207;&#x7247;&#x548C;&#x6570;&#x7EC4;" class="anchor-navigation-ex-anchor" href="#&#x518D;&#x8BF4;&#x5207;&#x7247;&#x548C;&#x6570;&#x7EC4;"><i class="fa fa-link" aria-hidden="true"></i></a>15. &#x518D;&#x8BF4;&#x5207;&#x7247;&#x548C;&#x6570;&#x7EC4;</h1>
<h2 id="&#x6570;&#x7EC4;&#x662F;&#x503C;"><a name="&#x6570;&#x7EC4;&#x662F;&#x503C;" class="anchor-navigation-ex-anchor" href="#&#x6570;&#x7EC4;&#x662F;&#x503C;"><i class="fa fa-link" aria-hidden="true"></i></a>15.1. &#x6570;&#x7EC4;&#x662F;&#x503C;</h2>
<p>&#x6570;&#x7EC4;&#x662F;&#x503C;&#x7C7B;&#x578B;, &#x53C2;&#x6570;&#x91CC;&#x4F20;&#x6570;&#x7EC4;&#x4F1A;&#x590D;&#x5236;&#x6574;&#x4E2A;&#x6570;&#x7EC4;.
Go&#x8BED;&#x8A00;&#x4E2D;&#x6570;&#x7EC4;&#x662F;&#x503C;&#x8BED;&#x4E49;&#x3002;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x53D8;&#x91CF;&#x5373;&#x8868;&#x793A;&#x6574;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x5B83;&#x5E76;&#x4E0D;&#x662F;&#x9690;&#x5F0F;&#x7684;&#x6307;&#x5411;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x6307;&#x9488;&#xFF08;&#x6BD4;&#x5982;C&#x8BED;&#x8A00;&#x7684;&#x6570;&#x7EC4;&#xFF09;&#xFF0C;&#x800C;&#x662F;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x503C;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x53D8;&#x91CF;&#x88AB;&#x8D4B;&#x503C;&#x6216;&#x8005;&#x88AB;&#x4F20;&#x9012;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x4F1A;&#x590D;&#x5236;&#x6574;&#x4E2A;&#x6570;&#x7EC4;&#x3002;&#x5982;&#x679C;&#x6570;&#x7EC4;&#x8F83;&#x5927;&#x7684;&#x8BDD;&#xFF0C;&#x6570;&#x7EC4;&#x7684;&#x8D4B;&#x503C;&#x4E5F;&#x4F1A;&#x6709;&#x8F83;&#x5927;&#x7684;&#x5F00;&#x9500;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x590D;&#x5236;&#x6570;&#x7EC4;&#x5E26;&#x6765;&#x7684;&#x5F00;&#x9500;&#xFF0C;&#x53EF;&#x4EE5;&#x4F20;&#x9012;&#x4E00;&#x4E2A;&#x6307;&#x5411;&#x6570;&#x7EC4;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x4F46;&#x662F;&#x6570;&#x7EC4;&#x6307;&#x9488;&#x5E76;&#x4E0D;&#x662F;&#x6570;&#x7EC4;&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span> <span class="token comment">// a &#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token operator">&amp;</span>a <span class="token comment">// b &#x662F;&#x6307;&#x5411;&#x6570;&#x7EC4;&#x7684;&#x6307;&#x9488;</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// &#x6253;&#x5370;&#x6570;&#x7EC4;&#x7684;&#x524D;2&#x4E2A;&#x5143;&#x7D20;</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// &#x901A;&#x8FC7;&#x6570;&#x7EC4;&#x6307;&#x9488;&#x8BBF;&#x95EE;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x7684;&#x65B9;&#x5F0F;&#x548C;&#x6570;&#x7EC4;&#x7C7B;&#x4F3C;</span>

<span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> b <span class="token punctuation">{</span> <span class="token comment">// &#x901A;&#x8FC7;&#x6570;&#x7EC4;&#x6307;&#x9488;&#x8FED;&#x4EE3;&#x6570;&#x7EC4;&#x7684;&#x5143;&#x7D20;</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="go&#x7684;&#x6570;&#x7EC4;&#x8868;&#x8FBE;&#x548C;c&#x4E00;&#x6837;"><a name="go&#x7684;&#x6570;&#x7EC4;&#x8868;&#x8FBE;&#x548C;c&#x4E00;&#x6837;" class="anchor-navigation-ex-anchor" href="#go&#x7684;&#x6570;&#x7EC4;&#x8868;&#x8FBE;&#x548C;c&#x4E00;&#x6837;"><i class="fa fa-link" aria-hidden="true"></i></a>15.2. GO&#x7684;&#x6570;&#x7EC4;&#x8868;&#x8FBE;&#x548C;C&#x4E00;&#x6837;</h2>
<p>&#x6CE8;&#x610F;, go&#x91CC;&#x9762;&#x6570;&#x7EC4;&#x662F;&#x6570;&#x7EC4;, &#x5207;&#x7247;&#x662F;&#x5207;&#x7247;; &#x4E0A;&#x9762;&#x8BF4;&#x5230;&#x5207;&#x7247;&#x7684;&#x8868;&#x8FBE;&#x662F;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;, &#x5305;&#x62EC;&#x4E86;&#x6570;&#x7EC4;&#x7684;&#x6307;&#x9488;&#x548C;&#x5927;&#x5C0F;, &#x4F46;&#x6570;&#x7EC4;&#x8FD8;&#x662F;&#x548C;C&#x4E00;&#x6837;&#x7684;&quot;&#x539F;&#x59CB;&quot;&#x6837;&#x5B50;: &#x6307;&#x5411;&#x9996;&#x5143;&#x7D20;&#x7684;&#x6307;&#x9488;&#x53EF;&#x4EE5;&#x4EE3;&#x8868;&#x8FD9;&#x4E2A;&#x6570;&#x7EC4;.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// s&#x662F;&#x4E2A;&#x5207;&#x7247;</span>
    s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">}</span>
    sp <span class="token operator">:=</span> <span class="token operator">&amp;</span>s
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>sp<span class="token punctuation">)</span>
    <span class="token comment">//&amp;s[0]&#x5DF2;&#x7ECF;&#x662F;&#x5BF9;&#x5E95;&#x5C42;&#x6570;&#x7EC4;&#x7684;&#x5143;&#x7D20;&#x4E86;, &#x524D;&#x9762;&#x8BF4;&#x8FC7;, go&#x7684;&#x5E95;&#x5C42;&#x6570;&#x7EC4;&#x548C;c&#x8868;&#x8FBE;&#x4E00;&#x6837;</span>
    <span class="token comment">//&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x5F3A;&#x8F6C;&#x6210;*[3]int, &#x6CE8;&#x610F;&#x8FD9;&#x4E2A;&#x662F;&#x4E2A;&#x6570;&#x7EC4;; &#x53EA;&#x80FD;&#x8F6C;&#x6210;&#x6570;&#x7EC4;</span>
    sp3 <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>sp3<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//&#x7ED3;&#x679C;</span>
<span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span><span class="token punctuation">]</span>
<span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">]</span>
</code></pre>
<h2 id="&#x5207;&#x7247;"><a name="&#x5207;&#x7247;" class="anchor-navigation-ex-anchor" href="#&#x5207;&#x7247;"><i class="fa fa-link" aria-hidden="true"></i></a>15.3. &#x5207;&#x7247;</h2>
<p>&#x5207;&#x7247;&#x662F;&#x5BF9;&#x6570;&#x7EC4;&#x7684;&#x8868;&#x8FBE;, &#x5E26;&#x6709;&#x4E2A;header; header&#x91CC;&#x9762;&#x6709;&#x5E95;&#x5C42;&#x6570;&#x7EC4;&#x7684;&#x6307;&#x9488;&#x548C;&#x6570;&#x7EC4;&#x7684;&#x5927;&#x5C0F;;<br>&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x53EA;&#x8BFB;&#x7684;int&#x6570;&#x7EC4;,  &#x6709;&#x4E2A;&#x548C;&#x5207;&#x7247;&#x7C7B;&#x4F3C;&#x7684;&#x5934;, &#x884C;&#x4E3A;&#x548C;&#x5207;&#x7247;&#x6709;&#x70B9;&#x50CF;.<br><img src="img/golang_&#x8FDB;&#x9636;_20220905234142.png" alt="">  </p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> MyInt <span class="token builtin">int</span>

    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">}</span>
    <span class="token comment">//b&#x4E5F;&#x662F;&#x5207;&#x7247;, &#x4F46;&#x548C;a&#x5171;&#x4EAB;&#x5E95;&#x5C42;&#x6570;&#x7EC4;</span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">[</span><span class="token punctuation">]</span>MyInt<span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
    b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token number">123</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// [123 8 9]</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// [123 8 9]</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T \n&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token comment">// []int</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T \n&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token comment">// []main.MyInt</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="&#x52A8;&#x6001;&#x94FE;&#x63A5;"><a name="&#x52A8;&#x6001;&#x94FE;&#x63A5;" class="anchor-navigation-ex-anchor" href="#&#x52A8;&#x6001;&#x94FE;&#x63A5;"><i class="fa fa-link" aria-hidden="true"></i></a>16. &#x52A8;&#x6001;&#x94FE;&#x63A5;</h1>
<p>&#x5E94;&#x8BE5;&#x662F;&#x4ECE;go1.8&#x5DE6;&#x53F3;&#x5F00;&#x59CB;, go&#x652F;&#x6301;&#x52A8;&#x6001;&#x94FE;&#x63A5;
This is possible now using -linkshared flag</p>
<p>What you need to do is to first run this command:</p>
<p><code>go install -buildmode=shared -linkshared std</code>
(Above code makes all common packages shareable!) then
&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x5728;mint&#x4E0B;&#x9762;, &#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;36M&#x7684;libstd.so; &#x7528;xz&#x538B;&#x7F29;&#x540E;&#x662F;8M&#x5DE6;&#x53F3;.</p>
<pre class="language-"><code>Linux Mint 19.1 Tessa $ llh ./go/pkg/linux_amd64_dynlink/libstd.so
-rw-rw-r-- 1 yingjieb yingjieb 36M Oct  9 09:15 ./go/pkg/linux_amd64_dynlink/libstd.so
</code></pre><p><code>go install -buildmode=shared -linkshared userownpackage</code>
finally when compiling your code you need to run:</p>
<p><code>go build -linkshared yourprogram</code>
What the above those is now it rather than statically linking everything only dynamically links them and you will end up with much smaller compiled files. Just to give you an idea my &quot;hello.go&quot; file with static linking is 2.3MB while the same code using dynamic linking is just 12KB!</p>
<p>&#x6211;&#x5728;mint&#x4E0A;, &#x7528;&#x5171;&#x4EAB;&#x6A21;&#x5F0F;, hello&#x7684;&#x53EF;&#x6267;&#x884C;&#x5927;&#x5C0F;&#x662F;20K. &#x9759;&#x6001;&#x6A21;&#x5F0F;&#x662F;2M.</p>
<pre class="language-"><code>Linux Mint 19.1 Tessa $ ldd hello
        linux-vdso.so.1 (0x00007ffea79b8000)
        libstd.so =&gt; /home/yingjieb/repo/gorepo/go/pkg/linux_amd64_dynlink/libstd.so (0x00007f8189201000)
        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f8188e10000)
        libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f8188c0c000)
        libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f81889ed000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f818bdda000)

Linux Mint 19.1 Tessa $ ldd /home/yingjieb/repo/gorepo/go/pkg/linux_amd64_dynlink/libstd.so
        linux-vdso.so.1 (0x00007fff4b3cb000)
        libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f065b410000)
        libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f065b1f1000)
        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f065ae00000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f065dfe9000)
</code></pre><p>&#x8BF4;&#x660E;:</p>
<ul>
<li>go&#x7A0B;&#x5E8F;&#x7684;&#x9759;&#x6001;&#x7F16;&#x8BD1;&#x65F6;&#x6309;&#x9700;&#x7F16;&#x8BD1;.</li>
<li>&#x5171;&#x4EAB;&#x7F16;&#x8BD1;std, &#x4F1A;&#x628A;go&#x7684;&#x5E93;&#x5168;&#x90E8;&#x7F16;&#x8BD1;, &#x5F15;&#x5165;&#x5168;&#x90E8;&#x4F9D;&#x8D56;, &#x6BD4;&#x5982;libc</li>
<li>&#x770B;&#x8D77;&#x6765;hello&#x4F9D;&#x8D56;libc, &#x4F46;&#x5176;&#x5B9E;&#x662F;go&#x7684;&#x5171;&#x4EAB;&#x5E93;libstd.so&#x4F9D;&#x8D56;libc&#x7B49;&#x52A8;&#x6001;&#x5E93;.</li>
<li>&#x5982;&#x679C;&#x8BF4;MIPS&#x4E0A;n32&#x4E0D;&#x652F;&#x6301;cgo&#x7684;&#x8BDD;, &#x90A3;&#x9759;&#x6001;&#x7F16;&#x8BD1;&#x7528;MIPS64&#x7684;libc.a&#x884C;&#x5417;? &#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x7F16;&#x8BD1;&#x7684;&#x65F6;&#x5019;&#x6709;.</li>
</ul>
<p>buildmode&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;
<code>go help buildmode</code></p>
<pre class="language-"><code>        -buildmode=shared
                Combine all the listed non-main packages into a single shared
                library that will be used when building with the -linkshared
                option. Packages named main are ignored.
</code></pre><h2 id="&#x652F;&#x6301;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x7684;&#x5E73;&#x53F0;"><a name="&#x652F;&#x6301;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x7684;&#x5E73;&#x53F0;" class="anchor-navigation-ex-anchor" href="#&#x652F;&#x6301;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x7684;&#x5E73;&#x53F0;"><i class="fa fa-link" aria-hidden="true"></i></a>16.1. &#x652F;&#x6301;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x7684;&#x5E73;&#x53F0;</h2>
<p>go1.12&#x53EA;&#x6709;&#x4E0B;&#x9762;&#x7684;&#x5E73;&#x53F0;&#x652F;&#x6301;:
<code>&quot;linux/386&quot;, &quot;linux/amd64&quot;, &quot;linux/arm&quot;, &quot;linux/arm64&quot;, &quot;linux/ppc64le&quot;, &quot;linux/s390x&quot;</code></p>
<h2 id="&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x652F;&#x6301;&#x7684;&#x67B6;&#x6784;"><a name="&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x652F;&#x6301;&#x7684;&#x67B6;&#x6784;" class="anchor-navigation-ex-anchor" href="#&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x652F;&#x6301;&#x7684;&#x67B6;&#x6784;"><i class="fa fa-link" aria-hidden="true"></i></a>16.2. &#x52A8;&#x6001;&#x94FE;&#x63A5;&#x652F;&#x6301;&#x7684;&#x67B6;&#x6784;</h2>
<p><code>src/cmd/go/internal/work/init.go</code>
&#x53EA;&#x6709;<code>case &quot;linux/386&quot;, &quot;linux/amd64&quot;, &quot;linux/arm&quot;, &quot;linux/arm64&quot;, &quot;linux/ppc64le&quot;, &quot;linux/s390x&quot;:</code>
MIPS&#x548C;PPC&#x5927;&#x7AEF;&#x90FD;&#x4E0D;&#x652F;&#x6301;</p>
<h1 id="&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;go"><a name="&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;go" class="anchor-navigation-ex-anchor" href="#&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;go"><i class="fa fa-link" aria-hidden="true"></i></a>17. &#x4EA4;&#x53C9;&#x7F16;&#x8BD1;go</h1>
<p>go&#x7684;&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x5F88;&#x7B80;&#x5355;, &#x53EA;&#x8981;&#x914D;&#x7F6E;&#x4E24;&#x4E2A;&#x73AF;&#x5883;&#x53D8;&#x91CF;
<code>GOOS GOARCH</code>
&#x6BD4;&#x5982;:</p>
<pre class="language-"><code>//&#x5C31;&#x7528;x86&#x7684;gc go&#x7F16;&#x8BD1;&#x5668;

//&#x9ED8;&#x8BA4;&#x7F16;&#x8BD1;&#x51FA;native&#x7684;go&#x7A0B;&#x5E8F;, &#x90A3;&#x8FD9;&#x91CC;&#x5C31;&#x662F;x86-64
go build goweb.go

//&#x52A0;&#x73AF;&#x5883;&#x53D8;&#x91CF;, &#x5C31;&#x80FD;&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;
GOOS=linux GOARCH=mips64 go build goweb.go
//&#x7F16;&#x8BD1;&#x5F88;&#x987A;&#x5229;, &#x76F4;&#x63A5;&#x751F;&#x6210;mips64&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;
Linux Mint 19.1 Tessa $ file goweb
goweb: ELF 64-bit MSB executable, MIPS, MIPS-III version 1 (SYSV), statically linked, not stripped
</code></pre><p><a href="[https:/github.com/golang/go/issues/18942](https:/github.com/golang/go/issues/18942">&#x7F51;&#x4E0A;&#x8BF4;&#x7528;gcc go&#x7F16;&#x8BD1;&#x5668;&#x4E0D;&#x884C;:&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x56DE;&#x590D;</a></p>
<h2 id="&#x652F;&#x6301;&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x7684;&#x5E73;&#x53F0;"><a name="&#x652F;&#x6301;&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x7684;&#x5E73;&#x53F0;" class="anchor-navigation-ex-anchor" href="#&#x652F;&#x6301;&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x7684;&#x5E73;&#x53F0;"><i class="fa fa-link" aria-hidden="true"></i></a>17.1. &#x652F;&#x6301;&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x7684;&#x5E73;&#x53F0;</h2>
<pre class="language-"><code>Linux Mint 19.1 Tessa # go tool dist list | grep linux
linux/386
linux/amd64
linux/arm
linux/arm64
linux/mips
linux/mips64
linux/mips64le
linux/mipsle
linux/ppc64
linux/ppc64le
linux/s390x
</code></pre><h1 id="&#x4E00;&#x6B21;&#x8FD0;&#x884C;&#x65F6;&#x5F02;&#x5E38;&#x6253;&#x5370;"><a name="&#x4E00;&#x6B21;&#x8FD0;&#x884C;&#x65F6;&#x5F02;&#x5E38;&#x6253;&#x5370;" class="anchor-navigation-ex-anchor" href="#&#x4E00;&#x6B21;&#x8FD0;&#x884C;&#x65F6;&#x5F02;&#x5E38;&#x6253;&#x5370;"><i class="fa fa-link" aria-hidden="true"></i></a>18. &#x4E00;&#x6B21;&#x8FD0;&#x884C;&#x65F6;&#x5F02;&#x5E38;&#x6253;&#x5370;</h1>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    flag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span><span class="token function">HandlerFunc</span><span class="token punctuation">(</span>QR<span class="token punctuation">)</span><span class="token punctuation">)</span>
    err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token operator">*</span>addr<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;ListenAndServe:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5728;<code>err := http.ListenAndServe(*addr, nil)</code>, &#x6253;&#x5370;&#x51FA;&#x6B7B;&#x9501;&#x5F02;&#x5E38;
&#x80FD;&#x770B;&#x51FA;&#x6765;:</p>
<ul>
<li>go&#x7684;crash&#x62A5;&#x544A;&#x5F88;&#x6E05;&#x695A;: &#x6709;&#x8C03;&#x7528;&#x94FE;, &#x884C;&#x6570;, &#x53C2;&#x6570;</li>
<li>&#x8FD9;&#x4E2A;http&#x7684;&#x8C03;&#x7528;, &#x5927;&#x4F53;&#x4E0A;&#x7ECF;&#x8FC7;&#x4E86;net/http, net, poll, syscall, sync&#x7B49;&#x6A21;&#x5757;&#x7684;&#x8C03;&#x7528;, &#x5206;&#x5C42;&#x5F88;&#x6E05;&#x695A;</li>
</ul>
<pre class="language-"><code class="lang-go">fatal <span class="token builtin">error</span><span class="token punctuation">:</span> all goroutines are asleep <span class="token operator">-</span> deadlock<span class="token operator">!</span>

goroutine <span class="token number">1</span> <span class="token punctuation">[</span>sync<span class="token punctuation">.</span>Cond<span class="token punctuation">.</span>Wait<span class="token punctuation">]</span><span class="token punctuation">:</span>
runtime<span class="token punctuation">.</span><span class="token function">goparkunlock</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>runtime<span class="token operator">/</span>proc<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">310</span>
sync<span class="token punctuation">.</span><span class="token function">runtime_notifyListWait</span><span class="token punctuation">(</span><span class="token number">0x8407f0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>runtime<span class="token operator">/</span>sema<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">510</span> <span class="token operator">+</span><span class="token number">0x120</span>
sync<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>Cond<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token number">0x8407e8</span><span class="token punctuation">,</span> <span class="token number">0x8407e0</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>sync<span class="token operator">/</span>cond<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">56</span> <span class="token operator">+</span><span class="token number">0xe0</span>
syscall<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">waitRead</span><span class="token punctuation">(</span><span class="token number">0x8407e0</span><span class="token punctuation">,</span> <span class="token number">0x1</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x8001e0</span><span class="token punctuation">,</span> <span class="token number">0x4b6bb0</span><span class="token punctuation">,</span> <span class="token number">0x864c8c</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>syscall<span class="token operator">/</span>net_nacl<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">292</span> <span class="token operator">+</span><span class="token number">0xe0</span>
syscall<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>msgq<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0x8407e0</span><span class="token punctuation">,</span> <span class="token number">0x4296e0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>syscall<span class="token operator">/</span>net_nacl<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">409</span> <span class="token operator">+</span><span class="token number">0xc0</span>
syscall<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>netFile<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token number">0x832240</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x832240</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x4c49</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">0x4382e0</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>syscall<span class="token operator">/</span>net_nacl<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">571</span> <span class="token operator">+</span><span class="token number">0x40</span>
syscall<span class="token punctuation">.</span><span class="token function">Accept</span><span class="token punctuation">(</span><span class="token number">0x3</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0xff800000</span><span class="token punctuation">,</span> <span class="token number">0x7ff</span><span class="token punctuation">,</span> <span class="token number">0x56f40</span><span class="token punctuation">,</span> <span class="token number">0x4c49</span><span class="token punctuation">,</span> <span class="token number">0xf8ea81ab</span><span class="token punctuation">,</span> <span class="token number">0x850848</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>syscall<span class="token operator">/</span>net_nacl<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">799</span> <span class="token operator">+</span><span class="token number">0xa0</span>
internal<span class="token operator">/</span>poll<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token number">0x3</span><span class="token punctuation">,</span> <span class="token number">0x4c01</span><span class="token punctuation">,</span> <span class="token number">0x1</span><span class="token punctuation">,</span> <span class="token number">0x83f000</span><span class="token punctuation">,</span> <span class="token number">0x2</span><span class="token punctuation">,</span> <span class="token number">0x2</span><span class="token punctuation">,</span> <span class="token number">0x8</span><span class="token punctuation">,</span> <span class="token number">0x743800</span><span class="token punctuation">,</span> <span class="token number">0x2</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>internal<span class="token operator">/</span>poll<span class="token operator">/</span>sys_cloexec<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">24</span> <span class="token operator">+</span><span class="token number">0x40</span>
internal<span class="token operator">/</span>poll<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>FD<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Accept</span><span class="token punctuation">(</span><span class="token number">0x850840</span><span class="token punctuation">,</span> <span class="token number">0x4c49</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>internal<span class="token operator">/</span>poll<span class="token operator">/</span>fd_unix<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">377</span> <span class="token operator">+</span><span class="token number">0x140</span>
net<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>netFD<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token number">0x850840</span><span class="token punctuation">,</span> <span class="token number">0x864e20</span><span class="token punctuation">,</span> <span class="token number">0x7321c0</span><span class="token punctuation">,</span> <span class="token number">0x4c49</span><span class="token punctuation">,</span> <span class="token number">0xfefc0008</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>net<span class="token operator">/</span>fd_unix<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">238</span> <span class="token operator">+</span><span class="token number">0x40</span>
net<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>TCPListener<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token number">0x83efa0</span><span class="token punctuation">,</span> <span class="token number">0x4c49</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x44c9a0</span><span class="token punctuation">,</span> <span class="token number">0x83c201</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>net<span class="token operator">/</span>tcpsock_posix<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">139</span> <span class="token operator">+</span><span class="token number">0x40</span>
net<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>TCPListener<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Accept</span><span class="token punctuation">(</span><span class="token number">0x83efa0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x83f040</span><span class="token punctuation">,</span> <span class="token number">0x4c49</span><span class="token punctuation">,</span> <span class="token number">0x4242e0</span><span class="token punctuation">,</span> <span class="token number">0x725e08</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>net<span class="token operator">/</span>tcpsock<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">261</span> <span class="token operator">+</span><span class="token number">0x40</span>
net<span class="token operator">/</span>http<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>Server<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Serve</span><span class="token punctuation">(</span><span class="token number">0x8526c0</span><span class="token punctuation">,</span> <span class="token number">0x5194d0</span><span class="token punctuation">,</span> <span class="token number">0x83efa0</span><span class="token punctuation">,</span> <span class="token number">0x5</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>net<span class="token operator">/</span>http<span class="token operator">/</span>server<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">2896</span> <span class="token operator">+</span><span class="token number">0x2e0</span>
net<span class="token operator">/</span>http<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>Server<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token number">0x8526c0</span><span class="token punctuation">,</span> <span class="token number">0x469211</span><span class="token punctuation">,</span> <span class="token number">0x8526c0</span><span class="token punctuation">,</span> <span class="token number">0x516bb0</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>net<span class="token operator">/</span>http<span class="token operator">/</span>server<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">2825</span> <span class="token operator">+</span><span class="token number">0xe0</span>
net<span class="token operator">/</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>src<span class="token operator">/</span>net<span class="token operator">/</span>http<span class="token operator">/</span>server<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">3080</span>
main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>tmp<span class="token operator">/</span>sandbox101442177<span class="token operator">/</span>prog<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">17</span> <span class="token operator">+</span><span class="token number">0x160</span>
</code></pre>
<h1 id="goroutine&#x548C;&#x5171;&#x4EAB;&#x53D8;&#x91CF;"><a name="goroutine&#x548C;&#x5171;&#x4EAB;&#x53D8;&#x91CF;" class="anchor-navigation-ex-anchor" href="#goroutine&#x548C;&#x5171;&#x4EAB;&#x53D8;&#x91CF;"><i class="fa fa-link" aria-hidden="true"></i></a>19. goroutine&#x548C;&#x5171;&#x4EAB;&#x53D8;&#x91CF;</h1>
<h2 id="&#x7406;&#x8BBA;"><a name="&#x7406;&#x8BBA;" class="anchor-navigation-ex-anchor" href="#&#x7406;&#x8BBA;"><i class="fa fa-link" aria-hidden="true"></i></a>19.1. &#x7406;&#x8BBA;</h2>
<p>&#x5728;loop&#x91CC;&#x4F7F;&#x7528;goroutine&#x65F6;, &#x6BD4;&#x5982;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> val <span class="token operator">:=</span> <span class="token keyword">range</span> values <span class="token punctuation">{</span>
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x9996;&#x5148;, goroutine&#x662F;&#x80FD;&#x4F7F;&#x7528;&#x53D8;&#x91CF;val&#x7684;; &#x56E0;&#x4E3A;goroutine&#x5E95;&#x5C42;&#x4E5F;&#x662F;&#x8FD0;&#x884C;&#x5728;&#x7EBF;&#x7A0B;&#x4E0A;&#x7684;, &#x6BCF;&#x4E2A;go&#x8FDB;&#x7A0B;&#x6709;&#x81EA;&#x5DF1;&#x7684;&quot;worker&quot;&#x7EBF;&#x7A0B;, &#x4E00;&#x822C;&#x5728;&#x542F;&#x52A8;&#x65F6;&#x548C;CPU&#x6838;&#x6570;&#x76F8;&#x7B49;, &#x5B83;&#x4EEC;&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x662F;&#x4E00;&#x6837;&#x7684;.
&#x4F46;goroutine&#x4F1A;&#x7B49;&#x5F85;&#x8C03;&#x5EA6;&#x6267;&#x884C;, &#x53EF;&#x80FD;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;loop&#x7ED3;&#x675F;&#x540E;&#x624D;&#x5F00;&#x59CB;&#x6267;&#x884C;.
&#x6B64;&#x65F6;&#x7684;val&#x88AB;&quot;&#x6355;&#x83B7;&quot;&#x8FDB;goroutine(&#x6709;&#x65F6;&#x4E5F;&#x53EB;&#x95ED;&#x5305;), &#x4F46;val&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x503C;, &#x5728;for&#x91CC;&#x6539;&#x53D8;, &#x90A3;&#x5F88;&#x53EF;&#x80FD;&#x603B;&#x662F;&#x6355;&#x83B7;&#x5230;&#x6700;&#x540E;&#x4E00;&#x6B21;&#x7684;&#x503C;.
&#x540E;&#x9762;&#x7684;&#x5B9E;&#x9A8C;&#x4E5F;&#x9A8C;&#x8BC1;&#x4E86;&#x8FD9;&#x4E00;&#x70B9;.
&#x4E00;&#x822C;&#x4E0D;&#x8FD9;&#x6837;&#x76F4;&#x63A5;&#x7528;loop&#x53D8;&#x91CF;, &#x800C;&#x662F;&#x628A;loop&#x53D8;&#x91CF;&#x5F53;&#x505A;&#x53C2;&#x6570;&#x4F20;&#x5165;goroutine, &#x8FD9;&#x6837;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5728;&#x4F20;&#x9012;&#x7684;&#x65F6;&#x5019;, &#x5C31;&#x4FDD;&#x5B58;&#x5728;goroutine&#x7684;&#x6808;&#x91CC;&#x4E86;, &#x4E0D;&#x7528;&#x7B49;goroutine&#x88AB;&#x8C03;&#x5EA6;&#x6267;&#x884C;&#x624D;evaluate&#x8FD9;&#x4E2A;&#x503C;.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> val <span class="token operator">:=</span> <span class="token keyword">range</span> values <span class="token punctuation">{</span>
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>val <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x5B9E;&#x8DF5;"><a name="&#x5B9E;&#x8DF5;" class="anchor-navigation-ex-anchor" href="#&#x5B9E;&#x8DF5;"><i class="fa fa-link" aria-hidden="true"></i></a>19.2. &#x5B9E;&#x8DF5;</h2>
<p>&#x5BF9;&#x6BD4;&#x5DE6;&#x53F3;&#x4E24;&#x4E2A;&#x4EE3;&#x7801;, &#x5DE6;&#x8FB9;&#x5728;&#x5FAA;&#x73AF;&#x7ED3;&#x675F;&#x540E;sleep&#x4E86;, &#x53F3;&#x8FB9;&#x6CA1;&#x6709;.
&#x8F93;&#x51FA;&#x5C31;&#x4E0D;&#x4E00;&#x6837;, &#x4E3A;&#x4EC0;&#x4E48;&#x5462;?<br><img src="img/golang_&#x8FDB;&#x9636;_20220905234533.png" alt="">  <img src="img/golang_&#x8FDB;&#x9636;_20220905234547.png" alt=""><br>&#x6CE8;:</p>
<ul>
<li>&#x8FD9;&#x4E2A;&#x7F51;&#x7AD9;&#x63D0;&#x4F9B;&#x7684;&#x73AF;&#x5883;, &#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x6838;.<code>fmt.Println(&quot;CPU num = &quot;, runtime.NumCPU())</code>&#x6253;&#x51FA;&#x6765;&#x662F;1. &#x6240;&#x4EE5;goroutine&quot;&#x5E76;&#x884C;&quot;<code>x++</code>, &#x4E0D;&#x5B58;&#x5728;&#x5E76;&#x53D1;&#x7684;&#x95EE;&#x9898;, &#x7ED3;&#x679C;&#x662F;&#x5BF9;&#x7684;.</li>
<li><code>x++</code>&#x5E76;&#x4E0D;&#x662F;&#x539F;&#x5B50;&#x7684;, &#x4E00;&#x822C;C&#x91CC;&#x9762;&#x8981;&#x7528;&#x7F16;&#x8BD1;&#x5668;&#x63D0;&#x4F9B;&#x7684;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#x5B8F;: <code>__sync_fetch_and_add( &amp;x, 1 );</code>&#x6216;<code>atomic</code>&#x7CFB;&#x5217;&#x5B8F;</li>
<li>&#x4E3A;&#x4EC0;&#x4E48;sleep&#x548C;&#x4E0D;sleep&#x7ED3;&#x679C;&#x4E0D;&#x540C;?<ul>
<li>sleep&#x65F6;, goroutine&#x4EEC;&#x5148;&#x8FD0;&#x884C;</li>
<li>&#x4E0D;sleep&#x65F6;, &#x5927;&#x6982;&#x7387;&#x4E3B;&#x7EBF;&#x7A0B;&#x5148;&#x8FD0;&#x884C;, &#x6B64;&#x65F6;goroutine&#x4EEC;&#x8FD8;&#x6CA1;&#x6709;&#x5F00;&#x59CB;</li>
<li>&#x540E;&#x9762;&#x52A0;&#x4E86;&#x6253;&#x5370;x&#x7684;&#x7248;&#x672C;&#x770B;&#x7684;&#x66F4;&#x6E05;&#x695A;: &#x4E0D;sleep&#x65F6;, goroutine&#x90FD;&#x6CA1;&#x6709;&#x5F00;&#x59CB;&#x6267;&#x884C;.</li>
</ul>
</li>
</ul>
<hr>
<p>&#x6211;&#x4EEC;&#x6539;&#x4E00;&#x4E0B;&#x4EE3;&#x7801;:<br><img src="img/golang_&#x8FDB;&#x9636;_20220905234902.png" alt="">  <img src="img/golang_&#x8FDB;&#x9636;_20220905234916.png" alt=""><br>&#x6CE8;:</p>
<ul>
<li>&#x5728;&#x6700;&#x540E;&#x662F;&#x4E0D;&#x80FD;&#x6253;&#x5370;<code>i</code>&#x7684;&#x503C;&#x7684;, &#x56E0;&#x4E3A;<code>i</code>&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x53EA;&#x5728;&#x5FAA;&#x73AF;&#x91CC;&#x9762;, &#x51FA;&#x4E86;&#x5FAA;&#x73AF;&#x5C31;&#x6CA1;&#x6709;&#x4E86;.</li>
<li>&#x8FD9;&#x91CC;&#x9996;&#x5148;&#x6709;&#x4E2A;&#x8B66;&#x544A;: &#x662F;go vet&#x6253;&#x5370;&#x51FA;&#x6765;&#x7684;, &#x5927;&#x610F;&#x662F;&#x8BF4;&#x5FAA;&#x73AF;&#x53D8;&#x91CF;<code>i</code>&#x88AB;goroutine&#x51FD;&#x6570;func&#x6355;&#x83B7;. &#x4E00;&#x822C;&#x8FD9;&#x6837;&#x7528;&#x5BB9;&#x6613;&#x51FA;&#x95EE;&#x9898;.
&#x8FD9;&#x4E5F;&#x8BF4;&#x660E;go&#x63D0;&#x4F9B;&#x91CC;vet&#x673A;&#x5236;, &#x80FD;&#x505A;&#x4EE3;&#x7801;&#x9759;&#x6001;&#x68C0;&#x67E5;</li>
<li>&#x6BCF;&#x4E2A;goroutine&#x7684;x, &#x90FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;x, &#x6CA1;&#x6709;&#x79C1;&#x6709;&#x62F7;&#x8D1D;. &#x5728;<code>x++</code>&#x7684;&#x65F6;&#x5019;, &#x4ECE;&#x540C;&#x4E00;&#x4E2A;&#x5730;&#x5740;&#x53D6;&#x503C;, &#x52A0;&#x4E00;, &#x518D;&#x653E;&#x56DE;&#x540C;&#x4E00;&#x4E2A;&#x5185;&#x5B58;&#x5730;&#x5740;.
&#x6240;&#x4EE5;&#x73B0;&#x8C61;&#x4E0A;&#x662F;&#x6B63;&#x5E38;&#x7684;, &#x4F46;&#x524D;&#x63D0;&#x662F;&#x5355;&#x6838;&#x8FD0;&#x884C;&#x624D;&#x6B63;&#x5E38;.</li>
<li>&#x6BCF;&#x4E2A;goroutine&#x90FD;&#x6253;&#x5370;&#x5FAA;&#x73AF;&#x53D8;&#x91CF;<code>i</code>, &#x4F46;&#x90FD;&#x662F;<code>5</code>; &#x56E0;&#x4E3A;<code>i</code>&#x5728;for&#x91CC;&#x6539;&#x53D8;, &#x7B49;&#x5230;goroutine&#x88AB;&#x8C03;&#x5EA6;&#x6267;&#x884C;&#x65F6;, &#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x5DF2;&#x7ECF;&#x662F;5&#x4E86;.</li>
</ul>
<hr>
<p>&#x628A;i&#x5728;&#x5FAA;&#x73AF;&#x91CC;&#x8D4B;&#x503C;&#x7ED9;ii, &#x7ED3;&#x679C;&#x53C8;&#x4E0D;&#x4E00;&#x6837;:<br><img src="img/golang_&#x8FDB;&#x9636;_20220905235020.png" alt="">  <img src="img/golang_&#x8FDB;&#x9636;_20220905235043.png" alt=""><br>&#x6CE8;:</p>
<ul>
<li>&#x533A;&#x522B;&#x5728;&#x4E8E;&#x53D8;&#x91CF;<code>ii</code>&#x7684;&#x4F4D;&#x7F6E;:<ul>
<li>&#x5728;&#x5FAA;&#x73AF;&#x5916;&#x5B9A;&#x4E49;, &#x5219;<code>ii</code>&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x5730;&#x5740;.</li>
<li>&#x5728;&#x5FAA;&#x73AF;&#x91CC;&#x9762;&#x5B9A;&#x4E49;, &#x5219;<code>ii</code>&#x6BCF;&#x6B21;&#x8FDB;&#x5FAA;&#x73AF;&#x90FD;&#x8981;&#x91CD;&#x65B0;&#x521B;&#x5EFA;, &#x5730;&#x5740;&#x4E0D;&#x4E00;&#x6837;.</li>
</ul>
</li>
<li>&#x5730;&#x5740;&#x4E0D;&#x53D8;, &#x5219;goroutine&#x53D6;&#x503C;&#x7684;&#x65F6;&#x5019;, &#x5C31;&#x53EA;&#x80FD;&#x62FF;&#x5230;&#x4E00;&#x4E2A;&#x503C;.</li>
<li>&#x5730;&#x5740;&#x53D8;&#x4E86;, &#x5219;&#x6BCF;&#x4E2A;goroutine&#x90FD;&#x80FD;&#x53D6;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x503C;.</li>
<li>goroutine&#x77E5;&#x9053;&#x81EA;&#x5DF1;&#x8981;&quot;&#x6355;&#x83B7;&quot;&#x54EA;&#x4E2A;<code>ii</code></li>
<li>&#x628A;17&#x884C;&#x7684;go&#x5173;&#x952E;&#x8BCD;&#x53BB;&#x6389;, &#x53EA;&#x7559;&#x95ED;&#x5305;&#x51FD;&#x6570;func, &#x5219;&#x8FD9;&#x4E2A;func&#x4F1A;&#x5728;loop&#x91CC;&#x4F9D;&#x6B21;&#x88AB;&#x8C03;&#x7528;, &#x6253;&#x5370;&#x6B63;&#x5E38;&#x7684;0&#x5230;4.</li>
</ul>
<h1 id="&#x8C03;&#x8BD5;&#x73AF;&#x5883;&#x53D8;&#x91CF;"><a name="&#x8C03;&#x8BD5;&#x73AF;&#x5883;&#x53D8;&#x91CF;" class="anchor-navigation-ex-anchor" href="#&#x8C03;&#x8BD5;&#x73AF;&#x5883;&#x53D8;&#x91CF;"><i class="fa fa-link" aria-hidden="true"></i></a>20. &#x8C03;&#x8BD5;&#x73AF;&#x5883;&#x53D8;&#x91CF;</h1>
<h2 id="&#x4E3E;&#x4F8B;"><a name="&#x4E3E;&#x4F8B;" class="anchor-navigation-ex-anchor" href="#&#x4E3E;&#x4F8B;"><i class="fa fa-link" aria-hidden="true"></i></a>20.1. &#x4E3E;&#x4F8B;</h2>
<pre class="language-"><code>#10s&#x949F;&#x6253;&#x5370;&#x4E00;&#x6B21;&#x8C03;&#x5EA6;&#x4FE1;&#x606F;
GODEBUG=schedtrace=10000,scheddetail=1 GOTRACEBACK=system ./json_load -fileName test.json -loopNum 100000 &gt; /dev/null
</code></pre><h2 id="godebug"><a name="godebug" class="anchor-navigation-ex-anchor" href="#godebug"><i class="fa fa-link" aria-hidden="true"></i></a>20.2. GODEBUG</h2>
<p>GODEBUG&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x5305;&#x62EC;&#x5B50;&#x53D8;&#x91CF;, &#x7528;<code>name=val, name=val</code>&#x7684;&#x5F62;&#x5F0F;, &#x8BE6;&#x89C1;<a href="https://golang.org/pkg/runtime/" target="_blank">https://golang.org/pkg/runtime/</a></p>
<pre class="language-"><code>#GC&#x76F8;&#x5173;&#x7684;
allocfreetrace=1
gctrace=1
#cgo
cgocheck=1
#&#x8C03;&#x5EA6;, &#x6BCF;X ms&#x6253;&#x5370;&#x4FE1;&#x606F;
schedtrace=X and scheddetail=1
</code></pre><h2 id="gotraceback"><a name="gotraceback" class="anchor-navigation-ex-anchor" href="#gotraceback"><i class="fa fa-link" aria-hidden="true"></i></a>20.3. GOTRACEBACK</h2>
<p>&#x9ED8;&#x8BA4;&#x5728;&#x7A0B;&#x5E8F;&#x51FA;&#x9519;&#x65F6;&#x6253;&#x5370;&#x8C03;&#x7528;&#x6808;, </p>
<pre class="language-"><code>#&#x4F9D;&#x6B21;&#x52A0;&#x5F3A;
GOTRACEBACK=none
GOTRACEBACK=single &#x9ED8;&#x8BA4;
GOTRACEBACK=all
GOTRACEBACK=system
GOTRACEBACK=crash &#x89E6;&#x53D1;coredump
</code></pre><h2 id="&#x540D;&#x5B57;&#x51B2;&#x7A81;&#x548C;type&#x522B;&#x540D;"><a name="&#x540D;&#x5B57;&#x51B2;&#x7A81;&#x548C;type&#x522B;&#x540D;" class="anchor-navigation-ex-anchor" href="#&#x540D;&#x5B57;&#x51B2;&#x7A81;&#x548C;type&#x522B;&#x540D;"><i class="fa fa-link" aria-hidden="true"></i></a>20.4. &#x540D;&#x5B57;&#x51B2;&#x7A81;&#x548C;type&#x522B;&#x540D;</h2>
<p>&#x5728;&#x533F;&#x540D;&#x7EE7;&#x627F;&#x8FC7;&#x7A0B;&#x4E2D;, &#x6211;&#x9047;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x95EE;&#x9898;:
tengo.String&#x7C7B;&#x578B;, &#x6709;String()&#x65B9;&#x6CD5;. &#x5982;&#x679C;&#x6211;&#x60F3;&#x7EE7;&#x627F;&#x8FD9;&#x4E2A;&#x7C7B;&#x578B;, &#x901A;&#x5E38;&#x662F;&#x8FD9;&#x6837;&#x5199;:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">package</span> extension

<span class="token keyword">type</span> String <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    tengo<span class="token punctuation">.</span>String
<span class="token punctuation">}</span>
</code></pre>
<p>&#x4F46;&#x7F16;&#x8BD1;&#x4E0D;&#x901A;&#x8FC7;, &#x5927;&#x610F;&#x662F;String&#x662F;&#x4E2A;field name, &#x4F46;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x9700;&#x8981;String()&#x65B9;&#x6CD5;.
&#x539F;&#x56E0;&#x662F;extension.String, &#x6709;String&#x5C5E;&#x6027;, &#x4E5F;&#x6709;String()&#x65B9;&#x6CD5;, &#x91CD;&#x540D;&#x4E86;. go&#x7F16;&#x8BD1;&#x5668;<strong>&#x4E0D;&#x5141;&#x8BB8;</strong>field name&#x548C;method name&#x91CD;&#x540D;, &#x5426;&#x5219;&#x4F1A;&#x51B2;&#x7A81;.</p>
<h3 id="type&#x5B9A;&#x4E49;&#x65B0;&#x7C7B;&#x578B;"><a name="type&#x5B9A;&#x4E49;&#x65B0;&#x7C7B;&#x578B;" class="anchor-navigation-ex-anchor" href="#type&#x5B9A;&#x4E49;&#x65B0;&#x7C7B;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>20.4.1. type&#x5B9A;&#x4E49;&#x65B0;&#x7C7B;&#x578B;</h3>
<p>&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E5F;&#x662F;&#x4E0D;&#x884C;&#x7684;, &#x751A;&#x81F3;&#x66F4;&#x7CDF;:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">package</span> extension

<span class="token keyword">type</span> tString tengo<span class="token punctuation">.</span>String 

<span class="token keyword">type</span> String <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    tString
<span class="token punctuation">}</span>
</code></pre>
<p>&#x56E0;&#x4E3A;tString&#x662F;&#x4E2A;&#x65B0;&#x7684;&#x7C7B;&#x578B;, &#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x65B9;&#x6CD5;; &#x533F;&#x540D;&#x5305;&#x542B;tString&#x7EE7;&#x627F;&#x4E0D;&#x5230;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;</p>
<h3 id="type&#x522B;&#x540D;"><a name="type&#x522B;&#x540D;" class="anchor-navigation-ex-anchor" href="#type&#x522B;&#x540D;"><i class="fa fa-link" aria-hidden="true"></i></a>20.4.2. type&#x522B;&#x540D;</h3>
<p>&#x8FD9;&#x91CC;&#x8981;&#x7528;type&#x7684;&#x522B;&#x540D;&#x673A;&#x5236;: &#x5B9A;&#x4E49;type&#x7684;&#x65F6;&#x5019;&#x7528;<code>=</code>&#x53F7;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">package</span> extension

<span class="token keyword">type</span> tString <span class="token operator">=</span> tengo<span class="token punctuation">.</span>String 

<span class="token keyword">type</span> String <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    tString
<span class="token punctuation">}</span>
</code></pre>
<p>&#x522B;&#x540D;&#x4FDD;&#x7559;&#x539F;&#x540D;&#x7684;&#x6240;&#x6709;&#x4E1C;&#x897F;. &#x6240;&#x4EE5;&#x8FD9;&#x91CC;tSting&#x5C31;&#x662F;tengo.String, &#x53EA;&#x662F;&#x62FC;&#x5199;&#x4E0D;&#x4E00;&#x6837;&#x4E86;. <a href="https://yourbasic.org/golang/type-alias/" target="_blank">&#x539F;&#x59CB;&#x89E3;&#x91CA;</a></p>
<blockquote>
<p>An alias declaration doesn&#x2019;t create a new distinct type different from the type it&#x2019;s created from. It just introduces an alias name T1, an alternate spelling, for the type denoted by T2.</p>
<p>Type aliases are not meant for everyday use. They were introduced to support gradual code repair while moving a type between packages during large-scale refactoring. Codebase Refactoring (with help from Go) covers this in detail.</p>
</blockquote>
<h1 id="goroutine-vs-thread"><a name="goroutine-vs-thread" class="anchor-navigation-ex-anchor" href="#goroutine-vs-thread"><i class="fa fa-link" aria-hidden="true"></i></a>21. goroutine vs thread</h1>
<h2 id="&#x9ED8;&#x8BA4;&#x7684;thread&#x6570;"><a name="&#x9ED8;&#x8BA4;&#x7684;thread&#x6570;" class="anchor-navigation-ex-anchor" href="#&#x9ED8;&#x8BA4;&#x7684;thread&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>21.1. &#x9ED8;&#x8BA4;&#x7684;thread&#x6570;</h2>
<p>&#x4E00;&#x4E2A;go&#x8FDB;&#x7A0B;&#x4F1A;&#x8D77;GOMAXPROCS &#x4E2A;&#x7EBF;&#x7A0B;, &#x4ECE;go1.5&#x4E4B;&#x540E;, &#x8FD9;&#x4E2A;&#x503C;&#x9ED8;&#x8BA4;&#x662F;CPU&#x6838;&#x6570;.
&#x53EF;&#x4EE5;&#x5728;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x6539;, &#x4E5F;&#x53EF;&#x4EE5;&#x7528;runtime.GOMAXPROCS&#x6765;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x6539;.</p>
<pre class="language-"><code>GOMAXPROCS=4 goapp
</code></pre><p>&#x6CE8;&#x610F;GOMAXPROCS &#x662F;&#x6307;&#x540C;&#x65F6;running&#x7684;&#x7EBF;&#x7A0B;&#x6570;, &#x4E0D;&#x5305;&#x62EC;&#x88AB;block&#x7684;&#x7EBF;&#x7A0B;. go&#x8FDB;&#x7A0B;&#x5BF9;block&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x6CA1;&#x6709;&#x9650;&#x5236;. </p>
<h2 id="goroutine&#x4ECB;&#x7ECD;"><a name="goroutine&#x4ECB;&#x7ECD;" class="anchor-navigation-ex-anchor" href="#goroutine&#x4ECB;&#x7ECD;"><i class="fa fa-link" aria-hidden="true"></i></a>21.2. goroutine&#x4ECB;&#x7ECD;</h2>
<p>&#x53C2;&#x8003;
<a href="https://codeburst.io/why-goroutines-are-not-lightweight-threads-7c460c1f155f" target="_blank">https://codeburst.io/why-goroutines-are-not-lightweight-threads-7c460c1f155f</a>
<a href="https://medium.com/@riteeksrivastava/a-complete-journey-with-goroutines-8472630c7f5c" target="_blank">https://medium.com/@riteeksrivastava/a-complete-journey-with-goroutines-8472630c7f5c</a></p>
<p>goroutine&#x5E76;&#x4E0D;&#x662F;linux thread, &#x4F46;&#x5EFA;&#x7ACB;&#x5728;thread&#x4E0A;, &#x53D7;go runtime scheduler&#x8C03;&#x5EA6;&#x7684;&#x4EFB;&#x52A1;&#x5355;&#x4F4D;.
&#x5BF9;&#x6BD4;linux thread, &#x5B83;&#x66F4;&#x8F7B;&#x91CF;, &#x8868;&#x73B0;&#x5728;&#x5982;&#x4E0B;&#x51E0;&#x4E2A;&#x65B9;&#x9762;:</p>
<ul>
<li>thread&#x7684;stack&#x6BD4;&#x8F83;&#x5927;, &gt; 1M, &#x6240;&#x4EE5;&#x5982;&#x679C;&#x6709;1000&#x4E2A;thread, &#x8981;&#x5360;1G&#x7684;&#x5185;&#x5B58;;
goroutine&#x9ED8;&#x8BA4;stack&#x662F;2K, &#x5982;&#x679C;&#x6709;goroutine&#x9700;&#x8981;&#x66F4;&#x5927;&#x7684;stack, &#x4F1A;&#x5206;&#x914D;&#x65B0;&#x7684;&#x5185;&#x5B58;&#x533A;&#x57DF;.</li>
<li>goroutine&#x4E0D;&#x53D7;OS&#x8C03;&#x5EA6;, &#x800C;&#x662F;&#x53D7;go runtime scheduler&#x8C03;&#x5EA6;, &#x6240;&#x4EE5;&#x4E0D;&#x9700;&#x8981;&#x6BD4;&#x5982;100Hz&#x7684;&#x4E2D;&#x65AD;&#x6765;&#x8C03;&#x5EA6;
&#x57FA;&#x672C;&#x4E0A;, &#x8C03;&#x5EA6;&#x7684;&#x7B56;&#x7565;&#x7C7B;&#x4F3C;linux&#x7684;&#x975E;&#x62A2;&#x5360;&#x6A21;&#x5F0F;, &#x4E3B;&#x52A8;&#x8BA9;&#x51FA;&#x6216;&#x963B;&#x585E;&#x65F6;&#x8BA9;&#x51FA;CPU.
goroutine&#x963B;&#x585E;&#x662F;&#x963B;&#x585E;&#x5728;&#x5F53;&#x524D;&#x8FD0;&#x884C;&#x5B83;&#x7684;&#x7EBF;&#x7A0B;, go scheduler&#x4F1A;&#x8FD0;&#x884C;&#x5176;&#x4ED6;thread&#x6765;&#x8FD0;&#x884C;&#x5176;&#x4ED6;goroutine.
&#x4E0D;&#x9700;&#x8981;&#x7B49;&#x7EBF;&#x7A0B;&#x963B;&#x585E;&#x624D;&#x8C03;&#x5EA6;, &#x6BD4;&#x5982;goroutine&#x7528;channel&#x548C;&#x53E6;&#x4E00;&#x4E2A;goroutine&#x901A;&#x4FE1;, &#x672C;&#x8EAB;&#x5E76;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;goroutine&#x6240;&#x5728;&#x7EBF;&#x7A0B;&#x963B;&#x585E;, &#x4F46;go scheduler&#x4F1A;&#x8C03;&#x5EA6;&#x5176;&#x4ED6;goroutine&#x6765;&#x5728;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x66FF;&#x4EE3;&#x4E4B;&#x524D;&#x7684;goroutine&#x8FD0;&#x884C;.
&#x4E00;&#x4E2A;goroutine&#x88AB;&#x8C03;&#x5EA6;&#x8FD0;&#x884C;, &#x53EA;&#x53D1;&#x751F;&#x5728;&#x5F53;&#x524D;&#x7684;goroutine<ul>
<li>&#x8C03;&#x7528;&#x4E86;channel send, &#x5E76;&#x963B;&#x585E;</li>
<li>&#x7528;go&#x5173;&#x952E;&#x8BCD;&#x542F;&#x52A8;&#x4E00;&#x4E2A;goroutine</li>
<li>&#x5728;file access&#x6216;network&#x76F8;&#x5173;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4E0A;&#x963B;&#x585E;</li>
<li>&#x88AB;Gc&#x505C;&#x4F4F;&#x540E;</li>
</ul>
</li>
<li>thread&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#x7684;&#x4EE3;&#x4EF7;&#x504F;&#x5927;, &#x8981;&#x4FDD;&#x5B58;&#x5F88;&#x591A;&#x5BC4;&#x5B58;&#x5668;, &#x9664;&#x4E86;&#x5E38;&#x89C1;&#x7684;&#x901A;&#x7528;&#x5BC4;&#x5B58;&#x5668;, &#x8FD8;&#x5305;&#x62EC;AVX, SSE, &#x6D6E;&#x70B9;&#x7B49;.
goroutine&#x5219;&#x4E0D;&#x9700;&#x8981;&#x4FDD;&#x5B58;&#x8FD9;&#x4E48;&#x591A;&#x7684;&#x5BC4;&#x5B58;&#x5668;, &#x56E0;&#x4E3A;&#x8C03;&#x5EA6;&#x90FD;&#x5728;&#x7279;&#x5B9A;&#x7684;&#x70B9;&#x4E0A;, &#x90A3;&#x4FDD;&#x5B58;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x4E5F;&#x662F;&#x6309;&#x9700;&#x7684;.</li>
</ul>
<h1 id="json&#x548C;&#x4E07;&#x80FD;interface"><a name="json&#x548C;&#x4E07;&#x80FD;interface" class="anchor-navigation-ex-anchor" href="#json&#x548C;&#x4E07;&#x80FD;interface"><i class="fa fa-link" aria-hidden="true"></i></a>22. json&#x548C;&#x4E07;&#x80FD;interface{}</h1>
<p>&#x666E;&#x901A;&#x7684;&#x7ED3;&#x6784;&#x4F53;&#x548C;[]byte&#x7684;&#x8F6C;&#x6362;, &#x7528;<code>json.Marshal()</code>&#x548C;<code>json.Unmarshal()</code></p>
<h2 id="&#x5DF2;&#x77E5;&#x7ED3;&#x6784;&#x4F53;"><a name="&#x5DF2;&#x77E5;&#x7ED3;&#x6784;&#x4F53;" class="anchor-navigation-ex-anchor" href="#&#x5DF2;&#x77E5;&#x7ED3;&#x6784;&#x4F53;"><i class="fa fa-link" aria-hidden="true"></i></a>22.1. &#x5DF2;&#x77E5;&#x7ED3;&#x6784;&#x4F53;</h2>
<pre class="language-"><code class="lang-go">b <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">`{&quot;Name&quot;:&quot;Wednesday&quot;,&quot;Age&quot;:6,&quot;Parents&quot;:[&quot;Gomez&quot;,&quot;Morticia&quot;]}`</span><span class="token punctuation">)</span>

<span class="token keyword">type</span> FamilyMember <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Name <span class="token builtin">string</span>
    Age <span class="token builtin">int</span>
    Parents <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
<span class="token punctuation">}</span>
    <span class="token keyword">var</span> m FamilyMember
    err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m<span class="token punctuation">)</span>
</code></pre>
<p>&#x6CE8;&#x610F;:</p>
<ul>
<li>&#x7528;var&#x58F0;&#x660E;FamilyMember&#x53D8;&#x91CF;m&#x7684;&#x65F6;&#x5019;, Parents&#x8FD8;&#x53EA;&#x662F;&#x4E2A;nil</li>
<li>&#x800C;Unmarshal&#x4F1A;&#x518D;&#x540E;&#x53F0;&#x7533;&#x8BF7;&#x65B0;&#x7684;&#x5207;&#x7247;&#x6765;&#x653E;Parents </li>
<li>&#x540C;&#x6837;&#x7684;, &#x6BD4;&#x5982;&#x4E0B;&#x9762;, &#x5982;&#x679C;&#x7ED3;&#x6784;&#x4F53;&#x4E2D;&#x5305;&#x62EC;&#x6307;&#x9488;, &#x5219;Unmarshal&#x4F1A;&#x7533;&#x8BF7;Bar&#x7684;&#x7A7A;&#x95F4;.<pre class="language-"><code class="lang-go"><span class="token keyword">type</span> Foo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Bar <span class="token operator">*</span>Bar
<span class="token punctuation">}</span>
</code></pre>
</li>
</ul>
<h2 id="&#x4E0D;&#x77E5;&#x9053;&#x7ED3;&#x6784;&#x4F53;&#x60C5;&#x51B5;&#x4E0B;"><a name="&#x4E0D;&#x77E5;&#x9053;&#x7ED3;&#x6784;&#x4F53;&#x60C5;&#x51B5;&#x4E0B;" class="anchor-navigation-ex-anchor" href="#&#x4E0D;&#x77E5;&#x9053;&#x7ED3;&#x6784;&#x4F53;&#x60C5;&#x51B5;&#x4E0B;"><i class="fa fa-link" aria-hidden="true"></i></a>22.2. &#x4E0D;&#x77E5;&#x9053;&#x7ED3;&#x6784;&#x4F53;&#x60C5;&#x51B5;&#x4E0B;</h2>
<p>&#x90A3;&#x4E0D;&#x77E5;&#x9053;&#x7ED3;&#x6784;&#x4F53;&#x7684;json, &#x600E;&#x4E48;&#x89E3;&#x6790;&#x5462;?
&#x8FD9;&#x5C31;&#x8981;&#x7528;&#x5230;&#x4E07;&#x80FD;&#x7684;interface{}&#x63A5;&#x53E3;&#x4E86;.</p>
<blockquote>
<p>The json package uses map[string]interface{} and []interface{} values to store arbitrary JSON objects and arrays; it will happily unmarshal any valid JSON blob into a plain interface{} value. </p>
</blockquote>
<pre class="language-"><code class="lang-go"><span class="token comment">//&#x6BD4;&#x5982;b&#x662F;json, &#x4F46;&#x4E0D;&#x77E5;&#x9053;&#x5BF9;&#x5E94;&#x7684;&#x7ED3;&#x6784;&#x4F53;</span>
b <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">`{&quot;Name&quot;:&quot;Wednesday&quot;,&quot;Age&quot;:6,&quot;Parents&quot;:[&quot;Gomez&quot;,&quot;Morticia&quot;]}`</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> f <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token operator">&amp;</span>f<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span>

<span class="token comment">//&#x8F93;&#x51FA;, &#x53EF;&#x4EE5;&#x770B;&#x5230;, &#x8FD9;&#x4E2A;map&#x7684;key&#x662F;string, value&#x662F;interface{}, &#x56E0;&#x4E3A;&#x53EA;&#x6709;interface{}&#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;.</span>
<span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;Age&quot;</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">&quot;Name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Wednesday&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Parents&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;Gomez&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Morticia&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token comment">//&#x6B64;&#x65F6;&#x7528;&#x7C7B;&#x578B;&#x65AD;&#x8A00;&#x5F97;&#x5230;&#x8FD9;&#x4E2A;&#x7C7B;&#x578B;&#x7684;&quot;&#x503C;&quot;, &#x4E5F;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;map</span>
m <span class="token operator">:=</span> f<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x7528;range&#x6765;&#x904D;&#x5386;&#x4E86;</span>
<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> m <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> vv <span class="token operator">:=</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token builtin">string</span><span class="token punctuation">:</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">&quot;is string&quot;</span><span class="token punctuation">,</span> vv<span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token builtin">float64</span><span class="token punctuation">:</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">&quot;is float64&quot;</span><span class="token punctuation">,</span> vv<span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">:</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">&quot;is an array:&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> u <span class="token operator">:=</span> <span class="token keyword">range</span> vv <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> u<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">&quot;is of a type I don&apos;t know how to handle&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5E38;&#x89C1;&#x7684;json&#x7C7B;&#x578B;&#x5BF9;&#x7167;:</p>
<pre class="language-"><code>bool for JSON booleans,
float64 for JSON numbers,
string for JSON strings, and
nil for JSON null.
</code></pre><h2 id="encoder&#x548C;decoder"><a name="encoder&#x548C;decoder" class="anchor-navigation-ex-anchor" href="#encoder&#x548C;decoder"><i class="fa fa-link" aria-hidden="true"></i></a>22.3. encoder&#x548C;decoder</h2>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">NewDecoder</span><span class="token punctuation">(</span>r io<span class="token punctuation">.</span>Reader<span class="token punctuation">)</span> <span class="token operator">*</span>Decoder
<span class="token keyword">func</span> <span class="token function">NewEncoder</span><span class="token punctuation">(</span>w io<span class="token punctuation">.</span>Writer<span class="token punctuation">)</span> <span class="token operator">*</span>Encoder
</code></pre>
<pre class="language-"><code class="lang-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;encoding/json&quot;</span>
    <span class="token string">&quot;log&quot;</span>
    <span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dec <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdin<span class="token punctuation">)</span>
    enc <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewEncoder</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> v <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">if</span> err <span class="token operator">:=</span> dec<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> k <span class="token operator">:=</span> <span class="token keyword">range</span> v <span class="token punctuation">{</span>
            <span class="token keyword">if</span> k <span class="token operator">!=</span> <span class="token string">&quot;Name&quot;</span> <span class="token punctuation">{</span>
                <span class="token function">delete</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> err <span class="token operator">:=</span> enc<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="golang_高效go.html" class="navigation navigation-prev " aria-label="Previous page: Golang 高效go">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="as_title_golang2.html" class="navigation navigation-next " aria-label="Next page: Golang 杂记">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Golang 进阶","level":"1.10.7","depth":2,"next":{"title":"Golang 杂记","level":"1.10.8","depth":2,"path":"notes/as_title_golang2.md","ref":"notes/as_title_golang2.md","articles":[{"title":"Golang 杂记1","level":"1.10.8.1","depth":3,"path":"notes/golang_杂记1.md","ref":"notes/golang_杂记1.md","articles":[]},{"title":"Golang 杂记2","level":"1.10.8.2","depth":3,"path":"notes/golang_杂记2.md","ref":"notes/golang_杂记2.md","articles":[]},{"title":"Golang 杂记3","level":"1.10.8.3","depth":3,"path":"notes/golang_杂记3.md","ref":"notes/golang_杂记3.md","articles":[]},{"title":"Golang lib选型","level":"1.10.8.4","depth":3,"path":"notes/golang_lib选型.md","ref":"notes/golang_lib选型.md","articles":[]},{"title":"go mod和go proxy","level":"1.10.8.5","depth":3,"path":"notes/golang_mod_proxy.md","ref":"notes/golang_mod_proxy.md","articles":[]},{"title":"Golang 汇编语法和arm64小知识","level":"1.10.8.6","depth":3,"path":"notes/golang_汇编_arm64.md","ref":"notes/golang_汇编_arm64.md","articles":[]},{"title":"go调用c可以用swig","level":"1.10.8.7","depth":3,"path":"notes/golang_cgo_swig.md","ref":"notes/golang_cgo_swig.md","articles":[]}]},"previous":{"title":"Golang 高效go","level":"1.10.6","depth":2,"path":"notes/golang_高效go.md","ref":"notes/golang_高效go.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-livereload","-sharing","-lunr","-search","search-plus","-highlight","theme-comscore","prism","code","chapter-fold","github","splitter","wide-page","hide-navigation-buttons","anchor-navigation-ex","sequence","mermaid-gb3"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"chapter-fold":{},"prism":{"css":["prismjs/themes/prism.css"],"ignore":["mermaid","sequence"]},"sequence":{"theme":"simple"},"github":{"url":"https://github.com/Bai-Yingjie/Bai-Yingjie.github.io"},"splitter":{},"wide-page":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"hide-navigation-buttons":{},"mermaid-gb3":{},"anchor-navigation-ex":{"mode":"float","pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"isRewritePageTitle":true,"showLevel":true,"tocLevel1Icon":"fa fa-hand-o-right","tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right","showGoTop":true,"isShowTocTitleIcon":true,"printLog":false,"multipleH1":true,"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false}},"theme-comscore":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"search-plus":{}},"theme":"default","author":"Bai Yingjie","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"My Notes","language":"zh-hans","gitbook":"*"},"file":{"path":"notes/golang_进阶.md","mtime":"2022-10-27T10:36:36.952Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-10-27T10:37:39.083Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-mermaid-gb3/book/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    <script src="../gitbook/gitbook-plugin-mermaid-gb3/mermaid/mermaid.min.js"></script>

    </body>
</html>

